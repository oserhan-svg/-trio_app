import{a as Ut,b as Nt,c as lt}from"./chunk-WVRYN4MY.js";import{C as ew,D as tw,H as vi,L as rw,M as Mo,P as Pt,Za as lw,a as Ig,ba as ow,ea as nw,fa as sw,g as fd,ja as os,k as Xy,q as Sc,qa as Tc,r as Lo,ra as iw,sa as aw,ta as cw,va as uw,x as bc,y as Jy}from"./chunk-Z3O2IHPJ.js";import{a as pw,b as dw}from"./chunk-UZPTJEFV.js";import{V as by,aa as Ty,e as Xt,o as Sy,pa as Ay,ta as Bo}from"./chunk-UA65TROS.js";import{a as kg}from"./chunk-YJCG6GWC.js";import{$a as ny,A as Vn,Ba as ry,C as ud,Ca as Lr,D as Fi,Ic as ay,La as U,Mc as ic,N as Kg,Nc as Ar,Qc as cy,Tc as uy,Uc as ly,Vc as py,_a as oy,_c as dy,aa as ec,b as Hg,ba as tc,ca as Vg,da as Wg,dc as sc,e as Gg,fb as Ro,gb as cr,i as jg,j as vo,kb as nc,kd as my,na as Zg,nd as fy,o as $g,oa as zt,ob as sy,pa as ld,qa as Wn,rd as ct,sa as Yg,ta as Xg,tc as iy,vd as hy,wc as de,za as ty}from"./chunk-FO7QPK6E.js";import{$c as Lt,Db as Ly,Dd as Zy,Fb as My,Gd as cn,Hb as Uy,Jb as Oy,L as uc,Lb as qy,Ld as J,Nb as zy,Ob as Qy,P as ky,Pb as dc,Q as Fy,Qb as mc,R as Py,Rd as yc,S as _y,Sd as Yy,T as lc,V as vy,Va as Jn,Vc as gc,Wd as md,Xd as Er,_c as ae,ad as $y,ae as De,bb as Ry,be as wc,c as xy,d as ft,e as Yn,f as Mr,g as Ur,hb as pc,ib as es,jc as Hy,jd as xr,lc as No,ld as Ky,md as Vy,nc as fc,nd as Wy,oc as ts,p as Ey,pb as dd,pc as rs,q as Cy,qb as Dy,qc as Gy,rc as jy,u as Iy,ud as an,w as Xn,wc as pe,xc as _i,yb as By,yc as hc,zb as Ny}from"./chunk-KUSQMIXV.js";import{$b as Ve,$d as Qg,Aa as re,Ab as cd,C as z,Cd as zg,F as te,H as Oe,He as ue,Kb as Gk,Mb as jk,Ob as Rg,P as Fg,Pc as L,Qc as _,R as Pg,Sc as Kn,Tb as Dg,Tc as k,Vb as I,Wb as to,Xb as V,Yb as Ii,Zb as Bg,_b as kt,_d as rt,ac as N,bc as ki,bd as K,be as Ja,cc as Ng,ce as Po,de as _o,e as Ya,ec as Br,fe as Ot,g as bg,ga as se,ge as qt,h as Tg,hd as pt,i as It,ia as _g,ja as ce,l as Ag,la as ar,ld as Mg,m as Xa,md as Ug,n as xg,oc as Lg,od as Og,p as Eg,pc as Nr,sd as qe,tc as jn,te as rc,uc as $n,ud as sn,ue as xe,v as Cg,vd as qg,ve as Jg,w as ge,wa as Ci,we as oc,xa as vg,xd as oe,yd as ye,za as Tr}from"./chunk-JPCZ2XYS.js";import{D as Sg,d as yg,h as Ei,t as wg,u as Gn}from"./chunk-ZRKH4SQM.js";import{Aa as pd,D as Re,F as Yt,G as nn,Ga as Do,H as Dr,La as ac,Lb as yy,Na as be,Pb as Wk,Qb as Zk,Ra as ro,Sb as Yk,U as v,Ua as Ft,Wa as cc,Wb as Zn,Z as ze,_ as ot,_b as wy,a as O,b as Ke,ba as $k,ea as Kk,fb as Vk,j as a,k as A,l as q,nb as Pi,vb as gy,xa as ey}from"./chunk-TVPT7M2T.js";import{a as i,d as tt,g as D,i as u,j as h,l as Hk,m as Buffer,n as l}from"./chunk-WKJYWAXG.js";var hw=tt((oo,fw)=>{u();l();var mw=typeof self<"u"?self:oo,Ac=function(){function t(){this.fetch=!1,this.DOMException=mw.DOMException}return i(t,"F"),t.prototype=mw,new t}();(function(t){var e=function(r){var o={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function n(F){return F&&DataView.prototype.isPrototypeOf(F)}if(i(n,"isDataView"),o.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(F){return F&&s.indexOf(Object.prototype.toString.call(F))>-1};function p(F){if(typeof F!="string"&&(F=String(F)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(F))throw new TypeError("Invalid character in header field name");return F.toLowerCase()}i(p,"normalizeName");function d(F){return typeof F!="string"&&(F=String(F)),F}i(d,"normalizeValue");function m(F){var B={next:i(function(){var W=F.shift();return{done:W===void 0,value:W}},"next")};return o.iterable&&(B[Symbol.iterator]=function(){return B}),B}i(m,"iteratorFor");function f(F){this.map={},F instanceof f?F.forEach(function(B,W){this.append(W,B)},this):Array.isArray(F)?F.forEach(function(B){this.append(B[0],B[1])},this):F&&Object.getOwnPropertyNames(F).forEach(function(B){this.append(B,F[B])},this)}i(f,"Headers"),f.prototype.append=function(F,B){F=p(F),B=d(B);var W=this.map[F];this.map[F]=W?W+", "+B:B},f.prototype.delete=function(F){delete this.map[p(F)]},f.prototype.get=function(F){return F=p(F),this.has(F)?this.map[F]:null},f.prototype.has=function(F){return this.map.hasOwnProperty(p(F))},f.prototype.set=function(F,B){this.map[p(F)]=d(B)},f.prototype.forEach=function(F,B){for(var W in this.map)this.map.hasOwnProperty(W)&&F.call(B,this.map[W],W,this)},f.prototype.keys=function(){var F=[];return this.forEach(function(B,W){F.push(W)}),m(F)},f.prototype.values=function(){var F=[];return this.forEach(function(B){F.push(B)}),m(F)},f.prototype.entries=function(){var F=[];return this.forEach(function(B,W){F.push([W,B])}),m(F)},o.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);function g(F){if(F.bodyUsed)return Promise.reject(new TypeError("Already read"));F.bodyUsed=!0}i(g,"consumed");function y(F){return new Promise(function(B,W){F.onload=function(){B(F.result)},F.onerror=function(){W(F.error)}})}i(y,"fileReaderReady");function w(F){var B=new FileReader,W=y(B);return B.readAsArrayBuffer(F),W}i(w,"readBlobAsArrayBuffer");function S(F){var B=new FileReader,W=y(B);return B.readAsText(F),W}i(S,"readBlobAsText");function b(F){for(var B=new Uint8Array(F),W=new Array(B.length),Y=0;Y<B.length;Y++)W[Y]=String.fromCharCode(B[Y]);return W.join("")}i(b,"readArrayBufferAsText");function T(F){if(F.slice)return F.slice(0);var B=new Uint8Array(F.byteLength);return B.set(new Uint8Array(F)),B.buffer}i(T,"bufferClone");function x(){return this.bodyUsed=!1,this._initBody=function(F){this._bodyInit=F,F?typeof F=="string"?this._bodyText=F:o.blob&&Blob.prototype.isPrototypeOf(F)?this._bodyBlob=F:o.formData&&FormData.prototype.isPrototypeOf(F)?this._bodyFormData=F:o.searchParams&&URLSearchParams.prototype.isPrototypeOf(F)?this._bodyText=F.toString():o.arrayBuffer&&o.blob&&n(F)?(this._bodyArrayBuffer=T(F.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(F)||c(F))?this._bodyArrayBuffer=T(F):this._bodyText=F=Object.prototype.toString.call(F):this._bodyText="",this.headers.get("content-type")||(typeof F=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o.searchParams&&URLSearchParams.prototype.isPrototypeOf(F)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o.blob&&(this.blob=function(){var F=g(this);if(F)return F;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(w)}),this.text=function(){var F=g(this);if(F)return F;if(this._bodyBlob)return S(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(b(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(M)}),this.json=function(){return this.text().then(JSON.parse)},this}i(x,"Body");var C=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function E(F){var B=F.toUpperCase();return C.indexOf(B)>-1?B:F}i(E,"normalizeMethod");function P(F,B){B=B||{};var W=B.body;if(F instanceof P){if(F.bodyUsed)throw new TypeError("Already read");this.url=F.url,this.credentials=F.credentials,B.headers||(this.headers=new f(F.headers)),this.method=F.method,this.mode=F.mode,this.signal=F.signal,!W&&F._bodyInit!=null&&(W=F._bodyInit,F.bodyUsed=!0)}else this.url=String(F);if(this.credentials=B.credentials||this.credentials||"same-origin",(B.headers||!this.headers)&&(this.headers=new f(B.headers)),this.method=E(B.method||this.method||"GET"),this.mode=B.mode||this.mode||null,this.signal=B.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&W)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(W)}i(P,"Request"),P.prototype.clone=function(){return new P(this,{body:this._bodyInit})};function M(F){var B=new FormData;return F.trim().split("&").forEach(function(W){if(W){var Y=W.split("="),ee=Y.shift().replace(/\+/g," "),X=Y.join("=").replace(/\+/g," ");B.append(decodeURIComponent(ee),decodeURIComponent(X))}}),B}i(M,"decode");function G(F){var B=new f,W=F.replace(/\r?\n[\t ]+/g," ");return W.split(/\r?\n/).forEach(function(Y){var ee=Y.split(":"),X=ee.shift().trim();if(X){var Ue=ee.join(":").trim();B.append(X,Ue)}}),B}i(G,"parseHeaders"),x.call(P.prototype);function R(F,B){B||(B={}),this.type="default",this.status=B.status===void 0?200:B.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in B?B.statusText:"OK",this.headers=new f(B.headers),this.url=B.url||"",this._initBody(F)}i(R,"Response"),x.call(R.prototype),R.prototype.clone=function(){return new R(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},R.error=function(){var F=new R(null,{status:0,statusText:""});return F.type="error",F};var j=[301,302,303,307,308];R.redirect=function(F,B){if(j.indexOf(B)===-1)throw new RangeError("Invalid status code");return new R(null,{status:B,headers:{location:F}})},r.DOMException=t.DOMException;try{new r.DOMException}catch{r.DOMException=function(B,W){this.message=B,this.name=W;var Y=Error(B);this.stack=Y.stack},r.DOMException.prototype=Object.create(Error.prototype),r.DOMException.prototype.constructor=r.DOMException}function Q(F,B){return new Promise(function(W,Y){var ee=new P(F,B);if(ee.signal&&ee.signal.aborted)return Y(new r.DOMException("Aborted","AbortError"));var X=new XMLHttpRequest;function Ue(){X.abort()}i(Ue,"abortXhr"),X.onload=function(){var Ae={status:X.status,statusText:X.statusText,headers:G(X.getAllResponseHeaders()||"")};Ae.url="responseURL"in X?X.responseURL:Ae.headers.get("X-Request-URL");var mt="response"in X?X.response:X.responseText;W(new R(mt,Ae))},X.onerror=function(){Y(new TypeError("Network request failed"))},X.ontimeout=function(){Y(new TypeError("Network request failed"))},X.onabort=function(){Y(new r.DOMException("Aborted","AbortError"))},X.open(ee.method,ee.url,!0),ee.credentials==="include"?X.withCredentials=!0:ee.credentials==="omit"&&(X.withCredentials=!1),"responseType"in X&&o.blob&&(X.responseType="blob"),ee.headers.forEach(function(Ae,mt){X.setRequestHeader(mt,Ae)}),ee.signal&&(ee.signal.addEventListener("abort",Ue),X.onreadystatechange=function(){X.readyState===4&&ee.signal.removeEventListener("abort",Ue)}),X.send(typeof ee._bodyInit>"u"?null:ee._bodyInit)})}return i(Q,"fetch"),Q.polyfill=!0,t.fetch||(t.fetch=Q,t.Headers=f,t.Request=P,t.Response=R),r.Headers=f,r.Request=P,r.Response=R,r.fetch=Q,Object.defineProperty(r,"__esModule",{value:!0}),r}({})})(Ac);Ac.fetch.ponyfill=!0;delete Ac.fetch.polyfill;var ns=Ac;oo=ns.fetch;oo.default=ns.fetch;oo.fetch=ns.fetch;oo.Headers=ns.Headers;oo.Request=ns.Request;oo.Response=ns.Response;fw.exports=oo});var yw=tt((G2,gw)=>{u();l();(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:i(function(r,o){return r<<o|r>>>32-o},"rotl"),rotr:i(function(r,o){return r<<32-o|r>>>o},"rotr"),endian:i(function(r){if(r.constructor==Number)return e.rotl(r,8)&16711935|e.rotl(r,24)&4278255360;for(var o=0;o<r.length;o++)r[o]=e.endian(r[o]);return r},"endian"),randomBytes:i(function(r){for(var o=[];r>0;r--)o.push(Math.floor(Math.random()*256));return o},"randomBytes"),bytesToWords:i(function(r){for(var o=[],n=0,s=0;n<r.length;n++,s+=8)o[s>>>5]|=r[n]<<24-s%32;return o},"bytesToWords"),wordsToBytes:i(function(r){for(var o=[],n=0;n<r.length*32;n+=8)o.push(r[n>>>5]>>>24-n%32&255);return o},"wordsToBytes"),bytesToHex:i(function(r){for(var o=[],n=0;n<r.length;n++)o.push((r[n]>>>4).toString(16)),o.push((r[n]&15).toString(16));return o.join("")},"bytesToHex"),hexToBytes:i(function(r){for(var o=[],n=0;n<r.length;n+=2)o.push(parseInt(r.substr(n,2),16));return o},"hexToBytes"),bytesToBase64:i(function(r){for(var o=[],n=0;n<r.length;n+=3)for(var s=r[n]<<16|r[n+1]<<8|r[n+2],c=0;c<4;c++)n*8+c*6<=r.length*8?o.push(t.charAt(s>>>6*(3-c)&63)):o.push("=");return o.join("")},"bytesToBase64"),base64ToBytes:i(function(r){r=r.replace(/[^A-Z0-9+\/]/ig,"");for(var o=[],n=0,s=0;n<r.length;s=++n%4)s!=0&&o.push((t.indexOf(r.charAt(n-1))&Math.pow(2,-2*s+8)-1)<<s*2|t.indexOf(r.charAt(n))>>>6-s*2);return o},"base64ToBytes")};gw.exports=e})()});var gd=tt((V2,ww)=>{u();l();var hd={utf8:{stringToBytes:i(function(t){return hd.bin.stringToBytes(unescape(encodeURIComponent(t)))},"stringToBytes"),bytesToString:i(function(t){return decodeURIComponent(escape(hd.bin.bytesToString(t)))},"bytesToString")},bin:{stringToBytes:i(function(t){for(var e=[],r=0;r<t.length;r++)e.push(t.charCodeAt(r)&255);return e},"stringToBytes"),bytesToString:i(function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")},"bytesToString")}};ww.exports=hd});var bw=tt((X2,Sw)=>{u();l();(function(){var t=yw(),e=gd().utf8,r=gd().bin,o=i(function(s){s.constructor==String?s=e.stringToBytes(s):typeof Buffer<"u"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(s)?s=Array.prototype.slice.call(s,0):Array.isArray(s)||(s=s.toString());var c=t.bytesToWords(s),p=s.length*8,d=[],m=1732584193,f=-271733879,g=-1732584194,y=271733878,w=-1009589776;c[p>>5]|=128<<24-p%32,c[(p+64>>>9<<4)+15]=p;for(var S=0;S<c.length;S+=16){for(var b=m,T=f,x=g,C=y,E=w,P=0;P<80;P++){if(P<16)d[P]=c[S+P];else{var M=d[P-3]^d[P-8]^d[P-14]^d[P-16];d[P]=M<<1|M>>>31}var G=(m<<5|m>>>27)+w+(d[P]>>>0)+(P<20?(f&g|~f&y)+1518500249:P<40?(f^g^y)+1859775393:P<60?(f&g|f&y|g&y)-1894007588:(f^g^y)-899497514);w=y,y=g,g=f<<30|f>>>2,f=m,m=G}m+=b,f+=T,g+=x,y+=C,w+=E}return[m,f,g,y,w]},"sha1"),n=i(function(s,c){var p=t.wordsToBytes(o(s));return c&&c.asBytes?p:c&&c.asString?r.bytesToString(p):t.bytesToHex(p)},"api");n._blocksize=16,n._digestsize=20,Sw.exports=n})()});var xw=tt((aq,Jk)=>{Jk.exports={name:"@phantom-labs/blocklist",version:"0.13.0",main:"index.js",types:"index.d.ts",repository:"git@github.com:phantom-labs/blocklist.git",author:"Jordan Leigh <AlwaysBCoding@gmail.com>",license:"MIT",scripts:{build:"node build.js"},dependencies:{"js-yaml":"^4.1.0",sha3:"^2.1.4"}}});var Ew=tt((cq,eF)=>{eF.exports={blocklist:["phantomweb.app","aurory.app","solvision.io","staratlas.art","starsatlas.com","sollet.cc","raydlum.io","aurorynft.com","sneks.gg","solletweb.io","i-sollet.com","fancyfrenchienft.art","solanawebwallet.online","phahtom.com","server-syncwallet.com","staratias.app","raydium.network","grapesnetwork.me","staratias.art","soistarter.org","audius-nft.top","aurory.me","degenapes.app","phantom-app.online","phantomwallet.net","dapps-node.com","phantom-app.link","solanaoutage.com","walletconnectdapps.net","staratlas.cx","web-phantom.app","0120tt.com"],whitelist:[],fuzzylist:[],contentHash:"830ea1c9a833213eabc17990adf053081f503b1203ca9a2c711db7199e657293"}});var Cw=tt(Sd=>{u();l();var{version:tF}=xw(),rF=Ew(),oF=i(()=>tF,"getVersion"),nF=i(()=>rF,"getBlocklist");Sd.getVersion=oF;Sd.getBlocklist=nF});var kw=tt(is=>{"use strict";u();l();is.__esModule=!0;is.distance=is.closest=void 0;var no=new Uint32Array(65536),sF=i(function(t,e){for(var r=t.length,o=e.length,n=1<<r-1,s=-1,c=0,p=r,d=r;d--;)no[t.charCodeAt(d)]|=1<<d;for(d=0;d<o;d++){var m=no[e.charCodeAt(d)],f=m|c;m|=(m&s)+s^s,c|=~(m|s),s&=m,c&n&&p++,s&n&&p--,c=c<<1|1,s=s<<1|~(f|c),c&=f}for(d=r;d--;)no[t.charCodeAt(d)]=0;return p},"myers_32"),iF=i(function(t,e){for(var r=e.length,o=t.length,n=[],s=[],c=Math.ceil(r/32),p=Math.ceil(o/32),d=0;d<c;d++)s[d]=-1,n[d]=0;for(var m=0;m<p-1;m++){for(var f=0,g=-1,y=m*32,w=Math.min(32,o)+y,S=y;S<w;S++)no[t.charCodeAt(S)]|=1<<S;for(var d=0;d<r;d++){var b=no[e.charCodeAt(d)],T=s[d/32|0]>>>d&1,x=n[d/32|0]>>>d&1,C=b|f,E=((b|x)&g)+g^g|b|x,P=f|~(E|g),M=g&E;P>>>31^T&&(s[d/32|0]^=1<<d),M>>>31^x&&(n[d/32|0]^=1<<d),P=P<<1|T,M=M<<1|x,g=M|~(C|P),f=P&C}for(var S=y;S<w;S++)no[t.charCodeAt(S)]=0}for(var G=0,R=-1,j=m*32,Q=Math.min(32,o-j)+j,S=j;S<Q;S++)no[t.charCodeAt(S)]|=1<<S;for(var F=o,d=0;d<r;d++){var b=no[e.charCodeAt(d)],T=s[d/32|0]>>>d&1,x=n[d/32|0]>>>d&1,C=b|G,E=((b|x)&R)+R^R|b|x,P=G|~(E|R),M=R&E;F+=P>>>o-1&1,F-=M>>>o-1&1,P>>>31^T&&(s[d/32|0]^=1<<d),M>>>31^x&&(n[d/32|0]^=1<<d),P=P<<1|T,M=M<<1|x,R=M|~(C|P),G=P&C}for(var S=j;S<Q;S++)no[t.charCodeAt(S)]=0;return F},"myers_x"),Iw=i(function(t,e){if(t.length<e.length){var r=e;e=t,t=r}return e.length===0?t.length:t.length<=32?sF(t,e):iF(t,e)},"distance");is.distance=Iw;var aF=i(function(t,e){for(var r=1/0,o=0,n=0;n<e.length;n++){var s=Iw(t,e[n]);s<r&&(r=s,o=n)}return e[o]},"closest");is.closest=aF});var Fw=tt((bd,Ri)=>{u();l();(function(){"use strict";var t;try{t=typeof Intl<"u"&&typeof Intl.Collator<"u"?Intl.Collator("generic",{sensitivity:"base"}):null}catch{console.log("Collator could not be initialized and wouldn't be used")}var e=kw(),r=[],o=[],n={get:i(function(s,c,p){var d=p&&t&&p.useCollator;if(d){var m=s.length,f=c.length;if(m===0)return f;if(f===0)return m;var g,y,w,S,b;for(w=0;w<f;++w)r[w]=w,o[w]=c.charCodeAt(w);r[f]=f;var T;for(w=0;w<m;++w){for(y=w+1,S=0;S<f;++S)g=y,T=t.compare(s.charAt(w),String.fromCharCode(o[S]))===0,y=r[S]+(T?0:1),b=g+1,y>b&&(y=b),b=r[S+1]+1,y>b&&(y=b),r[S]=g;r[S]=y}return y}return e.distance(s,c)},"get")};typeof define<"u"&&define!==null&&define.amd?define(function(){return n}):typeof Ri<"u"&&Ri!==null&&typeof bd<"u"&&Ri.exports===bd?Ri.exports=n:(typeof self<"u"&&typeof self.postMessage=="function"&&typeof self.importScripts=="function"||typeof self<"u"&&self!==null)&&(self.Levenshtein=n)})()});var iA=tt(sA=>{"use strict";u();l();var Hs=O();function j1(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}i(j1,"is");var $1=typeof Object.is=="function"?Object.is:j1,K1=Hs.useState,V1=Hs.useEffect,W1=Hs.useLayoutEffect,Z1=Hs.useDebugValue;function Y1(t,e){var r=e(),o=K1({inst:{value:r,getSnapshot:e}}),n=o[0].inst,s=o[1];return W1(function(){n.value=r,n.getSnapshot=e,_f(n)&&s({inst:n})},[t,r,e]),V1(function(){return _f(n)&&s({inst:n}),t(function(){_f(n)&&s({inst:n})})},[t]),Z1(r),r}i(Y1,"useSyncExternalStore$2");function _f(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!$1(t,r)}catch{return!0}}i(_f,"checkIfSnapshotChanged");function X1(t,e){return e()}i(X1,"useSyncExternalStore$1");var J1=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?X1:Y1;sA.useSyncExternalStore=Hs.useSyncExternalStore!==void 0?Hs.useSyncExternalStore:J1});var cA=tt(aA=>{"use strict";u();l();h.NODE_ENV!=="production"&&function(){function t(w,S){return w===S&&(w!==0||1/w===1/S)||w!==w&&S!==S}i(t,"is");function e(w,S){f||n.startTransition===void 0||(f=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var b=S();if(!g){var T=S();s(b,T)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),g=!0)}T=c({inst:{value:b,getSnapshot:S}});var x=T[0].inst,C=T[1];return d(function(){x.value=b,x.getSnapshot=S,r(x)&&C({inst:x})},[w,b,S]),p(function(){return r(x)&&C({inst:x}),w(function(){r(x)&&C({inst:x})})},[w]),m(b),b}i(e,"useSyncExternalStore$2");function r(w){var S=w.getSnapshot;w=w.value;try{var b=S();return!s(w,b)}catch{return!0}}i(r,"checkIfSnapshotChanged");function o(w,S){return S()}i(o,"useSyncExternalStore$1"),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var n=O(),s=typeof Object.is=="function"?Object.is:t,c=n.useState,p=n.useEffect,d=n.useLayoutEffect,m=n.useDebugValue,f=!1,g=!1,y=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?o:e;aA.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:y,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var Rf=tt((Zae,vf)=>{"use strict";u();l();h.NODE_ENV==="production"?vf.exports=iA():vf.exports=cA()});var lA=tt(uA=>{"use strict";u();l();var Sl=O(),eB=Rf();function tB(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}i(tB,"is");var rB=typeof Object.is=="function"?Object.is:tB,oB=eB.useSyncExternalStore,nB=Sl.useRef,sB=Sl.useEffect,iB=Sl.useMemo,aB=Sl.useDebugValue;uA.useSyncExternalStoreWithSelector=function(t,e,r,o,n){var s=nB(null);if(s.current===null){var c={hasValue:!1,value:null};s.current=c}else c=s.current;s=iB(function(){function d(w){if(!m){if(m=!0,f=w,w=o(w),n!==void 0&&c.hasValue){var S=c.value;if(n(S,w))return g=S}return g=w}if(S=g,rB(f,w))return S;var b=o(w);return n!==void 0&&n(S,b)?(f=w,S):(f=w,g=b)}i(d,"memoizedSelector");var m=!1,f,g,y=r===void 0?null:r;return[function(){return d(e())},y===null?void 0:function(){return d(y())}]},[e,r,o,n]);var p=oB(t,s[0],s[1]);return sB(function(){c.hasValue=!0,c.value=p},[p]),aB(p),p}});var dA=tt(pA=>{"use strict";u();l();h.NODE_ENV!=="production"&&function(){function t(m,f){return m===f&&(m!==0||1/m===1/f)||m!==m&&f!==f}i(t,"is"),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var e=O(),r=Rf(),o=typeof Object.is=="function"?Object.is:t,n=r.useSyncExternalStore,s=e.useRef,c=e.useEffect,p=e.useMemo,d=e.useDebugValue;pA.useSyncExternalStoreWithSelector=function(m,f,g,y,w){var S=s(null);if(S.current===null){var b={hasValue:!1,value:null};S.current=b}else b=S.current;S=p(function(){function x(G){if(!C){if(C=!0,E=G,G=y(G),w!==void 0&&b.hasValue){var R=b.value;if(w(R,G))return P=R}return P=G}if(R=P,o(E,G))return R;var j=y(G);return w!==void 0&&w(R,j)?(E=G,R):(E=G,P=j)}i(x,"memoizedSelector");var C=!1,E,P,M=g===void 0?null:g;return[function(){return x(f())},M===null?void 0:function(){return x(M())}]},[f,g,y,w]);var T=n(m,S[0],S[1]);return c(function(){b.hasValue=!0,b.value=T},[T]),d(T),T},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var mA=tt((ace,Df)=>{"use strict";u();l();h.NODE_ENV==="production"?Df.exports=lA():Df.exports=dA()});var PE=tt((qEe,FE)=>{"use strict";u();l();FE.exports=t=>{if(Object.prototype.toString.call(t)!=="[object Object]")return!1;let e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}});var NE=tt((DE,BE)=>{"use strict";u();l();var Ql=PE(),{hasOwnProperty:vE}=Object.prototype,{propertyIsEnumerable:TL}=Object,ri=i((t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0}),"defineProperty"),AL=DE,_E={concatArrays:!1,ignoreUndefined:!1},Hl=i(t=>{let e=[];for(let r in t)vE.call(t,r)&&e.push(r);if(Object.getOwnPropertySymbols){let r=Object.getOwnPropertySymbols(t);for(let o of r)TL.call(t,o)&&e.push(o)}return e},"getEnumerableOwnPropertyKeys");function oi(t){return Array.isArray(t)?xL(t):Ql(t)?EL(t):t}i(oi,"clone");function xL(t){let e=t.slice(0,0);return Hl(t).forEach(r=>{ri(e,r,oi(t[r]))}),e}i(xL,"cloneArray");function EL(t){let e=Object.getPrototypeOf(t)===null?Object.create(null):{};return Hl(t).forEach(r=>{ri(e,r,oi(t[r]))}),e}i(EL,"cloneOptionObject");var RE=i((t,e,r,o)=>(r.forEach(n=>{typeof e[n]>"u"&&o.ignoreUndefined||(n in t&&t[n]!==Object.getPrototypeOf(t)?ri(t,n,ih(t[n],e[n],o)):ri(t,n,oi(e[n])))}),t),"mergeKeys"),CL=i((t,e,r)=>{let o=t.slice(0,0),n=0;return[t,e].forEach(s=>{let c=[];for(let p=0;p<s.length;p++)vE.call(s,p)&&(c.push(String(p)),s===t?ri(o,n++,s[p]):ri(o,n++,oi(s[p])));o=RE(o,s,Hl(s).filter(p=>!c.includes(p)),r)}),o},"concatArrays");function ih(t,e,r){return r.concatArrays&&Array.isArray(t)&&Array.isArray(e)?CL(t,e,r):!Ql(e)||!Ql(t)?oi(e):RE(t,e,Hl(e),r)}i(ih,"merge");BE.exports=function(...t){let e=ih(oi(_E),this!==AL&&this||{},_E),r={_:{}};for(let o of t)if(o!==void 0){if(!Ql(o))throw new TypeError("`"+o+"` is not an Option Object");r=ih(r,{_:o},e)}return r._}});var _I=tt((h2e,PI)=>{u();l();function vU(t,e,r,o){for(var n=-1,s=t==null?0:t.length;++n<s;){var c=t[n];e(o,c,r(c),t)}return o}i(vU,"arrayAggregator");PI.exports=vU});var RI=tt((S2e,vI)=>{u();l();var RU=Zk();function DU(t,e,r,o){return RU(t,function(n,s,c){e(o,n,r(n),c)}),o}i(DU,"baseAggregator");vI.exports=DU});var BI=tt((x2e,DI)=>{u();l();var BU=_I(),NU=RI(),LU=Vk(),MU=Kk();function UU(t,e){return function(r,o){var n=MU(r)?BU:NU,s=e?e():{};return n(r,t,LU(o,2),s)}}i(UU,"createAggregator");DI.exports=UU});var LI=tt((k2e,NI)=>{u();l();var OU=$k(),qU=BI(),zU=qU(function(t,e,r){OU(t,r,e)});NI.exports=zU});u();l();u();l();var Tw=D(hw(),1),Aw=D(bw(),1),yd=D(Hk(),1);var ss=(t=>(t.BLOCK="BLOCK",t.NONE="NONE",t))(ss||{});function Xk(t,e){for(let r=0;r<t.k;r++){let o=(0,Aw.default)(`${t.salt}_${e}_${r}`,{asBytes:!0}),s=yd.Buffer.from(o).subarray(0,4).readUInt32BE(0)%t.bits,c=Math.floor(s/24),p=yd.Buffer.from(t.bitVector.slice(c*4,c*4+4),"base64"),d=s%24,m=Math.floor(d/8),f=d%8;if(!(p[m]&1<<7-f))return!1}return!0}i(Xk,"lookup");var rq=typeof self<"u"&&self.fetch?self.fetch:Tw.default;function wd(t,e,r,o){let s=new URL(o).hostname.toLowerCase().replace(/\.$/,"").split(".");for(let c=0;c<s.length-1;c++){let p=s.slice(c).join(".");if(e.includes(p)||Xk(t,p)&&!r.includes(p))return"BLOCK"}return"NONE"}i(wd,"scanDomain");var xc=D(Cw());var Dw=D(Fw());u();l();var Pw="https://blocklist.phantom.app/multichain.json",Td="https://blowfish-blocklist-proxy.phantom.app",cF="https://github.com/phantom-labs/blocklist",Ad=i((t=3)=>({retry:t,retryDelay:i(e=>Math.min(1e3*2**e,3e4),"retryDelay")}),"reactQueryExponentialBackoff"),Or={SLIPPAGE_EXCEEDED:"SLIPPAGE_EXCEEDED",INSUFFICIENT_FUNDS:"INSUFFICIENT_FUNDS",INSUFFICIENT_GAS:"INSUFFICIENT_GAS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SIMULATION_FAILED:"SIMULATION_FAILED",TRANSACTION_EXPIRED:"TRANSACTION_EXPIRED",ACCOUNT_FROZEN:"ACCOUNT_FROZEN",SIMULATION_TIMEOUT:"SIMULATION_TIMEOUT",STALE_QUOTE:"STALE_QUOTE"},Uo;(function(t){t[t.info=5]="info",t[t.error=4]="error",t[t.criticalError=3]="criticalError",t[t.alert=2]="alert",t[t.criticalAlert=1]="criticalAlert"})(Uo||(Uo={}));function uF(t){return{[Uo.criticalAlert]:"1-critical-alert",[Uo.alert]:"2-alert",[Uo.criticalError]:"3-critical-error",[Uo.error]:"4-error",[Uo.info]:"5-information"}[t]}i(uF,"scanWarningVariantToUiLevel");var lF=3,Id=6e5,pF=6e4,vq=a.object({type:a.union([a.literal("all"),a.literal("blocklist"),a.literal("whitelist"),a.literal("error"),a.literal("fuzzy"),a.literal("blowfishBloomFilter")]),result:a.boolean(),source:a.optional(a.string()),match:a.string().optional(),isSubdomainDomainWhitelisted:a.boolean().optional()}),Rq=a.object({localHash:a.any(),cursor:a.any()}),kd=a.object({bitVector:a.string(),k:a.number(),hash:a.string(),bits:a.number(),salt:a.string()}),Bw=a.union([a.object({bloomFilter:kd,bloomFilterHash:a.string(),recentlyAdded:a.array(a.string()),recentlyRemoved:a.array(a.string()),nextCursor:a.string()}),a.object({bloomFilter:kd.optional(),bloomFilterHash:a.optional(a.string()),recentlyAdded:a.array(a.string()),recentlyRemoved:a.array(a.string()),nextCursor:a.string()})]),Nw=a.object({bloomFilter:kd,lastUpdated:a.number()}).nullish(),Lw=a.object({recentlyAdded:a.array(a.string()),recentlyRemoved:a.array(a.string()),lastUpdated:a.number().optional()}).nullish(),Di=class{static{i(this,"PhishingDetector")}blocklist;whitelist;fuzzylist;tolerance;constructor(e,r,o,n){this.blocklist=xd(e),this.whitelist=xd(r),this.fuzzylist=xd(o),this.tolerance=n||lF}check(e,r){if(!e)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let o=Ec(e),n=Fd(o);if(mF(n,this.whitelist)){let d=new URL(e).hostname;if(Ed(Fd(d),this.blocklist)){let f={type:"blocklist",result:!0,source:d,isSubdomainDomainWhitelisted:!0};return r.capture("blockedDomain",{data:f}),f}else return{type:"whitelist",result:!1,source:d,isSubdomainDomainWhitelisted:!0}}if(Ed(n,this.whitelist))return{type:"whitelist",result:!1,source:o,isSubdomainDomainWhitelisted:!1};if(Ed(n,this.blocklist)){let d={type:"blocklist",result:!0,source:o,isSubdomainDomainWhitelisted:!1};return r.capture("blockedDomain",{data:d}),d}if(this.tolerance>0){let d=_w(n);d=d.replace("www.","");let m=this.fuzzylist.find(f=>{let g=_w(f);return Dw.default.get(d,g)<=this.tolerance});if(m)return{type:"fuzzy",result:!0,match:dF(m),source:o,isSubdomainDomainWhitelisted:!1}}return{type:"all",result:!1,source:o,isSubdomainDomainWhitelisted:!1}}},Ec=i(t=>{let e=new URL(t).hostname.replace(/\.$/,"").split(".");return e.slice(0).slice(-(e.length===4?3:2)).join(".")},"removeSubdomainFromDomain"),xd=i(t=>t.map(Fd),"processDomainList"),Fd=i(t=>t.split(".").reverse(),"domainToParts"),dF=i(t=>t.slice().reverse().join("."),"domainPartsToDomain"),_w=i(t=>t.slice(1).reverse().join("."),"domainPartsToFuzzyForm"),Ed=i((t,e)=>e.some(r=>r.length>t.length?!1:r.every((o,n)=>t[n]===o)),"matchPartsAgainstList"),mF=i((t,e)=>e.some(r=>r[0]===t[0]&&r[1]===t[1]&&r[2]==="*"),"matchWhitelistedHostingDomain"),fF=i(async t=>{let e=(0,xc.getBlocklist)(),r=await t.get(ye.CachedBlocklistDiff),o=null;try{o=JSON.parse(`${r}`)}catch(n){k.captureError(new Error(`Error parsing blocklist diff: ${n?.message}`),_.Generic)}if(o&&o.expiresAt&&o.expiresAt>Date.now())return new Di(e.blocklist.concat(o.blocklist),e.whitelist.concat(o.whitelist),e.fuzzylist.concat(o.fuzzylist));{let n={},s=(0,xc.getVersion)();o&&(n.lastContentHash=`${o.contentHash}`),s&&(n.localBlocklistVersion=`${s}`);let c=await z.headers(n).noBearer().get(Pw);if(c.status===200){let p=c.data;return p.expiresAt=Date.now()+Id,t.set(ye.CachedBlocklistDiff,JSON.stringify(p)),new Di(e.blocklist.concat(p.blocklist),e.whitelist.concat(p.whitelist),e.fuzzylist.concat(p.fuzzylist))}else{if(c.status===304)return o.expiresAt=Date.now()+Id,t.set(ye.CachedBlocklistDiff,JSON.stringify(o)),new Di(e.blocklist.concat(o.blocklist),e.whitelist.concat(o.whitelist),e.fuzzylist.concat(o.fuzzylist));throw new Error("Invalid response from blocklist")}}},"updateLocalBlocklist"),Pd=i(async(t,e,r)=>{let o,n;try{o=await qt.isFeatureEnabledAsync("kill-blowfish-blocklist-cursor"),n=await qt.isFeatureEnabledAsync("kill-previous-blocklist")}catch{o=!1,n=!1}let s;try{if(n)return o?Rw(r,t,e):vw(r,t,e);{s=await fF(t);let c=s.check(r,e);return c.type==="all"?o?Rw(r,t,e):vw(r,t,e):c}}catch{return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1}}},"detectPhishing"),vw=i(async(t,e,r)=>{if(!t)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let o=Ec(t),n=await e.getAll([ye.CachedBloomFilter,ye.CachedBloomFilterHash,ye.CachedScanDataRecents,ye.CachedScanDataCursor]),s=n[ye.CachedBloomFilter]??null,c=n[ye.CachedBloomFilterHash]??null,p=n[ye.CachedScanDataCursor]??null,d=n[ye.CachedScanDataRecents]??null,m=null,f={recentlyAdded:[],recentlyRemoved:[],lastUpdated:0},g=null;if(s){let w=Nw.safeParse(s);w.success?m=w.data:await Cd(e)}if(d){let w=Lw.safeParse(d);w.success?f=w.data:await Cd(e)}if(p){let S=a.string().safeParse(p);S.success?g=S.data:await Cd(e)}if(!f||f.lastUpdated==null||Date.now()>f.lastUpdated+pF){let w={localHash:c,cursor:g},S=await z.noBearer().post(Td,w);if(S.status!==200)return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let b=S.data,T,x=Bw.safeParse(b);if(x.success)T=x.data;else return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let C=[],E=[],P=typeof c=="string"&&T.bloomFilterHash?c!==T.bloomFilterHash:!1;f!=null&&!P&&(C=f.recentlyAdded,E=f.recentlyRemoved),C=C.concat(T.recentlyAdded),E=E.concat(T.recentlyRemoved),C=C.filter(G=>T.recentlyRemoved.indexOf(G)<0),E=E.filter(G=>T.recentlyAdded.indexOf(G)<0);let M={recentlyAdded:C,recentlyRemoved:E,lastUpdated:Date.now()};if(await e.set(ye.CachedScanDataRecents,M),f=M,T.nextCursor!==g&&await e.set(ye.CachedScanDataCursor,T.nextCursor),T.bloomFilter!=null){let G={bloomFilter:T.bloomFilter,lastUpdated:Date.now()};await Promise.all([e.set(ye.CachedBloomFilter,G),e.set(ye.CachedBloomFilterHash,T.bloomFilterHash)]),m=G}}if(!m)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let y=wd(m.bloomFilter,f.recentlyAdded,f.recentlyRemoved,t);if(y===ss.BLOCK){let w={result:!0,source:o,type:"blowfishBloomFilter"};return r.capture("blockedDomain",{data:w}),w}else if(y===ss.NONE)return{result:!1,type:"all",isSubdomainDomainWhitelisted:!1};return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1}},"checkBlowfishBlocklist");async function Cd(t){await t.remove([ye.CachedBloomFilter,ye.CachedBloomFilterHash,ye.CachedScanDataRecents,ye.CachedScanDataCursor])}i(Cd,"resetState");var Rw=i(async(t,e,r)=>{if(!t)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let o=Ec(t),n=await e.getAll([ye.CachedBloomFilter,ye.CachedBloomFilterHash,ye.CachedScanDataRecents]),s=n[ye.CachedBloomFilter]??null,c=n[ye.CachedBloomFilterHash]??null,p=n[ye.CachedScanDataRecents]??null,d=null,m={recentlyAdded:[],recentlyRemoved:[],lastUpdated:0};if(s){let g=Nw.safeParse(s);g.success?d=g.data:await e.remove([ye.CachedBloomFilter,ye.CachedBloomFilterHash,ye.CachedScanDataRecents])}if(p){let g=Lw.safeParse(p);g.success?m=g.data:await e.remove([ye.CachedBloomFilter,ye.CachedBloomFilterHash,ye.CachedScanDataRecents])}if(!m||m.lastUpdated==null||Date.now()>m.lastUpdated+Id){let g={localHash:c},y=await z.noBearer().post(Td,g);if(y.status!==200)return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let w=y.data,S,b=Bw.safeParse(w);if(b.success)S=b.data;else return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let T={recentlyAdded:S.recentlyAdded,recentlyRemoved:S.recentlyRemoved,lastUpdated:Date.now()};if(await e.set(ye.CachedScanDataRecents,T),m=T,S.bloomFilter!=null){let x={bloomFilter:S.bloomFilter,lastUpdated:Date.now()};await Promise.all([e.set(ye.CachedBloomFilter,x),e.set(ye.CachedBloomFilterHash,S.bloomFilterHash)]),d=x}}if(!d)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let f=wd(d.bloomFilter,m.recentlyAdded,m.recentlyRemoved,t);if(f===ss.BLOCK){let g={result:!0,source:o,type:"blowfishBloomFilter"};return r.capture("blockedDomain",{data:g}),g}else if(f===ss.NONE)return{result:!1,type:"all",isSubdomainDomainWhitelisted:!1};return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1}},"checkBlowfishBlocklistOld");u();l();u();l();var hF=i(t=>t/1e8,"satsToBTC");u();l();u();l();var un;(function(t){t.Plus="PLUS",t.Minus="MINUS",t.Equal="EQUAL"})(un||(un={}));var _d;(function(t){t.fungible="fungible",t.collectible="collectible",t.native="native",t.unknown="unknown"})(_d||(_d={}));var vd;(function(t){t.approval="approval",t.revokal="revokal",t.transfer="transfer",t.mint="mint",t.unknown="unknown"})(vd||(vd={}));var as;(function(t){t.Green="GREEN",t.Red="RED",t.White="WHITE"})(as||(as={}));var Cc={[as.Green]:"spotPositive",[as.Red]:"spotNegative",[as.White]:"textBase"};function gF(t){switch(t){case un.Plus:return Cc.GREEN;case un.Minus:return Cc.RED;case un.Equal:return Cc.WHITE;default:return Cc.WHITE}}i(gF,"getColorForStateChangeSign");function yF(t){let e=t?.advancedDetails&&"safeguard"in t.advancedDetails?t?.advancedDetails?.safeguard:void 0;if(e?.recommended&&!e?.shouldBundle&&!e.error&&!e.verifyError&&e?.transactions&&e.transactions.length>0)return e.transactions}i(yF,"extractSafeguardTransactions");function Mw(t,e){if(t.params&&"safeguard"in t.params&&t.params.safeguard&&e?.advancedDetails&&"safeguard"in e.advancedDetails&&e.advancedDetails.safeguard?.transactions){let r=e.advancedDetails.safeguard;if(r.error)return r.error;let o=t.params.transactions,n=r.transactions;if(n){let s;try{jy(o,n)}catch(c){c instanceof rs?s=c:c instanceof Error?s=rs.createUnknownError(c.message):s=rs.createUnknownError("Non error type",c)}if(s)return e.advancedDetails.safeguard.verifyError=s,s}}}i(Mw,"processSafeguardErrors");function Uw(t){if(t.advancedDetails&&"requestId"in t.advancedDetails)return t.advancedDetails.requestId}i(Uw,"extractRequestId");u();l();var Rd=i(async(t,e,r)=>{let o=`/simulation/v1?language=${t}`,n=await z.api().post(o,{...r,chainId:r.networkID,appVersion:Re,platform:Yt,deviceId:e});if(!te(n))throw new Error("Failed to scan message");return n.data},"getScanMessage"),Bi=i(async(t,e,r)=>{let o=`/simulation/v1?language=${t}`,n={...r.params,...r.params&&"safeguard"in r.params?{safeguard:{...r.params.safeguard,lighthouseProgramId:Gy}}:{}};try{let s=await z.api().post(o,{...r,chainId:r.networkID,params:n,metadata:r.metadata,appVersion:Re,platform:Yt,deviceId:e});if(!te(s)){let d=await wF(s),m=`Failed to scan transaction: ${s.status} ${d}`;throw new Error(m)}let c=s.data,p=Mw(r,c);if(p instanceof rs){let d=Uw(c);k.captureMessage(`Verify error ${d??""}: ${p.message}`,_.Safeguard)}return c}catch(s){throw k.captureError(s,_.Simulation),s}},"getScanTransaction");async function wF(t){let{data:e,blob:r}=t;if(typeof e=="string")return e;if(e&&typeof e=="object")return JSON.stringify(e);try{return await r?.text()??"Unknown error"}catch{return"Unknown error"}}i(wF,"getResponseErrorMessage");var iz=a.union([a.literal("signTransaction"),a.literal("signAllTransactions"),a.literal("signAndSendTransaction"),a.literal("signAndSendAllTransactions")]);u();l();var Ow=a.enum(["Native","Fungible","SemiFungible","NonFungible","Unknown"]),so=a.object({id:a.string(),displayName:a.string().optional(),logoURI:a.union([a.string(),a.null()]).optional(),tokenType:Ow,decimals:a.number().optional(),symbol:a.string().optional(),isSpam:a.boolean().optional()}),qw=a.object({id:to,displayName:a.string(),logoURI:a.union([a.string(),a.null()]).optional()}),Ic=a.object({token:so,amount:a.string(),to,from:to}),Dd=a.literal("UNCLASSIFIED_APP_INTERACTION"),Bd=a.literal("TOKEN_SEND"),Nd=a.literal("TOKEN_BURN"),Ld=a.literal("TOKEN_SWAP"),Md=a.literal("TOKEN_UNWRAP"),Ud=a.literal("WITHDRAW_STAKE"),Od=a.literal("DEACTIVATE_STAKE"),qd=a.literal("STAKE"),zd=a.literal("COLLECTIBLE_LIST"),Qd=a.literal("COLLECTIBLE_BUY_ITEM"),Hd=a.literal("COLLECTIBLE_CANCEL_BID"),Gd=a.literal("COLLECTIBLE_BID_ITEM"),jd=a.literal("COLLECTIBLE_UNLIST"),$d=a.literal("COLLECTIBLE_SELL_ITEM"),Kd=a.literal("CANCEL_TX"),Vd=a.literal("TOKEN_APPROVAL"),Wd=a.literal("CANCEL_ORDER"),Zd=a.literal("COLLECTION_APPROVAL"),Yd=a.literal("BRIDGE_INIT"),SF=a.union([Dd,Bd,Nd,Ld,Md,Ud,Od,qd,zd,Qd,Hd,Gd,jd,$d,Kd,Vd,Wd,Zd,Yd]),zw=a.object({transactionType:Dd,balanceChanges:a.array(Ic),dapp:a.union([Mr,a.null()]).optional()}),Qw=a.object({transactionType:Bd,balanceChanges:a.array(Ic).nonempty(),dapp:a.union([Mr,a.null()]).optional()}),Hw=a.object({transactionType:Nd,dapp:a.union([Mr,a.null()]).optional(),token:so,amount:a.string()}),Gw=a.object({transactionType:Ld,dapp:a.union([Mr,a.null()]).optional(),receiveToken:so,sendToken:so,receiveAmount:a.string(),sendAmount:a.string()}),jw=a.object({transactionType:Md,token:so,amount:a.string()}),$w=a.object({transactionType:Ud,stakeAccount:to,amount:a.string()}),Kw=a.object({transactionType:Od,stakeAccount:to,amount:a.string()}),Vw=a.object({transactionType:qd,stakeAccount:to,amount:a.string(),validatorName:a.string().optional(),validatorWebsite:a.string().optional(),keybaseUsername:a.string().optional()}),Ww=a.object({transactionType:Kd}),cs=a.object({dapp:a.union([Mr,a.null()]),itemAmount:a.string().optional(),item:so,forAmount:a.string(),forAsset:so,listingUrl:a.string().optional()}),Zw=cs.merge(a.object({transactionType:zd})),Yw=cs.merge(a.object({transactionType:Qd})),Xw=cs.merge(a.object({transactionType:Hd})),Jw=cs.merge(a.object({transactionType:Gd})),eS=cs.merge(a.object({transactionType:jd})),tS=cs.merge(a.object({transactionType:$d})),rS=a.object({transactionType:Vd,dapp:a.union([Mr,a.null()]).optional(),token:so,value:a.string().optional(),isApproved:a.boolean()}),oS=a.object({transactionType:Wd,dapp:a.union([Mr,a.null()]).optional(),orderId:a.string()}),nS=a.object({transactionType:Zd,collection:qw,dapp:a.union([Mr,a.null()]).optional(),isApproved:a.boolean()}),sS=a.object({transactionType:Yd,dapp:a.union([Mr,a.null()]).optional(),balanceChanges:a.array(Ic).nonempty(),explorerUrl:a.string().optional()}),iS=a.enum(["success","failed"]),aS=a.object({networkFee:a.string().optional(),networkFeePayer:a.string().optional(),status:iS,errorMessage:a.union([a.string(),a.null()]),blockNumber:a.string(),chainId:Tr,transactionId:a.string()}),kc=a.object({timestamp:a.number(),owner:to,id:to,interactionData:a.union([zw,Qw,Hw,Gw,jw,$w,Kw,Vw,Zw,Yw,Xw,Jw,eS,tS,Ww,rS,oS,nS,sS]),chainMeta:aS}),_t=i(t=>t.split("/")[1]?.split(":").slice(1).join(":"),"extractAddressfromBri");u();l();var ln=i(t=>{switch(t){case"SemiFungible":case"NonFungible":return!0;default:return!1}},"isCollectibleTokenType"),Xd=i((t,e)=>{let r=_t(t.to),o=_t(t.from),n=e.some(c=>c.address.toLowerCase()===r.toLowerCase()),s=e.some(c=>c.address.toLowerCase()===o.toLowerCase());return n&&!s},"isReceiveTransaction");u();l();var Jd=D(Ke());u();l();var cS=i(({interactionData:t,isError:e,selectedAccountAddresses:r,getKnownAddressLabel:o,start:n,networkID:s})=>{let p=t.balanceChanges[0],{token:{symbol:d,displayName:m,tokenType:f,decimals:g},amount:y}=p,w=Xd(p,r),S=ln(f),T=bF({isCollectible:S,sign:w?"+":"-",amount:y,decimals:g,tokenSymbol:d,tokenType:f,isError:e});if(w){let E=_t(p.from),P=ud(E,void 0,o(E,s));return{topLeft:{text:`${v.t("transactionsReceived")} ${S?m||v.t("richTransactionDetailUnknownNFT"):""}`},topRight:{text:`${T}`,color:"spotPositive"},bottomLeft:{text:v.t("transactionsFromParagraphInterpolated",{from:P,defaultValue:`From ${P}`})},start:n}}let x=_t(p.to),C=ud(x,void 0,o(x,s));return{topLeft:{text:e?v.t("transactionsSendFailed"):`${v.t("transactionsSent")} ${S?m||v.t("richTransactionDetailUnknownNFT"):""}`},topRight:{text:`${T}`,color:"textBase"},bottomLeft:{text:v.t("transactionsToParagraphInterpolated",{to:C,defaultValue:`To ${C}`})},start:n}},"tokenSendLabel");function bF({isCollectible:t,sign:e,amount:r,decimals:o,tokenSymbol:n,tokenType:s,isError:c}){return c||o===void 0||s==="NonFungible"?"":t?`${e}${zt(r,o)}`:`${e}${zt(r,o)}${n?` ${Lr(n,6)}`:""}`}i(bF,"getValueDisplay");var TF=["So11111111111111111111111111111111111111112","501"],AF=i((t,e,r,o,n)=>{let{interactionData:s,chainMeta:c}=t,{transactionType:p}=s,d=c.status==="failed",m=c.chainId,f=I.getTokenSymbol(m),g=I.getTokenDecimals(m),y=e("historyUnknownDappName"),w=(0,Jd.jsx)(r,{activityItem:t,size:"small",isDetailViewOrSvg:!1});switch(p){case"TOKEN_SEND":return cS({interactionData:s,isError:d,selectedAccountAddresses:n,getKnownAddressLabel:o,start:w,networkID:m});case"TOKEN_BURN":{let{amount:S,token:b}=s,T="";return b.displayName?S==="1"?T=b.displayName:T=`${b.displayName} (${S})`:T=e("richTransactionDetailUnknownNFT"),{topLeft:{text:d?`${e("transactionsFailedBurn")}`:`${e("transactionsBurned")}`},bottomLeft:{text:T},start:w}}case"TOKEN_UNWRAP":{let{amount:S,token:b}=s;return{topLeft:{text:d?`${e("transactionsUnwrappedFailed")}`:`${e("transactionsUnwrapped")}`},topRight:{text:d?"":`${zt(S,b.decimals??0)} ${b.symbol}`,color:"textBase"},start:w}}case"TOKEN_SWAP":{let{receiveAmount:S,receiveToken:b,sendAmount:T,sendToken:x,dapp:C}=s,E=C?C.displayName:e("historyUnknownDappName"),P=Fi(_t(x.id)||""),M=Fi(_t(b.id)||""),G="";!d&&b.decimals!==void 0&&(G=`+${zt(S,b.decimals)} ${Lr(b.symbol||M,6)}`);let R="";return!d&&x.decimals!==void 0&&(R=`-${zt(T,x.decimals)} ${Lr(x.symbol||P,6)}`),{topLeft:{text:e(d?"transactionsFailedSwap":"transactionsSwapped")},topRight:{text:G,color:"spotPositive"},bottomLeft:{text:E},bottomRight:{text:R,color:"textBase"},start:w}}case"BRIDGE_INIT":{let S=s.dapp?s.dapp.displayName:y,T=s.balanceChanges[0],{token:{symbol:x,decimals:C},amount:E}=T,P=x?` ${Lr(x,6)}`:"";if(!d&&C!==void 0){let M=`-${zt(E,C)}${P}`;return{topLeft:{text:d?e("transactionBridgeInitiatedFailed"):`${e("transactionBridgeInitiated")}`},bottomLeft:{text:S},topRight:{text:`${M}`,color:"textBase"},start:w}}return{topLeft:{text:d?e("transactionBridgeInitiatedFailed"):`${e("transactionBridgeInitiated")}`},bottomLeft:{text:S},start:w}}case"WITHDRAW_STAKE":{let{amount:S,stakeAccount:b}=s,T=_t(b),x=I.getTokenSymbol(m);return{topLeft:{text:e(d?"transactionsWithdrawStakeFailed":"transactionsWithdrawStake")},topRight:{text:d?"":`${zt(S,g)} ${Lr(x,6)}`,color:"textBase"},bottomLeft:{text:Vn(T,4)},start:w}}case"DEACTIVATE_STAKE":{let{stakeAccount:S}=s,b=_t(S);return{topLeft:{text:e(d?"transactionsDeactivateStakeFailed":"transactionsDeactivateStake")},bottomLeft:{text:Vn(b,4)},start:w}}case"STAKE":{let{amount:S,stakeAccount:b,validatorName:T}=s,x=_t(b);return{topLeft:{text:e(d?"transactionsStakedFailed":"transactionsStaked")},topRight:{text:d?"":`${zt(S,g)} ${Lr(f,6)}`,color:"textBase"},bottomLeft:{text:T||Vn(x,4)},start:w}}case"COLLECTIBLE_LIST":{let{dapp:S,item:b}=s,T=S?S.displayName:e("historyUnknownDappName"),x=b.displayName||e("richTransactionDetailUnknownNFT");return{topLeft:{text:d?e("transactionsListedFailed"):e("transactionsListedInterpolated",{name:x})},bottomLeft:{text:T},start:w}}case"COLLECTIBLE_BUY_ITEM":{let{dapp:S,itemAmount:b,item:T,forAsset:x,forAmount:C}=s,E=S?S.displayName:e("historyUnknownDappName"),P=uS(C,x.decimals,Lr(x.symbol||"",6)),M=T.symbol||Fi(_t(T.id)),G=b&&T.tokenType==="SemiFungible"?`+${b} ${M}`:`+${M}`;return{topLeft:{text:e(d?"transactionsBuyFailed":"transactionsBoughtCollectible")},topRight:{text:d?"":G,color:"spotPositive"},bottomRight:{text:d?"":`${P}`,color:"textBase"},bottomLeft:{text:E},start:w}}case"COLLECTIBLE_CANCEL_BID":{let{dapp:S,item:b}=s,T=S?S.displayName:e("historyUnknownDappName"),x=b.displayName||e("richTransactionDetailUnknownNFT");return{topLeft:{text:d?e("transactionsCancelBidOnFailed"):e("transactionsCancelBidOnInterpolated",{name:x})},bottomLeft:{text:T},start:w}}case"COLLECTIBLE_BID_ITEM":{let{dapp:S,item:b}=s,T=S?S.displayName:e("historyUnknownDappName"),x=b.displayName||e("richTransactionDetailUnknownNFT");return{topLeft:{text:d?e("transactionsBidFailed"):e("transactionsBidOnInterpolated",{name:x})},bottomLeft:{text:T},start:w}}case"COLLECTIBLE_UNLIST":{let{dapp:S,item:b}=s,T=S?S.displayName:e("historyUnknownDappName"),x=b.displayName||e("richTransactionDetailUnknownNFT");return{topLeft:{text:d?e("transactionsUnlistedFailed"):e("transactionsUnlistedInterpolated",{name:x})},bottomLeft:{text:T},start:w}}case"COLLECTIBLE_SELL_ITEM":{let{dapp:S,itemAmount:b,item:T,forAsset:x,forAmount:C}=s,E=S?S.displayName:e("historyUnknownDappName"),P=x.decimals!==void 0?`+${zt(C,x.decimals)} ${Lr(x.symbol||"",6)}`:e("transactionsUnknownAmount"),M=T.symbol||Fi(_t(T.id)),G=b&&T.tokenType==="SemiFungible"?`-${b} ${M}`:`-${M}`;return{topLeft:{text:e(d?"transactionsSoldFailed":"transactionsSoldCollectible")},topRight:{text:d?"":`${P}`,color:"spotPositive"},bottomRight:{text:d?"":G,color:"textBase"},bottomLeft:{text:E},start:w}}case"CANCEL_TX":return{topLeft:{text:e(d?"transactionCancelledFailed":"transactionCancelled")},start:w};case"TOKEN_APPROVAL":{let{dapp:S,token:b,isApproved:T}=s,x=ln(b.tokenType)?b.displayName:b.symbol,C;return d?T?ln(b.tokenType)?C=e("transactionApproveTokenFailed",{tokenSymbol:x}):C=e("transactionApprovalFailed"):ln(b.tokenType)?C=e("transactionRevokeApproveTokenFailed",{tokenSymbol:x}):C=e("transactionRevokeFailed"):T?C=e("transactionApproveToken",{tokenSymbol:x}):C=e("transactionRevokeApproveToken",{tokenSymbol:x}),{topLeft:{text:C},bottomLeft:{text:S?S.displayName:y,color:"textIncidental"},start:w}}case"COLLECTION_APPROVAL":{let{collection:S,isApproved:b,dapp:T}=s,x=S.displayName,C;return d?b?C=e("transactionApproveTokenFailed",{tokenSymbol:x}):C=e("transactionRevokeApproveTokenFailed",{tokenSymbol:x}):b?C=e("transactionApproveToken",{tokenSymbol:x}):C=e("transactionRevokeApproveToken",{tokenSymbol:x}),{topLeft:{text:C},bottomLeft:{text:T?T.displayName:y,color:"textIncidental"},start:w}}case"CANCEL_ORDER":{let{dapp:S}=s;return{topLeft:{text:e(d?"transactionCancelOrderFailed":"transactionCancelOrder")},bottomLeft:{text:S?.displayName||e("historyUnknownDappName"),color:"textIncidental"},start:w}}case"UNCLASSIFIED_APP_INTERACTION":{let{dapp:S}=s,b=S?S.displayName:y;return{topLeft:{text:e(d?"transactionsFailedAppInteraction":"transactionsAppInteraction")},bottomLeft:{text:b},start:w}}}},"createActivityRowLabels"),xF=i((t,e)=>{let{display:r,type:o}=t,{topLeft:n,topRight:s,bottomLeft:c,bottomRight:p}=r.summary,d=(0,Jd.jsx)(e,{logoUri:r.summary.logoUri,pendingTransactionType:o,size:"small"});return{topLeft:n,topRight:s,bottomLeft:c,bottomRight:p,start:d}},"createPendingTransactionRowLabels"),em=i((t,e,r)=>{let o=(t??[]).map(Dy);if(e){let n=o.find(s=>s.chainId===e)?.address;if(n){let s={chainId:e,address:n};r&&(s.filters=[{type:"token",value:r}]),o=[s]}}return o},"getAccountsWithFilter"),tm=i(t=>{if(!t)return;let e=J(t);if(e.resourceType!==V.nativeToken)return t.type===ae.SPL?t.data.splTokenAccountPubkey:e.address},"getTokenActivityFilterId"),EF=i((t,e)=>{let r=_t(t.id);return TF.includes(r)&&(t.tokenType="Native"),t.tokenType==="Native"?{chainId:e,slip44:I.getSlip44(e),resourceType:V.nativeToken}:{chainId:e,address:r,resourceType:V.address}},"getFungibleCaip19FromToken"),uS=i((t,e,r)=>{if(!t||!e)return v.t("transactionsUnknownAmount");let o=xe(t,e),n=o.abs(),s=o.isZero()?"":o.isPositive()?"-":"+",c=Er(n);return`${s}${c} ${r}`},"formatPaidAmount");u();l();var Ni=D(O());var CF=a.object({orderIds:a.array(a.object({bytesValue:a.string(),bytesArrayValue:a.string(),stringValue:a.string()}))}),IF=i(async(t,e)=>{if(e==="LI.FI")return{label:v.t("transactionBridgeStatusLink",{dappName:"LI.FI"}),value:`https://explorer.li.fi/tx/${t}`};if(e==="deBridge")try{let r=await z.get(`https://stats-api.dln.trade/api/Transaction/${t}/orderIds`),o=CF.safeParse(r.data);if(!o.success){k.captureError(new Error("Failed to parse deBridge response"),_.History);return}let n=o.data.orderIds[0]?.stringValue;if(!n){k.captureError(new Error("No orderId found in deBridge response"),_.History);return}return{label:v.t("transactionBridgeStatusLink",{dappName:"DeBridge"}),value:`https://app.debridge.finance/order?orderId=${n}`}}catch(r){k.captureError(new Error(`Could not fetch bridge explorer url: ${r}`),_.History);return}},"getBridgeExplorerUrl"),kF=i((t,e)=>{let[r,o]=(0,Ni.useState)(),[n,s]=(0,Ni.useState)(!1);return(0,Ni.useEffect)(()=>{t&&e&&i(async()=>{s(!0);try{let p=await IF(t,e);o(p)}finally{s(!1)}},"fetchBridgeUrl")()},[t,e]),{bridgeUrl:r,isLoading:n}},"useBridgeExplorerUrl");u();l();u();l();u();l();var Qt={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!0};var lS={...Qt};u();l();var pS={...Qt};u();l();var dS={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};u();l();var mS={...Qt,showTimeToMineRowInPendingTransactionDetail:!0};u();l();var fS={...Qt};u();l();var hS={...Qt};u();l();var gS={...Qt};u();l();var yS={...Qt};u();l();var wS={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};u();l();var SS={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};var FF=new $n({[ce.Solana]:wS,[ce.Ethereum]:mS,[ce.Polygon]:yS,[ce.Monad]:gS,[ce.Base]:pS,[ce.Arbitrum]:lS,[ce.Bitcoin]:dS,[ce.Sui]:SS,[ce.Hypercore]:fS,[ce.Hyperevm]:hS}),bS=jn(FF);u();l();u();l();u();l();var kS=D(O());u();l();var CS=D(O());u();l();var PF=10,_F="/history/v2",Li=class extends Error{static{i(this,"ActivityItemsFetchCacheBustError")}message="406: Cache bust!"},Fc=class extends Error{static{i(this,"ActivityItemsFetchResponseMalformed")}message="Server response malformed."},rm=class extends Error{static{i(this,"ActivityItemsFetchServerError")}},om=class extends Error{static{i(this,"ActivityItemsFetchClientError")}},TS=a.object({next:a.union([a.null(),a.string()]),results:a.array(kc)}),AS=i(async t=>{let e=await z.api().retry(3,2e3).post(`${_F}`,t);if(e.status===406)throw new Li;if(e.status>=400&&e.status<500)throw new om(`FetchActivityItem: Status code: ${e.status}`);if(e.status>=500)throw new rm(`FetchActivityItem: Status code: ${e.status}`);return e.data},"_fetch"),xS=i(t=>!Array.isArray(t.results)||typeof t.next!="string"&&t.next!==null,"isResponseMalformed"),nm=i(async t=>{let e=await AS(t);if(xS(e))throw new Fc;for(;e.results?.length<PF&&e.next;){if(xS(e))throw new Fc;let r=await AS({next:e.next,isSpam:t.isSpam});e.next=r.next,e.results=[...e.results,...r.results]}try{return TS.parse(e)}catch(r){let o=r,n=[],s=o.issues;for(let d=0;d<s.length;++d){let m=s[d].path;if(m[0]!=="results")throw k.captureError(o,_.History),o;let f=m[1];if(typeof f!="number")throw k.captureError(o,_.History),o;n.push(f)}n.sort(function(d,m){return m-d});let c=n.map(d=>e.results[d]).map(d=>d.interactionData?.transactionType||""),p=[];for(let d=0;d<n.length;++d){let m=n[d],f=e.results[m],g={timestamp:f?.timestamp,owner:f?.owner,id:f?.id,chainMeta:f?.chainMeta,interactionData:{transactionType:"UNCLASSIFIED_APP_INTERACTION",balanceChanges:[]}};try{kc.parse(g),e.results[m]=g,p.push(m)}catch{}}for(let d=0;d<n.length;++d){let m=n[d];p.indexOf(m)===-1&&e.results.splice(m,1)}n.length&&console.error(`Removed history items, ${c.join(",")}`);try{return TS.parse(e)}catch(d){let m=d;throw k.captureError(m,_.History),m}}},"fetchActivityItems");var vF=3e5,sm="fetch-infinite-activity-items",IS=i(({accounts:t,isSpam:e})=>[sm,t,e],"infiniteActivityItemsQueryKey"),RF=i((t,e)=>{t.removeQueries({queryKey:e})},"bustCache"),im=i(({accounts:t,isSpam:e})=>{let r=qe();(0,CS.useEffect)(()=>()=>{r.cancelQueries({queryKey:[sm],exact:!1})},[r]);let o=IS({accounts:t,isSpam:e});return qg({queryKey:o,queryFn:i(async({pageParam:s})=>{try{let c;s&&s!==""?c=await nm({next:s,isSpam:e}):c=await nm({accounts:t||[],isSpam:e});let p=c.results.map(d=>(d.interactionData.transactionType==="TOKEN_SEND"&&d.interactionData.balanceChanges.sort(DF(t)),d));return{...c,results:p}}catch(c){throw c instanceof Li&&RF(r,o),k.captureError(c,_.History),c}},"queryFn"),getNextPageParam:i(s=>s?.next,"getNextPageParam"),staleTime:vF,retry:!1,enabled:!!t?.length&&t.every(s=>!I.isLocalNetworkID(s.chainId)),initialPageParam:""})},"useFetchInfiniteActivityItems");function DF(t){return(e,r)=>{let o=ES(e,t),n=ES(r,t);return o?-1:n?1:0}}i(DF,"balanceChangeSort");function ES(t,e){let r=t.to.split("/address:")[1],o=t.from.split("/address:")[1];return e.some(n=>n.address.toLowerCase()===r.toLowerCase()||n.address.toLowerCase()===o.toLowerCase())}i(ES,"findRelevantTransfers");var BF=i(({fungible:t,isSpam:e=!1})=>{let{data:r=Gg,status:o}=iy(),n=r.isDeveloperMode,s=tm(t),{data:c}=fy({address:t?.data.walletAddress,networkID:t?.data.chain.id}),p=(0,kS.useMemo)(()=>em(c?[c]:[],t?.data.chain.id,s),[c,t?.data.chain.id,s]),d=im({accounts:p,isSpam:e}),m=d.isPending||o==="pending";return{activityItemsData:d,isLoadingHistory:m,isDeveloperMode:n}},"useFungibleActivityByFungible");u();l();u();l();var ur="Auto";var Qe={buyFungible:void 0,buyUsdValue:void 0,sellFungible:void 0,sellUsdValue:void 0,sellAmount:"",uiSellAmountCryptoInput:"",amountType:"sell",quoteResponse:void 0,selectedProviderIndex:0,selectedBaseProvider:ur,gasEstimation:{isFetching:!1,estimate:void 0,estimateWithBuffer:void 0},hasNoRoutes:!1,isFetchingQuote:!1,error:null,searchQuery:"",numSearchResults:0,primaryCurrency:"crypto",uiSellAmountLocalFiatInput:"",uiBuyAmountCryptoInput:"",uiBuyAmountLocalFiatInput:"",canInputFiatSellAmount:!1,swapFilter:void 0},$=ct(t=>({...Qe,resetQuote:i(()=>t({quoteResponse:Qe.quoteResponse,isFetchingQuote:Qe.isFetchingQuote,hasNoRoutes:Qe.hasNoRoutes,selectedProviderIndex:Qe.selectedProviderIndex,error:Qe.error,uiSellAmountLocalFiatInput:Qe.uiSellAmountLocalFiatInput,selectedBaseProvider:Qe.selectedBaseProvider}),"resetQuote"),resetSwapper:i(()=>t({quoteResponse:Qe.quoteResponse,gasEstimation:Qe.gasEstimation,error:Qe.error,sellAmount:"",uiSellAmountCryptoInput:"",uiBuyAmountCryptoInput:Qe.uiBuyAmountCryptoInput,swapFilter:Qe.swapFilter,selectedBaseProvider:Qe.selectedBaseProvider,selectedProviderIndex:Qe.selectedProviderIndex}),"resetSwapper"),setBuyFungible:i(e=>t({buyFungible:e}),"setBuyFungible"),setBuyUsdValue:i(e=>t({buyUsdValue:e}),"setBuyUsdValue"),setHasNoRoutes:i(e=>t({hasNoRoutes:e}),"setHasNoRoutes"),setIsFetchingQuote:i(e=>t({isFetchingQuote:e}),"setIsFetchingQuote"),setQuoteResponse:i(e=>t({quoteResponse:e,hasNoRoutes:!1}),"setQuoteResponse"),setSelectedProviderIndex:i(e=>t({selectedProviderIndex:e}),"setSelectedProviderIndex"),setSelectedBaseProvider:i(e=>t({selectedBaseProvider:e}),"setSelectedBaseProvider"),setGasEstimation:i(({estimate:e,estimateWithBuffer:r,isFetching:o})=>t(n=>({gasEstimation:{...n.gasEstimation,...e!==void 0&&{estimate:e},...r!==void 0&&{estimateWithBuffer:r},...o!==void 0&&{isFetching:o}}})),"setGasEstimation"),setSellAmount:i(e=>t({sellAmount:e}),"setSellAmount"),setAmountType:i(e=>t({amountType:e}),"setAmountType"),setSellUsdValue:i(e=>t({sellUsdValue:e}),"setSellUsdValue"),setSellFungible:i(e=>t({sellFungible:e}),"setSellFungible"),setUiSellAmountCryptoInput:i(e=>t({uiSellAmountCryptoInput:e}),"setUiSellAmountCryptoInput"),setError:i(e=>t({error:e}),"setError"),setSearchQuery:i(e=>t({searchQuery:e}),"setSearchQuery"),setNumSearchResults:i(e=>t({numSearchResults:e}),"setNumSearchResults"),setPrimaryCurrency:i(e=>t({primaryCurrency:e}),"setPrimaryCurrency"),setUiSellAmountLocalFiatInput:i(e=>t({uiSellAmountLocalFiatInput:e}),"setUiSellAmountLocalFiatInput"),setUiBuyAmountCryptoInput:i(e=>t({uiBuyAmountCryptoInput:e}),"setUiBuyAmountCryptoInput"),setUiBuyAmountLocalFiatInput:i(e=>t({uiBuyAmountLocalFiatInput:e}),"setUiBuyAmountLocalFiatInput"),setCanInputFiatSellAmount:i(e=>t({canInputFiatSellAmount:e}),"setCanInputFiatSellAmount"),setSwapFilter:i(e=>t({swapFilter:e}),"setSwapFilter"),switchTokensForSell:i(()=>{t(e=>{let r=e.sellFungible??e.buyFungible,o=e.buyFungible??e.sellFungible,n=e.uiBuyAmountCryptoInput,s=e.uiBuyAmountLocalFiatInput;return{sellFungible:o,buyFungible:r,uiSellAmountCryptoInput:n,uiSellAmountLocalFiatInput:s,uiBuyAmountCryptoInput:Qe.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:Qe.uiBuyAmountLocalFiatInput,sellAmount:n,swapFilter:void 0,selectedBaseProvider:e.selectedBaseProvider}})},"switchTokensForSell"),switchTokensForBuy:i(()=>{t(e=>{let r=e.sellFungible??e.buyFungible,o=e.buyFungible??e.sellFungible,n=e.uiSellAmountCryptoInput,s=e.uiSellAmountLocalFiatInput;return{sellFungible:o,buyFungible:r,uiSellAmountCryptoInput:Qe.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:Qe.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:n,uiBuyAmountLocalFiatInput:s,sellAmount:n,swapFilter:void 0,selectedBaseProvider:e.selectedBaseProvider}})},"switchTokensForBuy"),resetUiAmounts:i(()=>t({uiSellAmountCryptoInput:Qe.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:Qe.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:Qe.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:Qe.uiBuyAmountLocalFiatInput,sellAmount:Qe.sellAmount,selectedBaseProvider:Qe.selectedBaseProvider}),"resetUiAmounts"),setPairAndAmount:i(({sell:e,buy:r,swapAmount:o})=>t(n=>{let s="uiSellAmountCryptoInput";return o.perspective==="sell"?n.primaryCurrency==="crypto"?s="uiSellAmountCryptoInput":s="uiSellAmountLocalFiatInput":n.primaryCurrency==="crypto"?s="uiBuyAmountCryptoInput":s="uiBuyAmountLocalFiatInput",{...n,sellFungible:e,buyFungible:r,[s]:o.amount,sellAmount:o.amount}}),"setPairAndAmount")}));u();l();var Pc=a.object({name:a.string(),message:a.string()}),PS=a.object({chainId:Tr,name:a.string(),symbol:a.string(),decimals:a.number(),logoURI:a.optional(a.string()),includesBridge:a.optional(a.boolean())}),NF=PS.extend({address:a.string(),resourceType:a.literal(V.address)}),LF=PS.extend({slip44:a.string(),resourceType:a.literal(V.nativeToken)}),sQ=a.union([NF,LF]),_S=a.object({id:a.string(),name:a.string(),logoUri:a.string()}),MF=a.union([a.enum(["network","phantom","gasless","ata","gasless_network","tips","priority_fee","prediction_fee_per_contract"]),a.string()]),UF=a.object({name:a.string(),percentage:a.number(),amount:a.number(),token:a.optional(kt),type:MF}),OF=a.object({name:a.string(),proportion:a.string()}),vS=a.object({sellAmount:a.string(),buyAmount:a.string(),rfqProps:a.optional(a.object({expireAt:a.number(),quoteId:a.string()})),analyticsContext:a.optional(a.string())}),_c=vS.extend({priceImpact:a.number(),sources:a.array(OF),fees:a.array(UF),slippageTolerance:a.optional(a.number()),baseProvider:_S}),qF=a.object({success:a.boolean(),error:a.string().optional(),data:a.object({ataFeeUSD:a.number().optional(),networkFeeUSD:a.number().optional(),totalAmountUSD:a.number().optional()}).optional()}),zF=a.enum(["sync","async"]),vc=_c.extend({transactionData:a.array(a.string()),gaslessSignature:a.optional(a.string()),cashQuoteSignerSignature:a.optional(a.string()),gaslessSwapFeeResult:a.optional(qF),executionMode:a.optional(zF)}),QF=vc,iQ=_c.extend({transactionData:a.array(a.string())}),lm=_c.extend({allowanceTarget:a.string(),exchangeAddress:a.string(),gas:a.number(),value:a.string(),transactionData:a.string()}),pm=_c.extend({transactionData:a.array(a.string())}),FS=a.object({name:a.string(),amount:a.string(),token:kt,percentage:a.string(),included:a.boolean(),amountUSD:a.optional(a.string())}),HF=a.object({name:a.string(),key:a.string(),logoURI:a.string()}),RS=a.object({name:a.string(),symbol:a.string()}),GF=a.object({transactionData:a.string(),buyToken:kt,sellToken:kt,nonIncludedNonGasFees:a.string(),feeCosts:a.array(FS),chainId:Tr,tool:HF,value:a.optional(a.string()),allowanceTarget:a.optional(a.string()),approvalMetadata:a.optional(RS),approvalExactAmount:a.optional(a.string()),exchangeAddress:a.optional(a.string()),gasCosts:a.optional(a.array(a.number())),includedFeeCosts:a.optional(a.array(FS))}),dm=vS.extend({baseProvider:_S,executionDuration:a.number(),tags:a.array(a.string()),steps:a.array(GF)}),jF=a.union([vc,lm,pm,dm,QF]),Mi=a.enum(["solana","eip155","sui","xchain"]),Ui=a.object({type:Mi,taker:kt,buyToken:kt,sellToken:kt,slippageTolerance:a.number(),simulationTolerance:a.optional(a.number()),gasBuffer:a.optional(a.number()),quotes:a.array(jF),tradeFee:a.optional(a.array(a.number())),estimateGasFee:a.optional(a.array(a.number())),includesAllProviders:a.optional(a.boolean())}),$F=a.enum(["swap-approval","swap","bridge-approval","bridge"]),KF=a.enum(["swap","bridge"]),VF=a.enum(["swap","bridge"]),WF=a.enum(["bridge"]),Rc=a.object({sellToken:kt,buyToken:kt,approvalMetadata:a.optional(RS)}),ZF=a.object({type:a.literal("solana"),transactions:a.array(a.string()),transactionTypes:a.array(KF),transactionPairs:a.optional(a.array(Rc))});var YF=a.object({type:a.literal("evm"),transactions:a.array(Gn),transactionTypes:a.array($F),transactionPairs:a.optional(a.array(Rc))}),XF=a.object({type:a.literal("sui"),transactions:a.array(a.string()),transactionTypes:a.array(VF),transactionPairs:a.optional(a.array(Rc))}),JF=a.object({type:a.literal("bitcoin"),transactions:a.array(a.string()),transactionTypes:a.array(WF),transactionPairs:a.optional(a.array(Rc))}),aQ=a.union([ZF,YF,XF,JF]),am;(function(t){t.Pricing="pricing",t.Provider="provider",t.ProviderPressable="providerPressable",t.ExchangeRate="exchangeRate",t.PriceImpact="priceImpact",t.Network="network",t.ExecutionDuration="executionDuration",t.Slippage="slippage",t.SlippagePressable="slippagePressable",t.Fees="fees",t.HighPriceImpact="highPriceImpact",t.HighSlippage="highSlippage",t.TransferFees="transferFees"})(am||(am={}));var mm=a.object({name:a.string(),amount:a.string()}).strict(),Dc=a.object({name:a.string(),feeUsd:a.number().nullish(),amount:a.string(),time:a.object({text:a.string(),isFast:a.boolean()}),logoURI:a.string()}),cQ=a.union([mm,Dc]),cm;(function(t){t.Buy="buy",t.Sell="sell"})(cm||(cm={}));var um;(function(t){t.SwapProviders="SwapProviders",t.SwapReview="SwapReview",t.SwapTermsOfService="SwapTermsOfService",t.SwapConfirmation="SwapConfirmation",t.InsufficientBalance="InsufficientBalance"})(um||(um={}));u();l();var eP=i(t=>Dc.safeParse(t).success,"isBridgeProviderRow");u();l();function le(t){return dm.safeParse(t).success}i(le,"isBridgeQuote");var Ht=i(t=>vc.safeParse(t).success,"isSolanaSwapQuote"),DS=i(t=>Ht(t),"isCashSwapQuote");function Cr(t){return lm.safeParse(t).success}i(Cr,"isEvmSwapQuote");function io(t){return pm.safeParse(t).success}i(io,"isSuiSwapQuote");function BS(t){return t?"gaslessSignature"in t:!1}i(BS,"isGaslessSwapQuote");function qr(t){return Ht(t)||Cr(t)||io(t)}i(qr,"isSingleNetworkSwapQuote");u();l();var Ce;(function(t){t.Idle="idle",t.Started="started",t.Simulating="simulating",t.SimulationRequestErrored="simulationRequestErrored",t.SimulationFailed="simulationFailed",t.SimulationSkipped="simulationSkipped",t.Simulated="simulated",t.SubmittingTransaction="submittingTransaction",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionSubmitted="transactionSubmitted",t.ConfirmingTransaction="confirmingTransaction",t.TransactionNotConfirmed="transactionNotConfirmed",t.TransactionConfirmed="transactionConfirmed"})(Ce||(Ce={}));u();l();var Z;(function(t){t.ExecuteSwapStarted="executeSwapStarted",t.SimulationRequestStarted="simulationRequestStarted",t.SimulationPassed="simulationPassed",t.SimulationFailed="simulationFailed",t.SimulationSkipped="simulationSkipped",t.SubmittingTransaction="submittingTransaction",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionSubmissionStarted="transactionSubmissionStarted",t.TransactionSubmissionSuccess="transactionSubmissionSuccess",t.TransactionConfirmationStarted="transactionConfirmationStarted",t.TransactionConfirmationFailed="transactionConfirmationFailed",t.TransactionConfirmed="transactionConfirmed"})(Z||(Z={}));u();l();function ht(t){return t.type==="pair"||t.type==="changingToken"||t.type==="refreshing"}i(ht,"hasPair");u();l();var wf=D(Ke());var fr=D(O());u();l();u();l();u();l();u();l();var ao="cash-account",tP="grouped-balances",Oi=[ao,tP],fm=[ao,"cash-activity"],zr={account:i((t,e)=>[ao,"account",{userId:t,isCashEnabled:e}],"account"),balance:i((t,e)=>[ao,"balance",{userId:t,isCashEnabled:e}],"balance"),cashKMSAccount:i(t=>[ao,"kms-account",{user:t}],"cashKMSAccount"),bankDetails:i(t=>[ao,"bankDetails",{user:t}],"bankDetails"),enrollment:i(t=>[ao,"enrollment",{userId:t}],"enrollment"),groupedBalances:i((t,e,r)=>[...Oi,{userID:t,addresses:e,isCashEnabled:r}],"groupedBalances"),lastBroadcastDate:i(()=>[ao,"lastBroadcastDate"],"lastBroadcastDate"),cashActivity:i((t,e)=>[...fm,{userID:t?.userID,params:e}],"cashActivity"),waitlistEntry:i(t=>[ao,"waitlist-entry",t],"waitlistEntry")};var Bc=i((t,e)=>t.invalidateQueries({queryKey:zr.balance(e)}),"invalidateCashBalance"),NS=i(t=>t.invalidateQueries({queryKey:Oi}),"invalidateGroupedBalances"),LS=i(t=>t.invalidateQueries({queryKey:fm}),"invalidateCashActivity");var MS=i(async(t,e)=>{let r=new Date().toISOString();await e.set("cash-account:lastBroadcastDate",r),t.setQueryData(zr.lastBroadcastDate(),r),await t.invalidateQueries({queryKey:zr.lastBroadcastDate()})},"invalidateLastBroadcastDate");u();l();u();l();u();l();var us;(function(t){t.NotEnrolled="not_enrolled",t.Unverified="unverified",t.Verified="verified",t.Suspended="suspended",t.Closed="closed"})(us||(us={}));var hm;(function(t){t.Crypto="crypto",t.CryptoRecover="crypto_recover",t.Banking="banking",t.Fiat="fiat",t.Cards="cards",t.PaymentLinks="payment_links",t.AccountManagement="account_management"})(hm||(hm={}));var gm;(function(t){t.NotEnrolled="not_enrolled",t.Unverified="unverified",t.Verified="verified"})(gm||(gm={}));var co;(function(t){t.PhantomUsername="phantom_username",t.Signup="signup",t.Tos="tos",t.Kyc="kyc",t.EmailVerification="email_verification",t.DataSharingConsent="data_sharing_consent",t.L1KycVerification="l1_kyc_verification",t.L2DocumentVerification="l2_document_verification"})(co||(co={}));var Nc;(function(t){t.Pending="pending",t.Completed="completed",t.Verified="verified",t.Failed="failed",t.Rejected="rejected",t.NotStarted="not_started",t.Expired="expired",t.NotApplicable="not_applicable"})(Nc||(Nc={}));var US=a.nativeEnum(us),rP=a.nativeEnum(hm),OS=a.nativeEnum(gm),oP=a.nativeEnum(co),nP=a.nativeEnum(Nc),sP=a.object({type:oP,status:nP.nullish().transform(U),description:a.string().nullish().transform(U),url:a.string().nullish().transform(U),errorMessage:a.string().nullish().transform(U),metadata:a.record(a.string(),a.any()).nullish().transform(U)}),Lc;(function(t){t.NotStarted="not_started",t.Pending="pending",t.Failed="failed",t.Rejected="rejected",t.Verified="verified"})(Lc||(Lc={}));var iP=a.object({kycStartedAt:a.string().nullish().transform(U),idVerificationStatus:a.nativeEnum(Lc).nullish().transform(U),kycVerificationStatus:a.nativeEnum(Lc).nullish().transform(U)}),aP=a.object({consentTimestamp:a.string().nullish().transform(U),consented:a.boolean().nullish().transform(U)}),cP=a.object({authIntentId:a.string().nullish().transform(U)}),uP=a.object({kycMetadata:iP.nullish().transform(U),dataSharing:aP.nullish().transform(U),authIntent:cP.nullish().transform(U)}),lP=a.object({type:a.string(),required:a.boolean(),description:a.string().nullish().transform(U)}),pP=a.object({type:a.nativeEnum(co),required:a.boolean(),description:a.string(),data:a.object({type:a.union([a.literal(co.DataSharingConsent),a.literal(co.L1KycVerification),a.literal(co.L2DocumentVerification)]).nullish().transform(U),currentStatus:a.nativeEnum(Nc).nullish().transform(U),authIntentId:a.string().nullish().transform(U),consentRequired:a.boolean().nullish().transform(U)}).nullish().transform(U)}),Mc;(function(t){t.NotStarted="not_started",t.Pending="pending",t.Failed="failed",t.RegionLocked="region_locked",t.NeedsMoreInfo="needs_more_info",t.Completed="completed",t.CardReady="card_ready"})(Mc||(Mc={}));var zi=a.object({accountStatus:US.nullish().transform(U),features:a.array(rP).optional().default([]),availableTransitions:a.array(US).optional().default([]),canAdvance:a.boolean().optional().default(!1),currentTier:OS.nullish().transform(U),nextTier:OS.nullish().transform(U),nextTierDescription:a.string().nullish().transform(U),nextTierRequirements:a.array(sP).optional().default([]),nextTierRequiredFields:a.record(a.string(),lP).nullish().transform(U),nextSteps:a.array(pP).optional().default([]),verificationState:a.nativeEnum(Mc).nullish().transform(U),metadata:uP.nullish().transform(U)}),qi=class extends Error{static{i(this,"EnrollmentNotFoundError")}constructor(e){super(`Enrollment data not found for user ${e}. User is not enrolled.`),this.name="EnrollmentNotFoundError"}},Uc=class extends Error{static{i(this,"EnrollmentValidationError")}zodError;responseData;constructor(e,r){let o=e.issues.map(n=>`${n.path.length>0?n.path.join("."):"root"}: ${n.message}`).join("; ");super(`Enrollment validation failed: ${o}`),this.name="EnrollmentValidationError",this.zodError=e,this.responseData=r}};var jc=_i,ym;(function(t){t.NotSubmitted="not_submitted",t.Accepted="accepted",t.NotAccepted="not_accepted"})(ym||(ym={}));var wm;(function(t){t.NotSubmitted="not_submitted",t.Incomplete="incomplete",t.PendingReview="pending",t.Approved="approved",t.Rejected="rejected"})(wm||(wm={}));var Sm;(function(t){t.Crypto="crypto",t.CryptoRecover="crypto_recover",t.Banking="banking",t.Fiat="fiat",t.Cards="cards",t.PaymentLinks="payment_links",t.AccountManagement="account_management"})(Sm||(Sm={}));var dP=i(t=>Object.values(Sm).includes(t),"canUseCashAccountFeature"),He;(function(t){t.Pending="pending",t.Processing="processing",t.Completed="completed",t.Refunded="refunded",t.Failed="failed",t.Canceled="canceled",t.Unknown="unknown"})(He||(He={}));var Oc;(function(t){t.Debit="debit",t.Credit="credit"})(Oc||(Oc={}));var qc;(function(t){t.Transfer="transfer",t.Swap="swap",t.PerpsFunding="perps_funding",t.Refund="refund",t.KycUpdate="kyc_update",t.AccountUpdate="account_update",t.Microdeposit="microdeposit",t.UserCardLock="user_card_lock",t.UserCardUnlock="user_card_unlock",t.PhantomCardLock="phantom_card_lock",t.PhantomCardUnlock="phantom_card_unlock",t.CardTransaction="card_transaction",t.CardPinUpdated="card_pin_updated",t.Onramp="onramp",t.Delegation="delegation",t.Recovery="recovery",t.Unknown="unknown"})(qc||(qc={}));var Qi=class extends Error{static{i(this,"CashAccountNotFoundError")}constructor(e){super(`Cash account not found for user ${e}. User is not enrolled in cash account.`),this.name="CashAccountNotFoundError"}},zc=class extends Error{static{i(this,"CashAccountValidationError")}zodError;responseData;constructor(e,r){let o=e.issues.map(n=>`${n.path.length>0?n.path.join("."):"root"}: ${n.message}`).join("; ");super(`Cash account validation failed: ${o}`),this.name="CashAccountValidationError",this.zodError=e,this.responseData=r}},$c=a.object({id:a.string(),primaryEmail:a.string().nullish().transform(U),accountStatus:a.string().nullish().transform(U),addressDetails:a.object({address:a.string()}),features:a.array(a.string()).transform(t=>t.filter(dP)),limits:a.object({dailyFiatTransfer:a.string().nullish().transform(U),monthlyFiatTransfer:a.string().nullish().transform(U)}).nullish().transform(U),waitlistDetails:a.object({waitlist:a.boolean(),priorityWaitlist:a.boolean()}).nullish().transform(U),isRegionLocked:a.boolean().nullish().transform(U),linkDetails:a.object({cryptoCustomerId:a.string().nullish().transform(U),authIntentId:a.string().nullish().transform(U),linkEmail:a.string().nullish().transform(U)}).nullish().transform(U)});var XQ=a.object({sourceCurrency:a.string().nullish().transform(U),destinationCurrency:a.string().nullish().transform(U),destinationBlockchain:a.string().nullish().transform(U),destinationAddress:a.string().nullish().transform(U),accountNumber:a.string().nullish().transform(U),routingNumber:a.string().nullish().transform(U),accountType:a.string().nullish().transform(U),bankName:a.string().nullish().transform(U),bankAddress:a.string().nullish().transform(U),bankBeneficiaryName:a.string().transform(ry).nullish().transform(U),bankBeneficiaryAddress:a.string().nullish().transform(U)}),mP=a.object({price:a.number(),priceChange24h:a.number(),lastUpdatedAt:a.string().transform(t=>new Date(t))}),fP=a.object({account:a.string(),quantity:a.number(),quantityString:a.string()}),hP=a.object({address:a.string(),quantity:a.number(),quantityString:a.string(),lastTransferredDate:a.string().nullish().transform(U),subaccounts:a.array(fP).nullish().transform(U)}),gP=a.object({isMutable:a.boolean().nullish().transform(U),creators:a.array(a.string()).nullish().transform(U),tokenProgram:a.string().nullish().transform(U),extensions:a.array(a.any()).nullish().transform(U),compression:a.record(a.any()).nullish().transform(U)}),JQ=a.object({caip19:a.string(),name:a.string(),symbol:a.string(),decimals:a.number(),spamStatus:jc.nullish().default(null),logoUri:a.string().nullish().default(""),totalQuantity:a.number(),totalQuantityString:a.string(),price:mP.nullish().transform(U),queriedWalletBalances:a.array(hP),extraMetadata:gP}),e3=a.object({email:a.string().email(),cashAccountAddress:a.string(),idempotencyKey:a.string()}),t3=a.object({enrollmentDetails:a.object({kycStatus:a.nativeEnum(wm),kycUrl:a.string(),tosStatus:a.nativeEnum(ym),tosUrl:a.string()})}),Qc;(function(t){t.TRANSFER_TO_BANK="transfer_to_bank",t.TRANSFER_TO_USERNAME="transfer_to_username",t.TRANSFER_TO_WALLET="transfer_to_wallet",t.WITHDRAWAL_TO_WALLET="withdrawal_to_wallet",t.SELL_TOKENS="sell_tokens",t.CARD_BANK_DEPOSIT="card_bank_deposit",t.VIRTUAL_ACCOUNT_DEPOSIT="virtual_account_deposit",t.DELEGATE_WALLET_ACCOUNT="delegate_wallet_account"})(Qc||(Qc={}));var yP=a.object({account:a.string(),quantity:a.number(),quantityString:a.string()}),wP=a.object({address:a.string(),quantity:a.number(),quantityString:a.string(),lastTransferredDate:a.string().nullish().transform(U),subaccounts:a.array(yP).nullish().transform(U)}),SP=a.object({isMutable:a.boolean().nullish().default(null),creators:a.array(a.unknown()).nullish().transform(U),tokenProgram:a.string().nullish().transform(U),extensions:a.array(a.unknown()).nullish().transform(U)}),qS=a.object({caip19:a.string(),name:a.string(),symbol:a.string(),decimals:a.number(),logoUri:a.string(),spamStatus:jc,totalQuantity:a.number(),totalQuantityString:a.string(),queriedWalletBalances:a.array(wP),extraMetadata:SP.nullish().transform(U),price:a.object({price:a.number(),priceChange24h:a.number().nullish().transform(U),lastUpdatedAt:a.coerce.date(),marketCap:a.number().nullish().transform(U)}).nullish()}),r3=a.object({stablecoins:a.array(qS),otherTokens:a.array(qS),totalStablecoinsValueUsd:a.string().nullish().transform(U),totalOtherTokensValueUsd:a.string().nullish().transform(U)}),Hc;(function(t){t.UNVERIFIED="unverified",t.VERIFIED="verified"})(Hc||(Hc={}));var zS;(function(t){t.AlreadyExists="already_exists",t.InProgress="in_progress",t.Pending="pending",t.Completed="completed"})(zS||(zS={}));var bP=a.object({targetState:a.nativeEnum(Hc),data:a.object({email:a.string().email().optional(),cashAccountAddress:a.string().optional()}),idempotencyKey:a.string().optional()}),TP=zi.extend({account:$c}),AP=a.object({requirementType:a.nativeEnum(co),evidence:a.object({authIntentId:a.string(),providerCustomerId:a.string(),dataSharing:a.object({consented:a.boolean()})})}),xP=zi.extend({account:$c}),uo;(function(t){t.BankAccountId="bank_account_id",t.Bank="bank",t.Crypto="crypto",t.PhantomUsername="phantom_username",t.Merchant="merchant"})(uo||(uo={}));var EP=a.nativeEnum(uo),CP=a.object({type:a.literal("fiat"),currency:a.string(),value:a.string()}),IP=a.object({type:a.literal("token"),token:a.string(),symbol:a.string(),value:a.string(),decimals:a.number()}),GS=a.discriminatedUnion("type",[CP,IP]),QS;(function(t){t.Fiat="fiat",t.Token="token"})(QS||(QS={}));var kP=a.record(a.string(),GS),jS=a.object({accountHolderName:a.string().nullish().transform(U),accountNumber:a.string().nullish().transform(U),accountType:a.string().nullish().transform(U),bankName:a.string().nullish().transform(U),nickname:a.string().nullish().transform(U)}),Gi=a.object({type:EP,currency:a.string(),name:a.string().nullish().transform(U),phantomUsername:a.string().nullish().transform(U)}),FP=Gi.extend({type:a.literal(uo.BankAccountId),bankDetails:jS.nullish().transform(U)}),PP=Gi.extend({type:a.literal(uo.Bank),bankDetails:jS.nullish().transform(U)}),_P=Gi.extend({type:a.literal(uo.Crypto),address:a.string().nullish().transform(U),phantomUsername:a.string().nullish().transform(U)}),vP=a.object({merchantName:a.string().nullish().transform(U),merchantCategoryCode:a.string().nullish().transform(U)}),RP=a.object({name:a.string().nullish().transform(U),categoryPrimary:a.string().nullish().transform(U),categoryDetailed:a.string().nullish().transform(U),icon:a.string().nullish().transform(U),website:a.string().nullish().transform(U),location:a.any().nullish().transform(U)}),DP=Gi.extend({type:a.literal(uo.Merchant),merchantDetails:vP.nullish().transform(U),enrichedMerchantDetails:RP.nullish().transform(U),category:a.string().nullish().transform(U),icon:a.string().nullish().transform(U),website:a.string().nullish().transform(U)}),bm;(function(t){t.Following="following"})(bm||(bm={}));var BP=Gi.extend({type:a.literal(uo.PhantomUsername),phantomUsername:a.string().nullish().transform(U),icon:a.string().nullish().transform(U),relationship:a.nativeEnum(bm).nullish().transform(U)}),NP=a.union([FP,PP,_P,BP,DP]),HS=a.object({amount:a.string(),decimals:a.number(),logoUri:a.string().nullish().transform(U),mint:a.string(),name:a.string().nullish().transform(U),owner:a.string(),symbol:a.string().nullish().transform(U),spamStatus:jc.nullish().transform(U)}),pn;(function(t){t.CashOut="cash_out",t.Swap="swap"})(pn||(pn={}));var LP=a.object({input:HS,output:HS,quoteId:a.string().nullish().transform(U),quoteSource:a.string().nullish().transform(U),type:a.nativeEnum(pn).nullish().transform(U)}),o3=a.object({type:a.nativeEnum(qc),id:a.string(),state:a.nativeEnum(He),occurredAt:a.string(),counterparty:NP,direction:a.nativeEnum(Oc),amount:GS,feeBreakdown:kP.nullish().default(null),spamStatus:jc.nullish().transform(U),metadata:a.object({swapInfo:LP.nullish().default(null),merchant:a.any().nullish().default(null),enrichment:a.object({lastEnrichedAt:a.string().nullish().transform(U),source:a.string().nullish().transform(U)}).nullish().transform(U)}).nullish().default(null),onchainTxId:a.string().nullish().transform(U)}),Gc;(function(t){t.PENDING="pending",t.ACTIVATED="activated",t.REJECTED="rejected"})(Gc||(Gc={}));var Hi;(function(t){t.EXTERNAL="external",t.USER="user"})(Hi||(Hi={}));var MP=i(t=>Object.values(Gc).includes(t),"canUseWaitlistStatus"),UP=i(t=>Object.values(Hi).includes(t),"canUseWaitlistSource"),n3=a.object({email:a.string().email(),country:a.string().length(2).nullish().transform(U),state:a.string().nullish().transform(U),referralCode:a.string().nullish().transform(U),marketingOptIn:a.boolean().default(!0),source:a.string().refine(UP).default(Hi.USER)}),s3=a.object({id:a.string(),referralCode:a.string(),position:a.number().nullish().transform(U)}),i3=a.object({id:a.string(),referralBoost:a.number(),referralCode:a.string(),referralCount:a.number(),status:a.string().refine(MP)});u();l();u();l();var $S=i(t=>{if(!t?.accountStatus)return!1;let e=t.accountStatus;return e===us.Unverified||e===us.Verified},"hasCashAccount");u();l();var KS=D(O());var OP=K({seconds:5}),VS=i(t=>{let{data:e}=cr(),{userID:r}=e??{},o=qP();return oe({...t,queryKey:zr.enrollment(r),queryFn:r?async()=>{try{let n=await z.api().bearer(!0).get(`/cash/v1/users/${r}/cash-account/enrollment`);if(n.status===204||n.status===404)throw new qi(r);if(n.status===403)throw new Error(`Access denied to enrollment data for user ${r}`);let s=zi.safeParse(n.data);if(!s.success)throw new Uc(s.error,n.data);return s.data}catch(n){throw n instanceof qi||(await o(),k.captureError(n,_.Cash)),n}}:Ug,retry:!0,retryDelay:OP})},"useEnrollment");function qP(){let t=Ro(),e=qe(),r=Po("kill-cash-invalidate-auth-bandaid");return(0,KS.useCallback)(async()=>{r||(k.addBreadcrumb(_.Cash,"Invalidating auth for cash due to 401",L.Debug),await t.logOut(),await Promise.all([oy(e),ly(e)]),await Promise.all([ny(e),py(e)]))},[t,e,r])}i(qP,"useInvalidateAuthIfNeeded");var WS=i(()=>{let{data:t}=VS();return $S(t)},"useHasCashAccount");var ji=i(t=>{let{data:e}=cr(),{userID:r}=e??{},o=rt("enable-cash"),{canUseCash:n}=hy(),s=o&&n,{data:c}=dy(),p=!!c?.username,d=WS(),m=!!(r&&t?.enabled!==!1&&s&&p);return oe({...t,queryKey:zr.account(r,s),enabled:m,queryFn:i(async()=>{if(!r)throw new Error("useCashAccount: userID is required");let f=r;try{if(!d)throw new Qi(r);let g=await z.api().bearer(!0).get(`/cash/v1/users/${f}/cash-account`),y=$c.safeParse(g.data);if(!y.success)throw new zc(y.error,g.data);return y.data}catch(g){switch(g?.response?.status||g?.response?.data?.statusCode){case 204:case 404:case 403:throw new Qi(f);default:break}throw k.captureError(g,_.Cash),g}},"queryFn")})},"useCashAccount");u();l();var zP=D(O());var QP=i((t,e,r)=>{let o=i(c=>{if(c.caip19!==e)return c;let d=new A(c.totalQuantity).plus(r),m=d.isLessThan(0)?new A(0):d;return{...c,totalQuantity:m.toNumber(),totalQuantityString:m.toString(),queriedWalletBalances:c.queriedWalletBalances}},"updateTokenBalance"),n=t.stablecoins.some(c=>c.caip19===e),s=t.otherTokens.some(c=>c.caip19===e);return!n&&!s?t:{...t,stablecoins:n?t.stablecoins.map(o):t.stablecoins,otherTokens:s?t.otherTokens.map(o):t.otherTokens}},"transformGroupedBalances");function Tm(t,e,r){t.getQueriesData({queryKey:Oi,exact:!1}).forEach(([n,s])=>{if(s){let c=QP(s,e,r);t.setQueryData(n,c)}})}i(Tm,"updateGroupedBalances");u();l();u();l();function Am(t,e,r){if(_o("kill-cash-balance-optimistic-update")||!r)return;let n=zr.balance(r,!0);t.setQueryData(n,s=>{if(!s)return s;let p=new A(s.totalQuantity).plus(e);return{...s,totalQuantity:p.toNumber(),totalQuantityString:p.toString()}}),Bc(t,r)}i(Am,"updateCashBalance");var HP=K({seconds:3}),xm=i(async({queryClient:t,storage:e,authRepository:r,sellCaip19:o,sellAddress:n,sellAmountBN:s,buyCaip19:c,buyAddress:p,buyAmountBN:d,cashAccountAddress:m})=>{let g=(await r.getUser())?.userID??"";jP({queryClient:t,sellCaip19:o,sellAmountBN:s,sellAddress:n,buyCaip19:c,buyAmountBN:d,buyAddress:p,cashAccountAddress:m,userId:g}),await MS(t,e),await new Promise(y=>setTimeout(y,HP)),await GP(t,g)},"invalidateCashSwap"),GP=i(async(t,e)=>Promise.all([NS(t),Bc(t,e),LS(t)]),"invalidateCashSwapQueries"),jP=i(({queryClient:t,sellCaip19:e,sellAmountBN:r,sellAddress:o,buyCaip19:n,buyAmountBN:s,buyAddress:c,cashAccountAddress:p,userId:d})=>{if(!d)return;let m=N(e),f=N(n);p&&o===p?Am(t,r.negated(),d):Tm(t,m,r.negated()),p&&c===p?Am(t,s,d):Tm(t,f,s),$P({sellCaip19:e,sellAmountBN:r,sellAddress:o,buyCaip19:n,buyAmountBN:s,buyAddress:c,cashAccountAddress:p})},"optimisticUpdate"),$P=i(({sellCaip19:t,sellAmountBN:e,sellAddress:r,buyCaip19:o,buyAmountBN:n,buyAddress:s,cashAccountAddress:c})=>{let p=_o("kill-cash-balance-optimistic-update");r===c?k.addBreadcrumb(_.Cash,`[optimisticUpdate] buying ${n.toString()} ${o} w/ ${e.toString()} cash, isKillSwitchEnabled: ${p}`,L.Debug):s===c?k.addBreadcrumb(_.Cash,`[optimisticUpdate] buying ${n.toString()} (cash) w/ ${e.toString()} ${t}, isKillSwitchEnabled: ${p}`,L.Debug,{amount:n.toString()}):k.addBreadcrumb(_.Cash,`[optimisticUpdate] [non-cash] buying ${n.toString()} ${o} w/ ${e.toString()} ${t}`,L.Debug)},"logOptimisticUpdate");var ZS=D(O());u();l();var $i=i(t=>{let e=t?.addressDetails?.address;return e?{[re.Solana.Mainnet]:e}:{}},"createSwapperCashAddresses");var Kc=i(()=>{let{data:t}=ji();return(0,ZS.useMemo)(()=>$i(t),[t])},"useSwapperCashAddresses");u();l();u();l();u();l();var KP=["SwapperNoQuotes","UnsupportedCountry","UnknownError"],YS=i((t,e,r,o)=>{t instanceof ot&&KP.includes(t.code)||(!e||e>=400&&e<500)&&k.addBreadcrumb(r,JSON.stringify(o),L.Info)},"captureClientError");u();l();var XS=i(async(t,e,r=void 0)=>{if(te(t))return Promise.resolve();let o;try{o=t.data}catch{throw new ot({key:r})}let n=Pc.safeParse(o);throw n.success?(k.addBreadcrumb(e,JSON.stringify(n.data),L.Info),new ot({key:n.data.name})):new ot({key:r})},"handleBadResponse");u();l();var JS=i(t=>{let e=new ot({key:"SwapperNoQuotes"});if(Mi.safeParse(t?.type).success===!1)throw k.captureError(new Error("Failed to parse a valid quote type."),_.Swapper),new Error("Invalid input");let r=Ui.safeParse(t);if(!r.success)throw k.captureError(new Error("Failed to parse a valid swap quotes response."),_.Swapper),e;if(r.data.quotes.length===0)throw e;return r.data},"parseSwapQuotesResponse");var eb="swap-quotes";async function Vc({sellTokenCaip19:t,buyTokenCaip19:e,taker:r,takerDestination:o,exactOut:n,sellAmount:s,sellAmountUsd:c,slippageTolerance:p,signal:d,enableAutoSlippage:m,priorityFee:f,tipAmount:g,phantomCashAccount:y,isPrediction:w,predictions:S}){let b;try{ki(r)&&(r.address=r.address.toLowerCase()),o&&ki(o)&&(o.address=o.address.toLowerCase()),ki(e)&&(e.address=e.address.toLowerCase()),ki(t)&&(t.address=t.address.toLowerCase());let T="/swap/v2/quotes",x={sellToken:t,buyToken:e,taker:r,takerDestination:o,exactOut:n,sellAmount:s,sellAmountUsd:c,slippageTolerance:p,autoSlippage:m,priorityFee:f,tipAmount:g,phantomCashAccount:y,isPrediction:w,predictions:S},C=await z.api().post(T,x,{signal:d});return b=C.status,await XS(C,eb,"SwapperNoQuotes"),JS(C.data)}catch(T){let x=T instanceof ot?T:new ot;throw YS(x,b,eb,{sellToken:t,buyToken:e,sellAmount:s,sellAmountUsd:c,slippageTolerance:p}),x}}i(Vc,"getSwapQuotes");var Wc=class{static{i(this,"WalletSwapApiClient")}getQuotes(e){return Vc({sellTokenCaip19:e.sell,buyTokenCaip19:e.buy,taker:e.taker,takerDestination:e.takerDestination,sellAmount:e.amount,sellAmountUsd:e.amountUsd,slippageTolerance:e.slippageTolerance,signal:e.signal,exactOut:e.exactOutEnabled,priorityFee:e.priorityFee,tipAmount:e.tipAmount,enableAutoSlippage:e.autoSlippageEnabled,phantomCashAccount:e.phantomCashAccount})}};u();l();u();l();var Zc=class{static{i(this,"BridgeTrackingSwapCommand")}inner;bridgeStatusManager;executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,o){this.inner=e,this.bridgeStatusManager=r,this.executingQuote=o,this.takerAddress=e.takerAddress,this.networkId=e.networkId,this.quote=e.quote,this.executionId=e.executionId}createTransaction(){return this.inner.createTransaction()}swap(e,r,o,n,s){return this.inner.swap(e,r,o,n,s)}async waitForConfirmation(e){await this.bridgeStatusManager.track({executionId:this.executionId,executingQuote:this.executingQuote,transactionHash:e.id}),await this.inner.waitForConfirmation(e)}};u();l();u();l();u();l();var Gt="swapper",dt;(function(t){t.quotes="quotes",t.transactions="transactions",t.slippageTolerance="slippageTolerance",t.priorityFee="priorityFee",t.tipAmount="tipAmount",t.presence="presence",t.lastSubmittedPairs="lastSubmittedPairsV2",t.lastSelectedTokens="lastSelectedTokens",t.slippageSettings="slippageSettings",t.priorityFeeSettings="priorityFeeSettings",t.tipSettings="tipSettings",t.hasViewedAutoSlippageOptIn="hasViewedAutoSlippageOptIn",t.optimisticUpdates="optimisticUpdates",t.autoSlippageMigrationVersion="autoSlippageMigrationVersion"})(dt||(dt={}));var tb=[Gt,dt.quotes],me={quotesScope:i(()=>tb,"quotesScope"),quotes:i(({sellTokenCaip19:t,buyTokenCaip19:e,taker:r,amountValue:o,amountType:n,slippageTolerance:s,priorityFee:c,tipAmount:p,takerDestination:d,enableAutoSlippage:m,preferredProvider:f,phantomCashAccount:g})=>[...tb,{sellToken:t,buyToken:e,taker:r,takerDestination:d,amountValue:o,amountType:n,slippageTolerance:s,priorityFee:c,tipAmount:p,enableAutoSlippage:m,preferredProvider:f,phantomCashAccount:g}],"quotes"),transactions:i(t=>[Gt,dt.transactions,t],"transactions"),presence:i(t=>[Gt,dt.presence,t],"presence"),slippageTolerance:i(()=>[Gt,dt.slippageTolerance],"slippageTolerance"),priorityFee:i(()=>[Gt,dt.priorityFee],"priorityFee"),tipAmount:i(()=>[Gt,dt.tipAmount],"tipAmount"),lastSubmittedPairs:i(()=>[Gt,dt.lastSubmittedPairs],"lastSubmittedPairs"),lastSelectedTokens:i(()=>[Gt,dt.lastSelectedTokens],"lastSelectedTokens"),slippageSettings:i(()=>[Gt,dt.slippageSettings],"slippageSettings"),priorityFeeSettings:i(()=>[Gt,dt.priorityFeeSettings],"priorityFeeSettings"),tipSettings:i(()=>[Gt,dt.tipSettings],"tipSettings"),hasViewedAutoSlippageOptIn:i(()=>[Gt,dt.hasViewedAutoSlippageOptIn],"hasViewedAutoSlippageOptIn"),optimisticUpdates:i(()=>[Gt,dt.optimisticUpdates],"optimisticUpdates"),autoSlippageMigrationVersion:i(()=>[Gt,dt.autoSlippageMigrationVersion],"autoSlippageMigrationVersion")};u();l();var Yc;(function(t){t[t.Always=1/0]="Always",t[t.Short=K({days:1})]="Short",t[t.Medium=K({days:3})]="Medium",t[t.Long=K({days:7})]="Long"})(Yc||(Yc={}));var Xc;(function(t){t[t.Immediate=0]="Immediate",t[t.Short=K({minutes:1})]="Short",t[t.Medium=K({minutes:2.5})]="Medium",t[t.Long=K({minutes:60})]="Long",t[t.Never=1/0]="Never"})(Xc||(Xc={}));var ls;(function(t){t[t.Short=K({seconds:20})]="Short",t[t.Medium=K({minutes:2.5})]="Medium",t[t.Long=K({minutes:5})]="Long"})(ls||(ls={}));var rb=i(async({callerAddress:t,contractAddress:e,networkId:r,sellAmount:o,allowanceTarget:n,approvalExactAmount:s,exchangeAddress:c,value:p,transactionData:d,type:m})=>{let f=[],g=[];if(e&&(await Uy({callerAddress:t,spender:n,networkId:r,contractAddress:e})).lt(s??o.toString())){let S=await Oy({callerAddress:t,spender:n,networkId:r,contractAddress:e,exactAmount:s});f.push(S),g.push(`${m}-approval`)}let y=Gn.parse({type:wg.eip1559,from:t,data:d,chainId:I.getEVMNetworkIDValue(r),to:c,...p==="0"?{}:{value:`0x${new q(p).toString(16)}`}});return f.push(y),g.push(m),{transactions:f,transactionTypes:g}},"createEVMTransactions"),Ki=i(async({networkId:t,callerAddress:e,quote:r})=>{let{sellAmount:o,steps:n}=r,s=[],c=[],p=[];for(let d of n){let{allowanceTarget:m,exchangeAddress:f,value:g,transactionData:y,sellToken:w,buyToken:S,approvalMetadata:b}=d,T=w.resourceType===V.address?w.address:null,x=I.compareNetworkID(w.chainId,S.chainId)===0?"swap":"bridge";if(!m||!f||!y||!g)throw new Error("Missing bridge step data for EVM bridge quote.");let C=await rb({callerAddress:e,contractAddress:T,networkId:t,sellAmount:o,allowanceTarget:m,approvalExactAmount:d.approvalExactAmount,exchangeAddress:f,value:g,transactionData:y,type:x});s.push(...C.transactions),c.push(...C.transactionTypes),p.push({sellToken:w,buyToken:S,approvalMetadata:b}),C.transactionTypes.length==2&&C.transactionTypes.find(E=>E.includes("approval"))&&p.push({sellToken:w,buyToken:S,approvalMetadata:b})}return{type:"evm",transactions:s,transactionTypes:c,transactionPairs:p}},"processEVMBridgeQuote"),Vi=i(async({quote:t,connection:e})=>{let r=[],o=[],n=[];for(let s of t.steps){let{transactionData:c,sellToken:p,buyToken:d}=s,m=I.compareNetworkID(p.chainId,d.chainId)===0?"swap":"bridge",f=await ob(c,e);r.push(dd.serialize(f).transaction),o.push(m),n.push({sellToken:p,buyToken:d})}return{type:"solana",transactions:r,transactionTypes:o,transactionPairs:n}},"processSolanaBridgeQuote"),Wi=i(async({networkId:t,callerAddress:e,quote:r,sellFungible:o})=>{let n=o.type===ae.ERC20&&o?.data.tokenAddress?o.data.tokenAddress:null,{allowanceTarget:s,exchangeAddress:c,sellAmount:p,value:d}=r;return{type:"evm",...await rb({callerAddress:e,contractAddress:n,networkId:t,sellAmount:p,allowanceTarget:s,exchangeAddress:c,value:d,transactionData:r.transactionData,type:"swap"})}},"processEVMSwapQuote"),Zi=i(async({quote:t})=>{let e=[],r=[],o=[];for(let n of t.steps){let{transactionData:s,sellToken:c,buyToken:p}=n,d=I.compareNetworkID(c.chainId,p.chainId)===0?"swap":"bridge";e.push(s),r.push(d),o.push({sellToken:c,buyToken:p})}return{type:"sui",transactions:e,transactionTypes:r,transactionPairs:o}},"processSuiBridgeQuote"),Jc=i(async({quote:t})=>{let e=[],r=[],o=[];for(let n of t.steps){let{transactionData:s,sellToken:c,buyToken:p}=n;e.push(s),r.push("bridge"),o.push({sellToken:c,buyToken:p})}return{type:"bitcoin",transactions:e,transactionTypes:r,transactionPairs:o}},"processBitcoinBridgeQuote"),ob=i(async(t,e)=>{let r=It(t,"bs58");return await es(r,{connection:e,transactionType:Yn.Swap})},"addPriorityFeeToEncodedTx"),ps=i(async({quote:t,connection:e})=>{let r=t.transactionData.map(c=>ob(c,e)),n=(await Promise.all(r)).map(c=>dd.serialize(c).transaction);return{type:"solana",transactionTypes:n.map(()=>"swap"),transactions:n}},"processSolanaSwapQuote"),nb=i(async({quote:t,connection:e})=>ps({quote:t,connection:e}),"processCashSwapQuote"),Yi=i(async({quote:t})=>({type:"sui",transactionTypes:Array(t.transactionData.length).fill("swap"),transactions:t.transactionData}),"processSuiSwapQuote"),ds=i(({callerAddress:t,sellFungible:e,quote:r})=>{let{connection:o}=Mo(),n=me.transactions(r);return oe({queryKey:n,enabled:!!r&&!!e,gcTime:0,staleTime:0,refetchInterval:ls.Short,async queryFn(){try{if(!r)throw new Error("Missing quote");if(!e)throw new Error("Missing sell token");let s=e.data.chain.id;if(qr(r)){if(I.isEVMNetworkID(s)&&Cr(r))return await Wi({networkId:s,callerAddress:t,quote:r,sellFungible:e});if(I.isSolanaNetworkID(s)&&Ht(r))return ps({quote:r,connection:o});if(I.isSuiNetworkID(s)&&io(r))return Yi({quote:r});throw new Error(`Single network swap quote not supported for network ID ${s}`)}if(le(r)){if(I.isEVMNetworkID(s))return await Ki({networkId:s,callerAddress:t,quote:r});if(I.isSolanaNetworkID(s))return await Vi({quote:r,connection:o});if(I.isSuiNetworkID(s))return await Zi({quote:r});throw new Error(`Bridge quote not supported for network ID ${s}`)}throw new Error("Swap quote type not supported")}catch(s){throw s instanceof Error&&k.captureError(s,_.Swapper),s}}})},"useSwapTransactions");u();l();var Oo=D(Rg());u();l();var ub=D(O());u();l();var sb=D(O());u();l();function Be(t){let e=t.reduce((r,o)=>r.add(o.name),new Set);return Array.from(e).join(" + ")}i(Be,"parseSwapSources");function eu(t){return(0,sb.useMemo)(()=>Be(t),[t])}i(eu,"useProvider");u();l();var ab=D(O());u();l();var Xi=D(O());var ib=i(()=>{let[t,e]=(0,Xi.useState)(!1),r=$(d=>d.selectedProviderIndex),o=$(d=>d.selectedBaseProvider),n=$(d=>d.quoteResponse),s=(0,Xi.useMemo)(()=>n?n.quotes:[],[n]),c=(0,Xi.useMemo)(()=>{if(nn){if(!n||n.quotes.length===0)return 0;let d=VP(n,o);return d===-1?(e(o!==ur),0):(e(!1),d)}return r},[n,o,r]),p=s.length>0?s[c]:void 0;return{selectedQuoteIndex:c,selectedBaseProvider:nn?o:"",currentQuote:p,hasDefaultedToBestQuote:t}},"useSelectedQuote"),VP=i((t,e)=>t.quotes.findIndex(r=>r.baseProvider.id===e),"getQuoteIndexByProvider");function Ee(){let t=$(m=>m.quoteResponse),e=$(m=>m.hasNoRoutes),r=$(m=>m.isFetchingQuote),o=(0,ab.useMemo)(()=>t?t.quotes:[],[t]),n=o[0]?.buyAmount??"",{selectedQuoteIndex:s,selectedBaseProvider:c,currentQuote:p,hasDefaultedToBestQuote:d}=ib();return{bestBuyAmount:n,currentQuote:p,hasNoRoutes:e,quoteResponse:t,quotes:o,selectedProviderIndex:s,selectedBaseProvider:c,isFetchingQuote:r,hasDefaultedToBestQuote:d}}i(Ee,"useQuote");u();l();u();l();var ms=i(t=>t.steps.map(e=>e.tool),"getBridgeTools");var Le=i(t=>t?le(t)?ms(t):t?.sources??[]:[],"getSwapQuoteSources");function lb({sender:t}){let{t:e}=ze(),{currentQuote:r}=Ee(),o=$(g=>g.buyFungible),n=$(g=>g.sellFungible),s=eu(Le(r)),{data:c}=ds({callerAddress:t,quote:r,sellFungible:n}),p=c?.transactionPairs?.flatMap(g=>[...an(g.sellToken)??[],...an(g.buyToken)??[]])??[],d=[...new Set(p)],{fungibles:m}=os({keys:d});return{pendingActivityRows:(0,ub.useMemo)(()=>Ir({swapTransactions:c,sellFungible:n,buyFungible:o,fungibles:m,t:e,currentQuote:r,provider:s}),[c,n,o,m,e,r,s])}}i(lb,"usePendingActivity");function Ir({swapTransactions:t,sellFungible:e,buyFungible:r,fungibles:o,currentQuote:n,provider:s,t:c}){let p={pendingSwapActivityRows:[],pendingApprovalActivityRows:[]};return t?t.type==="evm"?t.transactionTypes.reduce((d,m,f)=>{let g=e,y=r,w,S=t.transactionPairs;if(S&&S[f]){let b=S[f];g=tu(b.sellToken,o)??e,y=tu(b.buyToken,o)??r,w=b.approvalMetadata}if(m.includes("approval")){let b=g?.data.symbol??"";d.pendingApprovalActivityRows.push({topLeft:w?{text:`${c("transactionsPendingApproving")} ${w.symbol}`}:{text:`${c("transactionsPendingApproving")} ${b}`}})}else g&&y&&d.pendingSwapActivityRows.push(cb({sellFungible:g,buyFungible:y,sellAmount:n?.sellAmount,buyAmount:n?.buyAmount,provider:s,isBridge:m.includes("bridge"),t:c}));return d},p):t.transactionTypes.reduce((d,m,f)=>{let g=e,y=r,w=t.transactionPairs;if(w&&w[f]){let S=w[f];g=tu(S.sellToken,o)??e,y=tu(S.buyToken,o)??r}return g&&y&&d.pendingSwapActivityRows.push(cb({sellFungible:g,buyFungible:y,sellAmount:n?.sellAmount,buyAmount:n?.buyAmount,provider:s,isBridge:m.includes("bridge"),t:c})),d},p):p}i(Ir,"getPendingActivityRows");var cb=i(({sellFungible:t,buyFungible:e,sellAmount:r,buyAmount:o,provider:n,isBridge:s,t:c})=>{let p=t.data.symbol,d=e.data.symbol,m=xe(r??0,t.data.decimals??0),f=xe(o??0,e.data.decimals??0);return{topLeft:{text:`${c(s?"transactionsPendingBridging":"transactionsPendingSwapping")} on ${n}`},topRight:{text:`${f} ${d}`,color:"spotPositive"},bottomLeft:{text:`${p} \u2192 ${d}`},bottomRight:{text:`${m} ${p}`}}},"getPendingSwapActivityRows"),tu=i((t,e)=>e.find(r=>(an(t)??[]).includes(r.data.key)),"getFungibleFromFungibleCaip19");var ru=class{static{i(this,"BitcoinSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,o,n,s){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s}async createTransaction(){return Jc({quote:this.quote})}async swap(e,r,o,n,s){let c=r.transactions[0];if(!c)throw new Error("No transaction found");let p=Oo.Psbt.fromHex(c),d=this.analyzePsbtInputs(p,this.takerAddress),m=await Ly({accountSigner:n,storage:s,accountIdentifier:e,pendingTransactionInput:this.parsePendingTransactionInput(this.executingQuote,r,p),psbt:p,psbtChain:void 0,inputsToSign:d,utxoManager:Ny(new By(s))});return{networkID:this.networkId,id:m}}async waitForConfirmation(e){await My(this.networkId,e.id)}analyzePsbtInputs(e,r){let o=[];if(e.data.inputs.forEach((n,s)=>{let c;if(n.witnessUtxo?c=n.witnessUtxo.script:n.nonWitnessUtxo&&(c=Oo.Transaction.fromBuffer(n.nonWitnessUtxo).outs[e.txInputs[s].index].script),c)try{Oo.address.fromOutputScript(c,Oo.networks.bitcoin)===r&&o.push(s)}catch(p){console.warn(`Could not decode script for input ${s}:`,p)}}),o.length===0)throw new Error(`No inputs found for user address ${r}`);return[{address:r,signingIndexes:o}]}parsePendingTransactionInput(e,r,o){let n=Be(Le(e.quote)),c=Ir({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:n,t:v.t}).pendingSwapActivityRows[0];return{ownerAddress:this.takerAddress,networkID:this.networkId,data:{txID:"",psbtHex:o.toHex()},type:ft.Swap,display:{summary:{topLeft:c.topLeft,topRight:c.topRight,bottomLeft:c.bottomLeft,bottomRight:c.bottomRight}}}}};var ou=class{static{i(this,"BtcBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;bitcoinSwapCommand;constructor(e,r,o,n,s){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.bitcoinSwapCommand=new ru(e,r,o,n,s)}async createTransaction(){return Jc({quote:this.quote})}async swap(e,r,o,n,s){return this.bitcoinSwapCommand.swap(e,r,o,n,s)}async waitForConfirmation(e){return this.bitcoinSwapCommand.waitForConfirmation(e)}};u();l();u();l();u();l();u();l();u();l();function WP(t){if(t.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let m=0;m<e.length;m++)e[m]=255;for(let m=0;m<t.length;m++){let f=t.charAt(m),g=f.charCodeAt(0);if(e[g]!==255)throw new TypeError(f+" is ambiguous");e[g]=m}let r=t.length,o=t.charAt(0),n=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function c(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";let f=0,g=0,y=0,w=m.length;for(;y!==w&&m[y]===0;)y++,f++;let S=(w-y)*s+1>>>0,b=new Uint8Array(S);for(;y!==w;){let C=m[y],E=0;for(let P=S-1;(C!==0||E<g)&&P!==-1;P--,E++)C+=256*b[P]>>>0,b[P]=C%r>>>0,C=C/r>>>0;if(C!==0)throw new Error("Non-zero carry");g=E,y++}let T=S-g;for(;T!==S&&b[T]===0;)T++;let x=o.repeat(f);for(;T<S;++T)x+=t.charAt(b[T]);return x}i(c,"encode");function p(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;let f=0,g=0,y=0;for(;m[f]===o;)g++,f++;let w=(m.length-f)*n+1>>>0,S=new Uint8Array(w);for(;m[f];){let C=e[m.charCodeAt(f)];if(C===255)return;let E=0;for(let P=w-1;(C!==0||E<y)&&P!==-1;P--,E++)C+=r*S[P]>>>0,S[P]=C%256>>>0,C=C/256>>>0;if(C!==0)throw new Error("Non-zero carry");y=E,f++}let b=w-y;for(;b!==w&&S[b]===0;)b++;let T=new Uint8Array(g+(w-b)),x=g;for(;b!==w;)T[x++]=S[b++];return T}i(p,"decodeUnsafe");function d(m){let f=p(m);if(f)return f;throw new Error("Non-base"+r+" character")}return i(d,"decode"),{encode:c,decodeUnsafe:p,decode:d}}i(WP,"base");var pb=WP;var ZP="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",nu=pb(ZP);u();l();var YP=a.object({id:a.string(),state:a.nativeEnum(He)}).passthrough(),Em=class extends Error{static{i(this,"CashActivityError")}activityId;userId;constructor(e,r,o){super(e),this.activityId=r,this.userId=o,this.name="CashActivityError"}},Ji=class extends Error{static{i(this,"CashActivityNotFoundError")}constructor(e,r){super(`Cash activity ${e} not found for user ${r}`),this.name="CashActivityNotFoundError"}},db=i(async({userID:t,activityId:e,accessToken:r})=>{let o=await z.api().bearer(r).get(`/cash/v1/users/${t}/cash-activity/${e}`);if(o.status===404)throw new Ji(e,t);let n=YP.safeParse(o.data);if(!n.success)throw new Em(`Failed to parse cash activity response: ${n.error.message}`,e,t);return n.data},"fetchCashActivity");u();l();var Cm;(function(t){t.Base58="base58",t.Base64="base64"})(Cm||(Cm={}));var XP=a.object({activityId:a.string(),transactionId:a.string()}),JP=3,e_=1e3,mb=i(({accessToken:t,userID:e,idempotencyKey:r,signedTransaction:o,skipActivityRecording:n,skipNotification:s,cashQuoteSignerSignature:c,swapInfo:p,perpsInfo:d,skipPreflight:m,awaitConfirmation:f})=>{if(!t)throw new Error("Access token is required");if(!e)throw new Error("User ID is required");return oc(async()=>{let g=await z.api().bearer(t).post(`/cash/v1/users/${e}/cash-account/send`,{idempotencyKey:r,chainId:ar.Mainnet,signedTransaction:nu.encode(bg(o)?o.serialize():o.serialize({requireAllSignatures:!1,verifySignatures:!1})),encoding:Cm.Base58,skipActivityRecording:n,skipNotification:s,...c&&{cashQuoteSignerSignature:c},...p&&{swapInfo:p},...d&&{perpsInfo:d},...m!==void 0&&{skipPreflight:m},...f!==void 0&&{awaitConfirmation:f}}),y=XP.safeParse(g.data);if(!y.success)throw new Error("Failed to parse transaction response");return y.data},()=>!0,JP,e_)},"broadcastTransaction");var t_=8,r_=K({seconds:1.5}),o_=i(t=>{switch(t){case He.Failed:case He.Canceled:case He.Completed:case He.Processing:case He.Refunded:return!0;case He.Pending:case He.Unknown:return!1}},"isTerminalState"),n_=i(t=>{switch(t){case He.Completed:case He.Processing:case He.Refunded:return!0;case He.Failed:case He.Canceled:case He.Pending:case He.Unknown:return!1}},"isSuccessTerminalState");var ea=i(async({unsignedTransaction:t,vaultProxy:e,accountIdentifier:r,signerAddress:o,idempotencyKey:n,isCash:s=!0,accessToken:c,userID:p,skipActivityRecording:d,skipNotification:m,cashQuoteSignerSignature:f,swapInfo:g,perpsInfo:y,skipPreflight:w,awaitConfirmation:S})=>{let b;typeof t=="string"?b=It(t,"bs58"):b=t,s&&await e.updateCashAccountMapping(o);let T=s&&await s_(e,o);k.addBreadcrumb(_.Cash,"Signing transaction ...",L.Info),k.addBreadcrumb(_.Cash,`Using vault proxy signing (isCash: ${s}, isCashKMS: ${T})`,L.Info);let x;s&&T?x={isCash:s,isCashKMS:T,cashAccountAddress:o,data:{chainType:se.Solana,signingType:"transaction",message:new Uint8Array(Ya(b))}}:s?x={isCash:s,data:{chainType:se.Solana,signingType:"transaction",message:new Uint8Array(Ya(b))}}:x={chainType:se.Solana,signingType:"transaction",message:new Uint8Array(Ya(b))};let C=await e.sign(r,x);if(C.status==="error")throw new Error(C.message);let{signature:E}=C;if(!E)throw new Error("Failed to sign transaction: No signature returned");b.addSignature(new ge.PublicKey(o),nu.decode(E));let P=b;k.addBreadcrumb(_.Cash,"Signed transaction",L.Info),k.addBreadcrumb(_.Cash,"Broadcasting transaction ...",L.Info);let{activityId:M,transactionId:G}=await mb({accessToken:c,userID:p,idempotencyKey:n,signedTransaction:P,skipActivityRecording:d,skipNotification:m,cashQuoteSignerSignature:f,swapInfo:g,perpsInfo:y,skipPreflight:w,awaitConfirmation:S});k.addBreadcrumb(_.Cash,"Polling for cash activity...",L.Info);try{await oc(async()=>{let R=await db({userID:p,activityId:M,accessToken:c});if(o_(R.state)){if(n_(R.state))return k.addBreadcrumb(_.Cash,`Activity reached success terminal state: ${R.state}`,L.Info),R;{let j=`Activity reached failed terminal state: ${R.state}.`;throw k.addBreadcrumb(_.Cash,j,L.Info),new Error(j)}}else throw new Error(`Activity state is ${R.state}, waiting for a terminal state.`)},R=>R instanceof Ji||!!(R instanceof Error&&R.message.includes("waiting for")),t_,r_,!0)}catch(R){throw k.addBreadcrumb(_.Cash,`Failed to poll for cash activity: ${R}`,L.Error),new Error(`Transaction broadcast succeeded but activity confirmation failed: ${R}`)}return k.addBreadcrumb(_.Cash,"Broadcasted transaction",L.Info),G},"signAndBroadcastTransaction");async function s_(t,e){try{k.addBreadcrumb(_.Cash,"Fetching Cash KMS account...",L.Info);let o=(await t.getCashKMSAccount({cashAccountAddress:e})).account.address;return e!==o&&k.addBreadcrumb(_.Cash,"Cash-KMS account mismatch",L.Error,{cashAddress:e?.slice(0,5),kmsAddress:o?.slice(0,5)}),e===o}catch{return k.addBreadcrumb(_.Cash,"Unable to get Cash-KMS account.",L.Error),!1}}i(s_,"isCashKMSEnabled");u();l();var i_=a.object({activityId:a.string()}),Im=i(async({accessToken:t,userID:e,idempotencyKey:r,swapInfo:o,chainId:n,signedTransaction:s,encoding:c,onchainTxId:p,failureReason:d,skipActivityRecording:m,skipNotification:f,occurredAt:g})=>{if(_o("kill-cash-swap-listener"))return;if(!t)throw new Error("Access token is required");if(!e)throw new Error("User ID is required");let w=await z.api().bearer(t).post(`/cash/v1/users/${e}/cash-account/transaction/failed`,{idempotencyKey:r,swapInfo:o,...n&&{chainId:n},...s&&{signedTransaction:s},...c&&{encoding:c},...p&&{onchainTxId:p},...d&&{failureReason:d},...m!==void 0&&{skipActivityRecording:m},...f!==void 0&&{skipNotification:f},...g&&{occurredAt:g}}),S=i_.safeParse(w.data);if(!S.success)throw new Error("Failed to parse record failed swap response");return S.data},"recordFailedCashSwap");u();l();var ta=i((t,e)=>!t||!e?{}:{sellAmount:e.sellAmount,buyAmount:e.buyAmount,sellToken:t.sell.data.symbol||"unknown",buyToken:t.buy.data.symbol||"unknown"},"swapTelemetryMetadata"),su=class{static{i(this,"CashSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;authRepository;cashAccount;constructor(e,r,o,n,s,c,p,d){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c,this.authRepository=p,this.cashAccount=d}async createTransaction(){k.addBreadcrumb(_.Cash,"Creating cash swap transaction",L.Info,ta(this.executingQuote,this.quote));try{return await nb({quote:this.quote,connection:this.connection})}catch(e){throw k.addBreadcrumb(_.Cash,"Failed to create cash swap transaction",L.Error,ta(this.executingQuote,this.quote)),e}}async swap(e,r,o,n,s){k.addBreadcrumb(_.Cash,"Starting cash swap",L.Info,ta(this.executingQuote,this.quote));let c=r.transactions[0],p=It(c,"bs58"),d=Eg(p),m=p.message.header.numRequiredSignatures,f=d.slice(0,m),g=this.cashAccount?.addressDetails.address;if(!g)throw new Error("Cash account address not found");let y=f[0]?.toBase58(),w=y===this.takerAddress?"taker address":y===g?"cash account address":null;w&&k.addBreadcrumb(_.Cash,`Fee payer is ${w}`,L.Info,ta(this.executingQuote,this.quote));let S=f.some(P=>P.toBase58()===g),b=S?g:this.takerAddress,T=await this.authRepository?.getUser();if(!T)throw new Error("User not found for swap");let{accessToken:x,userID:C}=T,E=this.getSwapInfo(this.executingQuote,this.quote);try{return{id:await ea({unsignedTransaction:c,vaultProxy:n,accountIdentifier:e,signerAddress:b,idempotencyKey:this.executionId,isCash:S,accessToken:x,userID:C,skipActivityRecording:!1,skipNotification:!0,cashQuoteSignerSignature:this.quote.cashQuoteSignerSignature,swapInfo:E,waitForActivityState:He.Completed}),networkID:this.networkId}}catch(P){throw k.addBreadcrumb(_.Cash,"Swap failed",L.Error,ta(this.executingQuote,this.quote)),P}}async waitForConfirmation(e){}parsePendingActivity(e,r){let o=Be(Le(e.quote));return Ir({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:o,t:v.t})}getSwapInfo(e,r){let o=e.sell,n=e.buy,s=e.quoteInput,c=o.data.walletAddress,p=n.data.walletAddress;if(!c&&s?.taker){let d=Ve(s?.taker);d.resourceType===V.address&&(c=d.address)}if(!p&&s?.takerDestination){let d=Ve(s?.takerDestination);d.resourceType===V.address&&(p=d.address)}return{type:pn.Swap,input:{owner:c,mint:o.data.tokenAddress??"",amount:r.sellAmount,symbol:o.data.symbol??void 0,name:o.data.name??void 0,decimals:o.data.decimals,logoUri:o.data.logoUri??void 0},output:{owner:p,mint:n.data.tokenAddress??"",amount:r.buyAmount,symbol:n.data.symbol??void 0,name:n.data.name??void 0,decimals:n.data.decimals,logoUri:n.data.logoUri??void 0},quoteId:r.rfqProps?.quoteId,quoteSource:Le(r).map(d=>d.name).join(",")}}};u();l();var iu=class{static{i(this,"EvmBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;evmSwapCommand;constructor(e,r,o,n,s,c){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.evmSwapCommand=c}createTransaction(){return Ki({networkId:this.networkId,callerAddress:this.takerAddress,quote:this.quote})}async swap(e,r,o,n,s){return this.evmSwapCommand.swap(e,r,o,n,s)}async waitForConfirmation(e){return this.evmSwapCommand.waitForConfirmation(e)}};u();l();u();l();var a_=1.3,c_=i(t=>{switch(t){case re.Ethereum.Mainnet:case re.Ethereum.Sepolia:return 8e5;case re.Polygon.Mainnet:case re.Polygon.Amoy:return 5e5;case re.Base.Mainnet:case re.Base.Sepolia:return 5e5;case re.Arbitrum.Mainnet:case re.Arbitrum.Sepolia:return 5e5;case re.Hyperevm.Mainnet:case re.Hyperevm.Testnet:return 5e5;case re.Monad.Mainnet:case re.Monad.Testnet:return 5e5;default:return 0}},"getDefaultBridgeGasLimit"),u_=i(t=>{switch(t){case re.Ethereum.Mainnet:case re.Ethereum.Sepolia:return 6e4;case re.Polygon.Mainnet:case re.Polygon.Amoy:return 6e4;case re.Base.Mainnet:case re.Base.Sepolia:return 6e4;case re.Arbitrum.Mainnet:case re.Arbitrum.Sepolia:return 6e4;case re.Hyperevm.Mainnet:case re.Hyperevm.Testnet:return 6e4;case re.Monad.Mainnet:case re.Monad.Testnet:return 6e4;default:return 0}},"getDefaultApprovalGasLimit"),l_=i((t,e)=>t.steps.flatMap(r=>r.gasCosts??[c_(e)]),"getBridgeGasLimit"),p_=i((t,e,r)=>{let o=Cr(e)?[e.gas]:l_(e,r);return t?t.transactionTypes.map(n=>n.includes("approval")?u_(r):o.shift()??0):o},"getQuoteGasLimit"),fs={estimateGas:i(({swapTransactions:t,evmGasEstimation:e,currentQuote:r,scanResult:o,networkID:n,includeGasBuffer:s,gasBuffer:c})=>{let{maxFeePerGas:p,maxPriorityFeePerGas:d}=e,m=p_(t,r,n),f=o?.advancedDetails?.gas;return o?.advancedDetails?.gasLimit>0&&(m=f),m.map(y=>({maxFeePerGas:p,maxPriorityFeePerGas:d,networkID:n,gasLimit:new A(y).multipliedBy(s?c??a_:1).integerValue(A.ROUND_CEIL)}))},"estimateGas")};u();l();var d_=i(({networkID:t,unsignedTransaction:e,pendingActivityRows:r,accountIdentifier:o,accountSigner:n,storage:s,includeCallPayload:c})=>({accountSigner:n,accountIdentifier:o,networkID:t,unsignedTransaction:e,...c&&{callPayload:{from:e.from,to:e.to,data:e.data,value:e.value}},pendingTransactionInput:{ownerAddress:e.from,networkID:t,data:{nonce:"",unsignedTransaction:e,hash:""},type:ft.Swap,display:{summary:r}},storage:s}),"buildArgs"),au=i(async({transactions:t,transactionTypes:e,networkID:r,gasEstimation:o,pendingApprovalActivityRows:n,pendingSwapActivityRows:s,accountIdentifier:c,accountSigner:p,storage:d})=>{let m=!0,f="";for(let[g,y]of t.entries()){let w=o[g],S={gas:`0x${w.gasLimit.toString(16)}`,maxFeePerGas:`0x${w.maxFeePerGas.toString(16)}`,maxPriorityFeePerGas:`0x${w.maxPriorityFeePerGas.toString(16)}`},b=Gn.parse({...y,...S}),x=e[g].includes("approval")?n:s,C=d_({networkID:r,accountIdentifier:c,pendingActivityRows:x.shift(),accountSigner:p,storage:d,unsignedTransaction:b,includeCallPayload:m});try{f="",f=await qy(C)}catch(E){return{signature:f,error:E instanceof Error?E:new Error("Failed to process EVM swap transaction")}}m&&(m=!1)}return{signature:f}},"swapTransactionEvm");var fb=Ur.standard,cu=class{static{i(this,"EvmSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;gasEstimation;constructor(e,r,o,n,s,c){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.gasEstimation=c}createTransaction(){return Wi({quote:this.quote,callerAddress:this.takerAddress,networkId:this.networkId,sellFungible:this.executingQuote.sell})}async swap(e,r,o,n,s){let c=this.gasEstimation??await this.estimateGas(this.quote,this.executingQuote.response,fb,r,o);if(!c)throw new Error(`No gas estimation found for ${fb}`);let p=this.parsePendingActivity(this.executingQuote,r),{signature:d,error:m}=await k.startSpan("Process EVM Swap Txns",()=>au({transactions:r.transactions,transactionTypes:r.transactionTypes,networkID:this.networkId,gasEstimation:c,pendingSwapActivityRows:p.pendingSwapActivityRows,pendingApprovalActivityRows:p.pendingApprovalActivityRows,accountIdentifier:e,accountSigner:n,storage:s}));if(m)throw m;return{networkID:this.networkId,id:d}}async waitForConfirmation(e){await Iy(e.networkID,e.id)}async estimateGas(e,r,o,n,s){let c=await Xn(this.networkId,!0);if(!c)return;let p=c[o];if(!p)return;let d={networkID:this.networkId,gasLimit:new q(1),maxFeePerGas:p.maxFeePerGas,maxPriorityFeePerGas:p.maxPriorityFeePerGas};return fs.estimateGas({swapTransactions:n,evmGasEstimation:d,currentQuote:e,scanResult:s??void 0,includeGasBuffer:!0,networkID:this.networkId,gasBuffer:r.gasBuffer})}parsePendingActivity(e,r){let o=Be(Le(e.quote));return Ir({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:o,t:v.t})}};u();l();var hb=D(yg());u();l();u();l();var m_=i(({networkID:t,transaction:e,feePayer:r,connection:o,pendingActivityRows:n,accountIdentifier:s,accountSigner:c,storage:p})=>({accountSigner:c,accountIdentifier:s,transaction:e,feePayer:r,connection:o,opts:{skipPreflight:!0},pendingTransactionInput:{ownerAddress:r.toBase58(),networkID:t,data:{signature:""},type:ft.Swap,display:{summary:n}},storage:p}),"buildArgs"),uu=i(async({callerAddress:t,connection:e,networkID:r,transactions:o,pendingSwapActivityRows:n,accountIdentifier:s,accountSigner:c,storage:p})=>{let d=new ge.PublicKey(t),m="";for(let[f,g]of o.entries()){let y=It(g,"bs58"),w=m_({networkID:r,transaction:y,feePayer:d,connection:e,pendingActivityRows:n[f],accountIdentifier:s,accountSigner:c,storage:p});try{m="",m=await ts(w),f!==o.length-1&&await No({connection:e,signature:m})}catch(S){return{signature:m??"",error:S instanceof Error?S:new Error("Failed to process solana swap transaction")}}}return{signature:m??""}},"swapTransactionSolana");var Qr=class{static{i(this,"SolanaSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;constructor(e,r,o,n,s,c){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c}async createTransaction(){return ps({quote:this.quote,connection:this.connection})}async swap(e,r,o,n,s){let c=this.parsePendingActivity(this.executingQuote,r),{signature:p,error:d}=await uu({callerAddress:this.takerAddress,connection:this.connection,networkID:this.networkId,transactions:r.transactions,pendingSwapActivityRows:c.pendingSwapActivityRows,accountIdentifier:e,accountSigner:n,storage:s});if(d)throw d;return{networkID:this.networkId,id:p}}async waitForConfirmation(e){let r=Jn(e.networkID);await No({connection:r,signature:e.id})}parsePendingActivity(e,r){let o=Be(Le(e.quote));return Ir({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:o,t:v.t})}};var f_=a.object({signature:a.string()}),lu=class extends Qr{static{i(this,"GaslessSolanaSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;gaslessSignature;constructor(e,r,o,n,s,c,p){super(e,r,o,n,s,c),this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c,this.gaslessSignature=p}async swap(e,r,o,n,s){let c=this.quote.transactionData[0];if(!c)throw new Error("No transaction data found in quote");let p=new ge.PublicKey(this.takerAddress),m=this.parsePendingActivity(this.executingQuote,r).pendingSwapActivityRows[0];if(!m)throw new Error("Unable to create pending activity for gasless");let f=await fc({accountIdentifier:e,feePayer:p,connection:this.connection,accountSigner:n,transaction:It(c,"bs58"),pendingTransactionInput:{ownerAddress:p.toBase58(),networkID:this.networkId,data:{signature:this.gaslessSignature},type:ft.Swap,display:{summary:m}},storage:s,opts:{}});return{id:(await this.submitGaslessSwap(this.gaslessSignature,f)).signature,networkID:this.networkId}}async submitGaslessSwap(e,r){let o=await z.api().post("/gasless-swap/v1/submit",{quoteSignature:e,encoding:"bs58",chainId:this.networkId,transaction:hb.default.encode(r.serialize())}),n=f_.safeParse(o.data);if(!n.success)throw new Error("Failed to submit gasless swap");return n.data}};u();l();var h_=a.object({quoteId:a.string(),transactionId:a.string()}),pu=class extends Qr{static{i(this,"RFQSolanaSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;constructor(e,r,o,n,s,c){super(e,r,o,n,s,c),this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c}async swap(e,r,o,n,s){let c=this.quote.transactionData[0];if(!c)throw new Error("No transaction data found in quote");let p=new ge.PublicKey(this.takerAddress),m=this.parsePendingActivity(this.executingQuote,r).pendingSwapActivityRows[0];if(!m)throw new Error("Unable to create pending activity for rfq");let f=await fc({accountIdentifier:e,feePayer:p,connection:this.connection,accountSigner:n,transaction:It(c,"bs58"),pendingTransactionInput:{ownerAddress:p.toBase58(),networkID:this.networkId,data:{signature:""},type:ft.Swap,display:{summary:m}},storage:s,opts:{}});return{id:(await this.submitRFQSwap(f)).transactionId,networkID:this.networkId}}async submitRFQSwap(e){let r=Buffer.from(e.serialize()).toString("base64"),o=await z.api().post("/v0/rfq/swap",{chainId:this.networkId,quoteId:this.quote.rfqProps?.quoteId,signedPayload:r},{headers:{"X-Request-Id":this.executionId}}),n=h_.safeParse(o.data);if(!n.success)throw new Error("Failed to submit rfq swap");return n.data}};u();l();var du=class{static{i(this,"SolanaBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;solanaSwapCommand;constructor(e,r,o,n,s,c){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c,this.solanaSwapCommand=new Qr(e,r,o,e.quote,s,c)}createTransaction(){return Vi({quote:this.quote,connection:this.connection})}async swap(e,r,o,n,s){return this.solanaSwapCommand.swap(e,r,o,n,s)}async waitForConfirmation(e){return this.solanaSwapCommand.waitForConfirmation(e)}};u();l();u();l();u();l();var g_=i(({networkID:t,transaction:e,feePayer:r,pendingActivityRows:o,accountIdentifier:n,accountSigner:s,storage:c})=>({accountSigner:s,accountIdentifier:n,transaction:e,pendingTransactionInput:{ownerAddress:r,networkID:t,data:{digest:""},type:ft.Swap,display:{summary:o}},storage:c}),"buildArgs"),mu=i(async({callerAddress:t,networkID:e,transactions:r,pendingSwapActivityRows:o,accountIdentifier:n,accountSigner:s,storage:c})=>{let p="";for(let[d,m]of r.entries()){let f=g_({networkID:e,transaction:dc.deserializeTransactionString(m),feePayer:t,pendingActivityRows:o[d],accountIdentifier:n,accountSigner:s,storage:c});try{p=(await Qy(f)).digest,d!==r.length-1&&await mc(e,p)}catch(g){return{signature:p??"",error:g instanceof Error?g:new Error("Failed to process sui swap transaction")}}}return{signature:p??""}},"swapTransactionSui");var hs=class{static{i(this,"SuiSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,o,n,s){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s}async createTransaction(){return Yi({quote:this.quote})}async swap(e,r,o,n,s){let c=this.parsePendingActivity(this.executingQuote,r),{signature:p,error:d}=await mu({callerAddress:this.takerAddress,networkID:this.networkId,transactions:r.transactions,pendingSwapActivityRows:c.pendingSwapActivityRows,accountIdentifier:e,accountSigner:n,storage:s});if(d)throw d;return{networkID:this.networkId,id:p}}async waitForConfirmation(e){await mc(this.networkId,e.id)}parsePendingActivity(e,r){let o=Be(Le(e.quote));return Ir({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:o,t:v.t})}};var fu=class{static{i(this,"SuiBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;suiSwapCommand;constructor(e,r,o,n,s){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.suiSwapCommand=new hs(e,r,o,e.quote,s)}async createTransaction(){return Zi({quote:this.quote})}async swap(e,r,o,n,s){return this.suiSwapCommand.swap(e,r,o,n,s)}async waitForConfirmation(e){return this.suiSwapCommand.waitForConfirmation(e)}};var hu=class{static{i(this,"WalletSwapCommandFactory")}bridgeStatusManager;constructor(e){this.bridgeStatusManager=e}create(e,r,o,n,s,c,p){if(DS(e.quote)&&(De(e.buy)||De(e.sell)))return new su(e,r,o,e.quote,Oe(),n,s,c);if(I.isSolanaNetworkID(o)&&Ht(e.quote)){let d=new Qr(e,r,o,e.quote,Oe(),n);return e.quote.rfqProps?new pu(e,r,o,e.quote,Oe(),n):e.quote.gaslessSignature?new lu(e,r,o,e.quote,Oe(),n,e.quote.gaslessSignature):d}else{if(I.isEVMNetworkID(o)&&Cr(e.quote))return this.createEvmSwapCommand(e,r,o,p);if(I.isSuiNetworkID(o)&&io(e.quote))return new hs(e,r,o,e.quote,Oe());if(le(e.quote)){if(I.isSolanaNetworkID(o))return this.wrapBridgeTrackingCommand(new du(e,r,o,e.quote,Oe(),n),e);if(I.isEVMNetworkID(o)){let d=this.createEvmSwapCommand(e,r,o,p);return this.wrapBridgeTrackingCommand(new iu(e,r,o,e.quote,Oe(),d),e)}else{if(I.isSuiNetworkID(o))return this.wrapBridgeTrackingCommand(new fu(e,r,o,e.quote,Oe()),e);if(I.isBitcoinNetworkID(o))return this.wrapBridgeTrackingCommand(new ou(e,r,o,e.quote,Oe()),e)}}}throw new Error("Unsupported SwapQuote}")}createEvmSwapCommand(e,r,o,n){let s=n?n.filter(lc):void 0;return s&&s.length===0&&(s=void 0),new cu(e,r,o,e.quote,Oe(),s)}wrapBridgeTrackingCommand(e,r){return!this.bridgeStatusManager||!le(r.quote)?e:new Zc(e,this.bridgeStatusManager,r)}};u();l();u();l();var ra={name:"SwapperNoQuotes",message:"No quotes found"},gs=class extends Jy{static{i(this,"SwapperQuoteStreamEventProducer")}createStreamUrl({amount:e,amountUsd:r,buy:o,sell:n,taker:s,takerDestination:c,slippageTolerance:p,exactOut:d,autoSlippage:m,priorityFee:f,tipAmount:g,isLedger:y,phantomCashAccount:w,isPrediction:S,predictions:b}){let T=new URLSearchParams({taker:s,takerDestination:c,buyToken:N(J(o)),sellToken:N(J(n)),sellAmount:e,sellAmountUsd:r??"",exactOut:d?"true":"false",autoSlippage:m?"true":"false",clientEnableGaslessSwap:"true",phantomCashAccount:w?"true":"false"});return p&&T.set("slippageTolerance",String(p)),f&&T.set("priorityFee",String(f)),g&&T.set("tipAmount",String(g)),y!==void 0&&T.set("isLedger",String(y)),S&&T.set("isPrediction","true"),b&&(T.set("predictionsPlatform",b.platform),T.set("predictionsMintAddress",b.mintAddress),T.set("predictionsTokenPerspective",b.tokenPerspective)),`${this.getApiEnvironment()}/swap/v2/stream/quotes?${T.toString()}`}handleNewQuoteResponse(e,r){let o=this.safeJsonParse(e);if(!o.success||!o.data){r({type:"error",errorResponse:ra});return}try{let n=this.parseSwapQuotesResponse(o.data);r({type:"newQuoteResponse",quoteResponse:n})}catch{r({type:"error",errorResponse:ra})}}handleErrorQuoteResponse(e,r){let o=this.safeJsonParse(e);if(!o.success||!o.data){r({type:"error",errorResponse:ra});return}try{let n=Pc.safeParse(o.data);r({type:"error",errorResponse:n.success?n.data:ra})}catch{r({type:"error",errorResponse:ra})}}parseSwapQuotesResponse(e){let r=new ot({key:"SwapperNoQuotes"});if(Mi.safeParse(e?.type).success===!1)throw k.captureError(new Error("Failed to parse a valid quote type."),_.Swapper),new Error("Invalid input");let o=Ui.safeParse(e);if(!o.success)throw k.captureError(new Error("Failed to parse a valid swap quotes response."),_.Swapper),r;if(o.data.includesAllProviders&&o.data.quotes.length===0)throw r;return o.data}};var gu=class extends gs{static{i(this,"EventStreamQuoteStreamProducer")}eventSource;open(e,r){this.close();let o=this.createStreamUrl(e);this.eventSource=new bc(o,this.getOptionsWithAuth(o));let n=i(s=>{switch(s.type){case"new-quote-response":this.handleNewQuoteResponse(s.data,r);break;case"error-quote-response":this.handleErrorQuoteResponse(s.data,r);break;case"open":r({type:"open"});break;case"error":r({type:"error",errorResponse:{name:"UnknownError",message:s.message}});break;case"close":r({type:"close"});break}},"eventSourceListener");this.eventSource.addEventListener("new-quote-response",n),this.eventSource.addEventListener("error-quote-response",n),this.eventSource.addEventListener("open",n),this.eventSource.addEventListener("error",n),this.eventSource.addEventListener("close",n)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};u();l();var yu=class extends gs{static{i(this,"NativeEventStreamQuoteStreamProducer")}eventSource;open(e,r){this.close();let o=this.createStreamUrl(e);this.eventSource=new bc(o,this.getOptionsWithAuth(o));let n=i(s=>{switch(s.type){case"new-quote-response":this.handleNewQuoteResponse(s.data,r);break;case"error-quote-response":this.handleErrorQuoteResponse(s.data,r);break;case"open":r({type:"open"});break;case"error":r({type:"error",errorResponse:{name:"UnknownError",message:s.message}});break;case"close":r({type:"close"});break}},"eventSourceListener");this.eventSource.addEventListener("new-quote-response",n),this.eventSource.addEventListener("error-quote-response",n),this.eventSource.addEventListener("open",n),this.eventSource.addEventListener("error",n),this.eventSource.addEventListener("close",n)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};u();l();var wu=class{static{i(this,"QuoteStreamer")}producer;listeners=new Set;constructor(e){this.producer=e}openStream(e){this.listeners.forEach(r=>r.onEvent({type:"openRequested"})),this.producer.close(),this.producer.open(e,r=>{this.listeners.forEach(o=>o.onEvent(r)),r.type==="error"&&this.closeStream()})}closeStream(){this.producer.close()}subscribe(e){this.listeners.add(e)}unsubscribe(e){this.listeners.delete(e)}};u();l();u();l();function gb(t){return t<3e5?1e4:t<6e5?15e3:3e4}i(gb,"getBridgeStatusPollInterval");function y_(t){let e="pending";switch(t.status){case"DONE":e="completed";break;case"FAILED":e="failed";break;case"PENDING":case"NOT_FOUND":default:e="pending";break}return{state:e,rawStatus:t.status,updatedAt:Date.now(),fromAddress:t.fromAddress,toAddress:t.toAddress}}i(y_,"normalizeSwapperStatus");var km=class{static{i(this,"BridgeStatusPoller")}args;timeoutId=null;isActive=!1;client;constructor(e){this.args=e,this.client=e.client}start(){this.isActive||(this.isActive=!0,this.scheduleNext(0))}stop(){this.isActive=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}scheduleNext(e){this.isActive&&(this.timeoutId=setTimeout(()=>{this.poll()},e))}async poll(){if(this.isActive)try{let e=await this.client.fetchStatus(this.args.record.transactionHash),r=y_(e),o;switch(r.state){case"completed":o={type:"completed",status:r},this.stop();break;case"failed":o={type:"failed",status:r},this.stop();break;case"pending":default:{o={type:"pending",status:r};let n=Date.now()-this.args.record.startedAt;this.scheduleNext(gb(n));break}}this.args.onEvent(o)}catch(e){this.args.onEvent({type:"error",error:e});let r=Date.now()-this.args.record.startedAt;this.scheduleNext(gb(r))}}};function yb(t){return new km(t)}i(yb,"createBridgeStatusPoller");u();l();var w_=a.object({status:a.string(),sending:a.object({txHash:a.string().optional()}).optional(),receiving:a.object({txHash:a.string().optional()}).optional(),fromAddress:a.string().optional(),toAddress:a.string().optional()}).passthrough(),Su=class{static{i(this,"SwapperStatusClient")}async fetchStatus(e){let r=await z.api().get("/swap/v2/status/lifi",{params:{txHash:e}}),o=r?.data??r,n=w_.safeParse(o);if(!n.success)throw new Error("Unable to parse bridge status response");return n.data}};u();l();var Fm="sdk.bridgeStatus.pending";var Pm=class{static{i(this,"BridgeStatusManager")}storage;client;createPoller;records=new Map;pollers=new Map;listeners=new Set;hydratePromise;constructor(e,r={}){this.storage=e,this.client=r.client??new Su,this.createPoller=r.createPoller??yb}async initialize(){this.hydratePromise||(this.hydratePromise=this.hydrate()),await this.hydratePromise}destroy(){this.pollers.forEach(e=>e.stop()),this.pollers.clear(),this.records.clear()}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}getPendingRecords(){return Array.from(this.records.values())}getPendingActivityRows(e,r){return this.getPendingBridgeActivities(e,r).map(o=>o.row)}getPendingBridgeActivities(e,r){return this.filterRecordsByAddresses(r?.addresses).map(n=>({record:n,row:Tb(n,e)}))}getPendingBridgeTransactions(e,r){return this.filterRecordsByAddresses(r?.addresses).map(n=>wb(n,e))}getPendingBridgeTransactionById(e,r){let o=this.records.get(e);if(o)return wb(o,r)}isPendingBridgeTransaction(e){return this.records.has(e)}async track(e){if(await this.initialize(),!this.shouldTrackQuote(e.executingQuote))return;let r=S_(e.executingQuote),o=this.records.get(e.executionId),n={executionId:e.executionId,transactionHash:e.transactionHash,startedAt:o?.startedAt??Date.now(),quote:r,status:o?.status};this.records.set(e.executionId,n),this.restartPoller(n),await this.persistRecords()}async hydrate(){try{let e=await this.storage.get(Fm)??"[]",r=JSON.parse(e);for(let o of r){let n=this.normalizePersistedRecord(o);n&&(this.records.set(n.executionId,n),this.startPoller(n))}}catch(e){console.error("Failed to hydrate bridge status records",e)}}shouldTrackQuote(e){if(!le(e.quote))return!1;let r=e.sell?.data?.chain?.id,o=e.buy?.data?.chain?.id;return o&&I.isBitcoinNetworkID(o)||r&&I.isBitcoinNetworkID(r)||!1}startPoller(e){let r=this.createPoller({record:e,client:this.client,onEvent:i(o=>this.handlePollerEvent(e.executionId,o),"onEvent")});this.pollers.set(e.executionId,r),r.start()}restartPoller(e){this.stopPoller(e.executionId),this.startPoller(e)}stopPoller(e){let r=this.pollers.get(e);r&&(r.stop(),this.pollers.delete(e))}async persistRecords(){try{let e=Array.from(this.records.values()).map(r=>({executionId:r.executionId,transactionHash:r.transactionHash,startedAt:r.startedAt,quote:r.quote,status:r.status}));await this.storage.set(Fm,JSON.stringify(e))}catch(e){console.error("Failed to persist bridge status records",e)}}removeRecord(e){this.records.delete(e),this.stopPoller(e),this.persistRecords()}normalizePersistedRecord(e){return"quote"in e&&b_(e.quote)?e:null}handlePollerEvent(e,r){let o=this.records.get(e);if(o)switch(r.type){case"pending":o.status=r.status,this.notifyListeners({type:"pending",record:o,status:r.status}),this.persistRecords();break;case"completed":o.status=r.status,this.notifyListeners({type:"completed",record:o,status:r.status}),this.removeRecord(e);break;case"failed":o.status=r.status,this.notifyListeners({type:"failed",record:o,status:r.status}),this.removeRecord(e);break;case"error":this.notifyListeners({type:"error",record:o,error:r.error});break}}notifyListeners(e){this.listeners.forEach(r=>{try{r.onBridgeStatusChange(e)}catch(o){console.error("BridgeStatusListener error",o)}})}filterRecordsByAddresses(e){if(!e?.length)return this.getPendingRecords();let r=T_(e);return this.getPendingRecords().filter(o=>o.quote.accountAddresses.some(n=>r.has(bb(n))))}};function S_(t){if(!le(t.quote))throw new Error("Non-bridge quotes cannot be tracked");return{sell:t.sell,buy:t.buy,quote:t.quote,amount:t.amount,accountAddresses:t.account.addresses}}i(S_,"createQuoteSnapshot");function b_(t){return!!(t&&le(t.quote))}i(b_,"isValidSnapshot");function T_(t){return new Set(t.map(bb))}i(T_,"createAddressLookup");function bb(t){return`${t.networkID}:${A_(t.address,t.networkID)}`}i(bb,"createAddressKey");function A_(t,e){return I.isEVMNetworkID(e)?t.toLowerCase():t}i(A_,"normalizeAddress");function Tb(t,e){let r=t.quote.quote,o=t.quote.sell,n=t.quote.buy,s=xe(r.sellAmount,o?.data.decimals??0),c=xe(r.buyAmount,n?.data.decimals??0),p=o?.data.symbol??"",d=n?.data.symbol??"",m=t.startedAt+K({minutes:20}),f=Date.now(),g=m-f,y=Math.max(0,Math.ceil(g/(60*1e3))),w=y>0?`Est. ${y}m`:"Est. <1m";return{topLeft:{text:e("transactionsPendingSwapping")},topRight:{text:`${c} ${d}`,color:"spotPositive"},bottomLeft:{text:w},bottomRight:{text:`${s} ${p}`}}}i(Tb,"createPendingBridgeActivityRow");function x_(t,e){if(I.isEVMNetworkID(t))return{nonce:0,transactions:[{hash:e.transactionHash,timestamp:e.startedAt,unsignedTransaction:{},confirmations:0}]};if(I.isBitcoinNetworkID(t))return{txID:e.transactionHash,psbtHex:"",confirmations:0};if(I.isSolanaNetworkID(t))return{signature:e.transactionHash};if(I.isSuiNetworkID(t))return{digest:e.transactionHash};throw new Error(`Unsupported network for bridge transaction: ${t}`)}i(x_,"createBridgePendingTransactionData");function wb(t,e){let r=t.quote.sell,o=t.quote.buy,n=r?.data.chain?.id;if(!n)throw new Error("Cannot create pending transaction: missing network ID");let s=Tb(t,e),c=t.quote.accountAddresses.find(w=>w.networkID===n)?.address??"",p=o?.data.chain?.id,d=p?t.quote.accountAddresses.find(w=>w.networkID===p)?.address:void 0,m=d?Vn(d,4):"",f=xe(t.quote.quote.buyAmount,o?.data.decimals??0),g=o?.data.symbol??"",y=`${f} ${g}`;return{id:t.executionId,timestamp:t.startedAt,ownerAddress:c,networkID:n,type:ft.Swap,display:{summary:{topLeft:s.topLeft,topRight:s.topRight,bottomLeft:s.bottomLeft,bottomRight:s.bottomRight},detail:{header:y,assetSymbol:g,uiRecipient:m}},data:x_(n,t)}}i(wb,"createPendingTransactionFromBridgeRecord");var bu=null,Sb=null;function Ab(t){return bu||(bu=new Pm(t)),Sb||(Sb=bu.initialize()),bu}i(Ab,"getBridgeStatusManager");u();l();u();l();var vt=i((t,e)=>!!t&&!!e&&I.compareNetworkID(t,e)!==0,"isBridgeSwap");u();l();var Au=D(Rg()),xb=D(jk()),xu=D(Gk());u();l();u();l();function Jt(t,e,r){if(e.lte(0))return null;let o=N({chainId:t,resourceType:V.nativeToken,slip44:I.getSlip44(t)}),n=I.getTokenDecimals(t),s=I.getTokenSymbol(t);if(!o||!n||!s)return null;let c=e.div(rc(n)),p=r[o];return p?.usd?c.times(p.usd).toNumber():null}i(Jt,"getFeeInUsd");var E_={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"};function C_(t,e){return{type:t,amountUsd:new A(e.amountUSD??0),amount:new A(e.amount??0)}}i(C_,"bridgeFeeToFee");function qo(t){return t.steps.flatMap(e=>e.includedFeeCosts).reduce((e,r)=>{if(!r)return e;let o=E_[r.name];return o&&new A(r.amount).gt(0)&&e.push(C_(o,r)),e},[])}i(qo,"getIncludedBridgeFees");function zo(t,e,r){let o=t.steps.reduce((n,s)=>n.plus(s.nonIncludedNonGasFees),new A(0));return o.isZero()?[]:[{type:"nonIncludedNonGas",amountUsd:new A(Jt(e,o,r)??0),amount:o}]}i(zo,"getNonIncludedBridgeFees");var Tu=class{static{i(this,"BtcProcessBridgeQuoteCommand")}networkID;priceClient;constructor(e,r){this.networkID=e,this.priceClient=r}getNativeTokenCaip19(){return N({chainId:this.networkID,resourceType:V.nativeToken,slip44:I.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!n.usd)throw new Error("Price data not found");let s=await this.calculateNetworkFee(e,n),c=this.appendBridgeFees([s],e,n),p=this.appendPhantomFee(c,e);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:o}}createSwapTransactions(e){let r=[],o=[],n=[];for(let s of e.steps){let{transactionData:c,sellToken:p,buyToken:d}=s;r.push(c),o.push("bridge"),n.push({sellToken:p,buyToken:d})}return Promise.resolve({type:"bitcoin",transactions:r,transactionTypes:o,transactionPairs:n})}appendPhantomFee(e,r){let o=r.steps.flatMap(n=>n.feeCosts).find(n=>n.name==="phantom");return o?[...e,{type:"phantom",percentage:new A(o.percentage),amountUsd:new A(0),amount:new A(0)}]:e}appendBridgeFees(e,r,o){let n={[this.getNativeTokenCaip19()]:o},s=zo(r,this.networkID,n),c=qo(r);return[...e,...c,...s]}async calculateNetworkFee(e,r){if(!r.usd)throw new Error("Price data not found");let o=e.steps.flatMap(n=>n.gasCosts??[]);if(o.length>0){let n=o.reduce((p,d)=>p+d,0);return{type:"bitcoinNetwork",amountUsd:new A(n).shiftedBy(-8).times(r.usd),amount:new A(n)}}try{let n=e.steps[0];if(!n?.transactionData)throw new Error("No transaction data available for fee estimation");let s=Au.Psbt.fromHex(n.transactionData),c=I_(s),d=(await ew(this.networkID))[Ur.standard]?.btcPerKilobyte;if(!d)throw new Error("Failed to get standard fee rate");let f=ky(d).times(c).integerValue(A.ROUND_UP);return{type:"bitcoinNetwork",amountUsd:f.shiftedBy(-8).times(r.usd),amount:f}}catch{let s=new A(1e4);return{type:"bitcoinNetwork",amountUsd:s.shiftedBy(-8).times(r.usd),amount:s}}}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new A(0))}};function I_(t){let{header:e,perInput:r}=uc[Fy(t)],{inputs:o}=t.data,n=new A(e),s=new A(o.length).times(r),c=t.txOutputs.reduce((p,d)=>{let m=xu.decompile(d.script);if(m&&m[0]===xu.OPS.OP_RETURN)return p;let f;if(d.address)f=d.address;else try{f=(0,xb.fromOutputScript)(d.script,Au.networks.bitcoin)}catch{return p.plus(uc[se.BitcoinNativeSegwit].perOutput)}let g=Lg(re.Bitcoin.Mainnet,f);return p.plus(uc[g].perOutput)},new A(0));return n.plus(s).plus(c)}i(I_,"calculateVirtualBytes");u();l();u();l();var Eb=D(O());u();l();var Pe;(function(t){t.SlippageTolerance="slippageTolerance",t.PriorityFee="priorityFee",t.TipAmount="tipAmount",t.LastSubmittedPairs="lastSubmittedPairsV2",t.LastSelectedTokens="lastSelectedTokens",t.SlippageSettings="slippageSettings",t.HasViewedAutoSlippageOptIn="hasViewedAutoSlippageOptIn",t.PriorityFeeSettings="priorityFeeSettings",t.TipSettings="tipSettings"})(Pe||(Pe={}));function Rt({key:t,queryKey:e,defaultValue:r=null}){let o=pt();return oe({enabled:!0,queryKey:e,gcTime:Yc.Long,staleTime:Xc.Never,async queryFn(){try{return await o.get(t)}catch(n){return n instanceof Error&&k.captureError(n,_.Swapper),r}}})}i(Rt,"useSwapStorageValue");function Dt({key:t,queryKey:e}){let r=pt(),o=qe();return sn({async mutationFn(n){try{return await r.set(t,n)}catch(s){s instanceof Error&&k.captureError(s,_.Swapper);return}},async onMutate(n){await o.cancelQueries({queryKey:e});let s=o.getQueryData(e);return o.setQueryData(e,n),{previousValue:s}},onError(n,s,c){o.setQueryData(e,c?.previousValue)}})}i(Dt,"useSetSwapStorageValue");var fe;(function(t){t.Auto="auto",t.Fixed="fixed"})(fe||(fe={}));var k_={type:fe.Auto},jt=i(()=>{let{slippageSetting:t,isFetched:e,save:r}=F_();return{isFetched:e,selectedSetting:t??k_,setSlippageSetting:r}},"useSlippageSettings"),F_=i(()=>{let{data:t,isFetched:e}=Rt({key:Pe.SlippageSettings,queryKey:me.slippageSettings()}),{mutateAsync:r}=Dt({key:Pe.SlippageSettings,queryKey:me.slippageSettings()}),o=(0,Eb.useCallback)(async n=>{await r(n)},[r]);return{isFetched:e,slippageSetting:t,save:o}},"useSlippageSettingsStore");u();l();async function ys({transactions:t,locale:e,url:r,deviceId:o,takerAddress:n,networkId:s,slippageType:c,quote:p,quoteResponse:d,isSimulationKilled:m}){try{return m?{status:"skipped"}:I.isHyperevmNetworkID(s)?{status:"skipped"}:{status:"success",result:await Bi(e,o,{type:"transaction",userAccount:n,params:P_(t),url:r,networkID:s,context:le(p)?"bridge":BS(p)?"gaslessSwap":"swap",provider:__(p),slippageType:c,metadata:{swapper:{quoteOutputAmount:p.buyAmount,quoteOutputToken:N(d.buyToken),quoteInputAmount:p.sellAmount,quoteInputToken:N(d.sellToken)}}})}}catch(f){return{status:"error",error:f}}}i(ys,"simulateSwap");var P_=i(t=>{switch(t.type){case"evm":return{transactions:t.transactions};case"solana":return{transactions:t.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}};case"sui":case"bitcoin":return{transactions:t.transactions,method:"signAndSendTransaction"}}},"getScannedTransactionParams"),__=i(t=>{let e=le(t)?ms(t):t?.sources??[];return Be(e)},"getProvider");var Eu=class{static{i(this,"EVMProcessBridgeQuoteCommand")}networkID;account;priceClient;quoteInput;quoteResponse;constructor(e,r,o,n,s){this.networkID=e,this.account=r,this.priceClient=o,this.quoteInput=n,this.quoteResponse=s}getNativeTokenCaip19(){return N({chainId:this.networkID,resourceType:V.nativeToken,slip44:I.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!n.usd)throw new Error("Price data not found");let s=await this.calculateNetworkFee(o,e,n,r),c=this.appendBridgeFees([s],e,n),p=this.appendPhantomFee(c,e);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:o}}createSwapTransactions(e){return Ki({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:e})}appendPhantomFee(e,r){let o=r.steps.flatMap(n=>n.feeCosts).find(n=>n.name==="phantom");return o?[...e,{type:"phantom",percentage:new A(o.percentage),amountUsd:new A(0),amount:new A(0)}]:e}appendBridgeFees(e,r,o){let n={[this.getNativeTokenCaip19()]:o},s=zo(r,this.networkID,n),c=qo(r);return[...e,...c,...s]}async calculateNetworkFee(e,r,o,n){let s=await this.estimateGas(r,e,n);if(!s)throw new Error("Unable to estimate gas");if(!o.usd)throw new Error("Price data not found");let c=s[0],p=I.getTokenDecimals(this.networkID),d=c.gasLimit.times(c.maxFeePerGas);return{type:"evmGas",amountUsd:new A(d).shiftedBy(-p).times(o.usd),amount:d}}async estimateGas(e,r,o){let n=await Xn(this.networkID,!0);if(!n)return;let s=n[Ur.standard];if(!s)return;let c={networkID:this.networkID,gasLimit:new A(1),maxFeePerGas:s.maxFeePerGas,maxPriorityFeePerGas:s.maxPriorityFeePerGas},p=await ys({transactions:r,locale:"en-us",url:"https://phantom.app",deviceId:"123",takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?fe.Auto:fe.Fixed,quote:e,quoteResponse:this.quoteResponse,isSimulationKilled:o});return fs.estimateGas({swapTransactions:r,evmGasEstimation:c,currentQuote:e,scanResult:p.status==="success"?p.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let e=this.account.addresses.find(o=>o.networkID===this.networkID);if(!e)throw new Error(`No address found for chain ${this.networkID}`);let r={...e};return Br(r)&&(r.address=r.address.toLowerCase()),r}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new A(0))}};u();l();var Cu=class{static{i(this,"EVMProcessQuoteCommand")}networkID;account;priceClient;quoteInput;quoteResponse;constructor(e,r,o,n,s){this.networkID=e,this.account=r,this.priceClient=o,this.quoteInput=n,this.quoteResponse=s}getNativeTokenCaip19(){return N({chainId:this.networkID,resourceType:V.nativeToken,slip44:I.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.calculateNetworkFee(o,e,r),s=this.appendPhantomFee([n],e);return{quote:e,fees:{totalFees:this.sumFees(s),fees:s},swapTransactions:o}}createSwapTransactions(e){return Wi({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:e,sellFungible:this.quoteInput.sell})}appendPhantomFee(e,r){let o=r.fees.find(n=>n.type==="phantom");return o?[...e,{type:"phantom",percentage:new A(o.percentage),amountUsd:new A(0),amount:new A(0)}]:e}async calculateNetworkFee(e,r,o){let n=await this.estimateGas(r,e,o);if(!n)throw new Error("Unable to estimate gas");let s=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!s.usd)throw new Error("Price data not found");let c=n[0],p=I.getTokenDecimals(this.networkID),d=c.gasLimit.times(c.maxFeePerGas);return{type:"evmGas",amountUsd:new A(d).shiftedBy(-p).times(s.usd),amount:d}}async estimateGas(e,r,o){let n=await Xn(this.networkID,!0);if(!n)return;let s=n[Ur.standard];if(!s)return;let c={networkID:this.networkID,gasLimit:new A(1),maxFeePerGas:s.maxFeePerGas,maxPriorityFeePerGas:s.maxPriorityFeePerGas},p=await ys({transactions:r,locale:"en-us",url:"https://phantom.app",deviceId:"123",takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?fe.Auto:fe.Fixed,quote:e,quoteResponse:this.quoteResponse,isSimulationKilled:o});return fs.estimateGas({swapTransactions:r,evmGasEstimation:c,currentQuote:e,scanResult:p.status==="success"?p.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let e=this.account.addresses.find(o=>o.networkID===this.networkID);if(!e)throw new Error(`No address found for chain ${this.networkID}`);let r={...e};return Br(r)&&(r.address=r.address.toLowerCase()),r}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new A(0))}};u();l();var Iu=class{static{i(this,"SolanaProcessBridgeQuoteCommand")}networkID;priceClient;connection;constructor(e,r,o){this.networkID=e,this.priceClient=r,this.connection=o}getNativeTokenCaip19(){return N({chainId:this.networkID,resourceType:V.nativeToken,slip44:I.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!n.usd)throw new Error("Price data not found");let s=await this.calculateNetworkFee(o,n),c=this.appendBridgeFees([s],e,n),p=this.appendPhantomFee(c,e);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:o}}createSwapTransactions(e){return Vi({quote:e,connection:this.connection})}appendPhantomFee(e,r){let o=r.steps.flatMap(n=>n.feeCosts).find(n=>n.name==="phantom");return o?[...e,{type:"phantom",percentage:new A(o.percentage),amountUsd:new A(0),amount:new A(0)}]:e}appendBridgeFees(e,r,o){let n={[this.getNativeTokenCaip19()]:o},s=zo(r,this.networkID,n),c=qo(r);return[...e,...c,...s]}async calculateNetworkFee(e,r){if(!r.usd)throw new Error("Price data not found");let o=e.transactions.map(m=>this.processEncodedTx(m,this.networkID,this.connection)),s=(await Promise.all(o)).map(m=>m.networkFeeEstimation.value),c=new A(s[0]);return{type:"solanaNetwork",amountUsd:c.div(new A(ge.LAMPORTS_PER_SOL)).times(r.usd),amount:c}}async processEncodedTx(e,r,o){let n=It(e,"bs58");return await Xa(n,o),{networkFeeEstimation:await Hy(r,[n.message])}}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new A(0))}};u();l();u();l();function Cb(t,e){return v_(t.fees,r=>{switch(r.type){case"gasless":return{type:"gasless",amountUsd:new A(0),amount:new A(0),percentage:new A(r.percentage)};case"phantom":return{type:"phantom",percentage:new A(r.percentage),amountUsd:new A(0),amount:new A(0)};case"ata":return new A(r.amount).isZero()?void 0:{type:"ata",amountUsd:new A(r.amount),amount:new A(0)};case"gasless_network":return{type:"solanaGaslessNetwork",amountUsd:new A(r.amount),amount:new A(0)};case"network":{let{amountUsd:o,amount:n}=_m(r,e);return{type:"solanaNetwork",amountUsd:o,amount:n}}case"tips":{let{amountUsd:o,amount:n}=_m(r,e);return{type:"tips",amountUsd:o,amount:n}}case"priority_fee":{let{amountUsd:o,amount:n}=_m(r,e);return{type:"priorityFee",amountUsd:o,amount:n}}case"prediction_fee_per_contract":return{type:"predictionFeePerContract",amountUsd:new A(r.amount),amount:new A(r.amount)};default:return}})}i(Cb,"parseFees");function _m(t,e){let r=new A(t.amount);return{amountUsd:r.div(new A(ge.LAMPORTS_PER_SOL)).times(e),amount:r}}i(_m,"getAmountsFromNativeAmount");function v_(t,e){return t.reduce((r,o,n)=>{let s=e(o,n,t);return s!=null&&r.push(s),r},[])}i(v_,"compactMap");var Ib=["solanaNetwork","tips","priorityFee"],ku=class{static{i(this,"SolanaProcessQuoteCommand")}networkID;priceClient;connection;constructor(e,r,o){this.networkID=e,this.priceClient=r,this.connection=o}getNativeTokenCaip19(){return N({chainId:this.networkID,resourceType:V.nativeToken,slip44:I.getSlip44(this.networkID)})}async processQuote(e,r){let n=(await this.priceClient.getPrice(this.getNativeTokenCaip19())).usd;if(!n)throw new Error(`Price data not found for native token ${this.getNativeTokenCaip19()}`);let s=await this.createSwapTransactions(e),c=Cb(e,n),p=await this.processParsedFees(c,n);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:s}}async processParsedFees(e,r){if(e.find(d=>d.type==="solanaGaslessNetwork"))return e;let o=e.filter(d=>!Ib.includes(d.type)),n=e.filter(d=>Ib.includes(d.type)),s=e.find(d=>d.type==="priorityFee"),c=await this.calculateNetworkFee(s,r),p=this.sumNetworkFees(c,n);return[...o,p]}sumNetworkFees(e,r){return r.reduce((o,n)=>({...o,amount:o.amount.plus(n.amount),amountUsd:o.amountUsd.plus(n.amountUsd)}),e)}createSwapTransactions(e){return ps({quote:e,connection:this.connection})}getAmountsFromNativeAmount(e,r){let o=new A(e.amount);return{amountUsd:o.div(new A(ge.LAMPORTS_PER_SOL)).times(r),amount:o}}async calculateNetworkFee(e,r){let o=new A(e?.amount??0);return{type:"solanaNetwork",amountUsd:o.div(new A(ge.LAMPORTS_PER_SOL)).times(r),amount:o}}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new A(0))}};u();l();u();l();var ws=class{static{i(this,"SuiProcessQuoteCommand")}networkID;priceClient;constructor(e,r){this.networkID=e,this.priceClient=r}getNativeTokenCaip19(){return N({chainId:this.networkID,resourceType:V.nativeToken,slip44:I.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.calculateNetworkFee(o),s=this.appendPhantomFee([n],e);return{quote:e,fees:{totalFees:this.sumFees(s),fees:s},swapTransactions:o}}createSwapTransactions(e){return Yi({quote:e})}appendPhantomFee(e,r){let o=r.fees.find(n=>n.type==="phantom");return o?[...e,{type:"phantom",percentage:new A(o.percentage),amountUsd:new A(0),amount:new A(0)}]:e}async calculateNetworkFee(e){let r=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!r.usd)throw new Error("Price data not found");let o=new A(0),n=new A(0);try{let s=await Promise.all(e.transactions.map(c=>zy({networkID:this.networkID,transaction:dc.deserializeTransactionString(c)})));n=new A(s.reduce((c,p)=>c+p.gasBudget.toNumber(),0)),o=n.dividedBy(1e9).multipliedBy(r.usd)}catch{return{type:"suiNetwork",amountUsd:new A(0),amount:new A(0)}}return{type:"suiNetwork",amountUsd:o,amount:n}}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new A(0))}};var Fu=class{static{i(this,"SuiBridgeProcessQuoteCommand")}networkID;priceClient;suiProcessQuoteCommand;constructor(e,r){this.networkID=e,this.priceClient=r,this.suiProcessQuoteCommand=new ws(e,r)}getNativeTokenCaip19(){return this.suiProcessQuoteCommand.getNativeTokenCaip19()}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!n.usd)throw new Error("Price data not found");let s=await this.suiProcessQuoteCommand.calculateNetworkFee(o),c=this.appendBridgeFees([s],e,n),p=this.appendPhantomFee(c,e);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:o}}appendBridgeFees(e,r,o){let n={[this.getNativeTokenCaip19()]:o},s=zo(r,this.networkID,n),c=qo(r);return[...e,...c,...s]}appendPhantomFee(e,r){let o=r.steps.flatMap(n=>n.feeCosts).find(n=>n.name==="phantom");return o?[...e,{type:"phantom",percentage:new A(o.percentage),amountUsd:new A(0),amount:new A(0)}]:e}createSwapTransactions(e){return Zi({quote:e})}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new A(0))}};var Pu=class{static{i(this,"ProcessQuoteCommandFactoryImpl")}create(e,r,o,n){let s=r.sell.data.chain.id,c=r.buy.data.chain.id,p=vt(s,c);if(I.isSolanaNetworkID(s)){let d=rw(e).connection;return p?new Iu(s,this.priceClient,d):new ku(s,this.priceClient,d)}else{if(I.isEVMNetworkID(s))return p?new Eu(s,e,this.priceClient,r,o):new Cu(s,e,this.priceClient,r,o);if(I.isSuiNetworkID(s))return p?new Fu(s,this.priceClient):new ws(s,this.priceClient);if(I.isBitcoinNetworkID(s)&&p)return new Tu(s,this.priceClient)}throw new Error(`Unsupported network ID: ${s}`)}priceClient={getPrice:i(async e=>(await Sc({tokens:[Ve(e)]}))[e],"getPrice")};isSupportedNetwork(e){return I.isSolanaNetworkID(e)||I.isEVMNetworkID(e)}},_u=class{static{i(this,"NoOpProcessQuoteCommandFactory")}create(e,r,o,n){return{processQuote:i(async(s,c)=>({quote:s,fees:{totalFees:new A(0),fees:[]}}),"processQuote")}}};u();l();u();l();u();l();var kb="CASH";u();l();var Fb=i(t=>t.reduce((e,r)=>{if(!r||r.type!==ae.SPL)return e;let o;return r.type===ae.SPL&&(o=R_(r)),o?{fees:[...e.fees,o],totalPercentFees:e.totalPercentFees+o.percentFee}:e},{fees:[],totalPercentFees:0}),"getSwapTransferFees"),R_=i(t=>{if(t.type!==ae.SPL)return;let r=(t.data.mintExtensions??[]).find(o=>o.extension===gc.transferFeeConfig);if(r)return{caip19:N(J(t)),fungibleKey:t.data.key,symbol:t.data.symbol??"",name:t.data.name??"",percentFee:r.state.newerTransferFee.transferFeeBasisPoints/100}},"getSplTransferFee");u();l();var D_=i(t=>t.isGreaterThanOrEqualTo(1)?"0,0.[00]":"0,0.[00000]","getFormatString"),Ss=i(t=>{let e=A(t);return Zg(t,D_(e))},"formatTokenAmountGreaterThan1");var B_=.05,N_=5,L_=.5;function vm(t,e,r,o){let{priceImpact:n,quoteSlippageTolerance:s}=M_(t),c=e.autoSlippage?s??r.slippageTolerance:r.slippageTolerance,p={type:"slippage",slippage:c,slippageType:e.autoSlippage?fe.Auto:fe.Fixed,alert:c&&c>=N_?"highSlippage":void 0},d={type:"priceImpact",priceImpactPercentage:n.gt(0)?Yg(n.toNumber()):"-",alert:n&&n.gte(B_)?"highPriceImpact":void 0,warning:n&&n.gte(L_)?"veryHighPriceImpact":void 0},f=[Rm(t,e.buy,e.sell),p,d],g=Fb([e.sell,e.buy]);return g.fees.length>0&&f.push({type:"transferFees",transferFees:g.totalPercentFees,transferTokenSymbol:e.sell.data.symbol??"",alert:"transferFees"}),o&&f.push({type:"fees",quoteFees:o}),f}i(vm,"entriesForQuote");function M_(t){return Ht(t)?{priceImpact:t.priceImpact?A(t.priceImpact):A(0),quoteSlippageTolerance:t.slippageTolerance}:Cr(t)?{priceImpact:t.priceImpact?A(t.priceImpact):A(0),quoteSlippageTolerance:t.slippageTolerance}:io(t)?{priceImpact:t.priceImpact?A(t.priceImpact):A(0),quoteSlippageTolerance:t.slippageTolerance}:{priceImpact:A(0),quoteSlippageTolerance:void 0}}i(M_,"extractQuoteInfo");function Rm(t,e,r){let{buyAmount:o,sellAmount:n}=t,s=new A(o).shiftedBy(-e.data.decimals).dividedBy(new A(n).shiftedBy(-r.data.decimals));return{type:"pricing",ratio:s,exchangeRate:`1 ${vu(r)} \u2248 ${Ss(s)} ${vu(e)}`,exchangeRateFlipped:`1 ${vu(e)} \u2248 ${Ss(A(1).dividedBy(s))} ${vu(r)}`}}i(Rm,"parsePricing");function vu(t){return wc(t)?kb:t.data.symbol??""}i(vu,"cashDeobfuscatedSymbol");u();l();var Ru=class{static{i(this,"AsyncQueue")}queue=[];processing=!1;enqueue(e){this.queue.push(e),this.processNext()}clearQueue(){this.queue=[],this.processing=!1}async processNext(){if(this.processing||this.queue.length===0)return;this.processing=!0;let e=this.queue.shift();if(e)try{await e()}catch(r){console.error("Error processing task:",r)}this.processing=!1,this.processNext()}};u();l();var oa=class{static{i(this,"QuoteDetails")}entries;alerts=[];warnings=[];constructor(e){this.entries=e;for(let r of e)r.alert&&this.alerts.push(r.alert),r.warning&&this.warnings.push(r.warning)}};u();l();var Dm;(function(t){t.SwapperNoQuotes="SwapperNoQuotes",t.InsufficientSellAmount="InsufficientSellAmount",t.CrossChainUnavailable="CrossChainUnavailable",t.TokenNotTradable="TokenNotTradable",t.NotEnoughSuiObjects="NotEnoughSuiObjects",t.FromTokenIsHoneyPotToken="FromTokenIsHoneyPotToken",t.ToTokenIsHoneyPotToken="ToTokenIsHoneyPotToken",t.InsufficientLiquidity="InsufficientLiquidity",t.SwapInitializationFailed="SwapInitializationFailed",t.pSolHighImpactError="pSolHighImpactError"})(Dm||(Dm={}));var Du=class t extends Error{static{i(this,"QuoteError")}name;type;constructor(e,r,o){super(r),this.name=e,this.type=o}static fromErrorResponse(e,r){return i(n=>Object.values(Dm).includes(n),"isValidType")(e)?new t(e,r,e):new t(e,r)}};var U_="swap-quotes",Bu=class{static{i(this,"QuoteProcessor")}quoteStreamer;commandFactory;state={type:"idle"};listeners=[];swapTransactionQueue=new Ru;constructor(e,r){this.quoteStreamer=e,this.commandFactory=r}start(e,r){this.setState({type:"starting",input:e,account:r}),this.quoteStreamer.subscribe(this.quoteStreamListener),this.quoteStreamer.openStream(e)}stop(){this.swapTransactionQueue.clearQueue(),this.setState({type:"idle"}),this.quoteStreamer.closeStream(),this.quoteStreamer.unsubscribe(this.quoteStreamListener)}setQuoteStreamer(e){this.stop(),this.quoteStreamer=e}quoteStreamListener={onEvent:i(e=>{switch(e.type){case"newQuoteResponse":switch(this.state.type){case"starting":let n=this.findPreferredQuote(this.state.input,e.quoteResponse);this.setState({type:"firstQuoteReceived",input:this.state.input,quote:n,response:e.quoteResponse,account:this.state.account,quoteDetails:new oa(vm(n,this.state.input,e.quoteResponse))}),this.enqueueQuoteToProcess(this.state.input,e.quoteResponse,this.state.account);break;case"quoteProcessed":this.enqueueQuoteToProcess(this.state.input,e.quoteResponse,this.state.account,this.state.prevProcessedQuote);break}break;case"error":let r=Du.fromErrorResponse(e.errorResponse.name,e.errorResponse.message),o=new ot({key:r.name});switch(k.addBreadcrumb(U_,JSON.stringify(r.name),L.Info),this.state.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"error",error:o,quoteError:r,account:this.state.account,input:this.state.input});break}break;case"openRequested":break;case"close":this.setState({type:"idle"});break}},"onEvent")};enqueueQuoteToProcess(e,r,o,n){this.swapTransactionQueue.enqueue(()=>this.processQuote(r,e,o,n))}async processQuote(e,r,o,n){try{let s=this.findPreferredQuote(r,e),p=await this.commandFactory.create(o,r,e,r.isSimulationKilled).processQuote(s,r.isSimulationKilled);switch(this.state.type){case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"quoteProcessed",input:r,response:e,quote:s,prevProcessedQuote:n,nextProcessedQuote:p,account:o,quoteDetails:new oa(vm(s,r,e,p.fees))});break}return p}catch(s){throw k.captureError(s,_.Swapper),s}}subscribe(e){this.listeners.push(e)}unsubscribe(e){this.listeners=this.listeners.filter(r=>r!==e)}getState(){return this.state}findPreferredQuote(e,r){let o=e.preferredProvider;return o&&r.quotes.find(n=>n.baseProvider.id===o)||r.quotes[0]}setState(e){let r=this.state;this.state=e,this.listeners.forEach(o=>o.onStateChange(r,e))}};u();l();u();l();u();l();u();l();function Cs(t){let e=t.length;for(;--e>=0;)t[e]=0}i(Cs,"zero$1");var O_=0,mT=1,q_=2,z_=3,Q_=258,of=29,wa=256,la=wa+1+of,As=30,nf=19,fT=2*la+1,dn=15,Bm=16,H_=7,sf=256,hT=16,gT=17,yT=18,Vm=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),qu=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),G_=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),wT=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),j_=512,po=new Array((la+2)*2);Cs(po);var aa=new Array(As*2);Cs(aa);var pa=new Array(j_);Cs(pa);var da=new Array(Q_-z_+1);Cs(da);var af=new Array(of);Cs(af);var zu=new Array(As);Cs(zu);function Nm(t,e,r,o,n){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=o,this.max_length=n,this.has_stree=t&&t.length}i(Nm,"StaticTreeDesc");var ST,bT,TT;function Lm(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}i(Lm,"TreeDesc");var AT=i(t=>t<256?pa[t]:pa[256+(t>>>7)],"d_code"),ma=i((t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},"put_short"),$t=i((t,e,r)=>{t.bi_valid>Bm-r?(t.bi_buf|=e<<t.bi_valid&65535,ma(t,t.bi_buf),t.bi_buf=e>>Bm-t.bi_valid,t.bi_valid+=r-Bm):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},"send_bits"),Gr=i((t,e,r)=>{$t(t,r[e*2],r[e*2+1])},"send_code"),xT=i((t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},"bi_reverse"),$_=i(t=>{t.bi_valid===16?(ma(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},"bi_flush"),K_=i((t,e)=>{let r=e.dyn_tree,o=e.max_code,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,c=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,d=e.stat_desc.max_length,m,f,g,y,w,S,b=0;for(y=0;y<=dn;y++)t.bl_count[y]=0;for(r[t.heap[t.heap_max]*2+1]=0,m=t.heap_max+1;m<fT;m++)f=t.heap[m],y=r[r[f*2+1]*2+1]+1,y>d&&(y=d,b++),r[f*2+1]=y,!(f>o)&&(t.bl_count[y]++,w=0,f>=p&&(w=c[f-p]),S=r[f*2],t.opt_len+=S*(y+w),s&&(t.static_len+=S*(n[f*2+1]+w)));if(b!==0){do{for(y=d-1;t.bl_count[y]===0;)y--;t.bl_count[y]--,t.bl_count[y+1]+=2,t.bl_count[d]--,b-=2}while(b>0);for(y=d;y!==0;y--)for(f=t.bl_count[y];f!==0;)g=t.heap[--m],!(g>o)&&(r[g*2+1]!==y&&(t.opt_len+=(y-r[g*2+1])*r[g*2],r[g*2+1]=y),f--)}},"gen_bitlen"),ET=i((t,e,r)=>{let o=new Array(dn+1),n=0,s,c;for(s=1;s<=dn;s++)n=n+r[s-1]<<1,o[s]=n;for(c=0;c<=e;c++){let p=t[c*2+1];p!==0&&(t[c*2]=xT(o[p]++,p))}},"gen_codes"),V_=i(()=>{let t,e,r,o,n,s=new Array(dn+1);for(r=0,o=0;o<of-1;o++)for(af[o]=r,t=0;t<1<<Vm[o];t++)da[r++]=o;for(da[r-1]=o,n=0,o=0;o<16;o++)for(zu[o]=n,t=0;t<1<<qu[o];t++)pa[n++]=o;for(n>>=7;o<As;o++)for(zu[o]=n<<7,t=0;t<1<<qu[o]-7;t++)pa[256+n++]=o;for(e=0;e<=dn;e++)s[e]=0;for(t=0;t<=143;)po[t*2+1]=8,t++,s[8]++;for(;t<=255;)po[t*2+1]=9,t++,s[9]++;for(;t<=279;)po[t*2+1]=7,t++,s[7]++;for(;t<=287;)po[t*2+1]=8,t++,s[8]++;for(ET(po,la+1,s),t=0;t<As;t++)aa[t*2+1]=5,aa[t*2]=xT(t,5);ST=new Nm(po,Vm,wa+1,la,dn),bT=new Nm(aa,qu,0,As,dn),TT=new Nm(new Array(0),G_,0,nf,H_)},"tr_static_init"),CT=i(t=>{let e;for(e=0;e<la;e++)t.dyn_ltree[e*2]=0;for(e=0;e<As;e++)t.dyn_dtree[e*2]=0;for(e=0;e<nf;e++)t.bl_tree[e*2]=0;t.dyn_ltree[sf*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},"init_block"),IT=i(t=>{t.bi_valid>8?ma(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},"bi_windup"),Pb=i((t,e,r,o)=>{let n=e*2,s=r*2;return t[n]<t[s]||t[n]===t[s]&&o[e]<=o[r]},"smaller"),Mm=i((t,e,r)=>{let o=t.heap[r],n=r<<1;for(;n<=t.heap_len&&(n<t.heap_len&&Pb(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!Pb(e,o,t.heap[n],t.depth));)t.heap[r]=t.heap[n],r=n,n<<=1;t.heap[r]=o},"pqdownheap"),_b=i((t,e,r)=>{let o,n,s=0,c,p;if(t.sym_next!==0)do o=t.pending_buf[t.sym_buf+s++]&255,o+=(t.pending_buf[t.sym_buf+s++]&255)<<8,n=t.pending_buf[t.sym_buf+s++],o===0?Gr(t,n,e):(c=da[n],Gr(t,c+wa+1,e),p=Vm[c],p!==0&&(n-=af[c],$t(t,n,p)),o--,c=AT(o),Gr(t,c,r),p=qu[c],p!==0&&(o-=zu[c],$t(t,o,p)));while(s<t.sym_next);Gr(t,sf,e)},"compress_block"),Wm=i((t,e)=>{let r=e.dyn_tree,o=e.stat_desc.static_tree,n=e.stat_desc.has_stree,s=e.stat_desc.elems,c,p,d=-1,m;for(t.heap_len=0,t.heap_max=fT,c=0;c<s;c++)r[c*2]!==0?(t.heap[++t.heap_len]=d=c,t.depth[c]=0):r[c*2+1]=0;for(;t.heap_len<2;)m=t.heap[++t.heap_len]=d<2?++d:0,r[m*2]=1,t.depth[m]=0,t.opt_len--,n&&(t.static_len-=o[m*2+1]);for(e.max_code=d,c=t.heap_len>>1;c>=1;c--)Mm(t,r,c);m=s;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Mm(t,r,1),p=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=p,r[m*2]=r[c*2]+r[p*2],t.depth[m]=(t.depth[c]>=t.depth[p]?t.depth[c]:t.depth[p])+1,r[c*2+1]=r[p*2+1]=m,t.heap[1]=m++,Mm(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],K_(t,e),ET(r,d,t.bl_count)},"build_tree"),vb=i((t,e,r)=>{let o,n=-1,s,c=e[0*2+1],p=0,d=7,m=4;for(c===0&&(d=138,m=3),e[(r+1)*2+1]=65535,o=0;o<=r;o++)s=c,c=e[(o+1)*2+1],!(++p<d&&s===c)&&(p<m?t.bl_tree[s*2]+=p:s!==0?(s!==n&&t.bl_tree[s*2]++,t.bl_tree[hT*2]++):p<=10?t.bl_tree[gT*2]++:t.bl_tree[yT*2]++,p=0,n=s,c===0?(d=138,m=3):s===c?(d=6,m=3):(d=7,m=4))},"scan_tree"),Rb=i((t,e,r)=>{let o,n=-1,s,c=e[0*2+1],p=0,d=7,m=4;for(c===0&&(d=138,m=3),o=0;o<=r;o++)if(s=c,c=e[(o+1)*2+1],!(++p<d&&s===c)){if(p<m)do Gr(t,s,t.bl_tree);while(--p!==0);else s!==0?(s!==n&&(Gr(t,s,t.bl_tree),p--),Gr(t,hT,t.bl_tree),$t(t,p-3,2)):p<=10?(Gr(t,gT,t.bl_tree),$t(t,p-3,3)):(Gr(t,yT,t.bl_tree),$t(t,p-11,7));p=0,n=s,c===0?(d=138,m=3):s===c?(d=6,m=3):(d=7,m=4)}},"send_tree"),W_=i(t=>{let e;for(vb(t,t.dyn_ltree,t.l_desc.max_code),vb(t,t.dyn_dtree,t.d_desc.max_code),Wm(t,t.bl_desc),e=nf-1;e>=3&&t.bl_tree[wT[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},"build_bl_tree"),Z_=i((t,e,r,o)=>{let n;for($t(t,e-257,5),$t(t,r-1,5),$t(t,o-4,4),n=0;n<o;n++)$t(t,t.bl_tree[wT[n]*2+1],3);Rb(t,t.dyn_ltree,e-1),Rb(t,t.dyn_dtree,r-1)},"send_all_trees"),Y_=i(t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(r=32;r<wa;r++)if(t.dyn_ltree[r*2]!==0)return 1;return 0},"detect_data_type"),Db=!1,X_=i(t=>{Db||(V_(),Db=!0),t.l_desc=new Lm(t.dyn_ltree,ST),t.d_desc=new Lm(t.dyn_dtree,bT),t.bl_desc=new Lm(t.bl_tree,TT),t.bi_buf=0,t.bi_valid=0,CT(t)},"_tr_init$1"),kT=i((t,e,r,o)=>{$t(t,(O_<<1)+(o?1:0),3),IT(t),ma(t,r),ma(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},"_tr_stored_block$1"),J_=i(t=>{$t(t,mT<<1,3),Gr(t,sf,po),$_(t)},"_tr_align$1"),ev=i((t,e,r,o)=>{let n,s,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=Y_(t)),Wm(t,t.l_desc),Wm(t,t.d_desc),c=W_(t),n=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=n&&(n=s)):n=s=r+5,r+4<=n&&e!==-1?kT(t,e,r,o):t.strategy===4||s===n?($t(t,(mT<<1)+(o?1:0),3),_b(t,po,aa)):($t(t,(q_<<1)+(o?1:0),3),Z_(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),_b(t,t.dyn_ltree,t.dyn_dtree)),CT(t),o&&IT(t)},"_tr_flush_block$1"),tv=i((t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(da[r]+wa+1)*2]++,t.dyn_dtree[AT(e)*2]++),t.sym_next===t.sym_end),"_tr_tally$1"),rv=X_,ov=kT,nv=ev,sv=tv,iv=J_,av={_tr_init:rv,_tr_stored_block:ov,_tr_flush_block:nv,_tr_tally:sv,_tr_align:iv},cv=i((t,e,r,o)=>{let n=t&65535|0,s=t>>>16&65535|0,c=0;for(;r!==0;){c=r>2e3?2e3:r,r-=c;do n=n+e[o++]|0,s=s+n|0;while(--c);n%=65521,s%=65521}return n|s<<16|0},"adler32"),fa=cv,uv=i(()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var o=0;o<8;o++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},"makeTable"),lv=new Uint32Array(uv()),pv=i((t,e,r,o)=>{let n=lv,s=o+r;t^=-1;for(let c=o;c<s;c++)t=t>>>8^n[(t^e[c])&255];return t^-1},"crc32"),gt=pv,hn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},wn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:dv,_tr_stored_block:Zm,_tr_flush_block:mv,_tr_tally:Go,_tr_align:fv}=av,{Z_NO_FLUSH:jo,Z_PARTIAL_FLUSH:hv,Z_FULL_FLUSH:gv,Z_FINISH:lr,Z_BLOCK:Bb,Z_OK:Tt,Z_STREAM_END:Nb,Z_STREAM_ERROR:jr,Z_DATA_ERROR:yv,Z_BUF_ERROR:Um,Z_DEFAULT_COMPRESSION:wv,Z_FILTERED:Sv,Z_HUFFMAN_ONLY:Nu,Z_RLE:bv,Z_FIXED:Tv,Z_DEFAULT_STRATEGY:Av,Z_UNKNOWN:xv,Z_DEFLATED:Gu}=wn,Ev=9,Cv=15,Iv=8,kv=29,Fv=256,Ym=Fv+1+kv,Pv=30,_v=19,vv=2*Ym+1,Rv=15,Te=3,Ho=258,$r=Ho+Te+1,Dv=32,xs=42,cf=57,Xm=69,Jm=73,ef=91,tf=103,mn=113,sa=666,Mt=1,Is=2,gn=3,ks=4,Bv=3,fn=i((t,e)=>(t.msg=hn[e],e),"err"),Lb=i(t=>t*2-(t>4?9:0),"rank"),Qo=i(t=>{let e=t.length;for(;--e>=0;)t[e]=0},"zero"),Nv=i(t=>{let e,r,o,n=t.w_size;e=t.hash_size,o=e;do r=t.head[--o],t.head[o]=r>=n?r-n:0;while(--e);e=n,o=e;do r=t.prev[--o],t.prev[o]=r>=n?r-n:0;while(--e)},"slide_hash"),Lv=i((t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask,"HASH_ZLIB"),$o=Lv,er=i(t=>{let e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},"flush_pending"),tr=i((t,e)=>{mv(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,er(t.strm)},"flush_block_only"),_e=i((t,e)=>{t.pending_buf[t.pending++]=e},"put_byte"),na=i((t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},"putShortMSB"),rf=i((t,e,r,o)=>{let n=t.avail_in;return n>o&&(n=o),n===0?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),r),t.state.wrap===1?t.adler=fa(t.adler,e,n,r):t.state.wrap===2&&(t.adler=gt(t.adler,e,n,r)),t.next_in+=n,t.total_in+=n,n)},"read_buf"),FT=i((t,e)=>{let r=t.max_chain_length,o=t.strstart,n,s,c=t.prev_length,p=t.nice_match,d=t.strstart>t.w_size-$r?t.strstart-(t.w_size-$r):0,m=t.window,f=t.w_mask,g=t.prev,y=t.strstart+Ho,w=m[o+c-1],S=m[o+c];t.prev_length>=t.good_match&&(r>>=2),p>t.lookahead&&(p=t.lookahead);do if(n=e,!(m[n+c]!==S||m[n+c-1]!==w||m[n]!==m[o]||m[++n]!==m[o+1])){o+=2,n++;do;while(m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&o<y);if(s=Ho-(y-o),o=y-Ho,s>c){if(t.match_start=e,c=s,s>=p)break;w=m[o+c-1],S=m[o+c]}}while((e=g[e&f])>d&&--r!==0);return c<=t.lookahead?c:t.lookahead},"longest_match"),Es=i(t=>{let e=t.w_size,r,o,n;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-$r)&&(t.window.set(t.window.subarray(e,e+e-o),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Nv(t),o+=e),t.strm.avail_in===0)break;if(r=rf(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=r,t.lookahead+t.insert>=Te)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=$o(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=$o(t,t.ins_h,t.window[n+Te-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<Te)););}while(t.lookahead<$r&&t.strm.avail_in!==0)},"fill_window"),PT=i((t,e)=>{let r=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o,n,s,c=0,p=t.strm.avail_in;do{if(o=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,n=t.strstart-t.block_start,o>n+t.strm.avail_in&&(o=n+t.strm.avail_in),o>s&&(o=s),o<r&&(o===0&&e!==lr||e===jo||o!==n+t.strm.avail_in)))break;c=e===lr&&o===n+t.strm.avail_in?1:0,Zm(t,0,0,c),t.pending_buf[t.pending-4]=o,t.pending_buf[t.pending-3]=o>>8,t.pending_buf[t.pending-2]=~o,t.pending_buf[t.pending-1]=~o>>8,er(t.strm),n&&(n>o&&(n=o),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,o-=n),o&&(rf(t.strm,t.strm.output,t.strm.next_out,o),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o)}while(c===0);return p-=t.strm.avail_in,p&&(p>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=p&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-p,t.strm.next_in),t.strstart),t.strstart+=p,t.insert+=p>t.w_size-t.insert?t.w_size-t.insert:p),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?ks:e!==jo&&e!==lr&&t.strm.avail_in===0&&t.strstart===t.block_start?Is:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(rf(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,r=s>t.w_size?t.w_size:s,n=t.strstart-t.block_start,(n>=r||(n||e===lr)&&e!==jo&&t.strm.avail_in===0&&n<=s)&&(o=n>s?s:n,c=e===lr&&t.strm.avail_in===0&&o===n?1:0,Zm(t,t.block_start,o,c),t.block_start+=o,er(t.strm)),c?gn:Mt)},"deflate_stored"),Om=i((t,e)=>{let r,o;for(;;){if(t.lookahead<$r){if(Es(t),t.lookahead<$r&&e===jo)return Mt;if(t.lookahead===0)break}if(r=0,t.lookahead>=Te&&(t.ins_h=$o(t,t.ins_h,t.window[t.strstart+Te-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-$r&&(t.match_length=FT(t,r)),t.match_length>=Te)if(o=Go(t,t.strstart-t.match_start,t.match_length-Te),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Te){t.match_length--;do t.strstart++,t.ins_h=$o(t,t.ins_h,t.window[t.strstart+Te-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=$o(t,t.ins_h,t.window[t.strstart+1]);else o=Go(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(tr(t,!1),t.strm.avail_out===0))return Mt}return t.insert=t.strstart<Te-1?t.strstart:Te-1,e===lr?(tr(t,!0),t.strm.avail_out===0?gn:ks):t.sym_next&&(tr(t,!1),t.strm.avail_out===0)?Mt:Is},"deflate_fast"),bs=i((t,e)=>{let r,o,n;for(;;){if(t.lookahead<$r){if(Es(t),t.lookahead<$r&&e===jo)return Mt;if(t.lookahead===0)break}if(r=0,t.lookahead>=Te&&(t.ins_h=$o(t,t.ins_h,t.window[t.strstart+Te-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Te-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-$r&&(t.match_length=FT(t,r),t.match_length<=5&&(t.strategy===Sv||t.match_length===Te&&t.strstart-t.match_start>4096)&&(t.match_length=Te-1)),t.prev_length>=Te&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-Te,o=Go(t,t.strstart-1-t.prev_match,t.prev_length-Te),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=n&&(t.ins_h=$o(t,t.ins_h,t.window[t.strstart+Te-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Te-1,t.strstart++,o&&(tr(t,!1),t.strm.avail_out===0))return Mt}else if(t.match_available){if(o=Go(t,0,t.window[t.strstart-1]),o&&tr(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Mt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=Go(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Te-1?t.strstart:Te-1,e===lr?(tr(t,!0),t.strm.avail_out===0?gn:ks):t.sym_next&&(tr(t,!1),t.strm.avail_out===0)?Mt:Is},"deflate_slow"),Mv=i((t,e)=>{let r,o,n,s,c=t.window;for(;;){if(t.lookahead<=Ho){if(Es(t),t.lookahead<=Ho&&e===jo)return Mt;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Te&&t.strstart>0&&(n=t.strstart-1,o=c[n],o===c[++n]&&o===c[++n]&&o===c[++n])){s=t.strstart+Ho;do;while(o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&n<s);t.match_length=Ho-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Te?(r=Go(t,1,t.match_length-Te),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=Go(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(tr(t,!1),t.strm.avail_out===0))return Mt}return t.insert=0,e===lr?(tr(t,!0),t.strm.avail_out===0?gn:ks):t.sym_next&&(tr(t,!1),t.strm.avail_out===0)?Mt:Is},"deflate_rle"),Uv=i((t,e)=>{let r;for(;;){if(t.lookahead===0&&(Es(t),t.lookahead===0)){if(e===jo)return Mt;break}if(t.match_length=0,r=Go(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(tr(t,!1),t.strm.avail_out===0))return Mt}return t.insert=0,e===lr?(tr(t,!0),t.strm.avail_out===0?gn:ks):t.sym_next&&(tr(t,!1),t.strm.avail_out===0)?Mt:Is},"deflate_huff");function Hr(t,e,r,o,n){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=o,this.func=n}i(Hr,"Config");var ia=[new Hr(0,0,0,0,PT),new Hr(4,4,8,4,Om),new Hr(4,5,16,8,Om),new Hr(4,6,32,32,Om),new Hr(4,4,16,16,bs),new Hr(8,16,32,32,bs),new Hr(8,16,128,128,bs),new Hr(8,32,128,256,bs),new Hr(32,128,258,1024,bs),new Hr(32,258,258,4096,bs)],Ov=i(t=>{t.window_size=2*t.w_size,Qo(t.head),t.max_lazy_match=ia[t.level].max_lazy,t.good_match=ia[t.level].good_length,t.nice_match=ia[t.level].nice_length,t.max_chain_length=ia[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Te-1,t.match_available=0,t.ins_h=0},"lm_init");function qv(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gu,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(vv*2),this.dyn_dtree=new Uint16Array((2*Pv+1)*2),this.bl_tree=new Uint16Array((2*_v+1)*2),Qo(this.dyn_ltree),Qo(this.dyn_dtree),Qo(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Rv+1),this.heap=new Uint16Array(2*Ym+1),Qo(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ym+1),Qo(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}i(qv,"DeflateState");var Sa=i(t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.status!==xs&&e.status!==cf&&e.status!==Xm&&e.status!==Jm&&e.status!==ef&&e.status!==tf&&e.status!==mn&&e.status!==sa?1:0},"deflateStateCheck"),_T=i(t=>{if(Sa(t))return fn(t,jr);t.total_in=t.total_out=0,t.data_type=xv;let e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?cf:e.wrap?xs:mn,t.adler=e.wrap===2?0:1,e.last_flush=-2,dv(e),Tt},"deflateResetKeep"),vT=i(t=>{let e=_T(t);return e===Tt&&Ov(t.state),e},"deflateReset"),zv=i((t,e)=>Sa(t)||t.state.wrap!==2?jr:(t.state.gzhead=e,Tt),"deflateSetHeader"),RT=i((t,e,r,o,n,s)=>{if(!t)return jr;let c=1;if(e===wv&&(e=6),o<0?(c=0,o=-o):o>15&&(c=2,o-=16),n<1||n>Ev||r!==Gu||o<8||o>15||e<0||e>9||s<0||s>Tv||o===8&&c!==1)return fn(t,jr);o===8&&(o=9);let p=new qv;return t.state=p,p.strm=t,p.status=xs,p.wrap=c,p.gzhead=null,p.w_bits=o,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=n+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+Te-1)/Te),p.window=new Uint8Array(p.w_size*2),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<n+6,p.pending_buf_size=p.lit_bufsize*4,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=(p.lit_bufsize-1)*3,p.level=e,p.strategy=s,p.method=r,vT(t)},"deflateInit2"),Qv=i((t,e)=>RT(t,e,Gu,Cv,Iv,Av),"deflateInit"),Hv=i((t,e)=>{if(Sa(t)||e>Bb||e<0)return t?fn(t,jr):jr;let r=t.state;if(!t.output||t.avail_in!==0&&!t.input||r.status===sa&&e!==lr)return fn(t,t.avail_out===0?Um:jr);let o=r.last_flush;if(r.last_flush=e,r.pending!==0){if(er(t),t.avail_out===0)return r.last_flush=-1,Tt}else if(t.avail_in===0&&Lb(e)<=Lb(o)&&e!==lr)return fn(t,Um);if(r.status===sa&&t.avail_in!==0)return fn(t,Um);if(r.status===xs&&r.wrap===0&&(r.status=mn),r.status===xs){let n=Gu+(r.w_bits-8<<4)<<8,s=-1;if(r.strategy>=Nu||r.level<2?s=0:r.level<6?s=1:r.level===6?s=2:s=3,n|=s<<6,r.strstart!==0&&(n|=Dv),n+=31-n%31,na(r,n),r.strstart!==0&&(na(r,t.adler>>>16),na(r,t.adler&65535)),t.adler=1,r.status=mn,er(t),r.pending!==0)return r.last_flush=-1,Tt}if(r.status===cf){if(t.adler=0,_e(r,31),_e(r,139),_e(r,8),r.gzhead)_e(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),_e(r,r.gzhead.time&255),_e(r,r.gzhead.time>>8&255),_e(r,r.gzhead.time>>16&255),_e(r,r.gzhead.time>>24&255),_e(r,r.level===9?2:r.strategy>=Nu||r.level<2?4:0),_e(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(_e(r,r.gzhead.extra.length&255),_e(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=gt(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=Xm;else if(_e(r,0),_e(r,0),_e(r,0),_e(r,0),_e(r,0),_e(r,r.level===9?2:r.strategy>=Nu||r.level<2?4:0),_e(r,Bv),r.status=mn,er(t),r.pending!==0)return r.last_flush=-1,Tt}if(r.status===Xm){if(r.gzhead.extra){let n=r.pending,s=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+s>r.pending_buf_size;){let p=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+p),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>n&&(t.adler=gt(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex+=p,er(t),r.pending!==0)return r.last_flush=-1,Tt;n=0,s-=p}let c=new Uint8Array(r.gzhead.extra);r.pending_buf.set(c.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending+=s,r.gzhead.hcrc&&r.pending>n&&(t.adler=gt(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=Jm}if(r.status===Jm){if(r.gzhead.name){let n=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=gt(t.adler,r.pending_buf,r.pending-n,n)),er(t),r.pending!==0)return r.last_flush=-1,Tt;n=0}r.gzindex<r.gzhead.name.length?s=r.gzhead.name.charCodeAt(r.gzindex++)&255:s=0,_e(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>n&&(t.adler=gt(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=ef}if(r.status===ef){if(r.gzhead.comment){let n=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=gt(t.adler,r.pending_buf,r.pending-n,n)),er(t),r.pending!==0)return r.last_flush=-1,Tt;n=0}r.gzindex<r.gzhead.comment.length?s=r.gzhead.comment.charCodeAt(r.gzindex++)&255:s=0,_e(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>n&&(t.adler=gt(t.adler,r.pending_buf,r.pending-n,n))}r.status=tf}if(r.status===tf){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(er(t),r.pending!==0))return r.last_flush=-1,Tt;_e(r,t.adler&255),_e(r,t.adler>>8&255),t.adler=0}if(r.status=mn,er(t),r.pending!==0)return r.last_flush=-1,Tt}if(t.avail_in!==0||r.lookahead!==0||e!==jo&&r.status!==sa){let n=r.level===0?PT(r,e):r.strategy===Nu?Uv(r,e):r.strategy===bv?Mv(r,e):ia[r.level].func(r,e);if((n===gn||n===ks)&&(r.status=sa),n===Mt||n===gn)return t.avail_out===0&&(r.last_flush=-1),Tt;if(n===Is&&(e===hv?fv(r):e!==Bb&&(Zm(r,0,0,!1),e===gv&&(Qo(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),er(t),t.avail_out===0))return r.last_flush=-1,Tt}return e!==lr?Tt:r.wrap<=0?Nb:(r.wrap===2?(_e(r,t.adler&255),_e(r,t.adler>>8&255),_e(r,t.adler>>16&255),_e(r,t.adler>>24&255),_e(r,t.total_in&255),_e(r,t.total_in>>8&255),_e(r,t.total_in>>16&255),_e(r,t.total_in>>24&255)):(na(r,t.adler>>>16),na(r,t.adler&65535)),er(t),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Tt:Nb)},"deflate$2"),Gv=i(t=>{if(Sa(t))return jr;let e=t.state.status;return t.state=null,e===mn?fn(t,yv):Tt},"deflateEnd"),jv=i((t,e)=>{let r=e.length;if(Sa(t))return jr;let o=t.state,n=o.wrap;if(n===2||n===1&&o.status!==xs||o.lookahead)return jr;if(n===1&&(t.adler=fa(t.adler,e,r,0)),o.wrap=0,r>=o.w_size){n===0&&(Qo(o.head),o.strstart=0,o.block_start=0,o.insert=0);let d=new Uint8Array(o.w_size);d.set(e.subarray(r-o.w_size,r),0),e=d,r=o.w_size}let s=t.avail_in,c=t.next_in,p=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Es(o);o.lookahead>=Te;){let d=o.strstart,m=o.lookahead-(Te-1);do o.ins_h=$o(o,o.ins_h,o.window[d+Te-1]),o.prev[d&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=d,d++;while(--m);o.strstart=d,o.lookahead=Te-1,Es(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=Te-1,o.match_available=0,t.next_in=c,t.input=p,t.avail_in=s,o.wrap=n,Tt},"deflateSetDictionary"),$v=Qv,Kv=RT,Vv=vT,Wv=_T,Zv=zv,Yv=Hv,Xv=Gv,Jv=jv,eR="pako deflate (from Nodeca project)",ca={deflateInit:$v,deflateInit2:Kv,deflateReset:Vv,deflateResetKeep:Wv,deflateSetHeader:Zv,deflate:Yv,deflateEnd:Xv,deflateSetDictionary:Jv,deflateInfo:eR},tR=i((t,e)=>Object.prototype.hasOwnProperty.call(t,e),"_has"),rR=i(function(t){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let r=e.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let o in r)tR(r,o)&&(t[o]=r[o])}}return t},"assign"),oR=i(t=>{let e=0;for(let o=0,n=t.length;o<n;o++)e+=t[o].length;let r=new Uint8Array(e);for(let o=0,n=0,s=t.length;o<s;o++){let c=t[o];r.set(c,n),n+=c.length}return r},"flattenChunks"),ju={assign:rR,flattenChunks:oR},DT=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{DT=!1}var ha=new Uint8Array(256);for(let t=0;t<256;t++)ha[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;ha[254]=ha[254]=1;var nR=i(t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,o,n,s,c=t.length,p=0;for(n=0;n<c;n++)r=t.charCodeAt(n),(r&64512)===55296&&n+1<c&&(o=t.charCodeAt(n+1),(o&64512)===56320&&(r=65536+(r-55296<<10)+(o-56320),n++)),p+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(p),s=0,n=0;s<p;n++)r=t.charCodeAt(n),(r&64512)===55296&&n+1<c&&(o=t.charCodeAt(n+1),(o&64512)===56320&&(r=65536+(r-55296<<10)+(o-56320),n++)),r<128?e[s++]=r:r<2048?(e[s++]=192|r>>>6,e[s++]=128|r&63):r<65536?(e[s++]=224|r>>>12,e[s++]=128|r>>>6&63,e[s++]=128|r&63):(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63,e[s++]=128|r>>>6&63,e[s++]=128|r&63);return e},"string2buf"),sR=i((t,e)=>{if(e<65534&&t.subarray&&DT)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let o=0;o<e;o++)r+=String.fromCharCode(t[o]);return r},"buf2binstring"),iR=i((t,e)=>{let r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let o,n,s=new Array(r*2);for(n=0,o=0;o<r;){let c=t[o++];if(c<128){s[n++]=c;continue}let p=ha[c];if(p>4){s[n++]=65533,o+=p-1;continue}for(c&=p===2?31:p===3?15:7;p>1&&o<r;)c=c<<6|t[o++]&63,p--;if(p>1){s[n++]=65533;continue}c<65536?s[n++]=c:(c-=65536,s[n++]=55296|c>>10&1023,s[n++]=56320|c&1023)}return sR(s,n)},"buf2string"),aR=i((t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)===128;)r--;return r<0||r===0?e:r+ha[t[r]]>e?r:e},"utf8border"),ga={string2buf:nR,buf2string:iR,utf8border:aR};function cR(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}i(cR,"ZStream");var BT=cR,NT=Object.prototype.toString,{Z_NO_FLUSH:uR,Z_SYNC_FLUSH:lR,Z_FULL_FLUSH:pR,Z_FINISH:dR,Z_OK:Qu,Z_STREAM_END:mR,Z_DEFAULT_COMPRESSION:fR,Z_DEFAULT_STRATEGY:hR,Z_DEFLATED:gR}=wn;function ba(t){this.options=ju.assign({level:fR,method:gR,chunkSize:16384,windowBits:15,memLevel:8,strategy:hR},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BT,this.strm.avail_out=0;let r=ca.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Qu)throw new Error(hn[r]);if(e.header&&ca.deflateSetHeader(this.strm,e.header),e.dictionary){let o;if(typeof e.dictionary=="string"?o=ga.string2buf(e.dictionary):NT.call(e.dictionary)==="[object ArrayBuffer]"?o=new Uint8Array(e.dictionary):o=e.dictionary,r=ca.deflateSetDictionary(this.strm,o),r!==Qu)throw new Error(hn[r]);this._dict_set=!0}}i(ba,"Deflate$1");ba.prototype.push=function(t,e){let r=this.strm,o=this.options.chunkSize,n,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?dR:uR,typeof t=="string"?r.input=ga.string2buf(t):NT.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),(s===lR||s===pR)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(n=ca.deflate(r,s),n===mR)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=ca.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Qu;if(r.avail_out===0){this.onData(r.output);continue}if(s>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};ba.prototype.onData=function(t){this.chunks.push(t)};ba.prototype.onEnd=function(t){t===Qu&&(this.result=ju.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function uf(t,e){let r=new ba(e);if(r.push(t,!0),r.err)throw r.msg||hn[r.err];return r.result}i(uf,"deflate$1");function yR(t,e){return e=e||{},e.raw=!0,uf(t,e)}i(yR,"deflateRaw$1");function wR(t,e){return e=e||{},e.gzip=!0,uf(t,e)}i(wR,"gzip$1");var SR=ba,bR=uf,TR=yR,AR=wR,xR=wn,ER={Deflate:SR,deflate:bR,deflateRaw:TR,gzip:AR,constants:xR},Lu=16209,CR=16191,IR=i(function(e,r){let o,n,s,c,p,d,m,f,g,y,w,S,b,T,x,C,E,P,M,G,R,j,Q,F,B=e.state;o=e.next_in,Q=e.input,n=o+(e.avail_in-5),s=e.next_out,F=e.output,c=s-(r-e.avail_out),p=s+(e.avail_out-257),d=B.dmax,m=B.wsize,f=B.whave,g=B.wnext,y=B.window,w=B.hold,S=B.bits,b=B.lencode,T=B.distcode,x=(1<<B.lenbits)-1,C=(1<<B.distbits)-1;e:do{S<15&&(w+=Q[o++]<<S,S+=8,w+=Q[o++]<<S,S+=8),E=b[w&x];t:for(;;){if(P=E>>>24,w>>>=P,S-=P,P=E>>>16&255,P===0)F[s++]=E&65535;else if(P&16){M=E&65535,P&=15,P&&(S<P&&(w+=Q[o++]<<S,S+=8),M+=w&(1<<P)-1,w>>>=P,S-=P),S<15&&(w+=Q[o++]<<S,S+=8,w+=Q[o++]<<S,S+=8),E=T[w&C];r:for(;;){if(P=E>>>24,w>>>=P,S-=P,P=E>>>16&255,P&16){if(G=E&65535,P&=15,S<P&&(w+=Q[o++]<<S,S+=8,S<P&&(w+=Q[o++]<<S,S+=8)),G+=w&(1<<P)-1,G>d){e.msg="invalid distance too far back",B.mode=Lu;break e}if(w>>>=P,S-=P,P=s-c,G>P){if(P=G-P,P>f&&B.sane){e.msg="invalid distance too far back",B.mode=Lu;break e}if(R=0,j=y,g===0){if(R+=m-P,P<M){M-=P;do F[s++]=y[R++];while(--P);R=s-G,j=F}}else if(g<P){if(R+=m+g-P,P-=g,P<M){M-=P;do F[s++]=y[R++];while(--P);if(R=0,g<M){P=g,M-=P;do F[s++]=y[R++];while(--P);R=s-G,j=F}}}else if(R+=g-P,P<M){M-=P;do F[s++]=y[R++];while(--P);R=s-G,j=F}for(;M>2;)F[s++]=j[R++],F[s++]=j[R++],F[s++]=j[R++],M-=3;M&&(F[s++]=j[R++],M>1&&(F[s++]=j[R++]))}else{R=s-G;do F[s++]=F[R++],F[s++]=F[R++],F[s++]=F[R++],M-=3;while(M>2);M&&(F[s++]=F[R++],M>1&&(F[s++]=F[R++]))}}else if(P&64){e.msg="invalid distance code",B.mode=Lu;break e}else{E=T[(E&65535)+(w&(1<<P)-1)];continue r}break}}else if(P&64)if(P&32){B.mode=CR;break e}else{e.msg="invalid literal/length code",B.mode=Lu;break e}else{E=b[(E&65535)+(w&(1<<P)-1)];continue t}break}}while(o<n&&s<p);M=S>>3,o-=M,S-=M<<3,w&=(1<<S)-1,e.next_in=o,e.next_out=s,e.avail_in=o<n?5+(n-o):5-(o-n),e.avail_out=s<p?257+(p-s):257-(s-p),B.hold=w,B.bits=S},"inflate_fast"),Ts=15,Mb=852,Ub=592,Ob=0,qm=1,qb=2,kR=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),FR=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),PR=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),_R=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),vR=i((t,e,r,o,n,s,c,p)=>{let d=p.bits,m=0,f=0,g=0,y=0,w=0,S=0,b=0,T=0,x=0,C=0,E,P,M,G,R,j=null,Q,F=new Uint16Array(Ts+1),B=new Uint16Array(Ts+1),W=null,Y,ee,X;for(m=0;m<=Ts;m++)F[m]=0;for(f=0;f<o;f++)F[e[r+f]]++;for(w=d,y=Ts;y>=1&&F[y]===0;y--);if(w>y&&(w=y),y===0)return n[s++]=1<<24|64<<16|0,n[s++]=1<<24|64<<16|0,p.bits=1,0;for(g=1;g<y&&F[g]===0;g++);for(w<g&&(w=g),T=1,m=1;m<=Ts;m++)if(T<<=1,T-=F[m],T<0)return-1;if(T>0&&(t===Ob||y!==1))return-1;for(B[1]=0,m=1;m<Ts;m++)B[m+1]=B[m]+F[m];for(f=0;f<o;f++)e[r+f]!==0&&(c[B[e[r+f]]++]=f);if(t===Ob?(j=W=c,Q=20):t===qm?(j=kR,W=FR,Q=257):(j=PR,W=_R,Q=0),C=0,f=0,m=g,R=s,S=w,b=0,M=-1,x=1<<w,G=x-1,t===qm&&x>Mb||t===qb&&x>Ub)return 1;for(;;){Y=m-b,c[f]+1<Q?(ee=0,X=c[f]):c[f]>=Q?(ee=W[c[f]-Q],X=j[c[f]-Q]):(ee=96,X=0),E=1<<m-b,P=1<<S,g=P;do P-=E,n[R+(C>>b)+P]=Y<<24|ee<<16|X|0;while(P!==0);for(E=1<<m-1;C&E;)E>>=1;if(E!==0?(C&=E-1,C+=E):C=0,f++,--F[m]===0){if(m===y)break;m=e[r+c[f]]}if(m>w&&(C&G)!==M){for(b===0&&(b=w),R+=g,S=m-b,T=1<<S;S+b<y&&(T-=F[S+b],!(T<=0));)S++,T<<=1;if(x+=1<<S,t===qm&&x>Mb||t===qb&&x>Ub)return 1;M=C&G,n[M]=w<<24|S<<16|R-s|0}}return C!==0&&(n[R+C]=m-b<<24|64<<16|0),p.bits=w,0},"inflate_table"),ua=vR,RR=0,LT=1,MT=2,{Z_FINISH:zb,Z_BLOCK:DR,Z_TREES:Mu,Z_OK:yn,Z_STREAM_END:BR,Z_NEED_DICT:NR,Z_STREAM_ERROR:pr,Z_DATA_ERROR:UT,Z_MEM_ERROR:OT,Z_BUF_ERROR:LR,Z_DEFLATED:Qb}=wn,$u=16180,Hb=16181,Gb=16182,jb=16183,$b=16184,Kb=16185,Vb=16186,Wb=16187,Zb=16188,Yb=16189,Hu=16190,lo=16191,zm=16192,Xb=16193,Qm=16194,Jb=16195,eT=16196,tT=16197,rT=16198,Uu=16199,Ou=16200,oT=16201,nT=16202,sT=16203,iT=16204,aT=16205,Hm=16206,cT=16207,uT=16208,je=16209,qT=16210,zT=16211,MR=852,UR=592,OR=15,qR=OR,lT=i(t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24),"zswap32");function zR(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}i(zR,"InflateState");var Sn=i(t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.mode<$u||e.mode>zT?1:0},"inflateStateCheck"),QT=i(t=>{if(Sn(t))return pr;let e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=$u,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(MR),e.distcode=e.distdyn=new Int32Array(UR),e.sane=1,e.back=-1,yn},"inflateResetKeep"),HT=i(t=>{if(Sn(t))return pr;let e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,QT(t)},"inflateReset"),GT=i((t,e)=>{let r;if(Sn(t))return pr;let o=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?pr:(o.window!==null&&o.wbits!==e&&(o.window=null),o.wrap=r,o.wbits=e,HT(t))},"inflateReset2"),jT=i((t,e)=>{if(!t)return pr;let r=new zR;t.state=r,r.strm=t,r.window=null,r.mode=$u;let o=GT(t,e);return o!==yn&&(t.state=null),o},"inflateInit2"),QR=i(t=>jT(t,qR),"inflateInit"),pT=!0,Gm,jm,HR=i(t=>{if(pT){Gm=new Int32Array(512),jm=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ua(LT,t.lens,0,288,Gm,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ua(MT,t.lens,0,32,jm,0,t.work,{bits:5}),pT=!1}t.lencode=Gm,t.lenbits=9,t.distcode=jm,t.distbits=5},"fixedtables"),$T=i((t,e,r,o)=>{let n,s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),o>=s.wsize?(s.window.set(e.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>o&&(n=o),s.window.set(e.subarray(r-o,r-o+n),s.wnext),o-=n,o?(s.window.set(e.subarray(r-o,r),0),s.wnext=o,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0},"updatewindow"),GR=i((t,e)=>{let r,o,n,s,c,p,d,m,f,g,y,w,S,b,T=0,x,C,E,P,M,G,R,j,Q=new Uint8Array(4),F,B,W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Sn(t)||!t.output||!t.input&&t.avail_in!==0)return pr;r=t.state,r.mode===lo&&(r.mode=zm),c=t.next_out,n=t.output,d=t.avail_out,s=t.next_in,o=t.input,p=t.avail_in,m=r.hold,f=r.bits,g=p,y=d,j=yn;e:for(;;)switch(r.mode){case $u:if(r.wrap===0){r.mode=zm;break}for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.wrap&2&&m===35615){r.wbits===0&&(r.wbits=15),r.check=0,Q[0]=m&255,Q[1]=m>>>8&255,r.check=gt(r.check,Q,2,0),m=0,f=0,r.mode=Hb;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((m&255)<<8)+(m>>8))%31){t.msg="incorrect header check",r.mode=je;break}if((m&15)!==Qb){t.msg="unknown compression method",r.mode=je;break}if(m>>>=4,f-=4,R=(m&15)+8,r.wbits===0&&(r.wbits=R),R>15||R>r.wbits){t.msg="invalid window size",r.mode=je;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=m&512?Yb:lo,m=0,f=0;break;case Hb:for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.flags=m,(r.flags&255)!==Qb){t.msg="unknown compression method",r.mode=je;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=je;break}r.head&&(r.head.text=m>>8&1),r.flags&512&&r.wrap&4&&(Q[0]=m&255,Q[1]=m>>>8&255,r.check=gt(r.check,Q,2,0)),m=0,f=0,r.mode=Gb;case Gb:for(;f<32;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.head&&(r.head.time=m),r.flags&512&&r.wrap&4&&(Q[0]=m&255,Q[1]=m>>>8&255,Q[2]=m>>>16&255,Q[3]=m>>>24&255,r.check=gt(r.check,Q,4,0)),m=0,f=0,r.mode=jb;case jb:for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.head&&(r.head.xflags=m&255,r.head.os=m>>8),r.flags&512&&r.wrap&4&&(Q[0]=m&255,Q[1]=m>>>8&255,r.check=gt(r.check,Q,2,0)),m=0,f=0,r.mode=$b;case $b:if(r.flags&1024){for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.length=m,r.head&&(r.head.extra_len=m),r.flags&512&&r.wrap&4&&(Q[0]=m&255,Q[1]=m>>>8&255,r.check=gt(r.check,Q,2,0)),m=0,f=0}else r.head&&(r.head.extra=null);r.mode=Kb;case Kb:if(r.flags&1024&&(w=r.length,w>p&&(w=p),w&&(r.head&&(R=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(o.subarray(s,s+w),R)),r.flags&512&&r.wrap&4&&(r.check=gt(r.check,o,w,s)),p-=w,s+=w,r.length-=w),r.length))break e;r.length=0,r.mode=Vb;case Vb:if(r.flags&2048){if(p===0)break e;w=0;do R=o[s+w++],r.head&&R&&r.length<65536&&(r.head.name+=String.fromCharCode(R));while(R&&w<p);if(r.flags&512&&r.wrap&4&&(r.check=gt(r.check,o,w,s)),p-=w,s+=w,R)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Wb;case Wb:if(r.flags&4096){if(p===0)break e;w=0;do R=o[s+w++],r.head&&R&&r.length<65536&&(r.head.comment+=String.fromCharCode(R));while(R&&w<p);if(r.flags&512&&r.wrap&4&&(r.check=gt(r.check,o,w,s)),p-=w,s+=w,R)break e}else r.head&&(r.head.comment=null);r.mode=Zb;case Zb:if(r.flags&512){for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.wrap&4&&m!==(r.check&65535)){t.msg="header crc mismatch",r.mode=je;break}m=0,f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=lo;break;case Yb:for(;f<32;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}t.adler=r.check=lT(m),m=0,f=0,r.mode=Hu;case Hu:if(r.havedict===0)return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=p,r.hold=m,r.bits=f,NR;t.adler=r.check=1,r.mode=lo;case lo:if(e===DR||e===Mu)break e;case zm:if(r.last){m>>>=f&7,f-=f&7,r.mode=Hm;break}for(;f<3;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}switch(r.last=m&1,m>>>=1,f-=1,m&3){case 0:r.mode=Xb;break;case 1:if(HR(r),r.mode=Uu,e===Mu){m>>>=2,f-=2;break e}break;case 2:r.mode=eT;break;case 3:t.msg="invalid block type",r.mode=je}m>>>=2,f-=2;break;case Xb:for(m>>>=f&7,f-=f&7;f<32;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if((m&65535)!==(m>>>16^65535)){t.msg="invalid stored block lengths",r.mode=je;break}if(r.length=m&65535,m=0,f=0,r.mode=Qm,e===Mu)break e;case Qm:r.mode=Jb;case Jb:if(w=r.length,w){if(w>p&&(w=p),w>d&&(w=d),w===0)break e;n.set(o.subarray(s,s+w),c),p-=w,s+=w,d-=w,c+=w,r.length-=w;break}r.mode=lo;break;case eT:for(;f<14;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.nlen=(m&31)+257,m>>>=5,f-=5,r.ndist=(m&31)+1,m>>>=5,f-=5,r.ncode=(m&15)+4,m>>>=4,f-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=je;break}r.have=0,r.mode=tT;case tT:for(;r.have<r.ncode;){for(;f<3;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.lens[W[r.have++]]=m&7,m>>>=3,f-=3}for(;r.have<19;)r.lens[W[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,F={bits:r.lenbits},j=ua(RR,r.lens,0,19,r.lencode,0,r.work,F),r.lenbits=F.bits,j){t.msg="invalid code lengths set",r.mode=je;break}r.have=0,r.mode=rT;case rT:for(;r.have<r.nlen+r.ndist;){for(;T=r.lencode[m&(1<<r.lenbits)-1],x=T>>>24,C=T>>>16&255,E=T&65535,!(x<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(E<16)m>>>=x,f-=x,r.lens[r.have++]=E;else{if(E===16){for(B=x+2;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(m>>>=x,f-=x,r.have===0){t.msg="invalid bit length repeat",r.mode=je;break}R=r.lens[r.have-1],w=3+(m&3),m>>>=2,f-=2}else if(E===17){for(B=x+3;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}m>>>=x,f-=x,R=0,w=3+(m&7),m>>>=3,f-=3}else{for(B=x+7;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}m>>>=x,f-=x,R=0,w=11+(m&127),m>>>=7,f-=7}if(r.have+w>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=je;break}for(;w--;)r.lens[r.have++]=R}}if(r.mode===je)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=je;break}if(r.lenbits=9,F={bits:r.lenbits},j=ua(LT,r.lens,0,r.nlen,r.lencode,0,r.work,F),r.lenbits=F.bits,j){t.msg="invalid literal/lengths set",r.mode=je;break}if(r.distbits=6,r.distcode=r.distdyn,F={bits:r.distbits},j=ua(MT,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,F),r.distbits=F.bits,j){t.msg="invalid distances set",r.mode=je;break}if(r.mode=Uu,e===Mu)break e;case Uu:r.mode=Ou;case Ou:if(p>=6&&d>=258){t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=p,r.hold=m,r.bits=f,IR(t,y),c=t.next_out,n=t.output,d=t.avail_out,s=t.next_in,o=t.input,p=t.avail_in,m=r.hold,f=r.bits,r.mode===lo&&(r.back=-1);break}for(r.back=0;T=r.lencode[m&(1<<r.lenbits)-1],x=T>>>24,C=T>>>16&255,E=T&65535,!(x<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(C&&!(C&240)){for(P=x,M=C,G=E;T=r.lencode[G+((m&(1<<P+M)-1)>>P)],x=T>>>24,C=T>>>16&255,E=T&65535,!(P+x<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}m>>>=P,f-=P,r.back+=P}if(m>>>=x,f-=x,r.back+=x,r.length=E,C===0){r.mode=aT;break}if(C&32){r.back=-1,r.mode=lo;break}if(C&64){t.msg="invalid literal/length code",r.mode=je;break}r.extra=C&15,r.mode=oT;case oT:if(r.extra){for(B=r.extra;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.length+=m&(1<<r.extra)-1,m>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=nT;case nT:for(;T=r.distcode[m&(1<<r.distbits)-1],x=T>>>24,C=T>>>16&255,E=T&65535,!(x<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(!(C&240)){for(P=x,M=C,G=E;T=r.distcode[G+((m&(1<<P+M)-1)>>P)],x=T>>>24,C=T>>>16&255,E=T&65535,!(P+x<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}m>>>=P,f-=P,r.back+=P}if(m>>>=x,f-=x,r.back+=x,C&64){t.msg="invalid distance code",r.mode=je;break}r.offset=E,r.extra=C&15,r.mode=sT;case sT:if(r.extra){for(B=r.extra;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.offset+=m&(1<<r.extra)-1,m>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=je;break}r.mode=iT;case iT:if(d===0)break e;if(w=y-d,r.offset>w){if(w=r.offset-w,w>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=je;break}w>r.wnext?(w-=r.wnext,S=r.wsize-w):S=r.wnext-w,w>r.length&&(w=r.length),b=r.window}else b=n,S=c-r.offset,w=r.length;w>d&&(w=d),d-=w,r.length-=w;do n[c++]=b[S++];while(--w);r.length===0&&(r.mode=Ou);break;case aT:if(d===0)break e;n[c++]=r.length,d--,r.mode=Ou;break;case Hm:if(r.wrap){for(;f<32;){if(p===0)break e;p--,m|=o[s++]<<f,f+=8}if(y-=d,t.total_out+=y,r.total+=y,r.wrap&4&&y&&(t.adler=r.check=r.flags?gt(r.check,n,y,c-y):fa(r.check,n,y,c-y)),y=d,r.wrap&4&&(r.flags?m:lT(m))!==r.check){t.msg="incorrect data check",r.mode=je;break}m=0,f=0}r.mode=cT;case cT:if(r.wrap&&r.flags){for(;f<32;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.wrap&4&&m!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=je;break}m=0,f=0}r.mode=uT;case uT:j=BR;break e;case je:j=UT;break e;case qT:return OT;case zT:default:return pr}return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=p,r.hold=m,r.bits=f,(r.wsize||y!==t.avail_out&&r.mode<je&&(r.mode<Hm||e!==zb))&&$T(t,t.output,t.next_out,y-t.avail_out),g-=t.avail_in,y-=t.avail_out,t.total_in+=g,t.total_out+=y,r.total+=y,r.wrap&4&&y&&(t.adler=r.check=r.flags?gt(r.check,n,y,t.next_out-y):fa(r.check,n,y,t.next_out-y)),t.data_type=r.bits+(r.last?64:0)+(r.mode===lo?128:0)+(r.mode===Uu||r.mode===Qm?256:0),(g===0&&y===0||e===zb)&&j===yn&&(j=LR),j},"inflate$2"),jR=i(t=>{if(Sn(t))return pr;let e=t.state;return e.window&&(e.window=null),t.state=null,yn},"inflateEnd"),$R=i((t,e)=>{if(Sn(t))return pr;let r=t.state;return r.wrap&2?(r.head=e,e.done=!1,yn):pr},"inflateGetHeader"),KR=i((t,e)=>{let r=e.length,o,n,s;return Sn(t)||(o=t.state,o.wrap!==0&&o.mode!==Hu)?pr:o.mode===Hu&&(n=1,n=fa(n,e,r,0),n!==o.check)?UT:(s=$T(t,e,r,r),s?(o.mode=qT,OT):(o.havedict=1,yn))},"inflateSetDictionary"),VR=HT,WR=GT,ZR=QT,YR=QR,XR=jT,JR=GR,eD=jR,tD=$R,rD=KR,oD="pako inflate (from Nodeca project)",mo={inflateReset:VR,inflateReset2:WR,inflateResetKeep:ZR,inflateInit:YR,inflateInit2:XR,inflate:JR,inflateEnd:eD,inflateGetHeader:tD,inflateSetDictionary:rD,inflateInfo:oD};function nD(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}i(nD,"GZheader");var sD=nD,KT=Object.prototype.toString,{Z_NO_FLUSH:iD,Z_FINISH:aD,Z_OK:ya,Z_STREAM_END:$m,Z_NEED_DICT:Km,Z_STREAM_ERROR:cD,Z_DATA_ERROR:dT,Z_MEM_ERROR:uD}=wn;function Ta(t){this.options=ju.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BT,this.strm.avail_out=0;let r=mo.inflateInit2(this.strm,e.windowBits);if(r!==ya)throw new Error(hn[r]);if(this.header=new sD,mo.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=ga.string2buf(e.dictionary):KT.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=mo.inflateSetDictionary(this.strm,e.dictionary),r!==ya)))throw new Error(hn[r])}i(Ta,"Inflate$1");Ta.prototype.push=function(t,e){let r=this.strm,o=this.options.chunkSize,n=this.options.dictionary,s,c,p;if(this.ended)return!1;for(e===~~e?c=e:c=e===!0?aD:iD,KT.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),s=mo.inflate(r,c),s===Km&&n&&(s=mo.inflateSetDictionary(r,n),s===ya?s=mo.inflate(r,c):s===dT&&(s=Km));r.avail_in>0&&s===$m&&r.state.wrap>0&&t[r.next_in]!==0;)mo.inflateReset(r),s=mo.inflate(r,c);switch(s){case cD:case dT:case Km:case uD:return this.onEnd(s),this.ended=!0,!1}if(p=r.avail_out,r.next_out&&(r.avail_out===0||s===$m))if(this.options.to==="string"){let d=ga.utf8border(r.output,r.next_out),m=r.next_out-d,f=ga.buf2string(r.output,d);r.next_out=m,r.avail_out=o-m,m&&r.output.set(r.output.subarray(d,d+m),0),this.onData(f)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(s===ya&&p===0)){if(s===$m)return s=mo.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};Ta.prototype.onData=function(t){this.chunks.push(t)};Ta.prototype.onEnd=function(t){t===ya&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ju.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function lf(t,e){let r=new Ta(e);if(r.push(t),r.err)throw r.msg||hn[r.err];return r.result}i(lf,"inflate$1");function lD(t,e){return e=e||{},e.raw=!0,lf(t,e)}i(lD,"inflateRaw$1");var pD=Ta,dD=lf,mD=lD,fD=lf,hD=wn,gD={Inflate:pD,inflate:dD,inflateRaw:mD,ungzip:fD,constants:hD},{Deflate:yD,deflate:wD,deflateRaw:SD,gzip:bD}=ER,{Inflate:TD,inflate:AD,inflateRaw:xD,ungzip:ED}=gD,CD=yD,ID=wD,kD=SD,FD=bD,PD=TD,_D=AD,vD=xD,RD=ED,DD=wn,pf={Deflate:CD,deflate:ID,deflateRaw:kD,gzip:FD,Inflate:PD,inflate:_D,inflateRaw:vD,ungzip:RD,constants:DD};u();l();var Ku=class{static{i(this,"StreamedQuoteQueue")}maxSize=5;items=[];enqueue(e,r,o){let n=this.processQuoteResponse(e,r,o?.join(","));this.items.push(n),this.items.length>this.maxSize&&this.items.shift()}getItems(){return[...this.items]}size(){return this.items.length}clear(){this.items=[]}processQuoteResponse(e,r,o){return{quotes:e.quotes.map(s=>({amountIn:s.sellAmount,amountOut:s.buyAmount,tokenIn:N(e.sellToken),tokenOut:N(e.buyToken),provider:s.baseProvider.name})),timestamp:Date.now(),selectedProvider:r,alerts:o}}};var BD="Sq+",df=class{static{i(this,"StreamedQuoteLogger")}queue=new Ku;addQuoteResponse(e,r,o){this.queue.enqueue(e,r,o)}reset(){this.queue.clear()}getQuotes(){return this.queue.getItems()}logState(e){let r=this.getStateData(e);k.addBreadcrumb(_.Generic,`${BD}${r}`,L.Info)}processQuoteProcessorState(e){switch(e.type){case"starting":this.reset();break;case"quoteProcessed":this.addQuoteResponse(e.response,e.input.preferredProvider,[...e.quoteDetails.alerts,...e.quoteDetails.warnings].map(r=>r.toString()));break;default:break}}getStateData(e){let r=this.queue.getItems(),o=this.compactData(r,e),n=pf.gzip(JSON.stringify(o));return Buffer.from(n).toString("base64")}compactData(e,r){return e.length===0?null:{items:e.map(o=>({q:o.quotes.map(n=>({i:n.amountIn,o:n.amountOut,p:n.provider,ti:n.tokenIn,to:n.tokenOut})),t:o.timestamp,sp:o.selectedProvider,a:o.alerts})),th:r}}expandData(e){return e.items.map(r=>({quotes:r.q.map(o=>({amountIn:o.i,amountOut:o.o,tokenIn:o.ti,tokenOut:o.to,provider:o.p})),timestamp:r.t,selectedProvider:r.sp,alerts:r.a}))}decode(e){try{let r=Buffer.from(e,"base64"),o=pf.inflate(r,{to:"string"}),n=JSON.parse(o);return n?{items:this.expandData(n),txnHash:n.th}:{items:[]}}catch(r){return console.error("Failed to decode compressed data:",r),{items:[]}}}},Ko=new df;u();l();u();l();var H;(function(t){t.AccountFrozen="AccountFrozen",t.NoCurrentQuoteError="Trying to execute swap with no current quote",t.NoQuoteResponseError="Trying to execute swap with no quote response",t.NoGasEstimation="No gas estimation available",t.NoSwapTransactions="No swap transactions available",t.InsufficientFunds="INSUFFICIENT_FUNDS",t.InsufficientGas="INSUFFICIENT_GAS",t.SlippageExceeded="slippageToleranceExceeded",t.SimulationTimeout="SIMULATION_TIMEOUT",t.NotValidScanResultsError="Scan results are not valid",t.StaleQuote="STALE_QUOTE",t.NotEnoughSol="NotEnoughSol",t.TransactionConfirmationFailed="Transaction confirmation failed",t.SimulationUnknownError="SimulationUnknownError",t.UnknownError="UnknownError",t.MissingArgument="MissingArgument",t.EmptyRoute="EmptyRoute",t.InvalidCalculation="InvalidCalculation",t.MissingPlatformFeeAccount="MissingPlatformFeeAccount",t.InvalidSlippage="InvalidSlippage",t.NotEnoughPercent="NotEnoughPercent",t.InvalidInputIndex="InvalidInputIndex",t.InvalidOutputIndex="InvalidOutputIndex",t.NotEnoughAccountKeys="NotEnoughAccountKeys",t.NonZeroMinimumOutAmountNotSupported="NonZeroMinimumOutAmountNotSupported",t.InvalidRoutePlan="InvalidRoutePlan",t.InvalidReferralAuthority="InvalidReferralAuthority",t.LedgerTokenAccountDoesNotMatch="LedgerTokenAccountDoesNotMatch",t.InvalidTokenLedger="InvalidTokenLedger",t.IncorrectTokenProgramID="IncorrectTokenProgramID",t.TokenProgramNotProvided="TokenProgramNotProvided",t.SwapNotSupported="SwapNotSupported",t.ExactOutAmountNotMatched="ExactOutAmountNotMatched",t.SourceAndDstinationMintCannotBeTheSame="SourceAndDstinationMintCannotBeTheSame",t.LedgerConnectionError="LedgerConnectionError",t.LedgerRejectAction="LedgerRejectAction",t.LedgerUnknownSignError="LedgerUnknownSignError",t.LedgerUnknownError="LedgerUnknownError"})(H||(H={}));var ve=class extends Error{static{i(this,"SwapperError")}code;detailMessage;constructor(e,r){super(e),this.code=e,this.detailMessage=r}};var ND=H.SlippageExceeded,LD=H.InsufficientFunds,MD=Cy,UD="insufficient lamports",OD="lower balance than rent-exempt minimum",qD=Ey,zD="Transaction confirmation failed",QD=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],HD="Ledger user rejected action",GD="Ledger Sign Error";function jD(t){try{return Number(t.split('"Custom":')[1].split("}")[0])}catch{return null}}i(jD,"parseProgramErrorCode");function $D(t){switch(jD(t.message)){case 301:return H.SlippageExceeded;case 6e3:return H.EmptyRoute;case 6001:return H.SlippageExceeded;case 6002:return H.InvalidCalculation;case 6003:return H.MissingPlatformFeeAccount;case 6004:return H.InvalidSlippage;case 6005:return H.NotEnoughPercent;case 6006:return H.InvalidInputIndex;case 6007:return H.InvalidOutputIndex;case 6008:return H.NotEnoughAccountKeys;case 6009:return H.NonZeroMinimumOutAmountNotSupported;case 6010:return H.InvalidRoutePlan;case 6011:return H.InvalidReferralAuthority;case 6012:return H.LedgerTokenAccountDoesNotMatch;case 6013:return H.InvalidTokenLedger;case 6014:return H.IncorrectTokenProgramID;case 6015:return H.TokenProgramNotProvided;case 6016:return H.SwapNotSupported;case 6017:return H.ExactOutAmountNotMatched;case 6018:return H.SourceAndDstinationMintCannotBeTheSame;default:return null}}i($D,"parseProgramError");function KD(t){return QD.some(r=>t.message.includes(r))?H.LedgerConnectionError:t.message.includes(HD)?H.LedgerRejectAction:t.message.includes(GD)?H.LedgerUnknownSignError:t.message.toLowerCase().includes("ledger")?H.LedgerUnknownError:null}i(KD,"parseLedgerError");function Vo(t){if(t===void 0)return new ve(H.UnknownError,"No error provided");if(t instanceof ve)return t;let e=VD(t);if(e.message.includes(LD))return new ve(H.InsufficientFunds);if(WD(e.message))return new ve(H.SlippageExceeded);if(e.message===H.NotValidScanResultsError)return new ve(H.NotValidScanResultsError);if([MD,UD,qD,OD].some(d=>e.message.includes(d)))return new ve(H.NotEnoughSol);let s=$D(e);if(s!==null)return new ve(s);if(e.message.includes(zD))return new ve(H.TransactionConfirmationFailed);let p=KD(e);return p!==null?new ve(p):new ve(H.UnknownError,e.message)}i(Vo,"parseSwapError");function VD(t){return typeof t=="string"?new Error(t):typeof t=="object"&&"logs"in t&&t.logs?.length?new Error(t.logs.join(`
`)):t}i(VD,"normalizeError");function WD(t){return t.includes(ND)}i(WD,"errorMessageFailsFromSlippage");u();l();u();l();var VT=3;function Vu(){try{let t=qt.getMultivariateAssignment("swapper-high-slippage-threshold"),e=Number(t);return!t||isNaN(e)?VT:e}catch{return VT}}i(Vu,"getHighSlippageThreshold");var WT=i(({currentQuote:t,quoteResponse:e,gasEstimation:r,swapTransactions:o,scanResults:n,isSwapSimulationDisabled:s,slippageTolerance:c})=>{if(!t)throw new ve(H.NoCurrentQuoteError);if(!e)throw new ve(H.NoQuoteResponseError);if(I.isEVMNetworkID(e.sellToken.chainId)&&(!r||r?.length===0||r?.length<(o?.transactions.length??1)))throw new ve(H.NoGasEstimation);if(!o)throw new ve(H.NoSwapTransactions);if(n.state!=="valid"&&(k.addBreadcrumb(_.Swapper,"swapSimulationNotValid",L.Info,Kn({scanResults:n.state})),!s)){let d=[H.NotValidScanResultsError,H.AccountFrozen,H.InsufficientFunds,H.InsufficientGas,H.SlippageExceeded,H.SimulationTimeout,H.MissingArgument,H.StaleQuote,H.SimulationUnknownError];if(YD(n.state)&&d.includes(n.state.code)){if(ZD(n.state,c))return;throw n.state}else throw new ve(H.NotValidScanResultsError)}},"validateSwap");function ZD(t,e){return t.code===H.SlippageExceeded&&e&&e>=Vu()}i(ZD,"shouldSuppressError");function YD(t){return t instanceof ve}i(YD,"isSwapperError");var XD={swap:{solana:"executeSolanaSwap",evm:"executeEvmSwap",sui:"executeSuiSwap",bitcoin:"executeBitcoinSwap"},bridge:{solana:"executeSolanaBridge",evm:"executeEvmBridge",sui:"executeSuiBridge",bitcoin:"executeBitcoinBridge"}},mf=i((t,e)=>XD[t?"bridge":"swap"][e??"solana"],"getExecuteSwapSpanName"),ZT=i(async({isBridge:t,addressType:e,isSwapSimulationDisabled:r,sender:o,currentQuote:n,quoteResponse:s,gasEstimation:c,swapTransactions:p,scanResults:d,pendingActivityRows:m,connection:f,logSwapFailureNoSignature:g,logTransactionSubmitted:y,onTransactionReceiptReceived:w,onTransactionSubmissionError:S,resetToInitialState:b,slippageTolerance:T,swapFungibles:x})=>{await k.startSpan(mf(t,p?.type),async()=>{b();let C;try{WT({currentQuote:n,quoteResponse:s,gasEstimation:c,swapTransactions:p,scanResults:d,isSwapSimulationDisabled:r,slippageTolerance:T});let E=await x({type:e,callerAddress:o,swapTransactions:p,pendingSwapActivityRows:m.pendingSwapActivityRows,pendingApprovalActivityRows:m.pendingApprovalActivityRows,gasEstimation:c,connection:f});if(w(E),E.error)throw E.id||g(),C=E.id,E.error;y(E),Ko.logState(E.id)}catch(E){let P=Vo(E);S(P,C)}})},"executeSwap");u();l();var At;(function(t){t.SetPair="setPair",t.QuoteRequestStarted="quoteRequestStarted",t.QuoteResponseReceived="quoteResponseReceived",t.QuoteResponseStreamed="quoteResponseStreamed",t.QuoteRequestError="quoteRequestError",t.UserSelectedQuote="userSelectedQuote"})(At||(At={}));u();l();u();l();var Ie;(function(t){t.SlippageExceeded="SLIPPAGE_EXCEEDED",t.InsufficientFunds="INSUFFICIENT_FUNDS",t.InsufficientGas="INSUFFICIENT_GAS",t.AccountFrozen="ACCOUNT_FROZEN",t.SimulationTimeout="SIMULATION_TIMEOUT",t.StaleQuote="STALE_QUOTE",t.UnknownError="UNKNOWN_ERROR",t.SimulationFailed="SIMULATION_FAILED"})(Ie||(Ie={}));var Fs=class t extends Error{static{i(this,"SimulationError")}scannedTransactionResult;type;detailMessage;constructor(e,r,o){super(e),this.scannedTransactionResult=r,this.type=o,r&&(this.detailMessage=r.simulationError?.humanReadableError??(r.warnings.length>0?r.warnings[0].message:void 0)),this.type=o}static fromError(e){return e instanceof t?e:new t(e.message)}static fromScannedTransactionResult(e,r){return i(n=>Object.values(Ie).includes(n),"isSimulationErrorType")(e)?new t(e,r,e):new t(e,r)}};u();l();var Ps=class t extends Error{static{i(this,"SubmissionError")}type;constructor(e,r){super(e),this.type=r}static fromError(e){return new t(e.message)}static fromType(e){return new t(e,e)}};var YT="https://phantom.com",Wu=class{static{i(this,"EventfulSwapCommand")}swapCommand;send;executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,o){this.swapCommand=e,this.send=r,this.executingQuote=o,this.takerAddress=e.takerAddress,this.networkId=e.networkId,this.quote=e.quote,this.executionId=e.executionId}createTransaction(){return this.send({type:Z.ExecuteSwapStarted,executionId:this.executionId,executingQuote:this.executingQuote}),this.swapCommand.createTransaction()}async fetchSimulation(e){let{transactions:r,deviceId:o,isSimulationKilled:n}=e,s=Xt(v.language)??"en";if(I.isSuiNetworkID(this.networkId))return{type:"transaction",expectedChanges:[],warnings:[],advancedDetails:void 0,error:void 0,simulationError:void 0,block:void 0};if(I.isBitcoinNetworkID(this.networkId))return{type:"transaction",expectedChanges:[],warnings:[],advancedDetails:void 0,error:void 0,simulationError:void 0,block:void 0};let c=await ys({transactions:r,locale:s,url:YT,deviceId:o,takerAddress:this.takerAddress,networkId:this.networkId,slippageType:this.executingQuote.slippageType,quote:this.quote,quoteResponse:this.executingQuote.response,isSimulationKilled:n});return c.status==="success"?c.result:null}async simulate(e,r,o,n){try{this.send({type:Z.SimulationRequestStarted,executionId:this.executionId,executingQuote:this.executingQuote,networkId:this.networkId});let s=await this.fetchSimulation({transactions:e,deviceId:o,isSimulationKilled:n});if(!s)return this.send({type:Z.SimulationSkipped,executionId:this.executionId,networkId:this.networkId}),null;switch(s.error){case void 0:break;case Ie.SimulationFailed:break;case Ie.SlippageExceeded:if(this.executingQuote.response.slippageTolerance>=Vu())break;default:throw Fs.fromScannedTransactionResult(s.error,s)}return this.send({type:Z.SimulationPassed,scannedTransactionResult:s,executionId:this.executionId,networkId:this.networkId}),s}catch(s){throw this.send({type:Z.SimulationFailed,error:Fs.fromError(s),executionId:this.executionId,networkId:this.networkId,url:YT}),s}}async swap(e,r,o,n,s){this.send({type:Z.TransactionSubmissionStarted,executionId:this.executionId});try{let c=await this.swapCommand.swap(e,r,o,n,s);if(!c.id)throw Ps.fromType("noSignature");return this.send({type:Z.TransactionSubmissionSuccess,txReceipt:c,executionId:this.executionId}),c}catch(c){let p=c instanceof Ps?c:Ps.fromError(c);throw this.send({type:Z.TransactionSubmissionFailed,error:p,executionId:this.executionId}),p}}async waitForConfirmation(e){this.send({type:Z.TransactionConfirmationStarted,executionId:this.executionId,txReceipt:e});try{let r=await this.swapCommand.waitForConfirmation(e);return this.send({type:Z.TransactionConfirmed,executionId:this.executionId,txReceipt:e}),r}catch(r){throw this.send({type:Z.TransactionConfirmationFailed,error:r,txReceipt:e,executionId:this.executionId}),r}}};u();l();var Zu=class extends Error{static{i(this,"ExecuteSwapIllegalTransitionError")}constructor(e,r){let n=(Array.isArray(r)?r:[r]).join(", ");super(`Can't transition to ${n} from ${e.type}`)}},Yu=class{static{i(this,"ExecuteSwapStateMachine")}state=new Map;listeners=new Set;send(e){e.type===Z.ExecuteSwapStarted&&this.state.set(e.executionId,{type:Ce.Idle,executingQuote:e.executingQuote});let r=this.state.get(e.executionId);if(!r)throw new Error(`No previous state found for execution id: ${e.executionId}`);let o=r;try{return o=this.detectNextState(r,e),o.type===Ce.TransactionConfirmed?this.state.delete(e.executionId):this.state.set(e.executionId,o),o}catch{return r}finally{this.notifyListeners(e,r,o,this.state)}}notifyListeners(e,r,o,n){this.listeners.forEach(s=>{try{s.onStateChange(e,r,o,n)}catch(c){console.error("Error notifying ExecuteSwapStateListener:",c)}})}getState(){return this.state}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}detectNextState(e,r){switch(r.type){case Z.ExecuteSwapStarted:return Kr(e,Ce.Idle),{type:Ce.Started,executingQuote:r.executingQuote};case Z.SimulationRequestStarted:return Kr(e,Ce.Started),{type:Ce.Simulating,executingQuote:e.executingQuote};case Z.SimulationPassed:return Kr(e,Ce.Simulating),{type:Ce.Simulated,scannedTransactionResult:r.scannedTransactionResult,executingQuote:e.executingQuote};case Z.SimulationFailed:return Kr(e,Ce.Simulating),{type:Ce.SimulationFailed,error:r.error,executingQuote:e.executingQuote};case Z.SimulationSkipped:return Kr(e,Ce.Simulating),{type:Ce.SimulationSkipped,executingQuote:e.executingQuote};case Z.TransactionSubmissionStarted:return JD(e,[Ce.Simulated,Ce.SimulationSkipped]),{type:Ce.SubmittingTransaction,executingQuote:e.executingQuote,scannedTransactionResult:e.type===Ce.Simulated?e.scannedTransactionResult:void 0};case Z.TransactionSubmissionFailed:return Kr(e,Ce.SubmittingTransaction),{type:Ce.TransactionSubmissionFailed,error:r.error,executingQuote:e.executingQuote,scannedTransactionResult:e.scannedTransactionResult};case Z.TransactionSubmissionSuccess:return Kr(e,Ce.SubmittingTransaction),{type:Ce.TransactionSubmitted,txReceipt:r.txReceipt,executingQuote:e.executingQuote,scannedTransactionResult:e.scannedTransactionResult};case Z.TransactionConfirmationStarted:return Kr(e,Ce.TransactionSubmitted),{type:Ce.ConfirmingTransaction,txReceipt:e.txReceipt,scannedTransactionResult:e.scannedTransactionResult,executingQuote:e.executingQuote};case Z.TransactionConfirmationFailed:return Kr(e,Ce.TransactionSubmitted),{type:Ce.TransactionNotConfirmed,txReceipt:e.txReceipt,scannedTransactionResult:e.scannedTransactionResult,error:r.error,executingQuote:e.executingQuote};case Z.TransactionConfirmed:return Kr(e,Ce.ConfirmingTransaction),{type:Ce.TransactionConfirmed,txReceipt:e.txReceipt,scannedTransactionResult:e.scannedTransactionResult,executingQuote:e.executingQuote}}}};function Kr(t,e){if(t.type!==e)throw new Zu(t,e)}i(Kr,"checkState");function JD(t,e){if(!e.includes(t.type))throw new Zu(t,e)}i(JD,"checkStateAny");u();l();var $e;(function(t){t.Idle="idle",t.Pair="pair",t.FetchingQuote="fetchingQuote",t.QuoteError="quoteError",t.Quote="quote",t.ExecutingSwap="executingSwap",t.SwapConfirmed="swapConfirmed"})($e||($e={}));function XT(t){return t.type===$e.Quote}i(XT,"isExecutableSwapState");u();l();u();l();var e1={"Could not find any routes":"noRoute"},Xu=class t extends Error{static{i(this,"QuoteError")}type;constructor(e,r){super(r??e),this.type=e}static fromMessage(e){let r=e?e1[e]??"undefinedError":"undefinedError";return new t(r,e)}};var bn=class extends Error{static{i(this,"SwapperIllegalTransitionError")}constructor(e,r){super(`Can't transition to ${r} from ${e.type}`)}},Ju=class{static{i(this,"SwapperStateMachine")}state;listeners=new Set;constructor(e){this.state=e??{type:$e.Idle}}send(e){let r=this.state;try{return r=this.detectNextState(this.state,e),this.state=r,r}catch{return this.state}finally{this.notifyListeners(e,this.state,r)}}getState(){return this.state}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(e,r,o){try{this.listeners.forEach(n=>n.onStateChange(e,r,o))}catch{}}detectNextState(e,r){switch(r.type){case At.SetPair:return{type:$e.Pair,buy:r.buy,sell:r.sell,amount:r.amount};case At.QuoteRequestStarted:switch(e.type){case $e.Pair:case $e.Quote:case $e.QuoteError:return{type:$e.FetchingQuote,buy:e.buy,sell:e.sell,amount:r.amount,slippageType:r.slippageType};default:throw new bn(e,r.type)}case At.QuoteRequestError:if(e.type!==$e.FetchingQuote)throw new bn(e,r.type);return{type:$e.QuoteError,buy:e.buy,sell:e.sell,amount:e.amount,error:r.error,slippageType:e.slippageType};case At.QuoteResponseReceived:if(e.type!==$e.FetchingQuote)throw new bn(e,r.type);let o=r.response.quotes[0];return o?{type:$e.Quote,response:r.response,buy:e.buy,sell:e.sell,quote:o,amount:e.amount,slippageType:e.slippageType}:{type:$e.QuoteError,buy:e.buy,sell:e.sell,amount:e.amount,error:new Xu("noRoute"),slippageType:e.slippageType};case At.QuoteResponseStreamed:switch(e.type){case $e.Pair:case $e.FetchingQuote:case $e.Quote:case $e.QuoteError:return{type:$e.Quote,response:r.response,buy:e.buy,sell:e.sell,quote:r.quote,amount:{amount:r.quoteInput.amount,perspective:r.quoteInput.exactOut?"buy":"sell"},slippageType:r.quoteInput.autoSlippage?fe.Auto:fe.Fixed,input:r.quoteInput};default:throw new bn(e,r.type)}case At.UserSelectedQuote:if(e.type!==$e.Quote)throw new bn(e,r.type);return{type:$e.Quote,quote:r.quote,buy:e.buy,sell:e.sell,response:e.response,amount:e.amount,slippageType:e.slippageType}}}};u();l();u();l();var JT=a.object({buyToken:a.custom(),sellToken:a.custom(),buyTokenPrice:a.custom().optional(),sellTokenPrice:a.custom().optional(),maxSellAmount:a.string().optional(),isPrediction:a.boolean().optional()}),Aa=class t extends Error{static{i(this,"SwapInitializationError")}type;constructor(e,r){super(r??e.name),this.type=e}static fromError(e){return new t({name:"unknown"},e.message)}};function ff(t,e){if(t.type!==e.type)return!1;switch(t.type){case"buy":return e.type!=="buy"?!1:t.buyCaip19===e.buyCaip19&&t.sellCaip19===e.sellCaip19&&t.takerCaip19===e.takerCaip19&&t.takerDestinationCaip19===e.takerDestinationCaip19&&t.options===e.options&&t.buyFungibleKey===e.buyFungibleKey;case"sell":return e.type!=="sell"?!1:t.sellCaip19===e.sellCaip19&&t.buyCaip19===e.buyCaip19&&t.takerCaip19===e.takerCaip19&&t.takerDestinationCaip19===e.takerDestinationCaip19&&t.options===e.options&&t.sellFungibleKey===e.sellFungibleKey;case"swap":return e.type!=="swap"?!1:t.network===e.network&&t.sellCaip19===e.sellCaip19&&t.buyCaip19===e.buyCaip19&&t.takerCaip19===e.takerCaip19&&t.takerDestinationCaip19===e.takerDestinationCaip19&&t.options===e.options;case"prediction":{if(e.type!=="prediction"||t.mode.direction!==e.mode.direction||t.outcomeType!==e.outcomeType||t.network!==e.network||t.takerCaip19!==e.takerCaip19||t.takerDestinationCaip19!==e.takerDestinationCaip19||t.options!==e.options)return!1;if(t.mode.direction==="buy"){if(e.mode.direction!=="buy"||t.mode.sellCaip19!==e.mode.sellCaip19)return!1}else if(e.mode.direction!=="sell"||t.mode.sellMintAddress!==e.mode.sellMintAddress)return!1;return t.mintAccounts===e.mintAccounts}default:{let r=t;return!1}}}i(ff,"isSwapModeEqual");var fo=class{static{i(this,"BackendSwapInitializer")}async initialize(e,r,o,n){let s=r.reduce((d,m)=>(d[m.networkID]=m.address,d),{}),c=await z.api().headers({"Content-Type":"application/json"}).timeout(K({seconds:20})).post("/swap/v2/initialize",{...e,addresses:s,cashAddresses:Dr?o:void 0,...n?{settings:n}:{}});if(c.status!==200)throw new ot({key:"SwapInitializationFailed"});let p=JT.safeParse(c.data);if(!p.success)throw new ot({key:"SwapInitializationFailed"});return{...p.data,takerCaip19:this.takerCaip19ForToken({token:p.data.sellToken,addresses:r}),takerDestinationCaip19:this.takerCaip19ForToken({token:p.data.buyToken,addresses:r})}}takerCaip19ForToken({token:e,addresses:r}){if(e.data.walletAddress&&wc(e))return N({chainId:e.data.chain.id,resourceType:V.address,address:e.data.walletAddress});let o=this.findChainAddress({chain:e.data.chain,addresses:r});return N({chainId:o.networkID,resourceType:V.address,address:o.address})}findChainAddress({chain:e,addresses:r}){let{id:o}=e,n=r.find(c=>c.networkID===o);if(!n)throw new Error(`No address found for chain ${o}`);let s={...n};return Br(s)&&(s.address=s.address.toLowerCase()),s}};u();l();var _s=class{static{i(this,"BitcoinSwapInitializer")}proxyInitializer;constructor(e){this.proxyInitializer=e}async initialize(e,r,o,n){let s=this.getBitcoinAddressTypeForKey(e);if(!s)return this.proxyInitializer.initialize(e,r,o,n);let{key:c,addressType:p,direction:d}=s,m=t1(r,y=>{if(!(Ng(y)&&y.addressType!==p))return y}),f=r.find(y=>y.addressType===p);if(!f)return this.proxyInitializer.initialize(e,r,o,n);switch(d){case"buy":e.takerDestinationCaip19=N({chainId:f.networkID,resourceType:V.address,address:f.address});break;case"sell":e.takerCaip19=N({chainId:f.networkID,resourceType:V.address,address:f.address});break}let g=await this.proxyInitializer.initialize(e,m,o,n);switch(d){case"buy":g.buyToken.data.key=c;break;case"sell":g.sellToken.data.key=c;break}switch(d){case"buy":g.takerCaip19=this.takerCaip19ForToken({token:g.sellToken,addresses:m});break;case"sell":g.takerDestinationCaip19=this.takerCaip19ForToken({token:g.buyToken,addresses:m});break}return g}keyToAddressType={"BitcoinNative-bip122_p2wpkh":se.BitcoinNativeSegwit,"BitcoinNative-bip122_p2tr":se.BitcoinTaproot,BitcoinNative:se.BitcoinTaproot};getBitcoinAddressTypeForKey(e){if(!(e.type!=="buy"&&e.type!=="sell"&&e.type!=="swap")){if(e.sellFungibleKey){let r=this.keyToAddressType[e.sellFungibleKey];if(r)return{key:e.sellFungibleKey,addressType:r,direction:"sell"}}if(e.buyFungibleKey){let r=this.keyToAddressType[e.buyFungibleKey];if(r)return{key:e.buyFungibleKey,addressType:r,direction:"buy"}}}}takerCaip19ForToken({token:e,addresses:r}){if(e.data.walletAddress)return N({chainId:e.data.chain.id,resourceType:V.address,address:e.data.walletAddress});let o=this.findChainAddress({chain:e.data.chain,addresses:r});return N({chainId:o.networkID,resourceType:V.address,address:o.address})}findChainAddress({chain:e,addresses:r}){let{id:o}=e,n=r.find(c=>c.networkID===o);if(!n)throw new Error(`No address found for chain ${o}`);let s={...n};return Br(s)&&(s.address=s.address.toLowerCase()),s}};function t1(t,e){return t.reduce((r,o)=>{let n=e(o);return n!=null&&r.push(n),r},[])}i(t1,"compactMap");u();l();function e0(t){if(t.type!=="pair")return;let{mode:e,buyToken:r,sellToken:o}=t;if(e.type!=="swap")throw new Error("Can't switch swap mode for: "+e.type);let n=N(J(t.buyToken)),s=N(J(t.sellToken)),c=t.takerDestinationCaip19,p=t.takerCaip19,d=r.data.key,m=o.data.key;return{type:"swap",network:n?Ve(n).chainId:I.solana.mainnetID,sellCaip19:n,buyCaip19:s,takerCaip19:c,takerDestinationCaip19:p,sellFungibleKey:d,buyFungibleKey:m}}i(e0,"switchSwapMode");u();l();u();l();u();l();u();l();u();l();u();l();var hf={id:I.solana.mainnetID,imageUrl:I.solana.iconUrl,name:I.solana.name,symbol:I.solana.tokenSymbol},Tn={type:ae.SolanaNative,data:{amount:"0",balance:new q(0),chain:hf,decimals:9,key:"SolanaNative",logoUri:"https://cdn.jsdelivr.net/gh/solana-labs/token-list@main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",name:"Solana",symbol:"SOL",tokenAddress:void 0,walletAddress:"",spamStatus:pe.Verified}},t0={type:ae.SPL,data:{amount:"0",balance:new q(0),chain:hf,decimals:6,key:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",logoUri:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",mintAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",name:"USD Coin",splTokenAccountPubkey:"EAF7dH8Jy43Xgp68PhyybKhfKxk46NFRkWN4PMCLqMfS",symbol:"USDC",tokenAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",walletAddress:"",programId:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",spamStatus:pe.Verified}},eX={type:ae.SPL,data:{amount:"0",balance:new q(0),chain:hf,decimals:6,key:"cash-account",logoUri:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",mintAddress:"CASHx9KJUStyftLFWGvEVf59SGeG9sh5FfcnZMVPCASH",name:"Cash",splTokenAccountPubkey:"8mK7wXFmkUYZnXmKWyKvP3jN9vQxT4R2pLsD6aGcHqYz",symbol:"CASH",tokenAddress:"CASHx9KJUStyftLFWGvEVf59SGeG9sh5FfcnZMVPCASH",walletAddress:"9vKHN2wXQPzJ4mR5sYtL3bUfD6eWcX7aGpMqS8hV4nTz",programId:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",spamStatus:pe.Verified}},r0={type:ae.SuiNative,data:{chain:{id:I.sui.mainnetID,name:I.sui.name,symbol:I.sui.tokenSymbol,imageUrl:I.sui.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/sui/info/logo.png",name:"Sui",symbol:"SUI",balance:new q(0),key:"SuiNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:pe.Verified}},o0={type:ae.SuiCoin,data:{chain:{id:I.sui.mainnetID,name:I.sui.name,symbol:I.sui.tokenSymbol,imageUrl:I.sui.iconUrl},walletAddress:"",contractAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",decimals:6,amount:"0",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new q(0),key:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",tokenAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:pe.Verified}},n0={type:ae.PolygonNative,data:{chain:{id:I.polygon.mainnetID,name:I.polygon.name,symbol:I.polygon.tokenSymbol,imageUrl:I.polygon.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://wallet-asset.matic.network/img/tokens/matic.svg",name:"Polygon",symbol:I.polygon.tokenSymbol,balance:new q(0),key:"PolygonNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:pe.Verified}},s0={type:ae.BaseNative,data:{chain:{id:I.base.mainnetID,name:I.base.name,symbol:I.base.tokenSymbol,imageUrl:I.base.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Base",symbol:I.base.tokenSymbol,balance:new q(0),key:"BaseNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:pe.Verified}},i0={type:ae.ArbitrumNative,data:{chain:{id:I.arbitrum.mainnetID,name:I.arbitrum.name,symbol:I.arbitrum.tokenSymbol,imageUrl:I.arbitrum.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new q(0),key:"ArbitrumNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:pe.Verified}},a0={type:ae.MonadNative,data:{chain:{id:I.monad.mainnetID,name:I.monad.name,symbol:I.monad.tokenSymbol,imageUrl:I.monad.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"https://static.phantom.app/assets/monad.png",name:"Monad",symbol:I.monad.tokenSymbol,balance:new q(0),key:"MonadNative",usd:0,price:0,usd_24h_change:0,tokenAddress:void 0,spamStatus:pe.Verified}},c0={type:ae.ERC20,data:{amount:"0",balance:new q(0),decimals:6,key:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",walletAddress:"",chain:{id:I.polygon.mainnetID,imageUrl:I.polygon.iconUrl,name:I.polygon.name,symbol:I.polygon.tokenSymbol},contractAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",spamStatus:pe.Verified}},u0={type:ae.ERC20,data:{amount:"0",balance:new q(0),decimals:6,key:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",walletAddress:"",chain:{id:I.base.mainnetID,imageUrl:I.base.iconUrl,name:I.base.name,symbol:I.base.tokenSymbol},contractAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",spamStatus:pe.Verified}},l0={type:ae.ERC20,data:{amount:"0",balance:new q(0),decimals:6,key:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",walletAddress:"",chain:{id:I.arbitrum.mainnetID,imageUrl:I.arbitrum.iconUrl,name:I.arbitrum.name,symbol:I.arbitrum.tokenSymbol},contractAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",spamStatus:pe.Verified}},p0={type:ae.ERC20,data:{amount:"0",balance:new q(0),decimals:6,key:"0x0000000000000000000000000000000000000000",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x0000000000000000000000000000000000000000",walletAddress:"",chain:{id:I.monad.mainnetID,imageUrl:I.monad.iconUrl,name:I.monad.name,symbol:I.monad.tokenSymbol},contractAddress:"0x0000000000000000000000000000000000000000",spamStatus:pe.Verified}},d0={type:ae.HyperevmNative,data:{chain:{id:I.hyperevm.mainnetID,name:I.hyperevm.name,symbol:I.hyperevm.tokenSymbol,imageUrl:I.hyperevm.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"",name:"Ethereum",symbol:"ETH",balance:new q(0),key:"HyperevmNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:pe.Verified}},m0={type:ae.ERC20,data:{amount:"0",balance:new q(0),decimals:6,key:"0xb88339cb7199b77e23db6e890353e22632ba630f",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0xb88339cb7199b77e23db6e890353e22632ba630f",walletAddress:"",chain:{id:I.hyperevm.mainnetID,imageUrl:I.hyperevm.iconUrl,name:I.hyperevm.name,symbol:I.hyperevm.tokenSymbol},contractAddress:"0xb88339cb7199b77e23db6e890353e22632ba630f",spamStatus:pe.Verified}},f0={type:ae.EthereumNative,data:{chain:{id:I.ethereum.mainnetID,name:I.ethereum.name,symbol:I.ethereum.tokenSymbol,imageUrl:I.ethereum.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new q(0),key:"EthereumNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:pe.Verified}},h0={type:ae.ERC20,data:{chain:{id:I.ethereum.mainnetID,name:I.ethereum.name,symbol:I.ethereum.tokenSymbol,imageUrl:I.ethereum.iconUrl},walletAddress:"",contractAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",decimals:6,amount:"1881092",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new q(0),key:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",tokenAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:pe.Verified}};var el="https://help.phantom.com/hc/en-us/articles/5985106844435",g0="https://help.phantom.com/hc/en-us/articles/29763090277139";var Wo={amount:new q(0),amountUsd:null,pct:0};u();l();var dr={};var y0={...dr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new q(15e-5*10**18),bridgeDefaultFee:new q(.025*10**18),averageNetworkFee:new q(15e-5*10**18),nativeFungible:i0,usdcFungible:l0};u();l();var w0={...dr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new q(15e-5*10**18),bridgeDefaultFee:new q(.025*10**18),averageNetworkFee:new q(15e-5*10**18),nativeFungible:s0,usdcFungible:u0};u();l();var S0={bridgeMinimumUsdAmounts:10,swapDefaultFee:new q(1e4),bridgeDefaultFee:new q(1e4),averageNetworkFee:new q(1e4),nativeFungible:{type:ae.BitcoinNative,data:{chain:{id:I.bitcoin.mainnetID,name:I.bitcoin.name,symbol:I.bitcoin.tokenSymbol,imageUrl:I.bitcoin.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Bitcoin",symbol:"BTC",balance:new q(0),key:"BitcoinNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:pe.Verified}},usdcFungible:{type:ae.BitcoinNative,data:{chain:{id:I.bitcoin.mainnetID,name:I.bitcoin.name,symbol:I.bitcoin.tokenSymbol,imageUrl:I.bitcoin.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Bitcoin",symbol:"BTC",balance:new q(0),key:"BitcoinNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:pe.Verified}}};u();l();var b0={...dr,bridgeMinimumUsdAmounts:20,swapDefaultFee:new q(2.5*10**16),bridgeDefaultFee:new q(3.75*10**16),averageNetworkFee:new q(0),nativeFungible:f0,usdcFungible:h0};u();l();var T0={...dr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new q(15e-5*10**18),bridgeDefaultFee:new q(.025*10**18),averageNetworkFee:new q(15e-5*10**18),nativeFungible:d0,usdcFungible:m0};u();l();var A0={...dr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new q(.015*10**18),bridgeDefaultFee:new q(.025*10**18),averageNetworkFee:new q(.0021*10**18),nativeFungible:a0,usdcFungible:p0,requiredFeatureFlag:"enable-monad-swapper"};u();l();var x0={...dr,bridgeMinimumUsdAmounts:2,swapDefaultFee:new q(6*10**16),bridgeDefaultFee:new q(6*10**16),averageNetworkFee:new q(.0015*10**18),nativeFungible:n0,usdcFungible:c0};u();l();var E0={bridgeMinimumUsdAmounts:1,swapDefaultFee:new q(3*10**6),bridgeDefaultFee:new q(30*10**6),averageNetworkFee:new q(15e3),nativeFungible:Tn,usdcFungible:t0};u();l();var C0={bridgeMinimumUsdAmounts:1,swapDefaultFee:new q(50*10**6),bridgeDefaultFee:new q(50*10**6),averageNetworkFee:new q(50*10**6),nativeFungible:r0,usdcFungible:o0};var gJ=[ce.Solana,ce.Ethereum,ce.Polygon,ce.Monad,ce.Base,ce.Sui,ce.Arbitrum,ce.Hyperevm,ce.Bitcoin],r1=new $n({[ce.Solana]:E0,[ce.Ethereum]:b0,[ce.Polygon]:x0,[ce.Monad]:A0,[ce.Base]:w0,[ce.Sui]:C0,[ce.Arbitrum]:y0,[ce.Hyperevm]:T0,[ce.Bitcoin]:S0}),mr=jn(r1);var xa=i((t,e)=>{let r=[];if(o1(t)&&r.push({type:"permanentDelegate",level:"warn",titleKey:"swapAssetWarningPermanentDelegate",shortTitleKey:"swapAssetWarningPermanentDelegateShort",modalTitleKey:"swapAssetWarningPermanentDelegateModalTitle"}),(t.data.spamStatus===pe.NotVerified||t.data.spamStatus===pe.Spam||t.data.spamStatus===pe.PossibleSpam)&&r.push({type:"unverified",level:"info",titleKey:"swapAssetWarningUnverified",shortTitleKey:"swapAssetWarningUnverifiedShort",modalTitleKey:"swapAssetWarningUnverifiedModalTitle"}),!Lt(t.type)&&e&&n1(e)){let o=mr.get(t.data.chain.id).nativeFungible;r.push({type:"lowBalance",level:"info",titleKey:"swapAssetWarningLowTokenBalance",shortTitleKey:"swapAssetWarningLowTokenBalanceShort",modalTitleKey:"swapAssetWarningLowTokenBalanceModalTitle",options:{token:o.data.symbol??"",network:o.data.chain.name}})}return r},"detectAssetWarnings");function o1(t){let e=t.data;return e?.mintExtensions?e.mintExtensions.some(r=>r.extension===gc.permanentDelegate):!1}i(o1,"hasPermanentDelegateExtension");function n1(t){let e=mr.get(t.data.chain.id);return new A(t.data.amount?t.data.amount:0).lt(e.swapDefaultFee)}i(n1,"isLowNativeTokenBalance");u();l();var s1=3,I0=new A(2039280),i1=new A(356190);function tl(t,e){if(!Lt(t.type))return new A(t.data.balance);let{balance:r,decimals:o}=t.data,n=r?new A(r).multipliedBy(10**o):new A(0),s=a1(t,e);return(n.gt(s)?n.minus(s):n).dividedBy(10**o)}i(tl,"getMaxSellAmountWithDefaults");function a1(t,e){let r=t.data.chain.id;if(I.isSolanaNetworkID(r))return c1(t,e);if(I.isEVMNetworkID(r))return u1(t,e);if(I.isSuiNetworkID(r))return l1(t,e);throw new Error("Chain not supported by swapper")}i(a1,"calculateFees");function c1(t,e){let{defaultSwapFee:r,networkFeeBuffer:o}=gf(t,e),n=r.plus(o),s=I0,c=!e||new A(e.data.balance).isZero()?I0:new A(0);return n.plus(s).plus(c)}i(c1,"calculateSolanaFees");function u1(t,e){let{networkFeeBuffer:r}=gf(t,e),o=p1(t.data.chain.id),n=new A(o.maxFeePerGas),s=new A(o.maxPriorityFeePerGas);return i1.multipliedBy(n.plus(s)).plus(r)}i(u1,"calculateEVMFees");function l1(t,e){let{defaultSwapFee:r,networkFeeBuffer:o}=gf(t,e);return r.plus(o)}i(l1,"calculateSuiFees");function gf(t,e){let r=vt(t.data.chain.id,e?.data.chain.id),o=mr.get(t.data.chain.id),n=r?o.bridgeDefaultFee:o.swapDefaultFee,s=o.averageNetworkFee.multipliedBy(s1);return{defaultSwapFee:n,networkFeeBuffer:s}}i(gf,"getCommonFeeComponents");function p1(t){if(I.isEthereumNetworkID(t))return{maxFeePerGas:new A("5000000000"),maxPriorityFeePerGas:new A("79000000")};if(I.isPolygonNetworkID(t))return{maxFeePerGas:new A("30000000000"),maxPriorityFeePerGas:new A("30000000000")};if(I.isBaseNetworkID(t))return{maxFeePerGas:new A("25000000"),maxPriorityFeePerGas:new A("1100000")};if(I.isArbitrumNetworkID(t))return{maxFeePerGas:new A("29000000"),maxPriorityFeePerGas:new A("0")};throw new Error("Chain not supported by swapper")}i(p1,"getEVMDefaultTransactionUnitCost");var rl=class{static{i(this,"TokenStateMachine")}state={type:"idle"};eventListeners=[];send(e){let r=this.state,o=r;try{return o=this.detectNextState(e),this.state=o,o}catch{return r}finally{this.eventListeners.forEach(n=>n.onStateChange(e,r,o))}}detectNextState(e){switch(e.type){case"initializeStarted":return{type:"initializing",mode:e.mode};case"initializeCompleted":if(this.state.type==="initializing"||this.state.type==="refreshing"){let r=new A(e.result.maxSellAmount??e.result.sellToken.data.balance);return{type:"pair",mode:this.state.mode,sellToken:e.result.sellToken,buyToken:e.result.buyToken,sellTokenPrice:e.result.sellTokenPrice,buyTokenPrice:e.result.buyTokenPrice,warnings:xa(e.result.buyToken),maxSellAmount:r,takerCaip19:e.result.takerCaip19,takerDestinationCaip19:e.result.takerDestinationCaip19,isPrediction:e.result.isPrediction??!1,predictionsQuoteInput:e.result.predictionsQuoteInput}}throw new Error("Invalid state");case"initializeFailed":if(this.state.type!=="initializing")throw new Error("Invalid state");return{type:"error",error:e.error};case"switchTokens":{if(this.state.type!=="pair")throw new Error("Invalid state");let r=this.state.buyToken,o=this.state.sellToken,n=this.state.buyTokenPrice,s=this.state.sellTokenPrice;return{type:"pair",mode:e.mode,sellToken:r,buyToken:o,sellTokenPrice:n,buyTokenPrice:s,maxSellAmount:tl(r,o),warnings:xa(o),takerCaip19:this.state.takerDestinationCaip19,takerDestinationCaip19:this.state.takerCaip19,isPrediction:this.state.isPrediction}}case"changeToken":{if(this.state.type!=="pair")throw new Error("Invalid state");let r=e.perspective==="sell"?e.token:this.state.sellToken,o=e.perspective==="buy"?e.token:this.state.buyToken;return{type:"pair",mode:e.mode,sellToken:r,buyToken:o,sellTokenPrice:e.sellTokenPrice??this.state.buyTokenPrice,buyTokenPrice:e.buyTokenPrice??this.state.sellTokenPrice,maxSellAmount:tl(r,o),warnings:xa(e.perspective==="buy"?e.token:this.state.buyToken),takerCaip19:this.state.takerCaip19,takerDestinationCaip19:this.state.takerDestinationCaip19,isPrediction:this.state.isPrediction}}case"updateBalances":{if(this.state.type!=="pair")throw new Error("Invalid state");if(N(J(this.state.sellToken))!==e.sellTokenCaip19)throw new Error("Invalid state");let r={...this.state.sellToken,data:{...this.state.sellToken.data,balance:e.sellTokenBalance}},o=this.state.buyToken;return{type:"pair",mode:this.state.mode,sellToken:r,buyToken:o,sellTokenPrice:this.state.sellTokenPrice,buyTokenPrice:this.state.buyTokenPrice,warnings:xa(o),maxSellAmount:tl(r,o),takerCaip19:this.state.takerCaip19,takerDestinationCaip19:this.state.takerDestinationCaip19,isPrediction:this.state.isPrediction}}case"refreshing":if(this.state.type!=="pair")throw new Error("Invalid state");return{type:"refreshing",mode:this.state.mode,sellToken:this.state.sellToken,buyToken:this.state.buyToken,sellTokenPrice:this.state.sellTokenPrice,buyTokenPrice:this.state.buyTokenPrice,maxSellAmount:this.state.maxSellAmount,warnings:this.state.warnings,takerCaip19:this.state.takerCaip19,takerDestinationCaip19:this.state.takerDestinationCaip19,isPrediction:this.state.isPrediction}}}getState(){return this.state}subscribe(e){this.eventListeners.push(e)}unsubscribe(e){this.eventListeners=this.eventListeners.filter(r=>r!==e)}};var ol=class{static{i(this,"Swapper")}apiClient;swapCommandFactory;quoteProcessor;stateMachine=new Ju;executeSwapStateMachine=new Yu;account;cashAccount;config={slippageType:fe.Auto,slippageTolerance:1.3,isSimulationKilled:!1};swapInitializer=new _s(new fo);tokenStateMachine=new rl;accountChangeListeners=[];constructor(e,r,o,n){this.apiClient=e,this.swapCommandFactory=r,this.quoteProcessor=o,this.quoteProcessor.subscribe(this.quoteProcessorListener),this.tokenStateMachine.subscribe(this.tokenStateListener),n&&(this.account=n)}tokenStateListener={onStateChange:i((e,r,o)=>{o.type==="pair"&&(this.setPair(o.buyToken,o.sellToken,{amount:"0",perspective:"sell"}),e.type==="changeToken"&&this.refreshQuoteProcessor())},"onStateChange")};refreshPair({swapMode:e,cashAddresses:r,settings:o}){this.initializeSwap({swapMode:e,cashAddresses:r,settings:o,refresh:!0})}initializeSwap({swapMode:e,cashAddresses:r,settings:o,refresh:n=!1}){let s=this.checkAccount();this.getTokenState().type==="pair"&&n?this.tokenStateMachine.send({type:"refreshing"}):this.tokenStateMachine.send({type:"initializeStarted",mode:e}),this.swapInitializer.initialize(e,s.addresses,r,o).then(p=>{this.tokenStateMachine.send({type:"initializeCompleted",result:p})}).catch(p=>{k.captureError(p,_.Swapper),p instanceof Aa?this.tokenStateMachine.send({type:"initializeFailed",error:p}):this.tokenStateMachine.send({type:"initializeFailed",error:Aa.fromError(p)})})}updateBalances({sellTokenBalance:e,sellTokenCaip19:r}){this.getTokenState().type==="pair"&&this.tokenStateMachine.send({type:"updateBalances",sellTokenBalance:e,sellTokenCaip19:r})}getTokenState(){return this.tokenStateMachine.getState()}subscribeToken(e){return this.tokenStateMachine.subscribe(e),()=>this.unsubscribeToken(e)}unsubscribeToken(e){this.tokenStateMachine.unsubscribe(e)}quoteProcessorListener={onStateChange:i((e,r)=>{(r.type==="firstQuoteReceived"||r.type==="quoteProcessed")&&this.send({type:At.QuoteResponseStreamed,response:r.response,quoteInput:r.input,quote:r.quote})},"onStateChange")};isValidAmount(e){try{let r=new A(e);return r.isFinite()?!r.isNegative():!1}catch{return!1}}setAmount(e,r){let o=this.getTokenState();if(!ht(o)){console.error(`Can't set amount from tokenState ${o.type}`);return}let{amount:n}=e;if(n===""&&(n="0"),!this.isValidAmount(n))return;this.quoteProcessor.stop();let s=this.checkAccount(),c={...this.config,...r,isSimulationKilled:r?.isSimulationKilled??this.config.isSimulationKilled??!1};if(n==="0"||n===""){this.send({type:At.SetPair,buy:o.buyToken,sell:o.sellToken,amount:e});return}let{buyToken:p,sellToken:d,takerCaip19:m,takerDestinationCaip19:f,isPrediction:g,predictionsQuoteInput:y}=o,w=De(p)||De(d);try{let S={amount:new A(e.amount).shiftedBy(e.perspective==="buy"?p.data.decimals:d.data.decimals).toString(),amountUsd:A(e.amount).times(e.perspective==="buy"?p.data.price??0:d.data.price??0).toString(),buy:p,sell:d,taker:m,takerDestination:f,slippageTolerance:c.slippageTolerance,autoSlippage:c.slippageType===fe.Auto,exactOut:e.perspective==="buy",priorityFee:c.priorityFee,tipAmount:c.tipAmount,preferredProvider:c.preferredProvider,isLedger:s.type==="ledger",phantomCashAccount:w,isSimulationKilled:c.isSimulationKilled,isPrediction:g??!1,predictions:y};this.quoteProcessor.start(S,s)}catch(S){console.error("Error when streaming quotes",S)}}setPair(e,r,o){this.send({type:At.SetPair,buy:e,sell:r,amount:o})}switchTokens(){let e=this.getTokenState();if(e.type!=="pair")return;let r=e0(e);r&&this.tokenStateMachine.send({type:"switchTokens",mode:r})}setAccount(e){this.account=e,this.accountChangeListeners.forEach(r=>r.onAccountChange(e))}setCashAccount(e){this.cashAccount=e}getAccount(){return this.account}getInitializer(){return this.swapInitializer}setInitializer(e){this.swapInitializer=e}async fetchQuotes({amount:e,amountUsd:r,buy:o,sell:n,slippageTolerance:s,autoSlippageEnabled:c,priorityFee:p,tipAmount:d,signal:m,phantomCashAccount:f}){let g=J(n),y=J(o),w=e.perspective==="buy",S=new A(e.amount).shiftedBy(e.perspective==="buy"?o.data.decimals:n.data.decimals).toString();this.send({type:At.QuoteRequestStarted,amount:e,slippageType:c?fe.Auto:fe.Fixed});let b=this.checkChainAddress(n.data),T={chainId:b.networkID,resourceType:V.address,address:b.address},x;if(vt(n.data.chain.id,o.data.chain.id)){let C=this.checkChainAddress(o.data);x={chainId:C.networkID,resourceType:V.address,address:C.address}}try{let C=await this.apiClient.getQuotes({sell:g,buy:y,amount:S,amountUsd:r,taker:T,takerDestination:x,slippageTolerance:s??0,autoSlippageEnabled:c,exactOutEnabled:w,priorityFee:p,tipAmount:d,signal:m,phantomCashAccount:f});return this.send({type:At.QuoteResponseReceived,response:C}),C}catch(C){throw this.send({type:At.QuoteRequestError,error:C}),C}}async swap(e){let{signer:r,storage:o,locale:n,deviceId:s,connection:c,authRepository:p,isSimulationKilled:d,gasEstimation:m,preprocessor:f}=e,g=this.getState();if(!XT(g))throw new Error(`Can't swap from ${g.type}`);this.quoteProcessor.stop();let y=this.checkAccount(),w={account:y,buy:g.buy,sell:g.sell,amount:g.amount,quote:g.quote,response:g.response,slippageType:g.slippageType,quoteInput:g.input},S=this.getAddressFromCaip19({caip19:g.response.taker}),b=this.swapCommandFactory.create(w,S,g.sell.data.chain.id,c,p,this.cashAccount,m),T=new Wu(b,C=>this.executeSwapStateMachine.send(C),w),x=await T.createTransaction();await k.startSpan(mf(le(g.quote),x.type),async()=>{let C=await T.simulate(x,n,s,d),E=i(async()=>{let P=await T.swap(y.identifier,x,C,r,o);await T.waitForConfirmation(P)},"performSwap");f?await f(E):await E()})}changeToken(e,r,o){let n=this.getTokenState();if(n.type!=="pair")return;let s=r==="buy"?e:n.buyToken,c=r==="sell"?e:n.sellToken,p=J(c),d=J(s),m;n.mode.type==="swap"?m={...n.mode,network:c.data.chain.id,sellCaip19:N(p),buyCaip19:N(d),takerCaip19:r==="sell"?o:n.mode.takerCaip19,takerDestinationCaip19:r==="buy"?o:n.mode.takerDestinationCaip19,sellFungibleKey:r==="sell"?e.data.key:n.mode.sellFungibleKey,buyFungibleKey:r==="buy"?e.data.key:n.mode.buyFungibleKey}:n.mode.type==="buy"?m={...n.mode,buyCaip19:N(d),sellCaip19:N(p),takerCaip19:r==="buy"?o:n.mode.takerCaip19}:n.mode.type==="sell"&&(m={...n.mode,sellCaip19:N(p),buyCaip19:N(d),takerDestinationCaip19:r==="sell"?o:n.mode.takerDestinationCaip19}),Sc({tokens:[d,p]}).then(f=>{let g=f[N(d)],y=f[N(p)];this.tokenStateMachine.send({type:"changeToken",mode:m,token:e,perspective:r,buyTokenPrice:g,sellTokenPrice:y})}).catch(f=>{k.captureError(f,_.Swapper),this.tokenStateMachine.send({type:"changeToken",mode:m,token:e,perspective:r})})}selectQuote(e){this.send({type:At.UserSelectedQuote,quote:e})}setQuoteConfig(e){this.config={...this.config,...e},this.refreshQuoteProcessor()}refreshQuoteProcessor(){let e=this.getLastQuoteProcessorSwapAmount();e&&this.setAmount(e)}getLastQuoteProcessorSwapAmount(){let e=this.getQuoteProcessorState();switch(e.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":let r=e.input;return{amount:new A(r.amount).shiftedBy(-1*(r.exactOut?r.buy.data.decimals:r.sell.data.decimals)).toString(),perspective:r.exactOut?"buy":"sell"};default:return}}getState(){return this.stateMachine.getState()}getExecuteState(){return this.executeSwapStateMachine.getState()}stopProcessingQuotes(){this.quoteProcessor.stop()}subscribeExecution(e){return this.executeSwapStateMachine.addListener(e),()=>this.unsubscribeExecution(e)}unsubscribeExecution(e){this.executeSwapStateMachine.removeListener(e)}getQuoteProcessorState(){return this.quoteProcessor.getState()}subscribeQuoteProcessor(e){return this.quoteProcessor.subscribe(e),()=>this.unsubscribeQuoteProcessor(e)}unsubscribeQuoteProcessor(e){this.quoteProcessor.unsubscribe(e)}stopQuoteProcessor(){this.quoteProcessor.stop()}subscribeAccountChange(e){return this.accountChangeListeners.push(e),()=>this.unsubscribeAccountChange(e)}unsubscribeAccountChange(e){this.accountChangeListeners=this.accountChangeListeners.filter(r=>r!==e)}setQuoteStreamer(e){this.quoteProcessor.setQuoteStreamer(e)}getSwapCommandFactory(){return this.swapCommandFactory}setSwapCommandFactory(e){this.swapCommandFactory=e}send(e){return this.stateMachine.send(e)}checkAccount(){if(!this.account)throw new Error("Must set a MultiChainAccount");return this.account}checkChainAddress({chain:e,walletAddress:r}){let{id:o}=e;if(r)return{networkID:o,address:r};let s=this.checkAccount().addresses.find(p=>p.networkID===o);if(!s)throw new Error(`No address found for chain ${o}`);let c={...s};return Br(c)&&(c.address=c.address.toLowerCase()),c}getAddressFromCaip19(e){let r;if("encodedCaip19"in e?r=Ve(e.encodedCaip19):r=e.caip19,r.resourceType===V.address)return r.address;throw new Error(`CAIP19 ${r} is not an address`)}};u();l();var nl=D(O());var k0=(0,nl.createContext)(null),F0=k0.Provider;function vs(){let t=(0,nl.useContext)(k0);if(!t)throw new Error("useBridgeStatusManager must be used within a BridgeStatusManagerProvider");return t}i(vs,"useBridgeStatusManager");u();l();var P0=D(O());u();l();u();l();var Ea=class{static{i(this,"WarmSwapAnalytics")}analytics;constructor(e){this.analytics=e}warmingStarted(e){this.analytics.capture("swapperWarmingStarted",{data:{mode:e.type,caip19:this.getCaip19(e)}})}warmingCompleted(e,r){this.analytics.capture("swapperWarmingCompleted",{data:{mode:e.type,caip19:this.getCaip19(e),durationMs:r}})}warmingFailed(e){this.analytics.capture("swapperWarmingFailed",{data:{mode:e.type,caip19:this.getCaip19(e)}})}cacheHit(e){this.analytics.capture("swapperWarmCacheHit",{data:{mode:e.type,caip19:this.getCaip19(e)}})}cacheMiss(e){this.analytics.capture("swapperWarmCacheMiss",{data:{mode:e.type,caip19:this.getCaip19(e)}})}warmingAwaited(e){this.analytics.capture("swapperWarmingAwaited",{data:{mode:e.type,caip19:this.getCaip19(e)}})}getCaip19(e){switch(e.type){case"buy":return e.buyCaip19;case"sell":return e.sellCaip19;default:return}}};var sl=class{static{i(this,"WarmSwapInitializer")}proxyInitializer;multiChainAccount;cashAddresses;cache;analytics;constructor(e,r,o){this.proxyInitializer=e,this.cache=new yf(r),this.analytics=o?new Ea(o):void 0}async initialize(e,r,o,n){let s=this.cache.get(e);if(!s)return this.analytics?.cacheMiss(e),this.proxyInitializer.initialize(e,r,o,n);switch(s.type){case"idle":return this.analytics?.cacheMiss(e),this.proxyInitializer.initialize(e,r,o,n);case"warming":return this.analytics?.warmingAwaited(e),s.promise.catch(()=>this.proxyInitializer.initialize(e,r,o,n)).finally(()=>{this.cache.delete(e)});case"warmed":return this.analytics?.cacheHit(e),this.cache.delete(e),s.initializationResult}}warmInitialization(e){if(!this.multiChainAccount)return;let r=this.cache.peek(e);if(r&&r.type==="warmed"&&ff(r.swapMode,e))return;this.analytics?.warmingStarted(e);let o=Date.now(),n=this.proxyInitializer.initialize(e,this.multiChainAccount.addresses,this.cashAddresses??{},{});this.cache.set(e,{type:"warming",swapMode:e,promise:n}),n.then(s=>{let c=Date.now()-o;this.analytics?.warmingCompleted(e,c),this.cache.set(e,{type:"warmed",swapMode:e,initializationResult:s})}).catch(()=>{this.analytics?.warmingFailed(e),this.cache.delete(e)})}setMultiChainAccount(e){this.cache.clear(),this.multiChainAccount=e}setCashAddresses(e){this.cache.clear(),this.cashAddresses=e}setAnalytics(e){this.analytics||(this.analytics=new Ea(e))}},yf=class{static{i(this,"Cache")}capacity;entries=new Map;constructor(e){this.capacity=e}getKey(e){let r={type:e.type},o=i(n=>{if(n?.minimumOrderSize)return{minimumOrderSize:{base:n.minimumOrderSize.base?.toString(),quote:n.minimumOrderSize.quote?.toString()}}},"serializeOptions");switch(e.type){case"buy":return JSON.stringify({...r,buyCaip19:e.buyCaip19,sellCaip19:e.sellCaip19,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:o(e.options)});case"sell":return JSON.stringify({...r,sellCaip19:e.sellCaip19,buyCaip19:e.buyCaip19,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:o(e.options)});case"swap":return JSON.stringify({...r,network:e.network,sellCaip19:e.sellCaip19,buyCaip19:e.buyCaip19,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:o(e.options)});case"prediction":return JSON.stringify({...r,network:e.network,mode:e.mode,outcomeType:e.outcomeType,mintAccounts:e.mintAccounts,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:o(e.options)});default:let n=e;return JSON.stringify(r)}}get(e){return this.entries.get(this.getKey(e))}peek(e){return this.entries.get(this.getKey(e))}set(e,r){let o=this.getKey(e);if(this.entries.set(o,r),this.entries.size>this.capacity){let n=Array.from(this.entries.keys())[0];this.entries.delete(n)}}delete(e){this.entries.delete(this.getKey(e))}clear(){this.entries.clear()}};var d1=2,il=new sl(new _s(new fo),d1);var _0=(0,fr.createContext)(null);function m1({children:t,processorMode:e="noOp",quoteStreamer:r}){let{data:o}=de(),n=pt(),s=(0,fr.useMemo)(()=>Ab(n),[n]);(0,fr.useEffect)(()=>{s.initialize()},[s]);let c=(0,fr.useMemo)(()=>v0(e,s),[e,s]);(0,fr.useEffect)(()=>{o&&(c.setAccount(o),il.setMultiChainAccount(o))},[o,c]),(0,fr.useEffect)(()=>{r&&c.setQuoteStreamer(r)},[r,c]);let p=Kc();return(0,fr.useEffect)(()=>{p&&il.setCashAddresses(p)},[p,c]),(0,wf.jsx)(F0,{value:s,children:(0,wf.jsx)(_0.Provider,{value:c,children:t})})}i(m1,"SwapperProvider");function nt(){let t=(0,fr.useContext)(_0);return t||v0("noOp")}i(nt,"useSwapper");function v0(t,e){let r=new ol(new Wc,new hu(e),new Bu(new wu(Dr?new yu:new gu),t==="noOp"?new _u:new Pu));return r.setInitializer(il),r}i(v0,"createSwapper");u();l();var R0=D(O());var f1=i(t=>{let e=pt(),r=vs(),{t:o}=ze(),n=(0,R0.useRef)(void 0),s=xy.pendingTransactionById(t);return oe({queryKey:s,queryFn:i(async()=>{try{let d=(await Ry(e))[t],m=d?void 0:r.getPendingBridgeTransactionById(t,o),f=d??m;return f?(Ig(f,n.current)||(n.current=f),n.current):void 0}catch(p){throw k.captureError(p,_.Transaction),p}},"queryFn"),refetchInterval:K({milliseconds:200}),staleTime:K({milliseconds:200}),gcTime:0,refetchOnMount:!0})},"usePendingTransactionByIdWithBridge");u();l();var ho=D(O());u();l();var Vr=i(t=>{let e=Math.floor(t/3600),r=Math.floor((t-e*3600)/60),o=t%60;if(e>0)return v.t("swapProviderEstimatedTimeHM",{hours:e,minutes:r});if(r>0){let n=o>0?r+1:r;return v.t("swapProviderEstimatedTimeM",{minutes:n})}return v.t("swapProviderEstimatedTimeS",{seconds:o})},"formatSecondsAsSwapTime");u();l();var al=i(t=>t.steps.reduce((e,r)=>e.plus(new q(r.nonIncludedNonGasFees)),new q(0)),"getBridgeStepsFees"),Rs=i(t=>t.steps.flatMap(r=>r.feeCosts).reduce((r,o)=>r.plus(o.amountUSD??0),new q(0)),"getBridgeStepsFeesInUsd");u();l();var Zo=i(t=>t&&le(t)?t.executionDuration:0,"getSwapExecutionDuration");var h1=i(({selectProvider:t})=>{let{currencySymbol:e,fromUsd:r}=Pt(),o=nt(),[n,s]=(0,ho.useState)(!1),[c,p]=(0,ho.useState)(o.getQuoteProcessorState());(0,ho.useEffect)(()=>{let g=o.subscribeQuoteProcessor({onStateChange(y,w){p(w)}});return()=>g()},[o]);let[d,m]=(0,ho.useState)(o.getTokenState());return(0,ho.useEffect)(()=>{let g=o.subscribeToken({onStateChange(y,w,S){m(S)}});return()=>g()},[o]),{details:(0,ho.useMemo)(()=>{if(c.type!=="quoteProcessed"&&c.type!=="firstQuoteReceived"||d.type!=="pair")return[];let g=c.quote,y=S1(g),w=g.baseProvider.name,S=w1({currentQuote:g,buyToken:d.buyToken,sellToken:d.sellToken,isFlipped:n,setIsFlipped:s});return le(g)?y1({quote:g,selectProvider:t,exchangeRate:S,currencySymbol:e,fromUsd:r}):g1({provider:w,sources:y,exchangeRate:S,selectProvider:t})},[c,d,t,e,r,n]),footnote:v.t("swapProviderPricingFootnote")}},"useSwapPricing"),g1=i(({provider:t,sources:e,exchangeRate:r,selectProvider:o})=>[{label:v.t("swapProviderPricingProvider"),value:t,icon:"chevron-right",onPress:o},{label:v.t("swapProviderPricingMarket"),value:e},{label:v.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip}],"getStandardRows"),y1=i(({quote:t,selectProvider:e,exchangeRate:r,currencySymbol:o,fromUsd:n})=>{let s=t.baseProvider.name,c=Rs(t).toString(),p=Vr(Zo(t));return[{label:v.t("swapProviderPricingProvider"),value:s,icon:"chevron-right",onPress:e},{label:v.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip},{label:v.t("swapProviderPricingFees"),value:`${o}${n(Number(c),2)} ${v.t("swapProvidersFee")}`},{label:v.t("swapProviderPricingTime"),value:p}]},"getBridgeRows");function w1({currentQuote:t,buyToken:e,sellToken:r,isFlipped:o,setIsFlipped:n}){let{exchangeRate:s,exchangeRateFlipped:c}=Rm(t,e,r);return{rate:o?c:s,flip:i(()=>n(!o),"flip")}}i(w1,"getExchangeRate");function S1(t){return Be(Le(t))}i(S1,"getSources");u();l();u();l();var go=D(O());function b1(t){let e=vs(),{t:r}=ze(),[o,n]=(0,go.useState)(0),[s,c]=(0,go.useState)(0),[p,d]=(0,go.useState)(0);return(0,go.useEffect)(()=>{let f={onBridgeStatusChange:i(g=>{n(y=>y+1),(g.type==="completed"||g.type==="failed")&&c(y=>y+1)},"onBridgeStatusChange")};return e.addListener(f),()=>{e.removeListener(f)}},[e]),(0,go.useEffect)(()=>{let f=setInterval(()=>{d(g=>g+1)},K({minutes:1}));return()=>clearInterval(f)},[]),{pendingBridgeTransactions:(0,go.useMemo)(()=>t.length?e.getPendingBridgeTransactions(r,{addresses:t}):[],[e,t,r,o,p,s])}}i(b1,"useBridgePendingActivities");u();l();var yo=D(O());var T1={"BitcoinNative-bip122_p2wpkh":se.BitcoinNativeSegwit,"BitcoinNative-bip122_p2tr":se.BitcoinTaproot,BitcoinNative:se.BitcoinTaproot};function D0(t){return T1[t]??null}i(D0,"normalizeBitcoinFungibleKey");function B0(t,e){let r=D0(t),o=D0(e);return r&&o?r===o:t===e}i(B0,"doBitcoinFungibleKeysMatch");function A1(t,e,r){let o=vs(),{t:n}=ze(),[s,c]=(0,yo.useState)(0),[p,d]=(0,yo.useState)(0);(0,yo.useEffect)(()=>{let y={onBridgeStatusChange:i(w=>{c(S=>S+1),(w.type==="completed"||w.type==="failed")&&d(S=>S+1)},"onBridgeStatusChange")};return o.addListener(y),()=>{o.removeListener(y)}},[o]);let m=(0,yo.useMemo)(()=>t.length?o.getPendingBridgeActivities(n,{addresses:t}):[],[o,t,n,s,p]),f=(0,yo.useMemo)(()=>t.length?o.getPendingBridgeTransactions(n,{addresses:t}):[],[o,t,n,s,p]);return{pendingBridgeTransactions:(0,yo.useMemo)(()=>{if(!f.length||!m.length)return[];let y=new Map(m.map(b=>[b.record.executionId,b.record])),w=I.isBitcoinNetworkID(r),S=e;return f.filter(b=>{let T=y.get(b.id);if(!T)return!1;let x=T.quote.sell,C=T.quote.buy;if(!x&&!C)return!1;if(x){let E=x.data.key;if(w&&B0(S,E))return!0;let P=J(x),M=an(P)?.[0];if(M&&S===M)return!0}if(C){let E=C.data.key;if(w&&B0(S,E))return!0;let P=J(C),M=an(P)?.[0];if(M&&S===M)return!0}return!1})},[f,m,e,r])}}i(A1,"useFungibleBridgePendingActivities");u();l();u();l();function wo(t){return{chain:ce.Solana,type:"fungible",address:t.type===ae.SPL?t.data.mintAddress:void 0,symbol:t.data.symbol??""}}i(wo,"getAnalyticsAsset");var Ds=class{static{i(this,"NextGenAnalytics")}analytics;additionalAnalyticsTags;constructor(e,r){this.analytics=e,this.additionalAnalyticsTags=r}captureEvent(e,r){let o={...r,data:{...r.data,...this.additionalAnalyticsTags}};this.analytics.capture(e,o)}swapperOpen(e,r,o){this.captureEvent("swapperOpen",{data:{uiContext:o??"swapperInterstitial",swapMode:e,comingFrom:r}})}swapperClose(e,r){this.captureEvent("swapperClose",{data:{uiContext:r??"swapperInterstitial",reason:e}})}swapperUpdateAsset(e,r){switch(e.type){case"sell":this.captureEvent("swapperUpdateToAsset",{data:wo(r)});break;case"buy":this.captureEvent("swapperUpdateFromAsset",{data:wo(r)});break}}swapperSwapDefaultQuoteSelected(e){this.captureEvent("swapperSwapDefaultQuoteSelected",{data:{quotePercentageValue:e}})}swapperDetailPanelClicked(){this.captureEvent("swapperDetailPanelClicked",{data:{uiContext:"swapperInterstitial"}})}swapperToggleQuoteCurrency(){this.captureEvent("swapperToggleQuoteCurrency",{data:{uiContext:"swapperInterstitial"}})}swapperQuotesResult(e,r,o){this.captureEvent("swapperQuotesResult",{data:{...Ca(e,o),numQuotes:r.quotes.length,sellToken:N(J(e.sell)),buyToken:N(J(e.buy)),fromNetworkId:e.sell.data.chain.id,toNetworkId:e.buy.data.chain.id,isGasless:r.quotes.some(n=>"gaslessSwapFeeResult"in n&&n.gaslessSwapFeeResult?.success===!0)}})}swapperQuotesError({input:e,quoteError:r}){this.captureEvent("swapperQuotesError",{data:{...Ca(e),error:r.name}})}};function Ca(t,e){let r=e?x1(e):void 0;return{isSellTokenVerified:t.sell.data.spamStatus&&hc({minimum:pe.Verified,spamStatus:t.sell.data.spamStatus}),sellTokenCaip19:N(J(t.sell)),sellTokenNetworkId:t.sell.data.chain.id,sellTokenSymbol:t.sell.data.symbol??void 0,sellTokenMarketCap:t.sell.data.marketCap,sellTokenAmount:t.amount,buyTokenCaip19:N(J(t.buy)),buyTokenNetworkId:t.buy.data.chain.id,buyTokenSymbol:t.buy.data.symbol??void 0,isAutoSlippageEnabled:t.autoSlippage,manualSlippagePercent:t.slippageTolerance,isExactOut:t.exactOut,isManualTipInput:t.tipAmount!==void 0,gaslessError:r?.error,gaslessAtaFeeUSD:r?.data?.ataFeeUSD,gaslessNetworkFeeUSD:r?.data?.networkFeeUSD,gaslessTotalAmountUSD:r?.data?.totalAmountUSD}}i(Ca,"createSwapperAnalyticsFields");function Sf(t){if(t.type==="quoteProcessed")return Ca(t.input,t.quote)}i(Sf,"createSwapperAnalyticsFieldsFromQuoteProcessorState");function x1(t){if(Ht(t))return t.gaslessSwapFeeResult}i(x1,"getGaslessSwapFeeResult");u();l();var E1=D(Ke());var Ia=D(O());var C1=(0,Ia.createContext)(void 0);var N0=i(()=>{let t=(0,Ia.useContext)(C1);if(!t)throw new Error("useSwapToken must be used within a SwapTokenProvider");return t},"useSwapToken");u();l();function L0(t,e,r,o){let s=e.find(p=>p.percentage===1)?.amount;if(o==="sell"&&s&&new q(t).gt(s))return["insufficientBalance"];let c=r.type==="buy"?r.options?.minimumOrderSize?.quote:r.options?.minimumOrderSize?.base;return c!=null&&new q(t).lt(c)?["minimumBalance"]:[]}i(L0,"createQuoteInputErrors");u();l();var I1=[.25,.5,1],bf=class{static{i(this,"SellPercentage")}percentage;amount;fiatAmount;constructor(e,r,o){this.percentage=e,this.amount=r,this.fiatAmount=o}getAmountForDenomination(e){return e==="crypto"?this.amount:this.fiatAmount}};function M0({maxSellAmount:t,sellTokenPrice:e,allowedPercentages:r=I1}){return r.map(o=>{let n=t.multipliedBy(o);return new bf(o,n,n.multipliedBy(e?.usd??0))})}i(M0,"getSellPercentages");u();l();var Af=D(O());u();l();var Bs=i(()=>Rt({key:Pe.PriorityFee,queryKey:me.priorityFee()}),"usePriorityFee"),qre=i(()=>Dt({key:Pe.PriorityFee,queryKey:me.priorityFee()}),"useSetPriorityFee");u();l();var Ns=i(()=>Rt({key:Pe.TipAmount,queryKey:me.tipAmount()}),"useTip"),Kre=i(()=>Dt({key:Pe.TipAmount,queryKey:me.tipAmount()}),"useSetTip");u();l();function Tf(t){return new A(t??0).multipliedBy(10**Dg.tokenDecimals)}i(Tf,"getCustomFee");u();l();var k1=3,F1=new q(356190),P1=i(t=>mr.get(t).averageNetworkFee.times(k1),"getNetworkFeeBuffer");function U0({sellFungible:t,totalFees:e,transactionSpeedsToUnitCost:r,minRequiredBalance:o,customPriorityFee:n,customTip:s,isBridge:c=!1}){let{decimals:p,amount:d,balance:m,chain:f}=t.data,g=d?new q(d):m?new q(m).multipliedBy(rc(p)):new q(0),y=Lt(t.type),w=De(t),{source:S,destination:b}=o;if(w)return ld(g.toString(),p);let x=_1({isNativeToken:y,network:f,totalFees:e,isBridge:c,transactionSpeedsToUnitCost:r,customPriorityFee:n,customTip:s}).plus(b),C=y?v1(g,x,S):g.toString();return ld(C,p)}i(U0,"getMaxSellAmount");function _1({isNativeToken:t,network:e,totalFees:r,isBridge:o,transactionSpeedsToUnitCost:n,customPriorityFee:s,customTip:c}){if(!t)return r;let p=mr.get(e.id),d=o?p.bridgeDefaultFee:p.swapDefaultFee,m=n?.[Ur.standard];return vy(m)&&(d=F1.multipliedBy(m.maxFeePerGas.plus(m.maxPriorityFeePerGas))),I.isSolanaNetworkID(e.id)&&s&&(d=d.plus(s)),I.isSolanaNetworkID(e.id)&&c&&(d=d.plus(c)),d.plus(P1(e.id))}i(_1,"calculateFees");function v1(t,e,r){let o=r.plus(e);return t.gt(o)?t.minus(o).toString():t.toString()}i(v1,"calculateNativeTokenMaxSell");u();l();var ka=D(O());var O0=i(t=>{let e=t?.data.chain.id,{data:r}=de(),o=(0,ka.useMemo)(()=>r?.addresses.find(s=>s.networkID===e),[r,e]),{data:n=0}=cn(o);return(0,ka.useMemo)(()=>new A(n),[n])},"useSourceMinRequiredBalance"),q0=i((t,e)=>{let r=t?.data.chain.id,n=e?.data.chain.id??r,{data:s}=de(),c=(0,ka.useMemo)(()=>s?.addresses.find(d=>d.networkID===n),[s,n]),{data:p=0}=cn(c);return(0,ka.useMemo)(()=>e?.data.amount||e?.data.balance&&new A(e.data.balance).gt(0)?new A(0):new A(p),[e?.data.amount,e?.data.balance,p])},"useDestinationMinRequiredBalance");function z0(t){let e=t.type==="pair"?t.sellToken:null,r=t.type==="pair"?t.buyToken:null,o=O0(e),n=q0(e,r),{data:s}=tw({networkID:e?.data.chain.id}),{data:c}=Bs(),{data:p}=Ns(),d=(0,Af.useMemo)(()=>!e||!r?!1:vt(e.data.chain.id,r.data.chain.id),[e,r]);return(0,Af.useMemo)(()=>e?U0({sellFungible:e,totalFees:new A(0),transactionSpeedsToUnitCost:I.isEVMNetworkID(e.data.chain.id)?s:void 0,isBridge:d,minRequiredBalance:{source:o,destination:n},customPriorityFee:Tf(c??0),customTip:Tf(p??0)}):"0",[e,s,d,o,n,c,p])}i(z0,"useGetMaxSellAmount");u();l();var So=ct(t=>({preferredProvider:void 0,setPreferredProvider:i(e=>t({preferredProvider:e}),"setPreferredProvider")}));u();l();var $0=D(O());u();l();var cl=i(()=>Rt({key:Pe.SlippageTolerance,queryKey:me.slippageTolerance()}),"useSlippageTolerance"),Qoe=i(()=>Dt({key:Pe.SlippageTolerance,queryKey:me.slippageTolerance()}),"useSetSlippageTolerance");u();l();var Q0=D(O());var Ls;(function(t){t.Auto="auto",t.Fixed="fixed"})(Ls||(Ls={}));var R1={type:Ls.Auto},H0=i(()=>{let{priorityFeeSetting:t,isFetched:e,save:r}=D1();return{isFetched:e,selectedSetting:t,setPriorityFeeSetting:r}},"usePriorityFeeSettings"),D1=i(()=>{let{data:t,isFetched:e}=Rt({key:Pe.PriorityFeeSettings,queryKey:me.priorityFeeSettings()}),{mutateAsync:r}=Dt({key:Pe.PriorityFeeSettings,queryKey:me.priorityFeeSettings()}),o=(0,Q0.useCallback)(async n=>{await r(n)},[r]);return{isFetched:e,priorityFeeSetting:t??R1,save:o}},"usePriorityFeeSettingsStore");u();l();var G0=D(O());var Ms;(function(t){t.Auto="auto",t.Fixed="fixed"})(Ms||(Ms={}));var B1={type:Ms.Auto},j0=i(()=>{let{tipSetting:t,isFetched:e,save:r}=N1();return{isFetched:e,selectedSetting:t,setTipSetting:r}},"useTipSettings"),N1=i(()=>{let{data:t,isFetched:e}=Rt({key:Pe.TipSettings,queryKey:me.tipSettings()}),{mutateAsync:r}=Dt({key:Pe.TipSettings,queryKey:me.tipSettings()}),o=(0,G0.useCallback)(async n=>{await r(n)},[r]);return{isFetched:e,tipSetting:t??B1,save:o}},"useTipSettingsStore");var K0=i(()=>{let{selectedSetting:t}=jt(),{data:e}=cl(),{data:r}=Bs(),{selectedSetting:o}=H0(),{data:n}=Ns(),{selectedSetting:s}=j0(),c=So(d=>d.preferredProvider),p=Po("kill-swapper-simulation")??!1;return(0,$0.useMemo)(()=>({slippageTolerance:e??void 0,priorityFee:o.type==="fixed"?r??void 0:void 0,tipAmount:s.type==="fixed"?n??void 0:void 0,slippageType:t.type,preferredProvider:c,isSimulationKilled:p}),[e,r,o.type,n,s.type,t,c,p])},"useQuoteConfig");u();l();var V0=D(O());var W0=i(()=>{let{data:t,isFetched:e}=Bs(),{data:r,isFetched:o}=Ns();return(0,V0.useMemo)(()=>{if(!e||!o||!t&&!r)return;let n={};return t&&(n.priorityFee=new A(t)),r&&(n.tip=new A(r)),n},[e,o,t,r])},"useSwapModeSettings");u();l();var Bt=D(O());var L1=i((t,e=[],r)=>{let o=nt(),n=ue(),s;try{s=N0().nextGenAnalytics}catch{}let c=(0,Bt.useMemo)(()=>s||new Ds(n,r),[n,r,s]),p=rt("enable-be-swapper-max-amount"),[d,m]=(0,Bt.useState)([]),[f,g]=(0,Bt.useState)(o.getTokenState());(0,Bt.useEffect)(()=>{let B=o.subscribeToken({onStateChange(W,Y,ee){g(ee)}});return()=>B()},[o,g]);let[y,w]=(0,Bt.useState)(o.getQuoteProcessorState());(0,Bt.useEffect)(()=>{let B=o.subscribeQuoteProcessor({onStateChange:i((W,Y)=>{Y.type==="firstQuoteReceived"&&c.swapperQuotesResult(Y.input,Y.response,Y.quote),w(Y),Ko.processQuoteProcessorState(Y)},"onStateChange")});return()=>{o.stopQuoteProcessor(),B()}},[o,c]);let S=(0,Bt.useMemo)(()=>U1(f,y),[f,y]),b=K0();(0,Bt.useEffect)(()=>{o.setQuoteConfig(b)},[b,o]);let T=z0(f),x=(0,Bt.useMemo)(()=>ht(f)?M0({sellTokenPrice:f.sellTokenPrice,allowedPercentages:e,maxSellAmount:p?f.maxSellAmount:new A(T)}):[],[f,e,p,T]),C=So(B=>B.setPreferredProvider);(0,Bt.useEffect)(()=>{let B=o.subscribeToken({onStateChange(W,Y,ee){W.type==="initializeStarted"&&C(void 0)}});return()=>B()},[o,C]);let E=(0,Bt.useCallback)(({amount:B,denomination:W,perspective:Y,tokenStateOverride:ee})=>{try{let X=M1(ee??f,B,W,Y),Ue=L0(X,x,t,Y);m(Ue),C(void 0),o.setAmount({amount:X,perspective:Y},{...b,preferredProvider:void 0})}catch(X){k.captureError(X,_.Swapper)}},[f,x,t,C,o,b]),{connection:P}=Mo(),M=pt(),G=vo(),R=Ro(),j=v.language,Q=Po("kill-swapper-simulation")??!1,F=(0,Bt.useCallback)(async B=>{B.forEach(Y=>o.subscribeExecution(Y));let W=await n.getDeviceId();await o.swap({signer:G,storage:M,locale:j,deviceId:W,connection:P,authRepository:R,isSimulationKilled:Q}),B.forEach(Y=>o.unsubscribeExecution(Y))},[o,n,G,M,j,P,R,Q]);return{setAmount:E,swap:F,tokenState:f,quoteProcessorState:y,quotedAmounts:S,inputErrors:d,sellPercentages:x}},"useSwapperQuotes");function M1(t,e,r,o){if(!ht(t))throw new Error("Token state is not a pair");let{sellTokenPrice:n,sellToken:s,buyToken:c,buyTokenPrice:p}=t;switch(r){case"fiat":switch(o){case"buy":if(!p?.usd)throw new Error("Token price not found");return new A(e).dividedBy(p.usd).decimalPlaces(c.data.decimals).toString();case"sell":if(!n?.usd)throw new Error("Token price not found");return new A(e).dividedBy(n.usd).decimalPlaces(s.data.decimals).toString()}break;case"crypto":switch(o){case"buy":return new A(e).decimalPlaces(c.data.decimals).toString();case"sell":return new A(e).decimalPlaces(s.data.decimals).toString()}break}}i(M1,"parseAmount");function U1(t,e){if(!ht(t)||e.type!=="firstQuoteReceived"&&e.type!=="quoteProcessed")return;let r=e.quote,{sellToken:o,buyToken:n,sellTokenPrice:s,buyTokenPrice:c}=t;return{buyAmount:new A(r.buyAmount).shiftedBy(-n.data.decimals),buyAmountUsd:c?.usd?new A(r.buyAmount).shiftedBy(-n.data.decimals).multipliedBy(c.usd):void 0,sellAmount:new A(r.sellAmount).shiftedBy(-o.data.decimals),sellAmountUsd:s?.usd?new A(r.sellAmount).shiftedBy(-o.data.decimals).multipliedBy(s.usd):void 0}}i(U1,"parseQuoteAmounts");u();l();function xf(t){switch(t.type){case Ie.SlippageExceeded:return v.t("swapTxConfirmationSwapFailedSlippageLimit");case Ie.InsufficientFunds:return v.t("swapTxConfirmationSwapFailedInsufficientBalance");case Ie.InsufficientGas:return v.t("swapTxConfirmationSwapFailedInsufficientGas");case Ie.AccountFrozen:return v.t("swapTxConfirmationSwapFailedAcountFrozen");case Ie.SimulationTimeout:return v.t("swapTxConfirmationSwapFailedSimulationTimeout");case Ie.StaleQuote:return v.t("swapTxConfirmationSwapFailedStaleQuote");case Ie.UnknownError:return v.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return v.t("swapTxConfirmationSwapFailedTryAgain")}}i(xf,"getSimulationErrorMessage");u();l();var vA=D(Ke());var bo=D(O());u();l();var Ef=class{static{i(this,"FullBalanceDisplayStrategy")}format(e,r){return`${Er(e)} ${r}`}},Cf=class{static{i(this,"CompactBalanceDisplayStrategy")}format(e,r){return`${Wn(e,{compact:!0})} ${r}`}},If=class{static{i(this,"CompactNoSymbolBalanceDisplayStrategy")}format(e){return Wn(e,{compact:!0})}};function kf(t){switch(t){case"full":return new Ef;case"compact":return new Cf;case"compactNoSymbol":return new If}}i(kf,"createBalanceDisplayStrategy");u();l();var ul=class{static{i(this,"DefaultGetSwapQuotesStrategy")}async fetch(e){return await Vc(e)}stopFetching(){}getFetchInterval(e){return e}};u();l();u();l();var Us=class{static{i(this,"QuoteLoggerExecuteSwapStateListener")}streamedQuoteLogger;constructor(e){this.streamedQuoteLogger=e}onStateChange(e,r,o){o.type===Ce.TransactionSubmitted&&this.streamedQuoteLogger.logState(o.txReceipt.id)}};u();l();u();l();u();l();var ll=i((t,e,r)=>{if(r)return xe(t,e).times(A(r)).toNumber()},"getAssetVolumeUsd"),Z0=i((t,e)=>e&&t?e>t?e:t:e??t,"getTotalUsdVolume");function Y0({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:o,buyAmount:n,sellAmount:s,phantomFeeUiAmount:c,priceImpact:p,provider:d,baseProvider:m,slippageTolerance:f,slippageType:g,sellSwapFilter:y,isRetry:w,analyticsContext:S}){if(e&&o){let b=ll(n,e.data.decimals,t),T=ll(s,o.data.decimals,r),x=Z0(b,T);return{networkId:o.data.chain.id,chainId:I.getChainID(o.data.chain.id),toNetworkId:e.data.chain.id,toChainId:I.getChainID(e.data.chain.id),isBridge:o.data.chain.id!==e.data.chain.id,marketName:`${o.data.symbol}/${e.data.symbol}`,tradeDirection:"sell",swapSource:d,baseProvider:m,priceImpact:p,fromAssetSymbol:o.data.symbol??"",fromAssetAddress:o.data.tokenAddress,fromAssetAmount:xe(s,o.data.decimals),fromAssetUsdPrice:r,fromAssetUsdVolume:T,toAssetSymbol:e.data.symbol??"",toAssetAddress:e.data.tokenAddress,toAssetAmount:xe(n,e.data.decimals),toAssetUsdPrice:t,toAssetUsdVolume:b,totalUsdVolume:x,feeUsd:c,slippageTolerance:f,slippageType:g,sellSwapFilter:y,isRetry:w,analyticsContext:S}}return null}i(Y0,"legacyAnalyticsPayload");function pl({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:o,quote:n,slippageTolerance:s,slippageType:c,sellSwapFilter:p,isRetry:d,analyticsContext:m,baseProvider:f}){if(e&&o){let{buyAmount:g,sellAmount:y}=n,w="priceImpact"in n?n.priceImpact:0,S="sources"in n?Be(n.sources):"",b=("fees"in n?n.fees.find(E=>E.type==="phantom")?.amount.toString():"")??"",T=ll(g,e.data.decimals,t),x=ll(y,o.data.decimals,r),C=Z0(T,x);return{chainId:o.data.chain.id??e.data.chain.id,swap:{marketName:`${o.data.symbol}/${e.data.symbol}`,tradeDirection:"sell",swapSource:S,priceImpact:w,fromAssetSymbol:o.data.symbol??"",fromAssetAddress:o.data.tokenAddress??"",fromAssetAmount:xe(y,o.data.decimals),fromAssetUsdPrice:r??0,fromAssetUsdVolume:x??0,toAssetSymbol:e.data.symbol??"",toAssetAddress:e.data.tokenAddress??"",toAssetAmount:xe(g,e.data.decimals),toAssetUsdPrice:t,toAssetUsdVolume:T,totalUsdVolume:C??0,feeUsd:Number(b),slippageTolerance:s,slippageType:c,sellSwapFilter:p,isRetry:d,analyticsContext:m,baseProvider:f}}}return null}i(pl,"analyticsPayload");function dl({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:o,buyAmount:n,sellAmount:s,phantomFeeUiAmount:c,priceImpact:p,provider:d,baseProvider:m,slippageTolerance:f,transactionId:g,slippageType:y,sellSwapFilter:w,isRetry:S,analyticsContext:b}){let T=Y0({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:o,buyAmount:n,sellAmount:s,phantomFeeUiAmount:c,priceImpact:p,provider:d,baseProvider:m,slippageTolerance:f,slippageType:y,sellSwapFilter:w,isRetry:S,analyticsContext:b});return T?{data:{...T,id:g}}:{}}i(dl,"getAnalyticsPayload");u();l();var ml=i(({txReceipt:t,networkID:e,amountType:r,swapAnalytics:o,walletAddress:n})=>{let s=Bo(e);k.addBreadcrumb(_.Swapper,"submittedTransaction",L.Info,{...s,txReceipt:t.id,method:s.chainType===se.Solana?"signAndSendTransaction":s.chainType===se.EVM?"eth_sendRawTransaction":s.chainType===se.Sui?"signAndExecuteTransaction":"UNKNOWN"}),s.chainType===se.Solana?o.submittedTransaction(t.id,{...s,method:"signAndSendTransaction",swapType:r==="sell"?"exactIn":"exactOut",walletAddress:n}):s.chainType===se.EVM?o.submittedTransaction(t.id,{...s,method:"eth_sendRawTransaction",swapType:r==="sell"?"exactIn":"exactOut",walletAddress:n}):s.chainType===se.Sui&&o.submittedTransaction(t.id,{...s,method:"signAndExecuteTransaction",swapType:r==="sell"?"exactIn":"exactOut",walletAddress:n})},"logTransactionSubmitted");u();l();var X0=D(O());var O1={calculate(t){let e=(t?.fees??[]).find(r=>r.type==="phantom");return{amount:new A(e?.amount??0),amountUsd:null,pct:e?.percentage??0}}},q1={calculate(t){let e=t.steps.flatMap(r=>r.feeCosts).find(r=>r.name==="phantom");return{amount:new A(e?.amount??0),amountUsd:null,pct:parseFloat(e?.percentage??"0")}}},J0=i(()=>{let{currentQuote:t}=Ee();return{phantomFee:(0,X0.useMemo)(()=>Ff(t),[t])}},"usePhantomFee");function Ff(t){return qr(t)?O1.calculate(t):le(t)?q1.calculate(t):Wo}i(Ff,"calculatePhantomFee");u();l();var fl=i(t=>t?le(t)?void 0:t.priceImpact:0,"getSwapPriceImpact");u();l();var eA=ct(t=>({lastFailedSwap:void 0,setLastFailedSwap:i(e=>{t({lastFailedSwap:e})},"setLastFailedSwap")}));function tA(){return eA.getState().lastFailedSwap}i(tA,"getLastFailedSwap");function Pf(t){eA.getState().setLastFailedSwap(t)}i(Pf,"setLastFailedSwap");var Os=class{static{i(this,"AnalyticsExecuteSwapStateListener")}swapAnalytics;analytics;uiContext;additionalAnalyticsTags;constructor(e,r,o="swapperClassic",n){this.swapAnalytics=e,this.analytics=r,this.uiContext=o,this.additionalAnalyticsTags=n}captureEvent(e,r){let o={...r,data:{...r?.data,...this.additionalAnalyticsTags}};this.analytics.capture(e,o)}onStateChange(e,r,o,n){switch(e.type){case Z.ExecuteSwapStarted:this.captureEvent("swapperSwap",{data:{...this.createAnalyticsPayload(o.executingQuote).data,uiContext:this.uiContext}});let s=pl({buyAssetUsdValue:o.executingQuote.buy.data.usd,buyToken:o.executingQuote.buy,sellAssetUsdValue:o.executingQuote.sell.data.usd,sellToken:o.executingQuote.sell,quote:o.executingQuote.quote,slippageTolerance:this.parseSlippageTolerance(o.executingQuote.slippageType,o.executingQuote.quote,o.executingQuote.response),slippageType:o.executingQuote.slippageType,sellSwapFilter:$.getState().swapFilter,isRetry:this.isRetry(o.executingQuote),analyticsContext:o.executingQuote.quote.analyticsContext,baseProvider:o.executingQuote.quote.baseProvider?.id??""});s&&(k.addBreadcrumb(_.Swapper,"approved",L.Info,Kn(s.swap)),this.swapAnalytics.approved(s));break;case Z.SimulationFailed:e.error.type!==Ie.SlippageExceeded&&k.captureError(e.error,_.Swapper),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(o.executingQuote).data,error:z1(e.error)}});break;case Z.TransactionSubmissionFailed:k.captureError(e.error,_.Swapper),e.error.type==="noSignature"&&this.captureEvent("swapperSwapFailureNoSignature"),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(o.executingQuote).data,error:e.error.message,uiContext:this.uiContext}});break;case Z.TransactionSubmissionSuccess:ml({txReceipt:e.txReceipt,networkID:e.txReceipt.networkID,amountType:o.executingQuote.amount.perspective==="buy"?"buy":"sell",swapAnalytics:this.swapAnalytics});break;case Z.TransactionConfirmationFailed:let c=Vo(e.error);k.captureError(e.error,_.Swapper),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(o.executingQuote).data,error:c.message,uiContext:this.uiContext}});let p=Bo(e.txReceipt.networkID),d={chainId:I.getChainID(e.txReceipt.networkID),networkId:e.txReceipt.networkID},m=e.txReceipt;switch(this.captureEvent("waitForTransactionConfirmationError",{data:{...d,errorMessage:c.message}}),p.chainType){case se.EVM:case se.Solana:case se.Sui:k.addBreadcrumb(_.Swapper,"transactionStatus",L.Error,{...p,txReceipt:m.id}),this.swapAnalytics.transactionStatus(m.id,{...p,status:{type:"error"}});break}break;case Z.TransactionConfirmed:this.captureEvent("swapperSwapSuccess",{data:{...this.createAnalyticsPayload(o.executingQuote,e.txReceipt).data,uiContext:this.uiContext}});let f=Bo(e.txReceipt.networkID);switch(k.addBreadcrumb(_.Swapper,"transactionStatus",L.Info,{...f,txReceipt:e.txReceipt.id}),f.chainType){case se.EVM:case se.Solana:case se.Sui:this.swapAnalytics.transactionStatus(e.txReceipt.id,{...f,status:{type:"confirmed"}});break}break}this.isFailureEvent(e)?Pf(o.executingQuote):e.type===Z.TransactionSubmissionSuccess&&Pf(void 0)}createAnalyticsPayload(e,r){let o=e.quote,n=$.getState(),s=dl({buyToken:e.buy,sellToken:e.sell,buyAmount:o.buyAmount.toString(),sellAmount:o.sellAmount.toString(),phantomFeeUiAmount:Ff(o).amountUsd?.toString()??"",priceImpact:fl(o),provider:Be(Le(o)),buyAssetUsdValue:n.buyUsdValue,sellAssetUsdValue:n.sellUsdValue,slippageTolerance:this.parseSlippageTolerance(e.slippageType,o,e.response),transactionId:r?.id??"",slippageType:e.slippageType,sellSwapFilter:n.swapFilter,isRetry:this.isRetry(e),analyticsContext:e.quote.analyticsContext,baseProvider:e.quote.baseProvider?.id??""}),c=e.quoteInput;return c?{data:{...s.data,...Ca(c,o)}}:s}parseSlippageTolerance(e,r,o){switch(e){case fe.Fixed:return o.slippageTolerance;case fe.Auto:return qr(r)?r.slippageTolerance:o.slippageTolerance}}isRetry(e){let r=tA();if(!r)return!1;let o=N(J(r.buy)),n=N(J(r.sell)),s=N(J(e.buy)),c=N(J(e.sell));return o===s&&n===c}isFailureEvent(e){switch(e.type){case Z.SimulationFailed:case Z.TransactionSubmissionFailed:case Z.TransactionConfirmationFailed:return!0;default:return!1}}};function z1(t){switch(t.type){case Ie.SlippageExceeded:return H.SlippageExceeded;case Ie.InsufficientFunds:return H.InsufficientFunds;case Ie.InsufficientGas:return H.InsufficientGas;case Ie.AccountFrozen:return H.AccountFrozen;case Ie.StaleQuote:return H.StaleQuote;case Ie.SimulationTimeout:return H.SimulationTimeout;case Ie.UnknownError:return H.SimulationUnknownError;case Ie.SimulationFailed:return"SIMULATION_FAILED";default:return H.NotValidScanResultsError}}i(z1,"toSimulationErrorMessage");u();l();u();l();function hl(t,e){let r=me.optimisticUpdates(),o=t.getQueryData(r)??[];t.setQueryData(r,[...o.filter(n=>n.id!==e.id),e])}i(hl,"pushOptimisticUpdate");function gl(t){return`${t.type}-${t.data.key}`}i(gl,"getOptimisticUpdateKey");var qs=class{static{i(this,"ConfirmationExecuteSwapStateListener")}queryClient;storage;authRepository;constructor(e,r,o){this.queryClient=e,this.storage=r,this.authRepository=o}onStateChange(e,r,o,n){let{sell:s,quote:c,account:p}=o.executingQuote;if(e.type===Z.TransactionConfirmed){this.storage.set(Pe.PriorityFee,null),this.storage.set(Pe.PriorityFeeSettings,{type:Ls.Auto}),this.queryClient.setQueryData(me.priorityFee(),null),this.queryClient.setQueryData(me.priorityFeeSettings(),{type:Ls.Auto}),this.storage.set(Pe.TipAmount,null),this.storage.set(Pe.TipSettings,{type:Ms.Auto}),this.queryClient.setQueryData(me.tipAmount(),null),this.queryClient.setQueryData(me.tipSettings(),{type:Ms.Auto});let d=new q(s.data.amount),m=new q(c.sellAmount),f=d.minus(m).toString();hl(this.queryClient,{id:gl(s),amount:f}),this.queryClient.invalidateQueries({queryKey:Zy.tokens(p.addresses)}),this.queryClient.invalidateQueries({queryKey:iw.tokenBalance({wallets:p.addresses,encodedCaip19:N(J(s))})})}}};u();l();u();l();var An=class{static{i(this,"SimulationAnalytics")}#e;constructor(e){this.#e=e}onScannedMessageByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"message",status:"success"}}})},"onScannedMessageByUser");onFailedScannedMessageByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"message",status:"error"}}})},"onFailedScannedMessageByUser");onScannedTransactionByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"transaction",status:"success"}}})},"onScannedTransactionByUser");onFailedScannedTransactionByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"transaction",status:"error"}}})},"onFailedScannedTransactionByUser");onSkippedTransactionByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"transaction",status:"skipped"}}})},"onSkippedTransactionByUser")};var rA="swap-validation",zs=class{static{i(this,"SimulationAnalyticsExecuteSwapStateListener")}simulationAnalytics;constructor(e){this.simulationAnalytics=new An(e)}onStateChange(e,r,o){switch(e.type){case Z.SimulationPassed:let n=e.scannedTransactionResult;this.simulationAnalytics.onScannedTransactionByUser({networkId:e.networkId,warnings:n.warnings.map(c=>c.severity),shouldBlock:!!n.block,errorCode:n.error??""});break;case Z.SimulationFailed:let s=e.error.scannedTransactionResult;if(s){this.simulationAnalytics.onScannedTransactionByUser({networkId:e.networkId,warnings:s.warnings.map(c=>c.severity),shouldBlock:!!s.block,errorCode:s.error??""}),s?.error&&k.addBreadcrumb(rA,`Simulation error: ${JSON.stringify({error:s.error})}`,L.Info);return}this.simulationAnalytics.onFailedScannedTransactionByUser({networkId:e.networkId,url:e.url}),k.addBreadcrumb("simulation",`networkID: ${e.networkId}, url: ${e.url}, type: transaction`,L.Info);break;case Z.SimulationSkipped:this.simulationAnalytics.onSkippedTransactionByUser({networkId:e.networkId}),k.addBreadcrumb(rA,`Simulation skipped for networkID: ${e.networkId}`,L.Info);break}}};u();l();u();l();u();l();var he;(function(t){t.Idle="idle",t.FetchingQuote="fetchingQuote",t.Quote="quote",t.SimulationRequestErrored="simulationRequestErrored",t.SimulationFailed="simulationFailed",t.Simulated="simulated",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionNotConfirmed="transactionNotConfirmed"})(he||(he={}));var Q1=10,H1=ct(t=>({transitions:[],addTransition:i((e,r)=>t(o=>{let n=G1(r,e);return n?{transitions:[n,...o.transitions].slice(0,Q1)}:o}),"addTransition")}));function wl(t,e){H1.getState().addTransition(t,e)}i(wl,"addSwapperTransition");function G1(t,e){switch(e.type){case he.Idle:return;case he.FetchingQuote:return;case he.Quote:return{sell:Wr(e.response,e.sell,"sell"),buy:Wr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Fa(e.quote),slippage:e.response.slippageTolerance,stateType:e.type,eventType:t.type,timestamp:Date.now()};case he.SimulationRequestErrored:return{sell:Wr(e.response,e.sell,"sell"),buy:Wr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Fa(e.quote),slippage:e.response.slippageTolerance,stateType:e.type,eventType:t.type,error:e.error,quoteTransactionData:yl(e.quote),timestamp:Date.now()};case he.Simulated:return;case he.SimulationFailed:return{sell:Wr(e.response,e.sell,"sell"),buy:Wr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Fa(e.quote),slippage:e.response.slippageTolerance,simulationError:e.simulationError,stateType:e.type,eventType:t.type,simulationWarning:e.scannedTransactionResult?.warnings,quoteTransactionData:yl(e.quote),simulationHumanReadableError:e.scannedTransactionResult?.simulationError?.humanReadableError,simulationRequestId:e.scannedTransactionResult?.advancedDetails?.requestId,timestamp:Date.now()};case he.TransactionSubmissionFailed:return{sell:Wr(e.response,e.sell,"sell"),buy:Wr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Fa(e.quote),slippage:e.response.slippageTolerance,error:e.error,stateType:e.type,eventType:t.type,quoteTransactionData:yl(e.quote),timestamp:Date.now()};case he.TransactionNotConfirmed:return{sell:Wr(e.response,e.sell,"sell"),buy:Wr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Fa(e.quote),slippage:e.response.slippageTolerance,stateType:e.type,eventType:t.type,quoteTransactionData:yl(e.quote),timestamp:Date.now(),error:e.error};default:return}}i(G1,"toSparseTransition");var Fa=i(t=>{let e=Le(t);return Be(e)},"parseProvider"),Wr=i((t,e,r)=>{switch(r){case"sell":return{caip19:t.sellToken,symbol:e.data.symbol??void 0};case"buy":return{caip19:t.buyToken,symbol:e.data.symbol??void 0}}},"parseTokens"),yl=i(t=>{if(!le(t))return t.transactionData},"parseQuoteTransactionData");u();l();var Xe;(function(t){t.QuoteRequestStarted="quoteRequestStarted",t.QuoteResponseReceived="quoteResponseReceived",t.QuoteSelected="quoteSelected",t.SimulationResponseReceived="simulationResponseReceived",t.SimulationRequestError="simulationRequestError",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionConfirmationFailed="transactionConfirmationFailed"})(Xe||(Xe={}));var Qs=class{static{i(this,"TransitionsExecuteSwapStateListener")}onStateChange(e,r,o,n){let s=this.toLegacyTransition(e,o);s&&wl(s.nextState,s.event)}toLegacyTransition(e,r){let{buy:o,sell:n,quote:s,response:c}=r.executingQuote;switch(e.type){case Z.SimulationFailed:return{event:{type:Xe.SimulationRequestError,error:e.error},nextState:{type:he.SimulationFailed,buy:o,sell:n,response:c,quote:s,scannedTransactionResult:e.error.scannedTransactionResult,simulationError:e.error.message}};case Z.TransactionSubmissionFailed:return{event:{type:Xe.TransactionSubmissionFailed,error:e.error},nextState:{type:he.TransactionSubmissionFailed,buy:o,sell:n,response:c,quote:s,error:e.error}};case Z.TransactionConfirmationFailed:return{event:{type:Xe.TransactionConfirmationFailed,error:e.error,txReceipt:e.txReceipt},nextState:{type:he.TransactionNotConfirmed,buy:o,sell:n,response:c,quote:s,error:e.error,txReceipt:e.txReceipt}};default:return}}};u();l();u();l();u();l();u();l();u();l();var oA=i(t=>{let e,r=new Set,o=i((f,g)=>{let y=typeof f=="function"?f(e):f;if(!Object.is(y,e)){let w=e;e=g??(typeof y!="object"||y===null)?y:Object.assign({},e,y),r.forEach(S=>S(e,w))}},"setState"),n=i(()=>e,"getState"),d={setState:o,getState:n,getInitialState:i(()=>m,"getInitialState"),subscribe:i(f=>(r.add(f),()=>r.delete(f)),"subscribe"),destroy:i(()=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()},"destroy")},m=e=t(o,n,d);return d},"createStoreImpl"),nA=i(t=>t?oA(t):oA,"createStore");var gA=D(O(),1),yA=D(mA(),1);var{useDebugValue:cB}=gA.default,{useSyncExternalStoreWithSelector:uB}=yA.default,fA=!1,lB=i(t=>t,"identity");function pB(t,e=lB,r){(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&r&&!fA&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),fA=!0);let o=uB(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,r);return cB(o),o}i(pB,"useStore");var hA=i(t=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let e=typeof t=="function"?nA(t):t,r=i((o,n)=>pB(e,o,n),"useBoundStore");return Object.assign(r,e),r},"createImpl"),dB=i(t=>t?hA(t):hA,"create"),wA=i(t=>((import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`."),dB(t)),"react");u();l();var Yo;(function(t){t.Failed="Failed",t.Progress="Progress",t.Success="Success",t.Default="Default"})(Yo||(Yo={}));var mB=3e3,ut=wA(t=>({toast:void 0,toastId:void 0,visible:!1,currentTimer:null,hideToast(e){t(r=>e&&r.toastId!==e?r:(r.currentTimer&&clearTimeout(r.currentTimer),{visible:!1,currentTimer:null}))},removeToast(){t(e=>(e.currentTimer&&clearTimeout(e.currentTimer),{toast:void 0,toastId:void 0,visible:!1,currentTimer:null}))},success(e){t(r=>{r.currentTimer&&clearTimeout(r.currentTimer);let o=setTimeout(()=>{t({visible:!1,currentTimer:null})},mB);return{toast:{type:Yo.Success,...e},toastId:e.id??Oe(),visible:!0,currentTimer:o}})},failed(e){t(r=>(r.currentTimer&&clearTimeout(r.currentTimer),{toast:{type:Yo.Failed,...e},toastId:e.id??Oe(),visible:!0,currentTimer:null}))},progress(e){t(r=>(r.currentTimer&&clearTimeout(r.currentTimer),{toast:{type:Yo.Progress,...e},toastId:e.id??Oe(),visible:!0,currentTimer:null}))},message(e){t(r=>(r.currentTimer&&clearTimeout(r.currentTimer),{toast:{type:Yo.Default,...e},toastId:e.id??Oe(),visible:!0,currentTimer:null}))}}));u();l();var xn=i(t=>{let e=Zo(t);return Vr(e)},"getEstimatedTime");u();l();function SA(t,e,r,o){let n=De(t),s=n?t:e,c=n?e:t,p=n?r.sellAmount:r.buyAmount,d=xe(p,s.data.decimals),m=ac(d,!0),f=c.data.symbol,g="";return o?g=n?"swapTokenConfirmationBuyToast":"swapTokenConfirmationSellToast":g=n?"swapSwappingCashBuyToast":"swapSwappingCashSellToast",v.t(g,{amount:m,symbol:f})}i(SA,"cashSwapToastMessage");u();l();u();l();function bA({sell:t,buy:e,onBuyFungiblePress:r}){let o=`${v.t("swapTxConfirmationSwapFailed")} ${t.data.symbol} \u2192 ${e.data.symbol}`,n=I.getChainDefinition(t.data.chain.id).tokenSymbol,s=v.t("buyAssetInterpolated",{tokenSymbol:n});return{title:o,message:v.t("swapTabInsufficientFunds"),onPress:r,buttonText:s}}i(bA,"getInsufficientFundsToastProps");function TA(t,e,r,o,n,s){let{sell:c,buy:p}=e,d=fB(t,c,p,n,o,r,s);return d||{title:`${v.t("swapTxConfirmationSwapFailed")} ${c.data.symbol} \u2192 ${p.data.symbol}`,message:xf(t),onPress:i(()=>{ut.getState().hideToast(),o()},"onPress"),buttonText:v.t("commandRetry")}}i(TA,"createSimulationErrorToast");function fB(t,e,r,o,n,s,c){if(!(t.type&&!c.includes(t.type)))switch(t.type){case Ie.InsufficientFunds:return bA({sell:e,buy:r,onBuyFungiblePress:i(()=>{ut.getState().hideToast(),s()},"onBuyFungiblePress")});case Ie.SlippageExceeded:return o.selectedSetting.type===fe.Auto?void 0:{title:v.t("swapEnableAutoSlippageTitleToast",{sellSymbol:e.data.symbol,buySymbol:r.data.symbol}),buttonText:v.t("swapEnableAutoSlippageButtonToast"),message:"",onPress:i(()=>{o.setSlippageSetting({type:fe.Auto}),n(),ut.getState().hideToast()},"onPress")}}}i(fB,"createCustomSimulationErrorToast");u();l();u();l();var hB=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],gB="Ledger user rejected action",yB="Ledger Sign Error";function AA(t){return hB.some(r=>t.message.includes(r))?v.t("swapTxConfirmationSwapFailedLedgerConnectionError"):t.message.includes(gB)?v.t("swapTxConfirmationSwapFailedLedgerReject"):t.message.includes(yB)?v.t("swapTxConfirmationSwapFailedLedgerSignError"):t.message.toLowerCase().includes("ledger")?v.t("swapTxConfirmationSwapFailedLedgerError"):null}i(AA,"parseLedgerError");function xA({sellSymbol:t,buySymbol:e,error:r,onPress:o}){let n=v.t("unknownToken"),s=`${v.t("swapTxConfirmationSwapFailed")} ${t??n} \u2192 ${e??n}`,c=v.t("commandRetry"),p=v.t("swapTxConfirmationSwapFailedUnknownError"),d=AA(r);return d&&(p=d),{title:s,message:p,onPress:o,buttonText:c}}i(xA,"createSwapFailedToast");var Gs=class{static{i(this,"ToastExecuteSwapStateListener")}showFungibleDetails;showBuyFungibleScreen;slippageSettings;supportedCustomSimulationToastErrorTypes;retryAndNavigateToSwapper;toastMessageParser;constructor(e,r,o,n,s,c=SB){this.showFungibleDetails=e,this.showBuyFungibleScreen=r,this.slippageSettings=o,this.supportedCustomSimulationToastErrorTypes=n,this.retryAndNavigateToSwapper=s,this.toastMessageParser=c}onStateChange(e,r,o,n){let{sell:s,buy:c,quote:p}=o.executingQuote;switch(e.type){case Z.ExecuteSwapStarted:let d;if(le(p)){if(I.isBitcoinNetworkID(s.data.chain.id)){EA(v.t("swapBitcoinSellBridgeProgressToast",{estimatedTime:xn(p)}),()=>{this.showFungibleDetails(c)});return}I.isBitcoinNetworkID(c.data.chain.id)?d=v.t("swapBitcoinBuyingToast"):d=v.t("swapInitiatingBridgeToast",{sellSymbol:s.data.symbol,sellChain:s.data.chain.name,buySymbol:c.data.symbol,buyChain:c.data.chain.name})}else De(s)||De(c)?d=SA(s,c,p,!1):d=v.t("swapSwappingToast",{sellSymbol:s.data.symbol,buySymbol:c.data.symbol});wB(d);break;case Z.TransactionConfirmed:EA(this.toastMessageParser.parseTransactionConfirmed(s,c,p),()=>this.showFungibleDetails(c));break;case Z.SimulationFailed:CA(TA(e.error,o.executingQuote,this.showBuyFungibleScreen,()=>this.handleRetryPress(o.executingQuote),this.slippageSettings,this.supportedCustomSimulationToastErrorTypes));break;case Z.TransactionSubmissionFailed:case Z.TransactionConfirmationFailed:CA(xA({sellSymbol:s.data.symbol,buySymbol:c.data.symbol,error:e.error,onPress:i(()=>this.handleRetryPress(o.executingQuote),"onPress")}));break}}handleRetryPress(e){ut.getState().hideToast(),this.retryAndNavigateToSwapper(e)}};function wB(t){ut.getState().progress({message:t,onPress:i(()=>{ut.getState().hideToast()},"onPress")})}i(wB,"progress");function EA(t,e){ut.getState().success({id:"swap-success",message:t,onPress:i(()=>{ut.getState().hideToast(),e()},"onPress")})}i(EA,"success");function CA(t){ut.getState().failed(t)}i(CA,"failed");var SB={parseTransactionConfirmed(t,e,r){return le(r)?I.isBitcoinNetworkID(t.data.chain.id)?v.t("swapBitcoinSellBridgeProgressToast",{estimatedTime:xn(r)}):I.isBitcoinNetworkID(e.data.chain.id)?v.t("swapBitcoinBuyBridgeProgressToast",{estimatedTime:xn(r)}):v.t("swapBridgeInitiatedToast",{sellSymbol:t.data.symbol,sellChain:t.data.chain.name,buySymbol:e.data.symbol,buyChain:e.data.chain.name,estimatedTime:xn(r)}):v.t("swapSwappedToast",{sellSymbol:t.data.symbol,buySymbol:e.data.symbol})}};var bl=class{static{i(this,"ToastsSwapReviewInterceptor")}intercept(e){let{swapper:r,connection:o,storage:n,vaultProxy:s,locale:c,analytics:p,resetSwapper:d,queryClient:m,showFungibleDetails:f,showBuyFungibleScreen:g,swapAnalytics:y,gasEstimation:w,slippageSettings:S,supportedCustomSimulationToastErrorTypes:b,navigateToSwapper:T,storePairs:x,isMobile:C,enableExtSwapCommands:E,authRepository:P,isSimulationKilled:M}=e;if(r.getAccount()?.type===$g.Ledger||!C&&!E)return"continue";let R=r.getState();if(R.type!==$e.Quote)return"continue";let{quote:j,sell:Q,buy:F}=R;return this.isSupportedQuote(j)&&(async()=>{x(Q,F);let B=await p.getDeviceId(),W=new Gs(f,g,S,b,mt=>{T(mt)}),Y=new qs(m,n,P),ee=new Os(y,p),X=new zs(p),Ue=new Qs,Ae=new Us(Ko);try{r.subscribeExecution(Y),r.subscribeExecution(X),r.subscribeExecution(ee),r.subscribeExecution(W),r.subscribeExecution(Ue),r.subscribeExecution(Ae),await r.swap({signer:s,storage:n,locale:c,deviceId:B,connection:o,authRepository:P,isSimulationKilled:M,gasEstimation:w}),d()}catch{}finally{r.unsubscribeExecution(Y),r.unsubscribeExecution(X),r.unsubscribeExecution(ee),r.unsubscribeExecution(W),r.unsubscribeExecution(Ue),r.unsubscribeExecution(Ae)}})(),"continue"}isSupportedQuote(e){return Ht(e)||Cr(e)||io(e)||le(e)}};u();l();var Tl=class{static{i(this,"StreamGetSwapQuotesStrategy")}swapper;queryClient;constructor(e,r){this.swapper=e,this.queryClient=r}queryKey;quoteProcessorListener={onStateChange:i((e,r)=>{if(!this.queryKey){console.error("queryKey is not set");return}r.type==="quoteProcessed"&&this.queryClient.setQueryData(this.queryKey,r.response)},"onStateChange")};async fetch(e,r){return this.queryKey=r,this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener),new Promise((o,n)=>{let s=bB(e.amount,e.sell,e.buy),c={onStateChange:i((p,d)=>{switch(d.type){case"firstQuoteReceived":o(d.response),this.swapper.unsubscribeQuoteProcessor(c);break;case"error":n(d.error),this.swapper.unsubscribeQuoteProcessor(c),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener);break}},"onStateChange")};this.swapper.subscribeQuoteProcessor(this.quoteProcessorListener),this.swapper.subscribeQuoteProcessor(c),this.swapper.setPair(IA(e.buy),IA(e.sell),s),this.swapper.setAmount(s,{slippageTolerance:e.slippageTolerance,slippageType:e.enableAutoSlippage?fe.Auto:fe.Fixed,priorityFee:e.priorityFee,tipAmount:e.tipAmount,preferredProvider:e.preferredProvider})})}stopFetching(){this.swapper.getQuoteProcessorState().type!=="idle"&&(this.swapper.stopProcessingQuotes(),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener))}getFetchInterval(e){return!1}};function bB(t,e,r){let o=t.type==="sell"?e:r;return{amount:new A(t.value).shiftedBy(-o.data.decimals).toString(),perspective:t.type}}i(bB,"normalizeAmount");function IA(t){return{...t,data:{...t.data,walletAddress:""}}}i(IA,"removeWalletAddress");u();l();u();l();var Al;(function(t){t.AutoSlippageOptIn="autoSlippageOptIn"})(Al||(Al={}));var xl=class{static{i(this,"AutoSlippageOptInInterceptor")}intercept({hasViewedAutoSlippageOptIn:e,selectedSetting:r,setHasViewedAutoSlippageOptIn:o,showOverlay:n}){return!e&&r!==fe.Auto?(n(Al.AutoSlippageOptIn),o(!0),"interrupt"):"continue"}};u();l();var Nf=D(O());u();l();var FA=D(O());u();l();var TB=a.object({swapper:a.number(),review:a.number().nullish().default(null)}),El={swapper:ls.Short,review:null},kA=i(()=>{let t=qt.getMultivariateAssignment("swapper-poll-interval-json");if(!t)return El;try{let e=JSON.parse(t);return TB.parse(e)}catch{return El}},"getQuotePollIntervalConfig");var En=i(()=>{let t=Pa(n=>n.intervalMs),e=Pa(n=>n.state),r=Pa(n=>n.setState),o=(0,FA.useCallback)(n=>{r("resumed",n??PA())},[r]);return{state:e,pause:i(()=>r("paused"),"pause"),resume:o,intervalMs:t}},"useQuotePoller"),_a=i(t=>{Pa.getState().setState("resumed",t??PA())},"resumePoller"),Bf=i(()=>{Pa.getState().setState("paused")},"pausePoller"),PA=i(()=>kA().swapper,"getDefaultInterval"),Pa=ct(t=>({state:"resumed",intervalMs:El.swapper,setState(e,r){t(r?{state:e,intervalMs:r}:{state:e})}}));var _A=i(()=>{let t=(0,Nf.useCallback)(()=>{_a()},[]),e=(0,Nf.useCallback)(()=>{Bf()},[]);return{onSwapTabEnter:t,onSwapTabExit:e}},"useSwapTabSwitchActions");var RA=(0,bo.createContext)(void 0),AB=i(({children:t})=>{let e=[fe.Auto,fe.Fixed],r=[Ie.SlippageExceeded],o=(0,bo.useMemo)(()=>[new xl,new bl],[]),n=!0,s=nt(),c=qe(),p=(0,bo.useMemo)(()=>nn?new Tl(s,c):new ul,[s,c]),{onSwapTabEnter:d,onSwapTabExit:m}=_A(),f=Ja("trade-hub-variant"),g=rt("enable-replace-classic-ngs"),y=(0,bo.useMemo)(()=>{if(g||f==="remove-buy-sell")return"remove-buy-sell";if(f==="swapper-modal")return"swapper-modal";if(f==="trade-menu")return"trade-menu"},[f,g]),w=(0,bo.useMemo)(()=>Dr?kf("full"):kf("compactNoSymbol"),[]);return(0,vA.jsx)(RA.Provider,{value:{slippageSettingTypes:e,reviewInterceptors:o,showStickyCTAButton:n,getSwapQuotesStrategy:p,supportedCustomSimulationToastErrorTypes:r,onSwapTabEnter:d,onSwapTabExit:m,balanceDisplayStrategy:w,tradeHubVariant:y},children:t})},"SwapTabProvider"),Lf=i(()=>{let t=(0,bo.useContext)(RA);if(!t)throw new Error("useSwapTab must be used within a SwapTabProvider");return t},"useSwapTab");u();l();var Cn=D(O());u();l();u();l();var xB=a.enum(["pumpFun","moonshot"]),EB=a.object({type:xB,programId:a.string(),name:a.string(),iconUrl:a.string()}),CB=a.object({programs:a.array(EB)}),DA=i(t=>{try{return CB.parse(t)}catch{return}},"parseUgcPrograms");var IB={type:"pumpFun",programId:"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P",name:"Pump.fun",iconUrl:"https://dhc7eusqrdwa0.cloudfront.net/assets/pumpfun.svg"},Mf=[],To=i(()=>{try{let t=qt.getMultivariateAssignment("enabled-ugc-programs");if(!t)return qt.isFeatureEnabled("enabled-ugc-programs")?[IB]:Mf;let e=JSON.parse(t);return DA(e)?.programs??Mf}catch{return Mf}},"getSupportedUgcPrograms");var kB=a.object({programId:a.string(),complete:a.boolean(),progress:a.string()}),FB=a.object({bondingCurves:a.record(a.string(),kB)}),hr;(function(t){t.Loading="Loading",t.BondingCurve="BondingCurve",t.BondingCurveRefreshing="BondingCurveRefreshing",t.NoBondingCurve="NoBondingCurve",t.Graduated="Graduated",t.Error="Error"})(hr||(hr={}));function PB(t){let e=BA(t),o=qe().getQueryData(e.queryKey),{data:n,isFetching:s,isError:c}=oe({...e,initialData:o,staleTime:0}),p=(0,Cn.useMemo)(()=>To(),[]);return(0,Cn.useMemo)(()=>{let d=o===n;if(s&&!d)return{type:hr.Loading};if(c)return{type:hr.Error};let m=FB.safeParse(n);if(!m.success)return{type:hr.Error};let f=m.data.bondingCurves[t];if(!f)return{type:hr.NoBondingCurve};let g=p.find(w=>w.programId===f.programId);if(!g)return{type:hr.NoBondingCurve};let y=RB(f.progress);return y?f.complete?{type:hr.Graduated,ugcProgram:g}:{type:d&&s?hr.BondingCurveRefreshing:hr.BondingCurve,progressPercentage:y,ugcProgram:g}:{type:hr.Error}},[o,t,n,c,s,p])}i(PB,"useBondingCurveProgress");var _B=i(t=>{let e=qe(),r=BA(t);return(0,Cn.useCallback)(async()=>{await e.refetchQueries({queryKey:r.queryKey,type:"active"})},[e,r.queryKey])},"useUgcEnabledAwareBondingCurveRefetch"),BA=i(t=>{let e=(0,Cn.useMemo)(()=>To(),[]),r=(0,Cn.useMemo)(()=>e.map(n=>n.programId),[e]);return{queryKey:["bonding-curve",t,r],queryFn:i(()=>vB(t,r),"queryFn")}},"useQueryOptions"),vB=i(async(t,e)=>{let r=encodeURIComponent(t),o=encodeURIComponent(e.join(","));return(await z.api().get(`/ugc/v1/bonding-curve/${r}/${o}`)).data},"queryFn"),RB=i(t=>{let e=Number(t);if(!isNaN(e))return Math.round(e*100)},"parseProgressPercentage");u();l();var DB="https://help.phantom.com/hc/en-us/articles/33745013398675";u();l();u();l();var MA=D(O());u();l();var BB="swap",NB=i(t=>new Ay(t,BB),"createSwapAnalytics"),js=tc(ue,t=>NB(t));u();l();function $s(t,e,r){if(!r)return;if(e===fe.Fixed)return r.slippageTolerance;let o=r.quotes[t];if(o)return le(o)?r.slippageTolerance:qr(o)?o.slippageTolerance:r.slippageTolerance}i($s,"parseSlippage");u();l();var Cl=D(O());var LA=i(()=>{let{data:t,isFetching:e}=Rt({key:Pe.LastSubmittedPairs,queryKey:me.lastSubmittedPairs()}),r=(0,Cl.useMemo)(()=>t??null,[t]),{mutateAsync:o}=Dt({key:Pe.LastSubmittedPairs,queryKey:me.lastSubmittedPairs()}),n=(0,Cl.useCallback)(async(s,c)=>{await o({sellFungible:NA(s),buyFungible:NA(c)})},[o]);return{pairs:r,isLoading:e,storePairs:n}},"useLastSubmittedPairs");function NA(t){return{...t,data:{...t.data,walletAddress:""}}}i(NA,"removeWalletAddress");var LB=i(({goToConfirmation:t})=>{let e=$(b=>b.sellUsdValue),r=$(b=>b.buyUsdValue),{currentQuote:o,quoteResponse:n,selectedProviderIndex:s,selectedBaseProvider:c}=Ee(),p=$(b=>b.sellFungible),d=$(b=>b.buyFungible),m=$(b=>b.swapFilter),{selectedSetting:f}=jt(),{storePairs:g}=LA(),y=ue(),w=js(),{pause:S}=En();return(0,MA.useCallback)(()=>{if(!o||!p||!d)return;let b=$s(s,f.type,n);y.capture("swapperSwap");let T=pl({buyToken:d,sellToken:p,sellAssetUsdValue:e,buyAssetUsdValue:r,quote:o,slippageTolerance:b,slippageType:f.type,sellSwapFilter:m,baseProvider:c});T&&(k.addBreadcrumb(_.Swapper,"approved",L.Info,Kn(T.swap)),w.approved(T)),S(),t(),I.compareNetworkID(p.data.chain.id,d.data.chain.id)===0&&g(p,d)},[o,p,d,s,f.type,n,y,e,r,S,t,w,g,m,c])},"useOnSwap");u();l();var OA=D(O());u();l();var Uf=D(O());u();l();var MB=a.object({blocked:a.array(a.nativeEnum(ce))}),UA=i(()=>{let t=Ja("blocked-swapper-chains"),e=MB.safeParse(t);return e.success?e.data.blocked:[]},"useBlockedSwapperChains");u();l();function Xo(){return mr.supportedChains.filter(t=>{let e=mr.get(t);return e.requiredFeatureFlag?Qg(e.requiredFeatureFlag):!0})}i(Xo,"useSwapperChains");var In=i(()=>{let{data:t}=de(),e=Xo(),r=UA(),o=(0,Uf.useMemo)(()=>e.filter(n=>!r.includes(n)).map(n=>I.getMainnetNetworkID(n)),[e,r]);return(0,Uf.useMemo)(()=>UB(t,o),[t,o])},"useSupportedNetworkIDs"),UB=i((t,e)=>[...new Set((t?.addresses??[]).map(r=>r.networkID).filter(r=>e.includes(r)))],"getSupportedNetworkIDs");var Of=i(()=>{let t=In(),e=rt("enable-bitcoin-swap");return(0,OA.useCallback)(r=>!e&&r&&I.isBitcoinNetworkID(r)?!1:!!r&&t.includes(r),[t,e])},"useIsSupportedNetworkId");u();l();var Fl=D(O());u();l();u();l();var Il=class{static{i(this,"SwapperTransitionsStateListener")}onStateChange(e,r,o){wl(o,e)}};u();l();var kl=class{static{i(this,"SwapperStateMachine")}listeners;constructor(e){this.listeners=e}transition(e,r){try{let o=this.detectNextState(e,r);return this.listeners.forEach(n=>n.onStateChange(r,e,o)),o}catch{return e}}detectNextState(e,r){switch(r.type){case Xe.QuoteRequestStarted:return{type:he.FetchingQuote,buy:r.buy,sell:r.sell,amount:r.amount};case Xe.QuoteResponseReceived:switch(e.type){case he.FetchingQuote:case he.Quote:case he.Simulated:case he.SimulationRequestErrored:case he.TransactionSubmissionFailed:case he.TransactionNotConfirmed:let o=r.response.quotes[r.quoteIndex];if(!o)throw new Error("Quote index out of bounds");return{type:he.Quote,response:r.response,buy:e.buy,sell:e.sell,quote:o};default:throw new Error("Can't transition from this state")}case Xe.QuoteSelected:switch(e.type){case he.Quote:let o=e.response.quotes[r.quoteIndex];if(!o)throw new Error("Quote index out of bounds");return{type:he.Quote,quote:o,buy:e.buy,sell:e.sell,response:e.response};default:throw new Error("Can only transition to QuoteChanged from Quote")}case Xe.SimulationResponseReceived:switch(e.type){case he.Quote:return r.scannedTransactionResult.error?{type:he.SimulationFailed,quote:e.quote,buy:e.buy,sell:e.sell,response:e.response,scannedTransactionResult:r.scannedTransactionResult,simulationError:r.scannedTransactionResult.error}:{type:he.Simulated,quote:e.quote,buy:e.buy,sell:e.sell,response:e.response,scannedTransactionResult:r.scannedTransactionResult};default:throw new Error("Can only transition to Simulated from Simulating")}case Xe.SimulationRequestError:switch(e.type){case he.Quote:return{type:he.SimulationRequestErrored,buy:e.buy,sell:e.sell,quote:e.quote,response:e.response,error:r.error};default:throw new Error("Can only transition to SimulationRequestErrored from Simulating")}case Xe.TransactionSubmissionFailed:switch(e.type){case he.Simulated:case he.SimulationFailed:return{type:he.TransactionSubmissionFailed,quote:e.quote,buy:e.buy,sell:e.sell,response:e.response,scannedTransactionResult:e.scannedTransactionResult,error:r.error};default:throw new Error("Can only transition to SwapSubmitFailed from SubmittingSwap")}case Xe.TransactionConfirmationFailed:switch(e.type){case he.Simulated:return{type:he.TransactionNotConfirmed,quote:e.quote,buy:e.buy,sell:e.sell,txReceipt:r.txReceipt,response:e.response,scannedTransactionResult:e.scannedTransactionResult,error:r.error};default:throw new Error("Can only transition to TransactionNotConfirmed from ConfirmingTransaction")}}}};var OB=new kl(new Set([new Il])),qA=ct(t=>({state:{type:he.Idle},transition:i(e=>{t(r=>{let o=r.state;return{state:OB.transition(o,e)}})},"transition")}));var Ks=i(()=>{let t=qA(r=>r.state),e=qA(r=>r.transition);return{state:t,transition:e}},"useSwapperState");u();l();var qB=5*60,zA=i(t=>{if(le(t))return Be(ms(t));let{sources:e}=t;return Be(e)},"getProviderLabel"),QA=i(({quotes:t,buyTokenNetworkId:e,buyTokenDecimals:r,buyTokenSymbol:o})=>t.map(n=>{let{buyAmount:s}=n,c=xr.get(e).formDisplayPrecision;return{name:zA(n),amount:`${Er(xe(s,r),c)} ${o}`}}),"parseSwapProviders"),HA=i(({quotes:t,buyTokenNetworkId:e,buyTokenDecimals:r,buyTokenSymbol:o,networkIDForFees:n,networkFee:s,priceMap:c})=>t.filter(le).map(p=>{let{buyAmount:d,executionDuration:m,steps:f}=p,y=al(p).plus(s),w=f.find(b=>!!b.tool.logoURI),S=xr.get(e).formDisplayPrecision;return{name:zA(p),feeUsd:n&&c?Jt(n,y,c):null,amount:`${Er(xe(d,r),S)} ${o}`,time:{text:Vr(m),isFast:m<=qB},logoURI:w?.tool.logoURI??""}}),"parseBridgeProviders");u();l();var zB={aggregate(t){return t.reduce((e,r)=>({...e,gasLimit:e.gasLimit.plus(r.gasLimit)}),{networkID:I.ethereum.mainnetID,gasLimit:new q(0),maxFeePerGas:t[0].maxFeePerGas,maxPriorityFeePerGas:t[0].maxPriorityFeePerGas})}},QB={aggregate(t){return t.reduce((e,r)=>({...e,value:e.value+r.value}),{networkID:I.solana.mainnetID,value:0})}},HB={aggregate(t){return t.reduce((e,r)=>({...e,gasBudget:e.gasBudget.plus(r.gasBudget)}),{networkID:I.sui.mainnetID,gasBudget:new q(0)})}},va=i(t=>{if(!(!t||t.length===0)){if(lc(t[0]))return zB.aggregate(t);if(Py(t[0]))return QB.aggregate(t);if(_y(t[0]))return HB.aggregate(t)}},"aggregateGasEstimation");function GB({selectQuote:t}){let{quoteResponse:e,isFetchingQuote:r,quotes:o,selectedProviderIndex:n}=Ee(),s=$(E=>E.setSelectedProviderIndex),c=$(E=>E.gasEstimation.estimateWithBuffer),p=$(E=>E.sellFungible),d=$(E=>E.buyFungible),m=p?.data.chain.id,{data:f}=vi(m,va(c)),y=Xo().map(E=>Nr(E)),{data:w={}}=Lo({query:{data:y}}),S=e?.type==="xchain",b=(0,Fl.useMemo)(()=>d?S?HA({quotes:o,buyTokenNetworkId:d.data.chain.id,buyTokenDecimals:d.data.decimals,buyTokenSymbol:d.data.symbol,networkIDForFees:m,networkFee:f?.gasEstimationAmount??new q(0),priceMap:w}):QA({quotes:o,buyTokenNetworkId:d.data.chain.id,buyTokenDecimals:d.data.decimals,buyTokenSymbol:d.data.symbol}):[],[d,S,o,m,f?.gasEstimationAmount,w]),T=ue(),{transition:x}=Ks(),C=(0,Fl.useCallback)(E=>{let P=b[E];T.capture("swapperProviderSelected",{data:{provider:P.name}}),s(E),t(o,E),x({type:Xe.QuoteSelected,quoteIndex:E})},[s,b,T,x,o,t]);return{rows:b,selectedProviderIndex:n,isLoadingProviders:r,setSelectedProviderIndex:C}}i(GB,"useSwapProvidersProps");u();l();var vl=D(O());u();l();var jA=D(O());u();l();var GA=D(O());var Pl=i(()=>{let t=qe();return{cancelQuotes:(0,GA.useCallback)(async()=>{await t.cancelQueries({queryKey:me.quotesScope()}),await Jg(1)},[t])}},"useSwapCancelQuotes");u();l();function kn(t,e){return t.data.key===e.data.key}i(kn,"areFungiblesEqual");function qf(){let t=ue(),e=$(n=>n.setBuyFungible),r=$(n=>n.buyFungible),{cancelQuotes:o}=Pl();return(0,jA.useCallback)(async n=>{if(r&&kn(n,r))return;await o();let s=wo(n);t.capture("swapperUpdateToAsset",{data:s}),e(n)},[t,r,o,e])}i(qf,"useSwapSetBuyAsset");u();l();var jB=i((t,e)=>{_l.getState().setAsset(t,e)},"setUgcSelectedAsset"),_l=ct(t=>({asset:void 0,onConfirm:void 0,setAsset(e,r){t({asset:e,onConfirm:r})}}));var $B=i(({onClose:t})=>{let e=nt(),r=qf(),o=_l(p=>p.asset),n=_l(p=>p.onConfirm),s=(0,vl.useMemo)(()=>To().find(d=>d.programId===o?.data?.ugcTokenMeta?.programId),[o]),c=(0,vl.useCallback)(async()=>{o&&(e.changeToken(o,"buy"),await r(o),n?.(),t())},[r,e,o,n,t]);return{asset:o,program:s,handleConfirmPress:c}},"useUGCTradeWarningProps");u();l();u();l();var zf=i(()=>{let t=qe(),e=$();return{clearQuotes:i(async()=>{e.resetQuote(),await t.invalidateQueries({queryKey:me.quotesScope()})},"clearQuotes")}},"useSwapClearQuotes");u();l();var $A=i(({accountIdentifier:t,networkID:e})=>{let r=pt(),o=vo();return sn({mutationFn:i(async s=>{let{swapTransactions:c,type:p}=s;if(c.type==="evm"&&p===se.EVM){let{gasEstimation:d,pendingApprovalActivityRows:m,pendingSwapActivityRows:f}=s,{signature:g,error:y}=await k.startSpan("Process EVM Swap Txns",()=>au({transactions:c.transactions,transactionTypes:c.transactionTypes,networkID:e,gasEstimation:d,pendingSwapActivityRows:f,pendingApprovalActivityRows:m,accountIdentifier:t,accountSigner:o,storage:r}));return{networkID:e,chainType:p,id:g,error:y}}else if(c.type==="solana"&&p===se.Solana){let{callerAddress:d,connection:m,pendingSwapActivityRows:f}=s;if(!m)throw new Error("missing connection");let{signature:g,error:y}=await k.startSpan("Process Solana Swap Txns",()=>uu({callerAddress:d,connection:m,networkID:e,transactions:c.transactions,pendingSwapActivityRows:f,accountIdentifier:t,accountSigner:o,storage:r}));return{networkID:e,chainType:p,id:g,error:y}}else if(c.type==="sui"&&p===se.Sui){let{callerAddress:d,pendingSwapActivityRows:m}=s,{signature:f,error:g}=await k.startSpan("Process Sui Swap Txns",()=>mu({callerAddress:d,networkID:e,transactions:c.transactions,pendingSwapActivityRows:m,accountIdentifier:t,accountSigner:o,storage:r}));return{networkID:e,chainType:p,id:f,error:g}}throw new Error("unsupported")},"mutationFn")})},"useSwapFungibles");u();l();u();l();var KB=i(t=>{let e=pt(),r=ue(),{data:o,isPending:n}=oe({gcTime:0,queryKey:["originIsBlocklisted",t],queryFn:i(async()=>{let{result:s}=await Pd(e,r,t);return s},"queryFn")});return t===void 0?{isLoading:!1,originIsBlocklisted:!1}:{isLoading:n,originIsBlocklisted:o??!1}},"useOriginIsBlocklisted");u();l();var Qf=D(O());function VB(t,e){let{data:r}=de(),{params:o,networkID:n}=t,[s,c]=(0,Qf.useState)(null),p=["scan-message",{url:t.url,message:o.message}],d=r?.addresses.find(S=>S.networkID===n)?.address,m=Xt(v.language)??"en",f=ue(),g=new An(f),y=VA(),w=oe({queryKey:p,queryFn:i(async()=>{try{let S=await Rd(m,await f.getDeviceId(),{...t,userAccount:d});return c(null),g.onScannedMessageByUser({networkId:n,warnings:S.warnings.map(b=>b.severity),shouldBlock:!!S.block,errorCode:S.error??""}),S}catch(S){c(S),g.onFailedScannedMessageByUser({networkId:n,url:t.url}),k.addBreadcrumb("simulation",`networkID: ${n}, url: ${t.url}, type: message`,L.Info),k.captureError(w.error,_.Simulation)}},"queryFn"),enabled:!!d&&!!t.url&&!!o.message&&!e?.disabled,refetchInterval:e?.disableRefetch?!1:y,staleTime:1e3*10,...Ad()});return{isFetched:w.isFetched,isFetching:w.isFetching,data:w.data,isLoading:w.isPending&&!e?.disabled,isError:w.isError||!!s,error:w.error||s}}i(VB,"useScannedMessage");function Hf(t,e){let{params:r}=t,[o,n]=(0,Qf.useState)(null),s=ue(),c=["scan-transaction",t.networkID,t.url,r?r.transactions??r.transaction:""],p=VA(),d=!1;I.isEVMNetworkID(t.networkID)||I.isSolanaNetworkID(t.networkID)?d=!!r&&r.transactions.length>0&&!!t.userAccount:I.isBitcoinNetworkID(t.networkID)?d=!!r&&!!r.transaction&&!!r.userAddresses&&r.userAddresses.length>0:I.isSuiNetworkID(t.networkID)&&(d=!!r&&!!t.userAccount);let m=Xt(v.language)??"en",f=new An(s),g=d&&!e?.disabled,y=oe({queryKey:c,queryFn:i(async()=>{try{let w=await Bi(m,await s.getDeviceId(),t);return f.onScannedTransactionByUser({networkId:t.networkID,warnings:w.warnings.map(S=>S.severity),shouldBlock:!!w.block,errorCode:w.error??""}),n(null),e?.onSettled?.(w,void 0),w}catch(w){f.onFailedScannedTransactionByUser({networkId:t.networkID,url:t.url}),k.addBreadcrumb("simulation",`networkID: ${t.networkID}, url: ${t.url}, type: transaction`,L.Info),n(w),e?.onSettled?.(void 0,w),k.captureError(w,_.Simulation)}},"queryFn"),enabled:g,refetchInterval:e?.disableRefetch?!1:p,staleTime:1e3*10,...Ad()});return{isFetched:y.isFetched,isFetching:y.isFetching,data:y.data,isLoading:y.isPending&&g,isError:y.isError||!!o,error:y.error||o}}i(Hf,"useScannedTransaction");var KA=5e3;function VA(){let t=qt.getMultivariateAssignment("transactions-simulation-interval-ms");if(!t)return KA;let e=parseInt(t,10);return Number.isNaN(e)?KA:e}i(VA,"getSimulationRefetchInterval");u();l();u();l();u();l();u();l();var Ra;(function(t){t.Fungible="fungible"})(Ra||(Ra={}));var WB=a.object({type:a.literal(Ra.Fungible),data:Vy}),WA=a.object({results:a.array(a.any()).transform(t=>t.reduce((e,r)=>{let o=WB.safeParse(r);return o.success&&e.push(o.data),e},[])),prevCursor:a.string().nullish().default(null),nextCursor:a.string().nullish().default(null),hasMore:a.boolean()});async function ZA(t){let{query:e,networkIds:r,searchContext:o,supportedNetworkIds:n,pageSize:s=50,cursor:c}=t,p=await z.api().noBearer().headers({"Content-Type":"application/json"}).get("/search/v1",{params:{query:e.trim(),chainIds:r.join(","),platform:Yt,pageSize:s.toString(),searchTypes:Ra.Fungible,searchContext:o,...c&&{cursor:c},...n&&{supportedNetworkIds:n.join(",")}}});if(!te(p))throw new ot({key:"UnknownError"});let d=WA.safeParse(p.data);if(d.success)return d.data;throw new ot({key:"UnknownError"})}i(ZA,"getFungibleSearch");u();l();var YA=i(t=>{let e=t.data,r=md(e)??void 0;return{type:e.type,data:{...e.data,tokenAddress:md(e)??void 0,key:r}}},"searchResultToFungible");u();l();var ZB="search",XA={searchResults:i((t,e,r,o,n)=>[ZB,{query:t,networkIds:e,supportedNetworkIds:o,chainAddresses:r,cursor:n}],"searchResults")};u();l();var Rl;(function(t){t[t.Always=1/0]="Always",t[t.Short=K({minutes:5})]="Short",t[t.Medium=K({minutes:30})]="Medium",t[t.Long=K({hours:1})]="Long",t[t.Never=0]="Never"})(Rl||(Rl={}));var Dl;(function(t){t[t.Immediate=0]="Immediate",t[t.Short=K({minutes:5})]="Short",t[t.Medium=K({minutes:30})]="Medium",t[t.Long=K({hours:1})]="Long"})(Dl||(Dl={}));var YB=i(async t=>(await ZA(t)).results.map(r=>YA(r)),"queryFn"),Da=i(({query:t,networkIds:e,enableQuery:r=!0,keepPreviousData:o=!1,searchContext:n,supportedNetworkIds:s,chainAddresses:c,pageSize:p})=>{let d=XA.searchResults(t,e,c,s);return oe({queryKey:d,gcTime:Rl.Short,staleTime:Dl.Short,enabled:r,placeholderData:o?Mg:void 0,queryFn:i(()=>YB({query:t,networkIds:e,searchContext:n,supportedNetworkIds:s,pageSize:p}),"queryFn")})},"useFungibleSearch");u();l();var Gf=D(O());function XB({enablePrices:t,enableSorting:e}){let{fungibles:r,isLoadingTokens:o,tokensError:n,refetch:s}=os({enablePrices:t,enableSorting:e}),c=Of(),p=$(f=>f.sellFungible),d=r.filter(f=>c(f.data.chain.id)&&f.type!==ae.CompressedSPL),m=(0,Gf.useMemo)(()=>{if(p){let f=d.findIndex(y=>kn(y,p)),g=d[f];g&&g.data.amount!==p.data.amount&&(d[f]=p)}return d.filter(f=>f.data.amount!=="0")},[d,p]);return(0,Gf.useMemo)(()=>({assets:m,isLoading:o,error:n,refetchTokens:s}),[m,o,n,s])}i(XB,"useSwapSellAssetList");u();l();var rr=D(O());u();l();var JB=50,JA=i(({includeOwnedAssets:t,sellAsset:e,sellCaip19:r,ownedAssets:o,searchAssets:n})=>{if(!t||!e)return n;let s=i(y=>N(J(y)),"getEncodedCaip19"),c=s(e)??r,p=e.data.chain.id??(r&&Ve(r).chainId),d=o.filter(y=>s(y)!==c&&I.compareNetworkID(p,y.data.chain.id)===0&&y.type!==ae.CompressedSPL).slice(0,JB-1),m=d.map(y=>[s(y),y]),f=new Map(m),g=n.filter(y=>!f.has(s(y)));return[...d,...g]},"getDisplayedBuyAssets");function eN({enableQuery:t=!0,chainFilter:e,sellCaip19:r}={}){let o=(0,rr.useMemo)(()=>r?Ve(r):void 0,[r]),{sellFungible:n,searchQuery:s,setSearchQuery:c,setNumSearchResults:p}=$(),d=ec(s,150),{fungibles:m,isLoadingTokens:f,isRefetchingTokens:g,tokensError:y}=os(),w=In(),[S,b]=(0,rr.useState)(""),{data:T}=de(),x=(0,rr.useMemo)(()=>T?.addresses??[],[T]),{data:C,isSuccess:E,isFetching:P,error:M}=Da({query:d,networkIds:e?[e]:[o?.chainId??n?.data.chain.id??I.solana.mainnetID],enableQuery:t,keepPreviousData:!0,searchContext:"swapper",supportedNetworkIds:w,chainAddresses:x}),G=!E&&P,R=(0,rr.useMemo)(()=>m.filter(Y=>Y.type!==ae.CompressedSPL).map(Y=>[N(J(Y)),Y]),[m]),j=(0,rr.useMemo)(()=>{let Y=Pg(R.map(([X])=>X).join("~")),ee=zg(Y);return Fg(ee)},[R]),Q=(0,rr.useMemo)(()=>new Map(R),[j]),F=(0,rr.useMemo)(()=>{if(!C||C.length===0)return[];b(Oe());let Y=C.reduce((ee,X)=>{let Ue="";if(Lt(X.type)){if(n&&Lt(n.type)&&X.data.chain.id===n.data.chain.id||o&&o.chainId===X.data.chain.id&&o.resourceType===V.nativeToken)return ee;Ue=N(Nr(I.getChainID(X.data.chain.id)))}else{if(n&&X.data.tokenAddress===n.data.tokenAddress&&!e||o&&o.chainId===X.data.chain.id&&o.resourceType===V.address&&o.address===X.data.tokenAddress)return ee;Ue=N(J(X))}let Ae,mt=Q.get(Ue);return mt&&mt.data.balance?Ae=mt:Ae=X,Ae&&ee.push(Ae),ee},[]);return p(Y.length),Y},[Q,C,n,p,e,o]),B=ue();(0,rr.useEffect)(()=>{E&&F.length===0&&B.capture("swapperNullSearchResult",{data:{searchQuery:d}})},[E,F,d,B]);let W=(0,rr.useMemo)(()=>JA({includeOwnedAssets:!d,sellAsset:n,sellCaip19:r,ownedAssets:m,searchAssets:F}),[d,m,F,n,r]);return(0,rr.useMemo)(()=>({assets:W,initialFilterKey:e??n?.data.chain.id??o?.chainId,isLoading:f||G,isFetching:f||G||g,error:y??M,searchRef:S,setSearchQuery:c,searchQuery:s}),[W,f,G,g,y,M,n,S,c,o?.chainId,e,s])}i(eN,"useLiveSwapBuyAssetList");u();l();var Bl=D(O());u();l();var ex="https://help.phantom.com/hc/en-us/articles/27085326202515";var tN=[.3,.5,1],rN=tN.map(t=>`${t}%`),oN=[...rN,"custom"],nN=[.5,1,2],sN=nN.map(t=>`${t}%`),hge=[...sN,"custom"],gge=oN.length-1,yge=5,wge=2,tx=.1,rx=30,iN=2,Sge=i((t,e)=>{if(!t)return;let r=parseFloat(t);if(isNaN(r))return{message:e("swapSettingsCustomInvalidValue"),severity:"critical"};if(r>rx)return{message:e("swapSlippageSettingsCustomMaxError",{maxSlippage:rx}),severity:"critical"};if(r>iN)return{message:e("swapSlippageSettingsHighSlippageWarning"),severity:"warning"};if(r<tx)return{message:e("swapSlippageSettingsCustomMinError",{minSlippage:tx}),severity:"critical"}},"getCustomSlippageError");u();l();var Vs=D(O());var aN={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},Ige=i((t,e,r)=>{let o=parseFloat(t);if(isNaN(o))return{message:e("swapSettingsCustomInvalidValue"),severity:"critical"};if(o>r.max)return{message:e("swapPriorityFeeSettingsCustomMaxError",{maxPriorityFee:r.max}),severity:"critical"};if(o<r.min)return{message:e("swapPriorityFeeSettingsCustomMinError",{minPriorityFee:r.min}),severity:"critical"};if(o>r.high)return{message:e("swapPriorityFeeSettingsHighFeeWarning"),severity:"warning"};if(o<r.low)return{message:e("swapPriorityFeeSettingsLowFeeWarning"),severity:"warning"}},"validatePriorityFee"),kge=i(()=>{let[t,e]=(0,Vs.useState)(aN.bounds);return(0,Vs.useEffect)(()=>{i(async()=>{try{let o=await pc({accounts:[],transactionType:Yn.Swap});e({min:o.min,low:o.low,high:o.high,max:o.max})}catch(o){k.captureError(o instanceof Error?o:new Error("Unable to fetch priority fee bounds."),_.Swapper)}},"fetchBounds")()},[]),t},"usePriorityFeeBounds");u();l();var Ws=D(O());var cN={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},Bge=i((t,e,r)=>{let o=parseFloat(t);if(isNaN(o))return{message:e("swapSettingsCustomInvalidValue"),severity:"critical"};if(o>r.max)return{message:e("swapTipSettingsCustomMaxError",{maxTip:r.max}),severity:"critical"};if(o<r.min)return{message:e("swapTipSettingsCustomMinError",{minTip:r.min}),severity:"critical"};if(o>r.high)return{message:e("swapTipSettingsHighFeeWarning"),severity:"warning"};if(o<r.low)return{message:e("swapTipSettingsLowFeeWarning"),severity:"warning"}},"validateTip"),Nge=i(()=>{let[t,e]=(0,Ws.useState)(cN.bounds);return(0,Ws.useEffect)(()=>{i(async()=>{try{let o=await pc({accounts:[],transactionType:Yn.Swap});e({min:o.min,low:o.low,high:o.high,max:o.max})}catch(o){k.captureError(o instanceof Error?o:new Error("Unable to fetch tip bounds."),_.Swapper)}},"fetchBounds")()},[]),t},"useTipBounds");u();l();var uN=[dt.lastSubmittedPairs,dt.slippageTolerance],lN=i(t=>{let e=String(t.queryKey[1]);return uN.includes(e)},"swapperShouldDehydrateQueryPredicate");u();l();var nx=D(O());u();l();function ox(){return[new jf,new Kf,new $f]}i(ox,"getBuyAmountEditableRules");var jf=class{static{i(this,"SwapAssetEditableRule")}isEditable({sellAsset:e}){return!!e&&I.isSolanaNetworkID(e.data.chain.id)}},$f=class{static{i(this,"CryptoCurrencyDenominationEditableRule")}isEditable({currencyDenomination:e}){return e==="crypto"}},Kf=class{static{i(this,"BridgeSwapAssetEditableRule")}isEditable({sellAsset:e,buyAsset:r}){return!vt(e?.data.chain.id,r?.data.chain.id)}};var sx=i(({sellAsset:t,buyAsset:e,currencyDenomination:r})=>{let o=rt("enable-swapper-exact-out"),n=(0,nx.useMemo)(()=>ox(),[]);return!e||!o?!1:n.every(s=>s.isEditable({sellAsset:t,buyAsset:e,currencyDenomination:r}))},"useBuyAmountEditableRules");u();l();var Vf=class{static{i(this,"NoPriceCurrencyDenominationSwitchSupportRule")}isSupported(e,r,o,n,s){switch(e){case"sell":return!!(o&&s);case"buy":return!1}}},Wf=class{static{i(this,"BuyNotSupportedCurrencyDenominationSwitchSupportRule")}isSupported(e){return e!=="buy"}};function ix(){return[new Vf,new Wf]}i(ix,"getCurrencyDenominationSwitchSupportRules");u();l();var wx=D(O());u();l();var ax=D(O());var pN={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"},cx=i(()=>{let{currentQuote:t}=Ee(),{destinationNetworkFee:e,liquidityFee:r}=(0,ax.useMemo)(()=>{function o(s){return s?{amount:new A(s.amount??0),amountUsd:s.amountUSD?parseFloat(s.amountUSD):null,pct:parseFloat(s.percentage??"0")}:Wo}i(o,"bridgeFeeToFee");let n=new Map([]);return t&&le(t)&&(n=t.steps.flatMap(s=>s.includedFeeCosts).reduce((s,c)=>{if(!c)return s;let p=pN[c.name];return p&&s.set(p,c),s},n)),{destinationNetworkFee:o(n.get("destinationNetwork")),liquidityFee:o(n.get("liquidityProvider"))}},[t]);return{destinationNetworkFee:e,liquidityFee:r}},"useBridgeFees");u();l();var ux=D(O());var dN={calculate({currentQuote:t,gasEstimationPriceData:e}){return{amount:(t&&e?.gasEstimationAmount)??new A(0),amountUsd:(t&&e?.gasEstimationPriceUSDNumber)??null,pct:0}}},mN={calculate({currentQuote:t,gasEstimationPriceData:e,priceMap:r,networkID:o}){let n=(t?.fees??[]).find(p=>p.type==="tips"||p.type==="network"&&p.name!=="Token account deposits"),s=(t&&e?.gasEstimationAmount)??new A(0),c=(t&&e?.gasEstimationPriceUSDNumber)??null;if(n&&n.amount&&(s=s.plus(new A(n.amount)),c)){let p=Jt(o,new A(n.amount),r);p&&(c+=p)}return{amount:s,amountUsd:c,pct:0}}},fN={calculate({currentQuote:t,gasEstimationPriceData:e,maxGasEstimationPriceData:r}){return{amount:(t&&e?.gasEstimationAmount)??new A(0),amountUsd:(t&&e?.gasEstimationPriceUSDNumber)??null,maxAmount:(t&&r?.gasEstimationAmount)??new A(0),maxAmountUsd:(t&&r?.gasEstimationPriceUSDNumber)??null,pct:0}}},lx=i(({priceMap:t})=>{let{currentQuote:e}=Ee(),r=$(m=>m.sellFungible),o=$(m=>m.gasEstimation),n=r?.data.chain.id??re.Solana.Mainnet,{data:s,isLoading:c}=vi(n,va(o.estimate)),{data:p}=vi(n,va(o.estimateWithBuffer));return{networkFee:(0,ux.useMemo)(()=>I.isEVMNetworkID(n)?fN.calculate({currentQuote:e,gasEstimationPriceData:s,maxGasEstimationPriceData:p}):I.isSolanaNetworkID(n)?mN.calculate({currentQuote:e,gasEstimationPriceData:s,networkID:n,priceMap:t}):dN.calculate({currentQuote:e,gasEstimationPriceData:s}),[e,s,p,n,t]),isFetchingGasEstimationPrice:c}},"useNetworkFee");u();l();var px=D(O());var hN={calculate(){return Wo}},gN={calculate({currentQuote:t,networkID:e,priceMap:r}){let o=al(t);return{amount:o,amountUsd:Jt(e,o,r),pct:0}}},dx=i(({priceMap:t})=>{let{currentQuote:e}=Ee(),o=$(s=>s.sellFungible)?.data.chain.id??re.Solana.Mainnet;return{nonIncludedFees:(0,px.useMemo)(()=>e&&le(e)?gN.calculate({currentQuote:e,networkID:o,priceMap:t}):hN.calculate(),[o,e,t])}},"useNonIncludedFees");u();l();var mx=D(O());var yN={calculate({currentQuote:t,networkID:e,priceMap:r}){let o=(t?.fees??[]).find(n=>n.name==="Token account deposits");return{amount:new A(o?.amount??0),amountUsd:o?.amount?Jt(e,new A(o.amount),r):null,pct:o?.percentage??0}}},wN={calculate(){return Wo}},fx=i(({priceMap:t})=>{let{currentQuote:e}=Ee(),o=$(s=>s.sellFungible)?.data.chain.id??re.Solana.Mainnet;return{tokenAccountFee:(0,mx.useMemo)(()=>qr(e)?yN.calculate({currentQuote:e,networkID:o,priceMap:t}):wN.calculate(),[e,o,t])}},"useTokenAccountFee");u();l();var hx=D(O());var gx={calculate:i(({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:o,priceMap:n})=>{let s=t.amount.plus(e.amount).plus(r.amount);return{amount:s,amountUsd:Jt(o,s,n),pct:0}},"calculate")},SN={calculate:i(({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:o,priceMap:n})=>{let s=gx.calculate({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:o,priceMap:n}),c=t.amount.plus(e.maxAmount??0).plus(r.amount);return{...s,maxAmount:c,maxAmountUsd:Jt(o,c,n)}},"calculate")},yx=i(({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,priceMap:o})=>{let s=$(p=>p.sellFungible)?.data.chain.id??re.Solana.Mainnet;return{totalFees:(0,hx.useMemo)(()=>I.isEVMNetworkID(s)?SN.calculate({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:s,priceMap:o}):gx.calculate({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:s,priceMap:o}),[e,s,r,o,t])}},"useTotalFees");var Zf=i(()=>{let t=$(y=>y.gasEstimation.isFetching),e=Xo(),{data:r={}}=Lo({query:{data:e.map(y=>Nr(y))}}),{networkFee:o,isFetchingGasEstimationPrice:n}=lx({priceMap:r}),s=t||n,{phantomFee:c}=J0(),{tokenAccountFee:p}=fx({priceMap:r}),{nonIncludedFees:d}=dx({priceMap:r}),{totalFees:m}=yx({tokenAccountFee:p,networkFee:o,nonIncludedFees:d,priceMap:r}),{destinationNetworkFee:f,liquidityFee:g}=cx();return(0,wx.useMemo)(()=>({phantomFee:c,networkFee:o,tokenAccountFee:p,totalFees:m,nonIncludedFees:d,destinationNetworkFee:f,liquidityFee:g,isFetchingFees:s}),[c,o,p,m,d,f,g,s])},"useFees");u();l();var Sx=D(O());var Fn=i(()=>{let{resume:t}=En(),e=$(r=>r.resetSwapper);return(0,Sx.useCallback)(()=>{t(),e()},[e,t])},"useResetSwapper");u();l();var bx=D(O());function bN(){let t=ue(),e=$(g=>g.buyFungible),r=$(g=>g.sellFungible),o=$(g=>g.setBuyFungible),n=$(g=>g.setSellFungible),s=$(g=>g.setSellAmount),c=$(g=>g.setUiSellAmountCryptoInput),p=$(g=>g.resetQuote),d=$(g=>g.setSwapFilter),m=r?.data.amount,{cancelQuotes:f}=Pl();return(0,bx.useCallback)(async g=>{if(r&&kn(g,r)){g&&g.data.amount!==m&&(n(g),d(void 0));return}await f();let y=wo(g);t.capture("swapperUpdateFromAsset",{data:y}),n(g),d(void 0),e&&r&&kn(g,e)&&o(r),g&&r?.data.chain.id!==g.data.chain.id&&(p(),o(void 0),s(""),c(""))},[t,e,f,m,p,r,o,s,n,d,c])}i(bN,"useSwapSetSellAsset");u();l();var Pn=D(O());u();l();var Ao;(function(t){t.Collapsible="collapsible",t.Static="static"})(Ao||(Ao={}));u();l();var Ax=D(Ke()),Zs=D(O());u();l();u();l();var Nl=class{static{i(this,"UgcAwareAssetsSectionAdapter")}sections(e){let r=To().map(s=>s.programId),o=e.reduce((s,c)=>{if(hc({minimum:pe.Verified,spamStatus:c.data.spamStatus}))return s.verified.push(c),s;if(c.type!==ae.SPL||!c.data.ugcTokenMeta||c.data.ugcTokenMeta.status===Ky.Graduated||!r.includes(c.data.ugcTokenMeta.programId))return s.unverified.push(c),s;let p=c.data.ugcTokenMeta.programId,d=s[p]??[];return d.push(c),s[p]=d,s},{verified:[],unverified:[]}),n=To().map(s=>{let c=o[s.programId]??[];return{id:s.programId,header:{title:v.t("swapSectionTitleTokens",{section:s.name}),iconUrl:s.iconUrl},data:c,behavior:Ao.Collapsible}});return[{id:"verified",data:o.verified,behavior:Ao.Static},{id:"unverified",header:{title:v.t("swapUnverifiedTokens")},data:o.unverified,behavior:Ao.Collapsible},...n]}};function Tx(){return new Nl}i(Tx,"getBuyAssetsSectionAdapter");var xx=(0,Zs.createContext)(void 0),TN=i(({children:t})=>{let e=(0,Zs.useMemo)(()=>Tx(),[]);return(0,Ax.jsx)(xx.Provider,{value:{buyAssetSectionAdapter:e},children:t})},"SwapAssetSelectProvider"),Yf=i(()=>{let t=(0,Zs.useContext)(xx);if(!t)throw new Error("useSwapAssetSelect must be used within a SwapAssetSelectProvider");return t},"useSwapAssetSelect");var Ex=3;function Xf(t){return{id:t.id,data:t.data,...t.header?{header:t.header}:{}}}i(Xf,"convertToBaseSection");var AN=i(t=>{let[e,r]=(0,Pn.useState)({}),o=(0,Pn.useCallback)((c,p)=>r(d=>({...d,[c]:p})),[]),{buyAssetSectionAdapter:n}=Yf(),s=(0,Pn.useMemo)(()=>n.sections(t),[n,t]);return(0,Pn.useMemo)(()=>s.map(c=>{switch(c.behavior){case Ao.Static:return Xf(c);case Ao.Collapsible:{if(c.data.length<=Ex)return Xf(c);let p=e[c.id],d=p?c.data:c.data.slice(0,Ex),m=i(()=>o(c.id,!p),"onClick"),f=Xf(c);return{...f,header:{...f.header,title:f.header?.title||"",button:{label:p?v.t("commandShowLess"):v.t("commandShowMore"),onClick:m}},data:d}}}}),[s,e,o])},"useSwapAssetCollapsibleSections");u();l();var Ll=i(({networkID:t,txReceipt:e,preferredExplorers:r})=>{let o=e?.id??"";if(!o)return;let n=r?.explorers[t];return Sy({networkID:t,endpoint:"transaction",explorerType:n,param:o})},"getExploreUrl");u();l();u();l();var xo=D(O());u();l();function Cx(t,e){if(e){let r=xN(t),o=CN(t,e),n=IN(t,e);return{notEnoughSol:e.message===H.NotEnoughSol,txErrorTitle:r,txErrorMessage:o,txErrorHelpButtonLink:n}}return{notEnoughSol:!1,txErrorTitle:"",txErrorMessage:"",txErrorHelpButtonLink:""}}i(Cx,"getSwapErrorDetails");var xN=i(t=>t?v.t("swapTxBridgeFailed"):v.t("swapTxConfirmationSwapFailed"),"getErrorTitle"),EN=i(t=>{switch(t.message){case H.LedgerConnectionError:return v.t("swapTxConfirmationSwapFailedLedgerConnectionError");case H.LedgerRejectAction:return v.t("swapTxConfirmationSwapFailedLedgerReject");case H.LedgerUnknownSignError:return v.t("swapTxConfirmationSwapFailedLedgerSignError");case H.LedgerUnknownError:return v.t("swapTxConfirmationSwapFailedLedgerError");default:return null}},"getLedgerErrorMessage"),CN=i((t,e)=>{let r=EN(e);if(r!==null)return r;if(t)switch(e.message){case H.SlippageExceeded:return v.t("swapTxConfirmationSwapFailedSlippageLimit");default:return v.t("swapTxBridgeFailedDescription")}else switch(e.message){case H.InsufficientFunds:return v.t("swapTxConfirmationSwapFailedInsufficientBalance");case H.SlippageExceeded:return v.t("swapTxConfirmationSwapFailedSlippageLimit");case H.EmptyRoute:return v.t("swapTxConfirmationSwapFailedEmptyRoute");case H.AccountFrozen:return v.t("swapTxConfirmationSwapFailedAcountFrozen");case H.SimulationTimeout:return v.t("swapTxConfirmationSwapFailedSimulationTimeout");case H.InsufficientGas:return v.t("swapTxConfirmationSwapFailedInsufficientGas");case H.NotValidScanResultsError:return v.t("swapTxConfirmationSwapFailedUnknownError");case H.StaleQuote:return v.t("swapTxConfirmationSwapFailedStaleQuote");case H.SimulationUnknownError:return v.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return v.t("swapTxConfirmationSwapFailedTryAgain")}},"getErrorMessage"),IN=i((t,e)=>t?el:e.message===H.AccountFrozen?g0:el,"getHelpButtonLink");u();l();var Ix=i(({sellAmount:t,sellFungible:e,buyAmount:r,buyFungible:o,txStatus:n,txReceipt:s,swapTransactions:c,isReadyToExecute:p,uiEstimatedTime:d,isBridge:m,isLedger:f,notEnoughSol:g,txError:y,txErrorTitle:w,txErrorMessage:S,explorerUrl:b,txErrorHelpButtonLink:T,addressType:x})=>{let C=xe(t,e?.data.decimals??0).toNumber(),E=xe(r,o?.data.decimals??0).toNumber(),P=n==="success",M=n==="error",G=!!s,R=c?.transactions.length||0;return{sellAsset:{amount:C,symbol:e?.data.symbol??"",networkID:e?.data.chain.id??re.Solana.Mainnet},buyAsset:{amount:E,symbol:o?.data.symbol??"",networkID:o?.data.chain.id??re.Solana.Mainnet},estimatedTime:d,isBridge:m,isSuccess:P,isFailure:M,isLedger:f,isClosable:G,notEnoughSol:g,txError:y,txErrorTitle:w,txErrorMessage:y?.detailMessage?`${S}

${y?.detailMessage}`:S,txLink:b??"",txErrorHelpButtonLink:T,numberOfTransactions:R,isReadyToExecute:p,addressType:x}},"mapToSwapConfirmationViewState");var Jf=i(({sellFungible:t,txReceipt:e,swapTransactions:r,isBridge:o,txError:n,txStatus:s,isReadyToExecute:c,isLedger:p})=>{let d=t?.data.chain.id??re.Solana.Mainnet,{notEnoughSol:m,txErrorTitle:f,txErrorMessage:g,txErrorHelpButtonLink:y}=(0,xo.useMemo)(()=>Cx(o,n),[o,n]),w=(0,xo.useMemo)(()=>I.getAddressType(d),[d]),{currentQuote:S}=Ee(),[b]=(0,xo.useState)(S),{buyAmount:T,sellAmount:x}=b??{buyAmount:"0",sellAmount:"0"},C=$(R=>R.buyFungible),{data:E}=Ty(),P=(0,xo.useMemo)(()=>Ll({txReceipt:e,networkID:d,preferredExplorers:E}),[e,d,E]),M=(0,xo.useMemo)(()=>xn(b),[b]);return(0,xo.useCallback)(()=>Ix({sellFungible:t,txReceipt:e,addressType:w,swapTransactions:r,isBridge:o,txError:n,sellAmount:x,buyAmount:T,buyFungible:C,txStatus:s,isReadyToExecute:c,uiEstimatedTime:M,isLedger:p,notEnoughSol:m,txErrorTitle:f,txErrorMessage:g,explorerUrl:P,txErrorHelpButtonLink:y}),[t,e,w,r,o,n,x,T,C,s,c,M,p,m,f,g,P,y])()},"useSwapConfirmationViewState");u();l();var or=D(O());u();l();var Ys=D(O());var _n=i(()=>{let t=ue(),e=js(),{currentQuote:r,quoteResponse:o,selectedProviderIndex:n,selectedBaseProvider:s}=Ee(),{analyticsContext:c}=r??{analyticsContext:void 0},p=$(R=>R.buyFungible),d=$(R=>R.sellFungible),m=$(R=>R.buyUsdValue),f=$(R=>R.sellUsdValue),g=$(R=>R.swapFilter),{selectedSetting:y}=jt(),w=$.getState().amountType,S=d?.data.chain.id??re.Solana.Mainnet,b=Zf(),{transition:T}=Ks(),x=(0,Ys.useCallback)(R=>{let j=$s(n,y.type,o);return dl({buyToken:p,sellToken:d,buyAmount:r?.buyAmount.toString()??"",sellAmount:r?.sellAmount.toString()??"",phantomFeeUiAmount:b.phantomFee.amountUsd?.toString()??"",priceImpact:fl(r),provider:Be(Le(r)),baseProvider:s,buyAssetUsdValue:m,sellAssetUsdValue:f,slippageTolerance:j,transactionId:R??"",slippageType:y.type,sellSwapFilter:g,analyticsContext:c})},[p,d,r,b.phantomFee.amountUsd,m,f,o,n,y.type,g,c,s]),C=(0,Ys.useCallback)(R=>{ml({txReceipt:R,networkID:S,amountType:w,swapAnalytics:e,walletAddress:d?.data.walletAddress})},[S,w,e,d?.data.walletAddress]),E=(0,Ys.useCallback)((R,j)=>{T({type:Xe.TransactionSubmissionFailed,error:R}),R.message!==H.NotValidScanResultsError&&R.message!==H.SlippageExceeded&&k.captureError(R,_.Swapper);let Q=x(j);t.capture("swapperSwapFailure",{data:{...Q.data,error:R.message}})},[t,x,T]),P=i(()=>{t.capture("swapperSwapFailureNoSignature")},"logSwapFailureNoSignature"),M=(0,Ys.useCallback)(R=>{let j=x(R.id);t.capture("swapperSwapSuccess",j);let Q=Bo(R.networkID);k.addBreadcrumb(_.Swapper,"transactionStatus",L.Info,{...Q,txReceipt:R.id}),(Q.chainType===se.EVM||Q.chainType===se.Solana||Q.chainType===se.Sui)&&e.transactionStatus(R.id,{...Q,status:{type:"confirmed"}})},[t,x,e]),G=(0,Ys.useCallback)((R,j)=>{let Q=R?.networkID?Bo(R.networkID):null;(Q?.chainType===se.EVM||Q?.chainType===se.Solana||Q?.chainType===se.Sui)&&R?.id&&(k.addBreadcrumb(_.Swapper,"transactionStatus",L.Error,{...Q,txReceipt:R.id}),e.transactionStatus(R.id,{...Q,status:{type:"error"}}),T({type:Xe.TransactionConfirmationFailed,error:j,txReceipt:R}))},[e,T]);return{logTransactionSubmitted:C,logTransactionSubmissionError:E,logSwapFailureNoSignature:P,logTransactionConfirmed:M,logTransactionConfirmationFailed:G}},"useSwapConfirmationAnalytics");u();l();var _x=D(O());u();l();var kx=i(()=>{let{selectedSetting:t}=jt(),{selectedProviderIndex:e,quoteResponse:r}=Ee(),o=$s(e,t.type,r),{data:n}=cl();return{slippageSetting:t,slippageTolerance:o??n??void 0}},"useAutoSlippageAwareSlippageTolerance");u();l();u();l();var Ml=D(O());u();l();var eh="swap-validation",Fx=i(({scanResult:t,scanResultError:e,quote:r,sellToken:o,buyToken:n})=>{if(e)return"valid";if(!r||!o||!n)return k.addBreadcrumb(eh,`Missing necessary args: ${JSON.stringify({quote:!!r,scanResult:!!t,sellToken:o,buyToken:n})}`,L.Info),new ve(H.MissingArgument);if(t?.error===Or.SIMULATION_FAILED)return"valid";if(t?.error){if(k.addBreadcrumb(eh,`Simulation error: ${JSON.stringify({error:t.error})}`,L.Info),t.error===Or.SLIPPAGE_EXCEEDED)return new ve(H.SlippageExceeded);if(t.error===Or.INSUFFICIENT_FUNDS)return new ve(H.InsufficientFunds);if(t.error===Or.INSUFFICIENT_GAS)return new ve(H.InsufficientGas);if(t.error===Or.ACCOUNT_FROZEN)return new ve(H.AccountFrozen);if(t.error===Or.SIMULATION_TIMEOUT)return new ve(H.SimulationTimeout);if(t.error===Or.STALE_QUOTE)return new ve(H.StaleQuote);if(t.error===Or.UNKNOWN_ERROR){let s=kN(t);return new ve(H.SimulationUnknownError,s)}return new ve(H.NotValidScanResultsError)}return t?"valid":(k.addBreadcrumb(eh,`Missing necessary args: ${JSON.stringify({quote:!!r,scanResult:!1,sellToken:o,buyToken:n})}`,L.Info),new ve(H.MissingArgument))},"validateScanResult");function kN(t){return t.simulationError?t.simulationError.humanReadableError:t.warnings[0]?.message}i(kN,"parseScanErrorDetail");var Px=i(({swapTransactions:t})=>{let e=$(b=>b.sellFungible),r=$(b=>b.buyFungible),o=e?.data.chain.id??re.Solana.Mainnet,{selectedSetting:n}=jt(),{currentQuote:s,quoteResponse:c}=Ee(),p=Be(Le(s)),d=vt(e?.data.chain.id,r?.data.chain.id),m=c?.buyToken?N(c?.buyToken):void 0,f=c?.sellToken?N(c?.sellToken):void 0,g={type:"transaction",userAccount:e?.data.walletAddress??"",params:void 0,url:"https://phantom.com",networkID:o,context:d?"bridge":"swap",provider:p,slippageType:n.type,metadata:{swapper:{quoteOutputAmount:s?.buyAmount,quoteOutputToken:m,quoteInputAmount:s?.sellAmount,quoteInputToken:f}}};t?.type==="evm"&&I.isEVMNetworkID(o)&&(g.params={transactions:t.transactions}),t?.type==="solana"&&I.isSolanaNetworkID(o)&&(g.params={transactions:t.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}});let{transition:y}=Ks(),w=(0,Ml.useCallback)((b,T)=>{T&&y({type:Xe.SimulationRequestError,error:T}),b&&y({type:Xe.SimulationResponseReceived,scannedTransactionResult:b})},[y]),S=Hf(g,{disableRefetch:!0,onSettled:w,disabled:t?.type==="sui"});return(0,Ml.useMemo)(()=>{if(S.isLoading)return{isLoading:!0,state:"loading"};if(t?.type==="sui")return{isLoading:!1,state:"valid"};let b=Fx({scanResult:S.data,scanResultError:S.isError,quote:s,sellToken:c?.sellToken,buyToken:c?.buyToken,simulationTolerance:c?.simulationTolerance});return{isLoading:S.isLoading,state:b}},[S,s,c,t?.type])},"useSwapScanTransaction");function vx({isBridge:t,addressType:e,isSwapSimulationDisabled:r,onTransactionReceiptReceived:o,onTransactionSubmissionError:n,resetToInitialState:s,sender:c}){let{logTransactionSubmitted:p,logSwapFailureNoSignature:d}=_n(),{connection:m}=Mo(),{data:f}=de(),{currentQuote:g,quoteResponse:y}=Ee(),{slippageTolerance:w}=kx(),S=$(F=>F.gasEstimation.estimateWithBuffer),b=$(F=>F.sellFungible),T=b?.data.chain.id??re.Solana.Mainnet,{data:x,isSuccess:C}=ds({callerAddress:c,quote:g,sellFungible:b}),E=Px({swapTransactions:x}),{pendingActivityRows:P}=lb({sender:c}),{mutateAsync:M}=$A({accountIdentifier:f?.identifier??"",networkID:T}),[G,R]=(0,_x.useState)(!1),j=i(async()=>(R(!0),ZT({isBridge:t,addressType:e,isSwapSimulationDisabled:r,sender:c,currentQuote:g,quoteResponse:y,gasEstimation:S,swapTransactions:x,scanResults:E,pendingActivityRows:P,connection:m,slippageTolerance:w,logSwapFailureNoSignature:d,logTransactionSubmitted:p,swapFungibles:M,onTransactionSubmissionError:n,onTransactionReceiptReceived:o,resetToInitialState:s})),"executeSwapAndTrack");return{isReadyToExecute:G||(!E.isLoading||r)&&C,executeSwap:j}}i(vx,"useExecuteSwap");u();l();var Ul=D(O());var Rx=i(({goToSwapTab:t,goToActivityTab:e})=>{let{resume:r}=En(),{clearQuotes:o}=zf(),n=Fn(),s=(0,Ul.useCallback)(()=>{r(),o(),t()},[t,r,o]),c=(0,Ul.useCallback)(()=>{r()},[r]),p=(0,Ul.useCallback)(()=>{n(),e()},[e,n]);return{onClose:s,onRetry:c,onSwapSuccess:p}},"useSwapConfirmationActions");u();l();function Dx(){let{data:[t]}=Ot(["kill-swapper-simulation"]);return t}i(Dx,"useSwapSimulationInterceptor");u();l();var Xs=D(O());var Bx=i(({onTransactionConfirmationSuccess:t,onTransactionConfirmationError:e,txReceipt:r})=>{let o=qe(),{data:n}=de(),s=(0,Xs.useMemo)(()=>n?.addresses??[],[n]),c=lw(s),p=Fn(),{logTransactionConfirmed:d,logTransactionConfirmationFailed:m,logTransactionSubmissionError:f}=_n(),g=$(E=>E.sellFungible),{currentQuote:y}=Ee(),{sellAmount:w}=y??{sellAmount:"0"},S=aw({wallets:s,encodedCaip19:g?N(J(g)):""}),b=(0,Xs.useCallback)(async E=>{if(d(E),p(),g){let P=new q(g.data.amount),M=new q(w),G=P.minus(M).toString();hl(o,{id:gl(g),amount:G})}c(),S()},[d,p,w,g,c,S,o]),{isSuccess:T,isError:x,error:C}=ow(b,r);(0,Xs.useEffect)(()=>{if(T)t();else if(x){let E=Vo(C);e(E),m(r,E),f(E,r?.id)}},[T,x,C,r,m,t,e,f])},"useSwapTransactionConfirmation");function Nx({isLedger:t,goToSwapTab:e,goToActivityTab:r}){let{currentQuote:o}=Ee(),n=$(Ae=>Ae.buyFungible),s=$(Ae=>Ae.sellFungible),c=Fn(),p=Dx(),{logTransactionSubmissionError:d}=_n(),[m]=(0,or.useState)(vt(s?.data.chain.id,n?.data.chain.id)),f=s?.data.chain.id??re.Solana.Mainnet,{data:g}=de(),y=(0,or.useMemo)(()=>g?.addresses??[],[g]),w=(0,or.useMemo)(()=>y.find(Ae=>Ae.networkID===s?.data.chain.id)?.address??"",[y,s]),S=(0,or.useMemo)(()=>I.getAddressType(f),[f]),{data:b}=ds({callerAddress:w,quote:o,sellFungible:s}),[T,x]=(0,or.useState)(),[C,E]=(0,or.useState)("loading"),[P,M]=(0,or.useState)(),G=i(()=>{E("loading"),M(void 0),x(void 0)},"resetToInitialState"),R=i(Ae=>{x(Ae)},"onTransactionReceiptReceived"),j=(0,or.useCallback)((Ae,mt)=>{E("error"),M(Ae),d(Ae,mt)},[d]),Q=(0,or.useCallback)(()=>{E("success")},[]),F=(0,or.useCallback)(Ae=>{E("error"),M(Vo(Ae))},[]);Bx({onTransactionConfirmationSuccess:Q,onTransactionConfirmationError:F,txReceipt:C==="error"?void 0:T});let{executeSwap:B,isReadyToExecute:W}=vx({isBridge:m,addressType:S,isSwapSimulationDisabled:p,onTransactionSubmissionError:j,onTransactionReceiptReceived:R,resetToInitialState:G,sender:w}),{onClose:Y,onRetry:ee,onSwapSuccess:X}=Rx({goToSwapTab:e,goToActivityTab:r});return{...Jf({sellFungible:s,txReceipt:T,swapTransactions:b,isBridge:m,txStatus:C,isReadyToExecute:W,isLedger:t,txError:P}),executeSwap:B,resetSwapper:c,onClose:Y,onRetry:ee,onSwapSuccess:X}}i(Nx,"useSwapConfirmationProps");u();l();u();l();var Lx=D(O());var FN=i(()=>{let t=nt();return{selectQuote:(0,Lx.useCallback)((r,o)=>{let n=r[o];n&&t.selectQuote(n)},[t])}},"useSelectQuote");u();l();u();l();u();l();var Ba=K({days:1}),th=K({seconds:5}),Mx=K({seconds:30}),E0e=K({seconds:30}),C0e=K({seconds:5}),I0e=K({seconds:5}),k0e=K({seconds:30}),F0e=K({seconds:2}),P0e=K({seconds:10}),_0e=K({seconds:30}),v0e=K({seconds:2}),R0e=K({seconds:10}),Ux=i(t=>`/v1/actors-search?query=${encodeURIComponent(t)}`,"actorSearchEndpoint");u();l();var Zx=a.object({actors:Ar.array()}),Js;(function(t){t.Buy="Buy",t.Sell="Sell",t.TokenFollow="TokenFollow"})(Js||(Js={}));var PN=a.object({type:a.literal("followers")}),_N=a.object({type:a.literal("actor"),id:a.string()}),vN=a.union([PN,_N]),Yx=a.object({actorId:a.string(),id:a.string(),published:a.coerce.string(),storyType:a.nativeEnum(Js),destinations:a.array(vN)}),Xx=Yx.extend({chainId:Tr}),RN=Xx.extend({storyType:a.literal(Js.Buy),tokenBoughtAmount:a.string().nullish(),tokenBoughtUsdValue:a.string().nullish(),tokenBoughtPrice:a.string().nullish(),tokenBoughtAddress:a.string()}),DN=Xx.extend({storyType:a.literal(Js.Sell),tokenSoldAmount:a.string().nullish(),tokenSoldUsdValue:a.string().nullish(),tokenSoldPrice:a.string().nullish(),tokenSoldAddress:a.string()}),BN=Yx.extend({storyType:a.literal(Js.TokenFollow),tokenId:a.string(),otherTokenFollowers:a.array(a.string())}),Q0e=a.union([RN,DN,BN]),Ol;(function(t){t.TokenMetadataV2="TokenMetadataV2",t.Actor="Actor"})(Ol||(Ol={}));var NN=Wy.pick({name:!0,symbol:!0,decimals:!0,logoUri:!0,extraMetadata:!0,price:!0}),Jx=a.object({id:a.string(),type:a.string()}),eE=Jx.extend({type:a.literal(Ol.TokenMetadataV2),attributes:NN}),LN=Jx.extend({type:a.literal(Ol.Actor),attributes:Ar});var Ox;(function(t){t.SUGGESTED="suggested",t.BY_LIST="by-list"})(Ox||(Ox={}));var qx;(function(t){t.EXPLORE="explore",t.ONBOARDING="onboarding",t.PROFILE="profile",t.TOKEN="token"})(qx||(qx={}));var zx;(function(t){t.TOP_PNL_1W="top_pnl_1w",t.TOP_PNL_1M="top_pnl_1m",t.SOCIAL_ONBOARDING="social_onboarding"})(zx||(zx={}));var ql;(function(t){t.PNL="pnl",t.PNL_BY_TOKEN="pnl-by-token",t.FOLLOWS_YOU="follows-you",t.SEND_INTERACTION="send-interaction"})(ql||(ql={}));var tE=a.object({actorId:a.string()}),MN=tE.extend({type:a.literal(ql.PNL),percentChange:a.number().optional()}),UN=tE.extend({type:a.literal(ql.PNL_BY_TOKEN),caip19:Ii,percentChange:a.number().optional()}),ON=a.discriminatedUnion("type",[MN,UN]),H0e=a.object({items:ON.array().default([]),included:LN.array().default([]),next:a.string().nullish()}),G0e=a.object({data:a.string().array().default([]),meta:a.object({model:a.string()}),included:eE.array().default([])}),j0e=a.object({orderedItems:Ar.array().default([]),next:a.string().optional()}),$0e=a.object({orderedItems:Ar.array().default([]),next:a.string().optional()}),K0e=a.object({orderedItems:Ar.array().default([]),next:a.string().optional()}),Qx;(function(t){t.ABUSE_AND_HARASSMENT="abuse_and_harassment",t.PRIVACY_AND_IMPERSONATION="privacy_and_impersonation",t.SPAM="spam"})(Qx||(Qx={}));var V0e=a.object({orderedItems:Ar.array().default([]),next:a.string().optional()}),W0e=a.object({orderedItems:Ar.array().default([]),next:a.string().optional()}),qN=a.object({id:a.string(),username:a.string(),icon:a.string().nullish()}),Z0e=a.object({followingHolders:qN.array().default([])}),zN=a.object({targetId:a.string(),actorId:a.string(),type:a.string(),content:a.string()}),QN=a.object({targetId:a.string(),content:a.string(),type:a.string(),count:a.number({coerce:!0})});function HN(t,e){return t==="emoji"&&rE.includes(e)}i(HN,"canUseReactionCount");var GN=zN.transform(t=>({...t,content:rE.includes(t.content)?t.content:ie.Eyes})),Y0e=a.object({reactions:a.array(GN),counts:a.array(QN).transform(t=>t.filter(e=>HN(e.type,e.content))).optional()}),X0e=a.object({actors:Ar.array().default([]),nextCursor:a.string().optional()}),ie;(function(t){t.Bear="\u{1F43B}",t.Bull="\u{1F402}",t.CashFlying="\u{1F4B8}",t.Celebrate="\u{1F389}",t.ChartDown="\u{1F4C9}",t.ChartUp="\u{1F4C8}",t.Coin="\u{1FA99}",t.Cool="\u{1F60E}",t.CreditCard="\u{1F4B3}",t.CryLaughing="\u{1F602}",t.Crying="\u{1F62D}",t.DevilHappy="\u{1F608}",t.DevilMad="\u{1F47F}",t.Diamond="\u{1F48E}",t.Disgusted="\u{1F922}",t.Distressed="\u{1F62B}",t.Eggplant="\u{1F346}",t.Expressionless="\u{1F611}",t.Eyes="\u{1F440}",t.Fire="\u{1F525}",t.Flag="\u{1F3C1}",t.HeartEyes="\u{1F60D}",t.Heart="\u2764\uFE0F",t.Mad="\u{1F620}",t.MiddleFinger="\u{1F595}",t.MoneyBag="\u{1F4B0}",t.Moon="\u{1F319}",t.OkHand="\u{1F44C}",t.OpenMouth="\u{1F62E}",t.Peace="\u270C\uFE0F",t.Peach="\u{1F351}",t.PointUp="\u{1F446}",t.PileOfPoo="\u{1F4A9}",t.Pray="\u{1F64F}",t.Rocket="\u{1F680}",t.Siren="\u{1F6A8}",t.Skull="\u{1F480}",t.SmileWithTear="\u{1F972}",t.Smile="\u{1F600}",t.StopSign="\u{1F6D1}",t.Surprised="\u{1F632}",t.SweatDrops="\u{1F4A6}",t.Ufo="\u{1F6F8}",t.UpsideDownFace="\u{1F643}",t.Whale="\u{1F40B}"})(ie||(ie={}));var rE=[ie.CryLaughing,ie.Disgusted,ie.Mad,ie.Distressed,ie.HeartEyes,ie.OpenMouth,ie.SmileWithTear,ie.UpsideDownFace,ie.Smile,ie.Crying,ie.Surprised,ie.Expressionless,ie.Cool,ie.DevilHappy,ie.DevilMad,ie.Skull,ie.Eyes,ie.Diamond,ie.Fire,ie.Eggplant,ie.Peach,ie.CreditCard,ie.Heart,ie.SweatDrops,ie.Coin,ie.Siren,ie.MoneyBag,ie.PileOfPoo,ie.Celebrate,ie.OkHand,ie.MiddleFinger,ie.PointUp,ie.Peace,ie.Pray,ie.Rocket,ie.Ufo,ie.Moon,ie.ChartUp,ie.ChartDown,ie.Flag,ie.StopSign,ie.Bear,ie.Bull,ie.CashFlying,ie.Whale],J0e=a.object({isFollowing:a.boolean()}),Hx;(function(t){t.Blocking="blocking",t.Chat="chat",t.CompetitionLeaderboard="competitionLeaderboard",t.Deeplink="deeplink",t.Feed="feed",t.Followers="followers",t.FollowRequest="followRequest",t.ManageAccounts="manageAccounts",t.Notifications="notifications",t.Nux="nux",t.Onboarding="onboarding",t.PerpsLeaderboard="perpsLeaderboard",t.ReactionsDetails="reactionsDetails",t.Search="search",t.SuggestedFollows="suggestedFollows",t.SuggestedFollowsByList="suggestedFollowsByList"})(Hx||(Hx={}));var Gx;(function(t){t.VolumeDistribution="volumeDistribution",t.VolumeDistributionAllocations="volumeDistributionAllocations",t.OpenPositions="openPositions",t.ClosedPositions="closedPositions"})(Gx||(Gx={}));var jx;(function(t){t.Profile="profile",t.ShareStory="shareStory"})(jx||(jx={}));var eAe=a.object({channelType:a.string(),channelId:a.string(),enabled:a.boolean()}),jN=a.object({userId:a.string(),username:a.string(),text:a.string(),createdAt:a.coerce.string()}),$N=a.object({id:a.string(),name:a.string(),image:a.string().nullish()}),tAe=a.object({channelId:a.string(),watcherCount:a.number(),watchers:a.array($N).default([]),lastMessages:a.array(jN)}),oE=a.object({color:a.string(),icon:a.string(),name:a.string(),requirement:a.number()}),rAe=a.object({quantity:a.number(),quantityString:a.string(),decimals:a.number(),price:a.number().nullish(),badge:oE.nullish()}),oAe=a.object({positions:a.array(a.record(a.string(),a.any()))}),KN=a.object({profileId:a.string(),username:a.string(),quantity:a.number()}),nAe=a.object({channelId:a.string(),leaderboard:a.array(KN)}),sAe=a.object({badges:a.array(oE)}),$x;(function(t){t.Buy="buy",t.Sell="sell",t.BadgeUnlocked="badge_unlocked",t.PredictionMarketBuy="prediction_market_position_buy",t.PredictionMarketSell="prediction_market_position_sell"})($x||($x={}));var VN=a.object({id:a.string(),tokenId:a.string(),createdAt:a.string(),updatedAt:a.string()}),iAe=a.object({data:a.array(VN),included:eE.array().default([]),nextCursor:a.string().nullish()}),nE=a.object({channelId:a.string(),channelType:a.string(),watcherCount:a.number()}),WN=nE.extend({eventId:a.string()}),ZN=nE.extend({tokenId:a.string()}),aAe=a.union([WN,ZN]),Kx;(function(t){t.TokenPage="tokenPage",t.TrendingList="trendingList",t.RecentList="recentList",t.Banner="banner",t.Notification="notification",t.PredictionMarket="predictionMarket",t.Perps="perps"})(Kx||(Kx={}));var Vx;(function(t){t.Chat="chat",t.Badges="badges"})(Vx||(Vx={}));var YN=a.object({profileId:a.string(),userId:a.string(),username:a.string(),icon:Hg}),XN=a.object({accountValueUsd:a.number(),pnlUsd:a.number(),roiPct:a.number(),volumeUsd:a.number()}),Wx=a.object({rank:a.number(),isViewer:a.boolean(),actor:YN,performance:XN}),cAe=a.object({leaderboard:a.array(Wx),viewer:Wx.nullish()}),uAe=a.object({accountValueUsd:a.number(),pnlUsd:a.number(),roiPct:a.number(),volumeUsd:a.number(),error:a.string().optional()}),sE=a.object({market:a.string(),name:a.string(),image:a.string(),pnlUsd:a.number()}),JN=sE.extend({margin:a.number(),roiPct:a.number(),leverage:a.string(),direction:a.string()}),eL=sE.extend({id:a.string(),valueUsd:a.number(),timestamp:a.number(),type:a.string()}),tL=a.object({market:a.string(),name:a.string(),image:a.string(),color:a.string().optional(),volumePct:a.number()}),lAe=a.object({portfolio:a.object({pnlUsd:a.number(),volumeUsd:a.number()}),openPositions:a.object({positions:a.array(JN)}),closedPositions:a.object({volumeByMarket:a.array(tL),positions:a.array(eL)})}),pAe=a.object({totalSwapVolumeUsd:a.number(),totalPerpsVolumeUsd:a.number(),totalVolumeUsd:a.number()}),rL=a.object({caip19:a.string(),name:a.string(),symbol:a.string(),logoUri:a.string().nullish().default(null),balancePct:a.number()}),dAe=a.object({tradeCount:a.number(),fungibles:a.array(rL)}),Na;(function(t){t.PredictionMarket="predictionMarket",t.Perps="perps",t.Token="token"})(Na||(Na={}));u();l();var ei=i(({name:t,response:e,current:r,target:o})=>{let n=`Failed to ${t}: 
`,s=[r!==void 0?`Current: ${r}`:null,o!==void 0?`Target: ${o}`:null].filter(Boolean);return s.length>0&&(n+=`${s.join(" | ")} 
`),n+=`${e.status} ${e.statusText} 
`,n+=`${JSON.stringify(e.data)}`,n},"getFetcherErrorMessage"),iE=i(({name:t,error:e,current:r,target:o})=>{let n=`Failed to parse ${t}: 
`,s=[r!==void 0?`Current: ${r}`:null,o!==void 0?`Target: ${o}`:null].filter(Boolean);return s.length>0&&(n+=`${s.join(" | ")} 
`),n+=`${JSON.stringify(e)}`,n},"getParserErrorMessage");var aE=i(async t=>{k.addBreadcrumb(_.Network,"User is searching for actors.",L.Info,{query:t});let e=await z.api().bearer(!0).get(Ux(t));if(!te(e)){let o=new Error(ei({name:"searchForActor",response:e}));throw k.captureError(o,_.UserSearch),o}let r=Zx.safeParse(e.data);return r.success?{actors:r.data.actors}:{actors:[]}},"searchForActor");u();l();u();l();function cE(t){let e=t.match(/\/v1\/actors\/([^/]+)/)?.[1];return e?ic.parse(e):void 0}i(cE,"userProfileIdFromUrl");u();l();function uE(t){return cE(t)??ic.parse(t)}i(uE,"userProfileIdFromUrlOrProfileId");u();l();var we="social",Se="@phantom/social",Zr={actor(t){return[we,`${Se}:actor`,{profileId:t}]},actorVolume(t){return[we,`${Se}:actor-volume`,{profileId:t}]},actorAndFollowers(t){return[we,`${Se}:actor-and-followers`,{profileId:t}]},actorAndFollowing(t){return[we,`${Se}:actor-and-following`,{profileId:t}]},userProfileByUsernameOrUserProfileId(t){return[we,`${Se}:user-profile-by-username-or-user-profile-id`,{usernameOrUserProfileId:t}]},followUser(t,e){return[we,`${Se}:follow-user`,{currentId:t,targetId:e}]},followingTokens(t){return[we,`${Se}:following-tokens`,{limit:t}]},feedStory(t){return[we,`${Se}:feed-story`,{storyId:t}]},searchForActorBase(){return[we,`${Se}:search`]},searchForActor(t){return[we,`${Se}:search`,{query:t}]},followRequests(t){return[we,`${Se}:follow-requests`,{profileId:t}]},suggestedActors(t,e){return[we,`${Se}:suggested-follows`,{profileId:e,source:t}]},actorList(t,e,r){return[we,`${Se}:actor-list`,{profileId:r,listName:e,source:t}]},blocking(t){return[we,`${Se}:blocking`,{profileId:t}]},pendingFollowRequests(t,e){return[we,`${Se}:pending-follow-requests`,{profileId:t,targetId:e}]},reaction(t){return t?[we,`${Se}:reaction`,{targetId:t}]:[we,`${Se}:reaction`]},reactionDetails(t){return t.targetId?[we,`${Se}:reaction-details`,t]:[we,`${Se}:reaction-details`,{content:t.content}]},followingHolders(t,e){return[we,`${Se}:following-holders`,{profileId:t,caip19:e}]},tokenFollows(t,e){return[we,`${Se}:token-follows`,{profileId:t,caip19:e}]},userProfileFeed(t,e){return[we,`${Se}:user-profile-feed`,{username:t,userEnabledNetworks:e}]},chatEnabled(t){return[we,`${Se}:chat-enabled`,{chatId:t}]},chatStats(t){return[we,`${Se}:chat-stats`,{chatId:t}]},tokenChatBalance(t,e){return[we,`${Se}:token-chat-balance`,{caip19:t,userId:e}]},predictionMarketPosition(t,e){return[we,`${Se}:prediction-market-position`,{eventId:t,profileId:e}]},chatLeaderboard(t){return[we,`${Se}:chat-leaderboard`,{caip19:t}]},similarTokens(t,e,r){return[we,`${Se}:similar-tokens`,{caip19:t,profileId:r,limit:e}]},popularChats(){return[we,`${Se}:popular-chats`]},chatChannel(t,e){return[we,`${Se}:chat-channel`,{channelType:t,channelId:e}]},perpsLeaderboard(t,e){return[we,`${Se}:perps-leaderboard`,{limit:t,windowPeriod:e}]},perpsPortfolio(t,e){return[we,`${Se}:perps-portfolio`,{windowPeriod:t,userId:e}]},perpsProfile(t,e,r){return[we,`${Se}:perps-profile`,{profileId:t,openLimit:e,closedLimit:r}]},fungiblesPortfolio(t,e){return[we,`${Se}:fungibles-portfolio`,{profileId:t,limit:e}]},badgeStatus(t){return[we,`${Se}:badge-status`,{caip19:t}]},chatBlockList(t){return[we,`${Se}:chat-block-list`,{userId:t}]}};var lE=i((t,e)=>{let r=uE(e.id);r&&t.setQueryData(Zr.actor(r),e)},"setActorInQueryCache");var pE=i(async(t,e)=>{let r=e?.startsWith("@")?e.slice(1):e;if(!r)throw new Error("No sanitized username or user profile id");let o=await t.getUserProfileByUsernameOrUserProfileId(r);if(!o)throw new Error("No user profile");return o},"getUserProfileByUsernameOrUserProfileIdQueryFn");function oL({usernameOrUserProfileId:t}){let e=uy(),r=Zr.userProfileByUsernameOrUserProfileId(t);return oe({enabled:!!t,queryKey:r,queryFn:i(async()=>pE(e,t),"queryFn"),gcTime:Ba,staleTime:th})}i(oL,"useGetUserProfileByUsernameOrUserProfileId");function nL({query:t}){let e=qe(),r=t?.startsWith("@")?t.slice(1).trim():t.trim(),o=Zr.searchForActor(r),n=i(async()=>{let{actors:s}=await aE(r);for(let c of s)lE(e,c);return s.sort((c,p)=>c.isFollowing?-1:p.isFollowing?1:0),{actors:s}},"queryFn");return nc({enabled:r.length>1,queryKey:o,queryFn:n,gcTime:Ba,staleTime:th})}i(nL,"useSearchForActor");u();l();u();l();u();l();async function dE(t){let e=await z.api().bearer(!0).headers({Accept:"application/activity+json"}).get(`/v1/actors/${t}`);if(!te(e)){let o=new Error(ei({name:"getActor",response:e,target:t}));throw k.captureError(o,_.Profiles),o}let r=Ar.safeParse(e.data);if(r.success)return r.data;{let o=new Error(iE({name:"getActor",error:r.error,target:t}));throw k.captureError(o,_.Profiles),o}}i(dE,"getActor");function rh(t,e=!0){let r=i(async()=>{if(!t)throw new Error("No profile ID or access token");return dE(t)},"queryFn");return nc({queryKey:Zr.actor(t),queryFn:r,enabled:e&&!!t,gcTime:Ba,staleTime:Mx})}i(rh,"useGetActor");u();l();u();l();u();l();var mE;(function(t){t.BID="B",t.ASK="A"})(mE||(mE={}));var fE;(function(t){t.OPEN="open",t.FILLED="filled",t.CANCELED="canceled",t.TRIGGERED="triggered",t.REJECTED="rejected",t.MARGIN_CANCELED="margin_canceled"})(fE||(fE={}));var We=a.string().regex(/^\d*\.?\d+([eE][+-]?\d+)?$/,"Invalid numeric string"),yt=a.string().regex(/^-?\d*\.?\d+([eE][+-]?\d+)?$/,"Invalid signed numeric string");var ti=Bg.extend({chainId:vg,address:a.string()}),gE=a.object({tokenIndex:a.number(),pairIndex:a.number()}),hE=a.object({symbol:a.string(),name:a.string(),token:ti,logoUri:a.string(),szDecimals:a.number(),maxLeverage:a.number(),price:yt,priceChange24h:a.object({amount:yt,percentage:yt}),volume24h:We,openInterest:We,fundingRate:yt,assetId:a.number(),isAtOpenInterestCap:a.boolean().optional(),description:a.string().optional(),collateralToken:gE.optional()}),yE=a.object({markets:a.array(hE).transform(t=>t.reduce((e,r)=>{let o=hE.safeParse(r);return o.success&&(e[N(o.data.token)]=o.data),e},{}))}),_xe=a.object({id:a.string(),name:a.string(),logoUri:a.string(),currentPrice:a.number(),maxLeverage:a.number(),szDecimals:a.number(),assetId:a.number(),symbol:a.string(),collateralToken:gE.optional()});u();l();var Yr="perps",wE={historicalOrders:i((t,e)=>[Yr,"historical-orders",t,e],"historicalOrders"),market:i(t=>[Yr,"market",t],"market"),markets:i(t=>[Yr,"markets",t.sort()],"markets"),defaultLeverage:i(()=>[Yr,"default-leverage"],"defaultLeverage"),assetLeverage:i(()=>[Yr,"asset-leverage"],"assetLeverage"),permissions:i(()=>[Yr,"config"],"permissions"),fungibleToPerpMap:i(()=>[Yr,"fungible-to-perp-map"],"fungibleToPerpMap"),fundsInTransitBanner:i(t=>[Yr,"funds-in-transit-banner",t],"fundsInTransitBanner"),fundsInTransitBannerDismissed:i(()=>[Yr,"funds-in-transit-banner-dismissed"],"fundsInTransitBannerDismissed"),getStartedCardDismissed:i(()=>[Yr,"get-started-card-dismissed"],"getStartedCardDismissed")};u();l();var sL={perp:6,spot:8};function SE(t,e,r="perp",o=A.ROUND_HALF_UP){let n=new A(t);if(n.isInteger())return n.toString();let s=sL[r],c=Math.max(s-e,0);return n.precision(5,o).toFixed(c,o).replace(/\.?0+$/,"")}i(SE,"formatUiPrice");var iL=K({days:1}),aL=K({minutes:5});var oh=i((t,e=!1)=>oe({enabled:t.length>0,queryKey:wE.markets(t),gcTime:iL,staleTime:aL,async queryFn(){try{return await cL(t,e)}catch(r){throw k.addBreadcrumb(_.Perps,"Failed to get perp markets",L.Error,{caip19s:t.join(","),error:r instanceof Error?r.message:"Unknown error"}),r}}}),"useGetPerpMarkets");async function cL(t,e=!1){let r=await z.api().get("/swap/v2/perp/markets",{params:{tokens:t.join(",")}});if(!te(r))throw new Error("Failed to get perp markets: response is not okay");let o=r.data,n=yE.safeParse(o);if(!n.success)throw new Error("Failed to get perp markets: schema validation failed");if(e){let s=n.data.markets,c={};for(let[p,d]of Object.entries(s))c[p]={...d,price:SE(d.price,d.szDecimals),priceChange24h:{...d.priceChange24h,percentage:String(Number(d.priceChange24h.percentage)/100)}};return c}return n.data.markets}i(cL,"getPerpMarkets");u();l();u();l();var uL=a.object({name:a.string(),shortName:a.string()}).passthrough(),lL=a.object({type:a.string(),eventTicker:a.string(),ui:uL}).passthrough(),pL=a.enum(["YES","NO"]).transform(t=>t.toLowerCase()),dL=a.object({outcome:pL,size:a.coerce.number(),platformData:lL,signature:a.string().optional(),time:a.string().optional(),activityType:a.enum(["BUY","SELL","synthesizedResolvedLost"]),escrowMintAmount:a.coerce.number().optional(),escrowMintAddress:a.string().optional(),outputMintAmount:a.number().optional(),outputMintAddress:a.string().optional(),exposure:a.coerce.number().optional()}).passthrough(),bE=a.object({activities:a.array(dL),offset:a.number().optional()}).passthrough();u();l();u();l();var nh=a.object({marketLedger:a.string(),yesMint:a.string(),noMint:a.string(),isInitialized:a.boolean()}),mL=a.object({ticker:a.string(),eventTicker:a.string(),marketType:a.string(),title:a.string(),subtitle:a.string().optional(),yesSubTitle:a.string(),noSubTitle:a.string(),openTime:a.number(),closeTime:a.number(),expirationTime:a.number(),status:a.string(),volume:a.number(),result:a.string().nullish().default(null),openInterest:a.number(),canCloseEarly:a.boolean(),earlyCloseCondition:a.string().optional(),rulesPrimary:a.string(),rulesSecondary:a.string().optional(),accounts:a.record(a.string(),nh)}),sEe=a.object({markets:a.array(mL),cursor:a.string().nullish().default(null)});u();l();var sh=a.object({backgroundColor:a.string(),textColor:a.string(),translucentBackgroundColor:a.string(),actionButtonColor:a.string().optional(),actionButtonTextColor:a.string().optional(),name:a.string(),shortName:a.string(),subtitle:a.string(),imageUrl:a.string().nullish().default(null).optional().transform(t=>t??void 0),competitionType:a.string().nullish().transform(t=>t??void 0),binaryOutcomeColors:a.object({yes:a.object({backgroundColor:a.string(),textColor:a.string()}),no:a.object({backgroundColor:a.string(),textColor:a.string()})}).optional()}),fL=a.object({label:a.string(),price:a.number().optional(),chance:a.number().optional(),bestBid:a.number().optional(),bestAsk:a.number().optional(),binaryType:a.enum(["yes","no"]).optional()}),hL=a.object({id:a.string(),title:a.string(),subtitle:a.string().optional(),slug:a.string().optional(),image:a.string().optional(),status:a.string(),outcomes:a.array(fL),startTime:a.string().optional(),endDate:a.string(),volume:a.number(),volume24h:a.number().optional(),liquidity:a.number(),openInterest:a.number().optional(),dflowAccounts:a.record(a.any()).optional(),custom_strike:a.record(a.any()).optional(),ui:sh.optional()}),gL=a.object({type:a.string()}).passthrough(),TE=a.object({id:a.string(),title:a.string(),subtitle:a.string().optional(),description:a.string().optional(),category:a.string(),image:a.string().optional(),icon:a.string().optional(),startDate:a.string(),endDate:a.string(),active:a.boolean(),closed:a.boolean(),markets:a.array(hL),volume:a.number(),volume24h:a.number(),liquidity:a.number(),openInterest:a.number().optional(),live:a.boolean().optional(),ended:a.boolean().optional(),score:a.string().optional(),elapsed:a.string().optional(),period:a.string().optional(),platformData:gL,product_metadata:a.object({competition:a.string().optional()}).passthrough().optional()}),pEe=a.object({events:a.array(TE),nextKalshiCursor:a.string().optional()}),dEe=TE.extend({subcategory:a.string().optional(),featuredImage:a.string().optional(),resolutionSource:a.string().optional(),creationDate:a.string().optional(),closedTime:a.string().optional(),archived:a.boolean().optional(),new:a.boolean().optional(),featured:a.boolean().optional(),restricted:a.boolean().optional(),volume1wk:a.number().optional(),volume1mo:a.number().optional(),volume1yr:a.number().optional(),liquidityAmm:a.number().optional(),liquidityClob:a.number().optional(),commentsEnabled:a.boolean().optional(),commentCount:a.number().optional(),competitive:a.number().optional(),tags:a.array(a.object({id:a.string(),label:a.string()})).optional(),categories:a.array(a.object({id:a.string(),label:a.string()})).optional(),collections:a.array(a.object({id:a.string(),title:a.string(),slug:a.string()})).optional(),series:a.array(a.object({id:a.string(),title:a.string(),ticker:a.string(),slug:a.string()})).optional(),subEvents:a.array(a.string()).optional(),parentEvent:a.string().optional(),createdBy:a.string().optional(),updatedBy:a.string().optional(),createdAt:a.string().optional(),updatedAt:a.string().optional(),publishedAt:a.string().optional()}).passthrough();var yL=a.discriminatedUnion("type",[a.object({type:a.literal("open")}),a.object({type:a.literal("claimable")}),a.object({type:a.literal("pending")}),a.object({type:a.literal("resolved"),result:a.enum(["won","lost"])})]),wL=a.object({marketId:a.string(),marketTitle:a.string(),eventId:a.string(),outcome:a.enum(["YES","NO"]).transform(t=>t.toLowerCase()),endDate:a.string(),size:a.number(),exposure:a.number().nullish().transform(t=>t??void 0),currentValue:a.number().nullish().transform(t=>t??void 0),platformData:a.object({type:a.literal("kalshi"),mint:a.string(),position:a.enum(["YES","NO"]),marketTicker:a.string(),eventTicker:a.string(),accounts:a.record(a.string(),nh),isLive:a.boolean(),eventStartDate:a.string().optional(),marketTitle:a.string(),marketSubtitle:a.string().optional(),status:yL,marketResult:a.enum(["yes","no"]).optional(),ui:sh.optional()}),lastUpdated:a.string()}),AE=a.object({positions:a.array(wL)});u();l();var xE=a.object({wonResolvedCount:a.number(),totalResolvedCount:a.number(),totalPnl:a.number(),volume:a.number()}).passthrough();u();l();var vn;(function(t){t.Kalshi="kalshi",t.Polymarket="polymarket"})(vn||(vn={}));var EE;(function(t){t.Volume="volume",t.Volume24hr="volume24hr",t.StartTime="startTime",t.EventDate="eventDate"})(EE||(EE={}));var CE;(function(t){t.Sports="Sports",t.Politics="Politics",t.Finance="Finance",t.Crypto="Crypto",t.Earnings="Earnings",t.Tech="Tech",t.World="World",t.Economy="Economy",t.Elections="Elections",t.Mentions="Mentions",t.Culture="Pop-Culture",t.Geopolitics="Geopolitics",t.Entertainment="Entertainment",t.Health="Health",t.ScienceAndTechnology="Science and Technology",t.Social="Social",t.Transportation="Transportation",t.Companies="Companies",t.ClimateAndWeather="Climate and Weather",t.Financials="Financials",t.Economics="Economics"})(CE||(CE={}));var IE;(function(t){t.Soccer="Soccer",t.Basketball="Basketball",t.Football="Football",t.Baseball="Baseball",t.Hockey="Hockey",t.Tennis="Tennis",t.Golf="Golf",t.Boxing="Boxing",t.Mma="MMA",t.Esports="Esports",t.Motorsports="Motorsports",t.Cricket="Cricket",t.Chess="Chess",t.Weekly="Weekly",t.Recurring="Recurring",t.Stocks="Stocks",t.Equities="Equities",t.Daily="Daily",t.UpOrDown="Up or Down",t.Earnings="Earnings",t.Indicies="Indicies",t.Commodities="Commodities",t.Forex="Forex",t.Acquisitions="Acquisitions",t.Ipos="Ipos",t.FedRate="Fed Rate",t.Treasuries="Treasuries",t.Bitcoin="Bitcoin",t.Ethereum="Ethereum",t.Solana="Solana"})(IE||(IE={}));var SL="http://localhost:3017/predictions",bL="/predictions",wt=i(()=>bL,"getBasePath"),St=i(()=>{let t=z.api(),e=v.language;return e?t.headers({"Accept-Language":e}):t},"getRequestBuilder"),zl=class{static{i(this,"BackendPredictionsClient")}async getEvents(e){try{let o=(await St().get(`${wt()}/v2/events`,{params:e})).data;if(o&&(o.error||o.statusCode)&&!o.events)throw console.error("[BackendPredictionsClient] getEvents received error response:",o),new Error(o.message||o.error||"Failed to fetch events");return o}catch(r){throw console.error("[BackendPredictionsClient] getEvents failed:",r),r}}async getEvent(e,r=vn.Kalshi){try{let n=(await St().get(`${wt()}/v2/event/${r}/${e}`)).data;if(n&&(n.error||n.statusCode))throw console.error(`[BackendPredictionsClient] getEvent received error response for ${e}:`,n),new Error(n.message||n.error||"Failed to fetch event");return n}catch(o){throw console.error(`[BackendPredictionsClient] getEvent failed for ${e} on ${r}:`,o),o}}async getMarket(e,r){try{return(await St().get(`${wt()}/v2/market/${e}/${r}`)).data}catch(o){throw console.error(`[BackendPredictionsClient] getMarket failed for ${r}:`,o),o}}async searchEvents(e){try{let o=(await St().get(`${wt()}/v2/events/search`,{params:e})).data;if(o&&(o.error||o.statusCode)&&!o.events)throw console.error("[BackendPredictionsClient] searchEvents received error response:",o),new Error(o.message||o.error||"Failed to search events");return o}catch(r){throw console.error("[BackendPredictionsClient] searchEvents failed:",r),r}}async getHistoricalPrices(e,r,o){try{return(await St().get(`${wt()}/v2/historical-prices/${e}/${r}`,{params:o})).data}catch(n){throw console.error(`[BackendPredictionsClient] getHistoricalPrices failed for ${r}:`,n),n}}async getOrderbook(e,r,o){try{return(await St().get(`${wt()}/v2/orderbook/${e}/${r}`,{params:o})).data}catch(n){throw console.error(`[BackendPredictionsClient] getOrderbook failed for ${r}:`,n),n}}async getPositions({address:e,venue:r,status:o}){try{let n=await St().get(`${wt()}/v2/positions/${r}`,{params:{user:e,status:o}});return AE.parse(n.data)}catch(n){throw console.error("[BackendPredictionsClient] getPositions failed:",n),n}}async getActivities(e){try{return(await St().get(`${wt()}/v2/activities`,{params:e})).data}catch(r){throw console.error("[BackendPredictionsClient] getActivities failed:",r),r}}async getUserActivities({address:e,venue:r,limit:o,offset:n}){try{let s={user:e,venue:r,includeLossTokens:"true",...o!==void 0&&{limit:o},...n!==void 0&&{offset:n}},c=await St().get(`${wt()}/v2/user-activities`,{params:s});return bE.parse(c.data)}catch(s){throw console.error("[BackendPredictionsClient] getUserActivities failed:",s),s}}async getActiveOrders(e){try{return(await St().get(`${wt()}/v2/active-orders`,{params:e})).data}catch(r){throw console.error("[BackendPredictionsClient] getActiveOrders failed:",r),r}}async getTabs(e){try{let o=e??!1?{test:"true"}:void 0;return(await St().get(`${wt()}/v2/tabs`,{params:o})).data}catch(r){throw console.error("[BackendPredictionsClient] getTabs failed:",r),r}}async getPortfolio(){try{return(await St().get(`${wt()}/v2/portfolio`)).data}catch(e){throw console.error("[BackendPredictionsClient] getPortfolio failed:",e),e}}async getUserStats({address:e,venue:r}){try{let o=await St().get(`${wt()}/v2/user-stats`,{params:{user:e,venue:r}});return xE.parse(o.data)}catch(o){throw console.error("[BackendPredictionsClient] getUserStats failed:",o),o}}async getTrades(e,r,o,n){try{return(await St().get(`${wt()}/v2/trades/${e}`,{params:{marketTickers:r.join(","),limit:o,after_ts:n}})).data}catch(s){throw console.error(`[BackendPredictionsClient] getTrades failed for ${e}:`,s),s}}async getForecastHistory(e,r,o){try{let n={start_ts:o.start_ts,period_interval:o.period_interval,candlestick_function:o.candlestick_function};return o.end_ts!==null&&(n.end_ts=o.end_ts),(await St().get(`${wt()}/v2/forecast-history/${e}/${r}`,{params:n})).data}catch(n){throw console.error(`[BackendPredictionsClient] getForecastHistory failed for ${r}:`,n),n}}async getScoreV3(e,r){try{return(await St().get(`${wt()}/v2/score/${e}/${r}`)).data}catch(o){throw console.error("[BackendPredictionsClient] getScoreV3 failed:",o),o}}async getHomeFeaturedItems(){try{return(await St().get(`${wt()}/v2/home-featured-items`)).data}catch(e){throw console.error("[BackendPredictionsClient] getHomeFeaturedItems failed:",e),e}}async getFeed(){try{return(await St().get(`${wt()}/v2/feed`)).data}catch(e){throw console.error("[BackendPredictionsClient] getFeed failed:",e),e}}MARKET_MINT_DECIMALS=6;async postOptimisticPosition(e,r,o){let n=await this.getMarket(vn.Kalshi,o),s=new A(e.outAmount).shiftedBy(-this.MARKET_MINT_DECIMALS).toNumber(),c=n.platformData;if(c.type!==vn.Kalshi)throw new Error("Only Kalshi markets are supported");let p=n.dflowAccounts,d=n.outcomes.find(m=>m.binaryType===r)?.price;return{marketId:n.id,marketTitle:n.title,eventId:c.eventTicker,outcome:r,endDate:n.endDate,size:s,exposure:d?s*d:void 0,platformData:{type:vn.Kalshi,mint:e.outputMint,position:r==="yes"?"YES":"NO",marketTicker:c.ticker,eventTicker:c.eventTicker,accounts:p??{},isLive:!1,eventStartDate:n.startTime,marketTitle:n.title,marketSubtitle:n.ui?.name??n.subtitle,status:{type:"open"},ui:n.ui},lastUpdated:new Date().toISOString()}}};u();l();u();l();u();l();u();l();u();l();var LE=D(NE(),1),ME=LE.default;var IL=ME.bind({concatArrays:!0,ignoreUndefined:!0});function kL(t,e){let r=self.localStorage.getItem(t);if(r){let o=JSON.parse(r),n=JSON.parse(e),s=JSON.stringify(IL(o,n));self.localStorage.setItem(t,s)}else self.localStorage.setItem(t,e)}i(kL,"mergeLocalStorageItem");function ni(t,e){return new Promise((r,o)=>{try{let n=t();e?.(null,n),r(n)}catch(n){e?.(n),o(n)}})}i(ni,"createPromise");function Gl(t,e,r){return Promise.all(t).then(o=>{let n=r?.(o)??null;return e?.(null,n),Promise.resolve(n)},o=>(e?.(o),Promise.reject(o)))}i(Gl,"createPromiseAll");var La={getItem:i((t,e)=>ni(()=>self.localStorage.getItem(t),e),"getItem"),setItem:i((t,e,r)=>ni(()=>self.localStorage.setItem(t,e),r),"setItem"),removeItem:i((t,e)=>ni(()=>self.localStorage.removeItem(t),e),"removeItem"),mergeItem:i((t,e,r)=>ni(()=>kL(t,e),r),"mergeItem"),clear:i(t=>ni(()=>self.localStorage.clear(),t),"clear"),getAllKeys:i(t=>ni(()=>{let e=self.localStorage.length,r=[];for(let o=0;o<e;o+=1){let n=self.localStorage.key(o)||"";r.push(n)}return r},t),"getAllKeys"),flushGetRequests:i(()=>{},"flushGetRequests"),multiGet:i((t,e)=>{let r=t.map(n=>La.getItem(n));return Gl(r,e,i(n=>n.map((s,c)=>[t[c],s]),"processResult"))},"multiGet"),multiSet:i((t,e)=>{let r=t.map(o=>La.setItem(o[0],o[1]));return Gl(r,e)},"multiSet"),multiRemove:i((t,e)=>{let r=t.map(o=>La.removeItem(o));return Gl(r,e)},"multiRemove"),multiMerge:i((t,e)=>{let r=t.map(o=>La.mergeItem(o[0],o[1]));return Gl(r,e)},"multiMerge")},ah=La;u();l();var UE=ah;u();l();var FL=Object.defineProperty,OE=Object.getOwnPropertySymbols,PL=Object.prototype.hasOwnProperty,_L=Object.prototype.propertyIsEnumerable,qE=i((t,e,r)=>e in t?FL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,"__defNormalProp"),si=i((t,e)=>{for(var r in e||(e={}))PL.call(e,r)&&qE(t,r,e[r]);if(OE)for(var r of OE(e))_L.call(e,r)&&qE(t,r,e[r]);return t},"__spreadValues"),jl=i(t=>e=>{try{let r=t(e);return r instanceof Promise?r:{then(o){return jl(o)(r)},catch(o){return this}}}catch(r){return{then(o){return this},catch(o){return jl(o)(r)}}}},"toThenable"),zE=i((t,e)=>(r,o,n)=>{let s=si({getStorage:i(()=>localStorage,"getStorage"),serialize:JSON.stringify,deserialize:JSON.parse,partialize:i(T=>T,"partialize"),version:0,merge:i((T,x)=>si(si({},x),T),"merge")},e);(s.blacklist||s.whitelist)&&console.warn(`The ${s.blacklist?"blacklist":"whitelist"} option is deprecated and will be removed in the next version. Please use the 'partialize' option instead.`);let c=!1,p=new Set,d=new Set,m;try{m=s.getStorage()}catch{}if(m)m.removeItem||console.warn(`[zustand persist middleware] The given storage for item '${s.name}' does not contain a 'removeItem' method, which will be required in v4.`);else return t((...T)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),r(...T)},o,n);let f=jl(s.serialize),g=i(()=>{let T=s.partialize(si({},o()));s.whitelist&&Object.keys(T).forEach(E=>{var P;!((P=s.whitelist)!=null&&P.includes(E))&&delete T[E]}),s.blacklist&&s.blacklist.forEach(E=>delete T[E]);let x,C=f({state:T,version:s.version}).then(E=>m.setItem(s.name,E)).catch(E=>{x=E});if(x)throw x;return C},"setItem"),y=n.setState;n.setState=(T,x)=>{y(T,x),g()};let w=t((...T)=>{r(...T),g()},o,n),S,b=i(()=>{var T;if(!m)return;c=!1,p.forEach(C=>C(o()));let x=((T=s.onRehydrateStorage)==null?void 0:T.call(s,o()))||void 0;return jl(m.getItem.bind(m))(s.name).then(C=>{if(C)return s.deserialize(C)}).then(C=>{if(C)if(typeof C.version=="number"&&C.version!==s.version){if(s.migrate)return s.migrate(C.state,C.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return C.state}).then(C=>{var E;return S=s.merge(C,(E=o())!=null?E:w),r(S,!0),g()}).then(()=>{x?.(S,void 0),c=!0,d.forEach(C=>C(S))}).catch(C=>{x?.(void 0,C)})},"hydrate");return n.persist={setOptions:i(T=>{s=si(si({},s),T),T.getStorage&&(m=T.getStorage())},"setOptions"),clearStorage:i(()=>{var T;(T=m?.removeItem)==null||T.call(m,s.name)},"clearStorage"),rehydrate:i(()=>b(),"rehydrate"),hasHydrated:i(()=>c,"hasHydrated"),onHydrate:i(T=>(p.add(T),()=>{p.delete(T)}),"onHydrate"),onFinishHydration:i(T=>(d.add(T),()=>{d.delete(T)}),"onFinishHydration")},b(),S||w},"persist");var vL=10,QE={chatJoinTimestamps:new Map,chatHistory:[]},RL=ct(zE((t,e)=>({...QE,recordChatJoin:i(r=>{t(o=>{let n=new Map(o.chatJoinTimestamps);return n.set(r,Date.now()),{chatJoinTimestamps:n}})},"recordChatJoin"),recordChatLeave:i(r=>{t(o=>{let n=new Map(o.chatJoinTimestamps);return n.delete(r),{chatJoinTimestamps:n}})},"recordChatLeave"),recordChatMessage:i((r,o)=>{t(n=>({chatHistory:[{chatId:r,chatType:o,lastMessageTimestamp:Date.now()},...n.chatHistory.filter(p=>p.chatId!==r)].slice(0,vL)}))},"recordChatMessage"),clearChatHistory:i(()=>{t(r=>({...r,chatHistory:[]}))},"clearChatHistory"),removeChatFromHistory:i(r=>{t(o=>({...o,chatHistory:o.chatHistory.filter(n=>n.chatId!==r)}))},"removeChatFromHistory"),reset:i(()=>t(QE),"reset")}),{name:"chat-activity",getStorage:i(()=>UE,"getStorage"),partialize:i(t=>({chatHistory:t.chatHistory}),"partialize"),version:2,migrate(t,e){if(e===0){let r=t.chatHistory.map(o=>({chatId:o.chatId,chatType:o.chatId.startsWith("hypercore")?Na.Perps:Na.Token,lastMessageTimestamp:o.lastJoinedTimestamp??0}));return{...t,chatHistory:r}}if(e===1){let r=t.chatHistory.map(o=>({chatId:o.chatId,chatType:o.chatType,lastMessageTimestamp:o.lastJoinedTimestamp??0}));return{...t,chatHistory:r}}return t}})),HE=i(t=>RL.getState().chatJoinTimestamps.get(t),"getChatJoinTimestamp");var ch=i(async({chatTokenId:t,transactionId:e,networkId:r,tokenBoughtCaip19:o,tokenBoughtAmount:n,tokenBoughtUsdValue:s,tokenSoldCaip19:c,tokenSoldAmount:p,tokenSoldUsdValue:d,walletCaip19:m,chatTokenBalance:f,system:g})=>{if(!HE(t))return;let w=await z.api().bearer(!0).post("/social/v1/events/trades",{chatTokenId:t,networkId:r,tokenBoughtCaip19:o,tokenBoughtAmount:n,tokenBoughtUsdValue:s,tokenSoldCaip19:c,tokenSoldAmount:p,tokenSoldUsdValue:d,transactionId:e,walletCaip19:m,chatTokenBalance:f,system:g});if(!te(w)){let S=new Error(ei({name:"publishSystemChatTradeMessage",response:w}));throw k.captureError(S,_.Chat),S}},"publishSystemChatTradeMessage");u();l();var DL=i(t=>{let{data:e}=rh(t);return GE(e)},"useFollowersAndFollowingCount"),GE=i(t=>{let e={followers:t?.followers&&typeof t.followers=="object"&&t?.followers?.totalItems||0,following:t?.following&&typeof t.following=="object"&&t?.following?.totalItems||0};return{...e,formattedFollowers:Wn(e.followers||0,{compact:!0}),formattedFollowing:Wn(e.following||0,{compact:!0})}},"getFollowersAndFollowingCount");u();l();var jE=D(O());var BL=i(async(t,e,r)=>{try{await z.api().post("/swap/v2/presence",{caip19:t,visitorId:e,source:r})}catch(o){throw o instanceof Error&&k.captureError(o,_.Swapper),o}},"postTokenPresence"),NL=i((t,e)=>{let r=ue(),o=rt("enable-swapper-presence"),n=(0,jE.useCallback)(async()=>{if(!t||!o)return null;let s=await r.getDeviceId();return await BL(t,s,e),{success:!0,timestamp:Date.now()}},[t,e,r,o]);return oe({queryKey:[...me.presence(t),"post",e],queryFn:n,enabled:!!t&&o,refetchInterval:5e3,gcTime:0,staleTime:0})},"usePostTokenPresence");u();l();u();l();var KE=D(O());u();l();var $l=class{static{i(this,"CashSwapStateListener")}queryClient;storage;authRepository;cashAccount;constructor(e,r,o,n){this.queryClient=e,this.storage=r,this.authRepository=o,this.cashAccount=n}onStateChange(e,r,o,n){if(e.type===Z.TransactionConfirmed){let{sell:s,buy:c,quote:p}=o.executingQuote,d=new q(p.sellAmount),m=new q(p.buyAmount);xm({queryClient:this.queryClient,storage:this.storage,authRepository:this.authRepository,sellCaip19:J(s),sellAmountBN:d,sellAddress:s.data.walletAddress,buyCaip19:J(c),buyAmountBN:m,buyAddress:c.data.walletAddress,cashAccountAddress:this.cashAccount?.addressDetails.address})}}};u();l();var Kl=class{static{i(this,"FailedCashSwapExecuteSwapStateListener")}authRepository;constructor(e){this.authRepository=e}onStateChange(e,r,o,n){let{executingQuote:s}=o,{sell:c,buy:p}=s;if(!(!De(c)&&!De(p)))switch(e.type){case Z.SimulationFailed:k.addBreadcrumb(_.Cash,"Cash swap simulation failure detected, recording...",L.Info,{sellToken:c.data.symbol,buyToken:p.data.symbol}),this.recordFailure(s,"simulation",e.error,e.executionId);break;case Z.TransactionSubmissionFailed:k.addBreadcrumb(_.Cash,"Cash swap submission failure detected, recording...",L.Info,{sellToken:c.data.symbol,buyToken:p.data.symbol}),this.recordFailure(s,"submission",e.error,e.executionId);break}}async recordFailure(e,r,o,n){try{let s=await this.authRepository?.getUser();if(!s){k.addBreadcrumb(_.Cash,"Cannot record failed cash swap: user not found",L.Info);return}let{accessToken:c,userID:p}=s,d=e.sell,m=e.buy,f=e.quote,g=e.quoteInput,y=d.data.walletAddress,w=m.data.walletAddress;if(!y&&g?.taker){let x=Ve(g.taker);x.resourceType===V.address&&(y=x.address)}if(!w&&g?.takerDestination){let x=Ve(g.takerDestination);x.resourceType===V.address&&(w=x.address)}let S={type:pn.Swap,input:{owner:y,mint:d.data.tokenAddress??"",amount:f.sellAmount,symbol:d.data.symbol??void 0,name:d.data.name??void 0,decimals:d.data.decimals,logoUri:d.data.logoUri??void 0},output:{owner:w,mint:m.data.tokenAddress??"",amount:f.buyAmount,symbol:m.data.symbol??void 0,name:m.data.name??void 0,decimals:m.data.decimals,logoUri:m.data.logoUri??void 0},quoteId:f.rfqProps?.quoteId,quoteSource:Le(f).map(x=>x.name).join(",")},b=d.data.chain.id,T=o?.message||o?.type||"Unknown error";await Im({accessToken:c,userID:p,idempotencyKey:n,swapInfo:S,chainId:b,failureReason:T,skipNotification:!0,occurredAt:new Date().toISOString()}),k.addBreadcrumb(_.Cash,"Recorded failed cash swap",L.Info,{failureType:r,sellToken:d.data.symbol,buyToken:m.data.symbol})}catch(s){k.addBreadcrumb(_.Cash,"Failed to record failed cash swap",L.Error,s instanceof Error?{error:s.message}:{})}}};u();l();var Vl=class{static{i(this,"SocialExecuteSwapStateListener")}swapMode;queryClient;enableChatBadges;dismissChatBadgeSheet;constructor(e,r,o,n){this.swapMode=e,this.queryClient=r,this.enableChatBadges=o,this.dismissChatBadgeSheet=n}dismissBadgeSheet(){this.enableChatBadges&&this.dismissChatBadgeSheet()}onStateChange(e,r,o,n){if(e.type===Z.TransactionSubmissionStarted&&this.dismissBadgeSheet(),e.type===Z.TransactionConfirmed){let{buy:s,sell:c,quote:p,account:d}=o.executingQuote,m=s.data.chain.id,f=d.addresses.find(g=>g.networkID===m);if(f){let g=J(s),y=J(c),w=xe(p.buyAmount,s.data.decimals).toNumber(),S=xe(p.sellAmount,c.data.decimals).toNumber(),b=N({chainId:f.networkID,address:f.address,resourceType:V.address}),T=this.swapMode.type==="buy"?N(g):N(y),C=this.queryClient.getQueryData(cy.userProfile())?.id??"",E=this.queryClient.getQueryData(Zr.tokenChatBalance(T,C)),P=0;E&&(P=E.quantity>0?E.quantity/10**E.decimals:0);let M=["trades"];this.enableChatBadges&&M.push("badges"),ch({chatTokenId:T,transactionId:e.txReceipt.id,networkId:e.txReceipt.networkID,tokenBoughtCaip19:N(g),tokenBoughtAmount:w,tokenBoughtUsdValue:s.data.price?w*s.data.price:0,tokenSoldCaip19:N(y),tokenSoldAmount:S,tokenSoldUsdValue:c.data.price?S*c.data.price:0,walletCaip19:b,chatTokenBalance:P,system:{messages:M}})}}}};var $E=i(()=>{},"noop"),VE=i(t=>{let e=nt(),{connection:r}=Mo(),o=pt(),n=vo(),s=v.language,c=ue(),p=qe(),d=js(),m=jt(),f=Ro(),g=Po("kill-swapper-simulation")??!1,y=rt("enable-chat-badges"),{data:w}=ji();return(0,KE.useCallback)(async({showFungibleDetails:S,showBuyFungibleScreen:b=$E,showRetrySwap:T,swapMode:x,executeSwapStateListeners:C,toastMessageParser:E,uiContext:P="swapperInterstitial",preprocessor:M,dismissChatBadgeSheet:G=$E})=>{let R=new Gs(S,b,m,[Ie.SlippageExceeded],T,E),j=new qs(p,o,f),Q=new $l(p,o,f,w),F=new Os(d,c,P,t),B=new zs(c),W=new Qs,Y=new Us(Ko),ee=new Vl(x,p,y,G),X=new Kl(f);try{e.subscribeExecution(j),e.subscribeExecution(Q),e.subscribeExecution(B),e.subscribeExecution(F),e.subscribeExecution(R),e.subscribeExecution(W),e.subscribeExecution(Y),e.subscribeExecution(X),Dr&&e.subscribeExecution(ee),C.forEach(Ae=>e.subscribeExecution(Ae));let Ue=await c.getDeviceId();await e.swap({signer:n,storage:o,locale:s,deviceId:Ue,connection:r,authRepository:f,isSimulationKilled:g,preprocessor:M})}catch{}finally{e.unsubscribeExecution(j),e.unsubscribeExecution(Q),e.unsubscribeExecution(B),e.unsubscribeExecution(F),e.unsubscribeExecution(R),e.unsubscribeExecution(W),e.unsubscribeExecution(Y),e.unsubscribeExecution(X),e.unsubscribeExecution(ee),C.forEach(Ue=>e.unsubscribeExecution(Ue))}},[m,p,d,c,e,n,o,s,r,f,g,t,y,w])},"useExecuteSwapTokenSwap");u();l();var uh=class{static{i(this,"SwapTokenOnSelectResultStrategy")}getNavigationParams({initiatingSwapMode:e,selectedToken:r,initialSwapAmount:o,swapper:n}){let s=n.getTokenState();if(!ht(s))return{swapMode:e,initialSwapAmount:o};if(e.type!=="buy"&&e.type!=="sell")return{swapMode:e,initialSwapAmount:o};let c=De(r),p=n.checkChainAddress({chain:r.data.chain,walletAddress:void 0}),d=c?N(yc(r)):N({chainId:p.networkID,address:p.address,resourceType:V.address});return{swapMode:{type:e.type,buyCaip19:e.type==="buy"?e.buyCaip19:N(J(r)),sellCaip19:e.type==="sell"?e.sellCaip19:N(J(r)),takerCaip19:e.type==="buy"?d:s.takerCaip19,takerDestinationCaip19:e.type==="sell"?d:s.takerDestinationCaip19,sellFungibleKey:e.type==="buy"?r.data.key:s.sellToken.data.key,buyFungibleKey:e.type==="sell"?r.data.key:s.buyToken.data.key},initialSwapAmount:o}}captureAnalytics(e,r,o){new Ds(e).swapperUpdateAsset(o,r)}},lh=class{static{i(this,"SwapModalSelectStrategy")}selectToken({swapper:e,selectedToken:r,currentTokens:o,perspective:n,cashAddresses:s,dismiss:c}){WE.selectToken({swapper:e,selectedToken:r,currentTokens:o,perspective:n,navigateToSwapper:i(({sellFungible:p})=>{if(!p)return;let d=e.checkChainAddress({chain:r.data.chain,walletAddress:void 0}),m=De(r)?N(yc(r)):N({chainId:d.networkID,address:d.address,resourceType:V.address}),f={type:"swap",network:p.data.chain.id,sellCaip19:N(J(p)),buyCaip19:void 0,takerCaip19:m,takerDestinationCaip19:void 0};e.initializeSwap({swapMode:f,cashAddresses:s,settings:{}}),c()},"navigateToSwapper"),dismiss:i(()=>c(),"dismiss")})}},ph=class{static{i(this,"ClassicOnSelectResultStrategy")}selectToken({swapper:e,selectedToken:r,currentTokens:o,perspective:n,navigateToSwapper:s,dismiss:c}){let p=n==="sell"?o.buyCaip19:o.sellCaip19;if(this.isSameSelectedToken(p,r))return this.handleTokenSwitch(e,c);if(this.shouldNavigateToNewChain(n,o.sellCaip19,r,e.getTokenState()))return s({sellFungible:r});let d=De(r),m=e.checkChainAddress({chain:r.data.chain,walletAddress:void 0}),f=d?N(yc(r)):N({chainId:m.networkID,address:m.address,resourceType:V.address});e.changeToken(r,n,f),c()}shouldNavigateToNewChain(e,r,o,n){let c=Ve(r).chainId!==o.data.chain.id;return c&&LL(n)||c&&De(o)?!0:c&&e==="sell"}handleTokenSwitch(e,r){e.switchTokens(),r()}isSameSelectedToken(e,r){let o=N(J(r));return e!==o?!1:!De(r)}},LL=i(t=>ht(t)?De(t.sellToken)||De(t.buyToken):!1,"isCashAccountInTokenState"),ML=new uh,WE=new ph,cke=new lh;u();l();var Wl=class{static{i(this,"AssetSelectAnalytics")}analytics;additionalAnalyticsTags;constructor(e,r){this.analytics=e,this.additionalAnalyticsTags=r}captureEvent(e,r){let o={...r,data:{...r.data,...this.additionalAnalyticsTags}};this.analytics.capture(e,o)}assetSelectionClosed(e){this.captureEvent("swapperAssetSelectionClosed",{data:e})}assetInfoPressed(e,r){this.captureEvent("swapperAssetInfoPressed",{data:{...wo(e),type:r}})}assetFilterChanged(e,r){this.captureEvent("swapperAssetFilterChanged",{data:{filterId:e,type:r}})}assetSearchQueryChanged(e,r){this.captureEvent("swapperAssetSearchQueryChanged",{data:{searchQuery:e,type:r}})}},UL=tc(ue,t=>new Wl(t));u();l();var Zl=D(O());var OL=i(()=>{let{data:t}=Rt({key:Pe.LastSelectedTokens,queryKey:me.lastSelectedTokens()}),e=(0,Zl.useMemo)(()=>t?JSON.parse(t):{},[t]),{mutateAsync:r}=Dt({key:Pe.LastSelectedTokens,queryKey:me.lastSelectedTokens()}),o=(0,Zl.useCallback)(async n=>{let s={...e,[n]:!0};await r(JSON.stringify(s))},[e,r]);return{lastSelectedTokens:e,storeSelectedToken:o}},"useLastSelectedTokens");u();l();var QC=D(Ke());var Co=D(O());u();l();u();l();var xt=a.string().regex(/^\d*\.?\d+([eE][+-]?\d+)?$/,"Invalid numeric string"),Yl=a.string().regex(/^-?\d*\.?\d+([eE][+-]?\d+)?$/,"Invalid signed numeric string"),ZE=a.object({accountValue:Yl,totalMarginUsed:xt,totalNtlPos:xt,totalRawUsd:Yl}),aFe=a.object({marginSummary:ZE,withdrawable:xt,assetPositions:a.array(a.any()).optional(),crossMaintenanceMarginUsed:xt.optional(),crossMarginSummary:ZE.optional(),guaranteedUntil:a.number().optional(),isAccountSolvent:a.boolean().optional(),pendingCashAdjusts:a.array(a.any()).optional(),totalCrossCollateral:xt.optional(),totalIsolatedCollateral:xt.optional(),totalMaintenanceMarginUsed:xt.optional()}),YE=a.object({coin:a.string(),side:a.enum(["B","A"]),limitPx:xt,sz:xt,oid:a.number(),timestamp:a.number(),origSz:xt,cloid:a.string().optional()}),cFe=a.array(YE),qL=a.object({position:YE,status:a.string(),statusTimestamp:a.number()}),uFe=a.array(qL),zL=a.object({status:a.literal("ok"),response:a.object({type:a.string()}).optional()}),XE=a.object({error:a.string()}),lFe=a.union([zL,XE]),QL=a.enum(["withdraw","deposit"]),HL=a.object({id:a.string(),type:QL,timestamp:a.string(),delta:a.object({usdAmount:Yl,token:a.object({caip19:a.string(),symbol:a.string(),image:a.string(),amount:Yl})})}),pFe=a.array(HL),GL=a.object({resting:a.object({oid:a.number()})}),jL=a.object({filled:a.object({totalSz:xt,avgPx:xt,oid:a.number()})}),$L=a.object({error:a.string()}),KL=a.union([GL,jL,$L]),VL=a.object({status:a.literal("ok"),response:a.object({type:a.literal("order"),data:a.object({statuses:a.array(KL)})})}),dFe=a.union([VL,XE]),JE=a.array(a.object({t:a.number(),T:a.number(),s:a.string(),i:a.string(),o:xt,h:xt,l:xt,c:xt,v:xt,n:a.number()}));u();l();var WL=a.object({accountValue:We,availableBalance:We,availableToTrade:We}),ZL=a.object({tokenIndex:a.number(),pairIndex:a.number().optional(),symbol:a.string(),total:We,hold:We}),eC=a.object({accountValue:We,availableBalance:We,availableToTrade:We,dexAbstraction:a.boolean().optional(),dexs:a.record(a.string(),WL).optional(),collateralBalances:a.array(ZL).optional()});u();l();var YL=a.enum(["withdrawal","deposit","reward"]),XL=a.object({id:a.string(),type:YL,timestamp:a.number(),usdcAmount:yt}),tC=a.object({depositAndWithdrawals:a.array(a.any()).transform(t=>t.reduce((e,r)=>{let o=XL.safeParse(r);return o.success&&e.push(o.data),e},[]))});u();l();var PFe=a.enum(["success","failed"]),_Fe=a.enum(["close","liquidation","take_profit","stop_loss"]),vFe=a.literal("open"),rC=a.object({id:a.string(),market:a.object({token:ti,logoUri:a.string(),szDecimals:a.number().optional()}),type:a.string(),timestamp:a.number(),price:We,size:yt,tradeValue:We,fee:yt,closedPnl:a.optional(yt)}),oC=a.object({tradeHistory:a.array(rC).transform(t=>t.reduce((e,r)=>{let o=rC.safeParse(r);return o.success&&e.push(o.data),e},[]))});u();l();var sC=a.enum(["long","short"]),Xl=a.object({direction:sC,leverage:We,size:yt,margin:We,entryPrice:We,fundingPayments:yt,market:a.object({token:ti,logoUri:a.string()}),value:We,unrealizedPnl:a.object({amount:yt,percentage:yt}),liquidationPrice:yt}),iC=a.object({positions:a.array(Xl).transform(t=>t.reduce((e,r)=>{let o=Xl.safeParse(r);return o.success&&e.push(o.data),e},[]))}),nC=a.object({id:a.string(),market:a.object({token:ti,logoUri:a.string()}),isTrigger:a.boolean(),direction:sC,type:a.enum(["take_profit_market","stop_market","limit"]),reduceOnly:a.boolean(),triggerPrice:We,limitPrice:We,timestamp:We,size:yt}),aC=a.object({positions:a.array(Xl).transform(t=>t.reduce((e,r)=>{let o=Xl.safeParse(r);return o.success&&e.push(o.data),e},[])),openOrders:a.array(nC).transform(t=>t.reduce((e,r)=>{let o=nC.safeParse(r);return o.success&&e.push(o.data),e},[]))});u();l();function Je(t,e){return t+Math.random()*e}i(Je,"getRetryDelayWithJitter");u();l();var JL=a.object({address:a.string(),registered:a.boolean()}),eM=a.object({code:a.string(),registered:a.boolean()}).optional(),cC=a.object({providerFee:a.string(),phantomFee:a.string(),referral:eM.optional(),builder:JL.optional()});u();l();var uC=a.object({depositAddress:a.object({address:a.string()}),requestId:a.string()}),tM=a.object({destinationAmount:a.string().optional(),sourceTxHash:a.string().optional(),state:a.enum(["done","sourceTxDiscovered","waitForSrcTxFinalization","buildingDstTx","signTx","broadcastTx","waitForDstTxFinalization","readyForWithdrawQueue","queuedForWithdraw","failure","additionalChecks"]),opCreatedAt:a.string().optional(),operationId:a.string().optional(),protocolAddress:a.string().optional(),sourceAddress:a.string().optional(),destinationAddress:a.string().optional(),sourceChain:a.string().optional(),destinationChain:a.string().optional(),sourceAmount:a.string().optional(),destinationFeeAmount:a.string().optional(),sweepFeeAmount:a.string().optional(),stateStartedAt:a.string().optional(),stateUpdatedAt:a.string().optional(),stateNextAttemptAt:a.string().optional(),destinationTxHash:a.string().optional(),asset:a.string().optional()}),lC=a.object({usdcPrice:a.string(),orderAssetId:a.number(),operations:a.array(tM)}),pC=a.discriminatedUnion("status",[a.object({status:a.literal("ok"),response:a.object({type:a.string()})}),a.object({status:a.literal("err"),response:a.string()})]),dC=a.discriminatedUnion("status",[a.object({status:a.literal("ok"),response:a.object({type:a.string()})}),a.object({status:a.literal("err"),response:a.string()})]),mC=a.object({status:a.enum(["ok","err"])}),fC=a.object({name:a.string(),midPx:a.string()}),rM=a.object({unixTime:a.number(),value:a.string(),open:a.string(),high:a.string(),low:a.string(),close:a.string(),volume:a.string()}),YFe=a.object({history:a.array(rM)}),hC=a.object({role:a.enum(["missing","user"])}),gC=a.object({fundingCaip19Address:Ii,spotAssetId:a.number(),spotTokenId:a.string(),spotTokenName:a.string(),spotSzDecimals:a.number(),eta:a.string(),fee:a.string(),minimumAmount:a.string()}),yC=a.object({tokens:a.array(kt)}),gr;(function(t){t.Hyperunit="hyperunit",t.Relay="relay"})(gr||(gr={}));var wC=a.object({providers:a.array(a.object({name:a.nativeEnum(gr),max:a.number(),initializingCaip19Address:a.optional(Ii)}))});var Jl=class{static{i(this,"PerpsClient")}async getSpotBridgeInitialize(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/bridge-initialize",{params:{...e,bridgeProvider:ey(e.bridgeProvider.toString())}}),o=uC.safeParse(r.data);if(!o.success)throw new Error(`Failed to parse spot bridge initialize response: ${o.error}`);return o.data}async getOperations(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/bridge-operations",{params:e}),o=lC.safeParse(r.data);if(!o.success)throw new Error(`Failed to parse operations response: ${o.error}`);return o.data}async getAccountBalance(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/balance",{params:{user:N(e)}});if(!te(r))throw new Error("Failed to get account balance: response is not okay");let o=r.data,n=eC.safeParse(o);if(!n.success)throw new Error("Failed to get account balance: schema validation failed");return n.data}async getUserFundingHistory(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/deposits-and-withdrawals",{params:{user:N(e)}});if(!te(r))throw new Error("Failed to get deposits and withdrawals: response is not okay");let o=r.data,n=tC.safeParse(o);if(!n.success)throw new Error("Failed to get deposits and withdrawals: schema validation failed");return n.data.depositAndWithdrawals}async getPositions(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/positions",{params:{user:N(e)}});if(!te(r))throw new Error("Failed to get positions: response is not okay");let o=r.data,n=iC.safeParse(o);if(!n.success)throw new Error("Failed to get positions: schema validation failed");return n.data.positions}async getPositionsAndOpenOrders(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/positions-and-open-orders",{params:{user:N(e)}});if(!te(r))throw new Error("Failed to get positions: response is not okay");let o=r.data,n=aC.safeParse(o);if(!n.success)throw new Error("Failed to get positions: schema validation failed");return n.data}async getHistoricalOrders(e,r){let o={user:N(e)};r&&r.length>0&&(o.markets=r.join(","));let n=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/trade-history",{params:o});if(!te(n))throw new Error("Failed to get historical orders: response is not okay");let s=n.data,c=oC.safeParse(s);if(!c.success)throw new Error("Failed to get historical orders: schema validation failed");return c.data.tradeHistory}async postSpotSend(e){let r=await z.api().retry(1,Je(1e3,1e3)).post("/swap/v2/spot/send",e);if(!te(r))throw new Error("Failed to post spot send: response is not okay");let o=r.data,n=pC.safeParse(o);if(!n.success)throw new Error("Failed to post spot send: schema validation failed");return n.data}async postPerpsSend(e){let r=await z.api().retry(1,Je(1e3,1e3)).post("/swap/v2/perps/send",e);if(!te(r))throw new Error("Failed to post perps send: response is not okay");let o=r.data,n=dC.safeParse(o);if(!n.success)throw new Error("Failed to post perps send: schema validation failed");return n.data}async postTransferUsdcSpotPerp(e){let r=await z.api().retry(1,Je(1e3,1e3)).post("/swap/v2/transfer-usdc-spot-perp",e);if(!te(r))throw new Error("Failed to post spot send: response is not okay");let o=r.data,n=mC.safeParse(o);if(!n.success)throw new Error("Failed to post spot send: schema validation failed");return n.data}async getTokenDetails(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/token-details",{params:{tokenId:e.tokenId,type:"tokenDetails"}});if(!te(r))throw new Error("Failed to get token info: response is not okay");let o=r.data,n=fC.safeParse(o);if(!n.success)throw new Error("Failed to get token info: schema validation failed");return n.data}async getUserRole(e){let r=await fetch("https://api.hyperliquid.xyz/info",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({type:"userRole",user:e})});if(!r.ok)throw new Error("Failed to get token info");let o=await r.json(),n=hC.safeParse(o);if(!n.success)throw new Error("Failed to get user role: schema validation failed");return n.data}async postFunding(e){let r=await z.api().retry(1,Je(1e3,1e3)).post("/swap/v2/spot/funding",e);if(!te(r))throw new Error("Failed to get funding");let o=r.data,n=gC.safeParse(o);if(!n.success)throw new Error("Failed to post funding: schema validation failed");return n.data}async getPriceHistory(e){let r={coin:e.coin,interval:e.interval,startTime:e.startTime.toString(),endTime:e.endTime.toString()};e.isTestnet&&(r.isTestnet="true");let o=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/candles",{params:r});if(!te(o))throw new Error("Failed to get price history: response is not okay");let n=o.data,s=JE.safeParse(n);if(!s.success)throw new Error("Failed to get price history: schema validation failed");return s.data}async getSpotBalances(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/balances",{params:e});if(!te(r))throw new Error("Failed to get spot balances: response is not okay");return r.data}async getPositionFees(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/fees",{params:{user:N(e)}});if(!te(r))throw new Error("Failed to get position fees: response is not okay");let o=r.data,n=cC.safeParse(o);if(!n.success)throw new Error("Failed to get position fees: schema validation failed");return n.data}async getBridgeableTokens(e){if(!e)throw new Error("No addresses provided to get bridgeable tokens");let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/bridgeable-tokens",{params:{addresses:e.join(",")}});if(!te(r))throw new Error("Failed to get bridgeable tokens: response is not okay");let o=r.data,n=yC.safeParse(o);if(!n.success)throw new Error("Failed to get bridgeable tokens: schema validation failed");return n.data}async getPreferredBridges(){let e=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/preferred-bridges");if(!te(e))throw new Error("Failed to get preferred bridge: response is not okay");let r=e.data,o=wC.safeParse(r);if(!o.success)throw new Error("Failed to get preferred bridge: schema validation failed");return o.data}};u();l();u();l();var st=[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}];var ep=[{name:"hyperliquidChain",type:"string"},{name:"maxFeeRate",type:"string"},{name:"builder",type:"address"},{name:"nonce",type:"uint64"}],nr=[{name:"source",type:"string"},{name:"connectionId",type:"bytes32"}];u();l();var oM=a.object({totalSz:a.string(),avgPx:a.string(),oid:a.number()}),nM=a.object({oid:a.number()}),sM=a.union([a.object({error:a.string()}),a.object({filled:oM}),a.literal("success"),a.object({resting:nM})]),iM=a.object({status:a.literal("ok"),response:a.object({type:a.string(),data:a.object({statuses:a.array(sM)}).optional()})}),aM=a.union([a.object({status:a.literal("err"),response:a.string()}),iM]),APe=a.object({action:a.any(),nonce:a.number(),signature:a.object({r:a.string(),s:a.string(),v:a.number()}),isTestnet:a.boolean().optional()});var Rn=class{static{i(this,"HyperliquidExchange")}async postExchange(e){return await k.startSpan("hyperliquid.exchange.post",async()=>{let o=(await z.api().post("/swap/v2/exchange",e)).data,n=aM.safeParse(o);if(!n.success)throw new Error(`Invalid exchange response: ${n.error.message}`);return n.data})}};u();l();function dh(t){return t.map(e=>({time:e.t/1e3,open:Number(e.o),high:Number(e.h),low:Number(e.l),close:Number(e.c),volume:Number(e.v)}))}i(dh,"mapRawCandleSnapshotToCandleSnapshot");u();l();var tp=class{static{i(this,"AccountBalanceStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingAccountBalanceStart":switch(this.state.type){case"accountBalance":return{type:"refreshing",accountBalance:this.state.accountBalance};case"refreshing":return{type:"refreshing",accountBalance:this.state.accountBalance};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let r=this.state;throw new Error(`Invalid state ${r.type} for fetchingAccountBalanceStart`)}}case"fetchingAccountBalanceSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"accountBalance",accountBalance:e.accountBalance};default:throw new Error(`Invalid state ${this.state.type} for fetchingAccountBalanceSuccess`)}case"fetchingAccountBalanceError":return{type:"error",error:e.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onAccountBalanceStateChange(this.state)})}};u();l();var rp=class{static{i(this,"FundingHistoryStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingFundingHistoryStart":switch(this.state.type){case"history":return{type:"refreshing",history:this.state.history};case"refreshing":return{type:"refreshing",history:this.state.history};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistoryStart`)}case"fetchingFundingHistorySuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"history",history:e.history};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistorySuccess`)}case"fetchingFundingHistoryError":switch(this.state.type){case"history":case"refreshing":return{type:"history",history:this.state.history};default:return{type:"error",error:e.error}}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onFundingHistoryStateChange(this.state)})}};u();l();var op=class{static{i(this,"HistoricalOrdersStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingHistoricalOrdersStart":switch(this.state.type){case"historicalOrders":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"refreshing":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersStart`)}case"fetchingHistoricalOrdersSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"historicalOrders",historicalOrders:e.historicalOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersSuccess`)}case"fetchingHistoricalOrdersError":return{type:"error",error:e.error}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onHistoricalOrdersStateChange(this.state)})}};u();l();var np=class{static{i(this,"PositionsStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingPositionsStart":switch(this.state.type){case"positions":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"refreshing":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let r=this.state;throw new Error(`Invalid state ${r.type} for fetchingPositionsStart`)}}case"fetchingPositionsSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"positions",positions:e.positions,openOrders:e.openOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionsSuccess`)}case"fetchingPositionsError":return{type:"error",error:e.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onPositionStateChange(this.state)})}};u();l();u();l();u();l();u();l();u();l();u();l();function SC(t){let e=t.length,r=0,o=0;for(;o<e;){let n=t.charCodeAt(o++);if(n&4294967168)if(!(n&4294965248))r+=2;else{if(n>=55296&&n<=56319&&o<e){let s=t.charCodeAt(o);(s&64512)===56320&&(++o,n=((n&1023)<<10)+(s&1023)+65536)}n&4294901760?r+=4:r+=3}else{r++;continue}}return r}i(SC,"utf8Count");function cM(t,e,r){let o=t.length,n=r,s=0;for(;s<o;){let c=t.charCodeAt(s++);if(c&4294967168)if(!(c&4294965248))e[n++]=c>>6&31|192;else{if(c>=55296&&c<=56319&&s<o){let p=t.charCodeAt(s);(p&64512)===56320&&(++s,c=((c&1023)<<10)+(p&1023)+65536)}c&4294901760?(e[n++]=c>>18&7|240,e[n++]=c>>12&63|128,e[n++]=c>>6&63|128):(e[n++]=c>>12&15|224,e[n++]=c>>6&63|128)}else{e[n++]=c;continue}e[n++]=c&63|128}}i(cM,"utf8EncodeJs");var uM=new TextEncoder,lM=50;function pM(t,e,r){uM.encodeInto(t,e.subarray(r))}i(pM,"utf8EncodeTE");function bC(t,e,r){t.length>lM?pM(t,e,r):cM(t,e,r)}i(bC,"utf8Encode");var KPe=new TextDecoder;u();l();u();l();var Dn=class{static{i(this,"ExtData")}constructor(e,r){this.type=e,this.data=r}};u();l();u();l();var sp=class t extends Error{static{i(this,"DecodeError")}constructor(e){super(e);let r=Object.create(t.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};u();l();function TC(t,e,r){let o=r/4294967296,n=r;t.setUint32(e,o),t.setUint32(e+4,n)}i(TC,"setUint64");function ip(t,e,r){let o=Math.floor(r/4294967296),n=r;t.setUint32(e,o),t.setUint32(e+4,n)}i(ip,"setInt64");function AC(t,e){let r=t.getInt32(e),o=t.getUint32(e+4);return r*4294967296+o}i(AC,"getInt64");var dM=-1,mM=4294967296-1,fM=17179869184-1;function hM({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=fM)if(e===0&&t<=mM){let r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{let r=t/4294967296,o=t&4294967295,n=new Uint8Array(8),s=new DataView(n.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,o),n}else{let r=new Uint8Array(12),o=new DataView(r.buffer);return o.setUint32(0,e),ip(o,4,t),r}}i(hM,"encodeTimeSpecToTimestamp");function gM(t){let e=t.getTime(),r=Math.floor(e/1e3),o=(e-r*1e3)*1e6,n=Math.floor(o/1e9);return{sec:r+n,nsec:o-n*1e9}}i(gM,"encodeDateToTimeSpec");function yM(t){if(t instanceof Date){let e=gM(t);return hM(e)}else return null}i(yM,"encodeTimestampExtension");function wM(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{let r=e.getUint32(0),o=e.getUint32(4),n=(r&3)*4294967296+o,s=r>>>2;return{sec:n,nsec:s}}case 12:{let r=AC(e,4),o=e.getUint32(0);return{sec:r,nsec:o}}default:throw new sp(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}i(wM,"decodeTimestampToTimeSpec");function SM(t){let e=wM(t);return new Date(e.sec*1e3+e.nsec/1e6)}i(SM,"decodeTimestampExtension");var xC={type:dM,encode:yM,decode:SM};var ii=class{static{i(this,"ExtensionCodec")}constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(xC)}register({type:e,encode:r,decode:o}){if(e>=0)this.encoders[e]=r,this.decoders[e]=o;else{let n=-1-e;this.builtInEncoders[n]=r,this.builtInDecoders[n]=o}}tryToEncode(e,r){for(let o=0;o<this.builtInEncoders.length;o++){let n=this.builtInEncoders[o];if(n!=null){let s=n(e,r);if(s!=null){let c=-1-o;return new Dn(c,s)}}}for(let o=0;o<this.encoders.length;o++){let n=this.encoders[o];if(n!=null){let s=n(e,r);if(s!=null){let c=o;return new Dn(c,s)}}}return e instanceof Dn?e:null}decode(e,r,o){let n=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return n?n(e,r,o):new Dn(r,e)}};ii.defaultCodec=new ii;u();l();function bM(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}i(bM,"isArrayBufferLike");function EC(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):bM(t)?new Uint8Array(t):Uint8Array.from(t)}i(EC,"ensureUint8Array");var TM=100,AM=2048,ap=class t{static{i(this,"Encoder")}constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??ii.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??TM,this.initialBufferSize=e?.initialBufferSize??AM,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){let r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){let r=new ArrayBuffer(e),o=new Uint8Array(r),n=new DataView(r);o.set(this.bytes),this.view=n,this.bytes=o}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){let o=SC(e);this.ensureBufferSizeToWrite(5+o),this.writeStringHeader(o),bC(e,this.bytes,this.pos),this.pos+=o}encodeObject(e,r){let o=this.extensionCodec.tryToEncode(e,this.context);if(o!=null)this.encodeExtension(o);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);let o=EC(e);this.writeU8a(o)}encodeArray(e,r){let o=e.length;if(o<16)this.writeU8(144+o);else if(o<65536)this.writeU8(220),this.writeU16(o);else if(o<4294967296)this.writeU8(221),this.writeU32(o);else throw new Error(`Too large array: ${o}`);for(let n of e)this.doEncode(n,r+1)}countWithoutUndefined(e,r){let o=0;for(let n of r)e[n]!==void 0&&o++;return o}encodeMap(e,r){let o=Object.keys(e);this.sortKeys&&o.sort();let n=this.ignoreUndefined?this.countWithoutUndefined(e,o):o.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(let s of o){let c=e[s];this.ignoreUndefined&&c===void 0||(this.encodeString(s),this.doEncode(c,r+1))}}encodeExtension(e){if(typeof e.data=="function"){let o=e.data(this.pos+6),n=o.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(o);return}let r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),TC(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),ip(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function kr(t,e){return new ap(e).encodeSharedRef(t)}i(kr,"encode");var CC=D(Ei());var cp=class{static{i(this,"UpdateIsolatedMarginAction")}type="updateIsolatedMargin";asset;isBuy;ntli;constructor(e){this.asset=e.asset,this.isBuy=e.isBuy,this.ntli=e.ntli}hash(e,r){let o=kr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(xM(e),o.length+9)),`0x${(0,CC.keccak256)(s)}`}};function xM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(xM,"addressToBytes");u();l();function mh(t){switch(t.type){case"preparingTransaction":case"managingMargin":case"manageMarginSucceeded":return IC(t);case"manageMarginFailed":return{...IC(t),error:t.error instanceof Error?t.error.message:"Unknown error"};case"indeterminate":default:return{state:t.type}}}i(mh,"getManageMarginStateLogsDetails");var IC=i(t=>t.type==="indeterminate"?{state:t.type}:{marketSymbol:t.market.symbol,assetId:t.market.assetId.toString(),positionDirection:t.position.direction,positionSize:t.position.size.toString(),currentMargin:t.position.margin.toString(),marginDelta:t.marginDelta.toString(),marginAction:t.marginDelta.isPositive()?"increase":"decrease",newMargin:new A(t.position.margin).plus(t.marginDelta).toString(),fee:t.fee?.toString()||"N/A"},"getBaseLogsDetails");u();l();var up=class{static{i(this,"ManageMarginStateMachine")}listeners=[];state={type:"indeterminate"};getState(){return this.state}send(e){try{let r=this.determineNextState(this.state,e);this.state=r,this.notifyListeners(e)}catch(r){console.error("Error processing event in ManageMarginStateMachine:",e,r)}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}determineNextState(e,r){switch(r.type){case"InitiateManageMargin":{let{position:o,market:n,marginDelta:s,fee:c}=r.payload;return{type:"preparingTransaction",...{position:o,market:n,marginDelta:s,fee:c}}}case"ManageMarginInitiated":{if(e.type==="preparingTransaction")return{type:"managingMargin",position:e.position,market:e.market,marginDelta:e.marginDelta,fee:e.fee};break}case"ManageMarginSuccess":{if(e.type==="managingMargin")return{type:"manageMarginSucceeded",position:e.position,market:e.market,marginDelta:e.marginDelta,fee:e.fee};break}case"ManageMarginFailure":{if(e.type==="managingMargin")return{type:"manageMarginFailed",position:e.position,market:e.market,marginDelta:e.marginDelta,fee:e.fee,error:r.error};break}case"Reset":return{type:"indeterminate"}}return e}notifyListeners(e){this.listeners.forEach(r=>{r.onManageMarginStateChange(e,this.state)})}};var EM=6,lp=class{static{i(this,"ManageMarginOrchestrator")}stateMachine=new up;perps;constructor(e){this.perps=e,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManageMarginStateChange:i((e,r)=>{this.handleStateChange(e,r)},"onManageMarginStateChange")};stateLogsListener={onManageMarginStateChange:i((e,r)=>{switch(r.type){case"manageMarginSucceeded":k.addBreadcrumb(_.Perps,`Manage margin succeeded: ${r.type}`,L.Info,mh(r));break;case"manageMarginFailed":k.addBreadcrumb(_.Perps,`Manage margin failed: ${r.type}`,L.Error,mh(r));break;default:k.addBreadcrumb(_.Perps,`Manage margin state change: ${e.type} -> ${r.type}`,L.Info);break}(r.type==="manageMarginSucceeded"||r.type==="manageMarginFailed")&&this.stateMachine.removeListener(this.stateLogsListener)},"onManageMarginStateChange")};async handleStateChange(e,r){switch(e.type){case"InitiateManageMargin":this.stateMachine.send({type:"ManageMarginInitiated"});break;case"ManageMarginInitiated":r.type==="managingMargin"&&await this.manageMargin(r);break}}async manageMargin(e){try{let{position:r,market:o,marginDelta:n}=e,s=n.multipliedBy(new A(10).pow(EM)).toNumber(),c=new cp({asset:o.assetId,isBuy:r.direction==="long",ntli:s}),p=Date.now(),d={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:st,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:c.hash(null,p)}},m=await this.perps.exchangeAction(c,d,p),f=m.response.data?.statuses?.find(y=>typeof y=="object"&&"error"in y);if(f&&typeof f=="object"&&"error"in f)throw new Error(f.error);let g=JSON.stringify(m.response.data?.statuses||"unknown");this.stateMachine.send({type:"ManageMarginSuccess",payload:g})}catch(r){this.stateMachine.send({type:"ManageMarginFailure",error:r})}}getState(){return this.stateMachine.getState()}send(e){this.stateMachine.send(e)}addListener(e){return this.stateMachine.addListener(e),()=>this.stateMachine.removeListener(e)}removeListener(e){this.stateMachine.removeListener(e)}};u();l();u();l();var kC=D(Ei());var Eo=class{static{i(this,"OrderAction")}type="order";orders;grouping;builder;constructor(e,r){this.orders=e,this.grouping="na",r&&(this.builder=r)}hash(e,r){let o=kr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(CM(e),o.length+9)),`0x${(0,kC.keccak256)(s)}`}};function CM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(CM,"addressToBytes");var pp=class{static{i(this,"SpotSendAction")}hyperliquidChain;signatureChainId;amount;destination;time;token;type="spotSend";constructor(e){this.hyperliquidChain=e.hyperliquidChain,this.signatureChainId=e.signatureChainId,this.token=e.token,this.amount=e.amount,this.destination=e.destination,this.time=e.time}},dp=class{static{i(this,"PerpsSendAction")}hyperliquidChain;signatureChainId;amount;destination;time;type="usdSend";constructor(e){this.hyperliquidChain=e.hyperliquidChain,this.signatureChainId=e.signatureChainId,this.amount=e.amount,this.destination=e.destination,this.time=e.time}};u();l();var FC=D(Ei());var ai=class{static{i(this,"ApproveReferralAction")}type="setReferrer";code;constructor(e){this.code=e.code}hash(e,r){let o=kr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(IM(e),o.length+9)),`0x${(0,FC.keccak256)(s)}`}};function IM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(IM,"addressToBytes");u();l();var sr=class{static{i(this,"OrderBuilder")}_order={};asset(e){return this._order.a=e,this}isBuy(e){return this._order.b=e,this}buy(){return this.isBuy(!0)}sell(){return this.isBuy(!1)}price(e){return this._order.p=e.toString(),this}size(e){return this._order.s=e.toString(),this}reduceOnly(e){return this._order.r=e,this}clientOrderId(e){return this._order.c=e,this}limitOrder(e="Gtc"){return this._order.t={limit:{tif:e}},this}postOnly(){return this.limitOrder("Alo")}immediateOrCancel(){return this.limitOrder("Ioc")}triggerOrder(e,r=!0,o="sl"){return this._order.t={trigger:{isMarket:r,triggerPx:e.toString(),tpsl:o}},this}stopLoss(e,r=!0){return this.triggerOrder(e,r,"sl")}takeProfit(e,r=!0){return this.triggerOrder(e,r,"tp")}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.b===void 0)throw new Error("Buy/sell direction is required");if(this._order.p===void 0)throw new Error("Price is required");if(this._order.s===void 0)throw new Error("Size is required");if(this._order.t===void 0)throw new Error("Order type is required");return this._order.r===void 0&&(this._order.r=!1),this._order}};u();l();function ir(t,e,r=!0,o=A.ROUND_HALF_UP){let n=new A(t);if(n.isInteger())return n.toString();let s=kM(e,r);return n.precision(5,o).toFixed(s,o).replace(/\.?0+$/,"")}i(ir,"formatPrice");function kM(t,e=!0){return Math.max((e?6:8)-t,0)}i(kM,"maxAllowedDecimalsInPrice");u();l();function mp(t,e,r=A.ROUND_HALF_UP){return new A(t).toFixed(e,r).replace(/(\.\d*?)0+$/,"$1").replace(/\.$/,"")}i(mp,"formatSize");u();l();var fp=class{static{i(this,"CancelOrderBuilder")}_order={};asset(e){return this._order.a=e,this}orderId(e){return this._order.o=e,this}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.o===void 0)throw new Error("Order ID is required");return this._order}};u();l();var PC=D(Ei());var hp=class{static{i(this,"CancelOrderAction")}type="cancel";cancels;constructor(e){this.cancels=e}hash(e,r){let o=kr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(FM(e),o.length+9)),`0x${(0,PC.keccak256)(s)}`}};function FM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(FM,"addressToBytes");u();l();function fh(t){switch(t.type){case"preparingTransaction":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"managingPosition":case"managePositionSucceeded":return _C(t);case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":return{..._C(t),error:t.error instanceof Error?t.error.message:"Unknown error"};case"indeterminate":default:return{state:t.type}}}i(fh,"getManagePositionStateLogsDetails");var _C=i(t=>t.type==="indeterminate"?{state:t.type}:{marketSymbols:t.markets.map(e=>e.symbol).join(", "),assetIds:t.markets.map(e=>e.assetId.toString()).join(", "),positionDirections:t.positions.map(e=>e.direction).join(", "),positionSizes:t.positions.map(e=>e.size.toString()).join(", "),updateType:t.update.type,fees:t.fees.map(e=>e.toString()).join(", "),...t.update.type==="close"&&{closeSize:t.update.size.toString()},...t.update.type==="addAutoClose"&&{tpTriggerPrice:t.update.autoClose.tp?.triggerPrice.toString()||"N/A",slTriggerPrice:t.update.autoClose.sl?.triggerPrice.toString()||"N/A"},...t.update.type==="removeAutoClose"&&{tpOrderId:t.update.autoClose.tp?.orderId?.toString()||"N/A",slOrderId:t.update.autoClose.sl?.orderId?.toString()||"N/A"}},"getBaseLogsDetails");u();l();var gp=class{static{i(this,"ManagePositionStateMachine")}listeners=[];state={type:"indeterminate"};getState(){return this.state}send(e){try{let r=this.determineNextState(this.state,e);this.state=r,this.notifyListeners(e)}catch(r){console.error("Error processing event in ManagePositionStateMachine:",e,r)}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}determineNextState(e,r){switch(r.type){case"InitiateManagePosition":{let{positions:o,update:n,markets:s,fees:c,autoClose:p}=r.payload;return{type:"preparingTransaction",...{positions:o,update:n,markets:s,fees:c,autoClose:p}}}case"RegisterBuilderCodeInitiated":{if(e.type==="preparingTransaction")return{type:"registeringBuilder",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(e.type==="registeringBuilder")return{type:"builderRegistered",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterBuilderCodeFailure":{if(e.type==="registeringBuilder")return{type:"builderRegistrationFailed",positions:e.positions,update:e.update,error:r.error,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterReferralInitiated":{if(e.type==="builderRegistered")return{type:"registeringReferral",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(e.type==="registeringReferral")return{type:"referralRegistered",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterReferralFailure":{if(e.type==="registeringReferral")return{type:"referralRegistrationFailed",positions:e.positions,update:e.update,error:r.error,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"ManagePositionInitiated":{if(e.type==="preparingTransaction"||e.type==="referralRegistered")return{type:"managingPosition",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"ManagePositionSuccess":{if(e.type==="managingPosition")return{type:"managePositionSucceeded",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"ManagePositionFailure":{if(e.type==="managingPosition")return{type:"managePositionFailed",positions:e.positions,update:e.update,error:r.error,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"Reset":return{type:"indeterminate"}}return e}notifyListeners(e){this.listeners.forEach(r=>{r.onManagePositionStateChange(e,this.state)})}};var ci=.1,yp=class{static{i(this,"ManagePositionOrchestrator")}stateMachine=new gp;perps;constructor(e){this.perps=e,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManagePositionStateChange:i((e,r)=>{this.handleStateChange(e,r)},"onManagePositionStateChange")};stateLogsListener={onManagePositionStateChange:i((e,r)=>{switch(r.type){case"managePositionSucceeded":k.addBreadcrumb(_.Perps,`Manage position succeeded: ${r.type}`,L.Info,fh(r));break;case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":k.addBreadcrumb(_.Perps,`Manage position failed: ${r.type}`,L.Error,fh(r));break;default:k.addBreadcrumb(_.Perps,`Manage position state change: ${e.type} -> ${r.type}`,L.Info);break}(r.type==="managePositionSucceeded"||r.type==="managePositionFailed")&&this.stateMachine.removeListener(this.stateLogsListener)},"onManagePositionStateChange")};async handleStateChange(e,r){switch(e.type){case"InitiateManagePosition":e.payload.update.type==="close"?this.stateMachine.send({type:"RegisterBuilderCodeInitiated"}):this.stateMachine.send({type:"ManagePositionInitiated"});break;case"RegisterBuilderCodeInitiated":r.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":r.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":r.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":r.type==="referralRegistered"&&this.stateMachine.send({type:"ManagePositionInitiated"});break;case"ManagePositionInitiated":r.type==="managingPosition"&&await this.managePosition(r);break}}getState(){return this.stateMachine.getState()}send(e){this.stateMachine.send(e)}addListener(e){this.stateMachine.addListener(e)}removeListener(e){this.stateMachine.removeListener(e)}async registerBuilder(){try{let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing"||!e.positionFees.builder)throw new Error("position fees not found");if(e.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let r=e.positionFees.builder.address,o=`${Number(e.positionFees.phantomFee.toString())*100}%`,n=Date.now(),s={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:o,builder:r,nonce:n},c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:st,"HyperliquidTransaction:ApproveBuilderFee":ep},message:s},d=(await this.perps.exchangeAction(s,c,n)).response.data?.statuses?.find(m=>typeof m=="object"&&"error"in m);if(d&&typeof d=="object"&&"error"in d)throw new Error(d.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:e})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing")throw new Error("position fees not found");if(!e.positionFees.referral||e.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let r=e.positionFees.referral.code,o=new ai({code:r}),n=Date.now(),s={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:st,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:o.hash(null,n)}},p=(await this.perps.exchangeAction(o,s,n)).response.data?.statuses?.find(d=>typeof d=="object"&&"error"in d);if(p&&typeof p=="object"&&"error"in p)throw new Error(p.error);this.stateMachine.send({type:"RegisterReferralSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterReferralFailure",error:e})}}async managePosition(e){try{let{positions:r,update:o,markets:n}=e,s="",p=r.map(d=>d.direction==="long").map(d=>d);if(o.type==="removeAutoClose"){let d=await this.removeOrders(n[0].assetId,[o.autoClose.tp?.orderId,o.autoClose.sl?.orderId].filter(Boolean));if(!d)throw new Error("Failed to cancel auto close orders");s=d}else if(o.type==="removeLimitOrder"){let d=await this.removeOrders(n[0].assetId,[o.limitOrder.orderId].filter(Boolean));if(!d)throw new Error("Failed to cancel auto close orders");s=d}else if(o.type==="removeAllOrders"){let d=await this.removeOrders(n[0].assetId,[...o.limitOrders.map(m=>m.orderId).filter(Boolean),...[o.autoClose.tp?.orderId,o.autoClose.sl?.orderId].filter(Boolean)]);if(!d)throw new Error("Failed to cancel auto close orders");s=d}else if(o.type==="close"||o.type==="closeAll")s=await this.closePositions(n.map(m=>m.assetId),o.size instanceof A?[o.size.abs().toString()]:o.size.map(m=>m.abs().toString()),p,n.map(m=>m.currentPrice.toString()),n.map(m=>m.szDecimals));else if(o.type==="addAutoClose"){let d={tp:o.autoClose.tp?.orderId,sl:o.autoClose.sl?.orderId},m=await this.createAutoClose(d,n[0].assetId,p[0],n[0].szDecimals,o.autoClose);if(!m)throw new Error("Failed to cancel auto close orders");s=m}this.stateMachine.send({type:"ManagePositionSuccess",payload:s})}catch(r){this.stateMachine.send({type:"ManagePositionFailure",error:r})}}async closePositions(e,r,o,n,s){let c=this.perps.getPositionFeesState();if(c.type!=="positionFees"&&c.type!=="refreshing"||!c.positionFees.builder)throw new Error("position fees not found");let p={b:c.positionFees.builder.address.toLowerCase(),f:Number(c.positionFees.phantomFee)*100*100*10},d=[];for(let b=0;b<e.length;b++){let T=ir(new A(n[b]).multipliedBy(o[b]?1-ci:1+ci),s[b]),x=mp(new A(r[b]),s[b]),C=new sr().asset(e[b]).isBuy(!o[b]).price(T).size(x).reduceOnly(!0).immediateOrCancel().build();d.push(C)}let m=new Eo(d,p),f=Date.now(),g={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:st,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:m.hash(null,f)}},y=await this.perps.exchangeAction(m,g,f),w=y.response.data?.statuses.find(b=>b==="error"||b?.error);if(w){let b=typeof w=="string"?"Operation failed":w.error;throw new Error(b)}let S=y.response.data?.statuses.find(b=>b==="filled"||b?.filled);if(S&&typeof S=="object"&&S.filled)return JSON.stringify(y.response.data?.statuses);throw new Error("No filled status found")}async createAutoClose(e,r,o,n,s){let c=[e.tp,e.sl].filter(Boolean).filter(E=>E!==-1);if(c.length>0&&!await this.removeOrders(r,c))throw new Error("Failed to cancel auto close orders");let p=this.perps.getPositionFeesState();if(p.type!=="positionFees"&&p.type!=="refreshing"||!p.positionFees.builder)throw new Error("position fees not found");let d={b:p.positionFees.builder.address.toLowerCase(),f:Number(p.positionFees.phantomFee)*100*100*10},m="0",f;if(s?.tp){let E=ir(new A(s.tp.triggerPrice).multipliedBy(o?1-ci:1+ci),n),P=ir(new A(s.tp.triggerPrice),n).toString();f=new sr().asset(r).isBuy(!o).price(E).size(m).reduceOnly(!0).triggerOrder(P,!0,"tp").build()}let g;if(s?.sl){let E=ir(new A(s.sl.triggerPrice).multipliedBy(o?1-ci:1+ci),n),P=ir(new A(s.sl.triggerPrice),n).toString();g=new sr().asset(r).isBuy(!o).price(E).size(m).reduceOnly(!0).triggerOrder(P,!0,"sl").build()}let y=[f,g].filter(Boolean),w=new Eo(y,d),S=Date.now(),b={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:st,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:w.hash(null,S)}},T=await this.perps.exchangeAction(w,b,S),x=T.response.data?.statuses.find(E=>E==="error"||E?.error);if(x){let E=typeof x=="string"?"Operation failed":x.error;throw new Error(E)}let C=T.response.data?.statuses.find(E=>E==="resting"||E?.resting);if(C&&typeof C=="object"&&C.resting&&C.resting.oid)return JSON.stringify(T.response.data?.statuses);throw new Error("No order status found")}async removeOrders(e,r){let o=r.map(m=>new fp().asset(e).orderId(Number(m)).build()),n=new hp(o),s=Date.now(),c={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:st,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:n.hash(null,s)}},p=await this.perps.exchangeAction(n,c,s),d=p.response.data?.statuses.find(m=>m==="error"||m?.error);if(d){let m=typeof d=="string"?"Operation failed":d.error;throw new Error(m)}if(p.response.data?.statuses&&p.response.data?.statuses.length>0&&p.response.data?.statuses.every(m=>m==="success"||m?.success))return JSON.stringify({orderIds:o});throw new Error("Cancel operation failed")}};u();l();u();l();var vC=D(Ei());var wp=class{static{i(this,"UpdateLeverageAction")}type="updateLeverage";asset;isCross;leverage;constructor(e){this.asset=e.asset,this.isCross=e.isCross,this.leverage=e.leverage}hash(e,r){let o=kr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(PM(e),o.length+9)),`0x${(0,vC.keccak256)(s)}`}};function PM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(PM,"addressToBytes");u();l();function hh(t){switch(t.type){case"preparingTransaction":case"updatingLeverage":case"leverageUpdated":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"creatingPosition":case"orderSucceeded":return RC(t);case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"orderFailed":return{...RC(t),error:t.error instanceof Error?t.error.message:"Unknown error"};case"indeterminate":default:return{state:t.type}}}i(hh,"getOpenPositionStateLogsDetails");var RC=i(t=>t.type==="indeterminate"?{state:t.type}:{marketSymbol:t.market.symbol,assetId:t.market.assetId.toString(),direction:t.direction,margin:t.margin.toString(),leverage:t.leverage.toString(),size:t.size.toString(),sizeInCoin:t.sizeInCoin.toString(),estimatedLiquidationPrice:t.estimatedLiquidationPrice?.toString()||"N/A",fee:t.fee?.toString()||"N/A",action:t.action},"getBaseLogsDetails");u();l();var Sp=class{static{i(this,"OpenPositionStateMachine")}listeners=[];state={type:"indeterminate"};getState(){return this.state}send(e){try{let r=this.determineNextState(this.state,e);this.state=r,this.notifyListeners(e)}catch(r){console.error("Error processing event in OpenPositionStateMachine:",e,r)}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}determineNextState(e,r){switch(r.type){case"InitiateOpenPosition":{let{market:o,direction:n,margin:s,leverage:c,autoClose:p,estimatedLiquidationPrice:d,fee:m,action:f,limitPrice:g}=r.payload,y=new A(s).multipliedBy(c),w=new A(o.currentPrice),S=w.isGreaterThan(0)?y.dividedBy(w):new A(0);return{type:"preparingTransaction",...{market:o,direction:n,margin:s,leverage:c,autoClose:p,size:y,sizeInCoin:S,estimatedLiquidationPrice:d,fee:m,action:f,limitPrice:g}}}case"PrepareCollateralInitiated":{if(e.type==="preparingTransaction")return{type:"preparingCollateral",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PrepareCollateralNotRequired":case"PrepareCollateralSuccess":{if(e.type==="preparingCollateral"||e.type==="preparingTransaction")return{type:"collateralPrepared",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PrepareCollateralFailure":{if(e.type==="preparingCollateral")return{type:"collateralPreparationFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"InitiateUpdateLeverage":{if(e.type==="collateralPrepared")return e;break}case"UpdateLeverageInitiated":{if(e.type==="collateralPrepared")return{type:"updatingLeverage",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"UpdateLeverageSuccess":{if(e.type==="updatingLeverage")return{type:"leverageUpdated",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"UpdateLeverageFailure":{if(e.type==="updatingLeverage")return{type:"leverageUpdateFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"RegisterBuilderCodeInitiated":{if(e.type==="leverageUpdated")return{type:"registeringBuilder",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(e.type==="registeringBuilder")return{type:"builderRegistered",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterBuilderCodeFailure":{if(e.type==="registeringBuilder")return{type:"builderRegistrationFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"RegisterReferralInitiated":{if(e.type==="builderRegistered")return{type:"registeringReferral",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(e.type==="registeringReferral")return{type:"referralRegistered",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterReferralFailure":{if(e.type==="registeringReferral")return{type:"referralRegistrationFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"PositionCreationInitiated":{if(e.type==="referralRegistered")return{type:"creatingPosition",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PositionCreationSuccess":{if(e.type==="creatingPosition")return{type:"orderSucceeded",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PositionCreationFailure":{if(e.type==="creatingPosition")return{type:"orderFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,error:r.error,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"Reset":return{type:"indeterminate"}}return e}notifyListeners(e){this.listeners.forEach(r=>{r.onOpenPositionStateChange(e,this.state)})}};var ui=.1,bp=class{static{i(this,"OpenPositionOrchestrator")}stateMachine=new Sp;perps;constructor(e){this.perps=e,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onOpenPositionStateChange:i((e,r)=>{this.handleStateChange(e,r)},"onOpenPositionStateChange")};stateLogsListener={onOpenPositionStateChange:i((e,r)=>{switch(r.type){case"orderSucceeded":k.addBreadcrumb(_.Perps,`Open position succeeded: ${r.type}`,L.Info,hh(r));break;case"collateralPreparationFailed":case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"orderFailed":k.addBreadcrumb(_.Perps,`Open position failed: ${r.type}`,L.Error,hh(r));break;default:k.addBreadcrumb(_.Perps,`Open position state change: ${e.type} -> ${r.type}`,L.Info);break}(r.type==="orderSucceeded"||r.type==="orderFailed"||r.type==="collateralPreparationFailed")&&this.stateMachine.removeListener(this.stateLogsListener)},"onOpenPositionStateChange")};async handleStateChange(e,r){switch(e.type){case"InitiateOpenPosition":this.stateMachine.send({type:"PrepareCollateralInitiated"});break;case"PrepareCollateralInitiated":r.type==="preparingCollateral"&&await this.prepareCollateral(r);break;case"PrepareCollateralNotRequired":case"PrepareCollateralSuccess":r.type==="collateralPrepared"&&this.stateMachine.send({type:"InitiateUpdateLeverage",payload:{isCross:!1,leverage:r.leverage}});break;case"InitiateUpdateLeverage":this.stateMachine.send({type:"UpdateLeverageInitiated"});break;case"UpdateLeverageInitiated":r.type==="updatingLeverage"&&await this.updateLeverage(r);break;case"UpdateLeverageSuccess":r.type==="leverageUpdated"&&this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"InitiateRegisterBuilder":this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"RegisterBuilderCodeInitiated":r.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":r.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"InitiateRegisterReferral":this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":r.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":r.type==="referralRegistered"&&this.stateMachine.send({type:"PositionCreationInitiated"});break;case"PositionCreationInitiated":r.type==="creatingPosition"&&await this.createPosition(r);break}}getState(){return this.stateMachine.getState()}send(e){this.stateMachine.send(e)}addListener(e){this.stateMachine.addListener(e)}removeListener(e){this.stateMachine.removeListener(e)}async prepareCollateral(e){try{let{collateralToken:r}=e.market,{action:o}=e;if(!r||o==="reduce"||o==="reverse"){this.stateMachine.send({type:"PrepareCollateralNotRequired"});return}let n=e.margin;await this.perps.transfer({toPerp:!1,amount:n}),k.addBreadcrumb(_.Perps,"Transferred USDC from perp to spot for collateral",L.Info,{amount:n.toString()}),await this.perps.spot.swapUsdcToCollateral(r.pairIndex,n),k.addBreadcrumb(_.Perps,"Swapped USDC to collateral token",L.Info,{pairIndex:r.pairIndex,amount:n.toString()}),this.stateMachine.send({type:"PrepareCollateralSuccess"})}catch(r){k.addBreadcrumb(_.Perps,"Failed to prepare collateral",L.Error,{error:r instanceof Error?r.message:"Unknown error"}),this.stateMachine.send({type:"PrepareCollateralFailure",error:r})}}async updateLeverage(e){try{let r=e.market.assetId,o=new wp({asset:r,isCross:!1,leverage:e.leverage.toNumber()}),n=Date.now(),s={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:st,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:o.hash(null,n)}},p=(await this.perps.exchangeAction(o,s,n)).response.data?.statuses?.find(d=>typeof d=="object"&&"error"in d);if(p&&typeof p=="object"&&"error"in p)throw new Error(p.error);this.stateMachine.send({type:"UpdateLeverageSuccess"})}catch(r){this.stateMachine.send({type:"UpdateLeverageFailure",error:r})}}async registerBuilder(){try{let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing"||!e.positionFees.builder)throw new Error("position fees not found");if(e.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let r=e.positionFees.builder.address,o=`${Number(e.positionFees.phantomFee.toString())*100}%`,n=Date.now(),s={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:o,builder:r,nonce:n},c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:st,"HyperliquidTransaction:ApproveBuilderFee":ep},message:s},d=(await this.perps.exchangeAction(s,c,n)).response.data?.statuses?.find(m=>typeof m=="object"&&"error"in m);if(d&&typeof d=="object"&&"error"in d)throw new Error(d.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:e})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing")throw new Error("position fees not found");if(!e.positionFees.referral||e.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let r=e.positionFees.referral.code,o=new ai({code:r}),n=Date.now(),s={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:st,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:o.hash(null,n)}},p=(await this.perps.exchangeAction(o,s,n)).response.data?.statuses?.find(d=>typeof d=="object"&&"error"in d);if(p&&typeof p=="object"&&"error"in p)throw new Error(p.error);this.stateMachine.send({type:"RegisterReferralSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterReferralFailure",error:e})}}async createPosition(e){try{let r=await this.createOrder(e.market.assetId,e.size.toString(),e.direction==="long",e.limitPrice?e.limitPrice.toString():e.market.currentPrice.toString(),e.market.szDecimals,e.autoClose,e.action==="reduce",e.limitPrice?"limit":"market");this.stateMachine.send({type:"PositionCreationSuccess",payload:r})}catch(r){this.stateMachine.send({type:"PositionCreationFailure",error:r})}}async createOrder(e,r,o,n,s,c,p,d="market"){let m=d==="limit"?ir(new A(n),s):ir(new A(n).multipliedBy(o?1+ui:1-ui),s),f=this.perps.getPositionFeesState();if(f.type!=="positionFees"&&f.type!=="refreshing"||!f.positionFees.builder)throw new Error("position fees not found");let g={b:f.positionFees.builder.address.toLowerCase(),f:Number(f.positionFees.phantomFee)*100*100*10},y=mp(new A(r).dividedBy(new A(n)),s),w;d==="limit"?w=new sr().asset(e).isBuy(o).price(m).size(y).reduceOnly(p??!1).limitOrder().build():w=new sr().asset(e).isBuy(o).price(m).size(y).reduceOnly(p??!1).immediateOrCancel().build();let S;if(c?.tp?.dollar){let j=ir(new A(c.tp.dollar),s).toString(),Q=ir(new A(c.tp.dollar).multipliedBy(o?1+ui:1-ui),s);S=new sr().asset(e).isBuy(!o).price(Q).size(y).reduceOnly(!0).triggerOrder(j,!0,"tp").build()}let b;if(c?.sl?.dollar){let j=ir(new A(c.sl.dollar),s).toString(),Q=ir(new A(c.sl.dollar).multipliedBy(o?1+ui:1-ui),s);b=new sr().asset(e).isBuy(!o).price(Q).size(y).reduceOnly(!0).triggerOrder(j,!0,"sl").build()}let T=[w,S,b].filter(Boolean),x=new Eo(T,g),C=Date.now(),E={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:st,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:x.hash(null,C)}},P=await this.perps.exchangeAction(x,E,C),M=P.response.data?.statuses?.find(j=>typeof j=="object"&&"error"in j);if(M&&typeof M=="object"&&"error"in M)throw new Error(M.error);let G=P.response.data?.statuses.find(j=>typeof j=="object"&&"filled"in j),R=P.response.data?.statuses.find(j=>typeof j=="object"&&"resting"in j);if(G&&typeof G=="object"&&"filled"in G||R)return JSON.stringify(P.response.data?.statuses);throw new Error("No filled status found")}};u();l();var Tp=class{static{i(this,"PositionFeesStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingPositionFeesStart":switch(this.state.type){case"positionFees":return{type:"refreshing",positionFees:this.state.positionFees};case"refreshing":return{type:"refreshing",positionFees:this.state.positionFees};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesStart`)}case"fetchingPositionFeesSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"positionFees",positionFees:e.fees};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesSuccess`)}case"fetchingPositionFeesError":return{type:"error",error:e.error}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onPositionFeesStateChange(this.state)})}};u();l();var gh=["1H","1D","1W","1M","YTD","ALL"],Ap=class{static{i(this,"PricingStateMachine")}listeners=[];state={type:"indeterminate"};nextRequestId=1;send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"initiateSequentialFetch":{let r={"1H":{type:"idle"},"1D":{type:"idle"},"1W":{type:"idle"},"1M":{type:"idle"},YTD:{type:"idle"},ALL:{type:"idle"}};return{type:"multiInterval",activeCoin:e.coin,requestId:this.nextRequestId++,intervals:r,currentlyFetchingInterval:null,sequenceComplete:!1}}case"fetchingIntervalStart":return this.state.type!=="multiInterval"?this.state:e.requestId!==this.state.requestId||e.coin!==this.state.activeCoin?this.state:{...this.state,intervals:{...this.state.intervals,[e.interval]:{type:"loading"}},currentlyFetchingInterval:e.interval};case"fetchingIntervalSuccess":{if(this.state.type!=="multiInterval")return this.state;if(e.requestId!==this.state.requestId||e.coin!==this.state.activeCoin)return this.state;let r={...this.state.intervals,[e.interval]:{type:"loaded",candleSnapshots:e.candleSnapshots}},o=gh.every(n=>{let s=r[n];return s.type==="loaded"||s.type==="error"});return{type:"multiInterval",activeCoin:this.state.activeCoin,requestId:this.state.requestId,intervals:r,currentlyFetchingInterval:null,sequenceComplete:o}}case"fetchingIntervalError":{if(this.state.type!=="multiInterval")return this.state;if(e.requestId!==this.state.requestId||e.coin!==this.state.activeCoin)return this.state;let r={...this.state.intervals,[e.interval]:{type:"error",error:e.error}},o=gh.every(n=>{let s=r[n];return s.type==="loaded"||s.type==="error"});return{type:"multiInterval",activeCoin:this.state.activeCoin,requestId:this.state.requestId,intervals:r,currentlyFetchingInterval:null,sequenceComplete:o}}case"sequentialFetchComplete":return this.state.type!=="multiInterval"?this.state:{...this.state,sequenceComplete:!0};default:return this.state}}getState(){return this.state}getNextIntervalToFetch(){if(this.state.type!=="multiInterval")return null;for(let e of gh)if(this.state.intervals[e].type==="idle")return e;return null}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onPricingStateChange(this.state)})}};u();l();var xp=.98,Ep=class{static{i(this,"Spot")}perps;perpsClient;constructor(e,r){this.perps=e,this.perpsClient=r}async getSpotBalances(e){let r=N({address:e,chainId:Ci.Mainnet,resourceType:V.address});return(await this.perpsClient.getSpotBalances({user:r})).balances}async buy(e,r,o){let n=new A(o).dividedBy(xp).decimalPlaces(2);return this.placeBuySellOrder(e,r,!0,n.toString())}async sell(e,r,o){let n=new A(o).multipliedBy(xp).decimalPlaces(2);return this.placeBuySellOrder(e,r,!1,n.toString())}async placeBuySellOrder(e,r,o,n){if(!this.perps.user?.address)throw new Error("User not found");let c=new sr().asset(e).isBuy(o).price(n).size(r).reduceOnly(!1).immediateOrCancel().build(),p=new Eo([c]),d=Date.now(),m={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:st,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:p.hash(null,d)}},f=await this.perps.exchangeAction(p,m,d),g=f.response.data?.statuses.find(w=>typeof w=="object"&&"error"in w);if(g&&typeof g=="object"&&"error"in g)throw new Error(g.error);let y=f.response.data?.statuses.find(w=>typeof w=="object"&&"filled"in w);if(y&&typeof y=="object"&&"filled"in y)return{totalSz:y.filled.totalSz,avgPx:y.filled.avgPx};throw new Error("No filled status found")}async send(e,r,o,n){let s=`${e}:${r}`,c=Date.now(),p=new pp({hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",token:s,amount:o.toString(),destination:n.toLowerCase(),time:c}),d={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SpotSend",types:{EIP712Domain:st,"HyperliquidTransaction:SpotSend":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"time",type:"uint64"}]},message:p},{splitSignature:m}=await this.perps.sign(d),f=await this.perpsClient.postSpotSend({action:p,nonce:c,signature:m});if(f.status==="err")throw new Error(f.response);return f.response}async getTokenMidPrice(e){let r=await this.perpsClient.getTokenDetails({tokenId:e});return new A(r.midPx)}async swapCollateralToUsdc(e,r,o){let n=new A(1),s=await this.sell(e,o.decimalPlaces(2,A.ROUND_DOWN).toString(),n);return{symbol:r,amount:o.toString(),usdcReceived:new A(s.totalSz).multipliedBy(s.avgPx).toString()}}async swapUsdcToCollateral(e,r){let o=new A(1);return this.buy(e,r.decimalPlaces(2,A.ROUND_DOWN).toString(),o)}async pollForUsdcBalance(e,r=10,o=1e3){for(let n=0;n<r;n++){let c=(await this.getSpotBalances(e)).find(p=>p.token.address==="USDC");if(c&&new A(c.amount).gte(.01))return new A(c.amount);n<r-1&&await new Promise(p=>setTimeout(p,o))}return null}};var Cp=class{static{i(this,"Perps")}client;accountBalanceStateMachine=new tp;positionsStateMachine=new np;pricingStateMachine=new Ap;positionFeesStateMachine=new Tp;signer=void 0;fundingHistoryStateMachine=new rp;historicalOrdersStateMachine=new op;openPositionOrchestrator;managePositionOrchestrator;manageMarginOrchestrator;accountChangeListeners=[];account;user;isTestnet;spot;fundingPool;relayFundingTaskFactory;hyperunitFundingTaskFactory;sequentialPricingCoin=null;pricingRequestId=null;authRepository;constructor({client:e,isTestnet:r,fundingPool:o,relayFundingTaskFactory:n,hyperunitFundingTaskFactory:s,authRepository:c}){this.client=e,this.isTestnet=r,this.spot=new Ep(this,this.client),this.fundingPool=o,this.fundingPool.addListener(this.fundingPoolListener),this.relayFundingTaskFactory=n,this.hyperunitFundingTaskFactory=s,this.openPositionOrchestrator=new bp(this),this.managePositionOrchestrator=new yp(this),this.manageMarginOrchestrator=new lp(this),this.authRepository=c,this.pricingStateMachine.addListener({onPricingStateChange:this.handlePricingStateChange.bind(this)}),this.accountBalanceStateMachine.addListener({onAccountBalanceStateChange:i(p=>{this.enableDexAbstraction(p),this.autoConsolidateCollateral(p)},"onAccountBalanceStateChange")})}setSigner(e){this.signer=e}createRelayFundingTask(e,r,o,n){return this.relayFundingTaskFactory.createTask(this,e,this.authRepository,r,o,Jo(this.signer),Jo(this.user),n)}createHyperunitFundingTask(e,r,o,n){return this.hyperunitFundingTaskFactory.createTask(this,e,this.authRepository,r,o,Jo(this.signer),Jo(this.user),n)}executeFundingTask(e,r,o,n,s){this.fundingPool.submit(e,r,o,n,s)}fundingPoolListener={onFundingPoolStateChange:i((e,r)=>{(e.type==="fundingCompleted"||e.type==="fundingStarted")&&(this.syncAccountBalance(),this.syncFundingHistory())},"onFundingPoolStateChange")};setAccount(e){this.resetAllState(),this.account=e;let{address:r}=e.addresses?.find(o=>I.isEVMNetworkID(o.networkID))??{addressType:se.EVM,networkID:re.Ethereum.Mainnet};r&&(this.user={resourceType:V.address,chainId:this.isTestnet?"hypercore:testnet":I.hypercore.mainnetID,address:r},this.fundingPool.setAccountId(r)),this.accountChangeListeners.forEach(o=>o.onAccountChange(e))}resetAllState(){this.accountBalanceStateMachine.reset(),this.positionsStateMachine.reset(),this.fundingHistoryStateMachine.reset(),this.historicalOrdersStateMachine.reset(),this.positionFeesStateMachine.reset()}getAccount(){return this.account}getUser(){return this.user}subscribeAccountChange(e){return this.accountChangeListeners.push(e),()=>this.unsubscribeAccountChange(e)}unsubscribeAccountChange(e){this.accountChangeListeners=this.accountChangeListeners.filter(r=>r!==e)}getAccountBalanceState(){return this.accountBalanceStateMachine.getState()}syncAccountBalance(){if(!this.user)return;let e=this.accountBalanceStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceStart"}),this.client.getAccountBalance(this.user).then(r=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceSuccess",accountBalance:r})}).catch(r=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceError",error:r}),k.addBreadcrumb(_.Perps,"Error fetching account balance",L.Error,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribeAccountBalanceState(e){return this.accountBalanceStateMachine.addListener(e),()=>{this.unsubscribeAccountBalanceState(e)}}unsubscribeAccountBalanceState(e){this.accountBalanceStateMachine.removeListener(e)}getPositionFeesState(){return this.positionFeesStateMachine.getState()}syncPositionFees(){if(!this.user)return;let e=this.positionFeesStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.positionFeesStateMachine.send({type:"fetchingPositionFeesStart"}),this.client.getPositionFees(this.user).then(r=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesSuccess",fees:r})}).catch(r=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesError",error:r}),k.addBreadcrumb(_.Perps,"Error fetching position fees",L.Error,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribePositionFees(e){return this.positionFeesStateMachine.addListener(e),()=>{this.unsubscribePositionFees(e)}}unsubscribePositionFees(e){this.positionFeesStateMachine.removeListener(e)}getPositionsState(){return this.positionsStateMachine.getState()}syncPositions(){if(!this.user)return;let e=this.positionsStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.positionsStateMachine.send({type:"fetchingPositionsStart"}),this.client.getPositionsAndOpenOrders(this.user).then(r=>{this.positionsStateMachine.send({type:"fetchingPositionsSuccess",positions:r.positions,openOrders:r.openOrders})}).catch(r=>{this.positionsStateMachine.send({type:"fetchingPositionsError",error:r}),k.addBreadcrumb(_.Perps,"Error fetching positions",L.Error,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribePositions(e){return this.positionsStateMachine.addListener(e),()=>{this.unsubscribePositions(e)}}unsubscribePositions(e){this.positionsStateMachine.removeListener(e)}getFundingHistoryState(){return this.fundingHistoryStateMachine.getState()}syncFundingHistory(){if(!this.user)return;let e=this.fundingHistoryStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryStart"}),this.client.getUserFundingHistory(this.user).then(r=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistorySuccess",history:r})}).catch(r=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryError",error:r}),k.addBreadcrumb(_.Perps,"Error fetching funding history",L.Error,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribeFundingHistory(e){return this.fundingHistoryStateMachine.addListener(e),()=>{this.unsubscribeFundingHistory(e)}}unsubscribeFundingHistory(e){this.fundingHistoryStateMachine.removeListener(e)}getHistoricalOrdersState(){return this.historicalOrdersStateMachine.getState()}syncHistoricalOrders(e){if(!this.user)return;let r=this.historicalOrdersStateMachine.getState();r.type==="loading"||r.type==="refreshing"||(this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersStart"}),this.client.getHistoricalOrders(this.user,e).then(o=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersSuccess",historicalOrders:o})}).catch(o=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersError",error:o}),k.addBreadcrumb(_.Perps,"Error fetching historical orders",L.Error,{error:o instanceof Error?o.message:"Unknown error",markets:e?.join(",")??"No markets"})}))}subscribeHistoricalOrders(e){return this.historicalOrdersStateMachine.addListener(e),()=>{this.unsubscribeHistoricalOrders(e)}}unsubscribeHistoricalOrders(e){this.historicalOrdersStateMachine.removeListener(e)}getPricingState(){return this.pricingStateMachine.getState()}syncPricing(e,r,o,n){if(!this.user)return;let s;switch(r){case"1m":s="1H";break;case"15m":s="1D";break;case"1h":s="1W";break;case"4h":s="1M";break;case"1d":s="ALL";break;default:s="1D"}let c=this.pricingStateMachine.getState();(c.type!=="multiInterval"||c.activeCoin!==e)&&this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:e});let p=this.pricingStateMachine.getState(),d=p.type==="multiInterval"?p.requestId:null;d!=null&&(this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:s,coin:e,requestId:d,apiInterval:r,startTime:o,endTime:n}),this.client.getPriceHistory({coin:e,interval:s,startTime:o,endTime:n,isTestnet:this.isTestnet}).then(m=>{let f=dh(m);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:s,coin:e,requestId:d,candleSnapshots:f})}).catch(m=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:s,coin:e,requestId:d,error:m}),k.addBreadcrumb(_.Perps,"Error fetching pricing",L.Error,{error:m instanceof Error?m.message:"Unknown error",coin:e,interval:r,startTime:o,endTime:n})}))}getTimeFrameDetails(e,r){let o=r,n,s;switch(e){case"1H":n=r-1e3*60*60*1,s="1m";break;case"1D":n=r-1e3*60*60*24,s="30m";break;case"1W":n=r-1e3*60*60*24*7,s="4h";break;case"1M":n=r-1e3*60*60*24*30,s="12h";break;case"YTD":n=new Date(new Date().getFullYear(),0,1).getTime(),s="1d";break;case"ALL":n=r-1e3*60*60*24*365*10,s="1d";break}return{startTime:n,endTime:o,apiInterval:s}}startSequentialPricingSync(e){this.sequentialPricingCoin=e,this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:e});let r=this.pricingStateMachine.getState();this.pricingRequestId=r.type==="multiInterval"?r.requestId:null,this.fetchNextInterval()}fetchNextInterval(){let e=this.pricingStateMachine.getNextIntervalToFetch();if(!e||!this.sequentialPricingCoin)return;let r=this.pricingRequestId;if(r==null)return;let o=new Date().getTime(),{startTime:n,endTime:s,apiInterval:c}=this.getTimeFrameDetails(e,o);this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:e,coin:this.sequentialPricingCoin,requestId:r,apiInterval:c,startTime:n,endTime:s}),this.client.getPriceHistory({coin:this.sequentialPricingCoin,interval:c,startTime:n,endTime:s,isTestnet:this.isTestnet}).then(p=>{let d=dh(p);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:e,coin:this.sequentialPricingCoin,requestId:r,candleSnapshots:d})}).catch(p=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:e,coin:this.sequentialPricingCoin,requestId:r,error:p}),k.addBreadcrumb(_.Perps,"Error fetching next pricing interval",L.Error,{error:p instanceof Error?p.message:"Unknown error",coin:this.sequentialPricingCoin,interval:e,apiInterval:c,startTime:n,endTime:new Date(s).toISOString()})})}handlePricingStateChange(e){e.type==="multiInterval"&&!e.currentlyFetchingInterval&&!e.sequenceComplete&&setTimeout(()=>{this.fetchNextInterval()},100)}isEnablingDexAbstraction=!1;dexAbstractionRetryCount=0;isConsolidatingCollateral=!1;async enableDexAbstraction(e){if(e.type==="accountBalance"){if(e.accountBalance.dexAbstraction){this.dexAbstractionRetryCount=0;return}if(new A(e.accountBalance.accountValue).gt(0)&&!(this.dexAbstractionRetryCount>=5)&&this.user&&!this.isEnablingDexAbstraction){this.isEnablingDexAbstraction=!0,this.dexAbstractionRetryCount++;try{await this.setUserDexAbstraction({enabled:!0}),k.addBreadcrumb(_.Perps,"DEX abstraction enabled",L.Info),this.dexAbstractionRetryCount=0}catch(r){k.addBreadcrumb(_.Perps,"Failed to enable DEX abstraction",L.Error,{error:r instanceof Error?r.message:"Unknown error",retryAttempt:this.dexAbstractionRetryCount})}finally{this.isEnablingDexAbstraction=!1}}}}async autoConsolidateCollateral(e){if(!(e.type!=="accountBalance"||!(e.accountBalance.collateralBalances??[]).some(n=>n.pairIndex!==void 0&&new A(n.total).minus(n.hold).gt(.01)))&&!(!this.user||this.isConsolidatingCollateral))try{let n=await this.consolidateCollateralBalances();(n.swapped.length>0||n.transferred!=="0")&&k.addBreadcrumb(_.Perps,"Auto-consolidated collateral balances",L.Info,{swappedCount:n.swapped.length,transferred:n.transferred,errorsCount:n.errors.length})}catch(n){k.addBreadcrumb(_.Perps,"Failed to auto-consolidate collateral",L.Error,{error:n instanceof Error?n.message:"Unknown error"})}}subscribePricing(e){return this.pricingStateMachine.addListener(e),()=>{this.unsubscribePricing(e)}}unsubscribePricing(e){this.pricingStateMachine.removeListener(e)}async sign(e){let r=Jo(this.signer),o=Jo(this.account),{signature:n}=await r.sign(o.identifier,{chainType:se.EVM,signingType:"typedData",version:4,data:e});return{splitSignature:DC(n)}}async exchangeAction(e,r,o){let n=new Rn,s=Jo(this.signer),c=Jo(this.account),{signature:p}=await s.sign(c.identifier,{chainType:se.EVM,signingType:"typedData",version:4,data:r}),d=DC(p),m=await n.postExchange({action:e,nonce:o,signature:{r:d.r,s:d.s,v:d.v},isTestnet:this.isTestnet});if(m.status==="err")throw new Error(m.response);if(m.status==="ok")return m;throw new Error("Unknown response status")}async transfer(e){let{toPerp:r,amount:o}=e,n=Date.now(),s={type:"usdClassTransfer",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",amount:o.toString(),toPerp:r,nonce:n},c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UsdClassTransfer",types:{EIP712Domain:st,"HyperliquidTransaction:UsdClassTransfer":[{name:"hyperliquidChain",type:"string"},{name:"amount",type:"string"},{name:"toPerp",type:"bool"},{name:"nonce",type:"uint64"}]},message:s},{splitSignature:p}=await this.sign(c),m=await new Rn().postExchange({action:s,nonce:n,signature:p,isTestnet:this.isTestnet});if(m.status==="err")throw new Error(m.response);return m}async sendAsset(e){let{destination:r,sourceDex:o,destinationDex:n,token:s,amount:c,vaultAddress:p}=e,d=Date.now(),m={type:"sendAsset",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",destination:r.toLowerCase(),sourceDex:o,destinationDex:n,token:s,amount:c.toString(),fromSubAccount:p?p.toLowerCase():"",nonce:d},f={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SendAsset",types:{EIP712Domain:st,"HyperliquidTransaction:SendAsset":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"sourceDex",type:"string"},{name:"destinationDex",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"fromSubAccount",type:"string"},{name:"nonce",type:"uint64"}]},message:m},{splitSignature:g}=await this.sign(f),w=await new Rn().postExchange({action:m,nonce:d,signature:g,isTestnet:this.isTestnet});if(w.status==="err")throw new Error(w.response);return w}async setUserDexAbstraction(e){let{enabled:r}=e;if(!this.user)throw new Error("User not set");let o=Date.now(),n={type:"userDexAbstraction",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",user:this.user.address,enabled:r,nonce:o},s={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UserDexAbstraction",types:{EIP712Domain:st,"HyperliquidTransaction:UserDexAbstraction":[{name:"hyperliquidChain",type:"string"},{name:"user",type:"address"},{name:"enabled",type:"bool"},{name:"nonce",type:"uint64"}]},message:n},{splitSignature:c}=await this.sign(s),d=await new Rn().postExchange({action:n,nonce:o,signature:c});if(d.status==="err")throw new Error(d.response);return d}async consolidateCollateralBalances(){if(!this.user)throw new Error("User not set");if(this.isConsolidatingCollateral)throw new Error("Collateral consolidation already in progress");this.isConsolidatingCollateral=!0;try{let e=await this.client.getAccountBalance(this.user),{swapped:r,errors:o}=await this.swapCollateralBalancesToUsdc(e.collateralBalances??[]),n=await this.transferSpotUsdcToPerp(r.length>0);return this.syncAccountBalance(),{swapped:r,transferred:n,errors:o}}finally{this.isConsolidatingCollateral=!1}}async swapCollateralBalancesToUsdc(e){let r=[],o=[];for(let n of e){if(n.pairIndex===void 0)continue;let s=new A(n.total).minus(n.hold);if(!s.lte(.01))try{let c=await this.spot.swapCollateralToUsdc(n.pairIndex,n.symbol,s);r.push(c),k.addBreadcrumb(_.Perps,"Swapped collateral to USDC",L.Info,{symbol:n.symbol,amount:s.toString(),usdcReceived:c.usdcReceived})}catch(c){let p=c instanceof Error?c.message:"Unknown error";o.push({symbol:n.symbol,error:p}),k.addBreadcrumb(_.Perps,"Failed to swap collateral to USDC",L.Error,{symbol:n.symbol,error:p})}}return{swapped:r,errors:o}}async transferSpotUsdcToPerp(e){if(!this.user)return"0";let r=e?10:1,o=await this.spot.pollForUsdcBalance(this.user.address,r);if(!o||o.lte(.01))return"0";let n=o.decimalPlaces(2,A.ROUND_DOWN);return await this.transfer({toPerp:!0,amount:n}),k.addBreadcrumb(_.Perps,"Transferred USDC from spot to perp",L.Info,{amount:n.toString()}),n.toString()}async usdSendPerps(e){let{destination:r,amount:o}=e,n=Date.now(),s=new dp({hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",amount:o.toString(),destination:r.toLowerCase(),time:n}),c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UsdSend",types:{EIP712Domain:st,"HyperliquidTransaction:UsdSend":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"amount",type:"string"},{name:"time",type:"uint64"}]},message:s},{splitSignature:p}=await this.sign(c),d=await this.client.postPerpsSend({action:s,nonce:n,signature:p});if(d.status==="err")throw new Error(d.response);return d.response}openPosition(e){this.openPositionOrchestrator.send({type:"InitiateOpenPosition",payload:e})}resetOpenPosition(){this.openPositionOrchestrator.send({type:"Reset"})}getOpenPositionState(){return this.openPositionOrchestrator.getState()}subscribeOpenPosition(e){return this.openPositionOrchestrator.addListener(e),()=>{this.unsubscribeOpenPosition(e)}}unsubscribeOpenPosition(e){this.openPositionOrchestrator.removeListener(e)}managePosition(e){this.managePositionOrchestrator.send({type:"InitiateManagePosition",payload:e})}resetManagePosition(){this.managePositionOrchestrator.send({type:"Reset"})}getManagePositionState(){return this.managePositionOrchestrator.getState()}subscribeManagePosition(e){return this.managePositionOrchestrator.addListener(e),()=>{this.unsubscribeManagePosition(e)}}unsubscribeManagePosition(e){this.managePositionOrchestrator.removeListener(e)}manageMargin(e){this.manageMarginOrchestrator.send({type:"InitiateManageMargin",payload:e})}resetManageMargin(){this.manageMarginOrchestrator.send({type:"Reset"})}getManageMarginState(){return this.manageMarginOrchestrator.getState()}subscribeManageMargin(e){return this.manageMarginOrchestrator.addListener(e)}};function Jo(t,e){if(t==null)throw new Error(e||"Required value is undefined or null");return t}i(Jo,"check");function DC(t){let e=`0x${t.slice(2,66)}`,r=`0x${t.slice(66,130)}`,o=parseInt(t.slice(130,132),16);return{r:e,s:r,v:o}}i(DC,"splitSignature");u();l();var Bn=D(O());var Ne;(function(t){t.FUNDING_INITIALIZED="perpsDepositInitialized",t.FUNDING_INITIATED="perpsDepositInitiated",t.FUNDING_COMPLETED="perpsDepositCompleted",t.FUNDING_FAILED="perpsDepositFailed",t.FUNDING_PAUSED="perpsDepositPaused",t.FUNDING_RESUMED="perpsDepositResumed",t.DEPOSIT_TRANSFER_STARTED="perpsHyperunitDepositTransferStarted",t.DEPOSIT_TRANSFER_COMPLETED="perpsHyperunitDepositTransferCompleted",t.DEPOSIT_STREAM_OPERATIONS_STARTED="perpsHyperunitDepositStreamOperationsStarted",t.DEPOSIT_STREAM_OPERATIONS_COMPLETED="perpsHyperunitDepositStreamOperationsCompleted",t.DEPOSIT_SELL_SPOT_STARTED="perpsHyperunitDepositSellSpotStarted",t.DEPOSIT_SELL_SPOT_COMPLETED="perpsHyperunitDepositSellSpotCompleted",t.DEPOSIT_TRANSFER_TO_PERP_STARTED="perpsHyperunitDepositTransferToPerpStarted",t.DEPOSIT_TRANSFER_TO_PERP_COMPLETED="perpsHyperunitDepositTransferToPerpCompleted"})(Ne||(Ne={}));var Me;(function(t){t.FUNDING_INITIALIZED="perpsWithdrawInitialized",t.FUNDING_COMPLETED="perpsWithdrawCompleted",t.FUNDING_FAILED="perpsWithdrawFailed",t.FUNDING_PAUSED="perpsWithdrawPaused",t.FUNDING_RESUMED="perpsWithdrawResumed",t.PERPS_TO_SPOT_STARTED="perpsHyperunitWithdrawPerpsToSpotStarted",t.PERPS_TO_SPOT_COMPLETED="perpsHyperunitWithdrawPerpsToSpotCompleted",t.BUY_ASSET_STARTED="perpsHyperunitWithdrawBuyAssetStarted",t.BUY_ASSET_COMPLETED="perpsHyperunitWithdrawBuyAssetCompleted",t.SEND_TO_WITHDRAW_ADDRESS_STARTED="perpsHyperunitWithdrawSendToWithdrawAddressStarted",t.SEND_TO_WITHDRAW_ADDRESS_COMPLETED="perpsHyperunitWithdrawSendToWithdrawAddressCompleted",t.WITHDRAW_STREAM_OPERATIONS_STARTED="perpsHyperunitWithdrawStreamOperationsStarted",t.WITHDRAW_STREAM_OPERATIONS_COMPLETED="perpsHyperunitWithdrawStreamOperationsCompleted"})(Me||(Me={}));var BC;(function(t){t.INITIALIZED="perpsFundingInitialized",t.INITIALIZATION_ERROR="perpsFundingInitializationError",t.BELOW_MINIMUM_INPUT_AMOUNT="perpsFundingBelowMinimumInputAmount",t.INSUFFICIENT_BALANCE="perpsFundingInsufficientBalance",t.EXCEEDS_MAXIMUM_LIMIT="perpsFundingExceedsMaximumLimit",t.FUNDABLE="perpsFundingFundable"})(BC||(BC={}));var NC=i(()=>{let t=ue(),e=(0,Bn.useCallback)((s,c)=>{t.capture(s,{data:{...c}}),s===Ne.FUNDING_FAILED&&k.captureError(new Error(`depositFailed: ${c.error}`),_.Perps),s===Me.FUNDING_FAILED&&k.captureError(new Error(`withdrawalFailed: ${c.error}`),_.Perps)},[t]),r=(0,Bn.useCallback)((s,c)=>{e(s,c)},[e]),o=(0,Bn.useCallback)((s,c)=>{e(s,c)},[e]),n=(0,Bn.useCallback)((s,c)=>{e(s,c)},[e]);return(0,Bn.useMemo)(()=>({reportDeposit:r,reportWithdraw:o,reportFundingUIState:n}),[r,o,n])},"useFundingAnalytics");u();l();var Ip=class{static{i(this,"FundingStateLogsListener")}onFundingPoolStateChange(e,r,o){switch(e.type){case"fundingFailed":k.addBreadcrumb(_.Perps,`FundingPool: ${r.type} funding failed`,L.Error,{error:e.error.message,fundingTaskState:r.getState().type});break;case"fundingStarted":case"fundingBridgingStarted":case"fundingCompleted":k.addBreadcrumb(_.Perps,`FundingPool: ${r.type} ${e.type}`,L.Info);break}}};u();l();var kp=class{static{i(this,"FundingToastListener")}onFundingPoolStateChange(e,r,o){switch(r.type){case"deposit":this.onDepositEvent(e,r);break;case"withdraw":this.onWithdrawEvent(e,r);break}}onDepositEvent(e,r){if(!r.silentToasts)switch(e.type){case"fundingStarted":this.progress(v.t("perpsToastInitiatingFunding"));break;case"fundingBridgingStarted":break;case"fundingCompleted":this.success(v.t("perpsToastFundsAdded"));break;case"fundingFailed":this.failed(v.t("perpsToastFundingFailed"),e.error.message,v.t("commandOK"),()=>{ut.getState().hideToast()});break}}onWithdrawEvent(e,r){switch(e.type){case"fundingStarted":this.progress(v.t("perpsToastInitiatingWithdrawal"));break;case"fundingBridgingStarted":break;case"fundingCompleted":this.success(v.t("perpsToastWithdrawalComplete"));break;case"fundingFailed":this.failed(v.t("perpsToastWithdrawalFailed"),e.error.message,v.t("commandOK"),()=>{ut.getState().hideToast()});break}}success(e){setTimeout(()=>{ut.getState().success({message:e,onPress:i(()=>{ut.getState().hideToast()},"onPress")})},100)}failed(e,r,o,n){setTimeout(()=>{ut.getState().failed({title:e,message:r,buttonText:o,onPress:n})},100)}progress(e){setTimeout(()=>{ut.getState().progress({message:e,onPress:i(()=>{ut.getState().hideToast()},"onPress")})},100)}};u();l();u();l();u();l();u();l();u();l();u();l();u();l();var Ma=class{static{i(this,"RelayBridge")}account;authRepository;cashAccount;signer;solanaConnection;storage;constructor(e){this.account=e.account,this.authRepository=e.authRepository,this.cashAccount=e.cashAccount,this.signer=e.signer,this.solanaConnection=e.solanaConnection,this.storage=e.storage}getSolanaAddress(){let e=this.account.addresses.find(r=>r.addressType===se.Solana);if(!e)throw new Error("No Solana address found for account");return e.address}isCash(e){return e?.resourceType!==V.address||!this.cashAccount?!1:this.cashAccount.addressDetails.address===e.address}getTakerAddress(e){return e?.resourceType===V.address&&this.isCash(e)?e.address:this.getSolanaAddress()}getEvmAddress(){let e=this.account.addresses.find(r=>r.addressType===se.EVM);if(!e)throw new Error("No EVM address found for account");return e.address}async fetchQuotes(e){let r=this.getTakerAddress(e.fromTokenOwner),o=_o("kill-cash-perps-quote-chain-addresses"),n=this.getEvmAddress(),s=this.isCash(e.fromTokenOwner),c=this.account.addresses.reduce((d,m)=>({...d,[m.networkID]:m.address}),{}),p={sellToken:e.fromToken,buyToken:e.toToken,taker:{chainId:e.fromChain,address:r,resourceType:V.address},takerDestination:{chainId:e.toChain,address:n.toLowerCase(),resourceType:V.address},sellAmount:e.amount.toString(),slippageTolerance:(e.slippageBps??100)/100,phantomCashAccount:s,chainAddresses:o?void 0:c};k.addBreadcrumb(_.Perps,"Fetching Relay quotes",L.Info,{sellAmount:p.sellAmount,sellToken:N(p.sellToken),buyToken:N(p.buyToken),fromChain:p.sellToken.chainId,toChain:p.buyToken.chainId});try{let d=await z.api().retry(1,Je(1e3,1e3)).post("/swap/v2/quotes",p);if(d.status!==200)throw new Error(`Failed to fetch quotes: ${d.status}`);let m=d.data;return k.addBreadcrumb(_.Perps,"Relay quotes fetched",L.Info,{quotesCount:m.quotes.length,firstQuoteBuyAmount:m.quotes[0]?.buyAmount}),m.quotes}catch(d){throw k.addBreadcrumb(_.Perps,"Failed to fetch Relay quotes",L.Error,{error:d instanceof Error?d.message:"Unknown error"}),d}}async executeSwap(e,r,o=ar.Mainnet){let n=this.getTakerAddress(r),s=this.isCash(r),c=await _M(n,e,this.solanaConnection);try{k.addBreadcrumb(_.Perps,"Executing Relay swap",L.Info,{buyAmount:e.buyAmount,sellAmount:e.sellAmount});let p=Oe(),d=await this.authRepository?.getUser();if(!d)throw new Error("User not found for swap");let{accessToken:m,userID:f}=d,g;return s?g=await ea({unsignedTransaction:Tg(c),vaultProxy:this.signer,accountIdentifier:this.account.identifier,signerAddress:n,idempotencyKey:p,isCash:!0,accessToken:m,userID:f,skipActivityRecording:!1,swapInfo:void 0,perpsInfo:{type:"funding"},waitForActivityState:He.Completed}):(g=await ts({accountIdentifier:this.account.identifier,accountSigner:this.signer,transaction:c,feePayer:new ge.PublicKey(n),connection:this.solanaConnection,storage:this.storage,pendingTransactionInput:{ownerAddress:n,networkID:o,data:{signature:""},type:ft.DappInteraction,display:{summary:{topLeft:{text:"Deposit"}}}}}),await No({connection:this.solanaConnection,signature:g})),k.addBreadcrumb(_.Perps,"Relay swap transaction sent",L.Info,{signature:g}),g}catch(p){throw k.addBreadcrumb(_.Perps,"Failed to send Relay swap transaction",L.Error,{error:p instanceof Error?p.message:"Unknown error"}),p}}};async function _M(t,e,r){let o=It(e.steps[0]?.transactionData,"bs58");o=await es(o,{connection:r});let n=new ge.PublicKey(t);return await Xa(o,r),xg(o,n),o}i(_M,"transactionFromQuote");u();l();var vM=a.object({status:a.enum(["waiting","success","failure","refund","delayed","pending"]),requestId:a.string().optional()}),Nn=class{static{i(this,"RelayBridgeStatusPoller")}pollInterval=null;listeners=new Set;POLL_INTERVAL_MS=1e3;MAX_POLL_ATTEMPTS=45;pollAttempts=0;subscribe(e){this.listeners.add(e)}unsubscribe(e){this.listeners.delete(e)}startPolling(e){this.pollAttempts=0,this.poll(e)}stopPolling(){this.pollInterval&&(clearTimeout(this.pollInterval),this.pollInterval=null)}async poll(e){this.pollAttempts++;try{let r=await this.fetchBridgeStatus(e);if(this.listeners.forEach(o=>o.onStatusUpdate(r)),r.status==="success"){k.addBreadcrumb(_.Perps,`Relay bridge completed for request: ${e}`,L.Info,{requestId:e}),this.listeners.forEach(o=>o.onCompleted(r)),this.stopPolling();return}if(r.status==="failure"||r.status==="refund"){let o=new Error(`Relay bridge failed with status: ${r.status} for request: ${e}`);k.addBreadcrumb(_.Perps,"Relay bridge failed",L.Error,{requestId:e,status:r.status}),this.listeners.forEach(n=>n.onError(o)),this.stopPolling();return}if(r.status!=="waiting"&&r.status!=="pending"&&r.status!=="delayed"){let o=new Error(`Unexpected Relay bridge status: ${r.status} for request: ${e}`);k.addBreadcrumb(_.Perps,"Relay bridge unexpected status",L.Error,{requestId:e,status:r.status}),this.listeners.forEach(n=>n.onError(o)),this.stopPolling();return}if(this.pollAttempts>=this.MAX_POLL_ATTEMPTS){let o=new Error(`Relay bridge status polling timed out with status: ${r.status} for request: ${e}`);k.addBreadcrumb(_.Perps,"Relay bridge polling timeout",L.Error,{requestId:e,finalStatus:r.status,attempts:this.pollAttempts}),this.listeners.forEach(n=>n.onError(o)),this.stopPolling();return}this.pollInterval=setTimeout(()=>{this.poll(e)},this.POLL_INTERVAL_MS)}catch(r){k.addBreadcrumb(_.Perps,`Error polling Relay bridge status for request: ${e}`,L.Error,{error:r instanceof Error?r.message:"Unknown error",requestId:e,attempts:this.pollAttempts}),this.listeners.forEach(o=>o.onError(r)),this.stopPolling()}}async fetchBridgeStatus(e){let r=await z.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/get-intents-status",{params:{requestId:e}});if(!te(r))throw new Error("Failed to get bridge status: response is not okay");let o=r.data,n=vM.safeParse(o);if(!n.success)throw new Error("Failed to get bridge status: schema validation failed");return n.data}};u();l();var yr=class{static{i(this,"FundingTask")}startedAt;type;minimumUiAmount;amount;amountUsd;estimatedTime;fee;withdrawAddress;withdrawAddressRole;state={type:"indeterminate"};listeners=new Set;constructor(e,r,o,n,s,c){this.startedAt=Date.now(),this.type=e,this.minimumUiAmount=r,this.estimatedTime=o,this.fee=n,this.withdrawAddress=s,this.withdrawAddressRole=c}getState(){return this.state}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notify(e,r){this.listeners.forEach(o=>o.onFundingTaskStateChange(this,e,r))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};var LC=250,RM=.05,Ua=class t extends yr{static{i(this,"RelayBridgeTask")}perps;account;authRepository;cashAccount;signer;storage;fromToken;fromTokenOwner;fromTokenDecimals;toToken;toTokenDecimals;fromChain;toChain;relayBridge;connection;bridgeListeners=new Set;quote;isFetchingQuote=!1;statusPoller;analytics;depositId;constructor(e,r,o,n,s,c,p,d,m,f,g,y,w,S,b,T,x){super("deposit",e,"",r),this.perps=o,this.account=n,this.authRepository=s,this.cashAccount=c,this.signer=p,this.storage=d,this.fromToken=m,this.fromTokenOwner=f,this.fromTokenDecimals=g,this.toToken=y,this.toTokenDecimals=w,this.fromChain=S,this.toChain=b,this.analytics=T,this.depositId=x||Oe(),this.connection=Jn(ar.Mainnet),this.relayBridge=new Ma({account:n,authRepository:s,cashAccount:c,signer:p,solanaConnection:this.connection,storage:d}),this.statusPoller=new Nn,this.reportAnalytics(Ne.FUNDING_INITIALIZED,{})}reportAnalytics(e,r){let o={fundingType:"deposit",fundingRoute:gr.Relay,amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,fromToken:N(this.fromToken),toToken:N(this.toToken),fromChain:this.fromChain,toChain:this.toChain,depositId:this.depositId};this.analytics.reportDeposit(e,{...o,...r})}addBridgeListener(e){this.bridgeListeners.add(e)}removeBridgeListener(e){this.bridgeListeners.delete(e)}notifyBridgeListeners(e,...r){this.bridgeListeners.forEach(o=>{let n=o[e];typeof n=="function"&&n.call(o,...r)})}async fetchQuote(e,r){this.isFetchingQuote=!0;try{let o=e.shiftedBy(this.fromTokenDecimals),n=await this.relayBridge.fetchQuotes({amount:o.toNumber(),fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:LC});return n.length===0?(this.isFetchingQuote=!1,null):(this.quote=n[0],this.fee=new A(this.quote.steps[0]?.feeCosts?.[0]?.value??RM),k.addBreadcrumb(_.Perps,"Relay quote fetched",L.Info,{inputAmount:e.toString(),tokenPrice:r.toString(),inputUsd:e.toString(),outputUsd:e.toString(),feeUsd:this.fee.toString(),buyAmount:this.quote.buyAmount,sellAmount:this.quote.sellAmount,fromTokenDecimals:this.fromTokenDecimals,toTokenDecimals:this.toTokenDecimals}),this.notifyBridgeListeners("onQuoteFetched",this.quote),this.quote)}catch(o){return k.addBreadcrumb(_.Perps,"Failed to fetch Relay quote",L.Info,{error:o instanceof Error?o.message:"Unknown error"}),this.isFetchingQuote=!1,null}finally{this.isFetchingQuote=!1}}async execute(e,r,o){this.startedAt=Date.now(),this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),this.reportAnalytics(Ne.FUNDING_INITIATED,{});try{k.addBreadcrumb(_.Perps,"Fetching Relay bridge quotes",L.Info,{amount:o,fromChain:this.fromChain,toChain:this.toChain});let n=new A(o).shiftedBy(this.fromTokenDecimals),s=await this.relayBridge.fetchQuotes({amount:n.toNumber(),fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:LC});if(s.length===0)throw new Error("No quotes available for bridge");this.quote=s[0],this.notifyBridgeListeners("onQuoteFetched",this.quote),this.notify({type:"fundingBridgingStarted"},this.state),this.notifyBridgeListeners("onBridgeStarted"),k.addBreadcrumb(_.Perps,"Executing Relay bridge swap",L.Info,{buyAmount:this.quote.buyAmount,sellAmount:this.quote.sellAmount});let c=await this.relayBridge.executeSwap(this.quote,this.fromTokenOwner);k.addBreadcrumb(_.Perps,"Relay bridge transaction submitted",L.Info,{txHash:c}),this.notifyBridgeListeners("onBridgeCompleted",c);let p=this.quote.steps[0].id;if(!p)throw new Error("No request ID found in Relay quote");this.startPollingForCompletion(p)}catch(n){let s=n;this.state={type:"failed",error:s},this.notify({type:"fundingFailed",error:s},this.state),this.notifyBridgeListeners("onBridgeFailed",s),k.addBreadcrumb(_.Perps,"Relay bridge failed",L.Error,{error:s.message}),this.reportAnalytics(Ne.FUNDING_FAILED,{error:JSON.stringify(s)})}}pause(){this.statusPoller.stopPolling(),k.addBreadcrumb(_.Perps,"Relay bridge pause requested - stopped polling",L.Info),this.reportAnalytics(Ne.FUNDING_PAUSED,{})}resume(){k.addBreadcrumb(_.Perps,"Relay bridge resume requested (no-op)",L.Info),this.reportAnalytics(Ne.FUNDING_RESUMED,{})}getFee(){return this.fee}startPollingForCompletion(e){let r={onStatusUpdate:i(o=>{k.addBreadcrumb(_.Perps,"Relay bridge status update",L.Info,{requestId:e,status:o.status})},"onStatusUpdate"),onCompleted:i(o=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),k.addBreadcrumb(_.Perps,"Relay bridge funds received",L.Info,{requestId:e}),this.reportAnalytics(Ne.FUNDING_COMPLETED,{}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.statusPoller.unsubscribe(r)},"onCompleted"),onError:i(o=>{k.addBreadcrumb(_.Perps,"Relay bridge polling error",L.Error,{error:o.message,requestId:e}),this.statusPoller.unsubscribe(r),this.reportAnalytics(Ne.FUNDING_FAILED,{error:JSON.stringify(o)})},"onError")};this.statusPoller.subscribe(r),this.statusPoller.startPolling(e)}static create({minimumUiAmount:e,fee:r,perps:o,account:n,authRepository:s,cashAccount:c,signer:p,storage:d,fromToken:m,fromTokenOwner:f,fromTokenDecimals:g,toToken:y,toTokenDecimals:w,fromChain:S,toChain:b,analytics:T,depositId:x}){return new t(e,r,o,n,s,c,p,d,m,f,g,y,w,S,b,T,x)}};u();l();var Oa=class extends yr{static{i(this,"RelayWithdrawTask")}withdrawNetworkId;toTokenDecimals;perps;analytics;statusPoller;requestId;toTokenCaip19;fundingCaip19Address;constructor(e,r,o,n,s,c,p,d,m,f){super("withdraw",n,s,c,d,"user"),this.withdrawNetworkId=e,this.toTokenDecimals=r,this.perps=o,this.analytics=p,this.toTokenCaip19=m,this.fundingCaip19Address=f.fundingCaip19Address,this.statusPoller=new Nn,this.reportAnalytics(Me.FUNDING_INITIALIZED,{provider:gr.Relay})}reportAnalytics(e,r){let o={fundingType:"withdraw",fundingRoute:gr.Relay,amount:this.amount,amountUsd:this.amountUsd,withdrawAddress:this.withdrawAddress??"",withdrawNetworkId:this.withdrawNetworkId,minimumUiAmount:this.minimumUiAmount.toString(),estimatedTime:this.estimatedTime,fee:this.fee.toString()};this.analytics.reportWithdraw(e,{...o,...r})}pause(){this.statusPoller.stopPolling(),k.addBreadcrumb(_.Perps,"Relay withdrawal pause requested - stopped polling",L.Info),this.reportAnalytics(Me.FUNDING_PAUSED,{})}resume(){k.addBreadcrumb(_.Perps,"Relay withdrawal resume requested (no-op)",L.Info),this.reportAnalytics(Me.FUNDING_RESUMED,{})}async execute(e,r,o,n){this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state);try{if(k.addBreadcrumb(_.Perps,"Starting relay withdrawal",L.Info,{amount:o,amountUsd:r,withdrawAddress:this.withdrawAddress??""}),this.reportAnalytics(Me.FUNDING_INITIALIZED,{}),!this.perps.user)throw new Error("No perps user available");let s=N(this.toTokenCaip19),c=e.shiftedBy(this.toTokenDecimals??8).toFixed(0),p=N({chainId:this.withdrawNetworkId,resourceType:V.address,address:this.withdrawAddress??""});k.addBreadcrumb(_.Perps,"Initializing relay bridge for withdrawal",L.Info,{sellAmount:c,buyToken:s,takerDestination:p});let d=await this.perps.client.getSpotBridgeInitialize({buyToken:s,sellAmount:c,takerDestination:p,bridgeProvider:gr.Relay});this.requestId=d.requestId;let m=d.depositAddress.address;k.addBreadcrumb(_.Perps,"Relay bridge initialized",L.Info,{requestId:this.requestId,depositAddress:m}),this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),k.addBreadcrumb(_.Perps,"Sending USDC from perps to relay deposit address",L.Info,{depositAddress:m,amount:e.toString()}),this.reportAnalytics(Me.SEND_TO_WITHDRAW_ADDRESS_STARTED,{depositAddress:m,requestId:this.requestId}),await this.perps.usdSendPerps({destination:m,amount:e}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),k.addBreadcrumb(_.Perps,"Sent USDC from perps to relay deposit address",L.Info,{depositAddress:m,amount:e.toString()}),this.reportAnalytics(Me.SEND_TO_WITHDRAW_ADDRESS_COMPLETED,{depositAddress:m}),this.startPollingForCompletion(this.requestId)}catch(s){let c=s instanceof Error?s:new Error("Unknown error");k.addBreadcrumb(_.Perps,"Relay withdrawal failed",L.Error,{error:c.message}),this.state={type:"failed",error:c},this.notify({type:"fundingFailed",error:c},this.state),this.reportAnalytics(Me.FUNDING_FAILED,{error:c.message})}}startPollingForCompletion(e){let r={onStatusUpdate:i(o=>{k.addBreadcrumb(_.Perps,"Relay withdrawal status update",L.Info,{requestId:e,status:o.status})},"onStatusUpdate"),onCompleted:i(o=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),k.addBreadcrumb(_.Perps,"Relay withdrawal completed",L.Info,{requestId:e}),this.reportAnalytics(Me.FUNDING_COMPLETED,{requestId:e}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.statusPoller.unsubscribe(r)},"onCompleted"),onError:i(o=>{k.addBreadcrumb(_.Perps,"Relay withdrawal polling error",L.Error,{error:o.message,requestId:e}),this.statusPoller.unsubscribe(r),this.reportAnalytics(Me.FUNDING_FAILED,{error:JSON.stringify(o)})},"onError")};this.statusPoller.subscribe(r),this.statusPoller.startPolling(e)}};u();l();var DM=5,BM={chainId:Ci.Mainnet,address:"0x00000000000000000000000000000000",resourceType:V.address},NM=8,Fp=class{static{i(this,"RelayBridgeFundingTaskFactory")}analytics;constructor(e){this.analytics=e}async createWithdrawTask(e,r,o){let n=r.addresses.find(m=>m.networkID===o);if(!n)throw new Error("Couldn't find destination account address for network: "+o);let s=n.address,c={chainId:o,resourceType:V.nativeToken,slip44:I.getSlip44(o)},p={chainId:o,resourceType:V.address,address:s},d=await e.client.postFunding({type:"withdraw",taker:N(p),originChain:o});return new Oa(o,NM,e,new A(d.minimumAmount),"5 seconds",new A(d.fee),this.analytics,s,c,{fundingCaip19Address:d.fundingCaip19Address})}async fetchTokenInfo(e,r,o,n,s){let c=e.addresses.find(y=>y.networkID===o);if(!c)throw new Error("Couldn't find result address for network: "+o);let p=new fo,d={type:"swap",network:o,sellCaip19:N(n),buyCaip19:"solana:101/nativeToken:501",takerCaip19:s?N(s):void 0,takerDestinationCaip19:void 0},m=$i(r),f=await p.initialize(d,[c],m);if(!f.sellTokenPrice?.usd)throw new Error("No price available for token");let g=f.sellToken;return{priceUsd:new A(f.sellTokenPrice.usd),decimals:g.data.decimals}}async createTask(e,r,o,n,s,c,p,d){if(d.type==="withdraw")return this.createWithdrawTask(e,r,d.withdrawNetworkId);let{depositTokenCaip19:m,depositTokenWalletCaip19:f}=d,{priceUsd:g,decimals:y}=await this.fetchTokenInfo(r,n,m.chainId,m,f),w=new A(DM).dividedBy(g);return Ua.create({minimumUiAmount:w,estimatedTime:"5 seconds",fee:new A(0),perps:e,account:r,authRepository:o,cashAccount:n,signer:c,storage:s,fromToken:m,fromTokenOwner:f,fromTokenDecimals:y,toToken:BM,toTokenDecimals:18,fromChain:ar.Mainnet,toChain:Ci.Mainnet,analytics:this.analytics,depositId:d.depositId})}};u();l();var gBe=new A(5);var LM=10,Sh=class{static{i(this,"WarmFundingCache")}entries=new Map;refreshes=new Map;get(e,r){return this.entries.get(wh(e,r))}set(e,r,o){let n=wh(e,r);if(this.entries.set(n,o),this.entries.size>LM){let s=Array.from(this.entries.keys())[0];this.entries.delete(s)}}delete(e,r){this.entries.delete(wh(e,r))}keys(){return Array.from(this.entries.keys())}getByKey(e){return this.entries.get(e)}setRefresh(e,r){this.refreshes.set(e,r),r.finally(()=>this.refreshes.delete(e))}hasRefresh(e){return this.refreshes.has(e)}},yh=new Sh;function wh(t,e){let o={account:[...e.account.addresses].map(n=>`${n.networkID}:${n.address}`.toLowerCase()).sort().join("|")};return t.type==="deposit"?JSON.stringify({...o,type:"deposit",depositTokenCaip19:t.depositTokenCaip19,depositTokenWalletCaip19:t.depositTokenWalletCaip19,depositId:t.depositId}):JSON.stringify({...o,type:"withdraw",withdrawNetworkId:t.withdrawNetworkId})}i(wh,"getFundingCacheKey");function MC(t){let e=MM(t.account);for(let r of yh.keys())if(r.includes(`"account":"${e}"`)){let o=yh.getByKey(r);if(o){let n={...t};yh.delete(o.params,n)}}}i(MC,"invalidateAllForAccount");function MM(t){return[...t.addresses].map(e=>`${e.networkID}:${e.address}`.toLowerCase()).sort().join("|")}i(MM,"accountFingerprint");var Pp=class{static{i(this,"FundingWarmCacheListener")}getContext;constructor(e){this.getContext=e}onFundingPoolStateChange(e,r,o){if(e.type!=="fundingCompleted")return;let n=this.getContext();n&&MC(n)}};u();l();var UC="failedFundingEvents";var _p=class{static{i(this,"FailedFundingEventsCache")}storage;listeners=[];storageKey;accountId;constructor(e,r){this.storage=e,this.accountId=r,this.storageKey=this.generateStorageKey()}async setAccountId(e){if(this.accountId===e)return;this.accountId=e,this.storageKey=this.generateStorageKey();let r=await this.getEvents();this.notifyListeners(r)}generateStorageKey(){return this.accountId?`${UC}_${this.accountId}`:UC}async addEvent(e){let r=await this.getEvents(),o={id:`${e.type}_${e.startedAt}_${e.amountUsd}`,type:e.type,amountUsd:e.amountUsd||"0",timestamp:Date.now(),startedAt:e.startedAt,errorMessage:e.getState().type==="failed"?e.getState().error?.message:void 0};r.some(s=>s.id===o.id)||(r.unshift(o),r.length>25&&r.splice(25),await this.storage.set(this.storageKey,r),this.notifyListeners(r))}async getEvents(){let e=await this.storage.get(this.storageKey);return Array.isArray(e)?e:[]}async clear(){await this.storage.remove(this.storageKey),this.notifyListeners([])}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(e){for(let r of this.listeners)r.onFailedEventsChange(e)}};u();l();var vp=class{static{i(this,"FundingPool")}activeTasks=new Set;listeners=new Set;failedEventsCache;constructor(e){this.failedEventsCache=e}setFailedEventsCache(e){this.failedEventsCache=e}async setAccountId(e){await this.failedEventsCache?.setAccountId(e)}submit(e,r,o,n,s){e.addListener(this.taskListener),this.activeTasks.add(e),e.execute(r,o,n,s)}getActiveTasks(){return Array.from(this.activeTasks)}getFailedEventsCache(){return this.failedEventsCache}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}pauseTasks(){this.activeTasks.forEach(e=>e.pause())}resumeTasks(){this.activeTasks.forEach(e=>e.resume())}taskListener={onFundingTaskStateChange:i((e,r,o)=>{switch(r.type){case"fundingStarted":break;case"fundingCompleted":this.activeTasks.delete(e),e.removeListener(this.taskListener);break;case"fundingFailed":e.removeListener(this.taskListener),this.failedEventsCache?.addEvent(e);break}this.listeners.forEach(n=>n.onFundingPoolStateChange(r,e,this.getActiveTasks()))},"onFundingTaskStateChange")}};u();l();u();l();u();l();u();l();var UM="perps_deposit_step";var Rp=class{static{i(this,"DepositStepCache")}storage;listeners=[];userAddress=null;constructor(e){this.storage=e}setUserAddress(e){this.userAddress=e}getKey(){if(!this.userAddress)throw new Error("User address not set");return`${UM}_${this.userAddress}`}set(e,r){(async()=>{let o={step:e,startedAt:r||Date.now()};await this.storage.set(this.getKey(),o),this.notifyListeners(o)})()}clear(){(async()=>(await this.storage.remove(this.getKey()),this.notifyListeners(null)))()}async get(){if(!this.userAddress)return null;let e=await this.storage.get(this.getKey());if(!e)return null;let r=e;return Date.now()-r.startedAt>12e5?(this.clear(),null):r}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(e){for(let r of this.listeners)r.onDepositStepChange(e)}};u();l();function OC(t){return t.type==="idle"?"idle":t.type==="streamOperations"?`${t.sourceTxHash}:${t.depositAddress}`:`${t.type}:${t.depositAddress}`}i(OC,"getDepositId");var bh=null;function OM(t){return bh||(bh=new Rp(t)),bh}i(OM,"getDepositStepCache");var Dp=class{static{i(this,"DepositRecoverer")}perps;cache;analytics;constructor(e,r,o){this.perps=e,this.cache=OM(r),this.perps.user&&this.cache.setUserAddress(N(this.perps.user)),this.analytics=o}async getStuckDeposit(){this.perps.user&&this.cache.setUserAddress(N(this.perps.user));let e=await this.cache.get();return e?.step.type==="transfer"?(this.cache.clear(),null):e}async retry(e){if(e.type!=="streamOperations"){this.cache.clear();return}let r=OC(e);try{let o=await this.pollForOperationCompletion(e);if(!o.destinationAmount)throw this.cache.clear(),new Error("Operation has no destination amount");let{destinationAmount:n}=o,s=await this.perps.spot.getTokenMidPrice(e.spotTokenId),{totalSz:c,avgPx:p}=await this.sellSpotAsset(new A(n),e.assetId,s,e.tokenDecimals,r);await this.transferToPerps(c,p,r),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.cache.clear()}catch{this.cache.clear();return}}async pollForOperationCompletion(e){let n=!1;for(let s=0;s<15;s++){let c=await this.perps.client.getOperations({taker:N(this.perps.user)}),p=`${e.sourceTxHash}:${e.depositAddress}`,d=c.operations.find(m=>m.sourceTxHash===p);if(d){if(n=!0,d.state==="failure")throw new Error("Operation failed");if(d.state==="done")return d}s<14&&await new Promise(m=>setTimeout(m,5e3))}throw n?new Error("Operation not done after maximum attempts"):new Error("Operation not found")}async sellSpotAsset(e,r,o,n,s){let c=e.shiftedBy(-n).decimalPlaces(3,A.ROUND_DOWN),p=await this.perps.spot.sell(r,c.toString(),o);return this.analytics.reportDeposit(Ne.DEPOSIT_SELL_SPOT_COMPLETED,{depositId:s,assetId:r,assetLimitPriceUsd:o,tokenDecimals:n,adjustedDepositedAmount:c}),{totalSz:new A(p.totalSz),avgPx:new A(p.avgPx)}}async transferToPerps(e,r,o){let n=e.multipliedBy(r).decimalPlaces(2,A.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:n}),this.analytics.reportDeposit(Ne.DEPOSIT_TRANSFER_TO_PERP_COMPLETED,{depositId:o,totalSz:e,avgPx:r,transferUsdcAmount:n}),n}};u();l();var Bp=class{static{i(this,"HyperunitDepositStateMachine")}step={type:"idle"};listeners=[];setStep(e){this.step=e}completeStep(e){let r=this.step,o=this.detectNextStep(e);if(!o){this.listeners.forEach(n=>n.onStepCompleted(this.step,void 0)),this.listeners.forEach(n=>n.onDepositCompleted());return}this.step=o,this.listeners.forEach(n=>n.onStepCompleted(r,o))}detectNextStep(e){switch(e.stepType){case"idle":return{type:"transfer",depositAddress:e.depositAddress,depositAmount:e.amount};case"transfer":if(this.step.type!=="transfer")throw new Error("Invalid step: expected transfer, got "+this.step.type);return{...this.step,type:"streamOperations",senderAddress:e.senderAddress,networkId:e.networkId,tokenDecimals:e.tokenDecimals,sourceTxHash:e.txHash,assetId:e.assetId,spotTokenId:e.spotTokenId,assetLimitPriceUsd:e.assetLimitPriceUsd};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return{...this.step,type:"sellSpotAsset",destinationAmount:e.destinationAmount};case"sellSpotAsset":if(this.step.type!=="sellSpotAsset")throw new Error("Invalid step: expected sellSpotAsset, got "+this.step.type);return{...this.step,type:"transferToPerps",totalSz:e.totalSz,avgPx:e.avgPx};case"transferToPerps":if(this.step.type!=="transferToPerps")throw new Error("Invalid step: expected transferToPerps, got "+this.step.type);return}}failStep(e){this.listeners.forEach(r=>r.onDepositFailed(this.step,e))}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}getStep(){return this.step}};u();l();var Th=class{static{i(this,"SolanaDepositTransfer")}sourceAddress;networkId;account;constructor(e,r,o){this.sourceAddress=e,this.networkId=r,this.account=o}async execute(e,r,o,n){let s=Jn(this.networkId),c=new Cg.Transaction().add(ge.SystemProgram.transfer({fromPubkey:new ge.PublicKey(this.sourceAddress),toPubkey:new ge.PublicKey(r),lamports:e.toNumber()}));c=await es(c,{connection:s}),c.feePayer=new ge.PublicKey(this.sourceAddress),await Ag(c,s);let p=await ts({accountIdentifier:this.account.identifier,feePayer:new ge.PublicKey(this.sourceAddress),connection:s,accountSigner:n,transaction:c,pendingTransactionInput:{ownerAddress:this.sourceAddress,networkID:this.networkId,data:{signature:""},type:ft.DappInteraction,display:{summary:{topLeft:{text:"Deposit"}}}},storage:o});return await No({connection:s,signature:p}),{senderAddress:this.sourceAddress,networkId:this.networkId,tokenDecimals:9,txHash:p}}},Np=class{static{i(this,"DepositTransferFactory")}create(e,r){let o=e.chainId,n=r.addresses.find(s=>s.networkID===o)?.address;if(!n)throw new Error(`No source address found for networkID: ${o}`);if(I.isSolanaNetworkID(o))return new Th(n,o,r);throw new Error(`Unsupported chain for deposit transfer: ${o}`)}};u();l();function Ah(t){switch(t.type){case"transfer":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString()};case"streamOperations":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString(),networkId:t.networkId,sourceTxHash:t.sourceTxHash};case"sellSpotAsset":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString(),networkId:t.networkId,sourceTxHash:t.sourceTxHash,destinationAmount:t.destinationAmount.toString()};case"transferToPerps":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString(),networkId:t.networkId,sourceTxHash:t.sourceTxHash,destinationAmount:t.destinationAmount.toString(),totalSz:t.totalSz.toString(),avgPx:t.avgPx.toString()};default:return{step:t.type}}}i(Ah,"getDepositStepLogsDetails");var xh=i(t=>{switch(t.type){case"perpsToSpot":case"buyAsset":return{assetId:t.assetId.toString(),withdrawAddress:t.withdrawAddress,withdrawAmountUsd:t.withdrawAmountUsd.toString()};case"sendToWithdrawAddress":return{assetId:t.assetId.toString(),withdrawAddress:t.withdrawAddress,withdrawAmountUsd:t.withdrawAmountUsd.toString(),assetMidPrice:t.assetMidPrice.toString(),filledAmount:t.filledAmount.toString()};case"streamOperations":return{assetId:t.assetId.toString(),withdrawAddress:t.withdrawAddress,withdrawAmountUsd:t.withdrawAmountUsd.toString(),sendToWithdrawAmount:t.sendToWithdrawAmount.toString(),operationStartTime:t.operationStartTime.toISOString()};default:return{step:t.type}}},"getWithdrawStepLogsDetails");u();l();var li=class{static{i(this,"OperationsStreamer")}perpsClient;streamOpen=!1;listeners=[];interval=2e3;constructor(e){this.perpsClient=e}startStream(e,r,o){this.streamOpen=!0,this.stream(N(e),r,o)}startWithdrawStream(e,r,o){this.streamOpen=!0,this.streamWithdraw(N(e),r,o)}stream(e,r,o){this.streamOpen&&(async()=>{try{let n=await this.perpsClient.getOperations({taker:e}),s=`${r}:${o}`,c=n.operations.find(p=>p.sourceTxHash===s);this.listeners.forEach(p=>{p.onOperation(n,c)}),this.streamOpen&&setTimeout(()=>this.stream(e,r,o),this.interval)}catch(n){this.listeners.forEach(s=>{s.onError(n)}),this.stopStream()}})()}streamWithdraw(e,r,o){this.streamOpen&&(async()=>{try{let n=await this.perpsClient.getOperations({taker:e}),s=this.findMatchingWithdrawOperation(n.operations,r,o);this.listeners.forEach(c=>{c.onOperation(n,s)}),this.streamOpen&&setTimeout(()=>this.streamWithdraw(e,r,o),this.interval)}catch(n){this.listeners.forEach(s=>{s.onError(n)}),this.stopStream()}})()}findMatchingWithdrawOperation(e,r,o){let n=e.filter(s=>{if(s.sourceChain!=="hyperliquid"||s.destinationChain!=="solana"||!s.opCreatedAt)return!1;let c=new Date(s.opCreatedAt).getTime(),p=Math.abs(c-r.getTime()),d=4*60*1e3;if(p>d)return!1;if(s.sourceAmount){let m=new A(s.sourceAmount).dividedBy(10**Tn.data.decimals),f=o,g=m.minus(f).abs(),y=f.multipliedBy(.1);if(g.isGreaterThan(y))return!1}return!0});if(n.length!==0)return n.sort((s,c)=>new Date(c.opCreatedAt).getTime()-new Date(s.opCreatedAt).getTime())[0]}stopStream(){this.streamOpen=!1}subscribe(e){return this.listeners.push(e),()=>this.unsubscribe(e)}unsubscribe(e){this.listeners=this.listeners.filter(r=>r!==e)}};var Lp=class t extends yr{static{i(this,"HyperunitDepositTask")}perps;assetId;spotTokenId;depositTokenCaip19;account;depositAddress;storage;signer;stateMachine=new Bp;depositTransferFactory=new Np;operationsStreamer;depositRecoverer;fundingState="active";analytics;depositId;constructor(e,r,o,n,s,c,p,d,m,f,g,y,w){super("deposit",e,r,o),this.perps=n,this.assetId=s,this.spotTokenId=c,this.depositTokenCaip19=p,this.account=d,this.depositAddress=m,this.storage=f,this.signer=g,this.analytics=y,this.stateMachine.addListener(this.stateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new li(this.perps.client),this.depositRecoverer=new Dp(this.perps,this.storage,this.analytics),this.perps.user&&this.depositRecoverer.cache.setUserAddress(N(this.perps.user)),this.depositId=w||Oe(),this.reportAnalytics(Ne.FUNDING_INITIALIZED,{})}reportAnalytics(e,r){let o={fundingType:"deposit",fundingRoute:gr.Hyperunit,amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,assetId:this.assetId,spotTokenId:this.spotTokenId,depositTokenCaip19:N(this.depositTokenCaip19),depositAddress:this.depositAddress,depositId:this.depositId};this.analytics.reportDeposit(e,{...o,...r})}stateMachineListener={onStepCompleted:i((e,r)=>{this.fundingState!=="paused"&&(e.type==="transfer"&&this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),r&&(this.depositRecoverer.cache.set(r,this.startedAt),this.executeStep(r)))},"onStepCompleted"),onDepositCompleted:i(()=>{this.depositRecoverer.cache.clear(),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics(Ne.FUNDING_COMPLETED,{})},"onDepositCompleted"),onDepositFailed:i((e,r)=>{console.error(`Deposit failed at step: ${e.type}`,r),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"failed",error:r},this.notify({type:"fundingFailed",error:r},this.state),this.reportAnalytics(Ne.FUNDING_FAILED,{error:JSON.stringify(r)})},"onDepositFailed")};stateLogsListener={onStepCompleted:i((e,r)=>{k.addBreadcrumb(_.Perps,`Deposit step completed: ${e.type}`,L.Info,{...Ah(e),amountUsd:this.amountUsd??""})},"onStepCompleted"),onDepositCompleted:i(()=>{this.stateMachine.removeListener(this.stateLogsListener)},"onDepositCompleted"),onDepositFailed:i((e,r)=>{k.addBreadcrumb(_.Perps,`Deposit failed at step: ${e.type}`,L.Error,{error:r instanceof Error?r.message:"Unknown error",...Ah(e),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)},"onDepositFailed")};execute(e,r,o,n){if(this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),n){this.stateMachine.setStep(n.state),this.stateMachine.completeStep(n.completedStep);return}this.stateMachine.completeStep({stepType:"idle",depositAddress:this.depositAddress,amount:e})}pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics(Ne.FUNDING_PAUSED,{})}resume(){this.fundingState="active";let e=this.stateMachine.getStep();e.type==="streamOperations"&&((async()=>{try{if(!this.perps.user)return;let r=await this.perps.client.getOperations({taker:N(this.perps.user)}),o=`${e.sourceTxHash}:${e.depositAddress}`,n=r.operations.find(s=>s.sourceTxHash===o);n&&n.state==="done"?this.processOperation(n):this.executeStep(e)}catch{this.executeStep(e)}})(),this.reportAnalytics(Ne.FUNDING_RESUMED,{}))}executeStep(e){(async()=>{try{switch(e.type){case"transfer":this.reportAnalytics(Ne.DEPOSIT_TRANSFER_STARTED,{...e});let{senderAddress:r,networkId:o,tokenDecimals:n,txHash:s}=await this.transfer(e.depositAmount),c=await this.perps.spot.getTokenMidPrice(this.spotTokenId);this.stateMachine.completeStep({stepType:"transfer",senderAddress:r,networkId:o,tokenDecimals:n,txHash:s,assetId:this.assetId,spotTokenId:this.spotTokenId,assetLimitPriceUsd:c}),this.reportAnalytics(Ne.DEPOSIT_TRANSFER_COMPLETED,{...e,senderAddress:r,networkId:o,tokenDecimals:n,txHash:s,assetLimitPriceUsd:c});break;case"streamOperations":this.reportAnalytics(Ne.DEPOSIT_STREAM_OPERATIONS_STARTED,{...e}),this.startOperationsStream(e.sourceTxHash,e.depositAddress),this.reportAnalytics(Ne.DEPOSIT_STREAM_OPERATIONS_COMPLETED,{...e});break;case"sellSpotAsset":this.reportAnalytics(Ne.DEPOSIT_SELL_SPOT_STARTED,{...e});let p=await this.sellSpotAsset(e.depositAmount,e.tokenDecimals);this.stateMachine.completeStep({stepType:"sellSpotAsset",...p}),this.reportAnalytics(Ne.DEPOSIT_SELL_SPOT_COMPLETED,{...e,...p});break;case"transferToPerps":this.reportAnalytics(Ne.DEPOSIT_TRANSFER_TO_PERP_STARTED,{...e});let d=await this.transferToPerps(e.totalSz,e.avgPx);this.stateMachine.completeStep({stepType:"transferToPerps",transferUsdcAmount:d}),this.reportAnalytics(Ne.DEPOSIT_TRANSFER_TO_PERP_COMPLETED,{...e,transferUsdcAmount:d});break}}catch(r){this.stateMachine.failStep(r)}})()}async transfer(e){return await this.depositTransferFactory.create(this.depositTokenCaip19,this.account).execute(e,this.depositAddress,this.storage,this.signer)}startOperationsStream(e,r){if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startStream(this.perps.user,e,r)}operationsStreamListener={onOperation:i((e,r)=>{r&&this.processOperation(r)},"onOperation"),onError:i(e=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(e)},"onError")};processOperation(e){if(e.state==="failure"){this.stateMachine.failStep(new Error("Operation failed"));return}if(e.state==="done"){if(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),!e.destinationAmount)throw new Error("Destination amount is required");this.stateMachine.completeStep({stepType:"streamOperations",destinationAmount:new A(e.destinationAmount)})}}async sellSpotAsset(e,r){let o=e.shiftedBy(-r).decimalPlaces(3,A.ROUND_DOWN),n=await this.perps.spot.getTokenMidPrice(this.spotTokenId),s=await this.perps.spot.sell(this.assetId,o.toString(),n);return{totalSz:new A(s.totalSz),avgPx:new A(s.avgPx)}}async transferToPerps(e,r){let o=e.multipliedBy(r).decimalPlaces(2,A.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:o}),o}static create({minimumUiAmount:e,estimatedTime:r,fee:o,perps:n,assetId:s,spotTokenId:c,depositTokenCaip19:p,account:d,depositAddress:m,storage:f,signer:g,analytics:y,depositId:w}){return new t(e,r,o,n,s,c,p,d,m,f,g,y,w)}};u();l();u();l();var qC={1:7e-4,2:6e-4,3:5e-4,4:4e-4,5:35e-5,6:3e-4,7:.0025,8:.002};u();l();var Mp=class{static{i(this,"HyperunitWithdrawStateMachine")}step;constructor(e){e?this.step=e:this.step={type:"idle"}}setStep(e){this.step=e}listeners=[];completeStep(e){let r=this.step,o=this.detectNextStep(e);if(!o){this.listeners.forEach(n=>n.onStepCompleted(this.step,void 0)),this.listeners.forEach(n=>n.onWithdrawCompleted());return}this.step=o,this.listeners.forEach(n=>n.onStepCompleted(r,o))}failStep(e){this.listeners.forEach(r=>r.onWithdrawFailed(this.step,e))}detectNextStep(e){switch(e.stepType){case"idle":return{type:"perpsToSpot",withdrawAddress:e.withdrawAddress,assetId:e.assetId,estimatedTime:e.estimatedTime,withdrawAmountUsd:e.withdrawAmountUsd};case"perpsToSpot":if(this.step.type!=="perpsToSpot")throw new Error("Invalid step: expected perpsToSpot, got "+this.step.type);return{...this.step,type:"buyAsset"};case"buyAsset":if(this.step.type!=="buyAsset")throw new Error("Invalid step: expected buyAsset, got "+this.step.type);return{...this.step,type:"sendToWithdrawAddress",assetMidPrice:e.assetMidPrice,filledAmount:e.filledAmount};case"sendToWithdrawAddress":if(this.step.type!=="sendToWithdrawAddress")throw new Error("Invalid step: expected sendToWithdrawAddress, got "+this.step.type);return{...this.step,type:"streamOperations",sendToWithdrawAmount:e.sendToWithdrawAmount,operationStartTime:new Date};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}getStep(){return this.step}};var Up=class extends yr{static{i(this,"HyperunitWithdrawTask")}withdrawAddress;withdrawAddressRole;assetId;spotTokenName;spotTokenId;perps;stateMachine=new Mp;analytics;operationsStreamer;fundingState="active";constructor(e,r,o,n,s,c,p,d,m,f){super("withdraw",p,d,m),this.withdrawAddress=e,this.withdrawAddressRole=r,this.assetId=o,this.spotTokenName=n,this.spotTokenId=s,this.perps=c,this.analytics=f,this.stateMachine.addListener(this.withdrawStateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new li(this.perps.client),this.reportAnalytics(Me.FUNDING_INITIALIZED,{})}reportAnalytics(e,r){let o={fundingType:"withdraw",amount:this.amount,amountUsd:this.amountUsd,withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole,assetId:this.assetId,spotTokenName:this.spotTokenName,spotTokenId:this.spotTokenId,minimumUiAmount:this.minimumUiAmount.toString(),estimatedTime:this.estimatedTime,fee:this.fee.toString()};this.analytics.reportWithdraw(e,{...o,...r})}withdrawStateMachineListener={onStepCompleted:i((e,r)=>{this.fundingState!=="paused"&&(e.type==="sendToWithdrawAddress"&&this.notify({type:"fundingBridgingStarted",estimateTime:"4"},this.state),r&&this.executeStep(r))},"onStepCompleted"),onWithdrawCompleted:i(()=>{this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics(Me.FUNDING_COMPLETED,{})},"onWithdrawCompleted"),onWithdrawFailed:i((e,r)=>{console.error(`Withdraw failed at step: ${e.type}`,r),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"failed",error:r},this.notify({type:"fundingFailed",error:r},this.state),this.reportAnalytics(Me.FUNDING_FAILED,{error:JSON.stringify(r)})},"onWithdrawFailed")};stateLogsListener={onStepCompleted:i((e,r)=>{k.addBreadcrumb(_.Perps,`Withdraw step completed: ${e.type}`,L.Info,{...xh(e),amountUsd:this.amountUsd??""})},"onStepCompleted"),onWithdrawCompleted:i(()=>{this.stateMachine.removeListener(this.stateLogsListener)},"onWithdrawCompleted"),onWithdrawFailed:i((e,r)=>{k.addBreadcrumb(_.Perps,`Withdraw failed at step: ${e.type}`,L.Error,{error:r instanceof Error?r.message:"Unknown error",...xh(e),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)},"onWithdrawFailed")};pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics(Me.FUNDING_PAUSED,{})}resume(){this.fundingState="active";let e=this.stateMachine.getStep();e.type==="streamOperations"&&(this.perps.user&&this.executeStep(e),this.reportAnalytics(Me.FUNDING_RESUMED,{}))}execute(e,r,o,n){if(this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),n){this.stateMachine.setStep(n.state),this.stateMachine.completeStep(n.completedStep);return}this.stateMachine.completeStep({stepType:"idle",withdrawAddress:this.withdrawAddress,assetId:this.assetId,estimatedTime:this.estimatedTime??"",withdrawAmountUsd:e})}executeStep(e){(async()=>{try{switch(e.type){case"perpsToSpot":this.reportAnalytics(Me.PERPS_TO_SPOT_STARTED,e),await this.transferToSpot(e.withdrawAmountUsd),this.reportAnalytics(Me.PERPS_TO_SPOT_COMPLETED,e);break;case"buyAsset":this.reportAnalytics(Me.BUY_ASSET_STARTED,e),await this.buyAsset(e.assetId,e.withdrawAmountUsd),this.reportAnalytics(Me.BUY_ASSET_COMPLETED,e);break;case"sendToWithdrawAddress":this.reportAnalytics(Me.SEND_TO_WITHDRAW_ADDRESS_STARTED,e),await this.sendToWithdrawAddress(this.spotTokenName,this.spotTokenId,e.filledAmount),this.reportAnalytics(Me.SEND_TO_WITHDRAW_ADDRESS_COMPLETED,e);break;case"streamOperations":this.reportAnalytics(Me.WITHDRAW_STREAM_OPERATIONS_STARTED,e),this.startOperationsStream(e),this.reportAnalytics(Me.WITHDRAW_STREAM_OPERATIONS_COMPLETED,e);break}}catch(r){this.stateMachine.failStep(r)}})()}async transferToSpot(e){let r=this.withdrawAddressRole==="missing"?new A(1):new A(0);await this.perps.transfer({toPerp:!1,amount:e.minus(r)}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.stateMachine.completeStep({stepType:"perpsToSpot"})}async buyAsset(e,r){let o=await this.perps.spot.getTokenMidPrice(this.spotTokenId),n=r.dividedBy(o.multipliedBy(xp)).decimalPlaces(3),s=await this.perps.spot.buy(e,n.toString(),o),c=qC[1];this.stateMachine.completeStep({stepType:"buyAsset",assetMidPrice:o,filledAmount:new A(s.totalSz).multipliedBy(1-c)})}async sendToWithdrawAddress(e,r,o){let n=this.fee.dividedBy(10**Tn.data.decimals),s=o.minus(n).decimalPlaces(3,A.ROUND_DOWN);await this.perps.spot.send(e,r,s,this.withdrawAddress),this.stateMachine.completeStep({stepType:"sendToWithdrawAddress",sendToWithdrawAmount:s})}startOperationsStream(e){if(e.type!=="streamOperations")throw new Error("Invalid step type for operations stream");if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startWithdrawStream(this.perps.user,e.operationStartTime,e.sendToWithdrawAmount)}operationsStreamListener={onOperation:i((e,r)=>{r&&this.processOperation(r)},"onOperation"),onError:i(e=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(e)},"onError")};processOperation(e){if(e.state==="failure"){this.stateMachine.failStep(new Error("Withdrawal operation failed"));return}e.state==="done"&&(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),this.stateMachine.completeStep({stepType:"streamOperations"}))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};var Op=class{static{i(this,"HyperunitFundingTaskFactory")}analytics;constructor(e){this.analytics=e}async createTask(e,r,o,n,s,c,p,d){switch(d.type){case"deposit":return this.createDepositTask(e,r,d.depositTokenCaip19,p,s,c,d.depositId);case"withdraw":return this.createWithdrawTask(e,d.withdrawNetworkId,r)}}async createDepositTask(e,r,o,n,s,c,p){let{fundingCaip19Address:d,spotAssetId:m,eta:f,minimumAmount:g,spotTokenId:y,fee:w}=await e.client.postFunding({type:"deposit",taker:N(n),originChain:o.chainId}),S=this.checkCaip19Address(d);return Lp.create({minimumUiAmount:new A(g),estimatedTime:f,fee:new A(w),perps:e,assetId:m,spotTokenId:y,depositTokenCaip19:o,account:r,depositAddress:S,storage:s,signer:c,analytics:this.analytics,depositId:p})}async createWithdrawTask(e,r,o){let n=o.addresses.find(S=>S.networkID===r);if(!n)throw new Error("Couldn't find destination account address for network: "+r);let{fundingCaip19Address:s,spotAssetId:c,eta:p,minimumAmount:d,spotTokenName:m,spotTokenId:f,fee:g}=await e.client.postFunding({type:"withdraw",taker:N({resourceType:V.address,chainId:n.networkID,address:n.address}),originChain:r}),y=this.checkCaip19Address(s),w=await e.client.getUserRole(y);return new Up(y,w.role,c,m,f,e,new A(d),p,new A(g),this.analytics)}checkCaip19Address(e){let r=Ve(e);if(r.resourceType!==V.address)throw new Error("Funding CAIP19 is not an address");return r.address}};u();l();var Eh=class extends yr{static{i(this,"MockFundingTask")}shouldFail;constructor(e,r=!1){super(e,new A(.01),"1m",new A(8471530)),this.shouldFail=r}execute(e,r,o){this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),setTimeout(()=>{if(this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),this.shouldFail){setTimeout(()=>{this.state={type:"failed",error:new Error("Mock funding task failed")},this.notify({type:"fundingFailed",error:new Error("Mock funding task failed")},this.state)},3e3);return}setTimeout(()=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state)},3e3)},3e3)}pause(){}resume(){}},qa=class{static{i(this,"MockFundingTaskFactory")}createTask(e,r,o,n,s,c,p,d){return Promise.resolve(new Eh(d.type,!1))}};var HC=(0,Co.createContext)(null),zC=!1;function MLe({fundingPoolFactory:t,children:e}){let r=NC(),o=pt(),n=my(),s=Ro(),c=(0,Co.useMemo)(()=>{let m;if(t)m=t.create();else{let y=new _p(o);m=new vp(y)}m.addListener(new kp),m.addListener(new Ip),m.addListener(new Pp(()=>{let y=c.account,w=c.user;if(!(!y||!w))return{account:y,user:w,cashAccount:void 0,storage:o,perps:c,determineProvider:i(()=>{},"determineProvider"),getAvailableProviders:i(()=>[],"getAvailableProviders")}}));let f=zC?new qa:new Fp(r),g=zC?new qa:new Op(r);return new Cp({client:new Jl,isTestnet:n,fundingPool:m,relayFundingTaskFactory:f,hyperunitFundingTaskFactory:g,authRepository:s})},[t,r,o,n,s]),{data:p}=de();(0,Co.useEffect)(()=>{p&&c.setAccount(p)},[p,c]);let d=vo();return(0,Co.useEffect)(()=>{c.setSigner(d)},[d,c]),(0,QC.jsx)(HC.Provider,{value:c,children:e})}i(MLe,"PerpsProvider");function qp(){let t=(0,Co.useContext)(HC);if(!t)throw new Error("usePerps must be used within a PerpsProvider");return t}i(qp,"usePerpsContext");u();l();u();l();u();l();var Qp=D(O());u();l();var GC=D(O());var Ln=i(()=>{let{data:[t]}=Ot(["enable-perps"]),{data:e}=de(),r=(0,GC.useMemo)(()=>e?.addresses.some(o=>I.isEVMNetworkID(o.networkID))??!1,[e]);return t&&r},"useIsPerpsSupported");u();l();var Ze=D(O());var zp=i(()=>{let t=qp(),e=(0,Ze.useCallback)(()=>{t.syncAccountBalance()},[t]),[r,o]=(0,Ze.useState)(t.getAccountBalanceState());(0,Ze.useEffect)(()=>t.subscribeAccountBalanceState({onAccountBalanceStateChange:i(M=>{o(M)},"onAccountBalanceStateChange")}),[t]);let n=(0,Ze.useCallback)(()=>{t.syncPositions()},[t]),[s,c]=(0,Ze.useState)(t.getPositionsState());(0,Ze.useEffect)(()=>t.subscribePositions({onPositionStateChange:i(M=>{c(M)},"onPositionStateChange")}),[t]);let p=(0,Ze.useCallback)(()=>{t.syncPositionFees()},[t]),[d,m]=(0,Ze.useState)(t.getPositionFeesState());(0,Ze.useEffect)(()=>t.subscribePositionFees({onPositionFeesStateChange:i(M=>{m(M)},"onPositionFeesStateChange")}),[t]);let f=(0,Ze.useCallback)(()=>{t.syncFundingHistory()},[t]),[g,y]=(0,Ze.useState)(t.getFundingHistoryState());(0,Ze.useEffect)(()=>t.subscribeFundingHistory({onFundingHistoryStateChange:i(M=>{y(M)},"onFundingHistoryStateChange")}),[t]);let w=(0,Ze.useCallback)(M=>{t.syncHistoricalOrders(M)},[t]),[S,b]=(0,Ze.useState)(t.getHistoricalOrdersState());(0,Ze.useEffect)(()=>t.subscribeHistoricalOrders({onHistoricalOrdersStateChange:i(M=>{b(M)},"onHistoricalOrdersStateChange")}),[t]);let T=(0,Ze.useCallback)((M,G,R,j)=>{t.syncPricing(M,G,R,j)},[t]),x=(0,Ze.useCallback)(M=>{t.startSequentialPricingSync(M)},[t]),[C,E]=(0,Ze.useState)(t.getPricingState());(0,Ze.useEffect)(()=>t.subscribePricing({onPricingStateChange:i(M=>{E(M)},"onPricingStateChange")}),[t]);let P=(0,Ze.useCallback)(()=>t.getAccountBalanceState(),[t]);return{isReady:t.getUser()!==void 0,accountBalanceState:r,syncAccountBalance:e,getAccountBalanceState:P,positionsState:s,syncPositions:n,positionFeesState:d,syncPositionFees:p,fundingHistoryState:g,syncFundingHistory:f,historicalOrdersState:S,syncHistoricalOrders:w,pricingState:C,syncPricing:T,startSequentialPricingSync:x}},"usePerps");var oMe=i(()=>{let t=Ln(),e=qp(),{syncAccountBalance:r,syncPositions:o,syncHistoricalOrders:n,syncPositionFees:s,accountBalanceState:c,positionsState:p,historicalOrdersState:d,positionFeesState:m,syncFundingHistory:f,fundingHistoryState:g}=zp(),y=(0,Qp.useCallback)(()=>{t&&(r(),o(),n(),s(),f())},[r,o,n,t,s,f]);return(0,Qp.useEffect)(()=>e.subscribeAccountChange({onAccountChange:i(()=>{y()},"onAccountChange")}),[e,y]),{isLoading:qM(c,p,d,m,g),isRefreshing:zM(c,p,d,m,g),isIndeterminate:QM(c,p,d,m,g),refetch:y}},"useSyncPerpsPortfolio");function qM(t,e,r,o,n){return t.type==="loading"||e.type==="loading"||r.type==="loading"||o.type==="loading"||n.type==="loading"}i(qM,"isLoading");function zM(t,e,r,o,n){return t.type==="refreshing"||e.type==="refreshing"||r.type==="refreshing"||o.type==="refreshing"||n.type==="refreshing"}i(zM,"isRefreshing");function QM(t,e,r,o,n){return t.type==="indeterminate"||e.type==="indeterminate"||r.type==="indeterminate"||o.type==="indeterminate"||n.type==="indeterminate"}i(QM,"isIndeterminate");u();l();var jC=D(O());var HM=i(()=>{let{data:[t]}=Ot(["enable-extension-perps"]),{data:e}=de(),r=(0,jC.useMemo)(()=>e?.addresses.some(o=>I.isEVMNetworkID(o.networkID))??!1,[e]);return t&&r},"useIsExtensionPerpsSupported");u();l();var wr=D(O());u();l();var $C=3,gMe=fd(t=>{let e=t(Ch);return{isPerpsBalanceError:e.accountBalanceErrors>=$C,isPerpsPositionsError:e.positionsErrors>=$C}}),Ch=fd({accountBalanceErrors:0,positionsErrors:0});var KC=0,EMe=i(({interval:t=5e3,enabled:e=!0,maxConsecutiveErrors:r=3,onSyncPaused:o}={})=>{let n=Ln(),{syncAccountBalance:s,syncPositions:c,accountBalanceState:p,positionsState:d}=zp(),m=(0,wr.useRef)(null),f=(0,wr.useRef)(e),g=(0,wr.useRef)(!1),y=Xy(Ch);f.current=e,(0,wr.useEffect)(()=>{let T="consecutiveErrors"in p?p.consecutiveErrors:0,x="consecutiveErrors"in d?d.consecutiveErrors:0,E=Math.min(T,x)>=r;E&&!g.current?(g.current=!0,o&&o()):!E&&g.current&&(g.current=!1),y({accountBalanceErrors:T,positionsErrors:x})},[p,d,r,o,y]);let w=(0,wr.useCallback)(()=>{if(n&&f.current&&!g.current){let T=Date.now();T-KC>=t&&(s(),c(),KC=T)}},[s,c,n,t]),S=(0,wr.useCallback)(()=>{if(!n||!f.current)return;m.current&&clearTimeout(m.current);let T=i(()=>{f.current&&(w(),m.current=setTimeout(T,t))},"poll");m.current=setTimeout(T,t)},[w,t,n]),b=(0,wr.useCallback)(()=>{m.current&&(clearTimeout(m.current),m.current=null)},[]);return(0,wr.useEffect)(()=>(e&&n?S():b(),b),[e,n,S,b]),(0,wr.useEffect)(()=>()=>{b()},[b]),{startPolling:S,stopPolling:b,syncPerpsData:w,isSyncPaused:g.current}},"usePerpsPolling");var jp=D(O());u();l();var tI=D(Yk()),rI=D(Wk());var GM=a.object({domain:a.string(),url:a.string(),name:a.string(),category:a.string(),imageUrl:a.string(),slug:a.string()}),oI=a.object({uuid:a.string(),data:a.array(GM)}),jM=a.object({type:a.literal("site"),url:a.string(),name:a.string(),category:a.string(),imageUrl:a.string(),description:a.string().optional()}),$M=a.object({type:a.literal("tokenCategory"),id:a.string(),name:a.string(),subtitle:a.string().optional(),imageUrl:a.string(),description:a.string().optional()}),nI=a.discriminatedUnion("type",[jM,$M]),qMe=i(t=>t.type==="site","isFeaturedSite");var KM=a.object({chainId:Tr,address:a.string(),name:a.string(),symbol:a.string(),logoUrl:a.string(),marketCap:a.number(),price:a.number(),priceChange:a.number(),volume:a.number(),volumeChange:a.number(),spamStatus:_i.optional().default(pe.NotVerified)}),VM=a.object({chainId:Tr,address:a.string(),name:a.string(),symbol:a.string(),logoUrl:a.string(),marketCap:a.number(),price:a.number(),priceChange:a.number(),volume:a.number(),volumeChange:a.number(),spamStatus:_i.optional().default(pe.NotVerified)}),zMe=a.object({id:a.string(),name:a.string(),imageUri:a.string()}),sI=a.object({items:a.array(KM)}),QMe=a.object({items:a.array(VM)}),WM=a.object({paymentTokenId:a.string(),name:a.string(),symbol:a.string(),decimals:a.number()}),ZM=a.object({verified:a.boolean(),collectionUrl:a.string(),marketplaceId:a.string(),marketplaceName:a.string(),marketplaceCollectionId:a.string()}),YM=a.object({marketplaceId:a.string(),paymentToken:WM,value:a.string()}),XM=a.object({id:a.string(),name:a.string(),volume:a.string().optional(),volumePercentChange:a.number(),marketplacePages:a.array(ZM),floorPrices:a.array(YM),imageUrl:a.string()}),iI=a.object({uuid:a.string(),data:a.array(XM)}),JM=["tokens","perps","sites","collections","learn","suggested-users-to-follow","suggested-users-to-follow-by-pnl","token-categories","trending-perps"],Fr=a.enum(["shortcuts","carousel",...JM]),eU=a.object({type:a.literal(Fr.enum.shortcuts)}),tU=a.object({type:a.literal(Fr.enum.carousel)}),rU=a.object({type:a.literal(Fr.enum["suggested-users-to-follow"]),limit:a.number()}),oU=["7d","30d"],VC=a.enum(oU),nU=a.object({type:a.literal(Fr.enum["suggested-users-to-follow-by-pnl"]),limit:a.number(),timeFrame:a.array(VC).refine(t=>new Set(t).size===t.length),timeFrameDefault:VC}),za="all_networks",pi=a.union([Tr,a.literal(za)]),sU=["asc","desc"],Ih=a.enum(sU),iU=["rank","volume","price","price-change","market-cap"],WC=a.enum(iU),aU=["1h","24h","7d","30d"],ZC=a.enum(aU),cU=a.object({type:a.literal(Fr.enum.tokens),sortBy:a.array(WC).refine(t=>new Set(t).size===t.length),sortByDefault:WC,sortDirectionDefault:Ih,network:a.array(pi).refine(t=>new Set(t).size===t.length),networkDefault:pi,timeFrame:a.array(ZC).refine(t=>new Set(t).size===t.length),timeFrameDefault:ZC,rankAlgo:a.string(),limit:a.number(),listLimit:a.number()}),uU=a.object({type:a.literal(Fr.enum["token-categories"])}),lU=["volume","price-change","open-interest","trending"],Hp=a.enum(lU),pU=["1h","24h","7d","30d"],Gp=a.enum(pU),dU=a.object({type:a.literal(Fr.enum.perps),sortBy:a.array(Hp).refine(t=>new Set(t).size===t.length),sortByDefault:Hp,sortDirectionDefault:Ih,timeFrame:a.array(Gp).refine(t=>new Set(t).size===t.length),timeFrameDefault:Gp,limit:a.number(),listLimit:a.number()}),mU=a.object({type:a.literal(Fr.enum["trending-perps"]),sortBy:a.array(Hp).refine(t=>new Set(t).size===t.length),sortByDefault:Hp,sortDirectionDefault:Ih,timeFrame:a.array(Gp).refine(t=>new Set(t).size===t.length),timeFrameDefault:Gp,limit:a.number(),listLimit:a.number()}),fU=["top","rank"],YC=a.enum(fU),hU=["24h","7d","30d"],XC=a.enum(hU),gU=a.object({type:a.literal(Fr.enum.sites),sortBy:a.array(YC).refine(t=>new Set(t).size===t.length),sortByDefault:YC,network:a.array(pi).refine(t=>new Set(t).size===t.length),networkDefault:pi,timeFrame:a.array(XC).refine(t=>new Set(t).size===t.length),timeFrameDefault:XC,rankAlgo:a.string(),limit:a.number(),listLimit:a.number()}),yU=["top","rank"],JC=a.enum(yU),wU=["24h","7d","30d"],eI=a.enum(wU),SU=a.object({type:a.literal(Fr.enum.collections),sortBy:a.array(JC).refine(t=>new Set(t).size===t.length),sortByDefault:JC,network:a.array(pi).refine(t=>new Set(t).size===t.length),networkDefault:pi,timeFrame:a.array(eI).refine(t=>new Set(t).size===t.length),timeFrameDefault:eI,rankAlgo:a.string(),limit:a.number(),listLimit:a.number()}),bU=a.object({type:a.literal(Fr.enum.learn),limit:a.number()}),kh=a.discriminatedUnion("type",[eU,tU,rU,nU,cU,dU,mU,gU,SU,bU,uU]),aI=a.object({sections:a.array(kh).refine(t=>(0,tI.default)(t,(0,rI.default)(t,"type")))}),HMe=a.object({uuid:a.string(),data:a.array(Sg)}),GMe=a.object({tokenAddress:a.string(),bondingCurve:a.string(),migratedPool:a.string().optional(),name:a.string(),image:a.string(),symbol:a.string(),marketCap:a.coerce.number(),liquidity:a.coerce.number(),bondingCurvePercentage:a.coerce.number(),tokenCreatedAt:a.coerce.date(),twitter:a.string(),website:a.string(),telegram:a.string(),discord:a.string(),migratedAt:a.coerce.date().optional(),type:a.enum(["NEW","ABOUT_TO_MIGRATE","MIGRATED"]).optional(),slot:a.coerce.number().optional(),devHolding:a.coerce.number(),snipersHolding:a.coerce.number(),bundlersHolding:a.coerce.number(),top10Holding:a.coerce.number(),volume:a.coerce.number(),buysCount:a.coerce.number(),sellsCount:a.coerce.number(),uniqueHolders:a.coerce.number(),telegramCallCount:a.coerce.number(),bondingCurvePlatform:a.string()});var cI=aI.parse({sections:[{type:"shortcuts"},{type:"carousel"},{type:"tokens",sortBy:["rank","volume","price","price-change","market-cap"],sortByDefault:"rank",sortDirectionDefault:"asc",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["1h","24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:100},{type:"perps",sortBy:["volume","price-change","open-interest"],sortByDefault:"volume",sortDirectionDefault:"desc",timeFrame:["24h"],timeFrameDefault:"24h",limit:3,listLimit:100},{type:"trending-perps",sortBy:["trending"],sortByDefault:"trending",sortDirectionDefault:"desc",timeFrame:["24h"],timeFrameDefault:"24h",limit:3,listLimit:100},{type:"token-categories"},{type:"suggested-users-to-follow-by-pnl",limit:3,timeFrame:["7d","30d"],timeFrameDefault:"7d"},{type:"sites",sortBy:["rank","top"],sortByDefault:"rank",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:50},{type:"learn",limit:3}]}),TU=i(t=>{try{let e=JSON.parse(t??"");return e?.sections?{sections:e.sections.filter(o=>kh.safeParse(o).success)}:cI}catch{return cI}},"parseFeatureFlagConfig"),Fh=i(()=>{let t=qt.getMultivariateAssignment("explore-config"),{data:[e]}=Ot(["enable-fungible-categories"]),r=Ln();return(0,jp.useMemo)(()=>{let o=TU(t);return Dr||(o={...o,sections:o.sections.filter(n=>n.type!=="suggested-users-to-follow")}),e||(o={...o,sections:o.sections.filter(n=>n.type!=="token-categories")}),r||(o={...o,sections:o.sections.filter(n=>n.type!=="perps")}),o},[t,e,r])},"useExploreConfig"),Ph=i(()=>{let t=Fh();return(0,jp.useMemo)(()=>{let e=[];for(let r of t.sections)(r.type==="collections"||r.type==="tokens"||r.type==="perps"||r.type==="sites"||r.type==="learn"||r.type==="suggested-users-to-follow"||r.type==="suggested-users-to-follow-by-pnl"||r.type==="token-categories"||r.type==="trending-perps")&&e.push(r);return e},[t.sections])},"useExploreConfigNavigatableSections"),_h=i(t=>{let e=Fh();return(0,jp.useMemo)(()=>e.sections.find(o=>o.type===t)??null,[e.sections,t])},"useExploreConfigSection");u();l();u();l();u();l();u();l();var uI="@phantom/fungible-categories",$p={fungibleCategories:i(t=>[uI,"fungible-categories",t],"fungibleCategories"),fungibleCategoryById:i(t=>[uI,"fungible-category",t],"fungibleCategoryById")};u();l();var lI=a.object({items:a.array(cw)}),pI=a.object({id:a.string(),name:a.string(),imageUri:a.string().nullish().transform(t=>t??""),items:uw.array()});var vh=i(({limit:t,searchQuery:e}={})=>{let{data:[r]}=Ot(["enable-fungible-categories"]);return oe({enabled:r,queryKey:$p.fungibleCategories({enabled:r,searchQuery:e}),queryFn:i(async()=>{let o=await z.api().get("/fungibles/v1/categories",{params:{limit:"100",...e?{query:e}:{}}});return lI.parse(o.data)},"queryFn"),select:i(o=>t?o.items.slice(0,t):o.items,"select")})},"useFungibleCategories");u();l();var AU=i(({id:t})=>{let{data:[e]}=Ot(["enable-fungible-categories"]);return oe({enabled:e,queryKey:$p.fungibleCategoryById({id:t,enabled:e}),queryFn:i(async()=>{let r=await z.api().get(`/fungibles/v1/categories/${t}`,{params:{includePrices:"true"}});return pI.parse(r.data)},"queryFn")})},"useFungibleCategoryById");u();l();var Xr=D(O());var xU=2,EU=10,CU=300;function dI(t,e={}){let{debounceMs:r=CU,onSearchExecuted:o}=e,[n,s]=(0,Xr.useState)([]),[c,p]=(0,Xr.useState)(!1),d=(0,Xr.useRef)(null),m=(0,Xr.useMemo)(()=>new zl,[]),f=(0,Xr.useRef)(o);return f.current=o,(0,Xr.useEffect)(()=>{if(d.current&&clearTimeout(d.current),t.length<xU){s([]),p(!1);return}return p(!0),d.current=setTimeout(async()=>{try{f.current?.(t);let g=await m.searchEvents({query:t,limit:EU});s(g.events||[])}catch(g){console.error("[usePredictionSearch] Search failed:",g),s([])}finally{p(!1)}},r),()=>{d.current&&clearTimeout(d.current)}},[t,m,r]),{results:n,isSearching:c}}i(dI,"usePredictionSearch");var Ge=D(O());u();l();u();l();u();l();var mI={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var fI={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!0,"trendingTokensEnabled")};u();l();var hI={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var gI={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!0,"trendingTokensEnabled")};u();l();var yI={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var wI={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var SI={tokenSearchEnabled:i(()=>!1,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var bI={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!0,"trendingTokensEnabled")};u();l();var TI={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!0,"trendingTokensEnabled")};u();l();var AI={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};var IU=new $n({[ce.Solana]:TI,[ce.Ethereum]:gI,[ce.Polygon]:bI,[ce.Base]:fI,[ce.Arbitrum]:mI,[ce.Bitcoin]:hI,[ce.Monad]:SI,[ce.Sui]:AI,[ce.Hypercore]:yI,[ce.Hyperevm]:wI}),Rh=jn(IU);u();l();u();l();var jOe=i(t=>t.address==="native"?N({chainId:t.chainId,resourceType:V.nativeToken,slip44:I.getSlip44(t.chainId)}):N({chainId:t.chainId,address:t.address,resourceType:V.address}),"exploreTokenToCaip19");var xI=i(t=>["explore-dapp",t],"createExploreDappQueryKey");var EI=i(t=>t.addresses.map(e=>I.getMainnetNetworkID(e.networkID))??[],"getAccountMainnetNetworkIds");function CI(t){try{return xr.get(t).nonNativeFungibleTokenType}catch{return ae.SolanaNative}}i(CI,"getExploreTokenTypeFromChain");u();l();u();l();var Pr="@phantom/explore",Et={RecentlyViewedSearchItems:[Pr,"RecentlyViewedSearchItems"],sitesV2({sortBy:t,timeFrame:e,networkIDs:r,limit:o,locale:n,rankAlgo:s}){return[Pr,"sitesV2",Re,n,{sortBy:t,timeFrame:e,networkIDs:r,rankAlgo:s,limit:o}]},recommendedSites(t,e){return[Pr,"sites","recommended",Re,e,t]},featuredItems(t,e){return[Pr,"items","featured",Re,e,t]},tokensV2({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:o,limit:n,rankAlgo:s}){return[Pr,"tokensV2",{sortBy:t,sortDirection:e,timeFrame:r,networkIDs:o,rankAlgo:s,limit:n}]},curated({networkIDs:t,limit:e}){return[Pr,"curated",{networkIDs:t,limit:e}]},collectionsV2({sortBy:t,timeFrame:e,networkIDs:r,limit:o,locale:n,rankAlgo:s}){return[Pr,"collectionsV2",Re,n,{sortBy:t,timeFrame:e,networkIDs:r,rankAlgo:s,limit:o}]},featuredTransactions(t,e){return[Pr,"transactions","featured",Re,e,t]},learn(t,e){return[Pr,"learn",Re,e,t]},perpMarkets(t,e,r,o,n,s){return[Pr,"perp-markets",{chainId:t,sortBy:e,sortDirection:r,timeFrame:o,limit:n,search:s}]}};var kU=10,kI=ye.RecentlyViewedSearchItems;async function FU(t){return await t.get(kI)??[]}i(FU,"getRecentlyViewedSearchItem");async function FI(t,e){await t.set(kI,e)}i(FI,"setRecentlyViewedSearchItem");function Dh(t){return oe({queryKey:Et.RecentlyViewedSearchItems,queryFn:i(async()=>FU(t),"queryFn"),staleTime:0,enabled:!0})}i(Dh,"useGetRecentlyViewedSearchItems");function PU(t){let e=qe();return sn({mutationFn:i(async o=>{let n=II(o),c=(e.getQueryData(Et.RecentlyViewedSearchItems)??[]).filter(p=>II(p)!==n);c.unshift(o),c=c.slice(0,kU),await FI(t,c),e.setQueryData(Et.RecentlyViewedSearchItems,c),await e.refetchQueries({queryKey:Et.RecentlyViewedSearchItems})},"mutationFn")})}i(PU,"useAddRecentlyViewedSearchItem");function _U(t){let e=qe();return sn({mutationFn:i(async()=>{await FI(t,[]),e.setQueryData(Et.RecentlyViewedSearchItems,[]),await e.refetchQueries({queryKey:Et.RecentlyViewedSearchItems})},"mutationFn")})}i(_U,"useClearRecentlyViewedSearchItem");function II(t){return t.type==="token"||t.type==="perp"?N(J(t.data)):t.data.id}i(II,"keyFromSearchItem");u();l();var Bh=D(LI()),Kp=D(O());u();l();var MI={fields:["domain","name","category","tags"],storeFields:["domain","name","category","tags","imageUrl"],searchOptions:{boost:{name:2},prefix:!0,fuzzy:i(t=>t.length>3?.2:!1,"fuzzy")}};var UI=i(t=>{try{let{hostname:e,pathname:r}=new URL(t);return e+r}catch{return t}},"getHostnameAndPath"),QU=i((t=[],e=[])=>{let r=[...t,...e],o=(0,Bh.default)(e,s=>UI(s.domain)),n=new Map;return r.forEach(s=>{let c=UI(s.domain);if(!n.has(c)){let p=o[c]||s;n.set(c,p)}}),Array.from(n.values())},"combineAndDeduplicateDapps"),HU=i(t=>{let e={isRecommended:"true"};return t.networkIds&&(e.chainIds=t.networkIds.join(",")),`/dapps/v1?${new URLSearchParams(e).toString()}`},"getRecommendedDappsEndpoint"),GU=i(async t=>{let e=await z.api().get(HU(t));if(!te(e))throw new Error("Error fetching recommended dapps from registry");if(!e?.data||!e?.data?.data)throw new Error("No data returned from registry");let r=e.data,o=(0,Bh.default)(r.data??[],s=>s.id);return Object.values(o)},"fetchRecommendedDapps"),jU=i(t=>{let e=qe();return oe({queryKey:["dapps","recommended",t],queryFn:i(async()=>{try{let r=await GU(t);return Og.batch(()=>{for(let o of r){let n=xI(o.domain),s=e.getQueryState(n);e.setQueryData(n,()=>o??s?.data??null)}}),r}catch(r){throw k.captureError(r,_.DappRegistry),r}},"queryFn"),gcTime:K({days:1}),staleTime:K({days:1})})},"useRecommendedSearchDapps"),OI=i((t,e)=>{let{searchQuery:r,networkIds:o}=t,{data:n=[],...s}=jU({networkIds:o}),c=(0,Kp.useMemo)(()=>n.sort((g,y)=>y.recommendationScore-g.recommendationScore),[n]),p=(0,Kp.useMemo)(()=>QU(e,c),[e,c]),d=ty(r),m=Wg(p,d,MI);return{data:(0,Kp.useMemo)(()=>{let g=new Map(p.map(y=>[y.id,y]));return m.map(y=>g.get(y.id)).filter(y=>y!==void 0)},[m,p]),...s}},"useRecommendedSearchDappsWithQuery");u();l();u();l();var qI=i(async({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:o,limit:n,rankAlgo:s,anonymousId:c})=>{let p=new URLSearchParams({timeFrame:r,sortBy:t,sortDirection:e,limit:n.toString(),rankAlgo:s,...c?{anonymousId:c}:{}});o.forEach(f=>{p.append("chainIds[]",f)});let d=await z.api().noBearer().get("/explore/v2/trending-tokens",{params:p});if(!te(d))throw new Error("Failed to fetch tokens");let m=sI.safeParse(d.data);if(!m.success)throw new Error("Failed to parse tokens");return m.data},"getTokensV2");u();l();var di=i((t,e)=>{let r=sc(),n=Ph().find(c=>c.type===e),s=[];return n&&"network"in n?n.network.forEach(c=>{c!==za&&r.includes(c)&&s.push(c)}):s=r,t!==za&&!s.includes(t)?[]:t===za?s:[t]},"useExploreNetwork");var $U=K({minutes:1}),KU=K({minutes:1}),VU=100,Nh=i(({sortBy:t,sortDirection:e,timeFrame:r,network:o,limit:n,rankAlgo:s,enableQuery:c=!0})=>{let p=ue(),d=di(o,"tokens"),m=VU;return oe({queryKey:Et.tokensV2({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:d,limit:m,rankAlgo:s}),enabled:c,async queryFn(){let f=await p.getDeviceId();return qI({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:d,limit:m,rankAlgo:s,anonymousId:f})},gcTime:KU,staleTime:$U,retry:3,select:i(f=>n>=m?f:{...f,items:f.items.slice(0,n)},"select")})},"useTokensV2");var en=3,WU=15,Qa=50,zI={[pe.Trusted]:1,[pe.Verified]:2,[pe.NotVerified]:3,[pe.PossibleSpam]:4,[pe.Spam]:5},ZU=i((t,e=100)=>{let[r,o]=(0,Ge.useState)(!1);return(0,Ge.useEffect)(()=>{let n;return t?n=setTimeout(()=>o(!0),e):o(!1),()=>clearTimeout(n)},[t,e]),r},"useDelayedLoading"),YU=i(t=>{let e=CI(t.chainId),r=I.getChainDefinition(t.chainId),o={name:t.name,symbol:t.symbol,logoUri:t.logoUrl,spamStatus:t.spamStatus,chain:{id:t.chainId,symbol:r.tokenSymbol,name:r.name,imageUrl:r.iconUrl}};switch(e){case ae.SPL:return{type:e,data:{...o,mintAddress:t.address}};case ae.ERC20:return{type:e,data:{...o,contractAddress:t.address}};case ae.BRC20:return{type:e,data:{...o,firstCreatedInscriptionId:t.address}};default:return null}},"mapExploreTokenToTokenMetadata"),XU=i(t=>t.reduce((e,r)=>{let o=YU(r);return o&&e.push(o),e},[]),"reduceExploreTokensToTokenMetadata"),JU=i(({searchQuery:t,networkIds:e,excludePlaceholderTokens:r=!1,extraDapps:o=[],actorSearchHook:n,enablePredictions:s=!1})=>{let[c,p]=(0,Ge.useState)(!1),[d,m]=(0,Ge.useState)(!1),[f,g]=(0,Ge.useState)(!1),[y,w]=(0,Ge.useState)(!1),[S,b]=(0,Ge.useState)(!1),[T,x]=(0,Ge.useState)(!1),C=rt("enable-monad-mainnet"),E=rt("enable-prediction-markets"),P=(0,Ge.useMemo)(()=>e.filter(Ct=>I.isMonadNetworkID(Ct)&&I.isMainnetNetworkID(Ct)?C:Rh.get(Ct).tokenSearchEnabled()),[e,C]);(0,Ge.useEffect)(()=>{p(!1),m(!1),g(!1),w(!1),b(!1),x(!1)},[t]);let{data:M=[],isLoading:G}=Da({query:t,networkIds:P,searchContext:"explore",enableQuery:!!t}),{data:R,isLoading:j}=vh({limit:t?void 0:10,searchQuery:t}),Q=_h("tokens"),{data:F}=Nh({sortBy:Q?.sortByDefault??"rank",sortDirection:Q?.sortDirectionDefault??"asc",timeFrame:Q?.timeFrameDefault??"24h",network:Q?.networkDefault??ar.Mainnet,limit:10,rankAlgo:Q?.rankAlgo??"default",enableQuery:!t&&!r}),{tokens:B,perps:W}=(0,Ge.useMemo)(()=>M.sort((Rr,xi)=>zI[Rr.data.spamStatus??pe.NotVerified]-zI[xi.data.spamStatus??pe.NotVerified]).reduce((Rr,xi)=>(xi.type===ae.HypercoreAsset?Rr.perps.push(xi):Rr.tokens.push(xi),Rr),{tokens:[],perps:[]}),[M]),Y=(0,Ge.useMemo)(()=>F?.items?XU(F.items):[],[F?.items]),ee=t.length===0?WU:en,X=(0,Ge.useMemo)(()=>B.slice(0,d?Qa:ee),[d,B,ee]),Ue=(0,Ge.useMemo)(()=>W.slice(0,f?Qa:ee),[f,W,ee]),Ae=(0,Ge.useMemo)(()=>[...X.map(Ct=>N(J(Ct))),...Y.map(Ct=>N(J(Ct)))],[X,Y]),{data:mt={},isLoading:Va}=Lo({query:{data:Ae},enabled:Ae.length>0}),on=(0,Ge.useMemo)(()=>Ue.map(Ct=>N(J(Ct))),[Ue]),{data:Wa,isPending:Fe}=oh(on,!0),{data:et=[],isLoading:at}=OI({networkIds:P,searchQuery:t},o),Zt=et.slice(0,c?Qa:en),br=n??(()=>({data:void 0,isLoading:!1})),{data:Hn,isLoading:cg}=br({query:t}),{results:Ti=[],isSearching:ne}=dI(s&&E?t:"",{debounceMs:0}),eo=!!t,Za=at||G||j||cg||ne,ug=eo&&!Za,qk=pt(),{data:lg}=Dh(qk),{actorsAll:pg,actors:dg}=(0,Ge.useMemo)(()=>{let Ct=Hn?.actors??[],Rr=Ct.slice(0,y?Qa:en);return{actorsAll:Ct,actors:Rr}},[y,Hn?.actors]),mg=(0,Ge.useMemo)(()=>{if(R)return S?R:R.slice(0,ee)},[R,S,ee]),{predictionsAll:fg,predictions:hg}=(0,Ge.useMemo)(()=>{let Ct=E?Ti:[],Rr=Ct.slice(0,T?Qa:en);return{predictionsAll:Ct,predictions:Rr}},[Ti,T,E]),Ai=(0,Ge.useMemo)(()=>({actors:dg,dapps:et,searchedDapps:Zt,renderShowMoreDappsButton:eo&&et.length>en,isLoading:Za,tokens:X,perps:Ue,trendingTokens:Y,renderShowMoreTokensButton:eo&&B.length>ee,renderShowMorePerpsButton:eo&&W.length>ee,renderShowMoreUsersButton:eo&&pg.length>en,priceMap:mt,isPriceMapLoading:Va,showSearchResults:ug,showMoreTokens:d,setShowMoreTokens:m,showMorePerps:f,setShowMorePerps:g,showMoreDapps:c,setShowMoreDapps:p,showMoreUsers:y,setShowMoreUsers:w,recentlyViewedSearchItems:lg,categories:mg,showMoreCategories:S,setShowMoreCategories:b,renderShowMoreCategoriesButton:eo&&R&&R?.length>en,perpMarketMap:Wa,isPerpMarketMapLoading:Fe,predictions:hg,showMorePredictions:T,setShowMorePredictions:x,renderShowMorePredictionsButton:eo&&fg.length>en}),[dg,et,Zt,eo,Za,X,Ue,Y,B.length,W.length,ee,pg.length,mt,Va,ug,d,f,c,y,lg,mg,S,R,Wa,Fe,hg,fg.length,T]),[gg,zk]=(0,Ge.useState)(null),Qk=ZU(Za);return(0,Ge.useEffect)(()=>{Ai.isLoading||zk(t?Ai:null)},[Ai.isLoading,t]),{...Ai.isLoading&&gg?gg:Ai,showSpinner:Qk&&eo}},"useExploreSearchList");u();l();u();l();var HI=D(O());u();l();var QI=i(async(t,e)=>{let r=new URLSearchParams({appVersion:Re,limit:"6",locale:e,platform:Yt});t.forEach(c=>{r.append("chainIds[]",c)});let o=await z.api().noBearer().get("/explore/v1/featured-items",{params:r});if(!te(o))throw new Error("Failed to fetch featured items");let n=await o.data;if(!n.data||!Array.isArray(n.data))return[];let s=[];for(let c of n.data)try{let p=nI.parse(c);s.push(p)}catch{}return s},"getFeaturedItems");var eO=K({minutes:10}),tO=K({minutes:10}),rO=i(()=>{let{data:t}=de(),e=(0,HI.useMemo)(()=>t?EI(t):[],[t]),r=Xt(v.language)??"en",o=i(async()=>{if(!t)throw new Error("No account found");return QI(e,r)},"queryFn");return oe({queryKey:Et.featuredItems(e,r),enabled:!!t,queryFn:o,gcTime:eO,staleTime:tO})},"useExploreFeaturedItems");u();l();u();l();var oO={rank:"trending",top:"top"},GI=i(async({sortBy:t,timeFrame:e,networkIDs:r,limit:o,locale:n,rankAlgo:s})=>{let c=new URLSearchParams({appVersion:Re,limit:o.toString(),locale:n,platform:Yt,rankAlgo:s,rankBy:oO[t],timeframe:e});r.forEach(m=>{c.append("chainIds[]",m)});let p=await z.api().noBearer().get("/explore/v1/trending-dapps",{params:c});if(!te(p))throw new Error("Failed to fetch sites");let d=oI.safeParse(p.data);if(!d.success)throw new Error("Failed to parse sites");return d.data},"getSitesV2");var nO=K({minutes:10}),sO=K({minutes:10}),iO=i(({sortBy:t,timeFrame:e,network:r,limit:o,rankAlgo:n})=>{let{data:s}=de(),c=di(r,"sites"),p=Xt(v.language)??"en";return oe({queryKey:Et.sitesV2({sortBy:t,timeFrame:e,networkIDs:c,locale:p,limit:o,rankAlgo:n}),enabled:!!s,async queryFn(){if(!s)throw new Error("No account found");return GI({sortBy:t,timeFrame:e,networkIDs:c,locale:p,limit:o,rankAlgo:n})},gcTime:sO,staleTime:nO,retry:3})},"useSitesV2");u();l();u();l();var aO={rank:"trending",top:"volume"},cO=i(t=>t.floorPrices.length>0&&t.marketplacePages.length>0,"collectionWithValueAndMarketPlace"),jI=i(async({sortBy:t,timeFrame:e,networkIDs:r,limit:o,locale:n,rankAlgo:s})=>{let c=new URLSearchParams({appVersion:Re,limit:o.toString(),locale:n,platform:Yt,rankAlgo:s,rankBy:aO[t],timeframe:e});r.forEach(m=>{c.append("chainIds[]",m.toString())});let p=await z.api().noBearer().get("/explore/v1/trending-collections",{params:c});if(!te(p))throw new Error("Failed to fetch collections");let d=iI.safeParse(p.data);if(!d.success)throw new Error("Failed to parse collections");return{...d.data,data:d.data.data.filter(cO)}},"getCollectionsV2");var uO=K({minutes:10}),lO=K({minutes:10}),pO=i(({sortBy:t,timeFrame:e,network:r,limit:o,rankAlgo:n})=>{let{data:s}=de(),c=di(r,"collections"),p=Xt(v.language)??"en";return oe({queryKey:Et.collectionsV2({sortBy:t,timeFrame:e,networkIDs:c,locale:p,limit:o,rankAlgo:n}),enabled:!!s,async queryFn(){if(!s)throw new Error("No account found");return jI({sortBy:t,timeFrame:e,networkIDs:c,locale:p,limit:o,rankAlgo:n})},gcTime:lO,staleTime:uO,retry:3})},"useCollectionsV2");u();l();u();l();var $I=i(async(t,e)=>{let r=new URLSearchParams({appVersion:Re,locale:e,platform:Yt});t.forEach(n=>{r.append("chainIds[]",n)});let o=await z.api().noBearer().get("/explore/v1/learn-grid",{params:r});if(!te(o))throw new Error("Failed to fetch learn grid");return o.data},"getLearnItems");var dO=K({minutes:10}),mO=K({minutes:10}),fO=i(()=>{let t=sc(),e=Xt(v.language)??"en";return oe({queryKey:Et.learn(t,e),enabled:t.length>0,async queryFn(){return $I(t,e)},gcTime:mO,staleTime:dO})},"useLearnV2");u();l();var qn=D(Ke(),1);u();l();var gi=D(O(),1);u();l();var Lh={location:0,distance:50,threshold:.2,shouldSort:!0,keys:[{name:"token.name",weight:.4},{name:"token.symbol",weight:.4},{name:"token.caip19.chainId",weight:.2}]};var Mh=30,hO=6,Uh=3e4,Oh=5,qh=["100","500","1000"];u();l();u();l();var mi="@phantom/fiat-ramp",zh=`${mi}:fungibles`,gO=`${mi}:payment-methods`,yO=`${mi}:providers`,wO=`${mi}:recommended-quote`,SO=`${mi}:status`,bO=`${mi}:completed`,tn={fiatRampTokens(t,e,r){return[zh,t,e,r]},fiatRampPaymentMethods(t,e,r){return[gO,t,e,r]},fiatRampProviders(t,e,r){return[yO,t,e,r]},fiatRampRecommendedQuote(t,e,r){return[wO,t,e,r]},fiatRampStatus(t,e,r){return[SO,t,e,r]},fiatRampCompleted(t,e,r){return[bO,t,e,r]}};u();l();u();l();u();l();var TO=a.object({name:a.string().nullish().default(null),symbol:a.string().nullish().default(null),decimals:a.number(),caip19:kt,logoURI:a.string().nullish().default(null)}),AO=a.object({token:TO,addressType:_g.optional()}),Hh=a.object({id:a.string(),name:a.string(),tag:a.string(),logo:a.string(),quote:a.object({displaySourceAmount:a.string(),displayDestinationAmount:a.string(),displayFee:a.string()}).optional()}),Mn;(function(t){t.CARD="CARD",t.MOBILE_WALLET="MOBILE_WALLET",t.BANK_TRANSFER="BANK_TRANSFER",t.EXCHANGE="EXCHANGE",t.LOCAL="LOCAL"})(Mn||(Mn={}));var Gh=a.object({id:a.string(),type:a.nativeEnum(Mn),name:a.string(),estimatedArrival:a.string(),assets:a.object({icon:a.string(),roundIcon:a.string()}),description:a.string().optional()}),x8e=a.object({groups:a.array(a.object({groupName:a.string(),tokens:a.array(AO)}))}),E8e=a.object({paymentMethods:a.array(Gh),provider:Hh.optional()}),C8e=a.object({providers:a.array(Hh),paymentMethod:Gh,token:kt}),I8e=a.object({provider:Hh,paymentMethod:Gh,location:a.object({countryCode:a.string(),subdivision:a.string().optional()}).optional(),token:kt.optional(),tokenAmount:a.string().optional(),fiatAmount:a.string().optional(),fiatCurrencyCode:a.string().optional(),minPurchaseAmount:a.string().optional(),maxPurchaseAmount:a.string().optional(),quickSelectDenominations:a.array(a.string()).optional()}),k8e=a.object({url:a.string(),sessionId:a.string()}),Qh;(function(t){t.PENDING="PENDING",t.COMPLETED="COMPLETED",t.FAILED="FAILED"})(Qh||(Qh={}));var F8e=a.object({status:a.nativeEnum(Qh),tokenAmount:a.number().optional(),fiatCurrencyCode:a.string().optional(),usdFiatAmount:a.number().optional(),usdFiatFeeAmount:a.number().optional(),fiatFeeAmount:a.number().optional(),cryptoTransactionId:a.string().optional(),createdAt:a.date().optional(),updatedAt:a.date().optional()}),Kt=class extends Error{static{i(this,"FiatRampError")}constructor(e){super(e),this.name="FiatRampError"}};var KI=new Kt("Failed to get FiatRampPaymentMethods"),VI=i(async(t,e,r)=>{try{let o=await z.api().headers(t).bearer(r).post("/fiat_ramp/v2/onramp/payment_methods",e);if(!te(o))throw KI;return o.data}catch{throw KI}},"getPaymentMethods");var xO=K({days:7}),EO=K({hours:1}),Ha=i((t,e,r,o)=>{let n={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},{data:s}=cr(),c=s?.userID,p=s?.accessToken;return oe({queryKey:tn.fiatRampPaymentMethods(n,o,c),queryFn:i(()=>VI(n,o,p),"queryFn"),gcTime:xO,staleTime:EO})},"useFiatRampPaymentMethods");u();l();u();l();var WI=new Kt("Failed to get FiatRampProviders"),ZI=i(async(t,e,r)=>{try{let o=await z.api().headers(t).bearer(r).post("/fiat_ramp/v2/onramp/providers",e);if(!te(o))throw WI;return o.data}catch{throw WI}},"getProviders");var CO=K({seconds:Mh}),IO=K({hours:1}),jh=i((t,e,r,o)=>{let n={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},{data:s}=cr(),c=s?.userID,p=s?.accessToken;return oe({queryKey:tn.fiatRampProviders(n,o,c),queryFn:i(()=>ZI(n,o,p),"queryFn"),gcTime:IO,staleTime:CO,enabled:!!o.destinationAddress})},"useFiatRampProviders");u();l();u();l();var YI=new Kt("Failed to get FiatRampRecommendedQuote"),XI=i(async(t,e,r)=>{try{let o=await z.api().headers(t).bearer(r).post("/fiat_ramp/v2/onramp/recommended_quote",e);if(!te(o))throw YI;return o.data}catch{throw YI}},"getRecommendedQuote");var kO=K({days:7}),FO=K({hours:1}),Vp=i((t,e,r,o,n=!0)=>{let s={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},{data:c}=cr(),p=c?.userID,d=c?.accessToken;return oe({queryKey:tn.fiatRampRecommendedQuote(s,o,p),queryFn:i(()=>XI(s,o,d),"queryFn"),gcTime:kO,staleTime:FO,enabled:n})},"useFiatRampRecommendedQuote");u();l();u();l();var JI=new Kt("Failed to get FiatRampTokens"),ek=i(async(t,e,r)=>{try{let o=await z.api().headers(t).bearer(r).post("/fiat_ramp/v2/onramp/tokens",e);if(!te(o))throw JI;return o.data}catch{throw JI}},"getSupportedFiatRampTokens");u();l();var Wp=i(t=>t.sort((e,r)=>I.compareNetworkID(e.token.caip19.chainId,r.token.caip19.chainId)),"sortFiatTokens");var PO=K({days:7}),_O=K({hours:1}),fi=i((t,e,r,o=!0,n)=>{let{data:s}=de(),c=Array.from(new Set(s?.addresses?.map(w=>w.networkID))),p=Array.from(new Set(s?.addresses?.map(w=>w.addressType))),d={chainIDs:c},m={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},{data:f}=cr(),g=f?.userID,y=f?.accessToken;return oe({queryKey:tn.fiatRampTokens(m,d,g),queryFn:i(()=>ek(m,d,y),"queryFn"),gcTime:PO,staleTime:_O,enabled:o&&c.length>0,select:i(w=>{let S={...w,groups:w.groups.map(b=>({...b,tokens:Wp(b.tokens.filter(T=>T.addressType?p.includes(T.addressType):!0))}))};return n?n(S):S},"select")})},"useFiatRampGroupedTokens");u();l();u();l();var tk=i(t=>{let e=t?.groups.flatMap(r=>r.tokens)??[];return Wp(e)},"flattenAndSortTokens");var hi=i((t,e,r,o=!0)=>fi(t,e,r,o,tk),"useAllFiatRampTokens");u();l();var Io={onClose:i(()=>{},"onClose"),context:"modal",fungible:void 0,purchaseAmount:"0",purchaseType:"currency",isPurchaseAmountValid:!1,error:void 0,redirectErrorMessage:void 0,ownerPublicKey:"",price:0,minPurchaseAmountUsd:Oh,maxPurchaseAmountUsd:Uh,quickSelectDenominations:qh,paymentMethod:void 0,provider:void 0,checkoutQuoteType:"recommended",redirectURL:void 0,stripePaymentMethod:void 0},Vt=ct(t=>({...Io,setState:i(e=>t(r=>({...r,...e})),"setState"),reset:i(()=>{t(Io)},"reset")}));var rk=i(({platform:t,version:e,onClosePress:r,onNextPress:o})=>{let n=ue(),{i18n:s}=ze(),c=s.language,{setState:p}=Vt(),{data:d}=de(),m=Array.from(new Set(d?.addresses?.map(R=>R.addressType))),{data:f=[]}=hi(t,e,c),{data:g,isPending:y,isFetching:w,isError:S}=fi(t,e,c),b=g?.groups??[],T=y||w||S,[x,C]=(0,gi.useState)(""),E=ec(x)??"",P=x.length>0,M=Vg(f,E,Lh),G=(0,gi.useCallback)(({tokenWithMetadata:R,ownerPublicKey:j})=>{let{token:Q}=R,{name:F,symbol:B,caip19:W}=Q,{chainId:Y}=W;n.capture("fiatOnrampFungibleSelected",{data:{networkId:Y,chainId:I.getChainID(Y),asset:{name:F,symbol:B,type:"fungible"}}}),p({...Io,onClose:r,ownerPublicKey:j,fungible:R.token,paymentMethod:void 0,provider:void 0}),o()},[n,r,o,p]);return(0,gi.useEffect)(()=>{n.capture("fiatOnrampInitiated")},[n]),{enabledAddressTypes:m,groupedTokens:b,isLoading:T,isSearching:P,searchedTokens:M,searchTerm:x,selectedAccount:d,onClosePress:r,onTokenPress:G,setSearchTerm:C}},"useFiatRampSelectFungible");u();l();var Wt=D(Ke(),1);u();l();var On=D(Ke(),1),ak=D(O(),1);u();l();var $h=D(Ke(),1);var Kh=i(({marginBottom:t=0})=>{let{t:e}=ze(),{data:[r]}=Ot(["enable-buy-flow-warning"]);return r?(0,$h.jsx)(be,{marginBottom:t,children:(0,$h.jsx)(yy,{level:"4-error",children:e("buyFlowHealthWarning")})}):null},"BuyFlowWarning");u();l();var rn=D(Ke(),1);u();l();var ko=D(Ke(),1);var yi=D(O(),1);u();l();var _r=D(Ke(),1);var nk=D(O(),1);var Zp=48,Vh=nk.default.memo(({networkId:t,logoURI:e,type:r})=>{let o=vO({disableBadge:!1,tokenType:r,chain:I.getChainID(t)});return(0,_r.jsxs)(be,{size:Zp,position:"relative",children:[e?(0,_r.jsx)(ro,{src:e,height:Zp,width:Zp,borderRadius:"circle",fallback:(0,_r.jsx)(ok,{})}):(0,_r.jsx)(ok,{}),o?(0,_r.jsx)(RO,{networkId:t}):null]})}),ok=i(()=>(0,_r.jsx)(be,{alignItems:"center",justifyContent:"center",size:Zp,backgroundColor:"areaBase",borderRadius:"circle",children:(0,_r.jsx)(Do.Coin,{size:"50%",color:"borderBase"})}),"TokenImageFallback"),vO=i(({disableBadge:t,tokenType:e,chain:r})=>t?!1:xr.get(r).alwaysShowNetworkBadge?!0:!Lt(e),"showNetworkBadge"),RO=i(({networkId:t})=>(0,_r.jsx)(be,{right:"-2",bottom:"-2",position:"absolute",borderColor:"elementBase",borderStyle:"solid",borderWidth:2,style:{borderRadius:9},children:(0,_r.jsx)(pw,{networkID:t,size:18})}),"ChainBadge");u();l();var Un=D(Ke(),1);var sk=i(({image:t,name:e,symbol:r,onPress:o})=>(0,Un.jsx)(be,{backgroundColor:"elementBase",borderRadius:"base",padding:16,onPress:o,children:(0,Un.jsxs)(be,{gap:12,children:[t,(0,Un.jsxs)(be,{gap:4,alignItems:"flex-start",children:[(0,Un.jsx)(Ft,{children:e}),(0,Un.jsx)(Ft,{color:"textDiminished",children:r})]})]})}),"TokenCard");var Ga=yi.default.memo(({enabledAddressTypes:t,selectedAccount:e,tokenWithMetadata:r,type:o,onPress:n})=>{let{token:s,addressType:c}=r,{caip19:p,logoURI:d,name:m,symbol:f}=s,{chainId:g}=p,y=$y(p),{t:w}=ze(),S=m??w("assetDetailUnknownToken"),b=(0,yi.useMemo)(()=>{let x=e?.addresses.find(C=>c?C.addressType===c&&C.networkID===g:C.networkID===g)?.address??"";return I.isEVMNetworkID(g)?x.toLowerCase():x},[e,c,g]),T=(0,yi.useCallback)(()=>{n({tokenWithMetadata:r,ownerPublicKey:b})},[n,r,b]);return c&&!t.includes(c)?(0,ko.jsx)(ko.Fragment,{}):o==="card"?(0,ko.jsx)(sk,{onPress:T,image:(0,ko.jsx)(Vh,{logoURI:d,networkId:p.chainId,type:y}),name:S,symbol:f}):(0,ko.jsx)(cc,{onPress:T,start:(0,ko.jsx)(Vh,{logoURI:d,networkId:p.chainId,type:y}),topLeft:{text:S,after:(0,ko.jsx)(dw,{networkID:p.chainId,address:b})},bottomLeft:f})});var ik=i(({enabledAddressTypes:t,group:e,groupIndex:r,selectedAccount:o,onTokenPress:n})=>{let s=r===0;return(0,rn.jsxs)(be,{marginTop:s?8:24,children:[(0,rn.jsx)(Ft,{font:nn?"bodyMedium":"title3Semibold",color:"textDiminished",marginBottom:8,children:e.groupName}),(0,rn.jsx)(be,{flexWrap:"wrap",direction:"row",gap:s?0:"list",children:e.tokens.map((c,p)=>{let{token:d,addressType:m}=c,f=`${d.symbol}-${d.caip19.chainId}-${p}`;return m&&!t.includes(m)?null:s?(0,rn.jsx)(be,{flexBasis:"50%",paddingLeft:p%2===0?0:4,paddingRight:p%2===0?4:0,paddingBottom:p>=e.tokens.length-2?0:8,children:(0,rn.jsx)(Ga,{enabledAddressTypes:t,selectedAccount:o,tokenWithMetadata:e.tokens[p],type:"card",onPress:n})},f):(0,rn.jsx)(Ga,{tokenWithMetadata:e.tokens[p],enabledAddressTypes:t,selectedAccount:o,type:"row",onPress:n},f)})})]},e.groupName)},"FiatRampTokenGroup");var ck=ak.default.memo(({groupedTokens:t,enabledAddressTypes:e,selectedAccount:r,onTokenPress:o})=>(0,On.jsxs)(On.Fragment,{children:[(0,On.jsx)(Kh,{marginBottom:16}),t.map((n,s)=>(0,On.jsx)(ik,{enabledAddressTypes:e,group:n,groupIndex:s,onTokenPress:o,selectedAccount:r},n.groupName))]}));u();l();var wi=D(Ke(),1);var uk=D(O(),1);var lk=uk.default.memo(({enabledAddressTypes:t,searchedTokens:e,selectedAccount:r,onTokenPress:o})=>(0,wi.jsx)(wi.Fragment,{children:e.map((n,s)=>(0,wi.jsx)(be,{marginBottom:8,children:(0,wi.jsx)(Ga,{enabledAddressTypes:t,selectedAccount:r,tokenWithMetadata:n,type:"row",onPress:o})},`${n.token.symbol}-${n.token.caip19.chainId}-${s}`))}));var pk=i(t=>{let{isLoading:e,isSearching:r,searchedTokens:o,selectedAccount:n,enabledAddressTypes:s,onTokenPress:c,groupedTokens:p}=t;return(0,Wt.jsx)(Wt.Fragment,{children:e?(0,Wt.jsx)(DO,{}):r?(0,Wt.jsx)(Wt.Fragment,{children:o.length>0?(0,Wt.jsx)(lk,{searchedTokens:o,selectedAccount:n,enabledAddressTypes:s,onTokenPress:c}):(0,Wt.jsx)(BO,{})}):(0,Wt.jsx)(ck,{enabledAddressTypes:s,groupedTokens:p,selectedAccount:n,onTokenPress:c})})},"FiatRampFungiblesCore"),DO=i(()=>(0,Wt.jsx)(be,{gap:"list",paddingTop:"screen",children:[...Array(3)].map((t,e)=>(0,Wt.jsx)(Zn,{topRight:!1,bottomRight:!1},e))}),"FiatRampTokensLoading"),BO=i(()=>{let{t}=ze();return(0,Wt.jsx)(be,{flex:1,alignItems:"center",justifyContent:"center",children:(0,Wt.jsx)(Ft,{font:"body",color:"textDiminished",align:"center",children:t("noBuyOptionsAvailableInCountry")})})},"FiatRampTokensEmpty");var dk={container:pd({display:"flex",flexDirection:"column",height:"100%"}),listContainer:pd({overflow:"auto",minHeight:0,paddingTop:16,paddingBottom:80})},mk=i(({platform:t,navigateToForm:e,onBackPress:r})=>{let{t:o}=ze(),n=rk({platform:t,version:Re,onClosePress:r,onNextPress:e});return(0,qn.jsxs)(be,{flex:1,className:dk.container,children:[(0,qn.jsx)(gy,{id:"search",label:"Search",showLabel:!1,placeholder:o("assetListSearch"),setValue:n.setSearchTerm,value:n.searchTerm||"",children:(0,qn.jsx)(Do.Search,{size:16,color:"textDiminished"})}),(0,qn.jsx)(be,{flex:1,className:dk.listContainer,children:(0,qn.jsx)(pk,{...n})})]})},"FiatRampFungibles");u();l();u();l();var yk=D(Ke(),1);u();l();var bt=D(Ke(),1);var Yp=D(O(),1);u();l();var Si=D(Ke());var fk=i(({platform:t,navigateToAllProviders:e})=>{let{t:r}=ze(),o=Vt(),{provider:n,fungible:s}=o,{currencyCode:c}=Pt(),{data:p}=Ha(t,Re,v.language,{token:s?.caip19,fiatCurrencyCode:c,providerId:n?.id}),d=p?.provider||n;return(0,Si.jsxs)(be,{onPress:e,direction:"row",alignItems:"center",justifyContent:"flex-start",gap:4,children:[d?.logo&&(0,Si.jsx)(ro,{borderRadius:6,width:20,height:20,src:d?.logo}),(0,Si.jsx)(Ft,{font:"captionSemibold",color:"textBase",children:d?.name||r("fiatRampChangeProviderTitle")}),(0,Si.jsx)(Do.ChevronDown,{size:16})]})},"FiatRampSelectedProvider");u();l();var Fo=D(Ke(),1);var hk=D(O(),1);var Wh=i(({assets:t,type:e,name:r,onClick:o,estimatedArrival:n})=>{let s=(0,hk.useMemo)(()=>{let c=(0,Fo.jsx)(be,{borderRadius:"circle",size:48,alignItems:"center",justifyContent:"center",backgroundColor:"black",children:(0,Fo.jsx)(ro,{width:28,height:28,src:t.icon})});switch(e){case Mn.CARD:return(0,Fo.jsx)(Pi,{icon:"CreditCard",size:48,backgroundColor:"black",color:"white"});case Mn.BANK_TRANSFER:return(0,Fo.jsx)(Pi,{icon:"Bank",size:48,backgroundColor:"black",color:"white"});case Mn.MOBILE_WALLET:return r.toLowerCase().includes("apple")?(0,Fo.jsx)(Pi,{icon:"LogoApplePay",size:48,backgroundColor:"black",color:"white"}):r.toLowerCase().includes("google")?(0,Fo.jsx)(Pi,{icon:"LogoGooglePay",size:48,backgroundColor:"black",color:"white"}):c;default:return c}},[t.icon,r,e]);return(0,Fo.jsx)(wy,{rows:[{type:"base",start:s,topLeft:{text:r,font:"title3Semibold"},bottomLeft:{before:(0,Fo.jsx)(Do.Clock,{color:"textDiminished",size:14}),text:n},onPress:o}]})},"FiatRampPaymentMethodRow");var NO=["ios","android"],gk=i(({platform:t,navigateToAllProviders:e,navigateToForm:r})=>{let{t:o}=ze(),n=ue(),s=Vt(),c=Vt(C=>C.setState),{provider:p,fungible:d}=s,{currencyCode:m}=Pt(),{data:f,isFetching:g,isPending:y}=Ha(t,Re,v.language,{token:d?.caip19,fiatCurrencyCode:m,providerId:p?.id}),{provider:w,paymentMethods:S}=f??{},b=w||p,T=(0,Yp.useCallback)(C=>{c({paymentMethod:C,provider:b,checkoutQuoteType:"selected"}),n.capture("fiatOnrampPaymentMethodSelected",{data:{paymentMethodId:C.id}}),r()},[n,r,b,c]),x=(0,Yp.useMemo)(()=>g||y?(0,bt.jsx)(bt.Fragment,{children:[...Array(3)].map((C,E)=>(0,bt.jsx)(Zn,{topRight:!1,bottomRight:!1},E))}):S?.length===0?(0,bt.jsx)(LO,{}):(0,bt.jsx)(bt.Fragment,{children:S?.map(C=>(0,bt.jsx)(Wh,{onClick:i(()=>T(C),"onClick"),...C},C.id))}),[g,y,T,S]);return(0,bt.jsxs)(be,{gap:12,children:[!NO.includes(t)&&(0,bt.jsxs)(be,{direction:"row",alignItems:"center",gap:16,justifyContent:"space-between",children:[(0,bt.jsx)(Ft,{font:"title1Semibold",color:"textBase",children:o("fiatRampPaymentMethodsTitle")}),(0,bt.jsx)(fk,{platform:t,navigateToAllProviders:e})]}),(0,bt.jsx)(Ft,{font:"label",color:"textDiminished",children:o("buyThirdPartyScreenPaymentMethodDescription")}),(0,bt.jsx)(be,{gap:8,children:x})]})},"FiatRampPaymentMethodsCore"),LO=i(()=>{let{t}=ze();return(0,bt.jsx)(be,{flex:1,alignItems:"center",justifyContent:"center",children:(0,bt.jsx)(Ft,{font:"body",color:"textDiminished",align:"center",children:t("buyThirdPartyScreenPaymentMethodEmptyState")})})},"FiatRampPaymentMethodsEmpty");var wk=i(({platform:t,navigateToAllProviders:e,navigateToForm:r})=>(0,yk.jsx)(gk,{platform:t,navigateToAllProviders:e,navigateToForm:r}),"FiatRampPaymentMethods");u();l();var Tk=D(Ke(),1);u();l();var Sk=D(O(),1),Sr=D(Ke(),1);var Xp=D(O(),1);var bk=i(({platform:t,navigateToPaymentMethods:e})=>{let{t:r}=ze(),o=ue(),n=rt("enable-fiat-ramp-provider-quotes"),s=Vt(),c=Vt(E=>E.setState),{paymentMethod:p,purchaseType:d,purchaseAmount:m,fungible:f,ownerPublicKey:g}=s,{currencyCode:y}=Pt(),{data:w,isFetching:S,isPending:b}=jh(t,Re,v.language,{...d==="currency"?{fiatAmount:m}:{tokenAmount:m},token:f?.caip19,fiatCurrencyCode:y,destinationAddress:g&&f?{address:g,chainId:f?.caip19.chainId,resourceType:V.address}:void 0}),T=w?.paymentMethod||p,x=(0,Xp.useCallback)(E=>{o.capture("fiatOnrampProviderSelected",{data:{chainId:w?.token?.chainId,providerId:E.id,paymentMethodId:T?.id,destinationAmount:E.quote?.displayDestinationAmount,sourceAmount:E.quote?.displaySourceAmount,asset:w?.token,tag:E.tag}}),c({provider:E,paymentMethod:T,checkoutQuoteType:"selected"}),e?.()},[o,w?.token,c,T,e]),C=(0,Xp.useMemo)(()=>w?.providers.map((E,P)=>{let M=E.id===s.provider?.id;return n?{type:"base",start:(0,Sr.jsx)(ro,{width:48,height:48,borderRadius:6,src:E.logo}),topLeft:E.name,topRight:{text:E.quote?.displayDestinationAmount,color:"textBase"},bottomRight:E.quote?.displaySourceAmount?{text:`~${E.quote.displaySourceAmount}`}:void 0,bottomLeft:E.tag&&{text:E.tag,color:P===0?"spotPositive":"textDiminished"},onPress:i(()=>x(E),"onPress")}:{type:"radio",active:M,start:(0,Sr.jsx)(ro,{width:24,height:24,borderRadius:6,src:E.logo}),topLeft:E.name,topRight:E.tag,onPress:i(()=>x(E),"onPress")}})??[],[s.provider?.id,n,x,w?.providers]);return(0,Sr.jsxs)(be,{gap:16,children:[(0,Sr.jsx)(Ft,{font:"label",color:"textDiminished",children:r("buyThirdPartyScreenProvidersDescription")}),(0,Sr.jsx)(be,{gap:8,children:S||b?(0,Sr.jsx)(UO,{}):w?.providers.length===0?(0,Sr.jsx)(MO,{}):C.map(E=>(0,Sk.createElement)(cc,{...E,key:E.topLeft}))})]})},"FiatRampProvidersCore"),MO=i(()=>{let{t}=ze();return(0,Sr.jsx)(be,{flex:1,alignItems:"center",justifyContent:"center",children:(0,Sr.jsx)(Ft,{font:"body",color:"textDiminished",align:"center",children:t("buyThirdPartyScreenProvidersEmptyState")})})},"FiatRampProvidersEmpty"),UO=i(()=>[...Array(3)].map((t,e)=>(0,Sr.jsx)(Zn,{topRight:!1,bottomRight:!1},e)),"LoadingTable");var Ak=i(({platform:t,navigateToPaymentMethods:e})=>(0,Tk.jsx)(bk,{platform:t,navigateToPaymentMethods:e}),"FiatRampProviders");u();l();u();l();u();l();var zn=D(O(),1);u();l();var Jp=D(O(),1);var Zh=i(({clientPlatform:t,appVersion:e,locale:r,caip19:o,addressType:n,enabled:s=!0,destinationAddress:c})=>{let{data:p,isLoading:d,isError:m,isFetched:f}=de(),{data:g=[],isLoading:y,isError:w,isFetched:S}=hi(t,e,r,s),b=(0,Jp.useMemo)(()=>{if(o)return g.find(x=>n&&I.getChainName(Ve(o).chainId)===I.bitcoin.name?N(x.token.caip19)===o&&"addressType"in x&&x.addressType===n:N(x.token.caip19)===o)},[n,o,g]),T=(0,Jp.useMemo)(()=>{if(!b)return"";if(c)return c;let x=p?.addresses.find(C=>b?.addressType?C.addressType===b.addressType&&C.networkID===b?.token.caip19.chainId:C.networkID===b?.token.caip19.chainId)?.address??"";return b?.token.caip19.chainId&&I.isEVMNetworkID(b.token.caip19.chainId)&&(x=x.toLowerCase()),x},[c,p?.addresses,b]);return(0,Jp.useMemo)(()=>({tokenToBuy:b,destinationAddress:T,isLoading:d||y,isError:m||w,isFetched:f&&S}),[T,w,m,S,f,y,d,b])},"useFiatRampTokenMetadataFromCaip19");var xk=i(({caip19:t,amount:e,clientPlatform:r,redirectURL:o,addressType:n,destinationAddress:s,provider:c,paymentMethod:p,navigateToFiatRampForm:d,onClose:m,captureAnalyticsEvent:f})=>{let{setState:g}=Vt(),{tokenToBuy:y,destinationAddress:w,isLoading:S,isError:b,isFetched:T}=Zh({clientPlatform:r,appVersion:Re,locale:v.language,caip19:t,addressType:n,destinationAddress:s}),x=(0,zn.useMemo)(()=>{if(y)return{token:y?.token.caip19,providerId:c,paymentMethodId:p,destinationAddress:{address:w,chainId:y?.token.caip19?.chainId,resourceType:V.address}}},[y,c,p,w]),{data:C,isLoading:E}=Vp(r,Re,v.language,x??{},!!x&&!!c&&!!p),P=(0,zn.useMemo)(()=>t?E?!1:!!y&&!!w:!0,[t,E,w,y]),M=(0,zn.useCallback)(()=>{!t||!y||!w||g({...Io,onClose:m??(()=>{}),ownerPublicKey:w,fungible:y?.token,purchaseAmount:e??Io.purchaseAmount,redirectURL:o,provider:C?.provider,paymentMethod:C?.paymentMethod})},[t,y,w,g,m,e,o,C?.provider,C?.paymentMethod]),G=(0,zn.useCallback)(()=>{if(!t){f?.(),d?.();return}!y||!w||(M(),f?.(),d?.())},[t,f,w,d,M,y]);return(0,zn.useMemo)(()=>({canBuy:P,openBuy:G,saturateState:M,resolvedDestinationAddress:w,token:y,isLoading:S,isError:b,isFetched:T}),[P,w,b,T,S,G,M,y])},"useBuyFlowForToken");u();l();var OO=new Kt("Failed to get FiatRampProviderUrl"),qO=i(async(t,e,r,o,n)=>{try{let s={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},c=await z.api().headers(s).bearer(n).post("/fiat_ramp/v2/onramp/provider_url",o);if(!te(c))throw new Kt(c.data.message);return c.data}catch(s){throw s instanceof Kt?s:OO}},"getProviderUrl");u();l();var ed=D(O());var zO=["enable","reject"],QO=i(({continueSwap:t,dismiss:e})=>{let r=ue(),{setSlippageSetting:o}=jt(),n=(0,ed.useCallback)(c=>{switch(e(),c){case"enable":r.capture("autoSlippageOptIn",{data:{step:"enabledAutoSlippage"}}),o({type:fe.Auto}),_a();break;case"reject":r.capture("autoSlippageOptIn",{data:{step:"rejectedAutoSlippage"}}),o({type:fe.Fixed}),t();break}},[t,e,o,r]),s=(0,ed.useMemo)(()=>zO.map(c=>({label:v.t(c==="enable"?"swapSlippageOptInEnableOption":"swapSlippageOptInRejectOption"),variant:c==="enable"?"primary":"secondary",onPress:i(()=>n(c),"onPress")})),[n]);return{title:v.t("swapSlippageOptInTitle"),description:v.t("swapSlippageOptInSubtitle"),learnMoreText:v.t("commandLearnMore"),learnMoreUrl:ex,options:s}},"useAutoSlippageOptInProps");u();l();var Ck=D(O());u();l();var bi=D(O());var HO=q(1);function Ek(t,e,r){let o=ue(),[n,s]=(0,bi.useState)(!1),c=(0,bi.useCallback)(async()=>{await o.capture("swapperToggleBestPriceRatio",{data:{unitCurrency:n?"buy token":"sell token"}}),s(!n)},[o,n]),p=$(m=>m.sellFungible),d=$(m=>m.buyFungible);return(0,bi.useMemo)(()=>{let m=!1,f="";if(e&&r){let g=d?.data,y=p?.data;if(g&&y){let{buyAmount:w,sellAmount:S}=r,b=xe(w,g.decimals),T=xe(S,y.decimals),x=b.dividedBy(T),C=`1 ${y.symbol} \u2248 ${Ss(x)} ${g.symbol}`,E=`1 ${g.symbol} \u2248 ${Ss(HO.dividedBy(x))} ${y.symbol}`;m=new q(r.buyAmount).isEqualTo(t),f=n?E:C}}return{isBestRate:m,rate:f,flip:c}},[t,r,n,e,p,d,c])}i(Ek,"useExchangeRate");var GO=i(({selectProvider:t})=>{let{currentQuote:e,quoteResponse:r}=Ee(),{currencySymbol:o,fromUsd:n}=Pt(),s=e?.buyAmount??"",c=Ek(s,r,e),p=eu(Le(e)),d=e?.baseProvider.name??"";return{details:(0,Ck.useMemo)(()=>e?le(e)?$O({quote:e,selectProvider:t,exchangeRate:c,currencySymbol:o,fromUsd:n}):jO({provider:d,sources:p,exchangeRate:c,selectProvider:t}):[],[e,d,p,c,t,o,n]),footnote:v.t("swapProviderPricingFootnote")}},"useSwapPricing"),jO=i(({provider:t,sources:e,exchangeRate:r,selectProvider:o})=>[{label:v.t("swapProviderPricingProvider"),value:t,icon:"chevron-right",onPress:o},{label:v.t("swapProviderPricingMarket"),value:e},{label:v.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip}],"getStandardRows"),$O=i(({quote:t,selectProvider:e,exchangeRate:r,currencySymbol:o,fromUsd:n})=>{let s=t.baseProvider.name,c=Rs(t).toString(),p=Vr(Zo(t));return[{label:v.t("swapProviderPricingProvider"),value:s,icon:"chevron-right",onPress:e},{label:v.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip},{label:v.t("swapProviderPricingFees"),value:`${o}${n(Number(c),2)} ${v.t("swapProvidersFee")}`},{label:v.t("swapProviderPricingTime"),value:p}]},"getBridgeRows");u();l();u();l();var Yh=D(O());var KO=.05,VO=i(({sellNetworkId:t,buyNetworkId:e,destinationMinRequiredBalance:r,priceMap:o})=>{if(!t||!e||!o)return new A(0);let n=N(Nr(I.getChainID(t))),s=N(Nr(I.getChainID(e))),c=o[n]?.usd,p=o[s]?.usd;if(!c||!p)return new A(0);let d=xe(r.toNumber(),I.getTokenDecimals(e)),m=nw(d.toNumber(),p),f=sw(m,c,I.getTokenDecimals(t));return new A(f).times(1+KO)},"getSourceBridgeFeeForMinRequiredBalance"),Ik=i(({sellFungible:t,buyFungible:e})=>{let r=t?.data.chain.id,o=e?.data.chain.id,n=o??r,s=vt(r,o),{fungible:c}=Tc({key:e?.data.key}),{data:p}=de(),d=(0,Yh.useMemo)(()=>p?.addresses.find(w=>w.networkID===n),[p,n]),f=Xo().map(w=>Nr(w)),{data:g}=Lo({query:{data:f},queryOptions:{refetchInterval:!1}}),{data:y=0}=cn(d);return(0,Yh.useMemo)(()=>{if(c)return new A(0);let w=new A(y);return s?VO({sellNetworkId:r,buyNetworkId:o,destinationMinRequiredBalance:w,priceMap:g}):w},[c,y,s,r,o,g])},"useDestinationMinRequiredBalance");u();l();var Xh=D(O());var kk=i(t=>{let e=t?.data.chain.id,{data:r}=de(),o=(0,Xh.useMemo)(()=>r?.addresses.find(s=>s.networkID===e),[r,e]),{data:n=0}=cn(o);return(0,Xh.useMemo)(()=>new A(n),[n])},"useSourceMinRequiredBalance");u();l();function Fk({sellFungible:t,totalFees:e,minRequiredBalance:r,currentQuote:o}){let n=t?.type?Lt(t?.type):!1,{source:s,destination:c}=r;if(n){let p=new A(o?.sellAmount??0);return e.plus(p)}else{let p=s.plus(c);return e.plus(p)}}i(Fk,"getTotalNativeRequirement");u();l();function Pk({sellFungible:t,sellNativeFungible:e,totalNativeRequirement:r}){let o=t?.data.chain.id,n=e?zt(e.data.amount,e.data.decimals):"-",s=e?zt(r,e.data.decimals):"-";return{networkId:o,balance:n,required:s}}i(Pk,"getInsufficientBalanceArgs");u();l();var _k=D(O());var WO=i(({goToAssetSelect:t})=>{let{setSearchQuery:e}=$();return(0,_k.useCallback)(r=>{r==="buy"&&e(""),t(r)},[t,e])},"useOnSwapAssetSelect");u();l();var Jr=D(O());u();l();u();l();var td=class{static{i(this,"StandardProviderRowStrategy")}getRow({quote:e,buyToken:r}){let o=`${Er(xe(e.buyAmount,r.decimals),xr.get(r.networkId).formDisplayPrecision)} ${r.symbol}`;return{type:"standard",key:e.baseProvider.id,logoUri:e.baseProvider.logoUri,topLeft:{text:e.baseProvider.name},topRight:{text:o,color:"textDiminished"}}}getAutoRow(){return{type:"standard",key:ur,topLeft:{text:v.t("selectSwapProviderAutoLabel")},topRight:{text:v.t("selectSwapProviderAutoDescription"),color:"textDiminished"}}}},Jh=class extends td{static{i(this,"BridgeProviderRowStrategy")}getRow(e){let{quote:r,currencySymbol:o,fromUsd:n}=e;if(!le(r))throw new Error("Quote is not a bridge quote");let s=super.getRow(e),c=Vr(Zo(r)),p=Rs(r).toString();return{...s,type:"bridge",bottomLeft:{text:c},bottomRight:{text:`${o}${n(Number(p),2)} ${v.t("swapProvidersFee")}`}}}getAutoRow(){return{type:"bridge",key:ur,topLeft:{text:v.t("selectSwapProviderAutoLabel")},topRight:{text:v.t("selectSwapProviderAutoDescription"),color:"textDiminished"},bottomLeft:{text:v.t("selectSwapProviderAutoTBD")},bottomRight:{text:v.t("selectSwapProviderAutoTBD")}}}},eg=new td,tg=new Jh;var rd=i(({quoteResponse:t,buyToken:e,currencySymbol:r,setSelectedProvider:o,fromUsd:n})=>{let s=t.type==="xchain",c=s?tg.getAutoRow():eg.getAutoRow(),p={...c,onPress:i(()=>o(c.key),"onPress")},d=t.quotes.reduce((m,f)=>{let y=(s?tg:eg).getRow({quote:f,buyToken:e,currencySymbol:r,fromUsd:n});return[...m,{...y,onPress:i(()=>o(f.baseProvider.id),"onPress")}]},[]);return[p,...d]},"getSwapProviderRows");var ZO=i(({dismiss:t})=>{let{fromUsd:e,currencySymbol:r}=Pt(),o=ue(),n=nt(),s=So(S=>S.setPreferredProvider),c=So(S=>S.preferredProvider),[p,d]=(0,Jr.useState)(c??ur),[m,f]=(0,Jr.useState)(n.getQuoteProcessorState());(0,Jr.useEffect)(()=>{let S=n.subscribeQuoteProcessor({onStateChange(b,T){f(T)}});return()=>S()},[n]);let g=(0,Jr.useMemo)(()=>{let S=m.type;if(S!=="firstQuoteReceived"&&S!=="quoteProcessed")return[];let{response:b,input:T}=m,{buy:x}=T;return rd({quoteResponse:b,buyToken:{networkId:x.data.chain.id,decimals:x.data.decimals,symbol:x.data.symbol??""},currencySymbol:r,setSelectedProvider:d,fromUsd:e})},[m,r,e]),y=(0,Jr.useCallback)(()=>{let S=p===ur?void 0:p;s(S),o.capture("swapperProviderSelected",{data:{provider:S}}),t()},[p,s,t,o]),w=(0,Jr.useMemo)(()=>[{theme:"secondary",disabled:!1,label:v.t("commandCancel"),onPress:t},{theme:"primary",disabled:p===(c??ur),label:v.t("commandApply"),onPress:y}],[y,t,p,c]);return{selectedProvider:p,rows:g,buttons:w}},"useSelectPreferredProvider");u();l();var Qn=D(O());var YO=i(({dismiss:t})=>{let{fromUsd:e,currencySymbol:r}=Pt(),o=ue(),n=$(S=>S.quoteResponse),s=$(S=>S.buyFungible),c=$(S=>S.selectedBaseProvider),p=$(S=>S.setSelectedBaseProvider),d=So(S=>S.setPreferredProvider),[m,f]=(0,Qn.useState)(c),g=(0,Qn.useMemo)(()=>!n||!s?[]:rd({quoteResponse:n,buyToken:{networkId:s.data.chain.id,decimals:s.data.decimals,symbol:s.data.symbol??""},currencySymbol:r,setSelectedProvider:f,fromUsd:e}),[n,s,r,e,f]),y=(0,Qn.useCallback)(()=>{p(m),d(m),o.capture("swapperProviderSelected",{data:{provider:m}}),t()},[m,p,d,t,o]),w=(0,Qn.useMemo)(()=>[{background:"element",disabled:!1,label:v.t("commandCancel"),onPress:t},{background:"spot",disabled:m===c,label:v.t("commandApply"),onPress:y}],[y,t,m,c]);return{selectedProvider:m,rows:g,buttons:w}},"useSelectSwapProvider");u();l();var $a=D(O());var ja=ct(t=>({isInitializeComplete:!0,swapMode:void 0,setSwapMode:i(e=>t({swapMode:e,isInitializeComplete:!1}),"setSwapMode"),setIsInitializeComplete:i(e=>t({isInitializeComplete:e}),"setIsInitializeComplete")})),XO=ja.getState().setSwapMode,JO=i(()=>ja(t=>t.isInitializeComplete===!1),"useInitializingClassicSwapMode"),e2=i(()=>{let t=nt(),e=ay(),r=In(),o=(0,$a.useMemo)(()=>e.find(p=>r.includes(p))??ar.Mainnet,[e,r]),n=ja(p=>p.swapMode),s=ja(p=>p.setSwapMode),c=ja(p=>p.setIsInitializeComplete);return(0,$a.useEffect)(()=>t.subscribeToken({onStateChange:i(p=>{p.type==="initializeCompleted"&&c(!0)},"onStateChange")}),[t,c]),(0,$a.useMemo)(()=>{if(n)return n;let p={type:"swap",network:o,takerCaip19:void 0,takerDestinationCaip19:void 0};return s(p),p},[o,n,s])},"useClassicSwapMode");u();l();var Ye=D(O());u();l();function od(t,e,r,o){if(r==="sell")return o.includes("insufficientBalance");let n=t?.sellAmount,s=e.find(c=>c.percentage===1)?.amount.toString();return!!n&&!!s&&new A(n).gt(s)}i(od,"hasInsufficientSellBalance");var t2=i(t=>{let{tokenState:e,quotedAmounts:r,quoteProcessorState:o,sellPercentages:n,inputErrors:s,setAmount:c}=t,p=rt("enable-be-swapper-max-amount"),[d,m]=(0,Ye.useState)(void 0),[f,g]=(0,Ye.useState)(""),[y,w]=(0,Ye.useState)("crypto"),[S,b]=(0,Ye.useState)("sell"),T=(0,Ye.useRef)(!1),{currencySymbol:x,toUsd:C,fromUsd:E,formatLocalizedPrice:P}=Pt(),M=by(),{balanceDisplayStrategy:G}=Lf(),R=Kc(),j=W0(),Q=nt(),F=(0,Ye.useCallback)((Fe,et,at,Zt)=>{if(m(void 0),Fe===""){g(Fe),c({amount:"0",denomination:Zt??y,perspective:et,tokenStateOverride:at});return}let br=Xg(Fe);p2(br)&&(g(br),c({amount:y==="fiat"?String(C(br)):br,denomination:Zt??y,perspective:et,tokenStateOverride:at}))},[y,g,c,C]),B=(0,Ye.useCallback)((Fe,et)=>{S==="buy"&&b("sell"),m(Fe);let at=Fe.getAmountForDenomination(y),Zt=y==="fiat"?E(at.toString()):at.toString();g(d2(new q(Zt),y,et)),c({amount:at.toString(),denomination:y,perspective:"sell"})},[m,S,y,c,E]),W=(0,Ye.useCallback)(()=>{Q.switchTokens()},[Q]),Y=(0,Ye.useCallback)(Fe=>{let et=c2({perspective:S,currencyDenomination:y,quotedAmounts:r,fromUsd:E});et&&F(et.toString(),S,Fe)},[y,S,F,r,E]);(0,Ye.useEffect)(()=>Q.subscribeToken({onStateChange:i((Fe,et,at)=>{Fe.type==="switchTokens"&&(Y(at),T.current=!0,p&&Q.refreshPair({swapMode:Fe.mode,cashAddresses:R,settings:j})),p&&Fe.type==="changeToken"&&(T.current=!0,Q.refreshPair({swapMode:Fe.mode,cashAddresses:R,settings:j}))},"onStateChange")}),[Q,Y,R,j,p]),(0,Ye.useEffect)(()=>{T.current&&(T.current=!1,F(f,S))},[n]);let ee=(0,Ye.useCallback)(()=>{let Fe=y==="crypto"?"fiat":"crypto";if(w(Fe),!!r)switch(Fe){case"crypto":let et=og(S,r);g(et.toString());break;case"fiat":let at=rg(S,r)?.toFixed(2)??"0",Zt=E(at);g(String(Zt));break}},[y,S,r,E]),X=(0,Ye.useMemo)(()=>ix(),[]),{sellAsset:Ue,buyAsset:Ae}=vk(e),mt=sx({sellAsset:Ue,buyAsset:Ae,currencyDenomination:y}),Va=(0,Ye.useMemo)(()=>a2(["sell","buy"],Fe=>r2({perspective:Fe,tokenState:e,quoteProcessorState:o,currencyDenomination:y,currentPerspective:S,inputAmount:f,inputErrors:s,isBalanceHidden:M,balanceDisplayStrategy:G,sellPercentages:n,currencyDenominationSupportRules:X,isBuyAmountEditable:mt,quotedAmounts:r,currencySymbol:x,fromUsd:E,formatLocalizedPrice:P})),[y,f,s,M,G,n,S,o,r,e,X,mt,x,E,P]),on=(0,Ye.useCallback)(()=>{F("",S)},[F,S]);(0,Ye.useEffect)(()=>{let Fe=Q.subscribeToken({onStateChange(et,at,Zt){!ht(at)||!ht(Zt)||et.type==="changeToken"&&at.sellToken.data.tokenAddress!==Zt.sellToken.data.tokenAddress&&on()}});return()=>Fe()},[Q,on]),(0,Ye.useEffect)(()=>Q.subscribeAccountChange({onAccountChange:i(Fe=>{on(),Q.stopQuoteProcessor();let et=Q.getTokenState(),at=Fe.addresses[0];ht(et)&&at&&Q.initializeSwap({swapMode:{type:"swap",network:at.networkID,takerCaip19:void 0,takerDestinationCaip19:void 0},cashAddresses:R,settings:j})},"onAccountChange")}),[Q,on,R,j]);let Wa=(0,Ye.useCallback)(Fe=>{if(b(Fe),!r||!ht(e))return;let{sellAsset:et,buyAsset:at}=vk(e);if(!(Fe==="sell"?et:at))return;let br,Hn;switch(y){case"crypto":br=og(Fe,r).toString(),Hn=br;break;case"fiat":let Ti=rg(Fe,r)?.toFixed(2)??"0";br=String(E(Ti)),Hn=Ti;break}g(br),c({amount:Hn,denomination:y,perspective:Fe})},[y,r,e,E,g,c]);return{inputAmount:f,tokens:Va,currencyDenomination:y,inputPerspective:S,tokenState:e,quotedAmounts:r,quoteProcessorState:o,inputErrors:s,currentSellPercentage:d,sellPercentages:n,switchTokens:W,setInputAmount:F,switchCurrencyDenomination:ee,setSellPercentage:B,clearInput:on,setInputPerspective:Wa,setCurrencyDenomination:w}},"useClassicSwapperAssets");function r2({perspective:t,tokenState:e,quoteProcessorState:r,currencyDenomination:o,currentPerspective:n,inputAmount:s,inputErrors:c,isBalanceHidden:p,balanceDisplayStrategy:d,sellPercentages:m,currencyDenominationSupportRules:f,isBuyAmountEditable:g,quotedAmounts:y,currencySymbol:w,fromUsd:S,formatLocalizedPrice:b}){if(!ht(e))return;let T=s2(t,y),x=i2(t,n,e,s,y),C=o==="crypto"?T:new q(S(x)).toFixed(2),E=l2(s);t===n?C=s:E.gt(0)||(C="");let P=f.every(B=>B.isSupported(t,e.sellToken,e.sellTokenPrice?.usd,e.buyToken,e.buyTokenPrice?.usd)),M=t==="sell"?e.sellToken:e.buyToken,G=o==="crypto"?b(new q(S(x)).toNumber()):n2(T,M),R=m.find(B=>B.percentage===1)?.amount.toString(),j=t==="sell"?R:void 0,Q=o2(y,m,n,c);return{perspective:t,fungible:M,balance:u2(M,d,p,j),amount:C,secondaryAmount:E.gt(0)?G:"",isAmountLoading:r.type==="starting"&&t!==n,isSecondaryAmountLoading:r.type==="starting",hasAmountWarning:Q,isAmountEditable:t==="sell"?!0:g,supportsCurrencyDenominationSwitching:P,amountPrefix:o==="fiat"?w:void 0,percentages:t==="sell"?m:[],warnings:t==="buy"?e.warnings:[]}}i(r2,"createSwapperAsset");function o2(t,e,r,o){return od(t,e,r,o)?!0:o.length>0}i(o2,"hasInputAmountWarning");function n2(t,e){let r=xr.get(e.data.chain.id).formDisplayPrecision;return`${Er(new q(t),r)} ${e.data.symbol??""}`}i(n2,"formatSecondaryAmount");function s2(t,e){return e?og(t,e).toString():"0"}i(s2,"parseCyrptoAmount");function i2(t,e,r,o,n){if(n)return rg(t,n)?.toString()??"0";{if(t!==e||!ht(r))return"0";let s=t==="sell"?r.sellTokenPrice:r.buyTokenPrice;return s?.usd?new q(o).times(s.usd).toString():"0"}}i(i2,"parseFiatAmount");function rg(t,e){switch(t){case"sell":return e?.sellAmountUsd;case"buy":return e?.buyAmountUsd}}i(rg,"getQuotedUsdAmount");function og(t,e){switch(t){case"sell":return e.sellAmount;case"buy":return e.buyAmount}}i(og,"getQuotedCryptoAmount");function a2(t,e){return t.reduce((r,o,n)=>{let s=e(o,n,t);return s!=null&&r.push(s),r},[])}i(a2,"compactMap");function c2({perspective:t,currencyDenomination:e,quotedAmounts:r,fromUsd:o}){if(r)switch(t){case"sell":return e==="crypto"?r.buyAmount:r.buyAmountUsd?new q(o(r.buyAmountUsd.toString(),2)):void 0;case"buy":return e==="crypto"?r.sellAmount:r.sellAmountUsd?new q(o(r.sellAmountUsd.toString(),2)):void 0}}i(c2,"getOppositeQuotedAmount");function u2(t,e,r,o){let n=o?q(o):t.data?.balance;if(!(!n||r))return De(t)?ac(n):e.format(n,t.data?.symbol??"")}i(u2,"parseBalance");function l2(t){return t==null?new q(0):t===""?new q(0):new q(t)}i(l2,"normalizeInputAmount");function p2(t){try{let e=new q(t);return e.isFinite()?!e.isNegative():!1}catch{return!1}}i(p2,"isValidAmount");function vk(t){return ht(t)?{sellAsset:t.sellToken,buyAsset:t.buyToken}:{sellAsset:void 0,buyAsset:void 0}}i(vk,"getTokens");var d2=i((t,e,r)=>e==="fiat"?t.gte(.01)?t.decimalPlaces(2).toString():t.decimalPlaces(5,q.ROUND_UP).toString():t.decimalPlaces(r.data.decimals).toString(),"truncateDisplayAmount");u();l();var Lk=D(O());u();l();var ng=D(O());u();l();var id=D(O());u();l();u();l();var nd=class{static{i(this,"GaslessSwapInterceptor")}gaslessSwapFeeResult;insufficientFundsInterceptor;constructor(e,r){this.gaslessSwapFeeResult=e,this.insufficientFundsInterceptor=r}intercept(e){return this.gaslessSwapFeeResult.success?"continue":this.insufficientFundsInterceptor.intercept(e)}};u();l();var sd=class{static{i(this,"InsufficientFundsInterceptor")}intercept({hasInsufficientFunds:e,showInsufficientFunds:r}){return e?(r(),"interrupt"):"continue"}};var Rk=i(t=>{let e=new sd,r=m2(t);return r?[new nd(r,e)]:[e]},"getExecuteSwapInterceptors"),m2=i(t=>{if(t.type!=="firstQuoteReceived"&&t.type!=="quoteProcessed")return;let e=t.quote;if(Ht(e))return e.gaslessSwapFeeResult},"getGaslessSwapFeeResult");var Dk=i(t=>{let e=(0,id.useMemo)(()=>Rk(t.quoteProcessorState),[t.quoteProcessorState]);return{executeSwapInterceptors:(0,id.useCallback)(()=>{for(let o of e){let n=o.intercept(t);if(n==="interrupt")return n}return"continue"},[e,t])}},"useExecuteSwapInterceptors");u();l();var ad=D(O());var Bk=i((t,e)=>{let{sellFungible:r,buyFungible:o}=f2(t),n=g2(e),s=kk(r),c=Ik({sellFungible:r,buyFungible:o}),p=(0,ad.useMemo)(()=>h2(e),[e]),d=(0,ad.useMemo)(()=>{if(r&&Lt(r.type)&&I.isBitcoinNetworkID(r.data.chain.id))return r.data.key;let f=r?.data.chain.id;return f?Yy(f,void 0):void 0},[r]),{fungible:m}=Tc({key:d,enableSorting:!1,enablePrices:!1});return(0,ad.useMemo)(()=>{if(!r||!m||!o||!n)return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:void 0};if(De(r)||De(o))return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:Sf(e)};let f=Fk({sellFungible:r,totalFees:p,minRequiredBalance:{source:s,destination:c},currentQuote:n}),g=Sf(e);return{hasInsufficientFunds:new A(m?.data.amount??0).lt(f),insufficientFundsArgs:Pk({sellFungible:r,sellNativeFungible:m,totalNativeRequirement:f}),analyticsFields:g}},[r,o,n,p,s,c,m,e])},"useHasInsufficientFunds");function f2(t){return t.type!=="pair"?{sellFungible:void 0,buyFungible:void 0}:{sellFungible:t.sellToken,buyFungible:t.buyToken}}i(f2,"getTokens");function h2(t){return t.type!=="quoteProcessed"?new A(0):t.nextProcessedQuote.fees.fees.reduce((e,r)=>e.plus(r.amount),new A(0))}i(h2,"getTotalFees");function g2(t){if(t.type==="quoteProcessed")return t.quote}i(g2,"getQuote");var Nk=i(({performSwap:t,goToInsufficientFunds:e,tokenState:r,quoteProcessorState:o})=>{let{hasInsufficientFunds:n,insufficientFundsArgs:s,analyticsFields:c}=Bk(r,o),p=(0,ng.useCallback)(()=>s&&e(s,c),[e,s,c]),{executeSwapInterceptors:d}=Dk({hasInsufficientFunds:n,showInsufficientFunds:p,quoteProcessorState:o});return{swap:(0,ng.useCallback)(()=>{d()==="continue"&&t()},[d,t])}},"useExecuteSwapAction");var sg=class{static{i(this,"ClassicExecuteSwapStateListener")}resetSwapper;constructor(e){this.resetSwapper=e}onStateChange(e,r,o,n){e.type===Z.ExecuteSwapStarted&&this.resetSwapper()}},ig=class{static{i(this,"UpdateBalancesExecuteSwapStateListener")}swapper;constructor(e){this.swapper=e}onStateChange(e,r,o,n){let{sell:s,quote:c}=o.executingQuote;if(e.type===Z.TransactionConfirmed){let p=s.data.balance?new A(s.data.balance):void 0;if(!p)return;let d=new A(c.sellAmount).shiftedBy(-s.data.decimals),m=p.minus(d);this.swapper.updateBalances({sellTokenBalance:m,sellTokenCaip19:N(J(s))})}}},y2=i(({swapMode:t,quotedAmounts:e,tokenState:r,inputErrors:o,quoteProcessorState:n,currentPerspective:s,sellPercentages:c,showFungibleDetails:p,showBuyFungibleScreen:d,retryAndNavigateToSwapper:m,resetSwapper:f,goToInsufficientFunds:g,preprocessor:y})=>{let w=nt(),S=VE(),b=(0,Lk.useCallback)(()=>{S({showFungibleDetails:p,showBuyFungibleScreen:d,showRetrySwap:m,swapMode:t,executeSwapStateListeners:[new sg(f),new ig(w)],quotedAmounts:e,uiContext:"swapperClassic",preprocessor:y})},[S,p,d,m,t,f,e,w,y]),{swap:T}=Nk({performSwap:b,goToInsufficientFunds:g,tokenState:r,quoteProcessorState:n});return{buttonState:w2(r,o,e,n,s,c),swap:T}},"useClassicSwapperButton"),w2=i((t,e,r,o,n,s)=>t.type!=="pair"?{type:"untradable",label:""}:od(r,s,n,e)?{type:"insufficientBalance",label:v.t("swapReviewInsufficientBalance")}:o.type==="error"?{type:"untradable",label:v.t("swapNoQuotesFound")}:o.type!=="quoteProcessed"?{type:"loading",label:v.t("swapReviewFlowActionButtonPrimary")}:r?{type:"tradable",label:v.t("swapReviewFlowActionButtonPrimary")}:{type:"untradable",label:v.t("swapReviewFlowActionButtonPrimary")},"parseTradeButtonState");u();l();var ag=(ne=>(ne.Ping="ping",ne.HasOnboarded="hasOnboarded",ne.ResetHasOnboarded="resetHasOnboarded",ne.LockExtension="lockExtension",ne.UnlockExtension="unlockExtension",ne.IsExtensionUnlocked="IsExtensionUnlocked",ne.SetPassword="setPassword",ne.VerifyPassword="verifyPassword",ne.UpdatePassword="updatePassword",ne.ImportPrivateKeyAccount="importPrivateKeyAccount",ne.ImportReadOnlyAccount="importReadOnlyAccount",ne.ImportSeedAccount="importSeedAccount",ne.ImportSeedlessAccount="importSocialSeedAccount",ne.IsExistingSeed="isExistingSeed",ne.AddAccountForSeed="addAccountForSeed",ne.AddAccountForSeedless="addAccountForSeedless",ne.AddLedgerAccounts="addLedgerAccounts",ne.DeriveAddresses="deriveAddresses",ne.ExportPrivateKey="exportPrivateKey",ne.ExportEntropy="exportEntropy",ne.SetAccountIcon="setAccountIcon",ne.RemoveAccount="removeAccount",ne.ReorderAccount="reorderAccount",ne.GetAllAccounts="getAllAccounts",ne.GetAllSeeds="getAllSeeds",ne.GetAllSeedless="getAllSeedlessSeeds",ne.GetAuthenticationPublicKey="getAuthenticationPublicKey",ne.Sign="sign",ne.CheckVaultIntegrity="checkVaultIntegrity",ne.DO_NOT_USE_DiagnoseSeedCacheDigests="doNotUseDiagnoseSeedCacheDigests",ne.GetPhantomOrganization="getPhantomOrganization",ne.GetOrCreatePhantomOrganization="getOrCreatePhantomOrganization",ne.RetrieveKMSWallet="RetrieveKMSWallet",ne.GetKMSWalletStatus="GetKMSWalletStatus",ne.AddUserToCurrentUserOrganization="addUserToCurrentUserOrganization",ne.DeleteUserFromOrganization="deleteUserFromOrganization",ne.UpdateUserInOrganization="updateUserInOrganization",ne.GetAccounts="getAccounts",ne.BatchRpcCall="batchRpcCall",ne.GetKmsAccounts="getKmsAccounts",ne.GetWalletWithTag="getWalletWithTag",ne.LogMessage="logMessage",ne.DownloadLogs="downloadLogs",ne.ProviderInjectionOptions="providerInjectionOptions",ne.ServiceWorkerMutexAcquire="serviceWorkerMutexAcquire",ne.ServiceWorkerMutexRelease="serviceWorkerMutexRelease",ne))(ag||{});u();l();var Ka=D(yg(),1),it=D(kg(),1);u();l();function ke(t,e,r=Oe()){return{jsonrpc:"2.0",id:r,method:t,params:e}}i(ke,"createRpcRequest");u();l();var vr=D(kg(),1);var b2=i(async()=>{let t=ke("getPhantomOrganization",[]),e=await lt(vr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"getPhantomOrganization"),T2=i(async()=>{let t=ke("getOrCreatePhantomOrganization",[]),e=await lt(vr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"getOrCreatePhantomOrganization"),A2=i(async()=>{let t=ke("RetrieveKMSWallet",[]),e=await lt(vr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"retrieveKMSWallet"),BKe=i(async()=>{let t=ke("GetKMSWalletStatus",[]),e=await lt(vr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"getKMSWalletStatus"),NKe=i(async(t,e,r,o,n)=>{let s=ke("addUserToCurrentUserOrganization",[t,e,r,o,n]),c=await lt(vr.default.runtime,s);if("error"in c)throw new Error(c.error.message);return c.result},"addUserToCurrentUserOrganization"),x2=i(async(t,e)=>{let r=ke("deleteUserFromOrganization",[t,e]),o=await lt(vr.default.runtime,r);if("error"in o)throw new Error(o.error.message);return o.result},"deleteUserFromOrganization"),Mk=i(()=>({getPhantomOrganization:i(async()=>await b2(),"getPhantomOrganization"),getOrCreatePhantomOrganization:i(async()=>await T2(),"getOrCreatePhantomOrganization"),retrieveKMSWallet:i(async()=>await A2(),"retrieveKMSWallet"),deleteUserFromOrganization:i(async({organizationId:t,username:e})=>await x2(t,e),"deleteUserFromOrganization"),getKmsAccounts:i(async()=>{let t=ke("getKmsAccounts",[]),e=await lt(vr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"getKmsAccounts"),getWalletWithTag:i(async({organizationId:t,tag:e})=>{let r=ke("getWalletWithTag",[t,e]),o=await lt(vr.default.runtime,r);if("error"in o)throw new Error(o.error.message);return o.result},"getWalletWithTag"),updateUserInOrganization:i(async({organizationId:t,username:e,newPolicy:r,addTraits:o,removeTraits:n})=>{let s=ke("updateUserInOrganization",[t,e,n,o,r]),c=await lt(vr.default.runtime,s);if("error"in c)throw new Error(c.error.message);return c.result},"updateUserInOrganization"),getAccounts:i(async({organizationId:t,walletId:e,accounts:r})=>{let o=ke("getAccounts",[t,e,r]),n=await lt(vr.default.runtime,o);if("error"in n)throw new Error(n.error.message);return n.result},"getAccounts")}),"createKMSProxy");var Ok=D(Ke(),1),E2=Mk(),C2=i(async(t,e,r)=>{let o=e.fold(c=>Buffer.from(c.buffer).toString("base64")),n=ke("importPrivateKeyAccount",[t,o,r]),s=await k.startSpan("importPrivateKeyAccount",()=>lt(it.default.runtime,n));if("error"in s)throw new Error(s.error.message);if(typeof s.result=="string")return JSON.parse(s.result);throw new Error("importPrivateKeyAccount: Invalid response from background script")},"importPrivateKeyAccount"),VKe=i(async(t,e,r)=>{let o=t.getEntropy(),n=ke("importSeedAccount",[Ka.default.encode(o),e,r]);o.fill(0);let s=await k.startSpan("importSeedAccount",()=>lt(it.default.runtime,n));if("error"in s)throw new Error(s.error.message);if(typeof s.result=="string")return JSON.parse(s.result);throw new Error("importS*edAccount: Invalid response from background script")},"importSeedAccount"),WKe=i(async(t,e,r)=>{let o=t.getEntropy(),n=ke("importSocialSeedAccount",[Ka.default.encode(o),e,r]);o.fill(0);let s=await k.startSpan("importSeedlessAccount",()=>lt(it.default.runtime,n));if("error"in s)throw new Error(s.error.message);if(typeof s.result=="string")return JSON.parse(s.result);throw new Error("importS*edlessAccount: Invalid response from background script")},"importSeedlessAccount"),ZKe=i(async t=>{let e=t.getEntropy(),r=ke("isExistingSeed",Ka.default.encode(e));e.fill(0);let o=await k.startSpan("isExistingSeed",()=>lt(it.default.runtime,r));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="boolean"||o.result===null)return o.result;throw new Error("isExistingS*ed: Invalid response from background script")},"isExistingSeed"),I2=i(async t=>{let e=ke("addAccountForSeed",[t]),r=await k.startSpan("addAccountForSeed",async()=>Nt(await it.default.runtime.sendMessage(Ut(e))));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return JSON.parse(r.result);throw new Error("addAccountForS*ed: Invalid response from background script")},"addAccountForSeed"),k2=i(async t=>{let e=ke("addAccountForSeedless",[t]),r=await k.startSpan("addAccountForSeedless",async()=>Nt(await it.default.runtime.sendMessage(Ut(e))));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return JSON.parse(r.result);throw new Error("addAccountForS*ed: Invalid response from background script")},"addAccountForSeedless"),F2=i(async(t,e)=>{let r=ke("addLedgerAccounts",[t,e]),o=await k.startSpan("connectLedgerAccounts",async()=>Nt(await it.default.runtime.sendMessage(Ut(r))));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return JSON.parse(o.result);throw new Error("connectLedgerAccounts: Invalid response from background script")},"connectLedgerAccounts"),P2=i(async t=>{let e=ke("importReadOnlyAccount",t),r=await k.startSpan("addReadonlyAccount",async()=>Nt(await it.default.runtime.sendMessage(Ut(e))));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return JSON.parse(r.result);throw new Error("addReadonlyAccount: Invalid response from background script")},"addReadonlyAccount"),YKe=i(async(t,e,r)=>{let o=ke("exportPrivateKey",[t,e,r]),n=await k.startSpan("exportPrivateKey",async()=>Nt(await it.default.runtime.sendMessage(Ut(o))));if("error"in n)throw new Error(n.error.message);if(typeof n.result=="string")return cd.from(Buffer.from(n.result,"hex"));throw new Error("exportPrivateKey: Invalid response from background script")},"exportPrivateKey"),XKe=i(async(t,e)=>{let r=ke("exportEntropy",[t,e]),o=await k.startSpan("exportEntropy",async()=>Nt(await it.default.runtime.sendMessage(Ut(r))));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return cd.from(Buffer.from(o.result,"hex"));throw new Error("exportEntropy: Invalid response from background script")},"exportEntropy"),_2=i(async()=>{let t=ke("deriveAddresses",void 0),e=await lt(it.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"deriveAddresses"),v2=i(async t=>{let e=ke("removeAccount",t),r=await lt(it.default.runtime,e);if("error"in r)throw new Error(r.error.message);return r.result},"removeAccount"),R2=i(async(t,e)=>{let r=ke("reorderAccount",{identifier:t,toIndex:e}),o=await lt(it.default.runtime,r);if("error"in o)throw new Error(o.error.message);return o.result},"reorderAccount"),D2=i(async()=>{let t=ke("getAllAccounts",void 0),e=Nt(await it.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);if(typeof e.result=="string"){let r=JSON.parse(e.result);return Kg({accounts:r}).accounts}throw new Error("fetchAllAccounts: Invalid response from background script")},"fetchAllAccounts"),B2=i(async()=>{let t=ke("getAllSeeds",void 0),e=Nt(await it.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);if(typeof e.result=="string")return JSON.parse(e.result);throw new Error("fetchAllSe*dMetas: Invalid response from background script")},"fetchAllSeedMetas"),N2=i(async()=>{let t=ke("getAllSeedlessSeeds",void 0),e=Nt(await it.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);if(typeof e.result=="string")return JSON.parse(e.result);throw new Error("fetchAllSe*dlessMetas: Invalid response from background script")},"fetchAllSeedlessMetas"),L2=i(async t=>{let e=ke("getAuthenticationPublicKey",{secretIdentifier:t}),r=Nt(await it.default.runtime.sendMessage(Ut(e)));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return JSON.parse(r.result);throw new Error("getAuthenticationPublicK*y: Invalid response from background script")},"getAuthenticationPublicKey"),M2=i(async()=>{let t=ke("checkVaultIntegrity",void 0),e=Nt(await it.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);return e.result},"checkVaultIntegrity"),U2=i(async()=>{let t=ke("doNotUseDiagnoseSeedCacheDigests",void 0),e=Nt(await it.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);return typeof e.result=="string"?JSON.parse(e.result):null},"diagnoseSeedCacheDigestsRpc"),O2=i(async(t,e)=>{let r=sy.parse(e);"chainType"in r&&r.chainType===se.Solana&&r.signingType==="transaction"&&typeof r.message!="string"&&(r.message=Ka.default.encode(r.message));let o=ke("sign",{accountIdentifier:t,params:r}),n=Nt(await it.default.runtime.sendMessage(Ut(o)));if("error"in n)throw new Error(n.error.message);if(typeof n.result=="string")return Nt(n.result);throw new Error("sign: Invalid response from background script")},"sign"),Uk={addAccountForSeed:I2,addReadonlyAccount:P2,importPrivateKeyAccount:C2,connectLedgerAccounts:F2,fetchAllAccounts:D2,fetchAllSeedMetas:B2,fetchAllSeedlessMetas:N2,connectSolanaSeedVaultAccounts:i(()=>{throw new Error("Solana Seed Vault is not supported on browser extension.")},"connectSolanaSeedVaultAccounts"),deriveAddresses:_2,removeAccount:i(async t=>{if(!await v2(t))throw new Error("Error while removing account")},"removeAccount"),reorderAccount:i(async(t,e)=>{if(!await R2(t,e))throw new Error("Error while reordering account")},"reorderAccount"),sign:O2,getAuthenticationPublicKey:L2,addAccountForSeedless:k2,checkVaultIntegrity:M2,getAgentAddress:i(async()=>{throw new Error("getAgentAddress: Not implemented on browser extension")},"getAgentAddress"),getCashKMSAccount:i(async()=>{throw new Error("getCashKMSAccount: Not implemented on browser extension")},"getCashKMSAccount"),updateCashAccountMapping:i(async()=>{throw new Error("updateCashAccountMapping: Not implemented on browser extension")},"updateCashAccountMapping"),getKMSInstance:i(()=>E2,"getKMSInstance"),addKMSVaultAccount:i(()=>{throw new Error("addKMSVaultAccount: Only callable from background script, not UI")},"addKMSVaultAccount"),canDeriveKMSAuthenticator:i(()=>{throw new Error("canDeriveKMSAuthenticator: Not implemented on browser extension")},"canDeriveKMSAuthenticator"),DO_NOT_USE_diagnoseSeedCacheDigests:i(async()=>{let t=await U2();if(!t)throw new Error("DO_NOT_USE_diagnoseSeedCacheDigests: Vault locked");return t},"DO_NOT_USE_diagnoseSeedCacheDigests")},JKe=i(()=>Uk,"getVaultProxy");function e4e({children:t}){return(0,Ok.jsx)(jg,{vault:Uk,children:t})}i(e4e,"VaultProxyProvider");export{hF as a,cF as b,Or as c,Uo as d,uF as e,Ec as f,Pd as g,un as h,vd as i,gF as j,yF as k,Rd as l,Bi as m,_t as n,sm as o,im as p,ln as q,Xd as r,AF as s,xF as t,EF as u,uS as v,BF as w,kF as x,bS as y,jOe as z,Pr as A,qMe as B,za as C,rO as D,vh as E,AU as F,Ln as G,eC as H,Xl as I,nC as J,Yo as K,ut as L,ur as M,$ as N,cm as O,um as P,eP as Q,le as R,fe as S,jt as T,Ls as U,H0 as V,Ce as W,Z as X,Ms as Y,j0 as Z,ff as _,ht as $,m1 as aa,nt as ba,b1 as ca,A1 as da,f1 as ea,Bs as fa,qre as ga,Ns as ha,Kre as ia,cl as ja,Qoe as ka,h1 as la,L1 as ma,xf as na,AB as oa,hr as pa,PB as qa,_B as ra,DB as sa,TN as ta,KB as ua,VB as va,Hf as wa,LB as xa,In as ya,Of as za,XB as Aa,eN as Ba,nN as Ca,yge as Da,wge as Ea,Sge as Fa,aN as Ga,Ige as Ha,kge as Ia,cN as Ja,Bge as Ka,Nge as La,GB as Ma,lN as Na,qf as Oa,bN as Pa,jB as Qa,$B as Ra,AN as Sa,Ll as Ta,Nx as Ua,FN as Va,rh as Wa,oL as Xa,nL as Ya,DL as Za,WE as _a,UL as $a,NL as ab,OL as bb,MLe as cb,zp as db,oMe as eb,HM as fb,gMe as gb,EMe as hb,Fh as ib,Ph as jb,_h as kb,PU as lb,_U as mb,Nh as nb,JU as ob,iO as pb,pO as qb,fO as rb,hO as sb,Uh as tb,Oh as ub,qh as vb,Vt as wb,zh as xb,Vp as yb,xk as zb,mk as Ab,wk as Bb,Ak as Cb,qO as Db,QO as Eb,WO as Fb,ZO as Gb,YO as Hb,GO as Ib,JO as Jb,e2 as Kb,t2 as Lb,y2 as Mb,ag as Nb,ke as Ob,A2 as Pb,BKe as Qb,NKe as Rb,Mk as Sb,VKe as Tb,WKe as Ub,ZKe as Vb,YKe as Wb,XKe as Xb,N2 as Yb,JKe as Zb,e4e as _b};
/*! Bundled license information:

use-sync-external-store/cjs/use-sync-external-store-shim.production.js:
  (**
   * @license React
   * use-sync-external-store-shim.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim.development.js:
  (**
   * @license React
   * use-sync-external-store-shim.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.development.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=chunk-KETOQW6E.js.map
