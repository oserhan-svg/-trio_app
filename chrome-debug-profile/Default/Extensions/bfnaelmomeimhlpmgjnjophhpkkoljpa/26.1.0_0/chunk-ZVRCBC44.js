import{a as F}from"./chunk-VQBOTZZ6.js";import{d as H,k as Ne}from"./chunk-XOFIVAID.js";import{A as be,Na as Oe,Ob as V,Zb as Me,o as we,xb as ve}from"./chunk-KETOQW6E.js";import{a as x,b as J}from"./chunk-WVRYN4MY.js";import{R as ke,a as fe,j as w}from"./chunk-MGLLPATV.js";import{A as Ie,eb as _e,h as Ee,i as Ce,m as Te}from"./chunk-Z3O2IHPJ.js";import{a as _,b as N}from"./chunk-SFIUS6XB.js";import{s as Se}from"./chunk-UA65TROS.js";import{a as k}from"./chunk-YJCG6GWC.js";import{Fb as he,G as ce,Lb as c,P as U,Rc as ye,Wa as le,bb as de,cb as pe,db as ue,hb as ge}from"./chunk-FO7QPK6E.js";import{_a as Re,b as Ae}from"./chunk-KUSQMIXV.js";import{$c as re,Oc as Z,Pc as ee,Qc as P,Tc as f,Xd as q,_c as te,cd as se,ee as ie,ge as I,kd as oe,rd as ae,re as me,wd as ne,x as X}from"./chunk-JPCZ2XYS.js";import{D as T,a as Xe,b as z,o as v}from"./chunk-TVPT7M2T.js";import{a as r,g as y,i as a,j as l,n}from"./chunk-WKJYWAXG.js";a();n();a();n();var R={Accounts:`${U}.accounts`,SecretIdentifiers:`${U}.secrets`},Ke=[{legacyKeys:[c.AccountsMetadata],targetSchema:"accounts",targetKey:c.AccountsMetadata,migrate:r(e=>e[c.AccountsMetadata],"migrate")}],De=[{legacyKeys:[c.DeveloperMode],targetSchema:"accounts",targetKey:c.DeveloperMode,migrate:r(e=>e[c.DeveloperMode],"migrate")},{legacyKeys:[c.NetworkSetting],targetSchema:"accounts",targetKey:c.NetworkSetting,migrate:r(e=>e[c.NetworkSetting],"migrate")},{legacyKeys:[c.SelectedAccount],targetSchema:"accounts",targetKey:c.SelectedAccount,migrate:r(e=>e[c.SelectedAccount],"migrate")},{legacyKeys:[c.AccountsBalanceMetadata],targetSchema:"accounts",targetKey:c.AccountsBalanceMetadata,migrate:r(e=>e[c.AccountsBalanceMetadata],"migrate")},{legacyKeys:[c.MigratedWithInvalidChecksum],targetSchema:"accounts",targetKey:c.MigratedWithInvalidChecksum,migrate:r(e=>e[c.MigratedWithInvalidChecksum],"migrate")},{legacyKeys:[c.TermsHaveBeenAcknowledgedLastSeenVersion],targetSchema:"accounts",targetKey:c.TermsHaveBeenAcknowledgedLastSeenVersion,migrate:r(e=>e[c.TermsHaveBeenAcknowledgedLastSeenVersion],"migrate")},{legacyKeys:[c.NotificationsHaveBeenAcknowledgedLastSeenVersion],targetSchema:"accounts",targetKey:c.NotificationsHaveBeenAcknowledgedLastSeenVersion,migrate:r(e=>e[c.NotificationsHaveBeenAcknowledgedLastSeenVersion],"migrate")}],Le=[{legacyKeys:[R.Accounts],targetSchema:"vault",targetKey:R.Accounts,migrate:r(e=>e[R.Accounts],"migrate")},{legacyKeys:[R.SecretIdentifiers],targetSchema:"vault",targetKey:R.SecretIdentifiers,migrate:r(e=>e[R.SecretIdentifiers],"migrate")}];a();n();a();n();var u;(function(e){e.DismissedActionBanners="dismissedActionBanners",e.AppLaunchTimes="appLaunchTimes",e.LastOnboardedAt="lastOnboardedAt",e.DismissedContentCards=".phantom.interstitials.contentCards.dismissed"})(u||(u={}));var xe=[{legacyKeys:[u.DismissedActionBanners],targetSchema:"interstitials",targetKey:w.DismissedActionBanners,migrate:r(e=>e[u.DismissedActionBanners],"migrate")},{legacyKeys:[u.AppLaunchTimes],targetSchema:"interstitials",targetKey:w.AppLaunchTimes,migrate:r(e=>e[u.AppLaunchTimes],"migrate")},{legacyKeys:[u.LastOnboardedAt],targetSchema:"interstitials",targetKey:w.LastOnboardedAt,migrate:r(e=>e[u.LastOnboardedAt],"migrate")},{legacyKeys:[u.DismissedContentCards],targetSchema:"interstitials",targetKey:w.DismissedContentCards,migrate:r(e=>e[u.DismissedContentCards],"migrate")}];a();n();var h=y(k());a();n();var Ze=r(e=>typeof e=="object"&&e!==null&&"localVersion"in e&&"remoteVersion"in e&&"remoteState"in e&&"eventVersions"in e,"isNamespaceState"),B=r(e=>Ze(e)?e:{localVersion:0,remoteVersion:0,remoteState:null,eventVersions:{change:0,idle:0}},"parseNamespaceState");var G=r(e=>typeof e=="object"&&e!==null?e:{},"parseNamespaceItems");var Q="mmkv:state:",W="mmkv:items:",M=r(e=>`${Q}${e}`,"namespaceStateKey"),b=r(e=>`${W}${e}`,"namespaceItemsKey"),et=r(e=>e.startsWith(Q),"isNamespaceStateKey"),tt=r(e=>e.startsWith(W),"isNamespaceItemsKey"),K=class{static{r(this,"ExtensionBackingStore")}stateCache={};itemsCache={};callbacks={};async init(t){let s=await h.default.storage.local.get([...t.map(o=>M(o.key)),...t.map(o=>b(o.key))]);for(let o of t){let i=o.key,m=M(i),p=b(i);this.stateCache[i]=B(s[m]),this.itemsCache[i]=G(s[p])}h.default.storage.local.onChanged.addListener(o=>{let i=[];for(let[m,p]of Object.entries(o))if(et(m)){let d=m.slice(Q.length);this.stateCache[d]=B(p.newValue),i.push(d)}else if(tt(m)){let d=m.slice(W.length);this.itemsCache[d]=G(p.newValue)}for(let m of i)this.callbacks[m]?.forEach(d=>d(this.stateCache[m]))})}onNamespaceChange(t,s){let o=s,i=this.callbacks[t]??(this.callbacks[t]=[]);return i.push(o),()=>{i.splice(i.indexOf(o),1)}}getNamespace(t){return this.stateCache[t]??null}async setNamespace(t,s){this.stateCache[t]=s,await h.default.storage.local.set({[M(t)]:s})}getItem(t,s,o){let i=`${s}:${o}`;return(this.itemsCache[t]??{})[i]??null}async setItem(t,s,o,i){let m=`${s}:${o}`,p=this.itemsCache[t];p[m]=i,await h.default.storage.local.set({[b(t)]:p})}async deleteItem(t,s,o){let i=`${s}:${o}`,m=this.itemsCache[t];delete m[i],await h.default.storage.local.set({[b(t)]:m})}async clear(){await Promise.all([...Object.keys(this.stateCache).map(t=>h.default.storage.local.remove(M(t))),...Object.keys(this.itemsCache).map(t=>h.default.storage.local.remove(b(t)))]),this.stateCache={},this.itemsCache={},this.callbacks={}}};a();n();var rt={enabled:!0,clientToken:l.DATADOG_CLIENT_TOKEN,applicationId:"3f3bc3b0-8d80-4b31-b4b9-9909de4d243a",service:"browser-ext-frontend",traceSampleRate:1,sessionSampleRate:1},st={enabled:!0,dsn:"https://pub5df2cf131c51c4215f2ca3aa32d4e4b7@sentry-intake.datadoghq.com/1",sampleRate:.1,tracesSampleRate:0,initialScope:{tags:{service:"browser-ext-background",version:T}}};async function Y(e,t){await f.init({appVersion:T,sentry:e==="frontend"?{enabled:!1}:st,datadog:e==="frontend"?rt:{enabled:!1}}),t&&await f.setUser({id:t})}r(Y,"initTelemetry");a();n();var $=class{static{r(this,"NetworkLogger")}requests=[];maxRequests=0;allowedDomains=["phantom.app","phantom.com"];ignoredHosts=new Set;ignoredUrls=new Set;ignoredPatterns;init(t={maxRequests:20,ignoredUrls:[],ignoredHosts:[]}){this.maxRequests=t.maxRequests,this.ignoredUrls=new Set(t.ignoredUrls),this.ignoredHosts=new Set(t.ignoredHosts);let s=self.fetch;self.fetch=async(...o)=>{let[i,m]=o,p=m?.method||"GET",d={};if(m?.headers instanceof Headers?m.headers.forEach((E,C)=>{d[C]=E}):Array.isArray(m?.headers)?m.headers.forEach(([E,C])=>{d[E]=C}):d=m?.headers||{},this.shouldIgnoreRequest(i.toString()))return s(...o);let A={id:`${Date.now()}-${Math.random()}`,method:p,url:i.toString(),requestHeaders:d,startTime:Date.now()};this.requests.length>=this.maxRequests&&this.requests.pop(),this.requests.unshift(A);let O=await s(...o),Je=await O.clone().text();return A.status=O.status,A.responseHeaders={},O.headers.forEach((E,C)=>{A.responseHeaders[C]=E}),A.endTime=Date.now(),A.response=Je,O}}shouldIgnoreRequest(t){try{let s=new URL(t).hostname;return this.ignoredHosts&&this.ignoredHosts.has(s)||this.ignoredUrls&&this.ignoredUrls.has(t)||!this.allowedDomains.some(o=>s.includes(o))?!0:!!(this.ignoredPatterns&&this.ignoredPatterns.some(o=>o.test(t)))}catch{return!0}}getRequests(){return this.requests}clearRequests(){this.requests=[]}setIgnoredHosts(t){this.ignoredHosts=new Set(t)}setIgnoredUrls(t){this.ignoredUrls=new Set(t)}setIgnoredPatterns(t){this.ignoredPatterns=t}clearIgnoredHosts(){this.ignoredHosts=new Set}clearIgnoredUrls(){this.ignoredUrls=new Set}clearIgnoredPatterns(){this.ignoredPatterns=void 0}},ot=new $,Pe=ot;var S,dr=r(e=>{S?.sendEvent(e)},"sendMMKVUpdateEvent"),qe=r(()=>S?.getNamespace(q),"getFlagNamespace"),Ue=me(e=>{qe()?.updateRemoteState(t=>({overrides:t?.overrides??{},eppoConfig:t?.eppoConfig??{},userId:e})),qe()?.invalidate()}),at=r(async(e,t,s)=>{if(S)return;let o={apiKey:ie,deviceId:t,subjectAttributes:{appVersion:T,platform:"browser-ext",deviceId:t},pollingEnabled:e==="background",analytics:N,logTelemetry:r(i=>{f.addBreadcrumb(P.FeatureFlags,i,ee.Info,{skipFileLogger:!0})},"logTelemetry"),telemetry:f};S=await Z({backingStore:new K,namespaces:[q.withDeps(o),re.withDeps({legacyStorage:F,migrations:[...xe,...De,...Le,...Re]}),se.withDeps({authRepository:s,legacyStorage:F,migrations:[...H,...Ke]})],initDeadline:e==="frontend"?0:5e3}),e==="background"&&S.sendEvent("idle")},"initializeMMKV"),pr=r(async()=>{S&&await S.reset()},"resetMMKV"),ur=r(async(e,t)=>{try{let s=await N.getDeviceId();await Y(e,s),await at(e,s,t),await nt(),X(s)}catch(s){await Y(e),f.captureError(s,P.StartUp)}},"telemetryInitializeFeatureFlags"),nt=r(()=>{let e=I.getMultivariateAssignment("network-logger-config-json");if(e)try{let t=JSON.parse(e),s=te.parse(t);Pe.init({ignoredHosts:s.ignoredHosts,maxRequests:s.maxRequests,ignoredUrls:s.ignoredUrls})}catch(t){console.error("Error initializing network logger",t)}},"initializeNetworkLogging");a();n();a();n();var He=y(Xe(),1);var Fe=new WeakMap;function Ve(e,t){let s=Ee(t),o=it(s);for(let[i,m]of e)(!o.has(i)||t?.dangerouslyForceHydrate)&&(o.add(i),s.set(i,m))}r(Ve,"useHydrateAtoms");var it=r(e=>{let t=Fe.get(e);return t||(t=new WeakSet,Fe.set(e,t)),t},"getHydratedSet");a();n();var g=r(()=>!0,"defaultShouldDehydrateQueryPredicate"),Be={auth:g,tokens:g,prices:Ie,collectibles:Ne,currency:Se,staking:ke,swapper:Oe,transferFungibleLoggingContext:g,user:ye,[Ae]:g,[fe]:g,[ve]:g,[_e]:g,[we]:g,[be]:g,"test-debug-query":v},Ge=r(e=>{if(e.queryKey.length===0)return!1;let t=String(e.queryKey[0]);return e.state.status!=="success"?!1:Be[t]?Be[t](e):!1},"shouldDehydrateQuery");var D=y(z(),1),L=new ae({defaultOptions:{mutations:{retry:!1,networkMode:"offlineFirst"},queries:{retry:!1,staleTime:1/0,gcTime:1/0,refetchOnWindowFocus:!1,networkMode:"offlineFirst"}}}),ct=oe({underlyingStorage:new _,throttleMs:1e3,enableDebugLogs:v()}),mt=r(({children:e})=>(Ve([[Te,L]]),e),"HydrateAtoms"),jr=r(e=>(0,D.jsx)(ne,{client:L,persistOptions:{persister:ct,dehydrateOptions:{shouldDehydrateQuery:Ge},buster:lt,maxAge:1/0},children:(0,D.jsx)(Ce,{children:(0,D.jsx)(mt,{children:e.children})})}),"QueryProvider"),lt="25.2.0";a();n();a();n();var Ye=y(k());a();n();var Qe=y(k());var We=r(async(e,t,s)=>{let o=await Qe.default.identity.launchWebAuthFlow({interactive:s,url:t});if(!ue(e,o))return pe(e,o);throw new Error("Error fetching auth code")},"fetchExtensionAuthCode");var $e={getClientID:ge,redirectURL:Ye.default.identity.getRedirectURL(),fetchAuthorizationCode:r((e,t,s)=>We(e,t,s),"fetchAuthorizationCode")};a();n();var j=y(k(),1);var dt=r(async()=>{let e=V("serviceWorkerMutexAcquire",void 0),t=J(await j.default.runtime.sendMessage(x(e)));if("error"in t)throw new Error(t.error.message);return()=>{let s=V("serviceWorkerMutexRelease",void 0);j.default.runtime.sendMessage(x(s))}},"acquire"),je=r(async e=>{let t=await dt();try{return await e()}finally{t()}},"runExclusiveWithServiceWorker");var ze=Me(),pt={storage:new _,signer:{sign:r((e,t)=>ce(ze,e,t),"sign"),getAuthenticationPublicKey:r(e=>ze.getAuthenticationPublicKey(e),"getAuthenticationPublicKey"),getAllSecretIdentifiers:he},authConfig:$e,queryClient:L,runExclusive:je,isLocalTokenValidityCheckEnabled:r(()=>!I.isFeatureEnabled("kill-frontend-local-check"),"isLocalTokenValidityCheckEnabled"),isServerTimeEnabled:r(()=>!I.isFeatureEnabled("kill-frontend-server-time"),"isServerTimeEnabled")},ut=de(pt);ut.subscribe(le.UserID,e=>{N.addUserProperties({authUserId:e}),Ue(e)});export{Pe as a,dr as b,pr as c,ur as d,Ge as e,L as f,jr as g,$e as h,ut as i};
//# sourceMappingURL=chunk-ZVRCBC44.js.map
