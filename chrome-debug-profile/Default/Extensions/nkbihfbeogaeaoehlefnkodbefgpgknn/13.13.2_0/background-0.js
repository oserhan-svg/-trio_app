LavaPack.loadBundle([[10,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.COOKIE_ID_MARKETING_WHITELIST_ORIGINS=n.COOKIE_ID_MARKETING_WHITELIST=void 0;const r=n.COOKIE_ID_MARKETING_WHITELIST=["https://metamask.io","https://learn.metamask.io","https://mmi-support.zendesk.com","https://community.metamask.io","https://support.metamask.io"];n.COOKIE_ID_MARKETING_WHITELIST_ORIGINS=r.map(e=>new URL(e).origin)}}},{package:"$root$",file:"app/scripts/constants/marketing-site-whitelist.ts"}],[100,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getGasFeeControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"GasFeeControllerInit",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getEIP1559Compatibility","NetworkController:getNetworkClientById","NetworkController:getSelectedNetworkClient","NetworkController:getState"],events:["NetworkController:networkDidChange"]}),t},n.getGasFeeControllerMessenger=function(e){const t=new r.Messenger({namespace:"GasFeeController",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getEIP1559Compatibility","NetworkController:getNetworkClientById","NetworkController:getState"],events:["NetworkController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/gas-fee-controller-messenger.ts"}],[101,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getGatorPermissionsControllerMessenger=function(e){const t=new r.Messenger({namespace:"GatorPermissionsController",parent:e});return e.delegate({messenger:t,actions:["SnapController:handleRequest","SnapController:has"],events:["TransactionController:transactionApproved","TransactionController:transactionRejected","TransactionController:transactionConfirmed","TransactionController:transactionFailed","TransactionController:transactionDropped"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/gator-permissions/gator-permissions-controller-messenger.ts"}],[102,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAuthenticationControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"AuthenticationController",parent:e});return e.delegate({messenger:t,actions:["MetaMetricsController:getMetaMetricsId"]}),t},n.getAuthenticationControllerMessenger=function(e){const t=new r.Messenger({namespace:"AuthenticationController",parent:e});return e.delegate({messenger:t,actions:["KeyringController:getState","SnapController:handleRequest"],events:["KeyringController:lock","KeyringController:unlock"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/identity/authentication-controller-messenger.ts"}],[103,{"./authentication-controller-messenger":102,"./user-storage-controller-messenger":104},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getAuthenticationControllerInitMessenger",{enumerable:!0,get:function(){return r.getAuthenticationControllerInitMessenger}}),Object.defineProperty(n,"getAuthenticationControllerMessenger",{enumerable:!0,get:function(){return r.getAuthenticationControllerMessenger}}),Object.defineProperty(n,"getUserStorageControllerMessenger",{enumerable:!0,get:function(){return s.getUserStorageControllerMessenger}});var r=e("./authentication-controller-messenger"),s=e("./user-storage-controller-messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/identity/index.ts"}],[104,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getUserStorageControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"UserStorageControllerInit",parent:e});return e.delegate({messenger:t,actions:["MetaMetricsController:trackEvent"]}),t},n.getUserStorageControllerMessenger=function(e){const t=new r.Messenger({namespace:"UserStorageController",parent:e});return e.delegate({messenger:t,actions:["KeyringController:getState","SnapController:handleRequest","AuthenticationController:getBearerToken","AuthenticationController:getSessionProfile","AuthenticationController:isSignedIn","AuthenticationController:performSignIn","AddressBookController:list","AddressBookController:set","AddressBookController:delete"],events:["KeyringController:lock","KeyringController:unlock","AddressBookController:contactUpdated","AddressBookController:contactDeleted"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/identity/user-storage-controller-messenger.ts"}],[105,{"./account-order-controller-messenger":62,"./account-tracker-controller-messenger":63,"./accounts":66,"./accounts-controller-messenger":64,"./accounts/institutional-snap-controller-messenger":67,"./address-book-controller-messenger":70,"./alert-controller-messenger":71,"./announcement-controller-messenger":72,"./app-metadata-controller-messenger":73,"./app-state-controller-messenger":74,"./approval-controller-messenger":75,"./assets":77,"./bridge-controller-messenger":83,"./bridge-status-controller-messenger":84,"./claims/claims-controller-messenger":85,"./claims/claims-service-messenger":86,"./core-backend":89,"./currency-rate-controller-messenger":90,"./decrypt-message-controller-messenger":91,"./decrypt-message-manager-messenger":92,"./defi-positions":94,"./defi-positions/defi-positions-controller-messenger":93,"./delegation/delegation-controller-messenger":95,"./encryption-public-key-controller-messenger":96,"./encryption-public-key-manager-messenger":97,"./ens-controller-messenger":98,"./error-reporting-service-messenger":99,"./gas-fee-controller-messenger":100,"./gator-permissions/gator-permissions-controller-messenger":101,"./identity":103,"./identity/user-storage-controller-messenger":104,"./keyring-controller-messenger":106,"./logging-controller-messenger":107,"./metametrics-controller-messenger":108,"./metametrics-data-deletion-controller-messenger":109,"./multichain":110,"./name-controller-messenger":116,"./network-controller-messenger":117,"./notifications":118,"./onboarding-controller-messenger":121,"./permission-controller-messenger":122,"./permission-log-controller-messenger":123,"./phishing-controller-messenger":124,"./ppom-controller-messenger":125,"./preferences-controller-messenger":126,"./profile-metrics-controller-messenger":127,"./profile-metrics-service-messenger":128,"./rates-controller-messenger":129,"./remote-feature-flag-controller-messenger":130,"./reward-data-service-messenger":131,"./rewards-controller-messenger":132,"./seedless-onboarding":133,"./selected-network-controller-messenger":136,"./shield/shield-controller-messenger":137,"./signature-controller-messenger":138,"./smart-transactions-controller-messenger":139,"./snaps":142,"./subject-metadata-controller-messenger":151,"./subscription":152,"./subscription/subscription-service-messenger":154,"./swaps-controller-messenger":155,"./token-balances-controller-messenger":156,"./token-detection-controller-messenger":157,"./token-list-controller-messenger":158,"./tokens-controller-messenger":159,"./transaction-controller-messenger":160,"./transaction-pay-controller-messenger":161,"./user-operation-controller-messenger":162,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CONTROLLER_MESSENGERS=void 0,Object.defineProperty(n,"getAccountOrderControllerMessenger",{enumerable:!0,get:function(){return J.getAccountOrderControllerMessenger}}),Object.defineProperty(n,"getAccountTrackerControllerInitMessenger",{enumerable:!0,get:function(){return O.getAccountTrackerControllerInitMessenger}}),Object.defineProperty(n,"getAccountTrackerControllerMessenger",{enumerable:!0,get:function(){return O.getAccountTrackerControllerMessenger}}),Object.defineProperty(n,"getAccountsControllerMessenger",{enumerable:!0,get:function(){return X.getAccountsControllerMessenger}}),Object.defineProperty(n,"getAddressBookControllerMessenger",{enumerable:!0,get:function(){return ie.getAddressBookControllerMessenger}}),Object.defineProperty(n,"getAlertControllerMessenger",{enumerable:!0,get:function(){return ee.getAlertControllerMessenger}}),Object.defineProperty(n,"getAnnouncementControllerMessenger",{enumerable:!0,get:function(){return Q.getAnnouncementControllerMessenger}}),Object.defineProperty(n,"getAppMetadataControllerMessenger",{enumerable:!0,get:function(){return re.getAppMetadataControllerMessenger}}),Object.defineProperty(n,"getAppStateControllerMessenger",{enumerable:!0,get:function(){return H.getAppStateControllerMessenger}}),Object.defineProperty(n,"getApprovalControllerMessenger",{enumerable:!0,get:function(){return ae.getApprovalControllerMessenger}}),Object.defineProperty(n,"getBridgeControllerInitMessenger",{enumerable:!0,get:function(){return B.getBridgeControllerInitMessenger}}),Object.defineProperty(n,"getBridgeControllerMessenger",{enumerable:!0,get:function(){return B.getBridgeControllerMessenger}}),Object.defineProperty(n,"getBridgeStatusControllerMessenger",{enumerable:!0,get:function(){return U.getBridgeStatusControllerMessenger}}),Object.defineProperty(n,"getCurrencyRateControllerInitMessenger",{enumerable:!0,get:function(){return _.getCurrencyRateControllerInitMessenger}}),Object.defineProperty(n,"getCurrencyRateControllerMessenger",{enumerable:!0,get:function(){return _.getCurrencyRateControllerMessenger}}),Object.defineProperty(n,"getDecryptMessageControllerInitMessenger",{enumerable:!0,get:function(){return ce.getDecryptMessageControllerInitMessenger}}),Object.defineProperty(n,"getDecryptMessageControllerMessenger",{enumerable:!0,get:function(){return ce.getDecryptMessageControllerMessenger}}),Object.defineProperty(n,"getDecryptMessageManagerMessenger",{enumerable:!0,get:function(){return oe.getDecryptMessageManagerMessenger}}),Object.defineProperty(n,"getEncryptionPublicKeyControllerInitMessenger",{enumerable:!0,get:function(){return le.getEncryptionPublicKeyControllerInitMessenger}}),Object.defineProperty(n,"getEncryptionPublicKeyControllerMessenger",{enumerable:!0,get:function(){return le.getEncryptionPublicKeyControllerMessenger}}),Object.defineProperty(n,"getEncryptionPublicKeyManagerMessenger",{enumerable:!0,get:function(){return ue.getEncryptionPublicKeyManagerMessenger}}),Object.defineProperty(n,"getEnsControllerInitMessenger",{enumerable:!0,get:function(){return j.getEnsControllerInitMessenger}}),Object.defineProperty(n,"getEnsControllerMessenger",{enumerable:!0,get:function(){return j.getEnsControllerMessenger}}),Object.defineProperty(n,"getErrorReportingServiceMessenger",{enumerable:!0,get:function(){return se.getErrorReportingServiceMessenger}}),Object.defineProperty(n,"getGasFeeControllerInitMessenger",{enumerable:!0,get:function(){return x.getGasFeeControllerInitMessenger}}),Object.defineProperty(n,"getGasFeeControllerMessenger",{enumerable:!0,get:function(){return x.getGasFeeControllerMessenger}}),Object.defineProperty(n,"getKeyringControllerInitMessenger",{enumerable:!0,get:function(){return q.getKeyringControllerInitMessenger}}),Object.defineProperty(n,"getKeyringControllerMessenger",{enumerable:!0,get:function(){return q.getKeyringControllerMessenger}}),Object.defineProperty(n,"getLoggingControllerMessenger",{enumerable:!0,get:function(){return ne.getLoggingControllerMessenger}}),Object.defineProperty(n,"getMetaMetricsControllerMessenger",{enumerable:!0,get:function(){return v.getMetaMetricsControllerMessenger}}),Object.defineProperty(n,"getMetaMetricsDataDeletionControllerMessenger",{enumerable:!0,get:function(){return te.getMetaMetricsDataDeletionControllerMessenger}}),Object.defineProperty(n,"getNameControllerInitMessenger",{enumerable:!0,get:function(){return F.getNameControllerInitMessenger}}),Object.defineProperty(n,"getNameControllerMessenger",{enumerable:!0,get:function(){return F.getNameControllerMessenger}}),Object.defineProperty(n,"getNetworkControllerInitMessenger",{enumerable:!0,get:function(){return V.getNetworkControllerInitMessenger}}),Object.defineProperty(n,"getNetworkControllerMessenger",{enumerable:!0,get:function(){return V.getNetworkControllerMessenger}}),Object.defineProperty(n,"getOnboardingControllerMessenger",{enumerable:!0,get:function(){return D.getOnboardingControllerMessenger}}),Object.defineProperty(n,"getPermissionControllerInitMessenger",{enumerable:!0,get:function(){return W.getPermissionControllerInitMessenger}}),Object.defineProperty(n,"getPermissionControllerMessenger",{enumerable:!0,get:function(){return W.getPermissionControllerMessenger}}),Object.defineProperty(n,"getPermissionLogControllerMessenger",{enumerable:!0,get:function(){return z.getPermissionLogControllerMessenger}}),Object.defineProperty(n,"getPhishingControllerMessenger",{enumerable:!0,get:function(){return Z.getPhishingControllerMessenger}}),Object.defineProperty(n,"getPreferencesControllerMessenger",{enumerable:!0,get:function(){return $.getPreferencesControllerMessenger}}),Object.defineProperty(n,"getProfileMetricsControllerMessenger",{enumerable:!0,get:function(){return fe.getProfileMetricsControllerMessenger}}),Object.defineProperty(n,"getProfileMetricsServiceMessenger",{enumerable:!0,get:function(){return be.getProfileMetricsServiceMessenger}}),Object.defineProperty(n,"getRatesControllerMessenger",{enumerable:!0,get:function(){return A.getRatesControllerMessenger}}),Object.defineProperty(n,"getRemoteFeatureFlagControllerInitMessenger",{enumerable:!0,get:function(){return R.getRemoteFeatureFlagControllerInitMessenger}}),Object.defineProperty(n,"getRemoteFeatureFlagControllerMessenger",{enumerable:!0,get:function(){return R.getRemoteFeatureFlagControllerMessenger}}),Object.defineProperty(n,"getRewardsControllerMessenger",{enumerable:!0,get:function(){return L.getRewardsControllerMessenger}}),Object.defineProperty(n,"getSelectedNetworkControllerMessenger",{enumerable:!0,get:function(){return N.getSelectedNetworkControllerMessenger}}),Object.defineProperty(n,"getSignatureControllerInitMessenger",{enumerable:!0,get:function(){return de.getSignatureControllerInitMessenger}}),Object.defineProperty(n,"getSignatureControllerMessenger",{enumerable:!0,get:function(){return de.getSignatureControllerMessenger}}),Object.defineProperty(n,"getSubjectMetadataControllerMessenger",{enumerable:!0,get:function(){return K.getSubjectMetadataControllerMessenger}}),Object.defineProperty(n,"getSwapsControllerInitMessenger",{enumerable:!0,get:function(){return G.getSwapsControllerInitMessenger}}),Object.defineProperty(n,"getSwapsControllerMessenger",{enumerable:!0,get:function(){return G.getSwapsControllerMessenger}}),Object.defineProperty(n,"getTokenBalancesControllerInitMessenger",{enumerable:!0,get:function(){return E.getTokenBalancesControllerInitMessenger}}),Object.defineProperty(n,"getTokenBalancesControllerMessenger",{enumerable:!0,get:function(){return E.getTokenBalancesControllerMessenger}}),Object.defineProperty(n,"getTokenDetectionControllerInitMessenger",{enumerable:!0,get:function(){return I.getTokenDetectionControllerInitMessenger}}),Object.defineProperty(n,"getTokenDetectionControllerMessenger",{enumerable:!0,get:function(){return I.getTokenDetectionControllerMessenger}}),Object.defineProperty(n,"getTokenListControllerInitMessenger",{enumerable:!0,get:function(){return P.getTokenListControllerInitMessenger}}),Object.defineProperty(n,"getTokenListControllerMessenger",{enumerable:!0,get:function(){return P.getTokenListControllerMessenger}}),Object.defineProperty(n,"getTokensControllerInitMessenger",{enumerable:!0,get:function(){return M.getTokensControllerInitMessenger}}),Object.defineProperty(n,"getTokensControllerMessenger",{enumerable:!0,get:function(){return M.getTokensControllerMessenger}}),Object.defineProperty(n,"getTransactionPayControllerInitMessenger",{enumerable:!0,get:function(){return o.getTransactionPayControllerInitMessenger}}),Object.defineProperty(n,"getTransactionPayControllerMessenger",{enumerable:!0,get:function(){return o.getTransactionPayControllerMessenger}}),Object.defineProperty(n,"getUserOperationControllerInitMessenger",{enumerable:!0,get:function(){return he.getUserOperationControllerInitMessenger}}),Object.defineProperty(n,"getUserOperationControllerMessenger",{enumerable:!0,get:function(){return he.getUserOperationControllerMessenger}});var r=e("lodash"),s=e("./ppom-controller-messenger"),a=e("./snaps"),i=e("./transaction-controller-messenger"),o=e("./transaction-pay-controller-messenger"),c=e("./core-backend"),l=e("./multichain"),u=e("./accounts/institutional-snap-controller-messenger"),d=e("./identity"),h=e("./assets"),m=e("./notifications"),g=e("./defi-positions"),p=e("./defi-positions/defi-positions-controller-messenger"),f=e("./delegation/delegation-controller-messenger"),b=e("./accounts"),w=e("./seedless-onboarding"),C=e("./smart-transactions-controller-messenger"),k=e("./shield/shield-controller-messenger"),y=e("./subscription"),T=e("./gator-permissions/gator-permissions-controller-messenger"),v=e("./metametrics-controller-messenger"),S=e("./identity/user-storage-controller-messenger"),P=e("./token-list-controller-messenger"),I=e("./token-detection-controller-messenger"),M=e("./tokens-controller-messenger"),E=e("./token-balances-controller-messenger"),A=e("./rates-controller-messenger"),_=e("./currency-rate-controller-messenger"),j=e("./ens-controller-messenger"),F=e("./name-controller-messenger"),x=e("./gas-fee-controller-messenger"),N=e("./selected-network-controller-messenger"),O=e("./account-tracker-controller-messenger"),D=e("./onboarding-controller-messenger"),R=e("./remote-feature-flag-controller-messenger"),L=e("./rewards-controller-messenger"),G=e("./swaps-controller-messenger"),B=e("./bridge-controller-messenger"),U=e("./bridge-status-controller-messenger"),$=e("./preferences-controller-messenger"),H=e("./app-state-controller-messenger"),W=e("./permission-controller-messenger"),K=e("./subject-metadata-controller-messenger"),q=e("./keyring-controller-messenger"),z=e("./permission-log-controller-messenger"),V=e("./network-controller-messenger"),Y=e("./subscription/subscription-service-messenger"),Q=e("./announcement-controller-messenger"),J=e("./account-order-controller-messenger"),X=e("./accounts-controller-messenger"),Z=e("./phishing-controller-messenger"),ee=e("./alert-controller-messenger"),te=e("./metametrics-data-deletion-controller-messenger"),ne=e("./logging-controller-messenger"),re=e("./app-metadata-controller-messenger"),se=e("./error-reporting-service-messenger"),ae=e("./approval-controller-messenger"),ie=e("./address-book-controller-messenger"),oe=e("./decrypt-message-manager-messenger"),ce=e("./decrypt-message-controller-messenger"),le=e("./encryption-public-key-controller-messenger"),ue=e("./encryption-public-key-manager-messenger"),de=e("./signature-controller-messenger"),he=e("./user-operation-controller-messenger"),me=e("./reward-data-service-messenger"),ge=e("./claims/claims-controller-messenger"),pe=e("./claims/claims-service-messenger"),fe=e("./profile-metrics-controller-messenger"),be=e("./profile-metrics-service-messenger");n.CONTROLLER_MESSENGERS={AccountOrderController:{getMessenger:J.getAccountOrderControllerMessenger,getInitMessenger:r.noop},AccountTrackerController:{getMessenger:O.getAccountTrackerControllerMessenger,getInitMessenger:O.getAccountTrackerControllerInitMessenger},AccountsController:{getMessenger:X.getAccountsControllerMessenger,getInitMessenger:r.noop},AddressBookController:{getMessenger:ie.getAddressBookControllerMessenger,getInitMessenger:r.noop},AlertController:{getMessenger:ee.getAlertControllerMessenger,getInitMessenger:r.noop},AnnouncementController:{getMessenger:Q.getAnnouncementControllerMessenger,getInitMessenger:r.noop},AppMetadataController:{getMessenger:re.getAppMetadataControllerMessenger,getInitMessenger:r.noop},ApprovalController:{getMessenger:ae.getApprovalControllerMessenger,getInitMessenger:r.noop},AppStateController:{getMessenger:H.getAppStateControllerMessenger,getInitMessenger:r.noop},AuthenticationController:{getMessenger:d.getAuthenticationControllerMessenger,getInitMessenger:d.getAuthenticationControllerInitMessenger},BridgeController:{getMessenger:B.getBridgeControllerMessenger,getInitMessenger:B.getBridgeControllerInitMessenger},BridgeStatusController:{getMessenger:U.getBridgeStatusControllerMessenger,getInitMessenger:r.noop},ClaimsController:{getMessenger:ge.getClaimsControllerMessenger,getInitMessenger:ge.getClaimsControllerInitMessenger},ClaimsService:{getMessenger:pe.getClaimsServiceMessenger,getInitMessenger:r.noop},CronjobController:{getMessenger:a.getCronjobControllerMessenger,getInitMessenger:r.noop},CurrencyRateController:{getMessenger:_.getCurrencyRateControllerMessenger,getInitMessenger:_.getCurrencyRateControllerInitMessenger},DecryptMessageController:{getMessenger:ce.getDecryptMessageControllerMessenger,getInitMessenger:ce.getDecryptMessageControllerInitMessenger},DecryptMessageManager:{getMessenger:oe.getDecryptMessageManagerMessenger,getInitMessenger:r.noop},DeFiPositionsController:{getMessenger:g.getDeFiPositionsControllerMessenger,getInitMessenger:p.getDeFiPositionsControllerInitMessenger},DelegationController:{getMessenger:f.getDelegationControllerMessenger,getInitMessenger:f.getDelegationControllerInitMessenger},EncryptionPublicKeyController:{getMessenger:le.getEncryptionPublicKeyControllerMessenger,getInitMessenger:le.getEncryptionPublicKeyControllerInitMessenger},EncryptionPublicKeyManager:{getMessenger:ue.getEncryptionPublicKeyManagerMessenger,getInitMessenger:r.noop},EnsController:{getMessenger:j.getEnsControllerMessenger,getInitMessenger:j.getEnsControllerInitMessenger},ErrorReportingService:{getMessenger:se.getErrorReportingServiceMessenger,getInitMessenger:r.noop},ExecutionService:{getMessenger:a.getExecutionServiceMessenger,getInitMessenger:r.noop},GasFeeController:{getMessenger:x.getGasFeeControllerMessenger,getInitMessenger:x.getGasFeeControllerInitMessenger},GatorPermissionsController:{getMessenger:T.getGatorPermissionsControllerMessenger,getInitMessenger:r.noop},InstitutionalSnapController:{getMessenger:u.getInstitutionalSnapControllerMessenger,getInitMessenger:r.noop},KeyringController:{getMessenger:q.getKeyringControllerMessenger,getInitMessenger:q.getKeyringControllerInitMessenger},LoggingController:{getMessenger:ne.getLoggingControllerMessenger,getInitMessenger:r.noop},MetaMetricsController:{getMessenger:v.getMetaMetricsControllerMessenger,getInitMessenger:r.noop},MetaMetricsDataDeletionController:{getMessenger:te.getMetaMetricsDataDeletionControllerMessenger,getInitMessenger:r.noop},MultichainAssetsController:{getMessenger:l.getMultichainAssetsControllerMessenger,getInitMessenger:r.noop},MultichainAssetsRatesController:{getMessenger:l.getMultichainAssetsRatesControllerMessenger,getInitMessenger:r.noop},MultichainBalancesController:{getMessenger:l.getMultichainBalancesControllerMessenger,getInitMessenger:r.noop},MultichainTransactionsController:{getMessenger:l.getMultichainTransactionsControllerMessenger,getInitMessenger:r.noop},MultichainNetworkController:{getMessenger:l.getMultichainNetworkControllerMessenger,getInitMessenger:r.noop},MultichainRouter:{getMessenger:a.getMultichainRouterMessenger,getInitMessenger:r.noop},NameController:{getMessenger:F.getNameControllerMessenger,getInitMessenger:F.getNameControllerInitMessenger},NetworkController:{getMessenger:V.getNetworkControllerMessenger,getInitMessenger:V.getNetworkControllerInitMessenger},NotificationServicesController:{getMessenger:m.getNotificationServicesControllerMessenger,getInitMessenger:r.noop},NotificationServicesPushController:{getMessenger:m.getNotificationServicesPushControllerMessenger,getInitMessenger:m.getNotificationServicesPushControllerInitMessenger},OAuthService:{getMessenger:w.getOAuthServiceMessenger,getInitMessenger:r.noop},OnboardingController:{getMessenger:D.getOnboardingControllerMessenger,getInitMessenger:r.noop},PermissionController:{getMessenger:W.getPermissionControllerMessenger,getInitMessenger:W.getPermissionControllerInitMessenger},PermissionLogController:{getMessenger:z.getPermissionLogControllerMessenger,getInitMessenger:r.noop},PhishingController:{getMessenger:Z.getPhishingControllerMessenger,getInitMessenger:r.noop},RateLimitController:{getMessenger:a.getRateLimitControllerMessenger,getInitMessenger:a.getRateLimitControllerInitMessenger},RatesController:{getMessenger:A.getRatesControllerMessenger,getInitMessenger:r.noop},RemoteFeatureFlagController:{getMessenger:R.getRemoteFeatureFlagControllerMessenger,getInitMessenger:R.getRemoteFeatureFlagControllerInitMessenger},SeedlessOnboardingController:{getMessenger:w.getSeedlessOnboardingControllerMessenger,getInitMessenger:w.getSeedlessOnboardingControllerInitMessenger},SelectedNetworkController:{getMessenger:N.getSelectedNetworkControllerMessenger,getInitMessenger:r.noop},ShieldController:{getMessenger:k.getShieldControllerMessenger,getInitMessenger:k.getShieldControllerInitMessenger},SignatureController:{getMessenger:de.getSignatureControllerMessenger,getInitMessenger:de.getSignatureControllerInitMessenger},SnapsNameProvider:{getMessenger:a.getSnapsNameProviderMessenger,getInitMessenger:r.noop},SnapsRegistry:{getMessenger:a.getSnapsRegistryMessenger,getInitMessenger:r.noop},SnapController:{getMessenger:a.getSnapControllerMessenger,getInitMessenger:a.getSnapControllerInitMessenger},SnapInsightsController:{getMessenger:a.getSnapInsightsControllerMessenger,getInitMessenger:r.noop},SnapInterfaceController:{getMessenger:a.getSnapInterfaceControllerMessenger,getInitMessenger:r.noop},SnapKeyringBuilder:{getMessenger:b.getSnapKeyringBuilderMessenger,getInitMessenger:b.getSnapKeyringBuilderInitMessenger},SubjectMetadataController:{getMessenger:K.getSubjectMetadataControllerMessenger,getInitMessenger:r.noop},SubscriptionController:{getMessenger:y.getSubscriptionControllerMessenger,getInitMessenger:y.getSubscriptionControllerInitMessenger},SubscriptionService:{getMessenger:Y.getSubscriptionServiceMessenger,getInitMessenger:r.noop},RewardsDataService:{getMessenger:me.getRewardsDataServiceMessenger,getInitMessenger:r.noop},RewardsController:{getMessenger:L.getRewardsControllerMessenger,getInitMessenger:L.getRewardsControllerInitMessenger},SwapsController:{getMessenger:G.getSwapsControllerMessenger,getInitMessenger:G.getSwapsControllerInitMessenger},PPOMController:{getMessenger:s.getPPOMControllerMessenger,getInitMessenger:s.getPPOMControllerInitMessenger},PreferencesController:{getMessenger:$.getPreferencesControllerMessenger,getInitMessenger:r.noop},TokenBalancesController:{getMessenger:E.getTokenBalancesControllerMessenger,getInitMessenger:E.getTokenBalancesControllerInitMessenger},TokenDetectionController:{getMessenger:I.getTokenDetectionControllerMessenger,getInitMessenger:I.getTokenDetectionControllerInitMessenger},TokenListController:{getMessenger:P.getTokenListControllerMessenger,getInitMessenger:P.getTokenListControllerInitMessenger},TokensController:{getMessenger:M.getTokensControllerMessenger,getInitMessenger:M.getTokensControllerInitMessenger},TransactionController:{getMessenger:i.getTransactionControllerMessenger,getInitMessenger:i.getTransactionControllerInitMessenger},TransactionPayController:{getMessenger:o.getTransactionPayControllerMessenger,getInitMessenger:o.getTransactionPayControllerInitMessenger},UserOperationController:{getMessenger:he.getUserOperationControllerMessenger,getInitMessenger:he.getUserOperationControllerInitMessenger},UserStorageController:{getMessenger:d.getUserStorageControllerMessenger,getInitMessenger:S.getUserStorageControllerInitMessenger},TokenRatesController:{getMessenger:h.getTokenRatesControllerMessenger,getInitMessenger:h.getTokenRatesControllerInitMessenger},NftController:{getMessenger:h.getNftControllerMessenger,getInitMessenger:h.getNftControllerInitMessenger},NftDetectionController:{getMessenger:h.getNftDetectionControllerMessenger,getInitMessenger:r.noop},AssetsContractController:{getMessenger:h.getAssetsContractControllerMessenger,getInitMessenger:h.getAssetsContractControllerInitMessenger},AccountTreeController:{getMessenger:b.getAccountTreeControllerMessenger,getInitMessenger:b.getAccountTreeControllerInitMessenger},WebSocketService:{getMessenger:a.getWebSocketServiceMessenger,getInitMessenger:r.noop},BackendWebSocketService:{getMessenger:c.getBackendWebSocketServiceMessenger,getInitMessenger:c.getBackendWebSocketServiceInitMessenger},AccountActivityService:{getMessenger:c.getAccountActivityServiceMessenger,getInitMessenger:r.noop},SmartTransactionsController:{getMessenger:C.getSmartTransactionsControllerMessenger,getInitMessenger:C.getSmartTransactionsControllerInitMessenger},MultichainAccountService:{getMessenger:b.getMultichainAccountServiceMessenger,getInitMessenger:b.getMultichainAccountServiceInitMessenger},NetworkOrderController:{getMessenger:h.getNetworkOrderControllerMessenger,getInitMessenger:r.noop},NetworkEnablementController:{getMessenger:h.getNetworkEnablementControllerMessenger,getInitMessenger:h.getNetworkEnablementControllerInitMessenger},ProfileMetricsController:{getMessenger:fe.getProfileMetricsControllerMessenger,getInitMessenger:r.noop},ProfileMetricsService:{getMessenger:be.getProfileMetricsServiceMessenger,getInitMessenger:r.noop}}}}},{package:"$root$",file:"app/scripts/controller-init/messengers/index.ts"}],[106,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getKeyringControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"KeyringControllerInit",parent:e});return e.delegate({messenger:t,actions:["AppStateController:requestQrCodeScan"],events:[]}),t},n.getKeyringControllerMessenger=function(e){return new r.Messenger({namespace:"KeyringController",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/keyring-controller-messenger.ts"}],[107,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getLoggingControllerMessenger=function(e){return new r.Messenger({namespace:"LoggingController",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/logging-controller-messenger.ts"}],[108,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMetaMetricsControllerMessenger=function(e){const t=new r.Messenger({namespace:"MetaMetricsController",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getNetworkClientById","NetworkController:getState","PreferencesController:getState"],events:["PreferencesController:stateChange","NetworkController:networkDidChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/metametrics-controller-messenger.ts"}],[109,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMetaMetricsDataDeletionControllerMessenger=function(e){const t=new r.Messenger({namespace:"MetaMetricsDataDeletionController",parent:e});return e.delegate({messenger:t,actions:["MetaMetricsController:getState"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/metametrics-data-deletion-controller-messenger.ts"}],[110,{"./multichain-assets-controller-messenger":111,"./multichain-assets-rates-controller-messenger":112,"./multichain-balances-controller-messenger":113,"./multichain-network-controller-messenger":114,"./multichain-transactions-controller-messenger":115},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getMultichainAssetsControllerMessenger",{enumerable:!0,get:function(){return r.getMultichainAssetsControllerMessenger}}),Object.defineProperty(n,"getMultichainAssetsRatesControllerMessenger",{enumerable:!0,get:function(){return s.getMultichainAssetsRatesControllerMessenger}}),Object.defineProperty(n,"getMultichainBalancesControllerMessenger",{enumerable:!0,get:function(){return a.getMultichainBalancesControllerMessenger}}),Object.defineProperty(n,"getMultichainNetworkControllerMessenger",{enumerable:!0,get:function(){return o.getMultichainNetworkControllerMessenger}}),Object.defineProperty(n,"getMultichainTransactionsControllerMessenger",{enumerable:!0,get:function(){return i.getMultichainTransactionsControllerMessenger}});var r=e("./multichain-assets-controller-messenger"),s=e("./multichain-assets-rates-controller-messenger"),a=e("./multichain-balances-controller-messenger"),i=e("./multichain-transactions-controller-messenger"),o=e("./multichain-network-controller-messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/multichain/index.ts"}],[111,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMultichainAssetsControllerMessenger=function(e){const t=new r.Messenger({namespace:"MultichainAssetsController",parent:e});return e.delegate({messenger:t,events:["AccountsController:accountAdded","AccountsController:accountRemoved","AccountsController:accountAssetListUpdated"],actions:["PermissionController:getPermissions","SnapController:handleRequest","SnapController:getAll","AccountsController:listMultichainAccounts"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/multichain/multichain-assets-controller-messenger.ts"}],[112,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMultichainAssetsRatesControllerMessenger=function(e){const t=new r.Messenger({namespace:"MultichainAssetsRatesController",parent:e});return e.delegate({messenger:t,events:["AccountsController:accountAdded","KeyringController:lock","KeyringController:unlock","CurrencyRateController:stateChange","MultichainAssetsController:accountAssetListUpdated"],actions:["AccountsController:listMultichainAccounts","SnapController:handleRequest","CurrencyRateController:getState","MultichainAssetsController:getState","AccountsController:getSelectedMultichainAccount"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/multichain/multichain-assets-rates-controller-messenger.ts"}],[113,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMultichainBalancesControllerMessenger=function(e){const t=new r.Messenger({namespace:"MultichainBalancesController",parent:e});return e.delegate({messenger:t,events:["AccountsController:accountAdded","AccountsController:accountRemoved","AccountsController:accountBalancesUpdated","MultichainAssetsController:accountAssetListUpdated"],actions:["AccountsController:listMultichainAccounts","SnapController:handleRequest","MultichainAssetsController:getState","KeyringController:getState"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/multichain/multichain-balances-controller-messenger.ts"}],[114,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMultichainNetworkControllerMessenger=function(e){const t=new r.Messenger({namespace:"MultichainNetworkController",parent:e});return e.delegate({messenger:t,actions:["NetworkController:setActiveNetwork","NetworkController:getState","NetworkController:removeNetwork","NetworkController:findNetworkClientIdByChainId","NetworkController:getSelectedChainId","AccountsController:listMultichainAccounts"],events:["AccountsController:selectedAccountChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/multichain/multichain-network-controller-messenger.ts"}],[115,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMultichainTransactionsControllerMessenger=function(e){const t=new r.Messenger({namespace:"MultichainTransactionsController",parent:e});return e.delegate({messenger:t,events:["AccountsController:accountAdded","AccountsController:accountRemoved","AccountsController:accountTransactionsUpdated"],actions:["AccountsController:listMultichainAccounts","SnapController:handleRequest","KeyringController:getState"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/multichain/multichain-transactions-controller-messenger.ts"}],[116,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNameControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"NameControllerInit",parent:e});return e.delegate({messenger:t,actions:["PreferencesController:getState"]}),t},n.getNameControllerMessenger=function(e){return new r.Messenger({namespace:"NameController",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/name-controller-messenger.ts"}],[117,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNetworkControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"NetworkControllerInit",parent:e});return e.delegate({messenger:t,actions:["MetaMetricsController:getMetaMetricsId","MetaMetricsController:trackEvent","RemoteFeatureFlagController:getState"],events:["NetworkController:rpcEndpointUnavailable","NetworkController:rpcEndpointDegraded","RemoteFeatureFlagController:stateChange"]}),t},n.getNetworkControllerMessenger=function(e){const t=new r.Messenger({namespace:"NetworkController",parent:e});return e.delegate({messenger:t,actions:["ErrorReportingService:captureException"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/network-controller-messenger.ts"}],[118,{"./notification-services-controller-messenger":119,"./notification-services-push-controller-messenger":120},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getNotificationServicesControllerMessenger",{enumerable:!0,get:function(){return r.getNotificationServicesControllerMessenger}}),Object.defineProperty(n,"getNotificationServicesPushControllerInitMessenger",{enumerable:!0,get:function(){return s.getNotificationServicesPushControllerInitMessenger}}),Object.defineProperty(n,"getNotificationServicesPushControllerMessenger",{enumerable:!0,get:function(){return s.getNotificationServicesPushControllerMessenger}});var r=e("./notification-services-controller-messenger"),s=e("./notification-services-push-controller-messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/notifications/index.ts"}],[119,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNotificationServicesControllerMessenger=function(e){const t=new r.Messenger({namespace:"NotificationServicesController",parent:e});return e.delegate({messenger:t,actions:["KeyringController:getState","AuthenticationController:getBearerToken","AuthenticationController:isSignedIn","AuthenticationController:performSignIn","NotificationServicesPushController:enablePushNotifications","NotificationServicesPushController:disablePushNotifications","NotificationServicesPushController:subscribeToPushNotifications"],events:["KeyringController:stateChange","KeyringController:lock","KeyringController:unlock","NotificationServicesPushController:onNewNotifications","NotificationServicesPushController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/notifications/notification-services-controller-messenger.ts"}],[1199,{"@metamask/base-controller":1311,"@metamask/controller-utils":1384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.AddressBookController=n.getDefaultAddressBookControllerState=n.controllerName=n.AddressType=void 0;const i=e("@metamask/base-controller"),o=e("@metamask/controller-utils");var c;!function(e){e.externallyOwnedAccounts="EXTERNALLY_OWNED_ACCOUNTS",e.contractAccounts="CONTRACT_ACCOUNTS",e.nonAccounts="NON_ACCOUNTS"}(c||(n.AddressType=c={})),n.controllerName="AddressBookController";const l={addressBook:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};n.getDefaultAddressBookControllerState=()=>({addressBook:{}});class u extends i.BaseController{constructor({messenger:e,state:t}){const i={...(0,n.getDefaultAddressBookControllerState)(),...t};super({messenger:e,metadata:l,name:n.controllerName,state:i}),r.add(this),a(this,r,"m",s).call(this)}list(){const{addressBook:e}=this.state;return Object.keys(e).reduce((t,n)=>{const r=n;return[...t,...Object.values(e[r])]},[])}clear(){this.update(e=>{e.addressBook={}})}delete(e,t){if(t=(0,o.toChecksumHexAddress)(t),!([e,t].every(e=>(0,o.isSafeDynamicKey)(e))&&(0,o.isValidHexAddress)(t)&&this.state.addressBook[e]&&this.state.addressBook[e][t]))return!1;const n={...this.state.addressBook[e][t]};return this.update(n=>{const r=n.addressBook[e];r?.[t]&&(delete r[t],0===Object.keys(r).length&&delete n.addressBook[e])}),"*"!==String(e)&&this.messenger.publish("AddressBookController:contactDeleted",n),!0}set(e,t,n=(0,o.toHex)(1),r="",s){if(e=(0,o.toChecksumHexAddress)(e),!(0,o.isValidHexAddress)(e))return!1;const a={address:e,chainId:n,isEns:!1,memo:r,name:t,addressType:s,lastUpdatedAt:Date.now()},i=(0,o.normalizeEnsName)(t);return i&&(a.name=i,a.isEns=!0),this.update(t=>{t.addressBook={...this.state.addressBook,[n]:{...this.state.addressBook[n],[e]:a}}}),"*"!==String(n)&&this.messenger.publish("AddressBookController:contactUpdated",a),!0}}n.AddressBookController=u,r=new WeakSet,s=function(){this.messenger.registerActionHandler(`${n.controllerName}:list`,this.list.bind(this)),this.messenger.registerActionHandler(`${n.controllerName}:set`,this.set.bind(this)),this.messenger.registerActionHandler(`${n.controllerName}:delete`,this.delete.bind(this))},n.default=u}}},{package:"@metamask/address-book-controller",file:"node_modules/@metamask/address-book-controller/dist/AddressBookController.cjs"}],[12,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c;Object.defineProperty(n,"__esModule",{value:!0}),n.PREINSTALLED_SNAPS_URLS=void 0;n.PREINSTALLED_SNAPS_URLS=[new URL("/snaps/message-signing-snap.json",(null===(r=self.document)||void 0===r?void 0:r.baseURI)||self.location.href),new URL("/snaps/ens-resolver-snap.json",(null===(s=self.document)||void 0===s?void 0:s.baseURI)||self.location.href),new URL("/snaps/institutional-wallet-snap.json",(null===(a=self.document)||void 0===a?void 0:a.baseURI)||self.location.href),new URL("/snaps/bitcoin-wallet-snap.json",(null===(i=self.document)||void 0===i?void 0:i.baseURI)||self.location.href),new URL("/snaps/solana-wallet-snap.json",(null===(o=self.document)||void 0===o?void 0:o.baseURI)||self.location.href),new URL("/snaps/tron-wallet-snap.json",(null===(c=self.document)||void 0===c?void 0:c.baseURI)||self.location.href)]}}},{package:"$root$",file:"app/scripts/constants/snaps.ts"}],[120,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNotificationServicesPushControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"NotificationServicesPushControllerInit",parent:e});return e.delegate({messenger:t,actions:["MetaMetricsController:trackEvent"],events:["NotificationServicesPushController:onNewNotifications","NotificationServicesPushController:pushNotificationClicked"]}),t},n.getNotificationServicesPushControllerMessenger=function(e){const t=new r.Messenger({namespace:"NotificationServicesPushController",parent:e});return e.delegate({messenger:t,actions:["AuthenticationController:getBearerToken"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/notifications/notification-services-push-controller-messenger.ts"}],[1200,{"./AddressBookController.cjs":1199},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AddressBookController=n.getDefaultAddressBookControllerState=void 0;var r=e("./AddressBookController.cjs");Object.defineProperty(n,"getDefaultAddressBookControllerState",{enumerable:!0,get:function(){return r.getDefaultAddressBookControllerState}}),Object.defineProperty(n,"AddressBookController",{enumerable:!0,get:function(){return r.AddressBookController}})}}},{package:"@metamask/address-book-controller",file:"node_modules/@metamask/address-book-controller/dist/index.cjs"}],[1201,{"@metamask/base-controller":1311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.AnnouncementController=void 0;const i=e("@metamask/base-controller"),o={announcements:{}},c={announcements:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0}};class l extends i.BaseController{constructor({messenger:e,state:t,allAnnouncements:n}){const i={...o,...t};super({messenger:e,metadata:c,name:"AnnouncementController",state:i}),r.add(this),a(this,r,"m",s).call(this,n)}resetViewed(){this.update(({announcements:e})=>{for(const t of Object.values(e))t.isShown=!1})}updateViewed(e){this.update(({announcements:t})=>{for(const n of Object.keys(e).map(Number))t[n].isShown=e[n]})}}n.AnnouncementController=l,r=new WeakSet,s=function(e){this.update(t=>{Object.values(e).forEach(e=>{t.announcements[e.id]=t.announcements[e.id]??{...e,isShown:!1}})})}}}},{package:"@metamask/announcement-controller",file:"node_modules/@metamask/announcement-controller/dist/AnnouncementController.cjs"}],[1202,{"./AnnouncementController.cjs":1201},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AnnouncementController=void 0;var r=e("./AnnouncementController.cjs");Object.defineProperty(n,"AnnouncementController",{enumerable:!0,get:function(){return r.AnnouncementController}})}}},{package:"@metamask/announcement-controller",file:"node_modules/@metamask/announcement-controller/dist/index.cjs"}],[121,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getOnboardingControllerMessenger=function(e){return new r.Messenger({namespace:"OnboardingController",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/onboarding-controller-messenger.ts"}],[122,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPermissionControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"PermissionControllerInit",parent:e});return e.delegate({messenger:t,actions:["AppStateController:getUnlockPromise","AccountsController:listAccounts","CurrencyRateController:getState","KeyringController:getKeyringsByType","KeyringController:withKeyring","MultichainRouter:isSupportedScope","MultichainRouter:getSupportedAccounts","NetworkController:findNetworkClientIdByChainId","PhishingController:maybeUpdateState","PhishingController:testOrigin","PreferencesController:getState","RateLimitController:call","SnapController:clearSnapState","SnapController:get","SnapController:getSnapState","SnapController:handleRequest","SnapController:updateSnapState","SnapInterfaceController:createInterface","SnapInterfaceController:getInterface"]}),t},n.getPermissionControllerMessenger=function(e){const t=new r.Messenger({namespace:"PermissionController",parent:e});return e.delegate({messenger:t,actions:["ApprovalController:addRequest","ApprovalController:hasRequest","ApprovalController:acceptRequest","ApprovalController:rejectRequest","SnapController:getPermitted","SnapController:install","SubjectMetadataController:getSubjectMetadata"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/permission-controller-messenger.ts"}],[123,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPermissionLogControllerMessenger=function(e){return new r.Messenger({namespace:"PermissionLogController",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/permission-log-controller-messenger.ts"}],[124,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPhishingControllerMessenger=function(e){const t=new r.Messenger({namespace:"PhishingController",parent:e});return e.delegate({messenger:t,events:["TransactionController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/phishing-controller-messenger.ts"}],[125,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPPOMControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"PPOMControllerInit",parent:e});return e.delegate({messenger:t,events:["PreferencesController:stateChange"],actions:["NetworkController:getNetworkClientById","NetworkController:getSelectedNetworkClient","NetworkController:getState"]}),t},n.getPPOMControllerMessenger=function(e){const t=new r.Messenger({namespace:"PPOMController",parent:e});return e.delegate({messenger:t,events:["NetworkController:stateChange","NetworkController:networkDidChange"],actions:["NetworkController:getNetworkClientById"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/ppom-controller-messenger.ts"}],[126,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPreferencesControllerMessenger=function(e){const t=new r.Messenger({namespace:"PreferencesController",parent:e});return e.delegate({messenger:t,actions:["AccountsController:setSelectedAccount","AccountsController:getSelectedAccount","AccountsController:getAccountByAddress","AccountsController:setAccountName","NetworkController:getState"],events:["AccountsController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/preferences-controller-messenger.ts"}],[127,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getProfileMetricsControllerMessenger=function(e){const t=new r.Messenger({namespace:"ProfileMetricsController",parent:e});return e.delegate({messenger:t,actions:["AccountsController:getState","ProfileMetricsService:submitMetrics"],events:["AccountsController:accountAdded","AccountsController:accountRemoved","KeyringController:lock","KeyringController:unlock"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/profile-metrics-controller-messenger.ts"}],[128,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getProfileMetricsServiceMessenger=function(e){const t=new r.Messenger({namespace:"ProfileMetricsService",parent:e});return e.delegate({messenger:t,actions:["AuthenticationController:getBearerToken"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/profile-metrics-service-messenger.ts"}],[129,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRatesControllerMessenger=function(e){return new r.Messenger({namespace:"RatesController",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/rates-controller-messenger.ts"}],[13,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PHISHING_WARNING_PAGE=n.PHISHING_STREAM=n.PHISHING_SAFELIST=n.METAMASK_INPAGE=n.METAMASK_EIP_1193_PROVIDER=n.METAMASK_COOKIE_HANDLER=n.METAMASK_CAIP_MULTICHAIN_PROVIDER=n.LEGACY_PUBLIC_CONFIG=n.LEGACY_PROVIDER=n.LEGACY_INPAGE=n.LEGACY_CONTENT_SCRIPT=n.CONTENT_SCRIPT=void 0;n.CONTENT_SCRIPT="metamask-contentscript",n.METAMASK_INPAGE="metamask-inpage",n.PHISHING_WARNING_PAGE="metamask-phishing-warning-page",n.METAMASK_COOKIE_HANDLER="metamask-cookie-handler",n.METAMASK_EIP_1193_PROVIDER="metamask-provider",n.METAMASK_CAIP_MULTICHAIN_PROVIDER="metamask-multichain-provider",n.PHISHING_SAFELIST="metamask-phishing-safelist",n.PHISHING_STREAM="phishing",n.LEGACY_CONTENT_SCRIPT="contentscript",n.LEGACY_INPAGE="inpage",n.LEGACY_PROVIDER="provider",n.LEGACY_PUBLIC_CONFIG="publicConfig"}}},{package:"$root$",file:"app/scripts/constants/stream.ts"}],[130,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRemoteFeatureFlagControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"RemoteFeatureFlagControllerInit",parent:e});return e.delegate({messenger:t,actions:["MetaMetricsController:getMetaMetricsId","PreferencesController:getState","OnboardingController:getState"],events:["PreferencesController:stateChange","OnboardingController:stateChange"]}),t},n.getRemoteFeatureFlagControllerMessenger=function(e){return new r.Messenger({namespace:"RemoteFeatureFlagController",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/remote-feature-flag-controller-messenger.ts"}],[131,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRewardsDataServiceMessenger=function(e){const t=new r.Messenger({namespace:"RewardsDataService",parent:e});return e.delegate({messenger:t,actions:["PreferencesController:getState"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/reward-data-service-messenger.ts"}],[132,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRewardsControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"RewardsControllerInit",parent:e});return e.delegate({messenger:t,actions:["RemoteFeatureFlagController:getState","PreferencesController:getState"]}),t},n.getRewardsControllerMessenger=function(e){const t=new r.Messenger({namespace:s,parent:e});return e.delegate({messenger:t,actions:["AccountsController:getSelectedMultichainAccount","AccountTreeController:getAccountsFromSelectedAccountGroup","AccountsController:listMultichainAccounts","KeyringController:signPersonalMessage","RewardsDataService:login","RewardsDataService:estimatePoints","RewardsDataService:getSeasonStatus","RewardsDataService:fetchGeoLocation","RewardsDataService:mobileOptin","RewardsDataService:validateReferralCode","RewardsDataService:mobileJoin","RewardsDataService:getOptInStatus","RewardsDataService:getSeasonMetadata","RewardsDataService:getDiscoverSeasons","SnapController:handleRequest"],events:["AccountTreeController:selectedAccountGroupChange","KeyringController:unlock"]}),t};var r=e("@metamask/messenger");const s="RewardsController"}}},{package:"$root$",file:"app/scripts/controller-init/messengers/rewards-controller-messenger.ts"}],[133,{"./oauth-service-messenger":134,"./seedless-onboarding-controller-messenger":135},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getOAuthServiceMessenger",{enumerable:!0,get:function(){return r.getOAuthServiceMessenger}}),Object.defineProperty(n,"getSeedlessOnboardingControllerInitMessenger",{enumerable:!0,get:function(){return s.getSeedlessOnboardingControllerInitMessenger}}),Object.defineProperty(n,"getSeedlessOnboardingControllerMessenger",{enumerable:!0,get:function(){return s.getSeedlessOnboardingControllerMessenger}});var r=e("./oauth-service-messenger"),s=e("./seedless-onboarding-controller-messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/seedless-onboarding/index.ts"}],[134,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getOAuthServiceMessenger=function(e){const t=new r.Messenger({namespace:"OAuthService",parent:e});return e.delegate({messenger:t,actions:["SeedlessOnboardingController:getState","OnboardingController:getState"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/seedless-onboarding/oauth-service-messenger.ts"}],[135,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSeedlessOnboardingControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"SeedlessOnboardingControllerInit",parent:e});return e.delegate({messenger:t,actions:["OAuthService:getNewRefreshToken","OAuthService:revokeRefreshToken","OAuthService:renewRefreshToken"]}),t},n.getSeedlessOnboardingControllerMessenger=function(e){return new r.Messenger({namespace:"SeedlessOnboardingController",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/seedless-onboarding/seedless-onboarding-controller-messenger.ts"}],[1357,{"@metamask/utils":3070,buffer:4038},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.isVaultUpdated=n.updateVaultWithDetail=n.updateVault=n.generateSalt=n.serializeBufferForStorage=n.serializeBufferFromStorage=n.keyFromPassword=n.exportKey=n.importKey=n.decryptWithKey=n.decryptWithDetail=n.decrypt=n.encryptWithKey=n.encryptWithDetail=n.encrypt=void 0;const r=e("@metamask/utils"),s="jwk",a="AES-GCM",i="utf-8",o={algorithm:"PBKDF2",params:{iterations:1e4}},c={algorithm:"PBKDF2",params:{iterations:9e5}};async function l(e,t,n,r=f(),s=c){const a=n||await p(e,r,!1,s),i=await d(a,t);return i.salt=r,JSON.stringify(i)}async function u(e,t,n=f(),r=c){const s=await p(e,n,!0,r),a=await g(s);return{vault:await l(e,t,s,n),exportedKeyString:a}}async function d(e,n){const r=JSON.stringify(n),s=t.from(r,i),o=globalThis.crypto.getRandomValues(new Uint8Array(16)),c=C(e),l=await globalThis.crypto.subtle.encrypt({name:a,iv:o},c,s),u=new Uint8Array(l),d=t.from(o).toString("base64"),h={data:t.from(u).toString("base64"),iv:d};return b(e)&&(h.keyMetadata=e.derivationOptions),h}async function h(e,t,n){const r=JSON.parse(t),{salt:s,keyMetadata:a}=r,i=C(n||await p(e,s,!1,a));return await m(i,r)}async function m(e,n){const r=t.from(n.data,"base64"),s=t.from(n.iv,"base64"),o=C(e);let c;try{const e=await crypto.subtle.decrypt({name:a,iv:s},o,r),n=new Uint8Array(e),l=t.from(n).toString(i);c=JSON.parse(l)}catch(e){throw new Error("Incorrect password")}return c}async function g(e){return b(e)?JSON.stringify({key:await globalThis.crypto.subtle.exportKey(s,e.key),derivationOptions:e.derivationOptions}):JSON.stringify(await globalThis.crypto.subtle.exportKey(s,e))}async function p(e,n,r=!1,s=o){const c=t.from(e,i),l=t.from(n,"base64"),u=await globalThis.crypto.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),d=await globalThis.crypto.subtle.deriveKey({name:"PBKDF2",salt:l,iterations:s.params.iterations,hash:"SHA-256"},u,{name:a,length:256},r,["encrypt","decrypt"]);return s?{key:d,derivationOptions:s}:d}function f(e=32){const t=new Uint8Array(e);globalThis.crypto.getRandomValues(t);return btoa(String.fromCharCode.apply(null,t))}function b(e){return(0,r.isPlainObject)(e)&&(0,r.hasProperty)(e,"key")&&(0,r.hasProperty)(e,"derivationOptions")&&e.key instanceof CryptoKey&&w(e.derivationOptions)}function w(e){return(0,r.isPlainObject)(e)&&(0,r.hasProperty)(e,"algorithm")&&(0,r.hasProperty)(e,"params")}function C(e){return b(e)?e.key:e}function k(e,t=c){const{keyMetadata:n}=JSON.parse(e);return w(n)&&n.algorithm===t.algorithm&&n.params.iterations===t.params.iterations}n.encrypt=l,n.encryptWithDetail=u,n.encryptWithKey=d,n.decrypt=h,n.decryptWithDetail=async function(e,t){const n=JSON.parse(t),{salt:r,keyMetadata:s}=n,a=await p(e,r,!0,s);return{exportedKeyString:await g(a),vault:await h(e,t,a),salt:r}},n.decryptWithKey=m,n.importKey=async function(e){const t=JSON.parse(e);return n=t,(0,r.isPlainObject)(n)&&(0,r.hasProperty)(n,"key")&&(0,r.hasProperty)(n,"derivationOptions")&&w(n.derivationOptions)?{key:await globalThis.crypto.subtle.importKey(s,t.key,a,!0,["encrypt","decrypt"]),derivationOptions:t.derivationOptions}:await globalThis.crypto.subtle.importKey(s,t,a,!0,["encrypt","decrypt"]);var n},n.exportKey=g,n.keyFromPassword=p,n.serializeBufferFromStorage=function(e){const t="0x"===e.slice(0,2)?e.slice(2):e,n=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2){const r=t.substr(e,2);n[e/2]=parseInt(r,16)}return n},n.serializeBufferForStorage=function(e){let t="0x";return e.forEach(e=>{t+=function(e){let t=e.toString(16);for(;t.length<2;)t=`0${t}`;return t}(e)}),t},n.generateSalt=f,n.updateVault=async function(e,t,n=c){return k(e,n)?e:l(t,await h(t,e),undefined,undefined,n)},n.updateVaultWithDetail=async function(e,t,n=c){return k(e.vault,n)?e:u(t,await h(t,e.vault),undefined,n)},n.isVaultUpdated=k}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/browser-passworder",file:"node_modules/@metamask/browser-passworder/dist/index.js"}],[136,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSelectedNetworkControllerMessenger=function(e){const t=new r.Messenger({namespace:"SelectedNetworkController",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getNetworkClientById","NetworkController:getState","NetworkController:getSelectedNetworkClient","PermissionController:hasPermissions","PermissionController:getSubjectNames"],events:["NetworkController:stateChange","PermissionController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/selected-network-controller-messenger.ts"}],[137,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getShieldControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"ShieldControllerInit",parent:e});return e.delegate({messenger:t,actions:["AuthenticationController:getBearerToken"]}),t},n.getShieldControllerMessenger=function(e){const t=new r.Messenger({namespace:"ShieldController",parent:e});return e.delegate({messenger:t,events:["SignatureController:stateChange","TransactionController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/shield/shield-controller-messenger.ts"}],[138,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSignatureControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"SignatureControllerInit",parent:e});return e.delegate({messenger:t,actions:["MetaMetricsController:trackEvent","PreferencesController:getState"]}),t},n.getSignatureControllerMessenger=function(e){const t=new r.Messenger({namespace:"SignatureController",parent:e});return e.delegate({messenger:t,actions:["AccountsController:getState","ApprovalController:addRequest","KeyringController:signMessage","KeyringController:signPersonalMessage","KeyringController:signTypedMessage","LoggingController:add","NetworkController:getNetworkClientById","GatorPermissionsController:decodePermissionFromPermissionContextForOrigin"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/signature-controller-messenger.ts"}],[1389,{"./BackendWebSocketService.cjs":1390,"./logger.cjs":1392},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g,p,f=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},b=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.AccountActivityService=n.ACCOUNT_ACTIVITY_SERVICE_ALLOWED_EVENTS=n.ACCOUNT_ACTIVITY_SERVICE_ALLOWED_ACTIONS=void 0;const w=e("./BackendWebSocketService.cjs"),C=e("./logger.cjs"),k="AccountActivityService",y=(0,C.createModuleLogger)(C.projectLogger,k),T=["subscribe","unsubscribe"];n.ACCOUNT_ACTIVITY_SERVICE_ALLOWED_ACTIONS=["AccountsController:getSelectedAccount","BackendWebSocketService:connect","BackendWebSocketService:forceReconnection","BackendWebSocketService:subscribe","BackendWebSocketService:getConnectionInfo","BackendWebSocketService:channelHasSubscription","BackendWebSocketService:getSubscriptionsByChannel","BackendWebSocketService:findSubscriptionsByChannelPrefix","BackendWebSocketService:addChannelCallback","BackendWebSocketService:removeChannelCallback"],n.ACCOUNT_ACTIVITY_SERVICE_ALLOWED_EVENTS=["AccountsController:selectedAccountChange","BackendWebSocketService:connectionStateChanged"];n.AccountActivityService=class{constructor(e){r.add(this),this.name=k,s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,new Set),f(this,s,e.messenger,"f"),f(this,a,{subscriptionNamespace:e.subscriptionNamespace??"account-activity.v1"},"f"),f(this,i,e.traceFn??((e,t)=>t?.()),"f"),b(this,s,"f").registerMethodActionHandlers(this,T),b(this,s,"f").subscribe("AccountsController:selectedAccountChange",async e=>await b(this,r,"m",l).call(this,e)),b(this,s,"f").subscribe("BackendWebSocketService:connectionStateChanged",e=>b(this,r,"m",d).call(this,e)),b(this,s,"f").call("BackendWebSocketService:addChannelCallback",{channelName:`system-notifications.v1.${b(this,a,"f").subscriptionNamespace}`,callback:e=>b(this,r,"m",u).call(this,e)})}async subscribe(e){try{await b(this,s,"f").call("BackendWebSocketService:connect");const t=`${b(this,a,"f").subscriptionNamespace}.${e.address}`;if(b(this,s,"f").call("BackendWebSocketService:channelHasSubscription",t))return;await b(this,s,"f").call("BackendWebSocketService:subscribe",{channels:[t],channelType:b(this,a,"f").subscriptionNamespace,callback:e=>{b(this,r,"m",c).call(this,e.data)}})}catch(e){y("Subscription failed, forcing reconnection",{error:e}),await b(this,r,"m",p).call(this)}}async unsubscribe(e){const{address:t}=e;try{const e=`${b(this,a,"f").subscriptionNamespace}.${t}`,n=b(this,s,"f").call("BackendWebSocketService:getSubscriptionsByChannel",e);if(0===n.length)return;for(const e of n)await e.unsubscribe()}catch(e){y("Unsubscription failed, forcing reconnection",{error:e}),await b(this,r,"m",p).call(this)}}destroy(){b(this,s,"f").call("BackendWebSocketService:removeChannelCallback",`system-notifications.v1.${b(this,a,"f").subscriptionNamespace}`)}},s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,r=new WeakSet,c=function(e){const{address:t,tx:n,updates:r}=e,o=1e3*n.timestamp,c=Date.now()-o;y("Handling account activity update",{address:t,updateCount:r.length,elapsedMs:c}),b(this,i,"f").call(this,{name:`${k} Transaction Message`,data:{chain:n.chain,status:n.status,elapsed_ms:c},tags:{service:k,notification_type:b(this,a,"f").subscriptionNamespace}},()=>{b(this,s,"f").publish("AccountActivityService:transactionUpdated",n),b(this,s,"f").publish("AccountActivityService:balanceUpdated",{address:t,chain:n.chain,updates:r})})},l=async function(e){if(e?.address)try{const t=b(this,r,"m",g).call(this,e);await b(this,r,"m",m).call(this),await this.subscribe({address:t})}catch(e){y("Account change failed",{error:e})}},u=function(e){const t=e.data,{timestamp:n}=e;if(!t.chainIds||!Array.isArray(t.chainIds)||!t.status)throw new Error("Invalid system notification data: missing chainIds or status");if("up"===t.status)for(const e of t.chainIds)b(this,o,"f").add(e);else for(const e of t.chainIds)b(this,o,"f").delete(e);b(this,s,"f").publish("AccountActivityService:statusChanged",{chainIds:t.chainIds,status:t.status,timestamp:n}),y(`WebSocket status change - Published tracked chains as ${t.status}`,{count:t.chainIds.length,chains:t.chainIds,status:t.status})},d=async function(e){const{state:t}=e;if(t===w.WebSocketState.CONNECTED)await b(this,r,"m",h).call(this);else if(t===w.WebSocketState.DISCONNECTED){const e=Array.from(b(this,o,"f"));e.length>0&&(b(this,s,"f").publish("AccountActivityService:statusChanged",{chainIds:e,status:"down",timestamp:Date.now()}),y("WebSocket disconnection - Published tracked chains as down",{count:e.length,chains:e}),b(this,o,"f").clear())}},h=async function(){const e=b(this,s,"f").call("AccountsController:getSelectedAccount");if(!e||!e.address)return;const t=b(this,r,"m",g).call(this,e);await this.subscribe({address:t})},m=async function(){const e=b(this,s,"f").call("BackendWebSocketService:findSubscriptionsByChannelPrefix",b(this,a,"f").subscriptionNamespace);for(const t of e)await t.unsubscribe()},g=function(e){return e.scopes.some(e=>e.startsWith("eip155:"))?`eip155:0:${e.address}`:e.scopes.some(e=>e.startsWith("solana:"))?`solana:0:${e.address}`:e.address},p=async function(){y("Forcing WebSocket reconnection to clean up subscription state"),await b(this,s,"f").call("BackendWebSocketService:forceReconnection")}}}},{package:"@metamask/core-backend",file:"node_modules/@metamask/core-backend/dist/AccountActivityService.cjs"}],[139,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSmartTransactionsControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"SmartTransactionsControllerInit",parent:e});return e.delegate({messenger:t,actions:["MetaMetricsController:trackEvent"]}),t},n.getSmartTransactionsControllerMessenger=function(e){const t=new r.Messenger({namespace:"SmartTransactionsController",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getNetworkClientById","NetworkController:getState","TransactionController:getNonceLock","TransactionController:getTransactions","TransactionController:updateTransaction"],events:["NetworkController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/smart-transactions-controller-messenger.ts"}],[1390,{"./logger.cjs":1392,"@metamask/controller-utils":1384,"@metamask/utils":3070,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g,p,f,b,w,C,k,y,T,v,S,P,I,M,E,A,_,j,F,x,N,O,D,R,L=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},G=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.BackendWebSocketService=n.WebSocketEventType=n.WebSocketState=n.getCloseReason=void 0;const B=e("@metamask/controller-utils"),U=e("@metamask/utils"),$=e("uuid"),H=e("./logger.cjs"),W="BackendWebSocketService",K=(0,H.createModuleLogger)(H.projectLogger,W),q="Internal: Manual disconnect",z=["connect","disconnect","forceReconnection","sendMessage","sendRequest","subscribe","getConnectionInfo","getSubscriptionsByChannel","channelHasSubscription","findSubscriptionsByChannelPrefix","addChannelCallback","removeChannelCallback","getChannelCallbacks"];function V(e){switch(e){case 1e3:return"Normal Closure";case 1001:return"Going Away";case 1002:return"Protocol Error";case 1003:return"Unsupported Data";case 1004:return"Reserved";case 1005:return"No Status Received";case 1006:return"Abnormal Closure";case 1007:return"Invalid frame payload data";case 1008:return"Policy Violation";case 1009:return"Message Too Big";case 1010:return"Mandatory Extension";case 1011:return"Internal Server Error";case 1012:return"Service Restart";case 1013:return"Try Again Later";case 1014:return"Bad Gateway";case 1015:return"TLS Handshake";default:return e>=3e3&&e<=3999?"Library/Framework Error":e>=4e3&&e<=4999?"Application Error":"Unknown"}}var Y,Q;n.getCloseReason=V,function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.DISCONNECTING="disconnecting",e.DISCONNECTED="disconnected",e.ERROR="error"}(Y||(n.WebSocketState=Y={})),function(e){e.CONNECTED="connected",e.DISCONNECTED="disconnected",e.MESSAGE="message",e.ERROR="error",e.RECONNECTING="reconnecting",e.RECONNECTED="reconnected"}(Q||(n.WebSocketEventType=Q={}));n.BackendWebSocketService=class{constructor(e){r.add(this),this.name=W,s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,Y.DISCONNECTED),u.set(this,0),d.set(this,null),h.set(this,null),m.set(this,null),g.set(this,null),p.set(this,new Map),f.set(this,0),b.set(this,new Map),w.set(this,new Map),C.set(this,void 0),L(this,s,e.messenger,"f"),L(this,i,e.isEnabled,"f"),L(this,o,e.traceFn??((e,t)=>t?.()),"f"),L(this,a,{url:e.url,timeout:e.timeout??1e4,reconnectDelay:e.reconnectDelay??1e4,maxReconnectDelay:e.maxReconnectDelay??6e4,requestTimeout:e.requestTimeout??3e4},"f"),G(this,r,"m",x).call(this),G(this,r,"m",k).call(this),G(this,s,"f").registerMethodActionHandlers(this,z)}async connect(){if(G(this,i,"f")&&!G(this,i,"f").call(this))return G(this,r,"m",N).call(this),void L(this,u,0,"f");if(G(this,l,"f")!==Y.CONNECTED)if(G(this,g,"f"))await G(this,g,"f");else if(!G(this,d,"f")){L(this,g,(async()=>{let e;try{const t=await G(this,s,"f").call("AuthenticationController:getBearerToken");if(!t)throw new Error("Authentication required: user not signed in");e=t}catch(e){throw K("Failed to check authentication requirements",{error:e}),e}await G(this,r,"m",T).call(this,e)})(),"f");try{await G(this,g,"f")}catch{G(this,r,"m",F).call(this)}finally{L(this,g,null,"f")}}}disconnect(){G(this,l,"f")!==Y.DISCONNECTED&&G(this,c,"f")&&(G(this,c,"f").close(4999,q),K("WebSocket manually disconnected"))}async forceReconnection(){if(G(this,l,"f")===Y.DISCONNECTED||!G(this,c,"f"))return K("WebSocket already disconnected, scheduling reconnect"),void G(this,r,"m",F).call(this);K("Forcing WebSocket reconnection to clean up subscription state"),G(this,c,"f").close(4998,"Internal: Force reconnect")}sendMessage(e){if(G(this,l,"f")!==Y.CONNECTED||!G(this,c,"f"))throw new Error(`Cannot send message: WebSocket is ${G(this,l,"f")}`);try{G(this,c,"f").send(JSON.stringify(e))}catch(e){const t=(0,U.getErrorMessage)(e);throw G(this,r,"m",j).call(this,new Error(t)),new Error(t)}}async sendRequest(e){if(G(this,l,"f")!==Y.CONNECTED)throw new Error(`Cannot send request: WebSocket is ${G(this,l,"f")}`);const t=e.data?.requestId??(0,$.v4)(),n={event:e.event,data:{...e.data,requestId:t}};return new Promise((e,r)=>{const s=setTimeout(()=>{G(this,p,"f").delete(t),K("Request timeout - triggering reconnection",{timeout:G(this,a,"f").requestTimeout}),G(this,l,"f")===Y.CONNECTED&&G(this,c,"f")&&G(this,c,"f").close(3e3,"Request timeout - forcing reconnect"),r(new Error(`Request timeout after ${G(this,a,"f").requestTimeout}ms`))},G(this,a,"f").requestTimeout);G(this,p,"f").set(t,{resolve:e,reject:r,timeout:s});try{this.sendMessage(n)}catch(e){G(this,p,"f").delete(t),clearTimeout(s),r(e instanceof Error?e:new Error(String(e)))}})}getConnectionInfo(){return{state:G(this,l,"f"),url:G(this,a,"f").url,timeout:G(this,a,"f").timeout,reconnectDelay:G(this,a,"f").reconnectDelay,maxReconnectDelay:G(this,a,"f").maxReconnectDelay,requestTimeout:G(this,a,"f").requestTimeout,reconnectAttempts:G(this,u,"f"),connectedAt:G(this,f,"f")}}getSubscriptionsByChannel(e){const t=[];for(const[n,r]of G(this,b,"f"))r.channels.includes(e)&&t.push({subscriptionId:n,channels:r.channels,channelType:r.channelType,unsubscribe:r.unsubscribe});return t}channelHasSubscription(e){for(const t of G(this,b,"f").values())if(t.channels.includes(e))return!0;return!1}findSubscriptionsByChannelPrefix(e){const t=[];for(const[n,r]of G(this,b,"f")){r.channels.some(t=>t.startsWith(e))&&t.push({subscriptionId:n,channels:r.channels,channelType:r.channelType,unsubscribe:r.unsubscribe})}return t}addChannelCallback(e){const t={channelName:e.channelName,callback:e.callback};G(this,w,"f").has(e.channelName)||G(this,w,"f").set(e.channelName,t)}removeChannelCallback(e){return G(this,w,"f").delete(e)}getChannelCallbacks(){return Array.from(G(this,w,"f").values())}destroy(){G(this,r,"m",N).call(this),L(this,u,0,"f"),this.disconnect()}async subscribe(e){const{channels:t,channelType:n,callback:r,requestId:s}=e;if(G(this,l,"f")!==Y.CONNECTED)throw new Error(`Cannot create subscription(s) ${t.join(", ")}: WebSocket is ${G(this,l,"f")}`);const a=await this.sendRequest({event:"subscribe",data:{channels:t,requestId:s}});if(!a?.subscriptionId)throw new Error("Invalid subscription response: missing subscription ID");const{subscriptionId:i}=a,o=async e=>{await this.sendRequest({event:"unsubscribe",data:{subscription:i,channels:t,requestId:e}}),G(this,b,"f").delete(i)},c={subscriptionId:i,channels:[...t],channelType:n,unsubscribe:o};return G(this,b,"f").set(i,{subscriptionId:i,channels:[...t],channelType:n,callback:r,unsubscribe:o}),c}},s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,g=new WeakMap,p=new WeakMap,f=new WeakMap,b=new WeakMap,w=new WeakMap,C=new WeakMap,r=new WeakSet,k=function(){G(this,s,"f").subscribe("AuthenticationController:stateChange",e=>{e.isSignedIn?this.connect():this.disconnect()},e=>({isSignedIn:e.isSignedIn})),G(this,s,"f").subscribe("KeyringController:unlock",()=>{this.connect()}),G(this,s,"f").subscribe("KeyringController:lock",()=>{this.disconnect()})},y=function(e){const t=G(this,a,"f").url,n=new URL(t);return n.searchParams.set("token",e),n.toString()},T=async function(e){const t=G(this,r,"m",y).call(this,e);return G(this,r,"m",R).call(this,Y.CONNECTING),G(this,o,"f").call(this,{name:`${W} Connection`,data:{reconnectAttempt:G(this,u,"f")},tags:{service:W}},()=>new Promise((e,n)=>{const s=new WebSocket(t);L(this,h,setTimeout(()=>{K("WebSocket connection timeout - forcing close",{timeout:G(this,a,"f").timeout}),s.close()},G(this,a,"f").timeout),"f"),s.onopen=()=>{G(this,h,"f")&&(clearTimeout(G(this,h,"f")),L(this,h,null,"f")),L(this,c,s,"f"),G(this,r,"m",R).call(this,Y.CONNECTED),L(this,f,Date.now(),"f"),L(this,m,setTimeout(()=>{L(this,m,null,"f"),L(this,u,0,"f"),G(this,r,"m",x).call(this),K("Connection stable - reset reconnect attempts and backoff")},1e4),"f"),e()},s.onclose=t=>{if(K("WebSocket onclose event triggered",{code:t.code,reason:t.reason||V(t.code),wasClean:t.wasClean}),G(this,l,"f")===Y.DISCONNECTED)return;const s=4999===t.code&&t.reason===q;G(this,l,"f")===Y.CONNECTING&&(s?e():n(new Error(`WebSocket connection closed during connection: ${t.code} ${t.reason}`)));const a=G(this,f,"f")>0?Date.now()-G(this,f,"f"):0;G(this,r,"m",N).call(this),L(this,c,undefined,"f"),L(this,g,null,"f"),L(this,f,0,"f"),G(this,r,"m",O).call(this,new Error(`WebSocket connection closed: ${t.code} ${t.reason||V(t.code)}`)),G(this,r,"m",D).call(this),G(this,r,"m",R).call(this,Y.DISCONNECTED),s?L(this,u,0,"f"):G(this,r,"m",F).call(this),G(this,o,"f").call(this,{name:`${W} Disconnection`,data:{code:t.code,reason:t.reason||V(t.code),wasClean:t.wasClean,reconnectAttempts:G(this,u,"f"),...a>0&&{connectionDuration_ms:a}},tags:{service:W}})},s.onmessage=e=>{try{const t=G(this,r,"m",_).call(this,e.data);G(this,r,"m",v).call(this,t)}catch{}}}))},v=function(e){if(G(this,r,"m",S).call(this,e))G(this,r,"m",M).call(this,e);else{if(G(this,r,"m",P).call(this,e)){const t=e;if(G(this,r,"m",A).call(this,t))return}if(G(this,r,"m",I).call(this,e)){const t=e;G(this,r,"m",E).call(this,t)}}},S=function(e){return"data"in e&&e.data&&"object"==typeof e.data&&"requestId"in e.data},P=function(e){return"subscriptionId"in e&&!G(this,r,"m",S).call(this,e)},I=function(e){return"channel"in e},M=function(e){const{requestId:t}=e.data,n=G(this,p,"f").get(t);n&&(G(this,p,"f").delete(t),clearTimeout(n.timeout),e.data.failed&&e.data.failed.length>0?n.reject(new Error(`Request failed: ${e.data.failed.join(", ")}`)):n.resolve(e.data))},E=function(e){0!==G(this,w,"f").size&&G(this,w,"f").get(e.channel)?.callback(e)},A=function(e){const{subscriptionId:t,timestamp:n,channel:r}=e;if(null!==t&&t!==undefined){const s=G(this,b,"f").get(t);if(!s)return!1;const a=Date.now()-n;return G(this,o,"f").call(this,{name:`${W} Notification`,data:{channel:r,latency_ms:a,subscriptionId:t},tags:{service:W,notification_type:s.channelType}},()=>{s.callback?.(e)}),!0}return!1},_=function(e){return JSON.parse(e)},j=function(e){},F=function(){if(G(this,d,"f"))return;L(this,u,G(this,u,"f")+1,"f");const e=G(this,C,"f").duration;L(this,C,G(this,C,"f").next({attempt:G(this,u,"f")}),"f"),K("Scheduling reconnect",{attempt:G(this,u,"f"),delay_ms:e}),L(this,d,setTimeout(()=>{if(L(this,d,null,"f"),G(this,i,"f")&&!G(this,i,"f").call(this))return L(this,u,0,"f"),void G(this,r,"m",x).call(this);this.connect()},e),"f")},x=function(){L(this,C,new B.ExponentialBackoff({initialDelay:G(this,a,"f").reconnectDelay,maxDelay:G(this,a,"f").maxReconnectDelay}).next(),"f")},N=function(){G(this,d,"f")&&(clearTimeout(G(this,d,"f")),L(this,d,null,"f")),G(this,h,"f")&&(clearTimeout(G(this,h,"f")),L(this,h,null,"f")),G(this,m,"f")&&(clearTimeout(G(this,m,"f")),L(this,m,null,"f"))},O=function(e){for(const[,t]of G(this,p,"f"))clearTimeout(t.timeout),t.reject(e);G(this,p,"f").clear()},D=function(){G(this,b,"f").clear()},R=function(e){const t=G(this,l,"f");L(this,l,e,"f"),t!==e&&G(this,s,"f").publish("BackendWebSocketService:connectionStateChanged",this.getConnectionInfo())}}}},{package:"@metamask/core-backend",file:"node_modules/@metamask/core-backend/dist/BackendWebSocketService.cjs"}],[1391,{"./AccountActivityService.cjs":1389,"./BackendWebSocketService.cjs":1390},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AccountActivityService=n.BackendWebSocketService=void 0;var r=e("./BackendWebSocketService.cjs");Object.defineProperty(n,"BackendWebSocketService",{enumerable:!0,get:function(){return r.BackendWebSocketService}});var s=e("./AccountActivityService.cjs");Object.defineProperty(n,"AccountActivityService",{enumerable:!0,get:function(){return s.AccountActivityService}})}}},{package:"@metamask/core-backend",file:"node_modules/@metamask/core-backend/dist/index.cjs"}],[1392,{"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),n.projectLogger=(0,r.createProjectLogger)("core-backend")}}},{package:"@metamask/core-backend",file:"node_modules/@metamask/core-backend/dist/logger.cjs"}],[1393,{"./constants.cjs":1394,"./utils.cjs":1396,"@metamask/base-controller":1311,"@metamask/keyring-controller":2183,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.DelegationController=n.controllerName=void 0;const o=e("@metamask/base-controller"),c=e("@metamask/keyring-controller"),l=e("@metamask/utils"),u=e("./constants.cjs"),d=e("./utils.cjs");n.controllerName="DelegationController";const h={delegations:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}};class m extends o.BaseController{constructor({messenger:e,state:t,hashDelegation:i,getDelegationEnvironment:o}){super({messenger:e,metadata:h,name:n.controllerName,state:{delegations:{},...t}}),r.set(this,void 0),s.set(this,void 0),a(this,r,i,"f"),a(this,s,o,"f")}async signDelegation(e){const{delegation:t,chainId:n}=e,{DelegationManager:r}=i(this,s,"f").call(this,n),a=(0,d.createTypedMessageParams)({chainId:(0,l.hexToNumber)(n),from:t.delegator,delegation:{...t,signature:"0x"},verifyingContract:r});return await this.messenger.call("KeyringController:signTypedMessage",a,c.SignTypedDataVersion.V4)}store(e){const{entry:t}=e,n=i(this,r,"f").call(this,t.delegation);if(!(0,d.isHexEqual)(t.delegation.authority,u.ROOT_AUTHORITY)&&!this.state.delegations[t.delegation.authority])throw new Error("Invalid authority");this.update(e=>{e.delegations[n]=t})}list(e){const t=this.messenger.call("AccountsController:getSelectedAccount").address;let n=Object.values(this.state.delegations);e?.from&&(n=n.filter(t=>(0,d.isHexEqual)(t.delegation.delegator,e.from))),(!e?.from||e?.from&&!(0,d.isHexEqual)(e.from,t))&&(n=n.filter(e=>(0,d.isHexEqual)(e.delegation.delegate,t)));const r=e?.chainId;r&&(n=n.filter(e=>(0,d.isHexEqual)(e.chainId,r)));const s=e?.tags;return s&&s.length>0&&(n=n.filter(e=>s.every(t=>e.tags.includes(t)))),n}retrieve(e){return this.state.delegations[e]??null}chain(e){const t=[],n=this.retrieve(e);if(!n)return null;t.push(n);for(let e=n.delegation.authority;e!==u.ROOT_AUTHORITY;){const n=this.retrieve(e);if(!n)throw new Error("Invalid delegation chain");t.push(n),e=n.delegation.authority}return t}delete(e){if(!this.retrieve(e))return 0;const t=Object.entries(this.state.delegations),n=[e],r=[];for(;n.length>0;){const e=n.pop();t.filter(([t,n])=>n.delegation.authority===e).forEach(([e])=>{n.push(e)}),r.push(e)}return this.update(e=>{r.forEach(t=>{delete e.delegations[t]})}),r.length}}n.DelegationController=m,r=new WeakMap,s=new WeakMap}}},{package:"@metamask/delegation-controller",file:"node_modules/@metamask/delegation-controller/dist/DelegationController.cjs"}],[1394,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SIGNABLE_DELEGATION_TYPED_DATA=n.ROOT_AUTHORITY=void 0,n.ROOT_AUTHORITY="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff";n.SIGNABLE_DELEGATION_TYPED_DATA={EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Caveat:[{name:"enforcer",type:"address"},{name:"terms",type:"bytes"}],Delegation:[{name:"delegate",type:"address"},{name:"delegator",type:"address"},{name:"authority",type:"bytes32"},{name:"caveats",type:"Caveat[]"},{name:"salt",type:"uint256"}]}}}},{package:"@metamask/delegation-controller",file:"node_modules/@metamask/delegation-controller/dist/constants.cjs"}],[1395,{"./DelegationController.cjs":1393},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DelegationController=void 0;var r=e("./DelegationController.cjs");Object.defineProperty(n,"DelegationController",{enumerable:!0,get:function(){return r.DelegationController}})}}},{package:"@metamask/delegation-controller",file:"node_modules/@metamask/delegation-controller/dist/index.cjs"}],[1396,{"./constants.cjs":1394,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createTypedMessageParams=n.toDelegationStruct=n.isHexEqual=void 0;const r=e("@metamask/utils"),s=e("./constants.cjs");n.isHexEqual=function(e,t){return e.toLowerCase()===t.toLowerCase()};n.toDelegationStruct=e=>{const t=e.caveats.map(e=>({enforcer:(0,r.getChecksumAddress)(e.enforcer),terms:e.terms,args:e.args})),n="0x"===e.salt?0n:BigInt(e.salt);return{delegate:(0,r.getChecksumAddress)(e.delegate),delegator:(0,r.getChecksumAddress)(e.delegator),authority:e.authority,caveats:t,salt:n,signature:e.signature}},n.createTypedMessageParams=function(e){const{chainId:t,from:r,delegation:a,verifyingContract:i}=e;return{data:{types:s.SIGNABLE_DELEGATION_TYPED_DATA,primaryType:"Delegation",domain:{chainId:t,name:"DelegationManager",version:"1",verifyingContract:i},message:(0,n.toDelegationStruct)(a)},from:r}}}}},{package:"@metamask/delegation-controller",file:"node_modules/@metamask/delegation-controller/dist/utils.cjs"}],[1398,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r={DelegationManager:"0xdb9B1e94B5b69Df7e401DDbedE43491141047dB3",EntryPoint:"0x0000000071727De22E5E9d8BAf0edAc6f37da032",SimpleFactory:"0x69Aa2f9fe1572F1B640E1bbc512f5c3a734fc77c",MultiSigDeleGatorImpl:"0x56a9EdB16a0105eb5a4C54f4C062e2868844f3A7",HybridDeleGatorImpl:"0x48dBe696A4D990079e039489bA2053B36E8FFEC4",EIP7702StatelessDeleGatorImpl:"0x63c0c19a282a1B52b07dD5a65b58948A07DAE32B",AllowedCalldataEnforcer:"0xc2b0d624c1c4319760C96503BA27C347F3260f55",AllowedMethodsEnforcer:"0x2c21fD0Cb9DC8445CB3fb0DC5E7Bb0Aca01842B5",AllowedTargetsEnforcer:"0x7F20f61b1f09b08D970938F6fa563634d65c4EeB",BlockNumberEnforcer:"0x5d9818dF0AE3f66e9c3D0c5029DAF99d1823ca6c",DeployedEnforcer:"0x24ff2AA430D53a8CD6788018E902E098083dcCd2",ERC20BalanceChangeEnforcer:"0xcdF6aB796408598Cea671d79506d7D48E97a5437",ERC20TransferAmountEnforcer:"0xf100b0819427117EcF76Ed94B358B1A5b5C6D2Fc",ERC20PeriodTransferEnforcer:"0x474e3Ae7E169e940607cC624Da8A15Eb120139aB",ERC20StreamingEnforcer:"0x56c97aE02f233B29fa03502Ecc0457266d9be00e",ERC721BalanceChangeEnforcer:"0x8aFdf96eDBbe7e1eD3f5Cd89C7E084841e12A09e",ERC721TransferEnforcer:"0x3790e6B7233f779b09DA74C72b6e94813925b9aF",ERC1155BalanceChangeEnforcer:"0x63c322732695cAFbbD488Fc6937A0A7B66fC001A",ExactCalldataBatchEnforcer:"0x982FD5C86BBF425d7d1451f974192d4525113DfD",ExactCalldataEnforcer:"0x99F2e9bF15ce5eC84685604836F71aB835DBBdED",ExactExecutionBatchEnforcer:"0x1e141e455d08721Dd5BCDA1BaA6Ea5633Afd5017",ExactExecutionEnforcer:"0x146713078D39eCC1F5338309c28405ccf85Abfbb",IdEnforcer:"0xC8B5D93463c893401094cc70e66A206fb5987997",LimitedCallsEnforcer:"0x04658B29F6b82ed55274221a06Fc97D318E25416",NativeBalanceChangeEnforcer:"0xbD7B277507723490Cd50b12EaaFe87C616be6880",ArgsEqualityCheckEnforcer:"0x44B8C6ae3C304213c3e298495e12497Ed3E56E41",NativeTokenPaymentEnforcer:"0x4803a326ddED6dDBc60e659e5ed12d85c7582811",NativeTokenTransferAmountEnforcer:"0xF71af580b9c3078fbc2BBF16FbB8EEd82b330320",NativeTokenStreamingEnforcer:"0xD10b97905a320b13a0608f7E9cC506b56747df19",NativeTokenPeriodTransferEnforcer:"0x9BC0FAf4Aca5AE429F4c06aEEaC517520CB16BD9",NonceEnforcer:"0xDE4f2FAC4B3D87A1d9953Ca5FC09FCa7F366254f",OwnershipTransferEnforcer:"0x7EEf9734E7092032B5C56310Eb9BbD1f4A524681",RedeemerEnforcer:"0xE144b0b2618071B4E56f746313528a669c7E65c5",SpecificActionERC20TransferBatchEnforcer:"0x6649b61c873F6F9686A1E1ae9ee98aC380c7bA13",TimestampEnforcer:"0x1046bb45C8d673d4ea75321280DB34899413c069",ValueLteEnforcer:"0x92Bf12322527cAA612fd31a0e810472BBB106A8F",MultiTokenPeriodEnforcer:"0xFB2f1a9BD76d3701B730E5d69C3219D42D80eBb7"},s={DelegationManager:"0x56D56e07e3d6Ee5a24e30203A37a0a460f42D7A3",EntryPoint:"0x0000000071727De22E5E9d8BAf0edAc6f37da032",SimpleFactory:"0x6ff518884f21168c30c58CB21184D6AdBC18Ad90",MultiSigDeleGatorImpl:"0xd1f421EDbA5e3FA9efe3874827114b20C5BEC40C",HybridDeleGatorImpl:"0x941f3a016F8726d5643Ce62452d0D78492D42b42",AllowedCalldataEnforcer:"0xff71d60f3208469cBCE0859717B5198042DCB3F3",AllowedMethodsEnforcer:"0xe32C2561792e8446Abe73B9f557B881C13906186",AllowedTargetsEnforcer:"0x06aaE4c67EEA95277c46Bf79b1583d4a01772D22",BlockNumberEnforcer:"0x8E470D2Ae278457b42d2405E0B8Cd4BE21Ed9045",DeployedEnforcer:"0xf9088f013dBD9ebb7Cebd66fEB48253c6Ac5a820",ERC20BalanceGteEnforcer:"0xB7B6f32ec6343261D814e55Ed8C5925d91Cab861",ERC20TransferAmountEnforcer:"0x9A069b18032B31429A363AeCFb1B6A0564b44471",IdEnforcer:"0x91015c3b9D9523966eD2399885e5Df7A567f916c",LimitedCallsEnforcer:"0xe694bFfffEA3E85923b1210b37e6a0175e910863",NonceEnforcer:"0xE83BCFD8bBE672A96747e831050a91cf44F4F87A",TimestampEnforcer:"0x550FdD13eEBC1f22ea2a2480024BacBF0Ad7e5CE",ValueLteEnforcer:"0xBE32a6DB7471F63BB168C088c57Db01AfAe87967",NativeTokenTransferAmountEnforcer:"0x5eD3833d7B957A8DB8A461c3AF2d668Ec25382E0",NativeBalanceGteEnforcer:"0x376a98860E210DdEda3689fb39565592c563cB0A",ArgsEqualityCheckEnforcer:"0x7378dE585998d3E18Ce147867C335C25B3dB8Ee5",NativeTokenPaymentEnforcer:"0x87Fe18EbF99e42fcE8A03a25F1d20E119407f8e7",RedeemerEnforcer:"0x926672b130D1EF60A9d6b11D2048d121b30f40C1"},a={DelegationManager:"0xbe4138886cb096bdc1b930f2f0ca7892aa234d78",EntryPoint:"0x0000000071727De22E5E9d8BAf0edAc6f37da032",SimpleFactory:"0x6ff518884f21168c30c58CB21184D6AdBC18Ad90",MultiSigDeleGatorImpl:"0x11f555af5844d85bfcf5d61d2a22866527eb585a",HybridDeleGatorImpl:"0xd6edd1256deccb2b06bdecef92dc16bcf26e531b",AllowedCalldataEnforcer:"0x48db3835a873d64a4af2c09f014052407c003bd7",AllowedMethodsEnforcer:"0xfd731951bf1c52afccee3e6f14ab656475b76dd4",AllowedTargetsEnforcer:"0xbc8673c0afa52d86d991c06881e55b2966920564",BlockNumberEnforcer:"0xc15faffa0d879b9263c15a46ce31eacfa2e0e8ae",DeployedEnforcer:"0x5accb9559b56a6c1e3f90e342c85c42d93720d43",ERC20BalanceGteEnforcer:"0xb5d6b1ec6d868a3bae5b7f48178eaa2686a7a087",ERC20TransferAmountEnforcer:"0x92ac423b9c111962179a6242e1adb58d02c103be",IdEnforcer:"0x34152d9f3f8f74338d50703e780389e829b4abac",LimitedCallsEnforcer:"0x4b3adad4a328bee8ba17b86074d92fe7372180cd",NonceEnforcer:"0x2f32ff3fc3086d7f63f16fe8d0065390d460b40d",TimestampEnforcer:"0x78e05f779490c24bf3bfa135b4112e7003b321cd",ValueLteEnforcer:"0xfc20ede0a1132e839fbda9d7ed3904ff3c89540f"},i={arbitrum:42161,arbitrumNova:42170,base:8453,berachain:80094,bsc:56,gnosis:100,ink:57073,linea:59144,mainnet:1,monad:143,optimism:10,polygon:137,sei:1329,sonic:146,unichain:130,bscTestnet:97,arbitrumSepolia:421614,baseSepolia:84532,berachainBepolia:80069,chiado:10200,citreaTestnet:5115,hoodiTestnet:560048,inkSepolia:763373,lineaSepolia:59141,megaEthTestnet:6342,monadTestnet:10143,optimismSepolia:11155420,polygonAmoy:80002,seiTestnet:1328,sepolia:11155111,sonicTestnet:14601,unichainSepolia:1301,lineaGoerli:59140},o={"1.0.0":{[i.optimism]:a,[i.polygon]:a,[i.base]:a,[i.arbitrum]:a,[i.linea]:a,[i.sepolia]:{...a,HybridDeleGatorImpl:"0x5989F5D13DF8fc818EdA65e417AED90459fD67F7"},[i.lineaSepolia]:{...a,HybridDeleGatorImpl:"0x5989F5D13DF8fc818EdA65e417AED90459fD67F7"}},"1.1.0":{[i.arbitrum]:s,[i.base]:s,[i.linea]:s,[i.optimism]:s,[i.polygon]:s,[i.sepolia]:s,[i.lineaSepolia]:s,[i.baseSepolia]:{...s,SimpleFactory:"0xE8eA1DE8D6AfE400B7C8C1A81B7C29B7876b4d02"}},"1.3.0":{[i.mainnet]:r,[i.polygon]:r,[i.bsc]:r,[i.optimism]:r,[i.arbitrum]:r,[i.ink]:r,[i.linea]:r,[i.base]:r,[i.gnosis]:r,[i.berachain]:r,[i.unichain]:r,[i.arbitrumNova]:r,[i.sei]:r,[i.sonic]:r,[i.monad]:r,[i.bscTestnet]:r,[i.citreaTestnet]:r,[i.megaEthTestnet]:r,[i.chiado]:r,[i.lineaSepolia]:r,[i.berachainBepolia]:r,[i.baseSepolia]:r,[i.arbitrumSepolia]:r,[i.sepolia]:r,[i.optimismSepolia]:r,[i.unichainSepolia]:r,[i.polygonAmoy]:r,[i.inkSepolia]:r,[i.monadTestnet]:r,[i.seiTestnet]:r,[i.sonicTestnet]:r,[i.hoodiTestnet]:r}};n.CHAIN_ID=i,n.DELEGATOR_CONTRACTS=o}}},{package:"@metamask/delegation-deployments",file:"node_modules/@metamask/delegation-deployments/dist/index.cjs"}],[14,{"../controllers/account-order":216},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AccountOrderControllerInit=void 0;var r=e("../controllers/account-order");n.AccountOrderControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.AccountOrderController({messenger:e,state:t.AccountOrderController})})}}},{package:"$root$",file:"app/scripts/controller-init/account-order-controller-init.ts"}],[140,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getCronjobControllerMessenger=function(e){const t=new r.Messenger({namespace:"CronjobController",parent:e});return e.delegate({messenger:t,events:["SnapController:snapInstalled","SnapController:snapUpdated","SnapController:snapUninstalled","SnapController:snapEnabled","SnapController:snapDisabled"],actions:["PermissionController:getPermissions","SnapController:handleRequest"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/cronjob-controller-messenger.ts"}],[141,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getExecutionServiceMessenger=function(e){return new r.Messenger({namespace:"ExecutionService",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/execution-service-messenger.ts"}],[142,{"./cronjob-controller-messenger":140,"./execution-service-messenger":141,"./multichain-router-messenger":143,"./rate-limit-controller-messenger":144,"./snap-controller-messenger":145,"./snap-insights-controller-messenger":146,"./snap-interface-controller-messenger":147,"./snaps-name-provider-messenger":148,"./snaps-registry-messenger":149,"./websocket-service-messenger":150},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getCronjobControllerMessenger",{enumerable:!0,get:function(){return r.getCronjobControllerMessenger}}),Object.defineProperty(n,"getExecutionServiceMessenger",{enumerable:!0,get:function(){return s.getExecutionServiceMessenger}}),Object.defineProperty(n,"getMultichainRouterMessenger",{enumerable:!0,get:function(){return a.getMultichainRouterMessenger}}),Object.defineProperty(n,"getRateLimitControllerInitMessenger",{enumerable:!0,get:function(){return i.getRateLimitControllerInitMessenger}}),Object.defineProperty(n,"getRateLimitControllerMessenger",{enumerable:!0,get:function(){return i.getRateLimitControllerMessenger}}),Object.defineProperty(n,"getSnapControllerInitMessenger",{enumerable:!0,get:function(){return o.getSnapControllerInitMessenger}}),Object.defineProperty(n,"getSnapControllerMessenger",{enumerable:!0,get:function(){return o.getSnapControllerMessenger}}),Object.defineProperty(n,"getSnapInsightsControllerMessenger",{enumerable:!0,get:function(){return c.getSnapInsightsControllerMessenger}}),Object.defineProperty(n,"getSnapInterfaceControllerMessenger",{enumerable:!0,get:function(){return l.getSnapInterfaceControllerMessenger}}),Object.defineProperty(n,"getSnapsNameProviderMessenger",{enumerable:!0,get:function(){return u.getSnapsNameProviderMessenger}}),Object.defineProperty(n,"getSnapsRegistryMessenger",{enumerable:!0,get:function(){return d.getSnapsRegistryMessenger}}),Object.defineProperty(n,"getWebSocketServiceMessenger",{enumerable:!0,get:function(){return h.getWebSocketServiceMessenger}});var r=e("./cronjob-controller-messenger"),s=e("./execution-service-messenger"),a=e("./multichain-router-messenger"),i=e("./rate-limit-controller-messenger"),o=e("./snap-controller-messenger"),c=e("./snap-insights-controller-messenger"),l=e("./snap-interface-controller-messenger"),u=e("./snaps-name-provider-messenger"),d=e("./snaps-registry-messenger"),h=e("./websocket-service-messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/index.ts"}],[143,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMultichainRouterMessenger=function(e){const t=new r.Messenger({namespace:"MultichainRouter",parent:e});return e.delegate({messenger:t,actions:["SnapController:getAll","SnapController:handleRequest","PermissionController:getPermissions","AccountsController:listMultichainAccounts"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/multichain-router-messenger.ts"}],[144,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRateLimitControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"RateLimitController",parent:e});return e.delegate({messenger:t,actions:["SubjectMetadataController:getState","NotificationServicesController:updateMetamaskNotificationsList"]}),t},n.getRateLimitControllerMessenger=function(e){return new r.Messenger({namespace:"RateLimitController",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/rate-limit-controller-messenger.ts"}],[145,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"SnapControllerInit",parent:e});return e.delegate({messenger:t,actions:["KeyringController:getKeyringsByType","PreferencesController:getState","MetaMetricsController:trackEvent","SnapController:setClientActive","OnboardingController:getState"],events:["KeyringController:lock","KeyringController:unlock","OnboardingController:stateChange"]}),t},n.getSnapControllerMessenger=function(e){const t=new r.Messenger({namespace:"SnapController",parent:e});return e.delegate({messenger:t,events:["ExecutionService:unhandledError","ExecutionService:outboundRequest","ExecutionService:outboundResponse","KeyringController:lock"],actions:["PermissionController:getEndowments","PermissionController:getPermissions","PermissionController:hasPermission","PermissionController:hasPermissions","PermissionController:requestPermissions","PermissionController:revokeAllPermissions","PermissionController:revokePermissions","PermissionController:revokePermissionForAllSubjects","PermissionController:getSubjectNames","PermissionController:updateCaveat","ApprovalController:addRequest","ApprovalController:updateRequestState","PermissionController:grantPermissions","SubjectMetadataController:getSubjectMetadata","SubjectMetadataController:addSubjectMetadata","ExecutionService:executeSnap","ExecutionService:terminateSnap","ExecutionService:terminateAllSnaps","ExecutionService:handleRpcRequest","NetworkController:getNetworkClientById","SelectedNetworkController:getNetworkClientIdForDomain","SnapsRegistry:get","SnapsRegistry:getMetadata","SnapsRegistry:update","SnapsRegistry:resolveVersion","SnapInterfaceController:createInterface","SnapInterfaceController:getInterface"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snap-controller-messenger.ts"}],[146,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapInsightsControllerMessenger=function(e){const t=new r.Messenger({namespace:"SnapInsightsController",parent:e});return e.delegate({messenger:t,actions:["SnapController:handleRequest","SnapController:getAll","PermissionController:getPermissions","SnapInterfaceController:deleteInterface"],events:["TransactionController:unapprovedTransactionAdded","TransactionController:transactionStatusUpdated","SignatureController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snap-insights-controller-messenger.ts"}],[147,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapInterfaceControllerMessenger=function(e){const t=new r.Messenger({namespace:"SnapInterfaceController",parent:e});return e.delegate({messenger:t,actions:["PhishingController:maybeUpdateState","PhishingController:testOrigin","ApprovalController:hasRequest","ApprovalController:acceptRequest","SnapController:get","MultichainAssetsController:getState","AccountsController:getSelectedMultichainAccount","AccountsController:getAccountByAddress","AccountsController:listMultichainAccounts"],events:["NotificationServicesController:notificationsListUpdated"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snap-interface-controller-messenger.ts"}],[148,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapsNameProviderMessenger=function(e){const t=new r.Messenger({namespace:"SnapsNameProvider",parent:e});return e.delegate({messenger:t,actions:["SnapController:getAll","SnapController:get","SnapController:handleRequest","PermissionController:getState"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snaps-name-provider-messenger.ts"}],[149,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapsRegistryMessenger=function(e){return new r.Messenger({namespace:"SnapsRegistry",parent:e})};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/snaps-registry-messenger.ts"}],[15,{"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AccountTrackerControllerInit=void 0;var r=e("@metamask/assets-controllers");n.AccountTrackerControllerInit=({controllerMessenger:e,initMessenger:t,getController:n})=>({persistedStateKey:null,memStateKey:null,controller:new r.AccountTrackerController({messenger:e,getStakedBalanceForChain:(e,t)=>n("AssetsContractController").getStakedBalanceForChain(e,t),includeStakedAssets:!1,allowExternalServices:()=>{const{useExternalServices:e}=t.call("PreferencesController:getState");return e},accountsApiChainIds:()=>{var e;const n=t.call("RemoteFeatureFlagController:getState"),r=null==n||null===(e=n.remoteFeatureFlags)||void 0===e?void 0:e.assetsAccountApiBalances;return Array.isArray(r)?r:[]},fetchingEnabled:()=>n("OnboardingController").state.completedOnboarding})})}}},{package:"$root$",file:"app/scripts/controller-init/account-tracker-controller-init.ts"}],[150,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getWebSocketServiceMessenger=function(e){const t=new r.Messenger({namespace:"WebSocketService",parent:e});return e.delegate({messenger:t,actions:["SnapController:handleRequest"],events:["SnapController:snapUpdated","SnapController:snapUninstalled","SnapController:snapInstalled"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/snaps/websocket-service-messenger.ts"}],[151,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSubjectMetadataControllerMessenger=function(e){const t=new r.Messenger({namespace:"SubjectMetadataController",parent:e});return e.delegate({messenger:t,actions:["PermissionController:hasPermissions"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/subject-metadata-controller-messenger.ts"}],[152,{"./subscription-controller-messenger":153,"./subscription-service-messenger":154},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getSubscriptionControllerInitMessenger",{enumerable:!0,get:function(){return r.getSubscriptionControllerInitMessenger}}),Object.defineProperty(n,"getSubscriptionControllerMessenger",{enumerable:!0,get:function(){return r.getSubscriptionControllerMessenger}}),Object.defineProperty(n,"getSubscriptionServiceMessenger",{enumerable:!0,get:function(){return s.getSubscriptionServiceMessenger}});var r=e("./subscription-controller-messenger"),s=e("./subscription-service-messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/subscription/index.ts"}],[153,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSubscriptionControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"SubscriptionControllerInit",parent:e});return e.delegate({messenger:t,actions:["AuthenticationController:getBearerToken"]}),t},n.getSubscriptionControllerMessenger=function(e){const t=new r.Messenger({namespace:"SubscriptionController",parent:e});return e.delegate({messenger:t,events:["AuthenticationController:stateChange"],actions:["AuthenticationController:getBearerToken","AuthenticationController:performSignOut"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/subscription/subscription-controller-messenger.ts"}],[154,{"../../../services/subscription/types":590,"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSubscriptionServiceMessenger=function(e){const t=new r.Messenger({namespace:s.SERVICE_NAME,parent:e});return e.delegate({messenger:t,actions:["SubscriptionController:getPricing","SubscriptionController:getSubscriptions","SubscriptionController:startShieldSubscriptionWithCard","SubscriptionController:updatePaymentMethod","SubscriptionController:getCryptoApproveTransactionParams","SubscriptionController:getBillingPortalUrl","SubscriptionController:submitSponsorshipIntents","SubscriptionController:getState","SubscriptionController:submitShieldSubscriptionCryptoApproval","SubscriptionController:linkRewards","AppStateController:getState","AppStateController:setPendingShieldCohort","AuthenticationController:getBearerToken","TransactionController:getTransactions","AccountsController:getState","PreferencesController:getState","SmartTransactionsController:getState","NetworkController:getState","SwapsController:getState","MetaMetricsController:trackEvent","KeyringController:getState","RewardsController:getSeasonStatus","RewardsController:getSeasonMetadata","RewardsController:getHasAccountOptedIn"]}),t};var r=e("@metamask/messenger"),s=e("../../../services/subscription/types")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/subscription/subscription-service-messenger.ts"}],[155,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSwapsControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"SwapsControllerInit",parent:e});return e.delegate({messenger:t,actions:["MetaMetricsController:trackEvent","NetworkController:getState"]}),t},n.getSwapsControllerMessenger=function(e){const t=new r.Messenger({namespace:"SwapsController",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getNetworkClientById","NetworkController:getState","TokenRatesController:getState"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/swaps-controller-messenger.ts"}],[156,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTokenBalancesControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"TokenBalancesControllerInit",parent:e});return e.delegate({messenger:t,actions:["PreferencesController:getState","RemoteFeatureFlagController:getState"]}),t},n.getTokenBalancesControllerMessenger=function(e){const t=new r.Messenger({namespace:"TokenBalancesController",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getState","NetworkController:getNetworkClientById","TokensController:getState","PreferencesController:getState","AccountsController:getSelectedAccount","AccountsController:listAccounts","AccountTrackerController:getState","AccountTrackerController:updateNativeBalances","AccountTrackerController:updateStakedBalances","TokenDetectionController:addDetectedTokensViaWs","AuthenticationController:getBearerToken"],events:["PreferencesController:stateChange","TokensController:stateChange","NetworkController:stateChange","KeyringController:accountRemoved","AccountActivityService:statusChanged","AccountActivityService:balanceUpdated","AccountsController:selectedEvmAccountChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/token-balances-controller-messenger.ts"}],[157,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTokenDetectionControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"TokenDetectionControllerInit",parent:e});return e.delegate({messenger:t,actions:["AssetsContractController:getBalancesInSingleCall","MetaMetricsController:trackEvent","PreferencesController:getState"]}),t},n.getTokenDetectionControllerMessenger=function(e){const t=new r.Messenger({namespace:"TokenDetectionController",parent:e});return e.delegate({messenger:t,actions:["AccountsController:getAccount","AccountsController:getSelectedAccount","KeyringController:getState","NetworkController:getNetworkClientById","NetworkController:getNetworkConfigurationByNetworkClientId","NetworkController:getState","PreferencesController:getState","TokenListController:getState","TokensController:getState","TokensController:addDetectedTokens","TokensController:addTokens","NetworkController:findNetworkClientIdByChainId","AuthenticationController:getBearerToken"],events:["AccountsController:selectedEvmAccountChange","KeyringController:lock","KeyringController:unlock","NetworkController:networkDidChange","PreferencesController:stateChange","TokenListController:stateChange","TransactionController:transactionConfirmed"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/token-detection-controller-messenger.ts"}],[158,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTokenListControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"TokenListControllerInit",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getNetworkClientById","NetworkController:getState","PreferencesController:getState"],events:["PreferencesController:stateChange"]}),t},n.getTokenListControllerMessenger=function(e){const t=new r.Messenger({namespace:"TokenListController",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getNetworkClientById"],events:["NetworkController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/token-list-controller-messenger.ts"}],[159,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTokensControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"TokensControllerInit",parent:e});return e.delegate({messenger:t,actions:["NetworkController:getNetworkClientById","NetworkController:getSelectedNetworkClient","NetworkController:getState"]}),t},n.getTokensControllerMessenger=function(e){const t=new r.Messenger({namespace:"TokensController",parent:e});return e.delegate({messenger:t,actions:["AccountsController:getAccount","AccountsController:getSelectedAccount","AccountsController:listAccounts","ApprovalController:addRequest","NetworkController:getNetworkClientById"],events:["AccountsController:selectedEvmAccountChange","KeyringController:accountRemoved","NetworkController:networkDidChange","NetworkController:stateChange","PreferencesController:stateChange","TokenListController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/tokens-controller-messenger.ts"}],[16,{"@metamask/accounts-controller":1197},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AccountsControllerInit=void 0;var r=e("@metamask/accounts-controller");n.AccountsControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.AccountsController({messenger:e,state:t.AccountsController})})}}},{package:"$root$",file:"app/scripts/controller-init/accounts-controller-init.ts"}],[160,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"TransactionControllerInit",parent:e});return e.delegate({messenger:t,events:["SmartTransactionsController:smartTransaction","TransactionController:transactionApproved","TransactionController:transactionConfirmed","TransactionController:transactionDropped","TransactionController:transactionFailed","TransactionController:transactionNewSwapApproval","TransactionController:transactionNewSwap","TransactionController:transactionRejected","TransactionController:transactionSubmitted","TransactionController:postTransactionBalanceUpdated","TransactionController:unapprovedTransactionAdded"],actions:["ApprovalController:acceptRequest","ApprovalController:addRequest","ApprovalController:endFlow","ApprovalController:startFlow","ApprovalController:updateRequestState","AppStateController:getState","AuthenticationController:getBearerToken","DelegationController:signDelegation","InstitutionalSnapController:beforeCheckPendingTransactionHook","InstitutionalSnapController:publishHook","KeyringController:signEip7702Authorization","KeyringController:signTypedMessage","NetworkController:getEIP1559Compatibility","RemoteFeatureFlagController:getState","SwapsController:setApproveTxId","SwapsController:setTradeTxId","TransactionController:estimateGas","TransactionController:getState","SubscriptionController:getSubscriptionByProduct","SubscriptionService:submitSubscriptionSponsorshipIntent"]}),t},n.getTransactionControllerMessenger=function(e){const t=new r.Messenger({namespace:"TransactionController",parent:e});return e.delegate({messenger:t,actions:["AccountsController:getSelectedAccount","AccountsController:getState","ApprovalController:addRequest","KeyringController:signEip7702Authorization","NetworkController:findNetworkClientIdByChainId","NetworkController:getNetworkClientById","RemoteFeatureFlagController:getState"],events:["NetworkController:stateChange"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/transaction-controller-messenger.ts"}],[161,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionPayControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"TransactionPayControllerInit",parent:e});return e.delegate({messenger:t,actions:["DelegationController:signDelegation","KeyringController:signEip7702Authorization"],events:[]}),t},n.getTransactionPayControllerMessenger=function(e){const t=new r.Messenger({namespace:"TransactionPayController",parent:e});return e.delegate({messenger:t,actions:["AccountTrackerController:getState","BridgeController:fetchQuotes","BridgeStatusController:submitTx","CurrencyRateController:getState","GasFeeController:getState","NetworkController:findNetworkClientIdByChainId","NetworkController:getNetworkClientById","RemoteFeatureFlagController:getState","TokenBalancesController:getState","TokenListController:getState","TokenRatesController:getState","TokensController:getState","TransactionController:getGasFeeTokens","TransactionController:getState","TransactionController:updateTransaction"],events:["BridgeStatusController:stateChange","TransactionController:stateChange","TransactionController:unapprovedTransactionAdded"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/transaction-pay-controller-messenger.ts"}],[162,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getUserOperationControllerInitMessenger=function(e){const t=new r.Messenger({namespace:"UserOperationControllerInit",parent:e});return e.delegate({messenger:t,actions:["TransactionController:emulateNewTransaction","TransactionController:emulateTransactionUpdate"]}),t},n.getUserOperationControllerMessenger=function(e){const t=new r.Messenger({namespace:"UserOperationController",parent:e});return e.delegate({messenger:t,actions:["ApprovalController:addRequest","NetworkController:getNetworkClientById","KeyringController:prepareUserOperation","KeyringController:patchUserOperation","KeyringController:signUserOperation"]}),t};var r=e("@metamask/messenger")}}},{package:"$root$",file:"app/scripts/controller-init/messengers/user-operation-controller-messenger.ts"}],[163,{"../../../shared/lib/sentry":5866,"../controllers/metametrics-controller":223,"../lib/segment":321},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MetaMetricsControllerInit=void 0;var r,s=(r=e("../controllers/metametrics-controller"))&&r.__esModule?r:{default:r},a=e("../lib/segment"),i=e("../../../shared/lib/sentry");n.MetaMetricsControllerInit=({controllerMessenger:e,extension:t,persistedState:n})=>({controller:new s.default({state:n.MetaMetricsController,messenger:e,version:"13.13.2",environment:"production",segment:a.segment,extension:t,captureException:i.captureException})})}}},{package:"$root$",file:"app/scripts/controller-init/metametrics-controller-init.ts"}],[164,{"../controllers/metametrics-data-deletion/metametrics-data-deletion":224,"../services/data-deletion-service":579},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MetaMetricsDataDeletionControllerInit=void 0;var r=e("../controllers/metametrics-data-deletion/metametrics-data-deletion"),s=e("../services/data-deletion-service");n.MetaMetricsDataDeletionControllerInit=({controllerMessenger:e,persistedState:t})=>{const n=new s.DataDeletionService;return{controller:new r.MetaMetricsDataDeletionController({messenger:e,state:t.MetaMetricsDataDeletionController,dataDeletionService:n})}}}}},{package:"$root$",file:"app/scripts/controller-init/metametrics-data-deletion-controller-init.ts"}],[165,{"./multichain-account-service-init":166,"./multichain-assets-controller-init":167,"./multichain-balances-controller-init":168,"./multichain-network-controller-init":169,"./multichain-rates-assets-controller-init":171,"./multichain-transactions-controller-init":172},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"MultichainAccountServiceInit",{enumerable:!0,get:function(){return r.MultichainAccountServiceInit}}),Object.defineProperty(n,"MultichainAssetsControllerInit",{enumerable:!0,get:function(){return s.MultichainAssetsControllerInit}}),Object.defineProperty(n,"MultichainAssetsRatesControllerInit",{enumerable:!0,get:function(){return c.MultichainAssetsRatesControllerInit}}),Object.defineProperty(n,"MultichainBalancesControllerInit",{enumerable:!0,get:function(){return a.MultichainBalancesControllerInit}}),Object.defineProperty(n,"MultichainNetworkControllerInit",{enumerable:!0,get:function(){return o.MultichainNetworkControllerInit}}),Object.defineProperty(n,"MultichainTransactionsControllerInit",{enumerable:!0,get:function(){return i.MultichainTransactionsControllerInit}});var r=e("./multichain-account-service-init"),s=e("./multichain-assets-controller-init"),a=e("./multichain-balances-controller-init"),i=e("./multichain-transactions-controller-init"),o=e("./multichain-network-controller-init"),c=e("./multichain-rates-assets-controller-init")}}},{package:"$root$",file:"app/scripts/controller-init/multichain/index.ts"}],[166,{"../../../../shared/lib/multichain-accounts/remote-feature-flag":5857,"../../../../shared/lib/multichain-feature-flags":5858,"../../../../shared/lib/trace":5873,"../../lib/util":358,"@metamask/multichain-account-service":2251},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainAccountServiceInit=void 0;var r=e("@metamask/multichain-account-service"),s=e("../../lib/util"),a=e("../../../../shared/lib/multichain-accounts/remote-feature-flag"),i=e("../../../../shared/lib/multichain-feature-flags"),o=e("../../../../shared/lib/trace");n.MultichainAccountServiceInit=({controllerMessenger:e,initMessenger:t})=>{var n,c;const l={maxConcurrency:1,discovery:{timeoutMs:2e3,maxAttempts:3,backOffMs:1e3},createAccounts:{timeoutMs:3e3}},u=new r.AccountProviderWrapper(e,new r.BtcAccountProvider(e,l)),d=new r.AccountProviderWrapper(e,new r.TrxAccountProvider(e,l)),h=new r.MultichainAccountService({messenger:e,providers:[u,d],providerConfigs:{[r.SOL_ACCOUNT_PROVIDER_NAME]:l},config:{trace:o.trace}}),m=t.call("PreferencesController:getState");t.subscribe("PreferencesController:stateChange",(0,s.previousValueComparator)((e,n)=>{const{useExternalServices:r}=e,{useExternalServices:s}=n;if(r!==s){const{remoteFeatureFlags:e}=t.call("RemoteFeatureFlagController:getState"),n=null==e?void 0:e.enableMultichainAccountsState2;(0,a.isMultichainAccountsFeatureEnabled)(n,a.FEATURE_VERSION_2)&&h.setBasicFunctionality(s).catch(e=>{console.error("Failed to set basic functionality on MultichainAccountService:",e)})}return!0},m));const g=t.call("RemoteFeatureFlagController:getState"),p=(0,i.isMultichainFeatureEnabled)(null==g||null===(n=g.remoteFeatureFlags)||void 0===n?void 0:n.bitcoinAccounts);u.setEnabled(p);const f=(0,i.isMultichainFeatureEnabled)(null==g||null===(c=g.remoteFeatureFlags)||void 0===c?void 0:c.tronAccounts);return d.setEnabled(f),e.subscribe("RemoteFeatureFlagController:stateChange",(0,s.previousValueComparator)((e,t)=>{var n,r,s,a;const o=(0,i.isMultichainFeatureEnabled)(null==e||null===(n=e.remoteFeatureFlags)||void 0===n?void 0:n.bitcoinAccounts),c=(0,i.isMultichainFeatureEnabled)(null==t||null===(r=t.remoteFeatureFlags)||void 0===r?void 0:r.bitcoinAccounts);o!==c&&(u.setEnabled(c),c&&h.alignWallets().catch(e=>{console.error("Failed to align wallets after enabling Bitcoin provider:",e)}));const l=(0,i.isMultichainFeatureEnabled)(null==e||null===(s=e.remoteFeatureFlags)||void 0===s?void 0:s.tronAccounts),m=(0,i.isMultichainFeatureEnabled)(null==t||null===(a=t.remoteFeatureFlags)||void 0===a?void 0:a.tronAccounts);return l!==m&&(d.setEnabled(m),m&&h.alignWallets().catch(e=>{console.error("Failed to align wallets after enabling Tron provider:",e)})),!0},g)),{memStateKey:null,persistedStateKey:null,controller:h}}}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-account-service-init.ts"}],[167,{"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainAssetsControllerInit=void 0;var r=e("@metamask/assets-controllers");n.MultichainAssetsControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.MultichainAssetsController({messenger:e,state:t.MultichainAssetsController})})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-assets-controller-init.ts"}],[168,{"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainBalancesControllerInit=void 0;var r=e("@metamask/assets-controllers");n.MultichainBalancesControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.MultichainBalancesController({messenger:e,state:t.MultichainBalancesController})})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-balances-controller-init.ts"}],[169,{"./multichain-network-service-init":170,"@metamask/multichain-network-controller":2279},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNetworkControllerInit=void 0;var r=e("@metamask/multichain-network-controller"),s=e("./multichain-network-service-init");n.MultichainNetworkControllerInit=({controllerMessenger:e,persistedState:t})=>{const n=(0,s.MultichainNetworkServiceInit)();return{controller:new r.MultichainNetworkController({messenger:e,state:t.MultichainNetworkController,networkService:n})}}}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-network-controller-init.ts"}],[17,{"../../../../shared/constants/metametrics":5768,"../../../../shared/lib/trace":5873,"@metamask/account-tree-controller":1190},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AccountTreeControllerInit=void 0;var r=e("@metamask/account-tree-controller"),s=e("../../../../shared/lib/trace"),a=e("../../../../shared/constants/metametrics");n.AccountTreeControllerInit=({controllerMessenger:e,persistedState:t,initMessenger:n})=>({controller:new r.AccountTreeController({messenger:e,state:t.AccountTreeController,config:{trace:s.trace,backupAndSync:{onBackupAndSyncEvent:e=>{n.call("MetaMetricsController:trackEvent",{category:a.MetaMetricsEventCategory.BackupAndSync,event:a.MetaMetricsEventName.ProfileActivityUpdated,properties:{event:e}})}},accountOrderCallbacks:{isHiddenAccount:e=>{const t=n.call("AccountsController:getAccount",e);if(!t)return!1;return n.call("AccountOrderController:getState").hiddenAccountList.includes(t.address)},isPinnedAccount:e=>{const t=n.call("AccountsController:getAccount",e);if(!t)return!1;return n.call("AccountOrderController:getState").pinnedAccountList.includes(t.address)}}}})})}}},{package:"$root$",file:"app/scripts/controller-init/accounts/account-tree-controller-init.ts"}],[170,{"@metamask/multichain-network-controller":2279},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNetworkServiceInit=void 0;var r=e("@metamask/multichain-network-controller");n.MultichainNetworkServiceInit=()=>new r.MultichainNetworkService({fetch:window.fetch.bind(window)})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-network-service-init.ts"}],[171,{"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainAssetsRatesControllerInit=void 0;var r=e("@metamask/assets-controllers");n.MultichainAssetsRatesControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.MultichainAssetsRatesController({messenger:e,state:t.MultichainAssetsRatesController,interval:18e4})})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-rates-assets-controller-init.ts"}],[172,{"@metamask/multichain-transactions-controller":2284},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainTransactionsControllerInit=void 0;var r=e("@metamask/multichain-transactions-controller");n.MultichainTransactionsControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.MultichainTransactionsController({messenger:e,state:t.MultichainTransactionsController})})}}},{package:"$root$",file:"app/scripts/controller-init/multichain/multichain-transactions-controller-init.ts"}],[173,{"../../../shared/constants/network":5772,"../../../shared/constants/time":5790,"../../../shared/lib/network-utils":5863,"../../../shared/lib/sentry":5866,"../lib/network-controller/messenger-action-handlers":289,"@metamask/controller-utils":1384,"@metamask/network-controller":2299,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkControllerInit=n.ADDITIONAL_DEFAULT_NETWORKS=void 0;var r=e("@metamask/network-controller"),s=e("@metamask/controller-utils"),a=e("@metamask/utils"),i=e("../../../shared/constants/time"),o=e("../../../shared/lib/network-utils"),c=e("../lib/network-controller/messenger-action-handlers"),l=e("../../../shared/constants/network"),u=e("../../../shared/lib/sentry");const d=n.ADDITIONAL_DEFAULT_NETWORKS=[s.ChainId["monad-testnet"]];n.NetworkControllerInit=({controllerMessenger:e,infuraProjectId:t,initMessenger:n,persistedState:h})=>{const m=n.call("RemoteFeatureFlagController:getState"),g=function(e){let t=e;if(!t){var n,i,o,c;t=(0,r.getDefaultNetworkControllerState)(d);const e=t.networkConfigurationsByChainId??{};let u;e["0x18c7"]={chainId:"0x18c7",name:"MegaETH Testnet",nativeCurrency:"MegaETH",blockExplorerUrls:["https://megaeth-testnet-v2.blockscout.com"],defaultRpcEndpointIndex:0,defaultBlockExplorerUrlIndex:0,rpcEndpoints:[{networkClientId:"megaeth-testnet-v2",url:"https://timothy.megaeth.com/rpc",type:r.RpcEndpointType.Custom,failoverUrls:[]}]},Object.values(e).forEach(e=>{const t=e.rpcEndpoints[0].networkClientId;(0,a.hasProperty)(s.BlockExplorerUrl,t)&&(e.blockExplorerUrls=[s.BlockExplorerUrl[t]]),e.defaultBlockExplorerUrlIndex=0}),e[l.CHAIN_IDS.MAINNET].rpcEndpoints[0].failoverUrls=(0,l.getFailoverUrlsForInfuraNetwork)("ethereum-mainnet"),e[l.CHAIN_IDS.LINEA_MAINNET].rpcEndpoints[0].failoverUrls=(0,l.getFailoverUrlsForInfuraNetwork)("linea-mainnet"),e[l.CHAIN_IDS.BASE].rpcEndpoints[0].failoverUrls=(0,l.getFailoverUrlsForInfuraNetwork)("base-mainnet"),null!==(n=e[l.CHAIN_IDS.ARBITRUM])&&void 0!==n&&null!==(n=n.rpcEndpoints)&&void 0!==n&&n[0]&&(e[l.CHAIN_IDS.ARBITRUM].rpcEndpoints[0].failoverUrls=(0,l.getFailoverUrlsForInfuraNetwork)("arbitrum-mainnet")),null!==(i=e[l.CHAIN_IDS.BSC])&&void 0!==i&&null!==(i=i.rpcEndpoints)&&void 0!==i&&i[0]&&(e[l.CHAIN_IDS.BSC].rpcEndpoints[0].failoverUrls=(0,l.getFailoverUrlsForInfuraNetwork)("bsc-mainnet")),null!==(o=e[l.CHAIN_IDS.OPTIMISM])&&void 0!==o&&null!==(o=o.rpcEndpoints)&&void 0!==o&&o[0]&&(e[l.CHAIN_IDS.OPTIMISM].rpcEndpoints[0].failoverUrls=(0,l.getFailoverUrlsForInfuraNetwork)("optimism-mainnet")),null!==(c=e[l.CHAIN_IDS.POLYGON])&&void 0!==c&&null!==(c=c.rpcEndpoints)&&void 0!==c&&c[0]&&(e[l.CHAIN_IDS.POLYGON].rpcEndpoints[0].failoverUrls=(0,l.getFailoverUrlsForInfuraNetwork)("polygon-mainnet")),e[l.CHAIN_IDS.MAINNET].name="Ethereum",e[l.CHAIN_IDS.LINEA_MAINNET].name="Linea",e[l.CHAIN_IDS.BASE].name="Base",e[l.CHAIN_IDS.ARBITRUM].name="Arbitrum",e[l.CHAIN_IDS.BSC].name="BNB Chain",e[l.CHAIN_IDS.OPTIMISM].name="OP",e[l.CHAIN_IDS.POLYGON].name="Polygon",delete e[l.CHAIN_IDS.SEI],u=e[l.CHAIN_IDS.MAINNET],t.selectedNetworkClientId=u.rpcEndpoints[u.defaultRpcEndpointIndex].networkClientId}return t.networkConfigurationsByChainId&&!Object.values(t.networkConfigurationsByChainId).flatMap(e=>e.rpcEndpoints.map(e=>e.networkClientId)).includes(t.selectedNetworkClientId)&&((0,u.captureException)(new Error(`NetworkController state is invalid: \`selectedNetworkClientId\` '${t.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration`)),t.selectedNetworkClientId=t.networkConfigurationsByChainId[l.CHAIN_IDS.MAINNET].rpcEndpoints[0].networkClientId),t}(h.NetworkController),p=e=>e.remoteFeatureFlags.walletFrameworkRpcFailoverEnabled??!1,f=new r.NetworkController({messenger:e,state:g,infuraProjectId:t,getBlockTrackerOptions:()=>({pollingInterval:20*i.SECOND,retryTimeout:20*i.SECOND}),getRpcServiceOptions:e=>{const t=s.DEFAULT_MAX_RETRIES,n={fetch:globalThis.fetch.bind(globalThis),btoa:globalThis.btoa.bind(globalThis)},r={circuitBreakDuration:30*i.SECOND,maxRetries:t};return(0,o.getIsQuicknodeEndpointUrl)(e)?{...n,policyOptions:{...r,maxConsecutiveFailures:10*(t+1)}}:{...n,policyOptions:{...r,maxConsecutiveFailures:3*(t+1)}}},additionalDefaultNetworks:d,isRpcFailoverEnabled:p(m)});return n.subscribe("NetworkController:rpcEndpointUnavailable",async({chainId:e,endpointUrl:r,error:s})=>{(0,c.onRpcEndpointUnavailable)({chainId:e,endpointUrl:r,error:s,infuraProjectId:t,trackEvent:n.call.bind(n,"MetaMetricsController:trackEvent"),metaMetricsId:n.call("MetaMetricsController:getMetaMetricsId")})}),n.subscribe("NetworkController:rpcEndpointDegraded",async({chainId:e,endpointUrl:r,error:s})=>{(0,c.onRpcEndpointDegraded)({chainId:e,endpointUrl:r,error:s,infuraProjectId:t,trackEvent:n.call.bind(n,"MetaMetricsController:trackEvent"),metaMetricsId:n.call("MetaMetricsController:getMetaMetricsId")})}),n.subscribe("RemoteFeatureFlagController:stateChange",e=>{e?(console.log("Enabling RPC failover."),f.enableRpcFailover()):(console.log("Disabling RPC failover."),f.disableRpcFailover())},p),f.initializeProvider({lookupNetwork:!1}),{controller:f}}}}},{package:"$root$",file:"app/scripts/controller-init/network-controller-init.ts"}],[174,{"../../../../package.json":5748,"@metamask/notification-services-controller/notification-services":2320},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NotificationServicesControllerInit=void 0;var r,s=e("@metamask/notification-services-controller/notification-services");const a=((r=e("../../../../package.json"))&&r.__esModule?r:{default:r}).default.version;n.NotificationServicesControllerInit=({controllerMessenger:e,persistedState:t,getController:n})=>({controller:new s.Controller({messenger:e,state:t.NotificationServicesController,env:{featureAnnouncements:{platform:"extension",spaceId:"jdkgyfmyd9sw",accessToken:"mAYNB_k65snv4AXW4o8ksZN8BwWDQF9702HKV7yBDZI",platformVersion:a},locale:()=>n("PreferencesController").state.currentLocale.replace("_","-")}})})}}},{package:"$root$",file:"app/scripts/controller-init/notifications/notification-services-controller-init.ts"}],[175,{"../../../../shared/constants/metametrics":5768,"../../../../shared/modules/mv3.utils":5899,"../../controllers/push-notifications":237,"@metamask/notification-services-controller/push-services":2341,"@metamask/notification-services-controller/push-services/web":2349,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNormalisedLocale=n.NotificationServicesPushControllerInit=void 0;var r=e("@metamask/notification-services-controller/push-services"),s=e("@metamask/notification-services-controller/push-services/web"),a=e("@metamask/utils"),i=e("../../../../shared/modules/mv3.utils"),o=e("../../controllers/push-notifications"),c=e("../../../../shared/constants/metametrics");const l=e=>e.replace("_","-");n.getNormalisedLocale=l;n.NotificationServicesPushControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n,getController:u})=>{const d=new r.Controller({messenger:e,state:{...r.defaultState,...n.NotificationServicesPushController},env:{apiKey:"AIzaSyAA6MJdRkQ00zNh_moTLwxCSxcg3vznbBM",authDomain:"notifications-faf39.firebaseapp.com",storageBucket:"notifications-faf39.appspot.com",projectId:"notifications-faf39",messagingSenderId:"824598429541",appId:"1:824598429541:web:3016d3c90f1f19a6beab8c",measurementId:"G-1FGDTTCWX5",vapidKey:"BBbjhCfHvwIqRsUrBvpfx0viLJIzWHp-beyw8-I124jeZlhNGDOegS_0_I029fFb2stzRuaNkCdTAf9F3I2m3wc"},config:{isPushFeatureEnabled:i.isManifestV3&&!0,platform:"extension",pushService:{createRegToken:s.createRegToken,deleteRegToken:s.deleteRegToken,subscribeToPushNotifications:(0,s.createSubscribeToPushNotifications)({messenger:e,onReceivedHandler:o.onPushNotificationReceived,onClickHandler:o.onPushNotificationClicked})},getLocale:()=>l(u("PreferencesController").state.currentLocale)}});return t.subscribe("NotificationServicesPushController:onNewNotifications",e=>{const n=(0,a.hasProperty)(e,"chain_id")?e.chain_id:null;t.call("MetaMetricsController:trackEvent",{category:c.MetaMetricsEventCategory.PushNotifications,event:c.MetaMetricsEventName.PushNotificationReceived,properties:{notification_id:e.id,notification_type:e.type,chain_id:n}})}),t.subscribe("NotificationServicesPushController:pushNotificationClicked",e=>{var n;t.call("MetaMetricsController:trackEvent",{category:c.MetaMetricsEventCategory.PushNotifications,event:c.MetaMetricsEventName.PushNotificationClicked,properties:{notification_id:e.id,notification_type:e.type,..."notification_type"in e&&"on-chain"===e.notification_type&&null!==(n=e.payload)&&void 0!==n&&n.chain_id?{chain_id:e.payload.chain_id}:undefined,data:e}})}),{controller:d}}}}},{package:"$root$",file:"app/scripts/controller-init/notifications/notification-services-push-controller-init.ts"}],[176,{"../controllers/onboarding":226},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnboardingControllerInit=void 0;var r,s=(r=e("../controllers/onboarding"))&&r.__esModule?r:{default:r};n.OnboardingControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new s.default({state:t.OnboardingController,messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/onboarding-controller-init.ts"}],[177,{"../controllers/permissions":230,"../controllers/permissions/snaps/specifications":232,"@metamask/permission-controller":2401},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PermissionControllerInit=void 0;var r=e("@metamask/permission-controller"),s=e("../controllers/permissions"),a=e("../controllers/permissions/snaps/specifications");n.PermissionControllerInit=({controllerMessenger:e,persistedState:t,initMessenger:n,getController:i})=>{const o=i("ApprovalController"),c=i("KeyringController");return{controller:new r.PermissionController({state:t.PermissionController,messenger:e,caveatSpecifications:(0,s.getCaveatSpecifications)({listAccounts:n.call.bind(n,"AccountsController:listAccounts"),findNetworkClientIdByChainId:n.call.bind(n,"NetworkController:findNetworkClientIdByChainId"),isNonEvmScopeSupported:n.call.bind(n,"MultichainRouter:isSupportedScope"),getNonEvmAccountAddresses:n.call.bind(n,"MultichainRouter:getSupportedAccounts")}),permissionSpecifications:{...(0,s.getPermissionSpecifications)(),...(0,a.getSnapPermissionSpecifications)(n,{addAndShowApprovalRequest:o.addAndShowApprovalRequest.bind(o),addNewKeyring:c.addNewKeyring.bind(c)})},unrestrictedMethods:s.unrestrictedMethods})}}}}},{package:"$root$",file:"app/scripts/controller-init/permission-controller-init.ts"}],[1772,{"@metamask/keyring-controller":2183},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.GetCallsStatusCode=n.EIP7682ErrorCode=n.EIP5792ErrorCode=n.SupportedCapabilities=n.MessageType=n.KEYRING_TYPES_SUPPORTING_7702=n.VERSION=void 0;const r=e("@metamask/keyring-controller");var s,a,i,o,c;n.VERSION="2.0.0",n.KEYRING_TYPES_SUPPORTING_7702=[r.KeyringTypes.hd,r.KeyringTypes.simple],function(e){e.SendTransaction="eth_sendTransaction"}(s||(n.MessageType=s={})),function(e){e.AuxiliaryFunds="auxiliaryFunds"}(a||(n.SupportedCapabilities=a={})),function(e){e[e.UnsupportedNonOptionalCapability=5700]="UnsupportedNonOptionalCapability",e[e.UnsupportedChainId=5710]="UnsupportedChainId",e[e.UnknownBundleId=5730]="UnknownBundleId",e[e.RejectedUpgrade=5750]="RejectedUpgrade"}(i||(n.EIP5792ErrorCode=i={})),function(e){e[e.UnsupportedAsset=5771]="UnsupportedAsset",e[e.UnsupportedChain=5772]="UnsupportedChain",e[e.MalformedRequiredAssets=5773]="MalformedRequiredAssets"}(o||(n.EIP7682ErrorCode=o={})),function(e){e[e.PENDING=100]="PENDING",e[e.CONFIRMED=200]="CONFIRMED",e[e.FAILED_OFFCHAIN=400]="FAILED_OFFCHAIN",e[e.REVERTED=500]="REVERTED",e[e.REVERTED_PARTIAL=600]="REVERTED_PARTIAL"}(c||(n.GetCallsStatusCode=c={}))}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/constants.cjs"}],[1773,{"../constants.cjs":1772,"@metamask/rpc-errors":2594,"@metamask/transaction-controller":1805},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getCallsStatus=void 0;const r=e("@metamask/rpc-errors"),s=e("@metamask/transaction-controller"),a=e("../constants.cjs");n.getCallsStatus=function(e,t){const n=e.call("TransactionController:getState").transactions.filter(e=>e.batchId===t);if(!n?.length)throw new r.JsonRpcError(a.EIP5792ErrorCode.UnknownBundleId,"No matching bundle found");const i=n[0],{chainId:o,txReceipt:c}=i,l=function(e){const{hash:t,status:n}=e;if(n===s.TransactionStatus.confirmed)return a.GetCallsStatusCode.CONFIRMED;if(n===s.TransactionStatus.failed)return t?a.GetCallsStatusCode.REVERTED:a.GetCallsStatusCode.FAILED_OFFCHAIN;if(n===s.TransactionStatus.dropped)return a.GetCallsStatusCode.REVERTED;return a.GetCallsStatusCode.PENDING}(i),u=c,d=u?.logs??[],h=u&&[{blockHash:u.blockHash,blockNumber:u.blockNumber,gasUsed:u.gasUsed,logs:d.map(e=>({address:e.address,data:e.data,topics:e.topics})),status:u.status,transactionHash:u.transactionHash}];return{version:a.VERSION,id:t,chainId:o,atomic:!0,status:l,receipts:h}}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/hooks/getCallsStatus.cjs"}],[1774,{"../constants.cjs":1772,"../utils.cjs":1781},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getCapabilities=void 0;const r=e("../constants.cjs"),s=e("../utils.cjs");n.getCapabilities=async function(e,t,n,a){const{getDismissSmartAccountSuggestionEnabled:i,getIsSmartTransaction:o,isAtomicBatchSupported:c,isRelaySupported:l,getSendBundleSupportedChains:u,isAuxiliaryFundsSupported:d}=e;let h=a?.map(e=>e.toLowerCase());if(!h?.length){const e=t.call("NetworkController:getState").networkConfigurationsByChainId;h=Object.keys(e)}const m=await c({address:n,chainIds:h}),g=await async function(e,t,n,r,s,a){const i=a.call("PreferencesController:getState").useTransactionSimulations,o=await Promise.all(t.map(({chainId:e})=>e).map(e=>r(e))),c=await s(e),l=t.map((e,t)=>({...e,relaySupportedForChain:o[t]}));return e.reduce((e,t)=>{const r=l.find(({chainId:e})=>e===t)??{},{isSupported:s=!1,relaySupportedForChain:a}=r,o=n(t),u=c[t]??!1;return i&&(o&&u||s&&a)&&(e[t]={alternateGasFees:{supported:!0}}),e},{})}(h,m,o,l,u,t);return h.reduce((e,a)=>{const o=m.find(({chainId:e})=>e===a)??{},{delegationAddress:c,isSupported:l,upgradeContractAddress:u}=o,h=i();let g=!1;try{const e=(0,s.getAccountKeyringType)(n,t);g=r.KEYRING_TYPES_SUPPORTING_7702.includes(e)}catch{}if(!l&&!(!h&&u&&!c&&g))return e;const p=l?"supported":"ready",f=a;return e[f]===undefined&&(e[f]={}),e[f].atomic={status:p},g&&d(a)&&(e[f].auxiliaryFunds={supported:!0}),e},g)}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/hooks/getCapabilities.cjs"}],[1775,{"../constants.cjs":1772,"../utils.cjs":1781,"@metamask/rpc-errors":2594,"@metamask/transaction-controller":1805,"@metamask/utils":3070,lodash:4794,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.processSendCalls=void 0;const r=e("@metamask/rpc-errors"),s=e("@metamask/transaction-controller"),a=e("@metamask/utils"),i=e("lodash"),o=e("uuid"),c=e("../constants.cjs"),l=e("../utils.cjs");function u(e){const{version:t}=e;if(t!==c.VERSION)throw r.rpcErrors.invalidInput(`Version not supported: Got ${t}, expected ${c.VERSION}`)}function d(e,t){const{chainId:n}=e;if(n&&n.toLowerCase()!==t.toLowerCase())throw r.rpcErrors.invalidParams(`Chain ID must match the dApp selected network: Got ${n}, expected ${t}`)}function h(e,t,n){const{calls:s,capabilities:a,chainId:i}=e,o=[...Object.keys(a??{}).filter(e=>e!==c.SupportedCapabilities.AuxiliaryFunds.toString()&&!0!==a?.[e].optional),...s.flatMap(e=>Object.keys(e.capabilities??{}).filter(t=>t!==c.SupportedCapabilities.AuxiliaryFunds.toString()&&!0!==e.capabilities?.[t].optional))];if(o?.length)throw new r.JsonRpcError(c.EIP5792ErrorCode.UnsupportedNonOptionalCapability,`Unsupported non-optional capabilities: ${o.join(", ")}`);a?.auxiliaryFunds&&function({auxiliaryFunds:e,chainId:t,keyringType:n,isAuxiliaryFundsSupported:s}){if(e.optional)return;const a=c.KEYRING_TYPES_SUPPORTING_7702.includes(n);if(!a)throw new r.JsonRpcError(c.EIP5792ErrorCode.UnsupportedNonOptionalCapability,`Unsupported non-optional capability: ${c.SupportedCapabilities.AuxiliaryFunds}`);if(!s(t))throw new r.JsonRpcError(c.EIP7682ErrorCode.UnsupportedChain,`The wallet no longer supports auxiliary funds on the requested chain: ${t}`);if(!e?.requiredAssets)return;for(const t of e.requiredAssets)if("erc20"!==t.standard)throw new r.JsonRpcError(c.EIP7682ErrorCode.UnsupportedAsset,`The requested asset ${t.address} is not available through the wallets auxiliary fund system: unsupported token standard ${t.standard}`)}({auxiliaryFunds:a.auxiliaryFunds,chainId:i,keyringType:t,isAuxiliaryFundsSupported:n})}function m(e){if(e.capabilities?.auxiliaryFunds?.requiredAssets){const{requiredAssets:t}=e.capabilities.auxiliaryFunds,n=(0,i.groupBy)(t,e=>`${e.address.toLowerCase()}-${e.standard}`),r=Object.values(n).map(e=>{if(1===e.length)return e[0];const t=e.reduce((e,t)=>e+BigInt(t.amount),0n);return{...e[0],amount:(0,a.add0x)(t.toString(16))}});e.capabilities.auxiliaryFunds.requiredAssets=r}}n.processSendCalls=async function(e,t,n,i){const{addTransactionBatch:g,addTransaction:p,getDismissSmartAccountSuggestionEnabled:f,isAtomicBatchSupported:b,validateSecurity:w,isAuxiliaryFundsSupported:C}=e,{calls:k,from:y}=n,{networkClientId:T,origin:v}=i,S=k.map(e=>({params:e})),{chainId:P}=t.call("NetworkController:getNetworkClientById",T).configuration,I=y??t.call("AccountsController:getSelectedAccount").address,M=(0,o.v4)(),E=w.bind(null,M);let A;return A=1===Object.keys(S).length?await async function({addTransaction:e,chainId:t,from:n,messenger:r,networkClientId:i,origin:g,securityAlertId:p,sendCalls:f,transactions:b,validateSecurity:w,isAuxiliaryFundsSupported:C}){const k=(0,l.getAccountKeyringType)(n,r);!function(e,t,n,r){u(e),h(e,n,r),d(e,t)}(f,t,k,C);const y={from:n,...b[0].params,type:s.TransactionEnvelopeType.feeMarket},T={method:c.MessageType.SendTransaction,params:[y],origin:g};w(T,t),m(f);const v=function(){const e=(0,o.v4)(),t=new Uint8Array((0,o.parse)(e));return(0,a.bytesToHex)(t)}();return await e(y,{networkClientId:i,origin:g,securityAlertResponse:{securityAlertId:p},batchId:v}),v}({addTransaction:p,chainId:P,from:I,messenger:t,networkClientId:T,origin:v,securityAlertId:M,sendCalls:n,transactions:S,validateSecurity:E,isAuxiliaryFundsSupported:C}):await async function({addTransactionBatch:e,isAtomicBatchSupported:t,chainId:n,from:s,getDismissSmartAccountSuggestionEnabled:a,networkClientId:i,messenger:o,origin:g,sendCalls:p,securityAlertId:f,transactions:b,validateSecurity:w,isAuxiliaryFundsSupported:C}){const k=await t({address:s,chainIds:[n]}),y=k?.[0],T=(0,l.getAccountKeyringType)(s,o),v=a();(function(e,t,n,s,a,i){u(e),function(e,t,n){if(d(e,t),!n)throw new r.JsonRpcError(c.EIP5792ErrorCode.UnsupportedChainId,`EIP-7702 not supported on chain: ${t}`)}(e,t,s),h(e,a,i),function(e,t,n){if(t?.delegationAddress)return;if(e)throw new r.JsonRpcError(c.EIP5792ErrorCode.RejectedUpgrade,"EIP-7702 upgrade disabled by the user");if(!c.KEYRING_TYPES_SUPPORTING_7702.includes(n))throw new r.JsonRpcError(c.EIP5792ErrorCode.RejectedUpgrade,"EIP-7702 upgrade not supported on account")}(n,s,a)})(p,n,v,y,T,C),m(p);const S=await e({from:s,networkClientId:i,origin:g,securityAlertId:f,transactions:b,validateSecurity:w});return S.batchId}({addTransactionBatch:g,isAtomicBatchSupported:b,chainId:P,from:I,getDismissSmartAccountSuggestionEnabled:f,messenger:t,networkClientId:T,origin:v,sendCalls:n,securityAlertId:M,transactions:S,validateSecurity:E,isAuxiliaryFundsSupported:C}),{id:A}}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/hooks/processSendCalls.cjs"}],[1776,{"./hooks/getCallsStatus.cjs":1773,"./hooks/getCapabilities.cjs":1774,"./hooks/processSendCalls.cjs":1775,"./methods/wallet_getCallsStatus.cjs":1777,"./methods/wallet_getCapabilities.cjs":1778,"./methods/wallet_sendCalls.cjs":1779},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.walletGetCapabilities=n.walletGetCallsStatus=n.walletSendCalls=n.getCapabilities=n.getCallsStatus=n.processSendCalls=void 0;var r=e("./hooks/processSendCalls.cjs");Object.defineProperty(n,"processSendCalls",{enumerable:!0,get:function(){return r.processSendCalls}});var s=e("./hooks/getCallsStatus.cjs");Object.defineProperty(n,"getCallsStatus",{enumerable:!0,get:function(){return s.getCallsStatus}});var a=e("./hooks/getCapabilities.cjs");Object.defineProperty(n,"getCapabilities",{enumerable:!0,get:function(){return a.getCapabilities}});var i=e("./methods/wallet_sendCalls.cjs");Object.defineProperty(n,"walletSendCalls",{enumerable:!0,get:function(){return i.walletSendCalls}});var o=e("./methods/wallet_getCallsStatus.cjs");Object.defineProperty(n,"walletGetCallsStatus",{enumerable:!0,get:function(){return o.walletGetCallsStatus}});var c=e("./methods/wallet_getCapabilities.cjs");Object.defineProperty(n,"walletGetCapabilities",{enumerable:!0,get:function(){return c.walletGetCapabilities}})}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/index.cjs"}],[1777,{"../types.cjs":1780,"../utils.cjs":1781,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.walletGetCallsStatus=void 0;const r=e("@metamask/rpc-errors"),s=e("../types.cjs"),a=e("../utils.cjs");n.walletGetCallsStatus=async function(e,t,{getCallsStatus:n}){if(!n)throw r.rpcErrors.methodNotSupported();(0,a.validateParams)(e.params,s.GetCallsStatusStruct);const i=e.params[0];t.result=await n(i,e)}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/methods/wallet_getCallsStatus.cjs"}],[1778,{"../types.cjs":1780,"../utils.cjs":1781,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.walletGetCapabilities=void 0;const r=e("@metamask/rpc-errors"),s=e("../types.cjs"),a=e("../utils.cjs");n.walletGetCapabilities=async function(e,t,{getAccounts:n,getCapabilities:i}){if(!i)throw r.rpcErrors.methodNotSupported();(0,a.validateParams)(e.params,s.GetCapabilitiesStruct);const o=e.params[0],c=e.params[1];await(0,a.validateAndNormalizeKeyholder)(o,e,{getAccounts:n});const l=await i(o,c,e);t.result=l}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/methods/wallet_getCapabilities.cjs"}],[1779,{"../types.cjs":1780,"../utils.cjs":1781,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.walletSendCalls=void 0;const r=e("@metamask/rpc-errors"),s=e("../types.cjs"),a=e("../utils.cjs");n.walletSendCalls=async function(e,t,{getAccounts:n,processSendCalls:i}){if(!i)throw r.rpcErrors.methodNotSupported();(0,a.validateParams)(e.params,s.SendCallsStruct);const o=e.params[0],c=o.from?await(0,a.validateAndNormalizeKeyholder)(o.from,e,{getAccounts:n}):undefined,l={...o,from:c};t.result=await i(l,e)}}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/methods/wallet_sendCalls.cjs"}],[178,{"../../../shared/constants/permissions":5776,"@metamask/permission-log-controller":2410},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PermissionLogControllerInit=void 0;var r=e("@metamask/permission-log-controller"),s=e("../../../shared/constants/permissions");n.PermissionLogControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.PermissionLogController({messenger:e,state:t.PermissionLogController,restrictedMethods:new Set(Object.keys(s.RestrictedMethods))})})}}},{package:"$root$",file:"app/scripts/controller-init/permission-log-controller-init.ts"}],[1780,{"@metamask/superstruct":2931,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SendCallsStruct=n.CapabilitiesStruct=n.GetCapabilitiesStruct=n.GetCallsStatusStruct=void 0;const r=e("@metamask/superstruct"),s=e("@metamask/utils");n.GetCallsStatusStruct=(0,r.tuple)([s.StrictHexStruct]),n.GetCapabilitiesStruct=(0,r.tuple)([s.HexChecksumAddressStruct,(0,r.optional)((0,r.array)(s.StrictHexStruct))]);const a=(0,r.type)({address:(0,r.nonempty)(s.HexChecksumAddressStruct),amount:(0,r.nonempty)(s.StrictHexStruct),standard:(0,r.nonempty)((0,r.string)())});n.CapabilitiesStruct=(0,r.record)((0,r.string)(),(0,r.type)({optional:(0,r.optional)((0,r.boolean)()),requiredAssets:(0,r.optional)((0,r.array)(a))})),n.SendCallsStruct=(0,r.tuple)([(0,r.object)({version:(0,r.nonempty)((0,r.string)()),id:(0,r.optional)(s.StrictHexStruct),from:(0,r.optional)(s.HexChecksumAddressStruct),chainId:s.StrictHexStruct,atomicRequired:(0,r.boolean)(),calls:(0,r.array)((0,r.object)({to:(0,r.optional)(s.HexChecksumAddressStruct),data:(0,r.optional)(s.StrictHexStruct),value:(0,r.optional)(s.StrictHexStruct),capabilities:(0,r.optional)(n.CapabilitiesStruct)})),capabilities:(0,r.optional)(n.CapabilitiesStruct)})])}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/types.cjs"}],[1781,{"./constants.cjs":1772,"@metamask/rpc-errors":2594,"@metamask/superstruct":2931},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.resemblesAddress=n.validateParams=n.validateAndNormalizeKeyholder=n.getAccountKeyringType=void 0;const r=e("@metamask/rpc-errors"),s=e("@metamask/superstruct"),a=e("./constants.cjs");function i(e){return 42===e.length}n.getAccountKeyringType=function(e,t){const{accounts:n}=t.call("AccountsController:getState").internalAccounts,s=Object.values(n).find(t=>t.address.toLowerCase()===e.toLowerCase()),i=s?.metadata?.keyring?.type;if(!i)throw new r.JsonRpcError(a.EIP5792ErrorCode.RejectedUpgrade,"EIP-7702 upgrade not supported as account type is unknown");return i},n.validateAndNormalizeKeyholder=async function(e,t,{getAccounts:n}){if("string"==typeof e&&e.length>0&&i(e)){const s=(await n(t)).map(e=>e.toLowerCase()),a=e.toLowerCase();if(s.includes(a))return a;throw r.providerErrors.unauthorized()}throw r.rpcErrors.invalidParams({message:"Invalid parameters: must provide an Ethereum address."})},n.validateParams=function(e,t){const[n]=(0,s.validate)(e,t);if(n)throw r.rpcErrors.invalidParams(function(e,t){return`${t}\n\n${e.failures().map(e=>`${e.path.join(" > ")}${e.path.length?" - ":""}${e.message}`).join("\n")}`}(n,"Invalid params"))},n.resemblesAddress=i}}},{package:"@metamask/eip-5792-middleware",file:"node_modules/@metamask/eip-5792-middleware/dist/utils.cjs"}],[1782,{"./gas-flows/DefaultGasFeeFlow.cjs":1787,"./gas-flows/LineaGasFeeFlow.cjs":1788,"./gas-flows/OptimismLayer1GasFeeFlow.cjs":1789,"./gas-flows/RandomisedEstimationsGasFeeFlow.cjs":1791,"./gas-flows/ScrollLayer1GasFeeFlow.cjs":1792,"./gas-flows/TestGasFeeFlow.cjs":1793,"./helpers/AccountsApiRemoteTransactionSource.cjs":1794,"./helpers/GasFeePoller.cjs":1795,"./helpers/IncomingTransactionHelper.cjs":1796,"./helpers/MethodDataHelper.cjs":1797,"./helpers/MultichainTrackingHelper.cjs":1798,"./helpers/PendingTransactionTracker.cjs":1799,"./helpers/ResimulateHelper.cjs":1800,"./hooks/ExtraTransactionsPublishHook.cjs":1803,"./logger.cjs":1806,"./types.cjs":1807,"./utils/balance-changes.cjs":1808,"./utils/batch.cjs":1809,"./utils/eip7702.cjs":1810,"./utils/external-transactions.cjs":1811,"./utils/first-time-interaction.cjs":1813,"./utils/gas-fee-tokens.cjs":1814,"./utils/gas-fees.cjs":1815,"./utils/gas-flow.cjs":1816,"./utils/gas.cjs":1817,"./utils/history.cjs":1818,"./utils/layer1-gas-fee-flow.cjs":1819,"./utils/nonce.cjs":1820,"./utils/prepare.cjs":1821,"./utils/retry.cjs":1822,"./utils/swaps.cjs":1824,"./utils/transaction-type.cjs":1825,"./utils/utils.cjs":1826,"./utils/validation.cjs":1827,"@metamask/base-controller":1311,"@metamask/controller-utils":1384,"@metamask/eth-query":1972,"@metamask/network-controller":2299,"@metamask/nonce-tracker":2310,"@metamask/rpc-errors":2594,"@metamask/utils":3070,events:4338,lodash:4794,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g,p,f,b,w,C,k,y,T,v,S,P,I,M,E,A,_,j,F,x,N,O,D,R,L,G,B,U,$,H,W,K,q,z,V,Y,Q,J,X,Z,ee,te,ne,re,se,ae,ie,oe,ce,le,ue,de,he,me,ge,pe,fe,be,we,Ce,ke,ye,Te,ve,Se,Pe,Ie,Me,Ee,Ae,_e,je,Fe,xe,Ne,Oe,De,Re,Le,Ge,Be,Ue,$e,He,We,Ke,qe,ze,Ve,Ye,Qe,Je,Xe,Ze,et,tt=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},nt=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},rt=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionController=n.ApprovalState=n.SPEED_UP_RATE=n.CANCEL_RATE=void 0;const st=e("@metamask/base-controller"),at=e("@metamask/controller-utils"),it=rt(e("@metamask/eth-query")),ot=e("@metamask/network-controller"),ct=e("@metamask/nonce-tracker"),lt=e("@metamask/rpc-errors"),ut=e("@metamask/utils"),dt=e("events"),ht=e("lodash"),mt=e("uuid"),gt=e("./gas-flows/DefaultGasFeeFlow.cjs"),pt=e("./gas-flows/LineaGasFeeFlow.cjs"),ft=e("./gas-flows/OptimismLayer1GasFeeFlow.cjs"),bt=e("./gas-flows/RandomisedEstimationsGasFeeFlow.cjs"),wt=e("./gas-flows/ScrollLayer1GasFeeFlow.cjs"),Ct=e("./gas-flows/TestGasFeeFlow.cjs"),kt=e("./helpers/AccountsApiRemoteTransactionSource.cjs"),yt=e("./helpers/GasFeePoller.cjs"),Tt=e("./helpers/IncomingTransactionHelper.cjs"),vt=e("./helpers/MethodDataHelper.cjs"),St=e("./helpers/MultichainTrackingHelper.cjs"),Pt=e("./helpers/PendingTransactionTracker.cjs"),It=e("./helpers/ResimulateHelper.cjs"),Mt=e("./hooks/ExtraTransactionsPublishHook.cjs"),Et=e("./logger.cjs"),At=e("./types.cjs"),_t=e("./utils/balance-changes.cjs"),jt=e("./utils/batch.cjs"),Ft=e("./utils/eip7702.cjs"),xt=e("./utils/external-transactions.cjs"),Nt=e("./utils/first-time-interaction.cjs"),Ot=e("./utils/gas.cjs"),Dt=e("./utils/gas-fee-tokens.cjs"),Rt=e("./utils/gas-fees.cjs"),Lt=e("./utils/gas-flow.cjs"),Gt=e("./utils/history.cjs"),Bt=e("./utils/layer1-gas-fee-flow.cjs"),Ut=e("./utils/nonce.cjs"),$t=e("./utils/prepare.cjs"),Ht=e("./utils/retry.cjs"),Wt=e("./utils/swaps.cjs"),Kt=e("./utils/transaction-type.cjs"),qt=e("./utils/utils.cjs"),zt=e("./utils/validation.cjs"),Vt={transactions:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},transactionBatches:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},methodData:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},lastFetchedBlockNumbers:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},submitHistory:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}};n.CANCEL_RATE=1.1,n.SPEED_UP_RATE=1.1;const Yt="TransactionController";var Qt;!function(e){e.Approved="approved",e.NotApproved="not-approved",e.SkippedViaBeforePublishHook="skipped-via-before-publish-hook"}(Qt||(n.ApprovalState=Qt={}));class Jt extends st.BaseController{constructor(e){const{disableHistory:t,disableSendFlowHistory:n,disableSwaps:K,getCurrentAccountEIP1559Compatibility:q,getCurrentNetworkEIP1559Compatibility:z,getExternalPendingTransactions:V,getGasFeeEstimates:Q,getNetworkClientRegistry:J,getNetworkState:X,getPermittedAccounts:Z,getSavedGasFees:ee,getSimulationConfig:ne,hooks:re,incomingTransactions:se={},isAutomaticGasFeeUpdateEnabled:ae,isEIP7702GasFeeTokensEnabled:ie,isFirstTimeInteractionEnabled:oe,isSimulationEnabled:ce,messenger:le,pendingTransactions:ue={},publicKeyEIP7702:de,securityProviderRequest:me,sign:ge,state:pe,testGasFeeFlows:fe,trace:be,transactionHistoryLimit:we=40}=e;super({name:Yt,metadata:Vt,messenger:le,state:{methodData:{},transactions:[],transactionBatches:[],lastFetchedBlockNumbers:{},submitHistory:[],...pe}}),r.add(this),s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,new Set),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),m.set(this,void 0),g.set(this,void 0),p.set(this,void 0),f.set(this,void 0),b.set(this,void 0),w.set(this,void 0),C.set(this,void 0),k.set(this,void 0),y.set(this,void 0),T.set(this,void 0),v.set(this,new dt.EventEmitter),S.set(this,void 0),P.set(this,void 0),I.set(this,void 0),M.set(this,void 0),E.set(this,void 0),A.set(this,void 0),_.set(this,void 0),j.set(this,void 0),F.set(this,void 0),x.set(this,void 0),N.set(this,void 0),O.set(this,void 0),D.set(this,void 0),R.set(this,void 0),L.set(this,void 0),G.set(this,void 0),B.set(this,new Map),U.set(this,new Set),$.set(this,void 0),H.set(this,void 0),W.set(this,void 0),Ae.set(this,()=>{nt(this,x,"f").checkForPendingTransactionAndStartPolling()}),this.messenger=le,tt(this,s,re?.afterAdd??(()=>Promise.resolve({})),"f"),tt(this,a,re?.afterSign??(()=>!0),"f"),tt(this,i,re?.afterSimulate??(()=>Promise.resolve({})),"f"),tt(this,c,re?.beforeCheckPendingTransaction??(()=>Promise.resolve(!0)),"f"),tt(this,l,re?.beforePublish??(()=>Promise.resolve(!0)),"f"),tt(this,u,re?.beforeSign??(()=>Promise.resolve({})),"f"),tt(this,h,re?.getAdditionalSignArguments??(()=>[]),"f"),tt(this,m,q??(()=>Promise.resolve(!0)),"f"),tt(this,g,z,"f"),tt(this,p,V??(()=>[]),"f"),tt(this,f,Q||(()=>Promise.resolve({})),"f"),tt(this,b,X,"f"),tt(this,w,Z,"f"),tt(this,C,ee??(e=>undefined),"f"),tt(this,k,ne??(()=>Promise.resolve({})),"f"),tt(this,T,se,"f"),tt(this,S,ae??(e=>!1),"f"),tt(this,P,ie??(()=>Promise.resolve(!1)),"f"),tt(this,I,oe??(()=>!0),"f"),tt(this,M,t??!1,"f"),tt(this,E,n??!1,"f"),tt(this,A,ce??(()=>!0),"f"),tt(this,_,K??!1,"f"),tt(this,N,ue,"f"),tt(this,O,de,"f"),tt(this,D,re?.publish??(()=>Promise.resolve({transactionHash:undefined})),"f"),tt(this,R,re?.publishBatch,"f"),tt(this,L,me,"f"),tt(this,G,ge,"f"),tt(this,$,!0===fe,"f"),tt(this,H,be??((e,t)=>t?.()),"f"),tt(this,W,we,"f");const Ce=e=>this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);tt(this,x,new St.MultichainTrackingHelper({findNetworkClientIdByChainId:Ce,getNetworkClientById:e=>this.messenger.call("NetworkController:getNetworkClientById",e),getNetworkClientRegistry:J,removePendingTransactionTrackerListeners:nt(this,r,"m",Fe).bind(this),createNonceTracker:nt(this,r,"m",Me).bind(this),createPendingTransactionTracker:nt(this,r,"m",Ee).bind(this),onNetworkStateChange:e=>{this.messenger.subscribe("NetworkController:stateChange",e)}}),"f"),nt(this,x,"f").initialize(),tt(this,d,nt(this,r,"m",Re).call(this),"f"),tt(this,j,nt(this,r,"m",Le).call(this),"f");const ke=new yt.GasFeePoller({findNetworkClientIdByChainId:Ce,gasFeeFlows:nt(this,d,"f"),getGasFeeControllerEstimates:nt(this,f,"f"),getProvider:e=>nt(this,r,"m",he).call(this,{networkClientId:e}),getTransactions:()=>this.state.transactions,getTransactionBatches:()=>this.state.transactionBatches,layer1GasFeeFlows:nt(this,j,"f"),messenger:this.messenger,onStateChange:e=>{this.messenger.subscribe("TransactionController:stateChange",e)}});ke.hub.on("transaction-updated",nt(this,r,"m",Ue).bind(this)),ke.hub.on("transaction-batch-updated",nt(this,r,"m",$e).bind(this)),tt(this,F,new vt.MethodDataHelper({getProvider:e=>nt(this,r,"m",he).call(this,{networkClientId:e}),getState:()=>this.state.methodData}),"f"),nt(this,F,"f").hub.on("update",({fourBytePrefix:e,methodData:t})=>{this.update(n=>{n.methodData[e]=t})}),tt(this,y,new Tt.IncomingTransactionHelper({client:nt(this,T,"f").client,getCurrentAccount:()=>nt(this,r,"m",We).call(this),getLocalTransactions:()=>this.state.transactions,includeTokenTransfers:nt(this,T,"f").includeTokenTransfers,isEnabled:nt(this,T,"f").isEnabled,messenger:this.messenger,remoteTransactionSource:new kt.AccountsApiRemoteTransactionSource,trimTransactions:nt(this,r,"m",te).bind(this),updateTransactions:nt(this,T,"f").updateTransactions}),"f"),nt(this,r,"m",je).call(this,nt(this,y,"f")),this.messenger.subscribe("TransactionController:stateChange",nt(this,Ae,"f")),new It.ResimulateHelper({simulateTransaction:nt(this,r,"m",Be).bind(this),onTransactionsUpdate:e=>{this.messenger.subscribe("TransactionController:stateChange",e,e=>e.transactions)},getTransactions:()=>this.state.transactions}),nt(this,r,"m",Y).call(this),nt(this,Ae,"f").call(this),nt(this,r,"m",Ve).call(this)}destroy(){nt(this,r,"m",_e).call(this)}async handleMethodData(e,t){return nt(this,F,"f").lookup(e,t)}async addTransactionBatch(e){const{blockTracker:t}=this.messenger.call("NetworkController:getNetworkClientById",e.networkClientId);return await(0,jt.addTransactionBatch)({addTransaction:this.addTransaction.bind(this),estimateGas:this.estimateGas.bind(this),getChainId:nt(this,r,"m",le).bind(this),getEthQuery:e=>nt(this,r,"m",de).call(this,{networkClientId:e}),getGasFeeEstimates:nt(this,f,"f"),getInternalAccounts:nt(this,r,"m",Ke).bind(this),getSimulationConfig:nt(this,k,"f").bind(this),getPendingTransactionTracker:e=>nt(this,r,"m",Ee).call(this,{provider:nt(this,r,"m",he).call(this,{networkClientId:e}),blockTracker:t,chainId:nt(this,r,"m",le).call(this,e),networkClientId:e}),getTransaction:e=>nt(this,r,"m",ie).call(this,e),isSimulationEnabled:nt(this,A,"f"),messenger:this.messenger,publishBatchHook:nt(this,R,"f"),publicKeyEIP7702:nt(this,O,"f"),publishTransaction:(e,t)=>nt(this,r,"m",Z).call(this,e,t),request:e,signTransaction:nt(this,r,"m",Te).bind(this),update:this.update.bind(this),updateTransaction:nt(this,r,"m",Ge).bind(this)})}async isAtomicBatchSupported(e){return(0,jt.isAtomicBatchSupported)({...e,getEthQuery:e=>nt(this,r,"m",de).call(this,{chainId:e}),messenger:this.messenger,publicKeyEIP7702:nt(this,O,"f")})}async addTransaction(e,t){(0,Et.projectLogger)("Adding transaction",e,t);const{actionId:n,assetsFiatValues:a,batchId:i,deviceConfirmedOn:o,disableGasBuffer:c,isGasFeeIncluded:l,isGasFeeSponsored:u,method:d,nestedTransactions:h,networkClientId:m,origin:g,publishHook:p,requireApproval:f,securityAlertResponse:b,sendFlowHistory:C,swaps:k={},traceContext:y,type:T}=t;if(e=(0,qt.normalizeTransactionParams)(e),!nt(this,x,"f").has(m))throw new Error(`Network client not found - ${m}`);const v=nt(this,r,"m",le).call(this,m),S=nt(this,r,"m",de).call(this,{networkClientId:m}),P=g===undefined?undefined:await(nt(this,w,"f")?.call(this,g)),A=nt(this,r,"m",Ke).call(this);await(0,zt.validateTransactionOrigin)({data:e.data,from:e.from,internalAccounts:A,origin:g,permittedAddresses:P,txParams:e,type:T});const j=(0,Ft.getDelegationAddress)(e.from,S).catch(()=>undefined),F=await nt(this,r,"m",ye).call(this,m);(0,zt.validateTxParams)(e,F,v),e.type||(0,qt.setEnvelopeType)(e,F);if(i?.length&&this.state.transactions.some(e=>e.batchId?.toLowerCase()===i?.toLowerCase())&&g&&g!==at.ORIGIN_METAMASK)throw new lt.JsonRpcError(zt.ErrorCode.DuplicateBundleId,"Batch ID already exists");const N=nt(this,r,"m",ge).call(this,e,g),O=T??(await(0,Kt.determineTransactionType)(e,S)).type,D=await j,R=nt(this,r,"m",we).call(this,n);let G=R?(0,ht.cloneDeep)(R):{actionId:n,assetsFiatValues:a,batchId:i,chainId:v,dappSuggestedGasFees:N,delegationAddress:D,deviceConfirmedOn:o,disableGasBuffer:c,id:(0,mt.v1)(),isGasFeeIncluded:l,isGasFeeSponsored:u,isFirstTimeInteraction:undefined,nestedTransactions:h,networkClientId:m,origin:g,securityAlertResponse:b,status:At.TransactionStatus.unapproved,time:Date.now(),txParams:e,type:O,userEditedGasLimit:!1,verifiedOnBlockchain:!1};const{updateTransaction:B}=await nt(this,s,"f").call(this,{transactionMeta:G});if(B&&((0,Et.projectLogger)("Updating transaction using afterAdd hook"),G.txParamsOriginal=(0,ht.cloneDeep)(G.txParams),B(G)),await nt(this,H,"f").call(this,{name:"Estimate Gas Properties",parentContext:y},e=>nt(this,r,"m",V).call(this,G,{traceContext:e})),!R){if(d&&nt(this,L,"f")){const e=await nt(this,L,"f").call(this,G,d);G.securityProviderResponse=e}nt(this,E,"f")||(G.sendFlowHistory=C??[]),nt(this,M,"f")||(G=(0,Gt.addInitialHistorySnapshot)(G)),G=(0,Wt.updateSwapsTransaction)(G,O,k,{isSwapsDisabled:nt(this,_,"f"),cancelTransaction:nt(this,r,"m",ee).bind(this),messenger:this.messenger}),nt(this,r,"m",z).call(this,G),!1!==f?(nt(this,r,"m",Be).call(this,G,{traceContext:y}).catch(e=>{throw(0,Et.projectLogger)("Error while updating simulation data",e),e}),(0,Nt.updateFirstTimeInteraction)({existingTransactions:this.state.transactions,getTransaction:e=>nt(this,r,"m",ae).call(this,e),isFirstTimeInteractionEnabled:nt(this,I,"f"),trace:nt(this,H,"f"),traceContext:y,transactionMeta:G,updateTransaction:nt(this,r,"m",Ge).bind(this)}).catch(e=>{(0,Et.projectLogger)("Error while updating first interaction properties",e)})):(0,Et.projectLogger)("Skipping simulation & first interaction update as approval not required"),this.messenger.publish(`${Yt}:unapprovedTransactionAdded`,G)}return{result:nt(this,r,"m",J).call(this,G,{actionId:n,isExisting:Boolean(R),publishHook:p,requireApproval:f,traceContext:y}),transactionMeta:G}}startIncomingTransactionPolling(){nt(this,y,"f").start()}stopIncomingTransactionPolling(){nt(this,y,"f").stop()}async updateIncomingTransactions({tags:e}={}){await nt(this,y,"f").update({tags:e})}async stopTransaction(e,t,{estimatedBaseFee:s,actionId:a}={}){await nt(this,r,"m",K).call(this,{actionId:a,estimatedBaseFee:s,gasValues:t,label:"cancel",rate:n.CANCEL_RATE,transactionId:e,transactionType:At.TransactionType.cancel,prepareTransactionParams:e=>{delete e.data,e.to=e.from,e.value="0x0"},afterSubmit:e=>{this.messenger.publish(`${Yt}:transactionFinished`,e),nt(this,v,"f").emit(`${e.id}:finished`,e)}})}async speedUpTransaction(e,t,{actionId:s,estimatedBaseFee:a}={}){await nt(this,r,"m",K).call(this,{actionId:s,estimatedBaseFee:a,gasValues:t,label:"speed up",rate:n.SPEED_UP_RATE,transactionId:e,transactionType:At.TransactionType.retry,afterSubmit:e=>{this.messenger.publish(`${Yt}:speedupTransactionAdded`,e)}})}async estimateGas(e,t,{ignoreDelegationSignatures:n}={}){const s=nt(this,r,"m",de).call(this,{networkClientId:t}),{estimatedGas:a,simulationFails:i}=await(0,Ot.estimateGas)({chainId:nt(this,r,"m",le).call(this,t),ethQuery:s,ignoreDelegationSignatures:n,isSimulationEnabled:nt(this,A,"f").call(this),getSimulationConfig:nt(this,k,"f"),messenger:this.messenger,txParams:e});return{gas:a,simulationFails:i}}async estimateGasBuffered(e,t,n){const s=nt(this,r,"m",de).call(this,{networkClientId:n}),{blockGasLimit:a,estimatedGas:i,simulationFails:o}=await(0,Ot.estimateGas)({chainId:nt(this,r,"m",le).call(this,n),ethQuery:s,isSimulationEnabled:nt(this,A,"f").call(this),getSimulationConfig:nt(this,k,"f"),messenger:this.messenger,txParams:e});return{gas:(0,Ot.addGasBuffer)(i,a,t),simulationFails:o}}updateTransaction(e,t){const{id:n}=e;nt(this,r,"m",Ge).call(this,{transactionId:n,note:t},()=>({...e}))}updateSecurityAlertResponse(e,t){if(!t)throw new Error("updateSecurityAlertResponse: securityAlertResponse should not be null");const n=nt(this,r,"m",ae).call(this,e);if(!n)throw new Error("Cannot update security alert response as no transaction metadata found");const s={...n,securityAlertResponse:t};this.updateTransaction(s,`${Yt}:updatesecurityAlertResponse - securityAlertResponse updated`)}wipeTransactions({address:e,chainId:t}={}){if(!t&&!e)return void this.update(e=>{e.transactions=[]});const n=this.state.transactions.filter(({chainId:n,txParams:r,type:s})=>{if(!(!t||t===n))return!0;return!(!e||r.from?.toLowerCase()===e.toLowerCase()||s===At.TransactionType.incoming&&r.to?.toLowerCase()===e.toLowerCase())});this.update(e=>{e.transactions=nt(this,r,"m",te).call(this,n)})}async confirmExternalTransaction(e,t,n){const s=nt(this,r,"m",pe).call(this,e);try{const e=s.id,a={...s,status:At.TransactionStatus.confirmed,txReceipt:t};n&&(a.baseFeePerGas=n),nt(this,r,"m",fe).call(this,e),this.updateTransaction(a,`${Yt}:confirmExternalTransaction - Add external transaction`),nt(this,r,"m",ve).call(this,a),nt(this,r,"m",Ie).call(this,a).catch(e=>{throw(0,Et.projectLogger)("Error while updating post balance",e),e}),this.messenger.publish(`${Yt}:transactionConfirmed`,a)}catch(e){console.error("Failed to confirm external transaction",e)}}updateTransactionSendFlowHistory(e,t,n){if(nt(this,E,"f"))throw new Error("Send flow history is disabled for the current transaction controller");const s=nt(this,r,"m",ae).call(this,e);if(!s)throw new Error("Cannot update send flow history as no transaction metadata found");(0,qt.validateIfTransactionUnapproved)(s,"updateTransactionSendFlowHistory");const a=s.sendFlowHistory??[];if(t===a.length){const e={...s,sendFlowHistory:[...a,...n]};this.updateTransaction(e,`${Yt}:updateTransactionSendFlowHistory - sendFlowHistory updated`)}return nt(this,r,"m",ae).call(this,e)}updateTransactionGasFees(e,{defaultGasEstimates:t,estimateUsed:n,estimateSuggested:s,gas:a,gasLimit:i,gasPrice:o,maxPriorityFeePerGas:c,maxFeePerGas:l,originalGasEstimate:u,userEditedGasLimit:d,userFeeLevel:h}){const m=nt(this,r,"m",ae).call(this,e);if(!m)throw new Error("Cannot update transaction as no transaction metadata found");(0,qt.validateIfTransactionUnapproved)(m,"updateTransactionGasFees");const g=(0,ht.cloneDeep)(m),p=m.gasFeeEstimates,f=nt(this,S,"f").call(this,m),b=h,w=Object.values(At.GasFeeEstimateLevel).includes(b),C=p&&f&&w;C&&(0,yt.updateTransactionGasEstimates)({txMeta:g,userFeeLevel:b});const k={gas:a,gasLimit:i};C?Object.assign(k,{gasPrice:g.txParams.gasPrice,maxPriorityFeePerGas:g.txParams.maxPriorityFeePerGas,maxFeePerGas:g.txParams.maxFeePerGas}):Object.assign(k,{gasPrice:o,maxPriorityFeePerGas:c,maxFeePerGas:l});const y={txParams:(0,ht.pickBy)(k),defaultGasEstimates:t,estimateUsed:n,estimateSuggested:s,originalGasEstimate:u,userEditedGasLimit:d,userFeeLevel:b},T=(0,ht.pickBy)(y);return nt(this,r,"m",Ge).call(this,{transactionId:e,note:`${Yt}:updateTransactionGasFees - gas values updated`,skipResimulateCheck:!0},e=>{const{txParams:t,...n}=T;Object.assign(e,n),t&&Object.assign(e.txParams,t)}),nt(this,r,"m",ae).call(this,e)}updatePreviousGasParams(e,{gasLimit:t,maxFeePerGas:n,maxPriorityFeePerGas:s}){const a=nt(this,r,"m",ae).call(this,e);if(!a)throw new Error("Cannot update transaction as no transaction metadata found");(0,qt.validateIfTransactionUnapproved)(a,"updatePreviousGasParams");const i={previousGas:{gasLimit:t,maxFeePerGas:n,maxPriorityFeePerGas:s}};i.previousGas=(0,ht.pickBy)(i.previousGas);const o=(0,ht.merge)({},a,i);return this.updateTransaction(o,`${Yt}:updatePreviousGasParams - Previous gas values updated`),nt(this,r,"m",ae).call(this,e)}async getNonceLock(e,t){return nt(this,x,"f").getNonceLock(e,t)}async updateEditableParams(e,{containerTypes:t,data:n,from:s,gas:a,gasPrice:i,maxFeePerGas:o,maxPriorityFeePerGas:c,to:l,updateType:u,value:d}){const h=nt(this,r,"m",ae).call(this,e);if(!h)throw new Error("Cannot update editable params as no transaction metadata found");(0,qt.validateIfTransactionUnapproved)(h,"updateEditableParams");const m={txParams:{data:n,from:s,to:l,value:d,gas:a,gasPrice:i,maxFeePerGas:o,maxPriorityFeePerGas:c}};m.txParams=(0,ht.pickBy)(m.txParams);const g=(0,ht.merge)({},h,m),{networkClientId:p}=h,f=nt(this,r,"m",he).call(this,{networkClientId:p}),b=new it.default(f);if(!1!==u){const{type:e}=await(0,Kt.determineTransactionType)(g.txParams,b);g.type=e}return t&&(g.containerTypes=t),await(0,Bt.updateTransactionLayer1GasFee)({layer1GasFeeFlows:nt(this,j,"f"),messenger:this.messenger,provider:f,transactionMeta:g}),this.updateTransaction(g,`Update Editable Params for ${e}`),nt(this,r,"m",ae).call(this,e)}setTransactionActive(e,t){if(!nt(this,r,"m",ae).call(this,e))throw new Error(`Transaction with id ${e} not found`);nt(this,r,"m",Ge).call(this,{transactionId:e,note:"TransactionController#setTransactionActive - Transaction isActive updated",skipHistory:!0,skipValidation:!0,skipResimulateCheck:!0},e=>{e.isActive=t})}async approveTransactionsWithSameNonce(e=[],{hasNonce:t}={}){if((0,Et.projectLogger)("Approving transactions with same nonce",{transactions:e}),0===e.length)return"";const n=e[0],{chainId:s}=n,a=nt(this,r,"m",ue).call(this,{chainId:s}),i=(0,$t.prepareTransaction)(s,n),c=(0,$t.serializeTransaction)(i);if(nt(this,o,"f").has(c))return"";let l,u;nt(this,o,"f").add(c);try{const s=n.from;u=!0!==t?await this.getNonceLock(s,a):undefined;const i=u?(0,ut.add0x)(u.nextNonce.toString(16)):n.nonce;u&&(0,Et.projectLogger)("Using nonce from nonce tracker",i,u.nonceDetails),l=await Promise.all(e.map(e=>(e.nonce=i,nt(this,r,"m",q).call(this,e.chainId,e))))}catch(e){throw(0,Et.projectLogger)("Error while signing transactions with same nonce",e),e}finally{u?.releaseLock(),nt(this,o,"f").delete(c)}return l}updateCustodialTransaction(e){const{transactionId:t,errorMessage:n,hash:s,status:a,gasLimit:i,gasPrice:o,maxFeePerGas:c,maxPriorityFeePerGas:l,nonce:u,type:d}=e,h=nt(this,r,"m",ae).call(this,t);if(!h)throw new Error("Cannot update custodial transaction as no transaction metadata found");if(a&&![At.TransactionStatus.submitted,At.TransactionStatus.signed,At.TransactionStatus.failed].includes(a))throw new Error(`Cannot update custodial transaction with status: ${a}`);const m=(0,ht.merge)({},h,(0,ht.pickBy)({hash:s,status:a}));return m.status===At.TransactionStatus.submitted&&(m.submittedTime=(new Date).getTime()),m.status===At.TransactionStatus.failed&&(m.error=(0,qt.normalizeTxError)(new Error(n))),m.txParams=(0,ht.merge)({},m.txParams,(0,ht.pickBy)({gasLimit:i,gasPrice:o,maxFeePerGas:c,maxPriorityFeePerGas:l,nonce:u,type:d})),d===At.TransactionEnvelopeType.legacy&&(delete m.txParams.maxFeePerGas,delete m.txParams.maxPriorityFeePerGas),this.updateTransaction(m,`${Yt}:updateCustodialTransaction - Custodial transaction updated`),a&&[At.TransactionStatus.submitted,At.TransactionStatus.failed].includes(a)&&(this.messenger.publish(`${Yt}:transactionFinished`,m),nt(this,v,"f").emit(`${m.id}:finished`,m)),m}getTransactions({initialList:e,limit:t,searchCriteria:n={}}={}){const r=(0,ht.mapValues)(n,e=>"function"==typeof e?e:t=>t===e),s=e??this.state.transactions,a=(0,ht.sortBy)((0,ht.pickBy)(s,e=>{for(const[t,n]of Object.entries(r))if(t in e.txParams){if(!1===n(e.txParams[t]))return!1}else if(!1===n(e[t]))return!1;return!0}),"time");if(t!==undefined){const e=new Set,n=[];for(let r=a.length-1;r>-1;r--){const s=a[r],{nonce:i}=s.txParams;if(!e.has(i)){if(!(e.size<t))continue;e.add(i)}n.unshift(s)}return n}return a}async estimateGasFee({transactionParams:e,chainId:t,networkClientId:n}){const{id:r,provider:s}=nt(this,x,"f").getNetworkClient({chainId:t,networkClientId:n}),a={txParams:e,chainId:t,networkClientId:r},i=(0,Lt.getGasFeeFlow)(a,nt(this,d,"f"),this.messenger),o=new it.default(s),c=await nt(this,f,"f").call(this,{networkClientId:r});return i.getGasFees({ethQuery:o,gasFeeControllerData:c,messenger:this.messenger,transactionMeta:a})}async getLayer1GasFee({transactionParams:e,chainId:t,networkClientId:n}){const s=nt(this,r,"m",he).call(this,{chainId:t,networkClientId:n});return await(0,Bt.getTransactionLayer1GasFee)({layer1GasFeeFlows:nt(this,j,"f"),messenger:this.messenger,provider:s,transactionMeta:{txParams:e,chainId:t}})}clearUnapprovedTransactions(){const e=this.state.transactions.filter(({status:e})=>e!==At.TransactionStatus.unapproved);this.update(t=>{t.transactions=nt(this,r,"m",te).call(this,e)})}abortTransactionSigning(e){if(!nt(this,r,"m",ae).call(this,e))throw new Error("Cannot abort signing as no transaction metadata found");const t=nt(this,B,"f").get(e);if(!t)throw new Error("Cannot abort signing as transaction is not waiting for signing");t(),nt(this,B,"f").delete(e)}async updateAtomicBatchData({transactionId:e,transactionIndex:t,transactionData:n}){(0,Et.projectLogger)("Updating atomic batch data",{transactionId:e,transactionIndex:t,transactionData:n});const s=nt(this,r,"m",Ge).call(this,{transactionId:e,note:"TransactionController#updateAtomicBatchData - Atomic batch data updated"},e=>{const{nestedTransactions:r,txParams:s}=e,a=s.from,i=r?.[t];if(!i)throw new Error(`Nested transaction not found with index - ${t}`);i.data=n;const o=(0,Ft.generateEIP7702BatchTransaction)(a,r);e.txParams.data=o.data}),a=(0,ht.cloneDeep)({...s,txParams:{...s.txParams,gas:undefined}});return await nt(this,r,"m",ze).call(this,a),nt(this,r,"m",Ge).call(this,{transactionId:e,note:"TransactionController#updateAtomicBatchData - Gas estimate updated"},e=>{e.txParams.gas=a.txParams.gas,e.simulationFails=a.simulationFails,e.gasLimitNoBuffer=a.gasLimitNoBuffer}),s.txParams.data}updateBatchTransactions({transactionId:e,batchTransactions:t}){(0,Et.projectLogger)("Updating batch transactions",{transactionId:e,batchTransactions:t}),nt(this,r,"m",Ge).call(this,{transactionId:e,note:"TransactionController#updateBatchTransactions - Batch transactions updated"},e=>{e.batchTransactions=t})}updateSelectedGasFeeToken(e,t){nt(this,r,"m",Ge).call(this,{transactionId:e},e=>{const n=e.gasFeeTokens?.some(e=>e.tokenAddress.toLowerCase()===t?.toLowerCase());if(t&&!n)throw new Error(`No matching gas fee token found with address - ${t}`);e.selectedGasFeeToken=t})}updateRequiredTransactionIds({transactionId:e,requiredTransactionIds:t,append:n}){nt(this,r,"m",Ge).call(this,{transactionId:e},e=>{const{requiredTransactionIds:r}=e;e.requiredTransactionIds=[...r&&!1!==n?r:[],...t]})}emulateNewTransaction(e){const t=this.state.transactions.find(t=>t.id===e);t&&(t.type===At.TransactionType.swap?this.messenger.publish("TransactionController:transactionNewSwap",{transactionMeta:t}):t.type===At.TransactionType.swapApproval&&this.messenger.publish("TransactionController:transactionNewSwapApproval",{transactionMeta:t}))}emulateTransactionUpdate(e){const t={...e,txParams:{...e.txParams,from:this.messenger.call("AccountsController:getSelectedAccount").address}};this.state.transactions.some(e=>e.id===t.id)||this.update(e=>{e.transactions.push(t)}),this.updateTransaction(t,"Generated from user operation"),this.messenger.publish("TransactionController:transactionStatusUpdated",{transactionMeta:t})}}n.TransactionController=Jt,s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,g=new WeakMap,p=new WeakMap,f=new WeakMap,b=new WeakMap,w=new WeakMap,C=new WeakMap,k=new WeakMap,y=new WeakMap,T=new WeakMap,v=new WeakMap,S=new WeakMap,P=new WeakMap,I=new WeakMap,M=new WeakMap,E=new WeakMap,A=new WeakMap,_=new WeakMap,j=new WeakMap,F=new WeakMap,x=new WeakMap,N=new WeakMap,O=new WeakMap,D=new WeakMap,R=new WeakMap,L=new WeakMap,G=new WeakMap,B=new WeakMap,U=new WeakMap,$=new WeakMap,H=new WeakMap,W=new WeakMap,Ae=new WeakMap,r=new WeakSet,K=async function({actionId:e,afterSubmit:t,estimatedBaseFee:n,gasValues:s,label:a,prepareTransactionParams:i,rate:o,transactionId:c,transactionType:l}){if(nt(this,r,"m",we).call(this,e))return;s&&(s=(0,qt.normalizeGasFeeValues)(s),(0,qt.validateGasValues)(s)),(0,Et.projectLogger)(`Creating ${a} transaction`,c,s);const u=nt(this,r,"m",ae).call(this,c);if(!u)return;if(!nt(this,G,"f"))throw new Error("No sign method defined.");const d=(0,Ht.getTransactionParamsWithIncreasedGasFee)(u.txParams,o,s);i?.(d);const h=(0,$t.prepareTransaction)(u.chainId,d),m=await nt(this,G,"f").call(this,h,u.txParams.from),g=nt(this,r,"m",ke).call(this,u,m),p=(0,$t.serializeTransaction)(m),f=d.maxFeePerGas??d.gasPrice,b=d.maxFeePerGas?g.txParams.maxFeePerGas:g.txParams.gasPrice;(0,Et.projectLogger)(`Submitting ${a} transaction`,{oldFee:b,newFee:f,txParams:d});const{networkClientId:w}=u,C=nt(this,r,"m",de).call(this,{networkClientId:w}),k={...g,actionId:e,estimatedBaseFee:n,id:(0,mt.v1)(),originalGasEstimate:u.txParams.gas,originalType:u.type,rawTx:p,time:Date.now(),txParams:d,type:l},y=await nt(this,r,"m",Oe).call(this,C,{...k,origin:a});k.hash=y,nt(this,r,"m",z).call(this,k),this.messenger.publish(`${Yt}:transactionApproved`,{transactionMeta:k,actionId:e}),this.messenger.publish(`${Yt}:transactionSubmitted`,{transactionMeta:k,actionId:e}),t?.(k)},q=async function(e,t){if(!nt(this,G,"f"))throw new Error("No sign method defined.");const n=(0,qt.normalizeTransactionParams)(t),r=(0,qt.isEIP1559Transaction)(n)?At.TransactionEnvelopeType.feeMarket:At.TransactionEnvelopeType.legacy,s={...n,type:r,gasLimit:n.gas,chainId:e},{from:a}=s,i=(0,$t.prepareTransaction)(e,s),o=await nt(this,G,"f").call(this,i,a);return(0,$t.serializeTransaction)(o)},z=function(e){(0,zt.validateTxParams)(e.txParams),this.update(t=>{t.transactions=nt(this,r,"m",te).call(this,[...t.transactions,e])})},V=async function(e,{traceContext:t}={}){const n=e.txParams.type!==At.TransactionEnvelopeType.legacy&&await nt(this,r,"m",ye).call(this,e.networkClientId),{networkClientId:s}=e,a=nt(this,r,"m",de).call(this,{networkClientId:s}),i=nt(this,r,"m",he).call(this,{networkClientId:s});await nt(this,H,"f").call(this,{name:"Update Gas",parentContext:t},async()=>{await nt(this,r,"m",ze).call(this,e)}),await nt(this,H,"f").call(this,{name:"Update Gas Fees",parentContext:t},async()=>await(0,Rt.updateGasFees)({eip1559:n,ethQuery:a,gasFeeFlows:nt(this,d,"f"),getGasFeeEstimates:nt(this,f,"f"),getSavedGasFees:nt(this,C,"f").bind(this),messenger:this.messenger,txMeta:e})),await nt(this,H,"f").call(this,{name:"Update Layer 1 Gas Fees",parentContext:t},async()=>await(0,Bt.updateTransactionLayer1GasFee)({layer1GasFeeFlows:nt(this,j,"f"),messenger:this.messenger,provider:i,transactionMeta:e}))},Y=function(){this.clearUnapprovedTransactions(),nt(this,r,"m",Q).call(this)},Q=function(){const e=this.state.transactions.filter(e=>[At.TransactionStatus.approved,At.TransactionStatus.signed].includes(e.status));for(const t of e)nt(this,r,"m",Xe).call(this,t,new Error("Transaction incomplete at startup"))},J=async function(e,{actionId:t,isExisting:n=!1,publishHook:s,requireApproval:a,shouldShowRequest:i=!0,traceContext:o}){const c=e.id;let l;const{meta:u,isCompleted:d}=nt(this,r,"m",ce).call(this,c),h=d?Promise.resolve(u):nt(this,r,"m",Ce).call(this,c);if(u&&!n&&!d)try{if(!1!==a){const t=await nt(this,H,"f").call(this,{name:"Await Approval",parentContext:o},t=>nt(this,r,"m",se).call(this,e,{shouldShowRequest:i,traceContext:t}));l=t.resultCallbacks;const n=t.value,s=n?.txMeta;s&&((0,Et.projectLogger)("Updating transaction with approval data",{customNonce:s.customNonceValue,params:s.txParams}),this.updateTransaction(s,"TransactionController#processApproval - Updated with approval data"))}const{isCompleted:n}=nt(this,r,"m",ce).call(this,c);if(!n){await nt(this,r,"m",X).call(this,c,o,s)===Qt.SkippedViaBeforePublishHook&&l&&l.success();const e=nt(this,r,"m",ae).call(this,c);this.messenger.publish(`${Yt}:transactionApproved`,{transactionMeta:e,actionId:t})}}catch(e){const n=e,{isCompleted:s}=nt(this,r,"m",ce).call(this,c);s||(nt(this,r,"m",Qe).call(this,n)?nt(this,r,"m",Je).call(this,c,t,n):nt(this,r,"m",Xe).call(this,u,n,t))}finally{nt(this,U,"f").delete(c)}const m=await h;switch(m?.status){case At.TransactionStatus.failed:const e=m.error;throw l?.error(e),lt.rpcErrors.internal(e.message);case At.TransactionStatus.submitted:return l?.success(),m.hash;default:const t=lt.rpcErrors.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(m||c)}`);throw l?.error(t),t}},X=async function(e,t,n){let s,a,i=nt(this,r,"m",ie).call(this,e);(0,Et.projectLogger)("Approving transaction",i);try{if(!nt(this,G,"f"))return nt(this,r,"m",Xe).call(this,i,new Error("No sign method defined.")),Qt.NotApproved;if(!i.chainId)return nt(this,r,"m",Xe).call(this,i,new Error("No chainId defined.")),Qt.NotApproved;if(nt(this,o,"f").has(e))return(0,Et.projectLogger)("Skipping approval as signing in progress",e),Qt.NotApproved;nt(this,o,"f").add(e),s=()=>nt(this,o,"f").delete(e);const[c,u]=await(0,Ut.getNextNonce)(i,e=>nt(this,x,"f").getNonceLock(e,i.networkClientId));a=u,i=nt(this,r,"m",Ge).call(this,{transactionId:e,note:"TransactionController#approveTransaction - Transaction approved"},e=>{const{chainId:t,txParams:n}=e,{gas:r,type:s}=n;e.status=At.TransactionStatus.approved,e.txParams.chainId=t,e.txParams.gasLimit=r,e.txParams.nonce=c,!s&&(0,qt.isEIP1559Transaction)(n)&&(e.txParams.type=At.TransactionEnvelopeType.feeMarket)}),nt(this,r,"m",ve).call(this,i);const d=await nt(this,H,"f").call(this,{name:"Sign",parentContext:t},()=>nt(this,r,"m",Te).call(this,i));if(!await nt(this,l,"f").call(this,i))return(0,Et.projectLogger)("Skipping publishing transaction based on hook"),this.messenger.publish(`${Yt}:transactionPublishingSkipped`,i),Qt.SkippedViaBeforePublishHook;if(!d&&!i.isExternalSign)return Qt.NotApproved;const{networkClientId:h}=i,m=nt(this,r,"m",de).call(this,{networkClientId:h});let g;const p=i.type===At.TransactionType.swap;p&&((0,Et.projectLogger)("Determining pre-transaction balance"),g=await(0,at.query)(m,"getBalance",[i.txParams.from])),(0,Et.projectLogger)("Publishing transaction",i.txParams),a?.(),a=undefined;let f=nt(this,r,"m",et).bind(this,{ethQuery:m,publishHookOverride:n,traceContext:t});if(i.batchTransactions?.length){(0,Et.projectLogger)("Found batch transactions",i.batchTransactions);f=new Mt.ExtraTransactionsPublishHook({addTransactionBatch:this.addTransactionBatch.bind(this),getTransaction:nt(this,r,"m",ie).bind(this),originalPublishHook:f}).getHook()}const{transactionHash:b}=await f(i,d??"0x");return i=nt(this,r,"m",Ge).call(this,{transactionId:e,note:"TransactionController#approveTransaction - Transaction submitted"},e=>{e.hash=b,e.status=At.TransactionStatus.submitted,e.submittedTime=(new Date).getTime(),p&&(e.preTxBalance=g,(0,Et.projectLogger)("Updated pre-transaction balance",g))}),this.messenger.publish(`${Yt}:transactionSubmitted`,{transactionMeta:i}),this.messenger.publish(`${Yt}:transactionFinished`,i),nt(this,v,"f").emit(`${e}:finished`,i),nt(this,r,"m",ve).call(this,i),Qt.Approved}catch(e){return nt(this,r,"m",Xe).call(this,i,e),Qt.NotApproved}finally{s?.(),a?.()}},Z=async function(e,t,{skipSubmitHistory:n}={}){const s=await(0,at.query)(e,"sendRawTransaction",[t.rawTx]);return!0!==n&&nt(this,r,"m",qe).call(this,t,s),s},ee=function(e,t,n){const s=nt(this,r,"m",ae).call(this,e);if(!s)return;nt(this,r,"m",Ye).call(this,e);const a={...s,status:At.TransactionStatus.rejected,error:(0,qt.normalizeTxError)(n??lt.providerErrors.userRejectedRequest())};this.messenger.publish(`${Yt}:transactionFinished`,a),nt(this,v,"f").emit(`${s.id}:finished`,a),this.messenger.publish(`${Yt}:transactionRejected`,{transactionMeta:a,actionId:t}),nt(this,r,"m",ve).call(this,a)},te=function(e){const t=new Set,n=[...e].sort((e,t)=>e.time>t.time?-1:1).filter(e=>{const{chainId:n,status:s,txParams:a,time:i}=e;if(a){const e=`${String(a.nonce)}-${(0,at.convertHexToDecimal)(n)}-${new Date(i).toDateString()}`;if(t.has(e))return!0;if(t.size<nt(this,W,"f")||!nt(this,r,"m",ne).call(this,s))return t.add(e),!0}return!1});return n.reverse(),n},ne=function(e){return e===At.TransactionStatus.rejected||e===At.TransactionStatus.confirmed||e===At.TransactionStatus.failed},re=function(e){return[At.TransactionStatus.confirmed,At.TransactionStatus.failed,At.TransactionStatus.rejected,At.TransactionStatus.submitted].includes(e)},se=async function(e,{shouldShowRequest:t,traceContext:n}){const s=nt(this,r,"m",oe).call(this,e),{origin:a}=e,i=at.ApprovalType.Transaction,o={txId:e.id};return await nt(this,H,"f").call(this,{name:"Notification Display",id:s,parentContext:n}),await this.messenger.call("ApprovalController:addRequest",{id:s,origin:a||at.ORIGIN_METAMASK,type:i,requestData:o,expectsResult:!0},t)},ae=function(e){const{transactions:t}=this.state;return t.find(({id:t})=>t===e)},ie=function(e,t="TransactionController"){const n=nt(this,r,"m",ae).call(this,e);if(!n)throw new Error(`${t}: No transaction found with id ${e}`);return n},oe=function(e){return String(e.id)},ce=function(e){const t=nt(this,r,"m",ae).call(this,e);if(!t)return{meta:undefined,isCompleted:!1};return{meta:t,isCompleted:nt(this,r,"m",re).call(this,t.status)}},le=function(e){return nt(this,x,"f").getNetworkClient({networkClientId:e}).configuration.chainId},ue=function({chainId:e,networkClientId:t}){return t||nt(this,x,"f").getNetworkClient({chainId:e}).id},de=function({chainId:e,networkClientId:t}){return new it.default(nt(this,r,"m",he).call(this,{chainId:e,networkClientId:t}))},he=function({chainId:e,networkClientId:t}){return nt(this,x,"f").getNetworkClient({chainId:e,networkClientId:t}).provider},me=function(e){if(!e.length)return;const t=[];for(const n of e){const{chainId:e}=n;try{const s=nt(this,r,"m",ue).call(this,{chainId:e});t.push({...n,networkClientId:s})}catch(t){(0,Et.projectLogger)("Failed to get network client ID for incoming transaction",{chainId:e,error:t})}}this.update(e=>{const{transactions:n}=e;e.transactions=nt(this,r,"m",te).call(this,[...t,...n]),(0,Et.projectLogger)("Added incoming transactions to state",t.length,t)}),this.messenger.publish(`${Yt}:incomingTransactionsReceived`,t)},ge=function(e,t){if(!t||t===at.ORIGIN_METAMASK)return undefined;const{gasPrice:n,maxFeePerGas:r,maxPriorityFeePerGas:s,gas:a}=e;if(n===undefined&&r===undefined&&s===undefined&&a===undefined)return undefined;const i={};return n!==undefined?i.gasPrice=n:r===undefined&&s===undefined||(i.maxFeePerGas=r,i.maxPriorityFeePerGas=s),a!==undefined&&(i.gas=a),i},pe=function(e){const{chainId:t}=e,{transactions:n}=this.state,s=e?.txParams?.from,a=n.filter(e=>e.txParams.from===s&&e.chainId===t),i=a.filter(e=>e.status===At.TransactionStatus.confirmed),o=a.filter(e=>e.status===At.TransactionStatus.submitted);(0,xt.validateConfirmedExternalTransaction)(e,i,o);const c=0!==(e.history??[]).length||nt(this,M,"f")?e:(0,Gt.addInitialHistorySnapshot)(e);return this.update(e=>{e.transactions=nt(this,r,"m",te).call(this,[...e.transactions,c])}),c},fe=function(e){const t=nt(this,r,"m",ae).call(this,e);if(!t)return;const n=t.txParams?.nonce,s=t.txParams?.from,{chainId:a}=t,i=this.state.transactions.filter(t=>t.id!==e&&t.txParams.from===s&&n&&t.txParams.nonce===n&&t.chainId===a&&t.type!==At.TransactionType.incoming),o=i.map(e=>e.id);if(0!==i.length){this.update(e=>{for(const n of e.transactions)o.includes(n.id)&&(n.replacedBy=t?.hash,n.replacedById=t?.id)});for(const e of this.state.transactions)o.includes(e.id)&&e.status!==At.TransactionStatus.failed&&nt(this,r,"m",be).call(this,e)}},be=function(e){const t={...e,status:At.TransactionStatus.dropped};this.messenger.publish(`${Yt}:transactionDropped`,{transactionMeta:t}),this.updateTransaction(t,"TransactionController#setTransactionStatusDropped - Transaction dropped"),nt(this,r,"m",ve).call(this,t)},we=function(e){return this.state.transactions.find(t=>e&&t.actionId===e)},Ce=async function(e){return new Promise(t=>{nt(this,v,"f").once(`${e}:finished`,e=>{t(e)})})},ke=function(e,t){const n=(0,ht.cloneDeep)(e);for(const e of["r","s","v"]){const r=t[e];r!==undefined&&null!==r&&(n[e]=(0,ut.add0x)(r.toString(16)))}return n},ye=async function(e){const t=await nt(this,g,"f").call(this,e),n=await nt(this,m,"f").call(this);return t&&n},Te=async function(e){const{chainId:t,id:n,isExternalSign:s,txParams:i}=e;if(s)return(0,Et.projectLogger)("Skipping sign as signed externally"),undefined;const{authorizationList:c,from:l}=i,d=await(0,Ft.signAuthorizationList)({authorizationList:c,messenger:this.messenger,transactionMeta:e});d&&nt(this,r,"m",Ge).call(this,{transactionId:n},e=>{e.txParams.authorizationList=d}),(0,Et.projectLogger)("Calling before sign hook",e);const{updateTransaction:m}=await nt(this,u,"f").call(this,{transactionMeta:e})??{};m&&(nt(this,r,"m",Ge).call(this,{transactionId:n,skipResimulateCheck:!0,note:"beforeSign Hook"},m),(0,Et.projectLogger)("Updated transaction after before sign hook"));const g=nt(this,r,"m",ie).call(this,n),{txParams:p}=g,f=(0,$t.prepareTransaction)(t,p);nt(this,o,"f").add(n),(0,Et.projectLogger)("Signing transaction",p);const b=await new Promise((e,t)=>{nt(this,G,"f")?.call(this,f,l,...nt(this,h,"f").call(this,g)).then(e,t),nt(this,B,"f").set(n,()=>t(new Error("Signing aborted by user")))});if(nt(this,B,"f").delete(n),!b)return(0,Et.projectLogger)("Skipping signed status as no signed transaction"),undefined;const w=(0,ht.cloneDeep)(g);if(!nt(this,a,"f").call(this,w,b))return this.updateTransaction(w,"TransactionController#signTransaction - Update after sign"),(0,Et.projectLogger)("Skipping signed status based on hook"),undefined;const C={...nt(this,r,"m",ke).call(this,w,b),status:At.TransactionStatus.signed,txParams:p};this.updateTransaction(C,"TransactionController#approveTransaction - Transaction signed"),nt(this,r,"m",ve).call(this,C);const k=(0,$t.serializeTransaction)(b),y=(0,ht.merge)({},C,{rawTx:k});return this.updateTransaction(y,"TransactionController#approveTransaction - RawTransaction added"),k},ve=function(e){this.messenger.publish(`${Yt}:transactionStatusUpdated`,{transactionMeta:e})},Se=function(e,t,n){return(0,Ut.getAndFormatTransactionsForNonceTracker)(n,t,e,this.state.transactions)},Pe=function(e){(0,Et.projectLogger)("Processing confirmed transaction",e.id),nt(this,r,"m",fe).call(this,e.id),this.messenger.publish(`${Yt}:transactionConfirmed`,e),nt(this,r,"m",ve).call(this,e),nt(this,r,"m",Ie).call(this,e).catch(e=>{throw(0,Et.projectLogger)("Error while updating post balance",e),e})},Ie=async function(e){try{const{networkClientId:t,type:n}=e;if(n!==At.TransactionType.swap)return;const s=nt(this,r,"m",de).call(this,{networkClientId:t}),{updatedTransactionMeta:a,approvalTransactionMeta:i}=await(0,Wt.updatePostTransactionBalance)(e,{ethQuery:s,getTransaction:nt(this,r,"m",ae).bind(this),updateTransaction:this.updateTransaction.bind(this)});this.messenger.publish(`${Yt}:postTransactionBalanceUpdated`,{transactionMeta:a,approvalTransactionMeta:i})}catch(e){(0,Et.projectLogger)("Error while updating post transaction balance",e)}},Me=function({provider:e,blockTracker:t,chainId:n}){return new ct.NonceTracker({provider:e,blockTracker:t,getPendingTransactions:nt(this,r,"m",Ne).bind(this,n),getConfirmedTransactions:nt(this,r,"m",Se).bind(this,[At.TransactionStatus.confirmed],n)})},Ee=function({provider:e,blockTracker:t,chainId:n,networkClientId:s}){const a=new it.default(e),i=new Pt.PendingTransactionTracker({blockTracker:t,getChainId:()=>n,getEthQuery:()=>a,getNetworkClientId:()=>s,getTransactions:()=>this.state.transactions,isResubmitEnabled:nt(this,N,"f").isResubmitEnabled,getGlobalLock:()=>nt(this,x,"f").acquireNonceLockForChainIdKey({chainId:n}),messenger:this.messenger,publishTransaction:(e,t)=>nt(this,r,"m",Z).call(this,e,t,{skipSubmitHistory:!0}),hooks:{beforeCheckPendingTransaction:nt(this,c,"f").bind(this)}});return nt(this,r,"m",xe).call(this,i),i},_e=function(){nt(this,x,"f").stopAllTracking()},je=function(e){e.hub.on("transactions",nt(this,r,"m",me).bind(this))},Fe=function(e){e.hub.removeAllListeners("transaction-confirmed"),e.hub.removeAllListeners("transaction-dropped"),e.hub.removeAllListeners("transaction-failed"),e.hub.removeAllListeners("transaction-updated")},xe=function(e){e.hub.on("transaction-confirmed",nt(this,r,"m",Pe).bind(this)),e.hub.on("transaction-dropped",nt(this,r,"m",be).bind(this)),e.hub.on("transaction-failed",nt(this,r,"m",Xe).bind(this)),e.hub.on("transaction-updated",this.updateTransaction.bind(this))},Ne=function(e,t){return[...nt(this,r,"m",Se).call(this,[At.TransactionStatus.approved,At.TransactionStatus.signed,At.TransactionStatus.submitted],t,e),...nt(this,p,"f").call(this,t,e)]},Oe=async function(e,t){try{return await nt(this,r,"m",Z).call(this,e,t)}catch(e){if(nt(this,r,"m",De).call(this,e))throw new Error("Previous transaction is already confirmed");throw e}},De=function(e){return e?.message?.includes("nonce too low")||e?.data?.message?.includes("nonce too low")},Re=function(){return nt(this,$,"f")?[new Ct.TestGasFeeFlow]:[new bt.RandomisedEstimationsGasFeeFlow,new pt.LineaGasFeeFlow,new gt.DefaultGasFeeFlow]},Le=function(){return[new ft.OptimismLayer1GasFeeFlow,new wt.ScrollLayer1GasFeeFlow]},Ge=function({transactionId:e,note:t,skipHistory:n,skipValidation:s,skipResimulateCheck:a},i){let o;this.update(r=>{const c=r.transactions.findIndex(({id:t})=>t===e);if(-1===c)throw new Error(`Cannot update transaction as ID not found - ${e}`);let l=r.transactions[c];const u=(0,ht.cloneDeep)(l);l=i(l)??l,!0!==s&&(l.txParams=(0,qt.normalizeTransactionParams)(l.txParams),(0,zt.validateTxParams)(l.txParams)),!a&&nt(this,A,"f").call(this)&&(o=(0,It.shouldResimulate)(u,l));nt(this,M,"f")||n||(l=(0,Gt.updateTransactionHistory)(l,t??"Transaction updated")),r.transactions[c]=l});const c=nt(this,r,"m",ae).call(this,e);return o?.resimulate&&nt(this,r,"m",Be).call(this,c,{blockTime:o.blockTime}).catch(e=>{throw(0,Et.projectLogger)("Error during re-simulation",e),e}),c},Be=async function(e,{blockTime:t,traceContext:n}={}){const{chainId:s,id:a,nestedTransactions:i,networkClientId:o,simulationData:c,txParams:l}=e;let u,d={error:{code:At.SimulationErrorCode.Disabled,message:"Simulation disabled"},tokenBalanceChanges:[]},h=[],m=!1;const g=nt(this,U,"f").has(a);if(nt(this,A,"f").call(this)&&!g){const a=await nt(this,H,"f").call(this,{name:"Simulate",parentContext:n},()=>(0,_t.getBalanceChanges)({blockTime:t,chainId:s,ethQuery:nt(this,r,"m",de).call(this,{networkClientId:o}),getSimulationConfig:(t,n)=>nt(this,k,"f").call(this,t,{txMeta:e,...n}),nestedTransactions:i,txParams:l}));d=a.simulationData,u=a.gasUsed,t&&c&&(0,It.hasSimulationDataChanged)(c,d)&&(d={...d,isUpdatedAfterSecurityCheck:!0});const g=await(0,Dt.getGasFeeTokens)({chainId:s,getSimulationConfig:nt(this,k,"f"),isEIP7702GasFeeTokensEnabled:nt(this,P,"f"),messenger:this.messenger,publicKeyEIP7702:nt(this,O,"f"),transactionMeta:e});h=g?.gasFeeTokens??[],m=g?.isGasFeeSponsored??!1}if(!nt(this,r,"m",ae).call(this,a))return void(0,Et.projectLogger)("Cannot update simulation data as transaction not found",a,d);const p=nt(this,r,"m",Ge).call(this,{transactionId:a,note:"TransactionController#updateSimulationData - Update simulation data",skipResimulateCheck:Boolean(t)},e=>{e.gasFeeTokens=h,e.isGasFeeSponsored=m,e.gasUsed=u,g||(e.simulationData=d)});(0,Et.projectLogger)("Updated simulation data",a,p),await nt(this,r,"m",Ze).call(this,p)},Ue=function({transactionId:e,gasFeeEstimates:t,gasFeeEstimatesLoaded:n,layer1GasFee:s}){nt(this,r,"m",Ge).call(this,{transactionId:e,skipHistory:!0},e=>{(0,yt.updateTransactionGasProperties)({txMeta:e,gasFeeEstimates:t,gasFeeEstimatesLoaded:n,isTxParamsGasFeeUpdatesEnabled:nt(this,S,"f"),layer1GasFee:s})})},$e=function({transactionBatchId:e,gasFeeEstimates:t}){nt(this,r,"m",He).call(this,e,e=>({...e,gasFeeEstimates:t}))},He=function(e,t){this.update(n=>{const r=n.transactionBatches.findIndex(t=>t.id===e);if(-1===r)throw new Error(`Cannot update batch, ID not found - ${e}`);const s=n.transactionBatches[r],a=t(s);n.transactionBatches[r]=a??s})},We=function(){return this.messenger.call("AccountsController:getSelectedAccount")},Ke=function(){const e=this.messenger.call("AccountsController:getState");return Object.values(e.internalAccounts?.accounts??{}).filter(e=>"eip155:eoa"===e.type).map(e=>e.address)},qe=function(e,t){const{chainId:n,networkClientId:r,origin:s,rawTx:a,txParams:i}=e,{networkConfigurationsByChainId:o}=nt(this,b,"f").call(this),c=o[n],l=c?.rpcEndpoints.find(e=>e.networkClientId===r),u=l?.url,d={chainId:n,hash:t,networkType:l?.name??r,networkUrl:u,origin:s,rawTransaction:a,time:Date.now(),transaction:i};(0,Et.projectLogger)("Updating submit history",d),this.update(e=>{const{submitHistory:t}=e;100===t.length&&t.pop(),t.unshift(d)})},ze=async function(e){const{chainId:t,networkClientId:n}=e,s=nt(this,x,"f").getNetworkClient({networkClientId:n}).configuration.type===ot.NetworkClientType.Custom,a=nt(this,r,"m",de).call(this,{networkClientId:n});await(0,Ot.updateGas)({chainId:t,ethQuery:a,isCustomNetwork:s,isSimulationEnabled:nt(this,A,"f").call(this),getSimulationConfig:nt(this,k,"f"),messenger:this.messenger,txMeta:e})},Ve=function(){this.messenger.registerActionHandler(`${Yt}:addTransaction`,this.addTransaction.bind(this)),this.messenger.registerActionHandler(`${Yt}:addTransactionBatch`,this.addTransactionBatch.bind(this)),this.messenger.registerActionHandler(`${Yt}:confirmExternalTransaction`,this.confirmExternalTransaction.bind(this)),this.messenger.registerActionHandler(`${Yt}:estimateGas`,this.estimateGas.bind(this)),this.messenger.registerActionHandler(`${Yt}:getNonceLock`,this.getNonceLock.bind(this)),this.messenger.registerActionHandler(`${Yt}:getTransactions`,this.getTransactions.bind(this)),this.messenger.registerActionHandler(`${Yt}:updateCustodialTransaction`,this.updateCustodialTransaction.bind(this)),this.messenger.registerActionHandler(`${Yt}:updateTransaction`,this.updateTransaction.bind(this)),this.messenger.registerActionHandler(`${Yt}:emulateNewTransaction`,this.emulateNewTransaction.bind(this)),this.messenger.registerActionHandler(`${Yt}:emulateTransactionUpdate`,this.emulateTransactionUpdate.bind(this))},Ye=function(e){this.update(t=>{const n=t.transactions.filter(({id:t})=>t!==e);t.transactions=nt(this,r,"m",te).call(this,n)})},Qe=function(e){return[lt.errorCodes.provider.userRejectedRequest,zt.ErrorCode.RejectedUpgrade].includes(e.code)},Je=function(e,t,n){if(nt(this,r,"m",ee).call(this,e,t,n),n.code===lt.errorCodes.provider.userRejectedRequest)throw lt.providerErrors.userRejectedRequest({message:"MetaMask Tx Signature: User denied transaction signature.",data:n?.data});throw n},Xe=function(e,t,n){let s;try{s=nt(this,r,"m",Ge).call(this,{transactionId:e.id,note:"TransactionController#failTransaction - Add error message and set status to failed",skipValidation:!0},e=>{e.status=At.TransactionStatus.failed,e.error=(0,qt.normalizeTxError)(t)})}catch(n){(0,Et.projectLogger)("Failed to mark transaction as failed",n),s={...e,status:At.TransactionStatus.failed,error:(0,qt.normalizeTxError)(t)}}this.messenger.publish(`${Yt}:transactionFailed`,{actionId:n,error:t.message,transactionMeta:s}),nt(this,r,"m",ve).call(this,s),this.messenger.publish(`${Yt}:transactionFinished`,s),nt(this,v,"f").emit(`${e.id}:finished`,s)},Ze=async function(e){(0,Et.projectLogger)("Calling afterSimulate hook",e);const{id:t}=e,n=await nt(this,i,"f").call(this,{transactionMeta:e}),{skipSimulation:s,updateTransaction:a}=n||{};if(s?nt(this,U,"f").add(t):!1===s&&nt(this,U,"f").delete(t),!a)return;const o=nt(this,r,"m",Ge).call(this,{transactionId:t,skipResimulateCheck:!0,note:"afterSimulate Hook"},e=>{e.txParamsOriginal=(0,ht.cloneDeep)(e.txParams),a(e)});(0,Et.projectLogger)("Updated transaction with afterSimulate data",o)},et=async function({ethQuery:e,publishHookOverride:t,traceContext:n},s,a){let i;return await nt(this,H,"f").call(this,{name:"Publish",parentContext:n},async()=>{const n=t??nt(this,D,"f");({transactionHash:i}=await n(s,a)),i===undefined&&(i=await nt(this,r,"m",Z).call(this,e,{...s,rawTx:a}))}),(0,Et.projectLogger)("Publish successful",i),{transactionHash:i}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/TransactionController.cjs"}],[1783,{"../errors.cjs":1786,"../logger.cjs":1806,"@metamask/controller-utils":1384,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAccountTransactions=n.getAccountAddressRelationship=void 0;const r=e("@metamask/controller-utils"),s=e("@metamask/utils"),a=e("../errors.cjs"),i=e("../logger.cjs"),o="https://accounts.api.cx.metamask.io",c=`${o}/v1/accounts/`,l="x-metamask-clientproduct",u="metamask-transaction-controller",d=[1,10,56,137,8453,42161,59144,534352,1329,143],h=(0,s.createModuleLogger)(i.projectLogger,"accounts-api");n.getAccountAddressRelationship=async function(e){const{chainId:t,from:n,to:s}=e;if(!d.includes(t))throw h("Unsupported chain ID for account relationship API",t),new a.FirstTimeInteractionError("Unsupported chain ID");const i=`${o}/v1/networks/${t}/accounts/${n}/relationships/${s}`;h("Getting account address relationship",{request:e,url:i});const c={[l]:u},m=await(0,r.successfulFetch)(i,{headers:c});if(204===m.status)return{count:0};const g=await m.json();if(h("Retrieved account address relationship",g),g.error){const{code:e,message:t}=g.error;throw new a.FirstTimeInteractionError(t,e)}return g},n.getAccountTransactions=async function(e){const{address:t,chainIds:n,cursor:s,endTimestamp:a,sortDirection:i,startTimestamp:o,tags:d}=e;let m=`${c}${t}/transactions`;const g=[];if(n){const e=n.join(",");g.push(`networks=${e}`)}o&&g.push(`startTimestamp=${o}`),a&&g.push(`endTimestamp=${a}`),s&&g.push(`cursor=${s}`),i&&g.push(`sortDirection=${i}`),g.length&&(m+=`?${g.join("&")}`),h("Getting account transactions",{request:e,url:m});const p=[u,...d||[]].join("__"),f={[l]:p},b=await(0,r.successfulFetch)(m,{headers:f}),w=await b.json();return h("Retrieved account transactions",w),w}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/api/accounts-api.cjs"}],[1784,{"../constants.cjs":1785,"../errors.cjs":1786,"../logger.cjs":1806,"@metamask/controller-utils":1384,"@metamask/utils":3070,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.simulateTransactions=void 0;const r=e("@metamask/controller-utils"),s=e("@metamask/utils"),a=e("lodash"),i=e("../constants.cjs"),o=e("../errors.cjs"),c=e("../logger.cjs"),l=(0,s.createModuleLogger)(c.projectLogger,"simulation-api"),u="networks";let d=0;function h(e){return"https://tx-sentinel-{0}.api.cx.metamask.io/".replace("{0}",e)}n.simulateTransactions=async function(e,t){let n=await async function(e){const t=await async function(){const e=`${h("ethereum-mainnet")}${u}`,t=await fetch(e);return t.json()}(),n=(0,r.convertHexToDecimal)(e),s=t[n];if(!s?.confirmations)throw l("Chain is not supported",e),new o.SimulationChainNotSupportedError(e);return h(s.network)}(e);const{newUrl:s,authorization:c}=await t.getSimulationConfig(n)||{};s&&(n=s);const m=d;d+=1;const g=function(e){const t=(0,a.cloneDeep)(e);for(const e of t.transactions){const n=e.to?.toLowerCase();i.DELEGATION_MANAGER_ADDRESSES.includes(n)&&(t.overrides=t.overrides||{},t.overrides[n]={code:i.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS})}return t}(t);l("Sending request",n,t);const p={"Content-Type":"application/json"};c&&(p.Authorization=c);const f=await fetch(n,{method:"POST",headers:p,body:JSON.stringify({id:String(m),jsonrpc:"2.0",method:"infura_simulateTransactions",params:[g]})}),b=await f.json();if(l("Received response",b),b.error){const{code:e,message:t}=b.error;throw new o.SimulationError(t,e)}return b?.result}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/api/simulation-api.cjs"}],[1785,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS=n.DELEGATION_MANAGER_ADDRESSES=n.ABI_IERC7821=n.ABI_SIMULATION_ERC721_LEGACY=n.ABI_SIMULATION_ERC20_WRAPPED=n.CHAIN_IDS=void 0,n.CHAIN_IDS={MAINNET:"0x1",GOERLI:"0x5",BASE:"0x2105",BASE_TESTNET:"0x14a33",BSC:"0x38",BSC_TESTNET:"0x61",OPTIMISM:"0xa",OPTIMISM_TESTNET:"0x1a4",OPBNB:"0xcc",OPBNB_TESTNET:"0x15eb",OPTIMISM_SEPOLIA:"0xaa37dc",POLYGON:"0x89",POLYGON_TESTNET:"0x13881",AVALANCHE:"0xa86a",AVALANCHE_TESTNET:"0xa869",FANTOM:"0xfa",FANTOM_TESTNET:"0xfa2",SEPOLIA:"0xaa36a7",LINEA_GOERLI:"0xe704",LINEA_SEPOLIA:"0xe705",LINEA_MAINNET:"0xe708",MOONBEAM:"0x504",MOONBEAM_TESTNET:"0x507",MOONRIVER:"0x505",MONAD:"0x8f",GNOSIS:"0x64",ARBITRUM:"0xa4b1",ZKSYNC_ERA:"0x144",ZORA:"0x76adf1",SCROLL:"0x82750",SCROLL_SEPOLIA:"0x8274f",MEGAETH_TESTNET:"0x18c6",SEI:"0x531"},n.ABI_SIMULATION_ERC20_WRAPPED=[{anonymous:!1,inputs:[{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"wad",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!1,name:"wad",type:"uint256"}],name:"Withdrawal",type:"event"}],n.ABI_SIMULATION_ERC721_LEGACY=[{anonymous:!1,inputs:[{indexed:!1,name:"_from",type:"address"},{indexed:!1,name:"_to",type:"address"},{indexed:!1,name:"_tokenId",type:"uint256"}],name:"Transfer",type:"event"}],n.ABI_IERC7821=[{type:"function",name:"execute",inputs:[{name:"mode",type:"bytes32",internalType:"ModeCode"},{name:"executionData",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"supportsExecutionMode",inputs:[{name:"mode",type:"bytes32",internalType:"ModeCode"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"}],n.DELEGATION_MANAGER_ADDRESSES=["0xdb9b1e94b5b69df7e401ddbede43491141047db3"],n.CODE_DELEGATION_MANAGER_NO_SIGNATURE_ERRORS="0x608060405234801561001057600080fd5b506004361061012c5760003560e01c806383ebb771116100ad578063acb8cc4911610071578063acb8cc491461027f578063cef6d2091461029f578063e30c3978146102b2578063f2fde38b146102c3578063ffa1ad74146102d657600080fd5b806383ebb771146102065780638456cb591461020e57806384b0196e146102165780638da5cb5b14610231578063a3f4df7e1461024257600080fd5b806358909ebc116100f457806358909ebc146101b05780635c975abb146101d157806366134607146101e3578063715018a6146101f657806379ba5097146101fe57600080fd5b80631b13cac2146101315780632d40d0521461014d5780633ed01015146101805780633f4ba83a14610195578063499340471461019d575b600080fd5b61013a60001981565b6040519081526020015b60405180910390f35b61017061015b36600461207e565b60046020526000908152604090205460ff1681565b6040519015158152602001610144565b61019361018e366004612097565b6102fa565b005b6101936103f4565b6101936101ab366004612097565b610406565b6101b9610a1181565b6040516001600160a01b039091168152602001610144565b600154600160a01b900460ff16610170565b61013a6101f1366004612097565b6104f6565b61019361050f565b610193610521565b61013a61056a565b610193610579565b61021e610589565b6040516101449796959493929190612128565b6000546001600160a01b03166101b9565b610272604051806040016040528060118152602001702232b632b3b0ba34b7b726b0b730b3b2b960791b81525081565b60405161014491906121c1565b610272604051806040016040528060018152602001603160f81b81525081565b6101936102ad36600461221f565b6105cf565b6001546001600160a01b03166101b9565b6101936102d13660046122d4565b611829565b610272604051806040016040528060058152602001640312e332e360dc1b81525081565b61030a60408201602083016122d4565b6001600160a01b03811633146103335760405163b9f0f17160e01b815260040160405180910390fd5b600061033e836104f6565b60008181526004602052604090205490915060ff1661037057604051637952fbad60e11b815260040160405180910390fd5b6000818152600460209081526040909120805460ff19169055610395908401846122d4565b6001600160a01b03166103ae60408501602086016122d4565b6001600160a01b0316827f3feadce88fc1b49db633a56fd5307ed6ee18734df83bcc4011daa720c9cd95f1866040516103e7919061241c565b60405180910390a4505050565b6103fc61189a565b6104046118c7565b565b61041660408201602083016122d4565b6001600160a01b038116331461043f5760405163b9f0f17160e01b815260040160405180910390fd5b600061044a836104f6565b60008181526004602052604090205490915060ff161561047c57604051625ecddb60e01b815260040160405180910390fd5b6000818152600460209081526040909120805460ff191660011790556104a4908401846122d4565b6001600160a01b03166104bd60408501602086016122d4565b6001600160a01b0316827fea589ba9473ee1fe77d352c7ed919747715a5d22931b972de9b02a907c66d5dd866040516103e7919061241c565b6000610509610504836127bb565b61191c565b92915050565b61051761189a565b61040460006119b7565b60015433906001600160a01b0316811461055e5760405163118cdaa760e01b81526001600160a01b03821660048201526024015b60405180910390fd5b610567816119b7565b50565b60006105746119d0565b905090565b61058161189a565b610404611afb565b60006060806000806000606061059d611b3e565b6105a5611b6b565b60408051600080825260208201909252600f60f81b9b939a50919850469750309650945092509050565b6105d7611b98565b8481811415806105e75750808414155b1561060557604051631bcaf69f60e01b815260040160405180910390fd5b6000816001600160401b0381111561061f5761061f6124ed565b60405190808252806020026020018201604052801561065257816020015b606081526020019060019003908161063d5790505b5090506000826001600160401b0381111561066f5761066f6124ed565b6040519080825280602002602001820160405280156106a257816020015b606081526020019060019003908161068d5790505b50905060005b83811015610c195760008a8a838181106106c4576106c46127c7565b90506020028101906106d691906127dd565b8101906106e39190612823565b905080516000036107d1576040805160008082526020820190925290610765565b6107526040518060c0016040528060006001600160a01b0316815260200160006001600160a01b03168152602001600080191681526020016060815260200160008152602001606081525090565b8152602001906001900390816107045790505b50848381518110610778576107786127c7565b602090810291909101015260006040519080825280602002602001820160405280156107ae578160200160208202803683370190505b508383815181106107c1576107c16127c7565b6020026020010181905250610c10565b808483815181106107e4576107e46127c7565b6020026020010181905250600081516001600160401b0381111561080a5761080a6124ed565b604051908082528060200260200182016040528015610833578160200160208202803683370190505b50905080848481518110610849576108496127c7565b6020026020010181905250336001600160a01b031682600081518110610871576108716127c7565b6020026020010151600001516001600160a01b0316141580156108c65750610a116001600160a01b0316826000815181106108ae576108ae6127c7565b6020026020010151600001516001600160a01b031614155b156108e457604051632d618d8160e21b815260040160405180910390fd5b60005b8251811015610a4d576000838281518110610904576109046127c7565b602002602001015190506109178161191c565b838381518110610929576109296127c7565b60200260200101818152505080602001516001600160a01b03163b6000036109a657600061099e61099461095b61056a565b86868151811061096d5761096d6127c7565b602002602001015160405161190160f01b8152600281019290925260228201526042902090565b8360a00151611bc3565b905050610a44565b60006109c56109b361056a565b85858151811061096d5761096d6127c7565b9050600082602001516001600160a01b0316631626ba7e838560a001516040518363ffffffff1660e01b81526004016109ff9291906128d3565b602060405180830381865afa158015610a1c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610a4091906128f4565b5050505b506001016108e7565b5060005b8251811015610c0d5760046000838381518110610a7057610a706127c7565b60209081029190910181015182528101919091526040016000205460ff1615610aac576040516302dd502960e11b815260040160405180910390fd5b60018351610aba9190612934565b8114610bc35781610acc826001612947565b81518110610adc57610adc6127c7565b6020026020010151838281518110610af657610af66127c7565b60200260200101516040015114610b2057604051636f6a1b8760e11b815260040160405180910390fd5b600083610b2e836001612947565b81518110610b3e57610b3e6127c7565b6020026020010151600001519050610a116001600160a01b0316816001600160a01b031614158015610b9f5750806001600160a01b0316848381518110610b8757610b876127c7565b6020026020010151602001516001600160a01b031614155b15610bbd57604051632d618d8160e21b815260040160405180910390fd5b50610c05565b60001960001b838281518110610bdb57610bdb6127c7565b60200260200101516040015114610c0557604051636f6a1b8760e11b815260040160405180910390fd5b600101610a51565b50505b506001016106a8565b5060005b83811015610e3e576000838281518110610c3957610c396127c7565b6020026020010151511115610e365760005b838281518110610c5d57610c5d6127c7565b602002602001015151811015610e34576000848381518110610c8157610c816127c7565b60200260200101518281518110610c9a57610c9a6127c7565b602002602001015160600151905060005b8151811015610e2a576000828281518110610cc857610cc86127c7565b6020026020010151600001519050806001600160a01b031663414c3e33848481518110610cf757610cf76127c7565b602002602001015160200151858581518110610d1557610d156127c7565b6020026020010151604001518f8f8a818110610d3357610d336127c7565b905060200201358e8e8b818110610d4c57610d4c6127c7565b9050602002810190610d5e91906127dd565b8c8c81518110610d7057610d706127c7565b60200260200101518b81518110610d8957610d896127c7565b60200260200101518e8d81518110610da357610da36127c7565b60200260200101518c81518110610dbc57610dbc6127c7565b602002602001015160200151336040518963ffffffff1660e01b8152600401610dec98979695949392919061295a565b600060405180830381600087803b158015610e0657600080fd5b505af1158015610e1a573d6000803e3d6000fd5b5050505050806001019050610cab565b5050600101610c4b565b505b600101610c1d565b5060005b8381101561146257828181518110610e5c57610e5c6127c7565b602002602001015151600003610f1a573363d691c964898984818110610e8457610e846127c7565b90506020020135888885818110610e9d57610e9d6127c7565b9050602002810190610eaf91906127dd565b6040518463ffffffff1660e01b8152600401610ecd939291906129c5565b6000604051808303816000875af1158015610eec573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610f1491908101906129e8565b5061145a565b60005b838281518110610f2f57610f2f6127c7565b602002602001015151811015611106576000848381518110610f5357610f536127c7565b60200260200101518281518110610f6c57610f6c6127c7565b602002602001015160600151905060005b81518110156110fc576000828281518110610f9a57610f9a6127c7565b6020026020010151600001519050806001600160a01b031663a145832a848481518110610fc957610fc96127c7565b602002602001015160200151858581518110610fe757610fe76127c7565b6020026020010151604001518f8f8a818110611005576110056127c7565b905060200201358e8e8b81811061101e5761101e6127c7565b905060200281019061103091906127dd565b8c8c81518110611042576110426127c7565b60200260200101518b8151811061105b5761105b6127c7565b60200260200101518e8d81518110611075576110756127c7565b60200260200101518c8151811061108e5761108e6127c7565b602002602001015160200151336040518963ffffffff1660e01b81526004016110be98979695949392919061295a565b600060405180830381600087803b1580156110d857600080fd5b505af11580156110ec573d6000803e3d6000fd5b5050505050806001019050610f7d565b5050600101610f1d565b50828181518110611119576111196127c7565b60200260200101516001848381518110611135576111356127c7565b6020026020010151516111489190612934565b81518110611158576111586127c7565b6020026020010151602001516001600160a01b031663d691c964898984818110611184576111846127c7565b9050602002013588888581811061119d5761119d6127c7565b90506020028101906111af91906127dd565b6040518463ffffffff1660e01b81526004016111cd939291906129c5565b6000604051808303816000875af11580156111ec573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405261121491908101906129e8565b506000838281518110611229576112296127c7565b60200260200101515190505b801561145857600084838151811061124f5761124f6127c7565b60200260200101516001836112649190612934565b81518110611274576112746127c7565b60200260200101516060015190506000815190505b80156114455760008261129d600184612934565b815181106112ad576112ad6127c7565b6020026020010151600001519050806001600160a01b031663d3eddcc5846001856112d89190612934565b815181106112e8576112e86127c7565b602002602001015160200151856001866113029190612934565b81518110611312576113126127c7565b6020026020010151604001518f8f8a818110611330576113306127c7565b905060200201358e8e8b818110611349576113496127c7565b905060200281019061135b91906127dd565b8c8c8151811061136d5761136d6127c7565b602002602001015160018c6113829190612934565b81518110611392576113926127c7565b60200260200101518e8d815181106113ac576113ac6127c7565b602002602001015160018d6113c19190612934565b815181106113d1576113d16127c7565b602002602001015160200151336040518963ffffffff1660e01b815260040161140198979695949392919061295a565b600060405180830381600087803b15801561141b57600080fd5b505af115801561142f573d6000803e3d6000fd5b50505050508061143e90612ac7565b9050611289565b50508061145190612ac7565b9050611235565b505b600101610e42565b5060005b838110156116de576000838281518110611482576114826127c7565b60200260200101515111156116d65760008382815181106114a5576114a56127c7565b60200260200101515190505b80156116d45760008483815181106114cb576114cb6127c7565b60200260200101516001836114e09190612934565b815181106114f0576114f06127c7565b60200260200101516060015190506000815190505b80156116c157600082611519600184612934565b81518110611529576115296127c7565b6020026020010151600001519050806001600160a01b031663ed463367846001856115549190612934565b81518110611564576115646127c7565b6020026020010151602001518560018661157e9190612934565b8151811061158e5761158e6127c7565b6020026020010151604001518f8f8a8181106115ac576115ac6127c7565b905060200201358e8e8b8181106115c5576115c56127c7565b90506020028101906115d791906127dd565b8c8c815181106115e9576115e96127c7565b602002602001015160018c6115fe9190612934565b8151811061160e5761160e6127c7565b60200260200101518e8d81518110611628576116286127c7565b602002602001015160018d61163d9190612934565b8151811061164d5761164d6127c7565b602002602001015160200151336040518963ffffffff1660e01b815260040161167d98979695949392919061295a565b600060405180830381600087803b15801561169757600080fd5b505af11580156116ab573d6000803e3d6000fd5b5050505050806116ba90612ac7565b9050611505565b5050806116cd90612ac7565b90506114b1565b505b600101611466565b5060005b8381101561181d5760008382815181106116fe576116fe6127c7565b60200260200101515111156118155760005b838281518110611722576117226127c7565b60200260200101515181101561181357336001600160a01b031684838151811061174e5761174e6127c7565b6020026020010151600186858151811061176a5761176a6127c7565b60200260200101515161177d9190612934565b8151811061178d5761178d6127c7565b6020026020010151602001516001600160a01b03167f40dadaa36c6c2e3d7317e24757451ffb2d603d875f0ad5e92c5dd156573b18738685815181106117d5576117d56127c7565b602002602001015184815181106117ee576117ee6127c7565b60200260200101516040516118039190612ade565b60405180910390a3600101611710565b505b6001016116e2565b50505050505050505050565b61183161189a565b600180546001600160a01b0383166001600160a01b031990911681179091556118626000546001600160a01b031690565b6001600160a01b03167f38d16b8cac22d99fc7c124b9cd0de2d3fa1faef420bfe791d8c362d765e2270060405160405180910390a350565b6000546001600160a01b031633146104045760405163118cdaa760e01b8152336004820152602401610555565b6118cf611bed565b6001805460ff60a01b191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa335b6040516001600160a01b03909116815260200160405180910390a1565b6000807f88c1d2ecf185adf710588203a5f263f0ff61be0d33da39792cde19ba9aa4331e83600001518460200151856040015161195c8760600151611c17565b6080808901516040805160208101989098526001600160a01b03968716908801529490931660608601529184015260a083015260c082015260e0015b60408051601f1981840301815291905280516020909101209392505050565b600180546001600160a01b031916905561056781611ce2565b6000306001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016148015611a2957507f000000000000000000000000000000000000000000000000000000000000000046145b15611a5357507f000000000000000000000000000000000000000000000000000000000000000090565b610574604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60208201527f0000000000000000000000000000000000000000000000000000000000000000918101919091527f000000000000000000000000000000000000000000000000000000000000000060608201524660808201523060a082015260009060c00160405160208183030381529060405280519060200120905090565b611b03611b98565b6001805460ff60a01b1916600160a01b1790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a2586118ff3390565b60606105747f00000000000000000000000000000000000000000000000000000000000000006002611d32565b60606105747f00000000000000000000000000000000000000000000000000000000000000006003611d32565b600154600160a01b900460ff16156104045760405163d93c066560e01b815260040160405180910390fd5b600080600080611bd38686611ddd565b925092509250611be38282611e2a565b5090949350505050565b600154600160a01b900460ff1661040457604051638dfc202b60e01b815260040160405180910390fd5b60008082516001600160401b03811115611c3357611c336124ed565b604051908082528060200260200182016040528015611c5c578160200160208202803683370190505b50905060005b8351811015611cb257611c8d848281518110611c8057611c806127c7565b6020026020010151611ee7565b828281518110611c9f57611c9f6127c7565b6020908102919091010152600101611c62565b5080604051602001611cc49190612bcb565b60405160208183030381529060405280519060200120915050919050565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b606060ff8314611d4c57611d4583611f48565b9050610509565b818054611d5890612c01565b80601f0160208091040260200160405190810160405280929190818152602001828054611d8490612c01565b8015611dd15780601f10611da657610100808354040283529160200191611dd1565b820191906000526020600020905b815481529060010190602001808311611db457829003601f168201915b50505050509050610509565b60008060008351604103611e175760208401516040850151606086015160001a611e0988828585611f87565b955095509550505050611e23565b50508151600091506002905b9250925092565b6000826003811115611e3e57611e3e612c3b565b03611e47575050565b6001826003811115611e5b57611e5b612c3b565b03611e795760405163f645eedf60e01b815260040160405180910390fd5b6002826003811115611e8d57611e8d612c3b565b03611eae5760405163fce698f760e01b815260048101829052602401610555565b6003826003811115611ec257611ec2612c3b565b03611ee3576040516335e2f38360e21b815260048101829052602401610555565b5050565b6000807f80ad7e1b04ee6d994a125f4714ca0720908bd80ed16063ec8aee4b88e9253e2d8360000151846020015180519060200120604051602001611998939291909283526001600160a01b03919091166020830152604082015260600190565b60606000611f5583612056565b604080516020808252818301909252919250600091906020820181803683375050509182525060208101929092525090565b600080807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0841115611fc2575060009150600390508261204c565b604080516000808252602082018084528a905260ff891692820192909252606081018790526080810186905260019060a0016020604051602081039080840390855afa158015612016573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b0381166120425750600092506001915082905061204c565b9250600091508190505b9450945094915050565b600060ff8216601f81111561050957604051632cd44ac360e21b815260040160405180910390fd5b60006020828403121561209057600080fd5b5035919050565b6000602082840312156120a957600080fd5b81356001600160401b038111156120bf57600080fd5b820160c081850312156120d157600080fd5b9392505050565b60005b838110156120f35781810151838201526020016120db565b50506000910152565b600081518084526121148160208601602086016120d8565b601f01601f19169290920160200192915050565b60ff60f81b881681526000602060e0602084015261214960e084018a6120fc565b838103604085015261215b818a6120fc565b606085018990526001600160a01b038816608086015260a0850187905284810360c08601528551808252602080880193509091019060005b818110156121af57835183529284019291840191600101612193565b50909c9b505050505050505050505050565b6020815260006120d160208301846120fc565b60008083601f8401126121e657600080fd5b5081356001600160401b038111156121fd57600080fd5b6020830191508360208260051b850101111561221857600080fd5b9250929050565b6000806000806000806060878903121561223857600080fd5b86356001600160401b038082111561224f57600080fd5b61225b8a838b016121d4565b9098509650602089013591508082111561227457600080fd5b6122808a838b016121d4565b9096509450604089013591508082111561229957600080fd5b506122a689828a016121d4565b979a9699509497509295939492505050565b80356001600160a01b03811681146122cf57600080fd5b919050565b6000602082840312156122e657600080fd5b6120d1826122b8565b6000808335601e1984360301811261230657600080fd5b83016020810192503590506001600160401b0381111561232557600080fd5b80360382131561221857600080fd5b81835281816020850137506000828201602090810191909152601f909101601f19169091010190565b60008383855260208086019550808560051b830101846000805b8881101561240e57858403601f19018a52823536899003605e1901811261239c578283fd5b880160606001600160a01b036123b1836122b8565b1686526123c0878301836122ef565b82898901526123d28389018284612334565b9250505060406123e4818401846122ef565b9350878303828901526123f8838583612334565b9d89019d97505050938601935050600101612377565b509198975050505050505050565b6020815260006001600160a01b0380612434856122b8565b16602084015280612447602086016122b8565b16604084015250604083013560608301526060830135601e1984360301811261246f57600080fd5b83016020810190356001600160401b0381111561248b57600080fd5b8060051b360382131561249d57600080fd5b60c060808501526124b260e08501828461235d565b915050608084013560a08401526124cc60a08501856122ef565b848303601f190160c08601526124e3838284612334565b9695505050505050565b634e487b7160e01b600052604160045260246000fd5b604051606081016001600160401b0381118282101715612525576125256124ed565b60405290565b60405160c081016001600160401b0381118282101715612525576125256124ed565b604051601f8201601f191681016001600160401b0381118282101715612575576125756124ed565b604052919050565b60006001600160401b03821115612596576125966124ed565b5060051b60200190565b60006001600160401b038211156125b9576125b96124ed565b50601f01601f191660200190565b600082601f8301126125d857600080fd5b81356125eb6125e6826125a0565b61254d565b81815284602083860101111561260057600080fd5b816020850160208301376000918101602001919091529392505050565b600082601f83011261262e57600080fd5b8135602061263e6125e68361257d565b82815260059290921b8401810191818101908684111561265d57600080fd5b8286015b8481101561270c5780356001600160401b03808211156126815760008081fd5b908801906060828b03601f190181131561269b5760008081fd5b6126a3612503565b6126ae8885016122b8565b8152604080850135848111156126c45760008081fd5b6126d28e8b838901016125c7565b838b0152509184013591838311156126ea5760008081fd5b6126f88d8a858801016125c7565b908201528652505050918301918301612661565b509695505050505050565b600060c0828403121561272957600080fd5b61273161252b565b905061273c826122b8565b815261274a602083016122b8565b60208201526040820135604082015260608201356001600160401b038082111561277357600080fd5b61277f8583860161261d565b60608401526080840135608084015260a08401359150808211156127a257600080fd5b506127af848285016125c7565b60a08301525092915050565b60006105093683612717565b634e487b7160e01b600052603260045260246000fd5b6000808335601e198436030181126127f457600080fd5b8301803591506001600160401b0382111561280e57600080fd5b60200191503681900382131561221857600080fd5b6000602080838503121561283657600080fd5b82356001600160401b038082111561284d57600080fd5b818501915085601f83011261286157600080fd5b813561286f6125e68261257d565b81815260059190911b8301840190848101908883111561288e57600080fd5b8585015b838110156128c6578035858111156128aa5760008081fd5b6128b88b89838a0101612717565b845250918601918601612892565b5098975050505050505050565b8281526040602082015260006128ec60408301846120fc565b949350505050565b60006020828403121561290657600080fd5b81516001600160e01b0319811681146120d157600080fd5b634e487b7160e01b600052601160045260246000fd5b818103818111156105095761050961291e565b808201808211156105095761050961291e565b60e08152600061296d60e083018b6120fc565b828103602084015261297f818b6120fc565b9050886040840152828103606084015261299a81888a612334565b608084019690965250506001600160a01b0392831660a0820152911660c09091015295945050505050565b8381526040602082015260006129df604083018486612334565b95945050505050565b600060208083850312156129fb57600080fd5b82516001600160401b0380821115612a1257600080fd5b818501915085601f830112612a2657600080fd5b8151612a346125e68261257d565b81815260059190911b83018401908481019088831115612a5357600080fd5b8585015b838110156128c657805185811115612a6f5760008081fd5b8601603f81018b13612a815760008081fd5b878101516040612a936125e6836125a0565b8281528d82848601011115612aa85760008081fd5b612ab7838c83018487016120d8565b8652505050918601918601612a57565b600081612ad657612ad661291e565b506000190190565b602080825282516001600160a01b0390811683830152838201518116604080850191909152808501516060808601919091528086015160c06080870152805160e0870181905260009594610100600583901b8901810195919493870193919290890190885b81811015612b9d5760ff198b8903018352855187815116895289810151858b8b0152612b71868b01826120fc565b918701518a83038b890152919050612b8981836120fc565b995050509488019491880191600101612b43565b50505050505050608085015160a085015260a08501519150601f198482030160c08501526129df81836120fc565b815160009082906020808601845b83811015612bf557815185529382019390820190600101612bd9565b50929695505050505050565b600181811c90821680612c1557607f821691505b602082108103612c3557634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052602160045260246000fdfea264697066735822122073f8fd2b36b643aff6f988638bc7c8ab2f41546c01a777524170b479e36618c564736f6c63430008170033"}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/constants.cjs"}],[1786,{"./types.cjs":1807},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SimulationRevertedError=n.SimulationInvalidResponseError=n.SimulationChainNotSupportedError=n.FirstTimeInteractionError=n.SimulationError=void 0;const r=e("./types.cjs");class s extends Error{constructor(e,t){super(e??"Simulation failed"),this.code=t}}n.SimulationError=s;class a extends Error{constructor(e,t){super(e??"Error checking first time interaction"),this.code=t}}n.FirstTimeInteractionError=a;n.SimulationChainNotSupportedError=class extends s{constructor(e){super(`Chain is not supported: ${e}`,r.SimulationErrorCode.ChainNotSupported)}};n.SimulationInvalidResponseError=class extends s{constructor(){super("Invalid response from simulation API",r.SimulationErrorCode.InvalidResponse)}};n.SimulationRevertedError=class extends s{constructor(){super("Transaction was reverted",r.SimulationErrorCode.Reverted)}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/errors.cjs"}],[1787,{"../logger.cjs":1806,"../types.cjs":1807,"../utils/gas-fees.cjs":1815,"@metamask/gas-fee-controller":2060,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultGasFeeFlow=void 0;const u=e("@metamask/gas-fee-controller"),d=e("@metamask/utils"),h=e("../logger.cjs"),m=e("../types.cjs"),g=e("../utils/gas-fees.cjs"),p=(0,d.createModuleLogger)(h.projectLogger,"default-gas-fee-flow");n.DefaultGasFeeFlow=class{constructor(){r.add(this)}matchesTransaction(){return!0}async getGasFees(e){const{gasFeeControllerData:t}=e,{gasEstimateType:n,gasFeeEstimates:o}=t;let c;switch(n){case u.GAS_ESTIMATE_TYPES.FEE_MARKET:p("Using fee market estimates",o),c=l(this,r,"m",s).call(this,o);break;case u.GAS_ESTIMATE_TYPES.LEGACY:p("Using legacy estimates",o),c=l(this,r,"m",a).call(this,o);break;case u.GAS_ESTIMATE_TYPES.ETH_GASPRICE:p("Using eth_gasPrice estimates",o),c=l(this,r,"m",i).call(this,o);break;default:throw new Error(`Unsupported gas estimate type: ${n}`)}return{estimates:c}}},r=new WeakSet,s=function(e){const t=Object.values(m.GasFeeEstimateLevel).reduce((t,n)=>({...t,[n]:l(this,r,"m",o).call(this,e,n)}),{});return{type:m.GasFeeEstimateType.FeeMarket,...t}},a=function(e){const t=Object.values(m.GasFeeEstimateLevel).reduce((t,n)=>({...t,[n]:l(this,r,"m",c).call(this,e,n)}),{});return{type:m.GasFeeEstimateType.Legacy,...t}},i=function(e){return{type:m.GasFeeEstimateType.GasPrice,gasPrice:(0,g.gweiDecimalToWeiHex)(e.gasPrice)}},o=function(e,t){return{maxFeePerGas:(0,g.gweiDecimalToWeiHex)(e[t].suggestedMaxFeePerGas),maxPriorityFeePerGas:(0,g.gweiDecimalToWeiHex)(e[t].suggestedMaxPriorityFeePerGas)}},c=function(e,t){return(0,g.gweiDecimalToWeiHex)(e[t])}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/gas-flows/DefaultGasFeeFlow.cjs"}],[1788,{"../logger.cjs":1806,"../types.cjs":1807,"./DefaultGasFeeFlow.cjs":1787,"@metamask/controller-utils":1384,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.LineaGasFeeFlow=void 0;const u=e("@metamask/controller-utils"),d=e("@metamask/utils"),h=e("./DefaultGasFeeFlow.cjs"),m=e("../logger.cjs"),g=e("../types.cjs"),p=(0,d.createModuleLogger)(m.projectLogger,"linea-gas-fee-flow"),f=[u.ChainId["linea-mainnet"],u.ChainId["linea-goerli"],u.ChainId["linea-sepolia"]],b={low:1,medium:1.35,high:1.7},w={low:1,medium:1.05,high:1.1};n.LineaGasFeeFlow=class{constructor(){r.add(this)}matchesTransaction({transactionMeta:e}){return f.includes(e.chainId)}async getGasFees(e){try{return await l(this,r,"m",s).call(this,e)}catch(t){return p("Using default flow as fallback due to error",t),(new h.DefaultGasFeeFlow).getGasFees(e)}}},r=new WeakSet,s=async function(e){const{ethQuery:t,transactionMeta:n}=e,s=await l(this,r,"m",a).call(this,n,t);p("Received Linea response",s);const d=l(this,r,"m",i).call(this,s.baseFeePerGas,b);p("Generated base fees",l(this,r,"m",c).call(this,d));const h=l(this,r,"m",i).call(this,s.priorityFeePerGas,w);p("Generated priority fees",l(this,r,"m",c).call(this,h));const m=l(this,r,"m",o).call(this,d,h);p("Generated max fees",l(this,r,"m",c).call(this,m));return{estimates:Object.values(g.GasFeeEstimateLevel).reduce((e,t)=>({...e,[t]:{maxFeePerGas:(0,u.toHex)(m[t]),maxPriorityFeePerGas:(0,u.toHex)(h[t])}}),{type:g.GasFeeEstimateType.FeeMarket})}},a=function(e,t){return(0,u.query)(t,"linea_estimateGas",[{from:e.txParams.from,to:e.txParams.to,value:e.txParams.value,input:e.txParams.data}])},i=function(e,t){const n=(0,u.hexToBN)(e);return{low:n.muln(t.low),medium:n.muln(t.medium),high:n.muln(t.high)}},o=function(e,t){return{low:e.low.add(t.low),medium:e.medium.add(t.medium),high:e.high.add(t.high)}},c=function(e){return Object.values(g.GasFeeEstimateLevel).map(t=>e[t].toString(10))}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/gas-flows/LineaGasFeeFlow.cjs"}],[1789,{"../constants.cjs":1785,"./OracleLayer1GasFeeFlow.cjs":1790,"@metamask/controller-utils":1384,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OptimismLayer1GasFeeFlow=void 0;const r=e("@metamask/controller-utils"),s=e("@metamask/utils"),a=e("./OracleLayer1GasFeeFlow.cjs"),i=e("../constants.cjs"),o=[i.CHAIN_IDS.OPTIMISM,i.CHAIN_IDS.OPTIMISM_TESTNET,i.CHAIN_IDS.BASE,i.CHAIN_IDS.BASE_TESTNET,i.CHAIN_IDS.OPBNB,i.CHAIN_IDS.OPBNB_TESTNET,i.CHAIN_IDS.ZORA];class c extends a.OracleLayer1GasFeeFlow{async matchesTransaction({transactionMeta:e}){const t=(0,s.hexToNumber)(e.chainId),n=await c.fetchOptimismSupportedChains();return!!n?.has(t)||o.includes(e.chainId)}static async fetchOptimismSupportedChains(){try{const e=await(0,r.handleFetch)("https://gas.api.cx.metamask.io/v1/supportedNetworks");return new Set(e?.partialSupport?.optimism??[])}catch{return null}}}n.OptimismLayer1GasFeeFlow=c}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/gas-flows/OptimismLayer1GasFeeFlow.cjs"}],[179,{"@metamask/phishing-controller":2415,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PhishingControllerInit=void 0;var r=e("@metamask/phishing-controller");e("@metamask/utils");n.PhishingControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.PhishingController({messenger:e,state:t.PhishingController,hotlistRefreshInterval:undefined,stalelistRefreshInterval:undefined})})}}},{package:"$root$",file:"app/scripts/controller-init/phishing-controller-init.ts"}],[1790,{"../logger.cjs":1806,"../utils/prepare.cjs":1821,"../utils/utils.cjs":1826,"@ethersproject/contracts":728,"@ethersproject/providers":766,"@metamask/utils":3070,"bn.js":3977,buffer:4038},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r,s,a,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OracleLayer1GasFeeFlow=void 0;const d=e("@ethersproject/contracts"),h=e("@ethersproject/providers"),m=e("@metamask/utils"),g=u(e("bn.js")),p=e("../logger.cjs"),f=e("../utils/prepare.cjs"),b=e("../utils/utils.cjs"),w=(0,m.createModuleLogger)(p.projectLogger,"oracle-layer1-gas-fee-flow"),C=new g.default(0),k=[{inputs:[{internalType:"bytes",name:"_data",type:"bytes"}],name:"getL1Fee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_gasUsed",type:"uint256"}],name:"getOperatorFee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}];n.OracleLayer1GasFeeFlow=class{constructor(){r.add(this)}getOracleAddressForChain(e){return"0x420000000000000000000000000000000000000F"}shouldSignTransaction(){return!1}async getLayer1Fee(e){try{const{provider:t,transactionMeta:n}=e,i=l(this,r,"m",c).call(this,t,n.chainId),o=await l(this,r,"m",s).call(this,i,n),u=await l(this,r,"m",a).call(this,i,n);return{layer1Fee:(0,m.add0x)((0,b.padHexToEvenLength)(o.add(u).toString(16)))}}catch(e){throw w("Failed to get oracle layer 1 gas fee",e),new Error("Failed to get oracle layer 1 gas fee")}}},r=new WeakSet,s=async function(e,t){const n=l(this,r,"m",i).call(this,t,this.shouldSignTransaction()).serialize(),s=await e.getL1Fee(n);if(s===undefined)throw new Error("No value returned from oracle contract");return(0,b.toBN)(s)},a=async function(e,t){const{gasUsed:n}=t;if(!n)return C;try{const t=await e.getOperatorFee(n);return t===undefined?C:(0,b.toBN)(t)}catch(e){return w("Failed to get operator layer 1 gas fee",e),C}},i=function(e,n){const s=l(this,r,"m",o).call(this,e),{chainId:a}=e;let i=(0,f.prepareTransaction)(a,s);if(n){const e=t.from("abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789","hex"),n=Uint8Array.from(e);i=i.sign(n)}return i},o=function(e){return{...e.txParams,gasLimit:e.txParams.gas}},c=function(e,t){return new d.Contract(this.getOracleAddressForChain(t),k,new h.Web3Provider(e))}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/gas-flows/OracleLayer1GasFeeFlow.cjs"}],[1791,{"../logger.cjs":1806,"../types.cjs":1807,"../utils/feature-flags.cjs":1812,"../utils/gas-fees.cjs":1815,"./DefaultGasFeeFlow.cjs":1787,"@metamask/gas-fee-controller":2060,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.randomiseDecimalGWEIAndConvertToHex=n.RandomisedEstimationsGasFeeFlow=void 0;const l=e("@metamask/gas-fee-controller"),u=e("@metamask/utils"),d=e("./DefaultGasFeeFlow.cjs"),h=e("../logger.cjs"),m=e("../types.cjs"),g=e("../utils/feature-flags.cjs"),p=e("../utils/gas-fees.cjs"),f=(0,u.createModuleLogger)(h.projectLogger,"randomised-estimation-gas-fee-flow");function b(e,t,n){const r=(0,p.gweiDecimalToWeiDecimal)(e),s=r.length,a=Math.min(t,s-n);if(0===Number(r)||a<=0)return`0x${Number(r).toString(16)}`;const i=s-a,o=r.slice(0,i),c=r.slice(-a),l=function(e,t){const n=10**e;return t+Math.floor(Math.random()*(n-t))}(a,Number(c)),d=`0x${(BigInt(o+"0".repeat(a))+BigInt(l)).toString(16)}`;return(0,u.add0x)(d)}n.RandomisedEstimationsGasFeeFlow=class{constructor(){r.add(this)}matchesTransaction({transactionMeta:e,messenger:t}){const{chainId:n}=e;return(0,g.getGasFeeRandomisation)(t).randomisedGasFeeDigits[n]!==undefined}async getGasFees(e){try{return await c(this,r,"m",a).call(this,e)}catch(t){return f("Using default flow as fallback due to error",t),await c(this,r,"m",s).call(this,e)}}},r=new WeakSet,s=async function(e){return(new d.DefaultGasFeeFlow).getGasFees(e)},a=async function(e){const{messenger:t,gasFeeControllerData:n,transactionMeta:a}=e,{gasEstimateType:o,gasFeeEstimates:u}=n,d=(0,g.getGasFeeRandomisation)(t),h=d.randomisedGasFeeDigits[a.chainId],m=d.preservedNumberOfDigits??2;if(o===l.GAS_ESTIMATE_TYPES.FEE_MARKET){f("Randomising fee market estimates",u);const e=c(this,r,"m",i).call(this,u,h,m);return f("Added randomised fee market estimates",e),{estimates:e}}return await c(this,r,"m",s).call(this,e)},i=function(e,t,n){const s=Object.values(m.GasFeeEstimateLevel).reduce((s,a)=>({...s,[a]:c(this,r,"m",o).call(this,e,a,t,n)}),{});return{type:m.GasFeeEstimateType.FeeMarket,...s}},o=function(e,t,n,r){return{maxFeePerGas:(0,p.gweiDecimalToWeiHex)(e[t].suggestedMaxFeePerGas),maxPriorityFeePerGas:b(e[t].suggestedMaxPriorityFeePerGas,n,r)}},n.randomiseDecimalGWEIAndConvertToHex=b}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/gas-flows/RandomisedEstimationsGasFeeFlow.cjs"}],[1792,{"../constants.cjs":1785,"./OracleLayer1GasFeeFlow.cjs":1790},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ScrollLayer1GasFeeFlow=void 0;const r=e("./OracleLayer1GasFeeFlow.cjs"),s=e("../constants.cjs"),a=[s.CHAIN_IDS.SCROLL,s.CHAIN_IDS.SCROLL_SEPOLIA];class i extends r.OracleLayer1GasFeeFlow{getOracleAddressForChain(e){return"0x5300000000000000000000000000000000000002"}shouldSignTransaction(){return!0}async matchesTransaction({transactionMeta:e}){return a.includes(e.chainId)}}n.ScrollLayer1GasFeeFlow=i}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/gas-flows/ScrollLayer1GasFeeFlow.cjs"}],[1793,{"../types.cjs":1807,"@metamask/controller-utils":1384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},o=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.TestGasFeeFlow=void 0;const c=e("@metamask/controller-utils"),l=e("../types.cjs"),u=1e15;n.TestGasFeeFlow=class{constructor(){r.add(this),s.set(this,1)}matchesTransaction(){return!0}async getGasFees(e){const{transactionMeta:t}=e,{txParams:n}=t,{gas:c}=n;if(!c)throw new Error("Cannot estimate fee without gas value");const d=parseInt(c,16),h=.5*u,m=(i(this,s,"f")+1)*u,g=i(this,s,"f")*u,p=m-h,f=g-h,b=m+h,w=g+h;return o(this,s,i(this,s,"f")+1,"f"),{estimates:{type:l.GasFeeEstimateType.FeeMarket,low:{maxFeePerGas:i(this,r,"m",a).call(this,p,d),maxPriorityFeePerGas:i(this,r,"m",a).call(this,f,d)},medium:{maxFeePerGas:i(this,r,"m",a).call(this,m,d),maxPriorityFeePerGas:i(this,r,"m",a).call(this,g,d)},high:{maxFeePerGas:i(this,r,"m",a).call(this,b,d),maxPriorityFeePerGas:i(this,r,"m",a).call(this,w,d)}}}}},s=new WeakMap,r=new WeakSet,a=function(e,t){const n=Math.ceil(e/t);return(0,c.toHex)(n)}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/gas-flows/TestGasFeeFlow.cjs"}],[1794,{"../api/accounts-api.cjs":1783,"../constants.cjs":1785,"../index.cjs":1805,"../logger.cjs":1806,"../types.cjs":1807,"@metamask/controller-utils":1384,"bn.js":3977,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AccountsApiRemoteTransactionSource=n.SUPPORTED_CHAIN_IDS=void 0;const l=e("@metamask/controller-utils"),u=c(e("bn.js")),d=e("uuid"),h=e("../index.cjs"),m=e("../api/accounts-api.cjs"),g=e("../constants.cjs"),p=e("../logger.cjs"),f=e("../types.cjs");n.SUPPORTED_CHAIN_IDS=[g.CHAIN_IDS.MAINNET,g.CHAIN_IDS.POLYGON,g.CHAIN_IDS.BSC,g.CHAIN_IDS.LINEA_MAINNET,g.CHAIN_IDS.BASE,g.CHAIN_IDS.OPTIMISM,g.CHAIN_IDS.ARBITRUM,g.CHAIN_IDS.SCROLL,g.CHAIN_IDS.SEI,g.CHAIN_IDS.MONAD];const b=(0,p.createModuleLogger)(p.incomingTransactionsLogger,"accounts-api-source");n.AccountsApiRemoteTransactionSource=class{constructor(){r.add(this)}getSupportedChains(){return n.SUPPORTED_CHAIN_IDS}async fetchTransactions(e){const{address:t}=e,c=await o(this,r,"m",s).call(this,e,n.SUPPORTED_CHAIN_IDS);b("Fetched transactions",c.length,c);const l=await Promise.all(c.map(e=>o(this,r,"m",i).call(this,t,e)));b("Normalized transactions",l);const u=o(this,r,"m",a).call(this,e,l);return b("Filtered transactions",u.length,u),u}},r=new WeakSet,s=async function(e,t){const{address:n,tags:r}=e,s=[];try{const e=await(0,m.getAccountTransactions)({address:n,chainIds:t,sortDirection:"DESC",tags:r});e?.data&&s.push(...e.data)}catch(e){b("Error while fetching transactions",e)}return s},a=function(e,t){const{address:n,includeTokenTransfers:r,updateTransactions:s}=e;let a=t;return s||(a=a.filter(e=>e.txParams.to===n)),r||(a=a.filter(e=>!e.isTransfer)),a},i=async function(e,t){const n=String(t.blockNumber),r=`0x${t.chainId.toString(16)}`,{hash:s}=t,a=new Date(t.timestamp).getTime(),i=(0,d.v1)({msecs:a}),{from:o}=t,c=(0,l.BNToHex)(new u.default(t.gas)),m=(0,l.BNToHex)(new u.default(t.gasPrice)),g=(0,l.BNToHex)(new u.default(t.gasUsed)),p=(0,l.BNToHex)(new u.default(t.nonce)),b=t.methodId,w=f.TransactionType.incoming,C=t.isError?f.TransactionStatus.failed:f.TransactionStatus.confirmed,k=t.valueTransfers.find(t=>(t.to.toLowerCase()===e.toLowerCase()||t.from.toLowerCase()===e.toLowerCase())&&t.contractAddress),y=k?.to.toLowerCase()===e.toLowerCase()&&o.toLowerCase()!==e.toLowerCase(),T=o.toLowerCase()===e.toLowerCase(),v=k?.amount,S=k?.contractAddress,P=k?.decimal,I=k?.symbol,M=(0,l.BNToHex)(new u.default(y?k?.amount??t.value:t.value)),E=y?e:t.to,A={blockNumber:n,chainId:r,error:C===f.TransactionStatus.failed?new Error("Transaction failed"):undefined,hash:s,id:i,isTransfer:y,networkClientId:"",status:C,time:a,toSmartContract:!1,transferInformation:k?{amount:v,contractAddress:S,decimals:P,symbol:I}:undefined,txParams:{chainId:r,data:b,from:o,gas:c,gasPrice:m,gasUsed:g,nonce:p,to:E,value:M},type:w,verifiedOnBlockchain:!1};return T&&(A.type=(await(0,h.determineTransactionType)(A.txParams)).type),A}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/helpers/AccountsApiRemoteTransactionSource.cjs"}],[1795,{"../gas-flows/DefaultGasFeeFlow.cjs":1787,"../logger.cjs":1806,"../types.cjs":1807,"../utils/gas-flow.cjs":1816,"../utils/layer1-gas-fee-flow.cjs":1819,"@metamask/eth-query":1972,"@metamask/utils":3070,events:4338},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g,p,f,b,w,C,k,y,T,v,S,P,I=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},M=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},E=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateTransactionGasEstimates=n.updateTransactionGasProperties=n.GasFeePoller=void 0;const A=E(e("@metamask/eth-query")),_=e("@metamask/utils"),j=E(e("events")),F=e("../gas-flows/DefaultGasFeeFlow.cjs"),x=e("../logger.cjs"),N=e("../types.cjs"),O=e("../utils/gas-flow.cjs"),D=e("../utils/layer1-gas-fee-flow.cjs"),R=(0,_.createModuleLogger)(x.projectLogger,"gas-fee-poller");function L(e,t,n,r){const{type:s}=t;if(r){if(s===N.GasFeeEstimateType.FeeMarket){const r=t;e.maxFeePerGas=r[n]?.maxFeePerGas,e.maxPriorityFeePerGas=r[n]?.maxPriorityFeePerGas}if(s===N.GasFeeEstimateType.GasPrice){const n=t;e.maxFeePerGas=n.gasPrice,e.maxPriorityFeePerGas=n.gasPrice}if(s===N.GasFeeEstimateType.Legacy){const r=t[n];e.maxFeePerGas=r,e.maxPriorityFeePerGas=r}delete e.gasPrice}else{if(s===N.GasFeeEstimateType.FeeMarket){const r=t;e.gasPrice=r[n]?.maxFeePerGas}if(s===N.GasFeeEstimateType.GasPrice){const n=t;e.gasPrice=n.gasPrice}if(s===N.GasFeeEstimateType.Legacy){const r=t;e.gasPrice=r[n]}delete e.maxFeePerGas,delete e.maxPriorityFeePerGas}}n.GasFeePoller=class{constructor({findNetworkClientIdByChainId:e,gasFeeFlows:t,getGasFeeControllerEstimates:n,getProvider:f,getTransactions:b,getTransactionBatches:w,layer1GasFeeFlows:C,messenger:k,onStateChange:y}){r.add(this),this.hub=new j.default,s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),m.set(this,!1),I(this,s,e,"f"),I(this,a,t,"f"),I(this,u,C,"f"),I(this,i,n,"f"),I(this,o,f,"f"),I(this,c,b,"f"),I(this,l,w,"f"),I(this,d,k,"f"),y(()=>{const e=M(this,r,"m",v).call(this),t=M(this,r,"m",S).call(this);e.length||t.length?M(this,r,"m",g).call(this):M(this,r,"m",p).call(this)})}},s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,r=new WeakSet,g=function(){M(this,m,"f")||(M(this,r,"m",f).call(this),I(this,m,!0,"f"),R("Started polling"))},p=function(){M(this,m,"f")&&(clearTimeout(M(this,h,"f")),I(this,h,undefined,"f"),I(this,m,!1,"f"),R("Stopped polling"))},f=async function e(){await M(this,r,"m",b).call(this),await M(this,r,"m",w).call(this),I(this,h,setTimeout(()=>M(this,r,"m",e).call(this),1e4),"f")},b=async function(){const e=M(this,r,"m",v).call(this);if(!e.length)return;R("Found unapproved transactions",e.length);const t=await M(this,r,"m",P).call(this,e);R("Retrieved gas fee controller data",t),await Promise.all(e.flatMap(e=>{const{chainId:n}=e,s=t.get(n);return M(this,r,"m",C).call(this,e,s)}))},w=async function(){const e=M(this,r,"m",S).call(this);if(!e.length)return;R("Found unapproved transaction batches",e.length);const t=await M(this,r,"m",P).call(this,e);R("Retrieved gas fee controller data",t),await Promise.all(e.flatMap(e=>{const{chainId:n}=e,s=t.get(n);return M(this,r,"m",k).call(this,e,s)}))},C=async function(e,t){const{id:n}=e,[s,a]=await Promise.all([M(this,r,"m",y).call(this,e,t),M(this,r,"m",T).call(this,e)]);(s||a)&&this.hub.emit("transaction-updated",{transactionId:n,gasFeeEstimates:s?.gasFeeEstimates,gasFeeEstimatesLoaded:s?.gasFeeEstimatesLoaded,layer1GasFee:a})},k=async function(e,t){const{id:n}=e,r=new A.default(M(this,o,"f").call(this,e.networkClientId)),s=new F.DefaultGasFeeFlow,a={ethQuery:r,gasFeeControllerData:t,messenger:M(this,d,"f"),transactionMeta:{...e,txParams:{...e.transactions?.[0],from:e.from,gas:e.gas},time:Date.now()}};let i;try{i=(await s.getGasFees(a)).estimates}catch(t){R("Failed to get gas fees for batch",e.id,t)}i&&this.hub.emit("transaction-batch-updated",{transactionBatchId:n,gasFeeEstimates:i,gasFeeEstimatesLoaded:!0})},y=async function(e,t){const{networkClientId:n}=e,r=new A.default(M(this,o,"f").call(this,n)),s=(0,O.getGasFeeFlow)(e,M(this,a,"f"),M(this,d,"f"));s&&R("Found gas fee flow",s.constructor.name,e.id);const i={ethQuery:r,gasFeeControllerData:t,messenger:M(this,d,"f"),transactionMeta:e};let c;if(s)try{c=(await s.getGasFees(i)).estimates}catch(t){R("Failed to get suggested gas fees",e.id,t)}return!c&&e.gasFeeEstimatesLoaded?undefined:(R("Updated gas fee estimates",{gasFeeEstimates:c,transaction:e.id}),{gasFeeEstimates:c,gasFeeEstimatesLoaded:!0})},T=async function(e){const{networkClientId:t}=e,n=M(this,o,"f").call(this,t),r=await(0,D.getTransactionLayer1GasFee)({layer1GasFeeFlows:M(this,u,"f"),messenger:M(this,d,"f"),provider:n,transactionMeta:e});return r&&R("Updated layer 1 gas fee",r,e.id),r},v=function(){return M(this,c,"f").call(this).filter(e=>e.status===N.TransactionStatus.unapproved)},S=function(){return M(this,l,"f").call(this).filter(e=>e.status===N.TransactionStatus.unapproved)},P=async function(e){const t=new Map;for(const n of e){const{chainId:e,networkClientId:r}=n;if(t.has(e))continue;const a=r??M(this,s,"f").call(this,e);t.set(e,a)}R("Extracted network client IDs by chain ID",t);const n=Array.from(t.entries()).map(async([e,t])=>[e,await M(this,i,"f").call(this,{networkClientId:t})]);return new Map(await Promise.all(n))},n.updateTransactionGasProperties=function({gasFeeEstimates:e,gasFeeEstimatesLoaded:t,isTxParamsGasFeeUpdatesEnabled:n,layer1GasFee:r,txMeta:s}){const a=s.userFeeLevel,i=Object.values(N.GasFeeEstimateLevel).includes(a);if(n(s)&&i&&e){const t=s.txParams.type!==N.TransactionEnvelopeType.legacy;L(s.txParams,e,a,t)}e&&(s.gasFeeEstimates=e),t!==undefined&&(s.gasFeeEstimatesLoaded=t),r&&(s.layer1GasFee=r)},n.updateTransactionGasEstimates=function({txMeta:e,userFeeLevel:t}){const{txParams:n,gasFeeEstimates:r}=e;if(!r)return;L(n,r,t,e.txParams.type!==N.TransactionEnvelopeType.legacy)}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/helpers/GasFeePoller.cjs"}],[1796,{"../logger.cjs":1806,"../utils/feature-flags.cjs":1812,events:4338},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g,p,f,b,w,C,k,y=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},T=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},v=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.IncomingTransactionHelper=void 0;const S=v(e("events")),P=e("../logger.cjs"),I=e("../utils/feature-flags.cjs");n.IncomingTransactionHelper=class{constructor({client:e,getCurrentAccount:t,getLocalTransactions:n,includeTokenTransfers:f,isEnabled:b,messenger:w,remoteTransactionSource:C,trimTransactions:k,updateTransactions:T}){r.add(this),s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),m.set(this,void 0),g.set(this,void 0),p.set(this,void 0),this.hub=new S.default,y(this,s,e,"f"),y(this,a,t,"f"),y(this,i,n,"f"),y(this,o,f,"f"),y(this,c,b??(()=>!0),"f"),y(this,l,!1,"f"),y(this,u,!1,"f"),y(this,d,w,"f"),y(this,h,C,"f"),y(this,g,k,"f"),y(this,p,T,"f")}start(){if(T(this,l,"f"))return;if(!T(this,r,"m",w).call(this))return;const e=T(this,r,"m",C).call(this);(0,P.incomingTransactionsLogger)("Started polling",{interval:e}),y(this,l,!0,"f"),T(this,u,"f")||T(this,r,"m",f).call(this).catch(e=>{(0,P.incomingTransactionsLogger)("Initial polling failed",e)})}stop(){T(this,m,"f")&&clearTimeout(T(this,m,"f")),T(this,l,"f")&&(y(this,l,!1,"f"),(0,P.incomingTransactionsLogger)("Stopped polling"))}async update({isInterval:e,tags:t}={}){const n=T(this,r,"m",k).call(this,t,e);if((0,P.incomingTransactionsLogger)("Checking for incoming transactions",{isInterval:Boolean(e),tags:n}),!T(this,r,"m",w).call(this))return;const s=T(this,a,"f").call(this),c=T(this,o,"f")??!0,l=T(this,p,"f")??!1;let u=[];try{u=await T(this,h,"f").fetchTransactions({address:s.address,includeTokenTransfers:c,tags:n,updateTransactions:l})}catch(e){return void(0,P.incomingTransactionsLogger)("Error while fetching remote transactions",e)}if(!u.length)return;T(this,r,"m",b).call(this,u),(0,P.incomingTransactionsLogger)("Found potential transactions",u.length,u);const d=T(this,i,"f").call(this),m=u.filter(e=>!d.some(t=>t.hash?.toLowerCase()===e.hash?.toLowerCase()&&t.txParams.from?.toLowerCase()===e.txParams.from?.toLowerCase()&&t.type===e.type));if(!m.length)return void(0,P.incomingTransactionsLogger)("All transactions are already known");(0,P.incomingTransactionsLogger)("Found unique transactions",m.length,m);const f=T(this,g,"f").call(this,[...m,...d]),C=m.map(e=>e.id),y=f.filter(e=>C.includes(e.id));y.length?((0,P.incomingTransactionsLogger)("Adding new transactions",y.length,y),this.hub.emit("transactions",y)):(0,P.incomingTransactionsLogger)("All unique transactions truncated due to limit")}},s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,g=new WeakMap,p=new WeakMap,r=new WeakSet,f=async function e(){y(this,u,!0,"f");try{await this.update({isInterval:!0})}catch(e){console.error("Error while checking incoming transactions",e)}y(this,u,!1,"f"),T(this,l,"f")&&(T(this,m,"f")&&clearTimeout(T(this,m,"f")),y(this,m,setTimeout(()=>T(this,r,"m",e).call(this),T(this,r,"m",C).call(this)),"f"))},b=function(e){e.sort((e,t)=>e.time<t.time?-1:1)},w=function(){return T(this,c,"f").call(this)},C=function(){return(0,I.getIncomingTransactionsPollingInterval)(T(this,d,"f"))},k=function(e,t){const n=[];return T(this,s,"f")&&n.push(T(this,s,"f")),e?.length?n.push(...e):t&&n.push("automatic-polling"),n?.length?n:undefined}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/helpers/IncomingTransactionHelper.cjs"}],[1797,{"../logger.cjs":1806,"@metamask/utils":3070,"async-mutex":3860,"eth-method-registry":4262,events:4338},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.MethodDataHelper=void 0;const h=e("@metamask/utils"),m=e("async-mutex"),g=e("eth-method-registry"),p=d(e("events")),f=e("../logger.cjs"),b=(0,h.createModuleLogger)(f.projectLogger,"method-data");n.MethodDataHelper=class{constructor({getProvider:e,getState:t}){r.add(this),s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,new m.Mutex),this.hub=new p.default,l(this,s,e,"f"),l(this,a,t,"f"),l(this,i,new Map,"f")}async lookup(e,t){b("lookup",e,t);const n=await u(this,o,"f").acquire();try{const n=u(this,a,"f").call(this)[e];if(n)return b("Cached",n),n;let o=u(this,i,"f").get(t);if(!o){const e=u(this,s,"f").call(this,t);o=new g.MethodRegistry({provider:e}),u(this,i,"f").set(t,o),b("Created registry",t)}const l=await u(this,r,"m",c).call(this,e,o);return b("Result",l),this.hub.emit("update",{fourBytePrefix:e,methodData:l}),l}finally{n()}}},s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,r=new WeakSet,c=async function(e,t){const n=await t.lookup(e);if(!n)return b("No method found",e),{registryMethod:"",parsedRegistryMethod:{name:undefined,args:undefined}};b("Parsing",n);return{registryMethod:n,parsedRegistryMethod:t.parse(n)}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/helpers/MethodDataHelper.cjs"}],[1798,{"../logger.cjs":1806,"async-mutex":3860},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g,p=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},f=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainTrackingHelper=void 0;const b=e("async-mutex"),w=e("../logger.cjs"),C=(0,w.createModuleLogger)(w.projectLogger,"multichain-tracking");n.MultichainTrackingHelper=class{constructor({findNetworkClientIdByChainId:e,getNetworkClientById:t,getNetworkClientRegistry:n,removePendingTransactionTrackerListeners:b,createNonceTracker:w,createPendingTransactionTracker:k,onNetworkStateChange:y}){r.add(this),s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,new Map),d.set(this,new Map),this.checkForPendingTransactionAndStartPolling=()=>{for(const[,e]of f(this,d,"f"))e.pendingTransactionTracker.startIfPendingTransactions()},h.set(this,e=>{const t=Object.keys(e),n=Array.from(f(this,d,"f").keys()),s=n.filter(e=>!t.includes(e));s.forEach(e=>{f(this,r,"m",m).call(this,e)});const a=t.filter(e=>!n.includes(e));a.forEach(e=>{f(this,r,"m",g).call(this,e)}),a.length&&C("Added trackers",a),s.length&&C("Removed trackers",s)}),p(this,s,e,"f"),p(this,a,t,"f"),p(this,i,n,"f"),p(this,o,b,"f"),p(this,c,w,"f"),p(this,l,k,"f"),y((e,t)=>{const n=f(this,i,"f").call(this);t.forEach(({op:e,path:t})=>{if("remove"===e&&"networkConfigurations"===t[0]){const e=t[1];delete n[e]}}),f(this,h,"f").call(this,n)})}initialize(){const e=f(this,i,"f").call(this);f(this,h,"f").call(this,e),C("Initialized")}has(e){return f(this,d,"f").has(e)}async acquireNonceLockForChainIdKey({chainId:e,key:t="global"}){let n=f(this,u,"f").get(e);n||(n=new Map,f(this,u,"f").set(e,n));let r=n.get(t);return r||(r=new b.Mutex,n.set(t,r)),await r.acquire()}async getNonceLock(e,t){const n=f(this,a,"f").call(this,t),r=await this.acquireNonceLockForChainIdKey({chainId:n.configuration.chainId,key:e}),s=f(this,d,"f").get(t)?.nonceTracker;if(!s)throw new Error(`Missing nonce tracker for network client ID - ${t}`);try{const t=await s.getNonceLock(e),n=()=>{t.releaseLock(),r?.()};return{...t,releaseLock:n}}catch(e){throw r?.(),e}}stopAllTracking(){for(const[e]of f(this,d,"f"))f(this,r,"m",m).call(this,e)}getNetworkClient({chainId:e,networkClientId:t}){if(!t&&!e)throw new Error("Cannot locate network client without networkClientId or chainId");let n,r=t;try{t&&(n=f(this,a,"f").call(this,t))}catch(n){if(C("No network client found with ID",t),!e)throw n}return!n&&e&&(r=f(this,s,"f").call(this,e),n=f(this,a,"f").call(this,r)),{...n,id:r}}},s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,r=new WeakSet,m=function(e){const t=f(this,d,"f").get(e);t&&(t.pendingTransactionTracker.stop(),f(this,o,"f").call(this,t.pendingTransactionTracker),f(this,d,"f").delete(e))},g=function(e){if(f(this,d,"f").get(e))return;const{provider:t,blockTracker:n,configuration:{chainId:r}}=f(this,a,"f").call(this,e),s=f(this,c,"f").call(this,{provider:t,blockTracker:n,chainId:r}),i=f(this,l,"f").call(this,{provider:t,blockTracker:n,chainId:r,networkClientId:e});f(this,d,"f").set(e,{nonceTracker:s,pendingTransactionTracker:i})}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/helpers/MultichainTrackingHelper.cjs"}],[1799,{"../logger.cjs":1806,"../types.cjs":1807,"./TransactionPoller.cjs":1801,"@metamask/controller-utils":1384,events:4338,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g,p,f,b,w,C,k,y,T,v,S,P,I,M,E,A,_,j,F,x,N,O,D,R,L,G,B=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},U=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},$=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PendingTransactionTracker=void 0;const H=e("@metamask/controller-utils"),W=$(e("events")),K=e("lodash"),q=e("./TransactionPoller.cjs"),z=e("../logger.cjs"),V=e("../types.cjs"),Y=["replacement transaction underpriced","known transaction","gas price too low to replace","transaction with the same hash was already imported","gateway timeout","nonce too low"],Q=(0,z.createModuleLogger)(z.projectLogger,"pending-transactions");n.PendingTransactionTracker=class{constructor({blockTracker:e,getChainId:t,getEthQuery:n,getGlobalLock:k,getNetworkClientId:y,getTransactions:T,hooks:v,isResubmitEnabled:S,messenger:P,publishTransaction:I}){r.add(this),s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),m.set(this,void 0),g.set(this,void 0),p.set(this,void 0),f.set(this,void 0),b.set(this,void 0),this.startIfPendingTransactions=()=>{const e=U(this,r,"m",_).call(this);e.length?U(this,r,"m",w).call(this,e):this.stop()},this.hub=new W.default,B(this,s,new Map,"f"),B(this,a,t,"f"),B(this,i,n,"f"),B(this,o,y,"f"),B(this,c,T,"f"),B(this,l,S??(()=>!0),"f"),B(this,u,U(this,r,"m",C).bind(this),"f"),B(this,h,k,"f"),B(this,m,I,"f"),B(this,g,!1,"f"),B(this,f,undefined,"f"),B(this,p,new q.TransactionPoller({blockTracker:e,chainId:t(),messenger:P}),"f"),B(this,b,v?.beforeCheckPendingTransaction??(()=>Promise.resolve(!0)),"f"),B(this,d,(0,z.createModuleLogger)(Q,`${t()}:${y()}`),"f")}addTransactionToPoll(e){U(this,r,"m",w).call(this,[e]),B(this,f,e,"f")}async forceCheckTransaction(e){const t=await U(this,h,"f").call(this);try{await U(this,r,"m",I).call(this,e)}catch(e){U(this,d,"f").call(this,"Failed to check transaction",e)}finally{t()}}stop(){U(this,g,"f")&&(U(this,p,"f").stop(),B(this,g,!1,"f"),U(this,d,"f").call(this,"Stopped polling"))}},s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,g=new WeakMap,p=new WeakMap,f=new WeakMap,b=new WeakMap,r=new WeakSet,w=function(e){U(this,p,"f").setPendingTransactions(e),U(this,g,"f")||(U(this,p,"f").start(U(this,u,"f")),B(this,g,!0,"f"),U(this,d,"f").call(this,"Started polling"))},C=async function(e){const t=await U(this,h,"f").call(this);try{await U(this,r,"m",k).call(this)}catch(e){U(this,d,"f").call(this,"Failed to check transactions",e)}finally{t()}try{await U(this,r,"m",y).call(this,e)}catch(e){U(this,d,"f").call(this,"Failed to resubmit transactions",e)}},k=async function(){U(this,d,"f").call(this,"Checking transactions");const e=[...U(this,r,"m",_).call(this),...U(this,f,"f")?[U(this,f,"f")]:[]];e.length?(U(this,d,"f").call(this,"Found pending transactions to check",{count:e.length,ids:e.map(e=>e.id)}),await Promise.all(e.map(e=>U(this,r,"m",I).call(this,e)))):U(this,d,"f").call(this,"No pending transactions to check")},y=async function(e){if(!U(this,l,"f").call(this)||!U(this,g,"f"))return;U(this,d,"f").call(this,"Resubmitting transactions");const t=U(this,r,"m",_).call(this);if(t.length){U(this,d,"f").call(this,"Found pending transactions to resubmit",{count:t.length,ids:t.map(e=>e.id)});for(const n of t)try{await U(this,r,"m",v).call(this,n,e)}catch(e){const t=e.value?.message?.toLowerCase()||e.message?.toLowerCase()||String(e);if(U(this,r,"m",T).call(this,t)){U(this,d,"f").call(this,"Ignoring known transaction error",t);continue}U(this,r,"m",j).call(this,n,e.message,"There was an error when resubmitting this transaction.")}}else U(this,d,"f").call(this,"No pending transactions to resubmit")},T=function(e){return Y.some(t=>e.includes(t))},v=async function(e,t){if(!U(this,r,"m",S).call(this,e,t))return;if(!await U(this,b,"f").call(this,e))return;const n=U(this,i,"f").call(this,e.networkClientId);await U(this,m,"f").call(this,n,e);const s=(e.retryCount??0)+1;U(this,r,"m",N).call(this,(0,K.merge)({},e,{retryCount:s}),"PendingTransactionTracker:transaction-retry - Retry count increased")},S=function(e,t){const n=(0,K.cloneDeep)(e);n.firstRetryBlockNumber||(n.firstRetryBlockNumber=t,U(this,r,"m",N).call(this,n,"PendingTransactionTracker:#isResubmitDue - First retry block number set"));const{firstRetryBlockNumber:s}=n,a=Number.parseInt(t,16)-Number.parseInt(s,16),i=e.retryCount||0;return a>=Math.min(50,Math.pow(2,i))},P=function(e){U(this,f,"f")?.id===e&&B(this,f,undefined,"f")},I=async function(e){const{hash:t,id:n,isIntentComplete:s}=e;if(s)await U(this,r,"m",M).call(this,e);else{if(!t&&await U(this,b,"f").call(this,e)){const t=new Error("We had an error while submitting this transaction, please try again.");return t.name="NoTxHashError",void U(this,r,"m",F).call(this,e,t)}if(U(this,r,"m",A).call(this,e))return U(this,d,"f").call(this,"Nonce already taken",n),void U(this,r,"m",x).call(this,e);try{const n=await U(this,r,"m",O).call(this,t),s="0x1"===n?.status;if("0x0"===n?.status)return U(this,d,"f").call(this,"Transaction receipt has failed status"),void U(this,r,"m",F).call(this,e,new Error("Transaction dropped or replaced"));const{blockNumber:a,blockHash:i}=n||{};if(s&&a&&i)return void await U(this,r,"m",M).call(this,e,{...n,blockNumber:a,blockHash:i})}catch(t){return U(this,d,"f").call(this,"Failed to check transaction",n,t),void U(this,r,"m",j).call(this,e,t.message,"There was a problem loading this transaction.")}await U(this,r,"m",E).call(this,e)&&U(this,r,"m",x).call(this,e)}},M=async function(e,t){const{id:n}=e,{blockHash:s}=t??{};if(U(this,d,"f").call(this,"Transaction confirmed",n),U(this,f,"f"))return U(this,r,"m",P).call(this,e.id),void this.hub.emit("transaction-confirmed",e);const a=(0,K.cloneDeep)(e);if(t&&s){const{baseFeePerGas:e,timestamp:n}=await U(this,r,"m",D).call(this,s,!1);a.baseFeePerGas=e,a.blockTimestamp=n,a.txParams={...a.txParams,gasUsed:t.gasUsed},a.txReceipt=t,a.verifiedOnBlockchain=!0}a.status=V.TransactionStatus.confirmed,U(this,r,"m",N).call(this,a,"PendingTransactionTracker:#onTransactionConfirmed - Transaction confirmed"),this.hub.emit("transaction-confirmed",a)},E=async function(e){const{hash:t,id:n,txParams:{nonce:a,from:i}}=e;if(!a||!t)return!1;const o=await U(this,r,"m",R).call(this,i),c=parseInt(o,16);if(parseInt(a,16)>=c)return!1;let l=U(this,s,"f").get(t);return l===undefined&&(l=0,U(this,s,"f").set(t,l)),l<3?(U(this,d,"f").call(this,"Incrementing dropped block count",{id:n,droppedBlockCount:l}),U(this,s,"f").set(t,l+1),!1):(U(this,d,"f").call(this,"Hit dropped block count",n),U(this,s,"f").delete(t),!0)},A=function(e){const{id:t,txParams:n}=e;return U(this,r,"m",L).call(this).some(e=>e.id!==t&&e.txParams.from===n.from&&e.status===V.TransactionStatus.confirmed&&e.txParams.nonce&&e.txParams.nonce===n.nonce&&e.type!==V.TransactionType.incoming&&e.isTransfer===undefined)},_=function(){return U(this,r,"m",G).call(this).filter(e=>e.status===V.TransactionStatus.submitted&&!e.verifiedOnBlockchain&&!e.isUserOperation)},j=function(e,t,n){U(this,r,"m",N).call(this,{...e,warning:{error:t,message:n}},"PendingTransactionTracker:#warnTransaction - Warning added")},F=function(e,t){U(this,d,"f").call(this,"Transaction failed",e.id,t),U(this,r,"m",P).call(this,e.id),this.hub.emit("transaction-failed",e,t)},x=function(e){U(this,d,"f").call(this,"Transaction dropped",e.id),U(this,r,"m",P).call(this,e.id),this.hub.emit("transaction-dropped",e)},N=function(e,t){this.hub.emit("transaction-updated",e,t)},O=async function(e){return await(0,H.query)(U(this,i,"f").call(this),"getTransactionReceipt",[e])},D=async function(e,t){return await(0,H.query)(U(this,i,"f").call(this),"getBlockByHash",[e,t])},R=async function(e){return await(0,H.query)(U(this,i,"f").call(this),"getTransactionCount",[e])},L=function(){const e=U(this,a,"f").call(this);return U(this,c,"f").call(this).filter(t=>t.chainId===e)},G=function(){const e=U(this,o,"f").call(this);return U(this,c,"f").call(this).filter(t=>t.networkClientId===e)}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/helpers/PendingTransactionTracker.cjs"}],[18,{"../../lib/snap-keyring/snap-keyring":328},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SnapKeyringBuilderInit=void 0;var r=e("../../lib/snap-keyring/snap-keyring");n.SnapKeyringBuilderInit=({controllerMessenger:e,initMessenger:t,removeAccount:n})=>({persistedStateKey:null,memStateKey:null,controller:(0,r.snapKeyringBuilder)(e,{persistKeyringHelper:async()=>{await t.call("KeyringController:persistAllKeyrings"),await t.call("AccountsController:updateAccounts")},removeAccountHelper:async e=>{await n(e)},trackEvent:t.call.bind(t,"MetaMetricsController:trackEvent")})})}}},{package:"$root$",file:"app/scripts/controller-init/accounts/snap-keyring-builder-init.ts"}],[180,{"../controllers/preferences-controller":234},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PreferencesControllerInit=void 0;var r=e("../controllers/preferences-controller");n.PreferencesControllerInit=({controllerMessenger:e,persistedState:t,initLangCode:n})=>({controller:new r.PreferencesController({state:{currentLocale:n??"",...t.PreferencesController},messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/preferences-controller-init.ts"}],[1800,{"../logger.cjs":1806,"../types.cjs":1807,"../utils/utils.cjs":1826,"@metamask/utils":3070,"bn.js":3977,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},m=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.hasSimulationDataChanged=n.shouldResimulate=n.ResimulateHelper=n.RESIMULATE_INTERVAL_MS=n.BLOCK_TIME_ADDITIONAL_SECONDS=n.VALUE_COMPARISON_PERCENT_THRESHOLD=n.BLOCKAID_RESULT_TYPE_MALICIOUS=n.RESIMULATE_PARAMS=void 0;const g=e("@metamask/utils"),p=e("bn.js"),f=e("lodash"),b=e("../logger.cjs"),w=e("../types.cjs"),C=e("../utils/utils.cjs"),k=(0,b.createModuleLogger)(b.projectLogger,"resimulate-helper");n.RESIMULATE_PARAMS=["to","value","data"],n.BLOCKAID_RESULT_TYPE_MALICIOUS="Malicious",n.VALUE_COMPARISON_PERCENT_THRESHOLD=5,n.BLOCK_TIME_ADDITIONAL_SECONDS=60,n.RESIMULATE_INTERVAL_MS=3e3;function y(e,t){return!T(e?.difference??"0x0",t?.difference??"0x0",!1===e?.isDecrease,!1===t?.isDecrease)}function T(e,t,r,s){let a=new p.BN((0,g.remove0x)(e),"hex"),i=new p.BN((0,g.remove0x)(t),"hex");return r&&(a=a.neg()),s&&(i=i.neg()),(0,C.getPercentageChange)(a,i)<=n.VALUE_COMPARISON_PERCENT_THRESHOLD}n.ResimulateHelper=class{constructor({getTransactions:e,simulateTransaction:t,onTransactionsUpdate:n}){r.add(this),s.set(this,new Map),a.set(this,void 0),i.set(this,void 0),h(this,a,e,"f"),h(this,i,t,"f"),n(m(this,r,"m",o).bind(this))}},s=new WeakMap,a=new WeakMap,i=new WeakMap,r=new WeakSet,o=function(){const e=m(this,a,"f").call(this).filter(e=>e.status===w.TransactionStatus.unapproved),t=new Set(e.map(e=>e.id));new Set([...t,...m(this,s,"f").keys()]).forEach(t=>{const n=e.find(e=>e.id===t);n?.isActive?m(this,r,"m",c).call(this,n):m(this,r,"m",u).call(this,t)})},c=function(e){const{id:t}=e;if(m(this,s,"f").has(t))return;const a=()=>{m(this,i,"f").call(this,e).catch(e=>{k("Error during transaction resimulation",e)}).finally(()=>{m(this,s,"f").has(t)&&m(this,r,"m",l).call(this,t,a)})};m(this,r,"m",l).call(this,t,a),k(`Started resimulating transaction ${t} every ${n.RESIMULATE_INTERVAL_MS} milliseconds`)},l=function(e,t){const r=setTimeout(t,n.RESIMULATE_INTERVAL_MS);m(this,s,"f").set(e,r)},u=function(e){m(this,s,"f").has(e)&&(m(this,r,"m",d).call(this,e),k(`Stopped resimulating transaction ${e} every ${n.RESIMULATE_INTERVAL_MS} milliseconds`))},d=function(e){const t=m(this,s,"f").get(e);t&&(clearTimeout(t),m(this,s,"f").delete(e))},n.shouldResimulate=function(e,t){const{id:r}=t,s=function(e,t){const{id:r,txParams:s}=t,{txParams:a}=e;if(!a||(0,f.isEqual)(a,s))return!1;const i=Object.keys(s).filter(e=>s[e]!==a[e]);return k("Transaction parameters updated",{transactionId:r,updatedProperties:i,originalParams:a,newParams:s}),n.RESIMULATE_PARAMS.some(e=>i.includes(e))}(e,t),a=function(e,t){const{securityAlertResponse:r}=e,{id:s,securityAlertResponse:a}=t;if((0,f.isEqual)(r,a))return!1;return k("Security alert updated",{transactionId:s,originalSecurityAlertResponse:r,newSecurityAlertResponse:a}),a?.result_type===n.BLOCKAID_RESULT_TYPE_MALICIOUS}(e,t),i=function(e,t){const{simulationData:n}=e,{simulationData:r,txParams:s}=t;if(!r||(0,f.isEqual)(n,r))return!1;return!T(s?.value??"0x0",r?.nativeBalanceChange?.difference??"0x0",!1,!1===r?.nativeBalanceChange?.isDecrease)}(e,t),o=s||a||i;let c;if(a||i){c=Math.floor(Date.now()/1e3)+n.BLOCK_TIME_ADDITIONAL_SECONDS}return o&&k("Transaction should be resimulated",{transactionId:r,blockTime:c,parametersUpdated:s,securityAlert:a,valueAndNativeBalanceMismatch:i}),{blockTime:c,resimulate:o}},n.hasSimulationDataChanged=function(e,t){if((0,f.isEqual)(e,t))return!1;if(y(e?.nativeBalanceChange,t?.nativeBalanceChange))return k("Simulation data native balance changed"),!0;if(e.tokenBalanceChanges.length!==t.tokenBalanceChanges.length)return!0;for(const n of e.tokenBalanceChanges){const e=t.tokenBalanceChanges.find(({address:e,id:t})=>e===n.address&&t===n.id);if(!e)return k("Missing new token balance",{address:n.address,id:n.id}),!0;if(y(n,e))return k("Simulation data token balance changed",{originalTokenBalanceChange:n,newTokenBalanceChange:e}),!0}return!1}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/helpers/ResimulateHelper.cjs"}],[1801,{"../logger.cjs":1806,"../utils/feature-flags.cjs":1812,"@metamask/utils":3070,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g,p,f,b=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},w=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPoller=void 0;const C=e("@metamask/utils"),k=e("lodash"),y=e("../logger.cjs"),T=e("../utils/feature-flags.cjs"),v=(0,C.createModuleLogger)(y.projectLogger,"transaction-poller");n.TransactionPoller=class{constructor({blockTracker:e,chainId:t,messenger:n}){r.add(this),s.set(this,0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,!1),h.set(this,void 0),b(this,a,e,"f"),b(this,i,t,"f"),b(this,o,n,"f")}start(e){w(this,d,"f")||(b(this,l,e,"f"),b(this,d,!0,"f"),w(this,r,"m",m).call(this),v("Started"))}stop(){w(this,d,"f")&&(b(this,d,!1,"f"),b(this,l,undefined,"f"),b(this,s,0,"f"),b(this,u,undefined,"f"),w(this,r,"m",p).call(this),w(this,r,"m",f).call(this),v("Stopped"))}setPendingTransactions(e){const t=(w(this,u,"f")??[]).map(e=>e.id);b(this,u,e,"f");const n=e.map(e=>e.id),a=!(0,k.isEqual)(t,n);w(this,d,"f")&&a&&(v("Detected new pending transactions",n),b(this,s,0,"f"),w(this,c,"f")&&(w(this,r,"m",f).call(this),w(this,r,"m",m).call(this)))}},s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,r=new WeakSet,m=function e(){if(!w(this,d,"f"))return;const{countMax:t,intervalMs:n}=(0,T.getAcceleratedPollingParams)(w(this,i,"f"),w(this,o,"f"));if(w(this,s,"f")>=t)return b(this,c,e=>w(this,r,"m",g).call(this,!1,e),"f"),w(this,a,"f").on("latest",w(this,c,"f")),void v("Added block tracker listener");w(this,r,"m",p).call(this),b(this,h,setTimeout(async()=>{await w(this,r,"m",g).call(this,!0),w(this,r,"m",e).call(this)},n),"f")},g=async function(e,t){e?v("Accelerated interval",w(this,s,"f")+1):v("Block tracker interval",t);const n=t??await w(this,a,"f").getLatestBlock();await(w(this,l,"f")?.call(this,n)),e&&w(this,d,"f")&&b(this,s,w(this,s,"f")+1,"f")},p=function(){w(this,h,"f")&&(clearTimeout(w(this,h,"f")),b(this,h,undefined,"f"))},f=function(){w(this,c,"f")&&(w(this,a,"f").removeListener("latest",w(this,c,"f")),b(this,c,undefined,"f"))}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/helpers/TransactionPoller.cjs"}],[1802,{"../logger.cjs":1806,"@metamask/utils":3070,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.CollectPublishHook=void 0;const u=e("@metamask/utils"),d=e("lodash"),h=e("../logger.cjs"),m=(0,u.createModuleLogger)(h.projectLogger,"collect-publish-hook");n.CollectPublishHook=class{constructor(e){r.add(this),s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),c(this,i,(0,u.createDeferredPromise)(),"f"),c(this,s,[],"f"),c(this,a,e,"f")}getHook(){return l(this,r,"m",o).bind(this)}ready(){return l(this,i,"f").promise}success(e){if(m("Success",{transactionHashes:e}),e.length!==l(this,a,"f"))throw new Error("Transaction hash count mismatch");for(let t=0;t<l(this,s,"f").length;t++){const n=l(this,s,"f")[t],r=e[t];n.promise.resolve({transactionHash:r})}}error(e){m("Error",{error:e});for(const t of l(this,s,"f"))t.promise.reject(e)}},s=new WeakMap,a=new WeakMap,i=new WeakMap,r=new WeakSet,o=function(e,t){const n=e.txParams.nonce??"0x0",r=parseInt(n,16);m("Processing transaction",{nonce:r,signedTx:t,transactionMeta:e});const o=(0,u.createDeferredPromise)();if(l(this,s,"f").push({nonce:r,promise:o,signedTransaction:t}),c(this,s,(0,d.sortBy)(l(this,s,"f"),e=>e.nonce),"f"),l(this,s,"f").length===l(this,a,"f")){m("All transactions signed");const e=l(this,s,"f").map(e=>e.signedTransaction);l(this,i,"f").resolve({signedTransactions:e})}return o.promise}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/hooks/CollectPublishHook.cjs"}],[1803,{"../logger.cjs":1806,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ExtraTransactionsPublishHook=void 0;const u=e("@metamask/utils"),d=e("../logger.cjs"),h=(0,u.createModuleLogger)(d.projectLogger,"extra-transactions-publish-hook");n.ExtraTransactionsPublishHook=class{constructor({addTransactionBatch:e,getTransaction:t,originalPublishHook:n}){r.add(this),s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),c(this,s,e,"f"),c(this,a,t,"f"),c(this,i,n,"f")}getHook(){return l(this,r,"m",o).bind(this)}},s=new WeakMap,a=new WeakMap,i=new WeakMap,r=new WeakSet,o=async function(e,t){h("Publishing transaction as batch",{transactionMeta:e,signedTx:t});const{batchTransactions:n,batchTransactionsOptions:r,id:o,networkClientId:c,txParams:d}=e,m=d.from,g=d.to,p=d.data,f=d.value,b=d.gas,w=d.maxFeePerGas,C=d.maxPriorityFeePerGas,k=t,y=(0,u.createDeferredPromise)(),T={existingTransaction:{id:o,onPublish:({newSignature:e,transactionHash:t})=>{if(e){const t=l(this,a,"f").call(this,o);return h("Calling original publish hook with new signature",{latestTransactionMeta:t,newSignature:e}),void l(this,i,"f").call(this,t,e).then(y.resolve).catch(y.reject)}y.resolve({transactionHash:t})},signedTransaction:k},params:{data:p,gas:b,maxFeePerGas:w,maxPriorityFeePerGas:C,to:g,value:f}},v=(n??[]).map(e=>{const{isAfter:t,type:n,...r}=e;return{isAfter:t,params:r,type:n}}),S=[...v.filter(e=>!1===e.isAfter).map(({isAfter:e,...t})=>({...t})),T,...v.filter(e=>e.isAfter===undefined||e.isAfter).map(({isAfter:e,...t})=>({...t}))];h("Adding transaction batch",{from:m,networkClientId:c,transactions:S});const P=r??{disable7702:!0,disableHook:!1,disableSequential:!0};return await l(this,s,"f").call(this,{from:m,networkClientId:c,requireApproval:!1,transactions:S,...P}),y.promise}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/hooks/ExtraTransactionsPublishHook.cjs"}],[1804,{"../logger.cjs":1806,"@metamask/rpc-errors":2594,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SequentialPublishBatchHook=void 0;const f=e("@metamask/rpc-errors"),b=e("@metamask/utils"),w=e("../logger.cjs"),C=(0,b.createModuleLogger)(w.projectLogger,"sequential-publish-batch-hook");n.SequentialPublishBatchHook=class{constructor({publishTransaction:e,getTransaction:t,getPendingTransactionTracker:n,getEthQuery:l}){r.add(this),s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,{}),g(this,s,e,"f"),g(this,a,t,"f"),g(this,i,l,"f"),g(this,o,n,"f")}getHook(){return p(this,r,"m",l).bind(this)}},s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,r=new WeakSet,l=async function({from:e,networkClientId:t,transactions:n}){C("Starting sequential publish batch hook",{from:e,networkClientId:t});const c=p(this,o,"f").call(this,t),l=[];for(const e of n)try{const n=p(this,a,"f").call(this,String(e.id)),o=await p(this,s,"f").call(this,p(this,i,"f").call(this,t),n);C("Transaction published",{transactionHash:o});const d={...n,hash:o},h=p(this,r,"m",u).call(this,c,d.id,d.hash);c.addTransactionToPoll(d),await h,l.push({transactionHash:o})}catch(t){throw C("Batch transaction failed",{transaction:e,error:t}),c.stop(),f.rpcErrors.internal("Failed to publish batch transaction")}return C("Sequential publish batch hook completed",{results:l}),c.stop(),{results:l}},u=async function(e,t,n){return new Promise((s,a)=>{const i=p(this,r,"m",d).bind(this,t,n,s,e),o=p(this,r,"m",h).bind(this,t,n,a,e);p(this,c,"f")[t]={onConfirmed:i,onFailedOrDropped:o},e.hub.on("transaction-confirmed",i),e.hub.on("transaction-failed",o),e.hub.on("transaction-dropped",o)})},d=function(e,t,n,s,a){a.id===e&&(C("Transaction confirmed",{transactionHash:t}),p(this,r,"m",m).call(this,s,e),n(a))},h=function(e,t,n,s,a,i){a.id===e&&(C("Transaction failed or dropped",{transactionHash:t,error:i}),p(this,r,"m",m).call(this,s,e),n(new Error(`Transaction ${t} failed or dropped.`)))},m=function(e,t){const n=p(this,c,"f")[t];e.hub.off("transaction-confirmed",n.onConfirmed),e.hub.off("transaction-failed",n.onFailedOrDropped),e.hub.off("transaction-dropped",n.onFailedOrDropped),delete p(this,c,"f")[t]}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/hooks/SequentialPublishBatchHook.cjs"}],[1805,{"./TransactionController.cjs":1782,"./constants.cjs":1785,"./helpers/AccountsApiRemoteTransactionSource.cjs":1794,"./types.cjs":1807,"./utils/gas-flow.cjs":1816,"./utils/history.cjs":1818,"./utils/prepare.cjs":1821,"./utils/transaction-type.cjs":1825,"./utils/utils.cjs":1826},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.HARDFORK=n.INCOMING_TRANSACTIONS_SUPPORTED_CHAIN_IDS=n.CHAIN_IDS=n.normalizeTransactionParams=n.isEIP1559Transaction=n.mergeGasFeeEstimates=n.determineTransactionType=n.MAX_TRANSACTION_HISTORY_LENGTH=n.DISPLAYED_TRANSACTION_HISTORY_PATHS=n.WalletDevice=n.UserFeeLevel=n.TransactionType=n.TransactionStatus=n.TransactionEnvelopeType=n.TransactionContainerType=n.SimulationTokenStandard=n.SimulationErrorCode=n.GasFeeEstimateType=n.GasFeeEstimateLevel=n.TransactionController=n.SPEED_UP_RATE=n.CANCEL_RATE=void 0;var r=e("./TransactionController.cjs");Object.defineProperty(n,"CANCEL_RATE",{enumerable:!0,get:function(){return r.CANCEL_RATE}}),Object.defineProperty(n,"SPEED_UP_RATE",{enumerable:!0,get:function(){return r.SPEED_UP_RATE}}),Object.defineProperty(n,"TransactionController",{enumerable:!0,get:function(){return r.TransactionController}});var s=e("./types.cjs");Object.defineProperty(n,"GasFeeEstimateLevel",{enumerable:!0,get:function(){return s.GasFeeEstimateLevel}}),Object.defineProperty(n,"GasFeeEstimateType",{enumerable:!0,get:function(){return s.GasFeeEstimateType}}),Object.defineProperty(n,"SimulationErrorCode",{enumerable:!0,get:function(){return s.SimulationErrorCode}}),Object.defineProperty(n,"SimulationTokenStandard",{enumerable:!0,get:function(){return s.SimulationTokenStandard}}),Object.defineProperty(n,"TransactionContainerType",{enumerable:!0,get:function(){return s.TransactionContainerType}}),Object.defineProperty(n,"TransactionEnvelopeType",{enumerable:!0,get:function(){return s.TransactionEnvelopeType}}),Object.defineProperty(n,"TransactionStatus",{enumerable:!0,get:function(){return s.TransactionStatus}}),Object.defineProperty(n,"TransactionType",{enumerable:!0,get:function(){return s.TransactionType}}),Object.defineProperty(n,"UserFeeLevel",{enumerable:!0,get:function(){return s.UserFeeLevel}}),Object.defineProperty(n,"WalletDevice",{enumerable:!0,get:function(){return s.WalletDevice}});var a=e("./utils/history.cjs");Object.defineProperty(n,"DISPLAYED_TRANSACTION_HISTORY_PATHS",{enumerable:!0,get:function(){return a.DISPLAYED_TRANSACTION_HISTORY_PATHS}}),Object.defineProperty(n,"MAX_TRANSACTION_HISTORY_LENGTH",{enumerable:!0,get:function(){return a.MAX_TRANSACTION_HISTORY_LENGTH}});var i=e("./utils/transaction-type.cjs");Object.defineProperty(n,"determineTransactionType",{enumerable:!0,get:function(){return i.determineTransactionType}});var o=e("./utils/gas-flow.cjs");Object.defineProperty(n,"mergeGasFeeEstimates",{enumerable:!0,get:function(){return o.mergeGasFeeEstimates}});var c=e("./utils/utils.cjs");Object.defineProperty(n,"isEIP1559Transaction",{enumerable:!0,get:function(){return c.isEIP1559Transaction}}),Object.defineProperty(n,"normalizeTransactionParams",{enumerable:!0,get:function(){return c.normalizeTransactionParams}});var l=e("./constants.cjs");Object.defineProperty(n,"CHAIN_IDS",{enumerable:!0,get:function(){return l.CHAIN_IDS}});var u=e("./helpers/AccountsApiRemoteTransactionSource.cjs");Object.defineProperty(n,"INCOMING_TRANSACTIONS_SUPPORTED_CHAIN_IDS",{enumerable:!0,get:function(){return u.SUPPORTED_CHAIN_IDS}});var d=e("./utils/prepare.cjs");Object.defineProperty(n,"HARDFORK",{enumerable:!0,get:function(){return d.HARDFORK}})}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/index.cjs"}],[1806,{"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.incomingTransactionsLogger=n.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),n.projectLogger=(0,r.createProjectLogger)("transaction-controller"),n.incomingTransactionsLogger=(0,r.createModuleLogger)(n.projectLogger,"incoming-transactions")}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/logger.cjs"}],[1807,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h;Object.defineProperty(n,"__esModule",{value:!0}),n.SimulationErrorCode=n.SimulationTokenStandard=n.GasFeeEstimateType=n.GasFeeEstimateLevel=n.UserFeeLevel=n.TransactionEnvelopeType=n.TransactionContainerType=n.TransactionType=n.WalletDevice=n.TransactionStatus=void 0,function(e){e.unapproved="unapproved",e.approved="approved",e.signed="signed",e.submitted="submitted",e.confirmed="confirmed",e.failed="failed",e.dropped="dropped",e.rejected="rejected",e.cancelled="cancelled"}(r||(n.TransactionStatus=r={})),function(e){e.MM_MOBILE="metamask_mobile",e.MM_EXTENSION="metamask_extension",e.OTHER="other_device"}(s||(n.WalletDevice=s={})),function(e){e.batch="batch",e.bridge="bridge",e.bridgeApproval="bridgeApproval",e.cancel="cancel",e.contractInteraction="contractInteraction",e.deployContract="contractDeployment",e.ethDecrypt="eth_decrypt",e.ethGetEncryptionPublicKey="eth_getEncryptionPublicKey",e.gasPayment="gas_payment",e.incoming="incoming",e.lendingDeposit="lendingDeposit",e.lendingWithdraw="lendingWithdraw",e.perpsDeposit="perpsDeposit",e.personalSign="personal_sign",e.predictBuy="predictBuy",e.predictClaim="predictClaim",e.predictDeposit="predictDeposit",e.predictSell="predictSell",e.predictWithdraw="predictWithdraw",e.retry="retry",e.revokeDelegation="revokeDelegation",e.simpleSend="simpleSend",e.signTypedData="eth_signTypedData",e.smart="smart",e.stakingClaim="stakingClaim",e.stakingDeposit="stakingDeposit",e.stakingUnstake="stakingUnstake",e.swap="swap",e.swapAndSend="swapAndSend",e.swapApproval="swapApproval",e.tokenMethodApprove="approve",e.tokenMethodSafeTransferFrom="safetransferfrom",e.tokenMethodTransfer="transfer",e.tokenMethodTransferFrom="transferfrom",e.tokenMethodSetApprovalForAll="setapprovalforall",e.tokenMethodIncreaseAllowance="increaseAllowance",e.shieldSubscriptionApprove="shieldSubscriptionApprove"}(a||(n.TransactionType=a={})),function(e){e.EnforcedSimulations="enforcedSimulations"}(i||(n.TransactionContainerType=i={})),function(e){e.legacy="0x0",e.accessList="0x1",e.feeMarket="0x2",e.setCode="0x4"}(o||(n.TransactionEnvelopeType=o={})),function(e){e.CUSTOM="custom",e.DAPP_SUGGESTED="dappSuggested",e.MEDIUM="medium"}(c||(n.UserFeeLevel=c={})),function(e){e.Low="low",e.Medium="medium",e.High="high"}(l||(n.GasFeeEstimateLevel=l={})),function(e){e.FeeMarket="fee-market",e.Legacy="legacy",e.GasPrice="eth_gasPrice"}(u||(n.GasFeeEstimateType=u={})),function(e){e.erc20="erc20",e.erc721="erc721",e.erc1155="erc1155"}(d||(n.SimulationTokenStandard=d={})),function(e){e.ChainNotSupported="chain-not-supported",e.Disabled="disabled",e.InvalidResponse="invalid-response",e.Reverted="reverted"}(h||(n.SimulationErrorCode=h={}))}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/types.cjs"}],[1808,{"../api/simulation-api.cjs":1784,"../constants.cjs":1785,"../errors.cjs":1786,"../logger.cjs":1806,"../types.cjs":1807,"@ethersproject/abi":705,"@metamask/controller-utils":1384,"@metamask/metamask-eth-abis":2244,"@metamask/utils":3070,"bn.js":3977},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getBalanceChanges=n.SupportedToken=void 0;const s=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),i=e("@metamask/metamask-eth-abis"),o=e("@metamask/utils"),c=r(e("bn.js")),l=e("../api/simulation-api.cjs"),u=e("../constants.cjs"),d=e("../errors.cjs"),h=e("../logger.cjs"),m=e("../types.cjs");var g;!function(e){e.ERC20="erc20",e.ERC721="erc721",e.ERC1155="erc1155",e.ERC20_WRAPPED="erc20Wrapped",e.ERC721_LEGACY="erc721Legacy"}(g||(n.SupportedToken=g={}));const p=(0,o.createModuleLogger)(h.projectLogger,"balance-changes"),f=["Transfer","TransferSingle","TransferBatch","Deposit","Withdrawal"],b={[g.ERC20]:{abi:i.abiERC20,standard:m.SimulationTokenStandard.erc20},[g.ERC721]:{abi:i.abiERC721,standard:m.SimulationTokenStandard.erc721},[g.ERC1155]:{abi:i.abiERC1155,standard:m.SimulationTokenStandard.erc1155},[g.ERC20_WRAPPED]:{abi:u.ABI_SIMULATION_ERC20_WRAPPED,standard:m.SimulationTokenStandard.erc20},[g.ERC721_LEGACY]:{abi:u.ABI_SIMULATION_ERC721_LEGACY,standard:m.SimulationTokenStandard.erc721}},w=["execution reverted","insufficient funds for gas"];function C(e){if(Array.isArray(e))return e.map(C);let t=e;return t=t.toHexString?.()??t,t=t.toLowerCase?.()??t,t}function k(e){return"Transfer"===e.name&&e.tokenStandard===m.SimulationTokenStandard.erc721&&0===parseInt(e.args.from,16)}function y(e){return e.tokenStandard===m.SimulationTokenStandard.erc721?[e.args.tokenId]:e.tokenStandard===m.SimulationTokenStandard.erc1155&&"TransferSingle"===e.name?[e.args.id]:e.tokenStandard===m.SimulationTokenStandard.erc1155&&"TransferBatch"===e.name?e.args.ids:[undefined]}function T(e){switch(e){case m.SimulationTokenStandard.erc721:return new s.Interface(i.abiERC721);case m.SimulationTokenStandard.erc1155:return new s.Interface(i.abiERC1155);default:return new s.Interface(i.abiERC20)}}function v(e,t,n){const r=T(t.standard);try{if(t.standard===m.SimulationTokenStandard.erc721){const t=r.decodeFunctionResult("ownerOf",n.return);return t[0].toLowerCase()===e.toLowerCase()?"0x1":"0x0"}const s=r.decodeFunctionResult("balanceOf",n.return);return(0,a.toHex)(s[0])}catch(e){throw p("Failed to decode balance transaction",e,{token:t,response:n}),new d.SimulationError(`Failed to decode balance transaction for token ${t.address}: ${String(e)}`)}}function S(e,t,n){const r=T(e);switch(e){case m.SimulationTokenStandard.erc721:return r.encodeFunctionData("ownerOf",[n]);case m.SimulationTokenStandard.erc1155:return r.encodeFunctionData("balanceOf",[t,n]);default:return r.encodeFunctionData("balanceOf",[t])}}function P(e){return[...e.logs??[],...(e.calls??[]).map(e=>P(e)).flat()]}function I(e,t,n=0){const r=(0,a.hexToBN)(t).add(new c.default(n)),s=(0,a.hexToBN)(e),i=r.sub(s),o=i.isNeg(),l=(0,a.toHex)(i.abs());return i.isZero()?(p("Balance change is zero"),undefined):{previousBalance:e,newBalance:(0,a.toHex)(r),difference:l,isDecrease:o}}async function M({request:e,params:t,before:n=[],after:r=[]}){const{blockTime:s,chainId:i,ethQuery:o,getSimulationConfig:u,txParams:d}=e,{authorizationList:h}=d,m=d.from,g=h?.map(e=>({address:e.address,from:m})),f=[...n,{authorizationList:g,data:d.data,from:d.from,gas:d.gas,maxFeePerGas:d.maxFeePerGas??d.gasPrice,maxPriorityFeePerGas:d.maxPriorityFeePerGas??d.gasPrice,to:d.to,value:d.value},...r],b=function(e){const{txParams:t}=e,n=(0,a.hexToBN)(t.gas??"0x0"),r=(0,a.hexToBN)(t.maxFeePerGas??t.gasPrice??"0x0"),s=(0,a.hexToBN)(t.value??"0x0"),i=(e.nestedTransactions??[]).map(e=>(0,a.hexToBN)(e.value??"0x0")).reduce((e,t)=>e.add(t),new c.default(0));return n.mul(r).add(s).add(i)}(e),w=(0,a.toHex)(b);p("Required balance",w);const C=await(0,a.query)(o,"getBalance",[m,"latest"]),k=(0,a.hexToBN)(C);p("Current balance",C);const y=k.lt(b);return await(0,l.simulateTransactions)(i,{...t,getSimulationConfig:u,transactions:f,withGas:!0,withDefaultBlockOverrides:!0,...s&&{blockOverrides:{...t?.blockOverrides,time:(0,a.toHex)(s)}},...y&&{overrides:{...t?.overrides,[m]:{...t?.overrides?.[m],balance:w}}}})}n.getBalanceChanges=async function(e){p("Request",e);try{const t=await M({request:e,params:{withCallTrace:!0,withLogs:!0}}),n=t.transactions?.[0]?.error;if(n)throw new d.SimulationError(n);const r=function(e,t){const n=t.transactions[0];if(!n)return undefined;const{txParams:r}=e,s=r.from,{stateDiff:a}=n,i=a?.pre?.[s]?.balance,o=a?.post?.[s]?.balance;if(!i||!o)return undefined;return I(i,o,n.gasCost)}(e,t),a=function(e){const t=P(e.transactions[0]?.callTrace??{});p("Extracted logs",t);const n=function(){const e=Object.values(g);return new Map(e.map(e=>{const{abi:t}=b[e];return[e,new s.Interface(t)]}))}();return t.map(e=>{const t=function(e,t){const n=Object.values(g);for(const r of n)try{const n=t.get(r),{abi:s,standard:a}=b[r];return{...n.parseLog(e),abi:s,standard:a}}catch(e){continue}return undefined}(e,n);if(!t)return p("Failed to parse log",e),undefined;const r=t.abi.find(e=>e.name===t.name)?.inputs;if(!r)return p("Failed to find inputs for event",t),undefined;if(!f.includes(t.name))return p("Ignoring unsupported event",t.name,t),undefined;p("Normalizing event args",t.name,t);const s=function(e,t){return e.reduce((e,n,r)=>{const s=t[r].name.replace("_",""),a=C(n);return e[s]=a,e},{})}(t.args,r);return{contractAddress:e.address,tokenStandard:t.standard,name:t.name,args:s,abi:t.abi}}).filter(e=>e!==undefined)}(t);p("Parsed events",a);const i=await async function(e,t){const{txParams:n}=e,r=n.from,s=function(e,t){const n=new Set,r=new Map,s=new Map,a=e.txParams.from,i=t.filter(e=>[e.args.from,e.args.to].includes(a));p("Filtered user events",i);for(const e of i){const t=y(e);p("Extracted token IDs",t);for(const i of t){const t={address:e.contractAddress,standard:e.tokenStandard,id:i},o=JSON.stringify(t);if(n.has(o)){p("Ignoring additional event with same contract and token ID",t);continue}n.add(o);const c=S(e.tokenStandard,a,i),l={from:a,to:e.contractAddress,data:c};k(e)||r.set(t,l),s.set(t,l)}}return{before:r,after:s}}(e,t);p("Generated balance transactions",[...s.after.values()]);const a=s.before.size+s.after.size+1;if(1===a)return[];const i=await M({request:e,before:[...s.before.values()],after:[...s.after.values()]});if(p("Balance simulation response",i),i.transactions.length!==a)throw new d.SimulationInvalidResponseError;let o=0;return[...s.after.keys()].map((e,t)=>{const n=I(!s.before.get(e)?"0x0":v(r,e,i.transactions[o++]),v(r,e,i.transactions[t+s.before.size+1]));return n?{...e,...n}:undefined}).filter(e=>e!==undefined)}(e,a),o=t.transactions?.[0]?.gasUsed;return{simulationData:{nativeBalanceChange:r,tokenBalanceChanges:i},gasUsed:o}}catch(t){p("Failed to get balance changes",t,e);let n=t;w.some(e=>n.message?.includes(e))&&(n=new d.SimulationRevertedError);const{code:r,message:s}=n;return{simulationData:{tokenBalanceChanges:[],error:{code:r,message:s}},gasUsed:undefined}}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/balance-changes.cjs"}],[1809,{"../gas-flows/DefaultGasFeeFlow.cjs":1787,"../helpers/GasFeePoller.cjs":1795,"../hooks/CollectPublishHook.cjs":1802,"../hooks/SequentialPublishBatchHook.cjs":1804,"../index.cjs":1805,"../logger.cjs":1806,"../types.cjs":1807,"./eip7702.cjs":1810,"./feature-flags.cjs":1812,"./gas.cjs":1817,"./validation.cjs":1827,"@metamask/controller-utils":1384,"@metamask/rpc-errors":2594,"@metamask/utils":3070,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAtomicBatchSupported=n.addTransactionBatch=n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT=void 0;const r=e("@metamask/controller-utils"),s=e("@metamask/rpc-errors"),a=e("@metamask/utils"),i=e("uuid"),o=e("./eip7702.cjs"),c=e("./feature-flags.cjs"),l=e("./gas.cjs"),u=e("./validation.cjs"),d=e("../index.cjs"),h=e("../gas-flows/DefaultGasFeeFlow.cjs"),m=e("../helpers/GasFeePoller.cjs"),g=e("../hooks/CollectPublishHook.cjs"),p=e("../hooks/SequentialPublishBatchHook.cjs"),f=e("../logger.cjs"),b=e("../types.cjs"),w=(0,a.createModuleLogger)(f.projectLogger,"batch");function C(){const e=(0,i.v4)(),t=new Uint8Array((0,i.parse)(e));return(0,a.bytesToHex)(t)}async function k(e,t,n,s,a,i){const{assetsFiatValues:o,existingTransaction:c,params:l,type:u}=t,{addTransaction:h,getTransaction:g,request:p,updateTransaction:f}=s,{from:b,networkClientId:C,origin:k}=p;if(c){const{id:t,onPublish:a}=c;let o=g(t);const u=o.txParams.nonce;let{signedTransaction:d}=c;const h=u?parseInt(u,16):undefined,m=i>0&&h!==undefined?h+i:undefined;if(f({transactionId:t},t=>{t.batchId=e,m&&(t.txParams.nonce=(0,r.toHex)(m))}),m){const e=await y({transactionId:t,request:s});d=e.newSignature,o=e.transactionMeta}return n(o,d).then(a).catch(()=>{}),w("Processed existing transaction with hook",{id:t,params:l}),{id:t,params:l}}const T={...a,txParams:{...l,from:b,gas:a?.gas??l.gas}};a&&(0,m.updateTransactionGasEstimates)({txMeta:T,userFeeLevel:d.GasFeeEstimateLevel.Medium});const{transactionMeta:v}=await h(T.txParams,{assetsFiatValues:o,batchId:e,disableGasBuffer:!0,networkClientId:C,origin:k,publishHook:n,requireApproval:!1,type:u}),{id:S,txParams:P}=v,I={data:P.data,gas:P.gas,maxFeePerGas:P.maxFeePerGas,maxPriorityFeePerGas:P.maxPriorityFeePerGas,to:P.to,value:P.value};return w("Processed new transaction with hook",{id:S,params:I,type:u}),{id:S,params:I,type:u}}async function y({request:e,transactionId:t}){const{getTransaction:n,signTransaction:r}=e,s=n(t);w("Re-signing existing transaction",{transactionId:t,txParams:s.txParams});const a=await r(s);if(!a)throw new Error("Failed to re-sign transaction");const i=n(t);return w("New signature",a),{newSignature:a,transactionMeta:i}}n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT="Upgrade contract address not found",n.addTransactionBatch=async function(e){const{getInternalAccounts:t,messenger:a,request:i}=e,m=(0,c.getBatchSizeLimit)(a);if((0,u.validateBatchRequest)({internalAccounts:t(),request:i,sizeLimit:m}),w("Adding",i),!i.disable7702)try{return await async function(e){const{addTransaction:t,getChainId:r,messenger:a,publicKeyEIP7702:i,request:l}=e,{batchId:u,from:h,networkClientId:m,origin:g,requireApproval:p,securityAlertId:f,transactions:k,validateSecurity:T}=l,v=r(m),S=e.getEthQuery(m),P=(0,o.doesChainSupportEIP7702)(v,a);if(!P)throw w("Chain does not support EIP-7702",v),s.rpcErrors.internal("Chain does not support EIP-7702");if(!i)throw s.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);const{delegationAddress:I,isSupported:M}=await(0,o.isAccountUpgradedToEIP7702)(h,v,i,a,S);if(w("Account",{delegationAddress:I,isSupported:M}),!M&&I)throw w("Account upgraded to unsupported contract",h,I),s.rpcErrors.internal("Account upgraded to unsupported contract");const E=await Promise.all(k.map(e=>async function(e,t,n){const{from:r}=e,{params:s,type:a}=t,{type:i}=await(0,d.determineTransactionType)({from:r,...s},n),o=a??i;return{...s,type:o}}(l,e,S))),A=(0,o.generateEIP7702BatchTransaction)(h,E),_={from:h,...A};if(!M){const e=(0,c.getEIP7702UpgradeContractAddress)(v,a,i);if(!e)throw s.rpcErrors.internal(n.ERROR_MESSAGE_NO_UPGRADE_CONTRACT);_.type=b.TransactionEnvelopeType.setCode,_.authorizationList=[{address:e}]}if(T){const e={method:"eth_sendTransaction",params:[{..._,authorizationList:undefined,type:b.TransactionEnvelopeType.feeMarket}],delegationMock:_.authorizationList?.[0]?.address,origin:g};w("Security request",e),T(e,v).catch(e=>{w("Security validation failed",e)})}w("Adding batch transaction",_,m);const j=u??C(),F=f?{securityAlertId:f}:undefined,x=k.find(e=>e.existingTransaction)?.existingTransaction;if(x)return await async function({batchId:e,existingTransaction:t,nestedTransactions:n,request:r,txParams:s}){const{getTransaction:a,estimateGas:i,updateTransaction:o}=r,c=a(t.id);if(!c)throw new Error("Existing transaction not found");w("Converting existing transaction to 7702",{batchId:e,txParams:s});const{networkClientId:l}=c,u=await i(s,l);w("Estimated gas for converted EIP-7702 transaction",u),o({transactionId:c.id},t=>{var r;t.batchId=e,t.nestedTransactions=n,t.txParams=s,t.txParams.gas=u.gas,t.txParams.gasLimit=u.gas,t.txParams.maxFeePerGas=c.txParams.maxFeePerGas,t.txParams.maxPriorityFeePerGas=c.txParams.maxPriorityFeePerGas,t.txParams.nonce=c.txParams.nonce,(r=t.txParams).type??(r.type=b.TransactionEnvelopeType.feeMarket)});const{newSignature:d}=await y({request:r,transactionId:c.id});t.onPublish?.({transactionHash:undefined,newSignature:d}),w("Transaction updated to EIP-7702",{batchId:e,txParams:s,newSignature:d})}({batchId:j,existingTransaction:x,nestedTransactions:E,request:e,txParams:_}),{batchId:j};const{result:N}=await t(_,{batchId:j,isGasFeeIncluded:l.isGasFeeIncluded,isGasFeeSponsored:l.isGasFeeSponsored,nestedTransactions:E,networkClientId:m,origin:g,requireApproval:p,securityAlertResponse:F,type:b.TransactionType.batch}),O=await N;return w("Batch transaction added",{batchId:j,transactionHash:O}),{batchId:j}}(e)}catch(e){if(!(e instanceof s.JsonRpcError&&"Chain does not support EIP-7702"===e.message))throw e}return await async function(e){const{messenger:t,publishBatchHook:n,request:a,update:i}=e,{from:o,networkClientId:c,origin:u,requireApproval:m,transactions:f}=a;let b,y=!1;w("Adding transaction batch using hook",a);const T=new p.SequentialPublishBatchHook({publishTransaction:e.publishTransaction,getTransaction:e.getTransaction,getEthQuery:e.getEthQuery,getPendingTransactionTracker:e.getPendingTransactionTracker});let{disable7702:v,disableSequential:S}=a;const{disableHook:P,useHook:I}=a;I&&(v=!0,S=!0);let M,E=null;!P&&n?E=n:S||(E=T.getHook(),y=!0);if(!E)throw w("No supported batch methods found",{disable7702:v,disableHook:P,disableSequential:S}),s.rpcErrors.internal("Can't process batch");const A=C(),_=f.map(e=>({...e,origin:u})),j=_.length,F=new g.CollectPublishHook(j);try{m&&(M=await async function({batchId:e,request:t}){const{messenger:n,request:r,isSimulationEnabled:s,getChainId:a,getEthQuery:i,getGasFeeEstimates:o,getSimulationConfig:c,update:u}=t,{from:m,origin:g,networkClientId:p,transactions:f}=r,b=i(p);if(!s())throw new Error("Cannot create transaction batch as simulation not supported");w("Preparing approval data for batch");const C=a(p),{gasLimit:k}=await(0,l.simulateGasBatch)({chainId:C,from:m,getSimulationConfig:c,transactions:f}),y=(P={chainId:C,from:m,gas:k,id:e,networkClientId:p,origin:g,transactions:f},{...P,status:d.TransactionStatus.unapproved}),T=new h.DefaultGasFeeFlow,v=await o({networkClientId:p}),S=await T.getGasFees({ethQuery:b,gasFeeControllerData:v,messenger:n,transactionMeta:{...y,txParams:{from:m,gas:k},time:Date.now()}});var P;return y.gasFeeEstimates=S.estimates,w("Saving transaction batch metadata",y),function(e,t){t(t=>{t.transactionBatches=[...t.transactionBatches,e]})}(y,u),y}({batchId:A,request:e}),b=(await async function(e,t){const n=String(e.id),{origin:s}=e,a=r.ApprovalType.TransactionBatch,i={txBatchId:n};return w("Requesting approval for transaction batch",n),await t.call("ApprovalController:addRequest",{id:n,origin:s||r.ORIGIN_METAMASK,requestData:i,expectsResult:!0,type:a},!0)}(M,t)).resultCallbacks);const n=F.getHook(),s=[];let a=0;for(const t of _){const r=await k(A,t,n,e,M,a);s.push(r),a+=1}const{signedTransactions:i}=await F.ready(),u={from:o,networkClientId:c,transactions:s.map((e,t)=>({...e,signedTx:i[t]}))};w("Calling publish batch hook",u);let g=await E(u);if(w("Publish batch hook result",g),!g&&!y&&!S){w("Fallback to sequential publish batch hook due to empty results");const e=T.getHook();g=await e(u)}if(!g?.results?.length)throw new Error("Publish batch hook did not return a result");const p=g.results.map(({transactionHash:e})=>e);return F.success(p),b?.success(),w("Completed batch transaction with hook",p),{batchId:A}}catch(e){throw w("Publish batch hook failed",e),F.error(e),b?.error(e),e}finally{w("Cleaning up publish batch hook",A),function(e,t){e(e=>{e.transactionBatches=e.transactionBatches.filter(e=>e.id!==t)})}(i,A)}}(e)},n.isAtomicBatchSupported=async function(e){const{address:t,chainIds:n,getEthQuery:r,messenger:a,publicKeyEIP7702:i}=e;if(!i)throw s.rpcErrors.internal(o.ERROR_MESSGE_PUBLIC_KEY);const l=(0,c.getEIP7702SupportedChains)(a).filter(e=>!n||n.includes(e)),u=(await Promise.all(l.map(async e=>{try{const n=r(e),{isSupported:s,delegationAddress:l}=await(0,o.isAccountUpgradedToEIP7702)(t,e,i,a,n);return{chainId:e,delegationAddress:l,isSupported:s,upgradeContractAddress:(0,c.getEIP7702UpgradeContractAddress)(e,a,i)}}catch(t){return w("Error checking atomic batch support",e,t),undefined}}))).filter(e=>Boolean(e));return w("Atomic batch supported results",u),u}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/batch.cjs"}],[181,{"@metamask/profile-metrics-controller":2450},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ProfileMetricsControllerInit=void 0;var r=e("@metamask/profile-metrics-controller");const s=Boolean(!1);n.ProfileMetricsControllerInit=({controllerMessenger:e,persistedState:t,getController:n})=>{const a=n("RemoteFeatureFlagController"),i=n("MetaMetricsController"),o=n("AppStateController");return{controller:new r.ProfileMetricsController({messenger:e,state:t.ProfileMetricsController,interval:s?1e3:1e4,assertUserOptedIn:()=>!0===a.state.remoteFeatureFlags.extensionUxPna25&&!0===o.state.pna25Acknowledged&&!0===i.state.participateInMetaMetrics,getMetaMetricsId:()=>i.getMetaMetricsId()})}}}}},{package:"$root$",file:"app/scripts/controller-init/profile-metrics-controller-init.ts"}],[1810,{"../constants.cjs":1785,"../logger.cjs":1806,"./feature-flags.cjs":1812,"@ethersproject/abi":705,"@ethersproject/contracts":728,"@metamask/controller-utils":1384,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.signAuthorizationList=n.generateEIP7702BatchTransaction=n.isAccountUpgradedToEIP7702=n.getDelegationAddress=n.doesChainSupportEIP7702=n.ERROR_MESSGE_PUBLIC_KEY=n.CALLS_SIGNATURE=n.BATCH_FUNCTION_NAME=n.DELEGATION_PREFIX=void 0;const r=e("@ethersproject/abi"),s=e("@ethersproject/contracts"),a=e("@metamask/controller-utils"),i=e("@metamask/utils"),o=e("./feature-flags.cjs"),c=e("../constants.cjs"),l=e("../logger.cjs");n.DELEGATION_PREFIX="0xef0100",n.BATCH_FUNCTION_NAME="execute",n.CALLS_SIGNATURE="(address,uint256,bytes)[]",n.ERROR_MESSGE_PUBLIC_KEY="EIP-7702 public key not specified";const u=(0,i.createModuleLogger)(l.projectLogger,"eip-7702");async function d(e,t){const r=await(0,a.query)(t,"eth_getCode",[e]),s=(0,i.add0x)(r?.toLowerCase?.()??"");return 48===r?.length&&s.startsWith(n.DELEGATION_PREFIX)?(0,i.add0x)(s.slice(n.DELEGATION_PREFIX.length)):undefined}async function h(e,t,n,r){const s=function(e,t,n){const{chainId:r,nonce:s}=e,{txParams:i,chainId:o}=t,{nonce:c}=i,l=r??o;let d=s;d===undefined&&(d=(0,a.toHex)(parseInt(c,16)+1+n));const h={...e,chainId:l,nonce:d};return u("Prepared authorization",h),h}(e,t,r),{txParams:o}=t,{from:c}=o,{address:l,chainId:d,nonce:h}=s,m=parseInt(d,16),g=parseInt(h,16),p=await n.call("KeyringController:signEip7702Authorization",{chainId:m,contractAddress:l,from:c,nonce:g}),f=p.slice(0,66),b=(0,i.add0x)(p.slice(66,130)),w=parseInt(p.slice(130,132),16),C={address:l,chainId:d,nonce:h,r:f,s:b,yParity:(0,a.toHex)(w-27==0?0:1)};return u("Signed authorization",C),C}n.doesChainSupportEIP7702=function(e,t){return(0,o.getEIP7702SupportedChains)(t).some(t=>t.toLowerCase()===e.toLowerCase())},n.getDelegationAddress=d,n.isAccountUpgradedToEIP7702=async function(e,t,n,r,s){const a=(0,o.getEIP7702ContractAddresses)(t,r,n),i=await d(e,s),c=Boolean(i&&a.some(e=>e.toLowerCase()===i.toLowerCase()));return{delegationAddress:i,isSupported:c}},n.generateEIP7702BatchTransaction=function(e,t){const a=s.Contract.getInterface(c.ABI_IERC7821),i=t.map(e=>{const{data:t,to:n,value:r}=e;return[n??"0x0000000000000000000000000000000000000000",r??"0x0",t??"0x"]}),o="0x01".padEnd(66,"0"),l=r.defaultAbiCoder.encode([n.CALLS_SIGNATURE],[i]),d=a.encodeFunctionData(n.BATCH_FUNCTION_NAME,[o,l]);return u("Transaction data",d),{data:d,to:e}},n.signAuthorizationList=async function({authorizationList:e,messenger:t,transactionMeta:n}){if(!e)return undefined;const r=[];let s=0;for(const a of e){const e=await h(a,n,t,s);r.push(e),s+=1}return r}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/eip7702.cjs"}],[1811,{"../types.cjs":1807,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateConfirmedExternalTransaction=void 0;const r=e("@metamask/rpc-errors"),s=e("../types.cjs");n.validateConfirmedExternalTransaction=function(e,t,n){if(!e||!e.txParams)throw r.rpcErrors.invalidParams('"transactionMeta" or "transactionMeta.txParams" is missing');if(e.status!==s.TransactionStatus.confirmed)throw r.rpcErrors.invalidParams('External transaction status should be "confirmed"');const a=e.txParams.nonce;if(n&&n.length>0){if(n.find(e=>e.txParams?.nonce===a))throw r.rpcErrors.invalidParams("External transaction nonce should not be in pending txs")}if(t&&t.length>0){if(t.find(e=>e.txParams?.nonce===a))throw r.rpcErrors.invalidParams("External transaction nonce should not be in confirmed txs")}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/external-transactions.cjs"}],[1812,{"../logger.cjs":1806,"./signature.cjs":1823,"./utils.cjs":1826,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getIncomingTransactionsPollingInterval=n.getGasEstimateBuffer=n.getGasEstimateFallback=n.getGasFeeRandomisation=n.getAcceleratedPollingParams=n.getBatchSizeLimit=n.getEIP7702UpgradeContractAddress=n.getEIP7702ContractAddresses=n.getEIP7702SupportedChains=n.FeatureFlag=void 0;const r=e("@metamask/utils"),s=e("./signature.cjs"),a=e("./utils.cjs"),i=e("../logger.cjs");var o;!function(e){e.EIP7702="confirmations_eip_7702",e.GasBuffer="confirmations_gas_buffer",e.IncomingTransactions="confirmations_incoming_transactions",e.Transactions="confirmations_transactions"}(o||(n.FeatureFlag=o={}));const c=(0,r.createModuleLogger)(i.projectLogger,"feature-flags");function l(e,t,n){const r=u(t);return(r?.[o.EIP7702]?.contracts?.[e.toLowerCase()]??[]).filter(t=>(0,s.isValidSignature)([t.address,(0,a.padHexToEvenLength)(e)],t.signature,n)).map(e=>e.address)}function u(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags;return c("Retrieved feature flags",t),t}n.getEIP7702SupportedChains=function(e){const t=u(e);return t?.[o.EIP7702]?.supportedChains??[]},n.getEIP7702ContractAddresses=l,n.getEIP7702UpgradeContractAddress=function(e,t,n){return l(e,t,n)?.[0]},n.getBatchSizeLimit=function(e){const t=u(e);return t?.[o.Transactions]?.batchSizeLimit??10},n.getAcceleratedPollingParams=function(e,t){const n=u(t),r=n?.[o.Transactions]?.acceleratedPolling;return{countMax:r?.perChainConfig?.[e]?.countMax||r?.defaultCountMax||10,intervalMs:r?.perChainConfig?.[e]?.intervalMs||r?.defaultIntervalMs||3e3}},n.getGasFeeRandomisation=function(e){const t=u(e),n=t?.[o.Transactions]?.gasFeeRandomisation||{};return{randomisedGasFeeDigits:n.randomisedGasFeeDigits||{},preservedNumberOfDigits:n.preservedNumberOfDigits}},n.getGasEstimateFallback=function(e,t){const n=u(t),r=n?.[o.Transactions]?.gasEstimateFallback,s=r?.perChainConfig?.[e],a=s?.percentage??r?.default?.percentage??35;return{fixed:s?.fixed??r?.default?.fixed,percentage:a}},n.getGasEstimateBuffer=function({chainId:e,isCustomRPC:t,isUpgradeWithDataToSelf:n,messenger:r}){const s=u(r),a=s?.[o.GasBuffer],i=a?.perChainConfig?.[e],c=t?undefined:i?.included,l=t?undefined:a?.included;return(n?i?.eip7702:undefined)??c??i?.base??l??a?.default??1},n.getIncomingTransactionsPollingInterval=function(e){const t=u(e);return t?.[o.IncomingTransactions]?.pollingIntervalMs??24e4}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/feature-flags.cjs"}],[1813,{"../api/accounts-api.cjs":1783,"../logger.cjs":1806,"./transaction-type.cjs":1825,"./validation.cjs":1827,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateFirstTimeInteraction=void 0;const r=e("@metamask/utils"),s=e("./transaction-type.cjs"),a=e("./validation.cjs"),i=e("../api/accounts-api.cjs"),o=e("../logger.cjs");n.updateFirstTimeInteraction=async function({existingTransactions:e,getTransaction:t,isFirstTimeInteractionEnabled:n,trace:c,traceContext:l,transactionMeta:u,updateTransaction:d}){if(!n())return;const{chainId:h,id:m,txParams:{data:g,from:p,to:f}}=u;let b;if(g){const e=(0,s.decodeTransactionData)(g);b=e?.args?._to||e?.args?.to}b||(b=f);const w={chainId:(0,r.hexToNumber)(h),to:b,from:p};if((0,a.validateParamTo)(b),!e.find(e=>e.chainId===h&&e.txParams.from.toLowerCase()===p.toLowerCase()&&e.txParams.to?.toLowerCase()===f?.toLowerCase()&&e.id!==m))try{const{count:e}=await c({name:"Account Address Relationship",parentContext:l},()=>(0,i.getAccountAddressRelationship)(w)),n=e===undefined?undefined:0===e;if(!t(m))return void(0,o.projectLogger)("Cannot update first time interaction as transaction not found",m);d({transactionId:m,note:"TransactionController#updateFirstInteraction - Update first time interaction"},e=>{e.isFirstTimeInteraction=n}),(0,o.projectLogger)("Updated first time interaction",m,{isFirstTimeInteraction:n})}catch(e){(0,o.projectLogger)("Error fetching account address relationship, skipping first time interaction update",e)}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/first-time-interaction.cjs"}],[1814,{"../api/simulation-api.cjs":1784,"../logger.cjs":1806,"./batch.cjs":1809,"./eip7702.cjs":1810,"./feature-flags.cjs":1812,"@metamask/rpc-errors":2594,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getGasFeeTokens=void 0;const r=e("@metamask/rpc-errors"),s=e("@metamask/utils"),a=e("./batch.cjs"),i=e("./eip7702.cjs"),o=e("./feature-flags.cjs"),c=e("../api/simulation-api.cjs"),l=e("../logger.cjs"),u=(0,s.createModuleLogger)(l.projectLogger,"gas-fee-tokens");n.getGasFeeTokens=async function({chainId:e,isEIP7702GasFeeTokensEnabled:t,messenger:n,publicKeyEIP7702:s,transactionMeta:l,getSimulationConfig:d}){const{delegationAddress:h,txParams:m}=l,{authorizationList:g}=m,p=m.data,f=m.from,b=m.to,w=m.value;u("Request",{chainId:e,txParams:m});const C=await t(l)&&(0,i.doesChainSupportEIP7702)(e,n);let k=g?.map(e=>({address:e.address,from:f}));!C||h||k||(k=function({chainId:e,from:t,messenger:n,publicKeyEIP7702:s}){if(!s)throw r.rpcErrors.internal(i.ERROR_MESSGE_PUBLIC_KEY);const c=(0,o.getEIP7702UpgradeContractAddress)(e,n,s);if(!c)throw r.rpcErrors.internal(a.ERROR_MESSAGE_NO_UPGRADE_CONTRACT);return[{address:c,from:t}]}({chainId:e,from:f,messenger:n,publicKeyEIP7702:s}));try{const t=await(0,c.simulateTransactions)(e,{getSimulationConfig:d,transactions:[{authorizationList:k,data:p,from:f,to:b,value:w}],suggestFees:{withTransfer:!0,withFeeTransfer:!0,with7702:C}});u("Response",t);const n=function(e){const t=e.transactions?.[0]?.fees?.[0],n=e.sponsorship?.isSponsored??!1;return{gasFeeTokens:(t?.tokenFees??[]).map(e=>({amount:e.balanceNeededToken,balance:e.currentBalanceToken,decimals:e.token.decimals,fee:e.serviceFee,gas:t.gas,gasTransfer:e.transferEstimate,maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas,rateWei:e.rateWei,recipient:e.feeRecipient,symbol:e.token.symbol,tokenAddress:e.token.address})),isGasFeeSponsored:n}}(t);return u("Gas fee tokens",n),n}catch(e){return u("Failed to gas fee tokens",e),{gasFeeTokens:[],isGasFeeSponsored:!1}}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/gas-fee-tokens.cjs"}],[1815,{"../logger.cjs":1806,"../types.cjs":1807,"./gas-flow.cjs":1816,"./swaps.cjs":1824,"@metamask/controller-utils":1384,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.gweiDecimalToWeiDecimal=n.gweiDecimalToWeiHex=n.updateGasFees=void 0;const r=e("@metamask/controller-utils"),s=e("@metamask/utils"),a=e("./gas-flow.cjs"),i=e("./swaps.cjs"),o=e("../logger.cjs"),c=e("../types.cjs"),l=(0,s.createModuleLogger)(o.projectLogger,"gas-fees");function u(e){return(0,r.toHex)((0,r.gweiDecToWEIBN)(e))}n.updateGasFees=async function(e){const{txMeta:t}=e,n={...t.txParams},o=i.SWAP_TRANSACTION_TYPES.includes(t.type)?undefined:e.getSavedGasFees(t.chainId),d=await async function(e){const{eip1559:t,ethQuery:n,gasFeeFlows:i,getGasFeeEstimates:o,messenger:u,txMeta:d}=e,{networkClientId:h}=d;if(!t&&d.txParams.gasPrice||t&&d.txParams.maxFeePerGas&&d.txParams.maxPriorityFeePerGas)return{};const m=(0,a.getGasFeeFlow)(d,i,u);try{const e=await o({networkClientId:h}),t=await m.getGasFees({ethQuery:n,gasFeeControllerData:e,messenger:u,transactionMeta:d}),r=t.estimates?.type;switch(r){case c.GasFeeEstimateType.FeeMarket:return t.estimates.medium;case c.GasFeeEstimateType.Legacy:return{gasPrice:t.estimates.medium};case c.GasFeeEstimateType.GasPrice:return{gasPrice:t.estimates.gasPrice};default:throw new Error(`Unsupported gas fee estimate type returned from flow: ${r}`)}}catch(e){l("Failed to get suggested gas fees",e)}const g=await(0,r.query)(n,"gasPrice");return{gasPrice:g?(0,s.add0x)(g.toString(16)):undefined}}(e);l("Suggested gas fees",d);const h={...e,initialParams:n,savedGasFees:o,suggestedGasFees:d};t.txParams.maxFeePerGas=function(e){const{savedGasFees:t,eip1559:n,initialParams:r,suggestedGasFees:s}=e;if(!n)return undefined;if(t){const e=u(t.maxBaseFee);return l("Using maxFeePerGas from savedGasFees",e),e}if(r.maxFeePerGas)return l("Using maxFeePerGas from request",r.maxFeePerGas),r.maxFeePerGas;if(r.gasPrice&&!r.maxPriorityFeePerGas)return l("Setting maxFeePerGas to gasPrice from request",r.gasPrice),r.gasPrice;if(s.maxFeePerGas)return l("Using suggested maxFeePerGas",s.maxFeePerGas),s.maxFeePerGas;if(s.gasPrice)return l("Setting maxFeePerGas to suggested gasPrice",s.gasPrice),s.gasPrice;return l("maxFeePerGas not set"),undefined}(h),t.txParams.maxPriorityFeePerGas=function(e){const{eip1559:t,initialParams:n,savedGasFees:r,suggestedGasFees:s,txMeta:a}=e;if(!t)return undefined;if(r){const e=u(r.priorityFee);return l("Using maxPriorityFeePerGas from savedGasFees.priorityFee",e),e}if(n.maxPriorityFeePerGas)return l("Using maxPriorityFeePerGas from request",n.maxPriorityFeePerGas),n.maxPriorityFeePerGas;if(n.gasPrice&&!n.maxFeePerGas)return l("Setting maxPriorityFeePerGas to gasPrice from request",n.gasPrice),n.gasPrice;if(s.maxPriorityFeePerGas)return l("Using suggested maxPriorityFeePerGas",s.maxPriorityFeePerGas),s.maxPriorityFeePerGas;if(a.txParams.maxFeePerGas)return l("Setting maxPriorityFeePerGas to maxFeePerGas",a.txParams.maxFeePerGas),a.txParams.maxFeePerGas;return l("maxPriorityFeePerGas not set"),undefined}(h),t.txParams.gasPrice=function(e){const{eip1559:t,initialParams:n,suggestedGasFees:r}=e;if(t)return undefined;if(n.gasPrice)return l("Using gasPrice from request",n.gasPrice),n.gasPrice;if(r.maxFeePerGas)return l("Using suggested maxFeePerGas",r.maxFeePerGas),r.maxFeePerGas;if(r.gasPrice)return l("Using suggested gasPrice",r.gasPrice),r.gasPrice;return l("gasPrice not set"),undefined}(h),t.userFeeLevel=function(e){const{initialParams:t,savedGasFees:n,suggestedGasFees:s,txMeta:a}=e;if(n)return c.UserFeeLevel.CUSTOM;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&t.gasPrice)return a.origin===r.ORIGIN_METAMASK?c.UserFeeLevel.CUSTOM:c.UserFeeLevel.DAPP_SUGGESTED;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&s.maxFeePerGas&&s.maxPriorityFeePerGas)return c.UserFeeLevel.MEDIUM;if(!t.maxFeePerGas&&!t.maxPriorityFeePerGas&&s.gasPrice)return c.UserFeeLevel.MEDIUM;if(a.origin===r.ORIGIN_METAMASK)return c.UserFeeLevel.MEDIUM;return c.UserFeeLevel.DAPP_SUGGESTED}(h),l("Updated gas fee properties",{maxFeePerGas:t.txParams.maxFeePerGas,maxPriorityFeePerGas:t.txParams.maxPriorityFeePerGas,gasPrice:t.txParams.gasPrice}),(t.txParams.maxFeePerGas||t.txParams.maxPriorityFeePerGas)&&delete t.txParams.gasPrice,t.txParams.gasPrice&&(delete t.txParams.maxFeePerGas,delete t.txParams.maxPriorityFeePerGas),function(e){e.defaultGasEstimates||(e.defaultGasEstimates={});e.defaultGasEstimates.maxFeePerGas=e.txParams.maxFeePerGas,e.defaultGasEstimates.maxPriorityFeePerGas=e.txParams.maxPriorityFeePerGas,e.defaultGasEstimates.gasPrice=e.txParams.gasPrice,e.defaultGasEstimates.estimateType=e.userFeeLevel}(t)},n.gweiDecimalToWeiHex=u,n.gweiDecimalToWeiDecimal=function(e){return(1e9*Number(e)).toString().split(".")[0]}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/gas-fees.cjs"}],[1816,{"../types.cjs":1807,"@metamask/controller-utils":1384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.mergeGasFeeEstimates=n.getGasFeeFlow=void 0;const r=e("@metamask/controller-utils"),s=e("../types.cjs");function a(e,t){return(0,r.weiHexToGweiDec)(e[t])}n.getGasFeeFlow=function(e,t,n){return t.find(t=>t.matchesTransaction({transactionMeta:e,messenger:n}))},n.mergeGasFeeEstimates=function({gasFeeControllerEstimates:e,transactionGasFeeEstimates:t}){const n=t.type;return n===s.GasFeeEstimateType.FeeMarket?Object.values(s.GasFeeEstimateLevel).reduce((n,s)=>{return{...n,[s]:(a=e?.[s],i=t[s],{...a,suggestedMaxFeePerGas:(0,r.weiHexToGweiDec)(i.maxFeePerGas),suggestedMaxPriorityFeePerGas:(0,r.weiHexToGweiDec)(i.maxPriorityFeePerGas)})};var a,i},{...e}):n===s.GasFeeEstimateType.Legacy?Object.values(s.GasFeeEstimateLevel).reduce((e,n)=>({...e,[n]:a(t,n)}),{}):n===s.GasFeeEstimateType.GasPrice?{gasPrice:(i=t,(0,r.weiHexToGweiDec)(i.gasPrice))}:e;var i}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/gas-flow.cjs"}],[1817,{"../api/simulation-api.cjs":1784,"../logger.cjs":1806,"../types.cjs":1807,"./eip7702.cjs":1810,"./feature-flags.cjs":1812,"@metamask/controller-utils":1384,"@metamask/utils":3070,"bn.js":3977},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.simulateGasBatch=n.addGasBuffer=n.estimateGas=n.updateGas=n.DUMMY_AUTHORIZATION_SIGNATURE=n.INTRINSIC_GAS=n.MAX_GAS_BLOCK_PERCENT=n.DEFAULT_GAS_MULTIPLIER=n.FIXED_GAS=n.log=void 0;const r=e("@metamask/controller-utils"),s=e("@metamask/utils"),a=e("bn.js"),i=e("./eip7702.cjs"),o=e("./feature-flags.cjs"),c=e("../api/simulation-api.cjs"),l=e("../logger.cjs"),u=e("../types.cjs");async function d({chainId:e,ethQuery:t,ignoreDelegationSignatures:a,isSimulationEnabled:i,getSimulationConfig:c,messenger:l,txParams:d}){const h={...d},{authorizationList:p,data:f,from:b,value:w,to:C}=h;if(a&&!i)throw new Error("Gas estimation with ignored delegation signatures is not supported as simulation disabled");const{gasLimit:k,number:y}=await async function(e){return await(0,r.query)(e,"getBlockByNumber",["latest",!1])}(t),T=(0,r.hexToBN)(k),{percentage:v,fixed:S}=(0,o.getGasEstimateFallback)(e,l),P=S?(0,r.toHex)(S):(0,r.BNToHex)((0,r.fractionBN)(T,v,100));(0,n.log)("Estimation fallback values",P),h.data=f?(0,s.add0x)(f):f,h.value=w||"0x0",h.authorizationList=function(e,t){return e?.map(e=>({...e,chainId:e.chainId??t,nonce:e.nonce??"0x1",r:e.r??n.DUMMY_AUTHORIZATION_SIGNATURE,s:e.s??n.DUMMY_AUTHORIZATION_SIGNATURE,yParity:e.yParity??"0x1"}))}(h.authorizationList,e),delete h.gasPrice,delete h.maxFeePerGas,delete h.maxPriorityFeePerGas;let I,M=P;const E=d.type===u.TransactionEnvelopeType.setCode&&Boolean(p?.length)&&Boolean(f)&&"0x"!==f&&b?.toLowerCase()===C?.toLowerCase();try{M=i&&E?await async function(e,t,s,a){const i=await(0,r.query)(t,"estimateGas",[{...e,data:"0x"}]);(0,n.log)("Upgrade only gas",i);const o=e.authorizationList?.[0].address;let c;try{c=await m({chainId:s,delegationAddress:o,getSimulationConfig:a,transaction:e})}catch(e){(0,n.log)("Error while simulating data portion of upgrade",e)}if(c===undefined){try{c=await g(t,{...e,authorizationList:undefined,type:undefined},o)}catch(e){throw(0,n.log)("Error while estimating data portion of upgrade",e),e}(0,n.log)("Success estimating data portion of upgrade",c)}(0,n.log)("Execute gas",c);const l=(0,r.BNToHex)((0,r.hexToBN)(i).add((0,r.hexToBN)(c)).subn(n.INTRINSIC_GAS));return(0,n.log)("Total type 4 gas",l),l}(h,t,e,c):a&&i?await m({chainId:e,getSimulationConfig:c,transaction:h}):await g(t,h)}catch(e){I={reason:e.message,errorKey:e.errorKey,debug:{blockNumber:y,blockGasLimit:k}},(0,n.log)("Estimation failed",{...I,fallback:P})}return{blockGasLimit:k,estimatedGas:M,isUpgradeWithDataToSelf:E,simulationFails:I}}function h(e,t,a){const i=(0,r.hexToBN)(e),o=(0,r.fractionBN)((0,r.hexToBN)(t),n.MAX_GAS_BLOCK_PERCENT,100),c=(0,r.fractionBN)(i,100*a,100);if(i.gt(o)){const t=(0,s.add0x)(e);return(0,n.log)("Using estimated value",t),t}if(c.lt(o)){const e=(0,s.add0x)((0,r.BNToHex)(c));return(0,n.log)("Using padded estimate",e,a),e}const l=(0,s.add0x)((0,r.BNToHex)(o));return(0,n.log)("Using 90% of block gas limit",l),l}async function m({chainId:e,delegationAddress:t,getSimulationConfig:n,transaction:r}){const a=await(0,c.simulateTransactions)(e,{getSimulationConfig:n,transactions:[{to:r.to,from:r.from,data:r.data,value:r.value}],overrides:{[r.from]:{code:t&&i.DELEGATION_PREFIX+(0,s.remove0x)(t)}}}),o=a?.transactions?.[0].gasLimit;if(!o)throw new Error("No simulated gas returned");return o}function g(e,t,n){const{from:a}=t,o=[t];return n&&(o.push("latest"),o.push({[a]:{code:i.DELEGATION_PREFIX+(0,s.remove0x)(n)}})),(0,r.query)(e,"estimateGas",o)}n.log=(0,s.createModuleLogger)(l.projectLogger,"gas"),n.FIXED_GAS="0x5208",n.DEFAULT_GAS_MULTIPLIER=1.5,n.MAX_GAS_BLOCK_PERCENT=90,n.INTRINSIC_GAS=21e3,n.DUMMY_AUTHORIZATION_SIGNATURE="0x1111111111111111111111111111111111111111111111111111111111111111",n.updateGas=async function(e){const{txMeta:t}=e,s={...t.txParams},[a,i,c]=await async function(e){const{chainId:t,isCustomNetwork:s,isSimulationEnabled:a,getSimulationConfig:i,messenger:c,txMeta:l}=e,{disableGasBuffer:m}=l;if(l.txParams.gas)return(0,n.log)("Using value from request",l.txParams.gas),[l.txParams.gas,undefined,l.txParams.gas];if(await async function({ethQuery:e,txMeta:t,isCustomNetwork:n}){const{txParams:{to:s,data:a,type:i}}=t;if(n||!s||a||i===u.TransactionEnvelopeType.setCode)return!1;const o=await async function(e,t){return await(0,r.query)(e,"getCode",[t])}(e,s);return!o||"0x"===o}(e))return(0,n.log)("Using fixed value",n.FIXED_GAS),[n.FIXED_GAS,undefined,n.FIXED_GAS];const{blockGasLimit:g,estimatedGas:p,isUpgradeWithDataToSelf:f,simulationFails:b}=await d({chainId:t,ethQuery:e.ethQuery,isSimulationEnabled:a,getSimulationConfig:i,messenger:c,txParams:l.txParams});(0,n.log)("Original estimated gas",p),b&&(0,n.log)("Using original fallback estimate as simulation failed");m&&(0,n.log)("Gas buffer disabled");if(b||m)return[p,b,p];const w=(0,o.getGasEstimateBuffer)({chainId:t,isCustomRPC:s,isUpgradeWithDataToSelf:f,messenger:c});(0,n.log)("Buffer",w);const C=h(p,g,w);return(0,n.log)("Buffered gas",C),[C,b,p]}(e);t.txParams.gas=a,t.simulationFails=i,t.gasLimitNoBuffer=c,s.gas||(t.originalGasEstimate=t.txParams.gas),t.defaultGasEstimates||(t.defaultGasEstimates={}),t.defaultGasEstimates.gas=t.txParams.gas},n.estimateGas=d,n.addGasBuffer=h,n.simulateGasBatch=async function({chainId:e,from:t,getSimulationConfig:s,transactions:i}){try{const n=await(0,c.simulateTransactions)(e,{getSimulationConfig:s,transactions:i.map(e=>({...e.params,from:t}))});if(!n?.transactions||n.transactions.length!==i.length)throw new Error("Simulation response does not match transaction count");const o=n.transactions.reduce((e,t)=>{const n=t?.gasLimit;if(!n)throw new Error("No simulated gas returned for one of the transactions");return e.add((0,r.hexToBN)(n))},new a.BN(0));return{gasLimit:(0,r.BNToHex)(o)}}catch(e){throw(0,n.log)("Error while simulating gas batch",e),new Error("Cannot estimate transaction batch total gas as simulation failed")}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/gas.cjs"}],[1818,{"fast-json-patch":4351,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateTransactionHistory=n.addInitialHistorySnapshot=n.DISPLAYED_TRANSACTION_HISTORY_PATHS=n.MAX_TRANSACTION_HISTORY_LENGTH=void 0;const s=r(e("fast-json-patch")),a=e("lodash");function i(e,t,n){const r=s.default.compare(e,t);return r[0]&&(n&&(r[0].note=n),r[0].timestamp=Date.now()),r}function o(e){return(0,a.cloneDeep)(e).reduce((e,t)=>s.default.applyPatch(e,t).newDocument)}function c(e){const t={...e};return delete t.history,(0,a.cloneDeep)(t)}n.MAX_TRANSACTION_HISTORY_LENGTH=100,n.DISPLAYED_TRANSACTION_HISTORY_PATHS=["/status","/txParams/gasPrice","/txParams/gas","/estimatedBaseFee","/blockTimestamp"],n.addInitialHistorySnapshot=function(e){const t=c(e);return(0,a.merge)({},e,{history:[t]})},n.updateTransactionHistory=function(e,t){if(!e.history)return e;const r=c(e),s=i(o(e.history),r,t);if(0===s.length)return e;let l=[...e.history,s];return l.length>n.MAX_TRANSACTION_HISTORY_LENGTH&&(l=function(e){const t=e[0],r=e.slice(1),s=r.findIndex(e=>!e.some(({path:e})=>n.DISPLAYED_TRANSACTION_HISTORY_PATHS.includes(e)));if(-1===s)return e;const a=s===r.length-1?s-1:s+1,c=Math.min(s,a),l=r[c],u=r[c+1],d=o([t,...r.slice(0,c)]),h=o([d,l,u]),m=i(d,h,`${String(l[0].note)}, ${String(u[0].note)}`);return r.splice(c,2,m),[t,...r]}(l)),(0,a.merge)({},e,{history:l})}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/history.cjs"}],[1819,{"../logger.cjs":1806,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionLayer1GasFee=n.updateTransactionLayer1GasFee=void 0;const r=e("@metamask/utils"),s=e("../logger.cjs"),a=(0,r.createModuleLogger)(s.projectLogger,"layer-1-gas-fee-flow");async function i({layer1GasFeeFlows:e,messenger:t,provider:n,transactionMeta:r}){const s=await async function(e,t,n){for(const r of t)if(await r.matchesTransaction({transactionMeta:e,messenger:n}))return r;return undefined}(r,e,t);if(!s)return undefined;a("Found layer 1 gas fee flow",s.constructor.name,r.id);try{const{layer1Fee:e}=await s.getLayer1Fee({provider:n,transactionMeta:r});return e}catch(e){return a("Failed to get layer 1 gas fee",r.id,e),undefined}}n.updateTransactionLayer1GasFee=async function(e){const t=await i(e);if(!t)return;const{transactionMeta:n}=e;n.layer1GasFee=t,a("Updated layer 1 gas fee",t,n.id)},n.getTransactionLayer1GasFee=i}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/layer1-gas-fee-flow.cjs"}],[182,{"@metamask/profile-metrics-controller":2450,"@metamask/profile-sync-controller":2506},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ProfileMetricsServiceInit=void 0;var r=e("@metamask/profile-metrics-controller"),s=e("@metamask/profile-sync-controller");n.ProfileMetricsServiceInit=({controllerMessenger:e})=>{const t=s.SDK.Env.PRD;return{persistedStateKey:null,memStateKey:null,controller:new r.ProfileMetricsService({messenger:e,fetch:fetch.bind(globalThis),env:t})}}}}},{package:"$root$",file:"app/scripts/controller-init/profile-metrics-service-init.ts"}],[1820,{"../logger.cjs":1806,"@metamask/controller-utils":1384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAndFormatTransactionsForNonceTracker=n.getNextNonce=void 0;const r=e("@metamask/controller-utils"),s=e("../logger.cjs"),a=(0,s.createModuleLogger)(s.projectLogger,"nonce");n.getNextNonce=async function(e,t){const{customNonceValue:n,isExternalSign:s,txParams:{from:i,nonce:o}}=e;if(s)return[undefined,undefined];const c=n?(0,r.toHex)(n):undefined;if(c)return a("Using custom nonce",c),[c,undefined];if(o)return a("Using existing nonce",o),[o,undefined];const l=await t(i),u=(0,r.toHex)(l.nextNonce),d=l.releaseLock.bind(l);return a("Using nonce from nonce tracker",u,l.nonceDetails),[u,d]},n.getAndFormatTransactionsForNonceTracker=function(e,t,n,r){return r.filter(({chainId:r,isTransfer:s,isUserOperation:a,status:i,txParams:{from:o}})=>!s&&!a&&r===e&&n.includes(i)&&o.toLowerCase()===t.toLowerCase()).map(({status:e,txParams:{from:t,gas:n,value:r,nonce:s}})=>({status:e,history:[{}],txParams:{from:t??"",gas:n??"",value:r??"",nonce:s??""}}))}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/nonce.cjs"}],[1821,{"@ethereumjs/common":648,"@ethereumjs/tx":665,"@metamask/utils":3070,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.serializeTransaction=n.prepareTransaction=n.HARDFORK=void 0;const r=e("@ethereumjs/common"),s=e("@ethereumjs/tx"),a=e("@metamask/utils"),i=e("lodash");function o(e){const t={chainId:parseInt(e,16),defaultHardfork:n.HARDFORK};return r.Common.custom(t,{eips:[7702]})}function c(e){return e?"0x0"===e?"0x":e.replace?.(/^0x(00)+/u,"0x")??e:e}n.HARDFORK=r.Hardfork.Prague,n.prepareTransaction=function(e,t){const n=function(e){const t=(0,i.cloneDeep)(e);return function(e){if(!e)return;for(const t of e)t.nonce=c(t.nonce),t.r=c(t.r),t.s=c(t.s),t.yParity=c(t.yParity)}(t.authorizationList),t}(t);return s.TransactionFactory.fromTxData(n,{freeze:!1,common:o(e)})},n.serializeTransaction=function(e){return(0,a.bytesToHex)(e.serialize())}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/prepare.cjs"}],[1822,{"@metamask/controller-utils":1384,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionParamsWithIncreasedGasFee=void 0;const r=e("@metamask/controller-utils"),s=e("@metamask/utils");function a(e,t){const n=(0,r.convertHexToDecimal)(e),a=parseInt(""+n*t,10);return(0,s.add0x)(a.toString(16))}n.getTransactionParamsWithIncreasedGasFee=function(e,t,n){const r=function(e,t,n){if(n&&"gasPrice"in n)return n.gasPrice;const r=e.gasPrice;if(!r||"0x0"===r)return undefined;return a(r,t)}(e,t,n),s=function(e,t,n){if(n&&"maxFeePerGas"in n&&"maxPriorityFeePerGas"in n)return n;const r=e.maxFeePerGas,s=e.maxPriorityFeePerGas;if(!r||!s||"0x0"===r||"0x0"===s)return undefined;const i=a(r,t),o=a(s,t);return{maxFeePerGas:i,maxPriorityFeePerGas:o}}(e,t,n);if(s){const t={...e,...s};return delete t.gasPrice,t}if(r){const t={...e,gasPrice:r};return delete t.maxFeePerGas,delete t.maxPriorityFeePerGas,t}throw new Error("Cannot increase gas fee as no current values and no new values were provided")}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/retry.cjs"}],[1823,{"@ethersproject/wallet":802,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValidSignature=void 0;const r=e("@ethersproject/wallet"),s=e("@metamask/utils");n.isValidSignature=function(e,t,n){try{const a=(0,s.add0x)(e.map(s.remove0x).join("")),i=(0,s.hexToBytes)(a);return(0,r.verifyMessage)(i,t).toLowerCase()===n.toLowerCase()}catch{return!1}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/signature.cjs"}],[1824,{"../constants.cjs":1785,"../logger.cjs":1806,"../types.cjs":1807,"./utils.cjs":1826,"@metamask/controller-utils":1384,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updatePostTransactionBalance=n.updateSwapsTransaction=n.SWAP_TRANSACTION_TYPES=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.DEFAULT_TOKEN_ADDRESS=n.UPDATE_POST_TX_BALANCE_ATTEMPTS=n.UPDATE_POST_TX_BALANCE_TIMEOUT=void 0;const r=e("@metamask/controller-utils"),s=e("lodash"),a=e("./utils.cjs"),i=e("../constants.cjs"),o=e("../logger.cjs"),c=e("../types.cjs"),l=(0,o.createModuleLogger)(o.projectLogger,"swaps");n.UPDATE_POST_TX_BALANCE_TIMEOUT=5e3,n.UPDATE_POST_TX_BALANCE_ATTEMPTS=6;const u="0x539";n.DEFAULT_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000";const d={name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},h={name:"Binance Coin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},m={name:"Matic",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},g={name:"Avalanche",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},p={name:"Test Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},f={name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},b={...d},w={...d},C={...d},k={name:"Sei",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18},y={name:"Mon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18};function T(e,t){return!(!e||!t)&&e===n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[t]?.address}function v(e){return new Promise(t=>setTimeout(t,e))}n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP={[i.CHAIN_IDS.MAINNET]:d,[u]:p,[i.CHAIN_IDS.BSC]:h,[i.CHAIN_IDS.POLYGON]:m,[i.CHAIN_IDS.GOERLI]:f,[i.CHAIN_IDS.AVALANCHE]:g,[i.CHAIN_IDS.OPTIMISM]:w,[i.CHAIN_IDS.ARBITRUM]:b,[i.CHAIN_IDS.ZKSYNC_ERA]:C,[i.CHAIN_IDS.SEI]:k,[i.CHAIN_IDS.MONAD]:y},n.SWAP_TRANSACTION_TYPES=[c.TransactionType.swap,c.TransactionType.swapAndSend,c.TransactionType.swapApproval],n.updateSwapsTransaction=function(e,t,r,{isSwapsDisabled:i,cancelTransaction:o,messenger:l}){if(i||!n.SWAP_TRANSACTION_TYPES.includes(t))return e;if(t===c.TransactionType.swap&&!1===r?.hasApproveTx&&e.simulationFails)throw o(e.id),new Error("Simulation failed");const u=r?.meta;if(!u)return e;let d=e;return t===c.TransactionType.swapApproval&&(d=function(e,{type:t,sourceTokenSymbol:n}){(0,a.validateIfTransactionUnapproved)(e,"updateSwapApprovalTransaction");let r={type:t,sourceTokenSymbol:n};return r=(0,s.pickBy)({type:t,sourceTokenSymbol:n}),(0,s.merge)({},e,r)}(e,u),l.publish("TransactionController:transactionNewSwapApproval",{transactionMeta:d})),t===c.TransactionType.swapAndSend&&(d=function(e,{approvalTxId:t,destinationTokenAddress:n,destinationTokenAmount:r,destinationTokenDecimals:i,destinationTokenSymbol:o,estimatedBaseFee:c,sourceTokenAddress:l,sourceTokenAmount:u,sourceTokenDecimals:d,sourceTokenSymbol:h,swapAndSendRecipient:m,swapMetaData:g,swapTokenValue:p,type:f}){(0,a.validateIfTransactionUnapproved)(e,"updateSwapTransaction");let b={approvalTxId:t,destinationTokenAddress:n,destinationTokenAmount:r,destinationTokenDecimals:i,destinationTokenSymbol:o,estimatedBaseFee:c,sourceTokenAddress:l,sourceTokenAmount:u,sourceTokenDecimals:d,sourceTokenSymbol:h,swapAndSendRecipient:m,swapMetaData:g,swapTokenValue:p,type:f};return b=(0,s.pickBy)(b),(0,s.merge)({},e,b)}(e,u),l.publish("TransactionController:transactionNewSwapAndSend",{transactionMeta:d})),t===c.TransactionType.swap&&(d=function(e,{sourceTokenSymbol:t,destinationTokenSymbol:n,type:r,destinationTokenDecimals:i,destinationTokenAddress:o,swapMetaData:c,swapTokenValue:l,estimatedBaseFee:u,approvalTxId:d}){(0,a.validateIfTransactionUnapproved)(e,"updateSwapTransaction");let h={sourceTokenSymbol:t,destinationTokenSymbol:n,type:r,destinationTokenDecimals:i,destinationTokenAddress:o,swapMetaData:c,swapTokenValue:l,estimatedBaseFee:u,approvalTxId:d};return h=(0,s.pickBy)(h),(0,s.merge)({},e,h)}(e,u),l.publish("TransactionController:transactionNewSwap",{transactionMeta:d})),d},n.updatePostTransactionBalance=async function(e,{ethQuery:t,getTransaction:s,updateTransaction:a}){l("Updating post transaction balance",e.id);const i=e.id;let o,c;for(let a=0;a<n.UPDATE_POST_TX_BALANCE_ATTEMPTS;a++){l("Querying balance",{attempt:a});const u=await(0,r.query)(t,"getBalance",[e.txParams.from]);o={...s(i)??{}},c=o.approvalTxId?s(o.approvalTxId):undefined,o.postTxBalance=u.toString(16);const d=T(e.destinationTokenAddress,e.chainId);if(!d||e.preTxBalance!==o.postTxBalance){l("Finishing post balance update",{isDefaultTokenAddress:d,preTxBalance:e.preTxBalance,postTxBalance:o.postTxBalance});break}l("Waiting for balance to update",{delay:n.UPDATE_POST_TX_BALANCE_TIMEOUT}),await v(n.UPDATE_POST_TX_BALANCE_TIMEOUT)}return a(o,"TransactionController#updatePostTransactionBalance - Add post transaction balance"),l("Completed post balance update",o?.postTxBalance),{updatedTransactionMeta:o,approvalTransactionMeta:c}}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/swaps.cjs"}],[1825,{"../types.cjs":1807,"./eip7702.cjs":1810,"@ethersproject/abi":705,"@metamask/controller-utils":1384,"@metamask/metamask-eth-abis":2244},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionData=n.determineTransactionType=n.ESTIMATE_GAS_ERROR=void 0;const r=e("@ethersproject/abi"),s=e("@metamask/controller-utils"),a=e("@metamask/metamask-eth-abis"),i=e("./eip7702.cjs"),o=e("../types.cjs");n.ESTIMATE_GAS_ERROR="eth_estimateGas rpc method error";const c=new r.Interface(a.abiERC20),l=new r.Interface(a.abiERC721),u=new r.Interface(a.abiERC1155),d=new r.Interface(a.abiFiatTokenV2);function h(e,t){if(!e||e.length<10)return undefined;const n=e.substring(0,10).toLowerCase();for(const r of[c,l,u,d])try{return t?.getMethodName?r.getFunction(n)?.name:r.parseTransaction({data:e})}catch{}return undefined}n.determineTransactionType=async function(e,t){const{data:n,to:r}=e;if(n&&!r)return{type:o.TransactionType.deployContract,getCodeResponse:undefined};let a,c=Boolean(n?.length);if(t){const e=await async function(e,t){let n;try{n=await(0,s.query)(e,"getCode",[t])}catch(e){n=null}const r=!!n&&("0x"!==n&&"0x0"!==n&&!n.startsWith(i.DELEGATION_PREFIX));return{contractCode:n,isContractAddress:r}}(t,r);a=e.contractCode,c=e.isContractAddress}if(!c)return{type:o.TransactionType.simpleSend,getCodeResponse:a};const l=0!==Number(e.value??"0"),u={type:o.TransactionType.contractInteraction,getCodeResponse:a};if(!n||l)return u;const d=function(e){return h(e,{getMethodName:!0})}(n);if(!d)return u;const m=[o.TransactionType.tokenMethodApprove,o.TransactionType.tokenMethodSetApprovalForAll,o.TransactionType.tokenMethodTransfer,o.TransactionType.tokenMethodTransferFrom,o.TransactionType.tokenMethodSafeTransferFrom,o.TransactionType.tokenMethodIncreaseAllowance].find(e=>e.toLowerCase()===d.toLowerCase());return m?{type:m,getCodeResponse:a}:u},n.decodeTransactionData=h}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/transaction-type.cjs"}],[1826,{"../types.cjs":1807,"@metamask/utils":3070,"bn.js":3977},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.setEnvelopeType=n.getPercentageChange=n.toBN=n.bnFromHex=n.padHexToEvenLength=n.normalizeGasFeeValues=n.normalizeTxError=n.validateIfTransactionUnapproved=n.validateGasValues=n.isEIP1559Transaction=n.normalizeTransactionParams=n.ESTIMATE_GAS_ERROR=void 0;const s=e("@metamask/utils"),a=r(e("bn.js")),i=e("../types.cjs");n.ESTIMATE_GAS_ERROR="eth_estimateGas rpc method error";const o={accessList:e=>e,authorizationList:e=>e,data:e=>(0,s.add0x)(l(e)),from:e=>(0,s.add0x)(e).toLowerCase(),gas:e=>(0,s.add0x)(e),gasLimit:e=>(0,s.add0x)(e),gasPrice:e=>(0,s.add0x)(e),nonce:e=>(0,s.add0x)(e),to:e=>(0,s.add0x)(e).toLowerCase(),value:e=>(0,s.add0x)(e),maxFeePerGas:e=>(0,s.add0x)(e),maxPriorityFeePerGas:e=>(0,s.add0x)(e),estimatedBaseFee:e=>(0,s.add0x)(e),type:e=>(0,s.add0x)(e)};n.normalizeTransactionParams=function(e){const t={from:""};for(const n of(0,s.getKnownPropertyNames)(o))e[n]&&(t[n]=o[n](e[n]));return t.value||(t.value="0x0"),t.gasLimit&&!t.gas&&(t.gas=t.gasLimit),t},n.isEIP1559Transaction=function(e){const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);return t(e,"maxFeePerGas")&&t(e,"maxPriorityFeePerGas")};function c(e){try{return JSON.parse(JSON.stringify(e)),!0}catch{return!1}}function l(e){const t=e.toLowerCase().startsWith("0x")?e.slice(0,2):"",n=t?e.slice(2):e;return t+(n.length%2==0?n:`0${n}`)}function u(e){const t=e,n=t.startsWith("0x")||t.startsWith("0X")?t.slice(2):t;return 0===n.length?new a.default(0):new a.default(n,16)}n.validateGasValues=e=>{Object.keys(e).forEach(t=>{const n=e[t];if("string"!=typeof n||!(0,s.isStrictHexString)(n))throw new TypeError(`expected hex string for ${t} but received: ${n}`)})},n.validateIfTransactionUnapproved=function(e,t){if(e?.status!==i.TransactionStatus.unapproved)throw new Error(`TransactionsController: Can only call ${t} on an unapproved transaction.\n      Current tx status: ${e?.status}`)},n.normalizeTxError=function(e){return{name:e.name,message:e.message,stack:e.stack,code:e.code,rpc:c(e.value)?e.value:undefined}},n.normalizeGasFeeValues=function(e){const t=e=>"string"==typeof e?(0,s.add0x)(e):e;return"gasPrice"in e?{gasPrice:t(e.gasPrice)}:{maxFeePerGas:t(e.maxFeePerGas),maxPriorityFeePerGas:t(e.maxPriorityFeePerGas)}},n.padHexToEvenLength=l,n.bnFromHex=u,n.toBN=function(e){if(e instanceof a.default)return e;if("function"==typeof a.default.isBN&&a.default.isBN(e))return e;if(null!==e&&"object"==typeof e&&"function"==typeof e.toHexString)return u(e.toHexString());if(null!==e&&"object"==typeof e&&"string"==typeof e._hex)return u(e._hex);if("string"==typeof e)return u(e);if("bigint"==typeof e)return new a.default(e.toString());if("number"==typeof e)return new a.default(e);throw new Error("Unexpected value returned from oracle contract")},n.getPercentageChange=function(e,t){const n=new a.default(10).pow(new a.default(18)),r=e.mul(n),s=t.mul(n),i=s.sub(r);return i.isZero()?0:r.isZero()&&!s.isZero()?100:i.muln(100).div(r).abs().toNumber()},n.setEnvelopeType=function(e,t){e.accessList?e.type=i.TransactionEnvelopeType.accessList:e.authorizationList?e.type=i.TransactionEnvelopeType.setCode:e.type=t?i.TransactionEnvelopeType.feeMarket:i.TransactionEnvelopeType.legacy}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/utils.cjs"}],[1827,{"../types.cjs":1807,"./utils.cjs":1826,"@ethersproject/abi":705,"@metamask/controller-utils":1384,"@metamask/metamask-eth-abis":2244,"@metamask/rpc-errors":2594,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateBatchRequest=n.validateParamTo=n.validateTxParams=n.validateTransactionOrigin=n.ErrorCode=void 0;const r=e("@ethersproject/abi"),s=e("@metamask/controller-utils"),a=e("@metamask/metamask-eth-abis"),i=e("@metamask/rpc-errors"),o=e("@metamask/utils"),c=e("./utils.cjs"),l=e("../types.cjs");var u;!function(e){e[e.DuplicateBundleId=5720]="DuplicateBundleId",e[e.BundleTooLarge=5740]="BundleTooLarge",e[e.RejectedUpgrade=5750]="RejectedUpgrade"}(u||(n.ErrorCode=u={}));const d=[l.TransactionEnvelopeType.feeMarket,l.TransactionEnvelopeType.setCode];function h(e,t){const n=e.type;switch(t){case"authorizationList":if(n&&n!==l.TransactionEnvelopeType.setCode)throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but including authorizationList requires type: "${l.TransactionEnvelopeType.setCode}"`);break;case"maxFeePerGas":case"maxPriorityFeePerGas":if(n&&!d.includes(n))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but including maxFeePerGas and maxPriorityFeePerGas requires type: "${d.join(", ")}"`);break;default:if(n&&d.includes(n))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: specified type "${n}" but included a gasPrice instead of maxFeePerGas and maxPriorityFeePerGas`)}}function m(e,t,n){if(void 0!==e[n])throw i.rpcErrors.invalidParams(`Invalid transaction params: specified ${t} but also included ${n}, these cannot be mixed`)}function g(e,t){const n=e[t];if("string"!=typeof n||!(0,o.isStrictHexString)(n))throw i.rpcErrors.invalidParams(`Invalid transaction params: ${String(t)} is not a valid hexadecimal string. got: (${String(n)})`)}function p(e){g(e,"address"),function(e,t,n){const r=(0,o.remove0x)(e).length/2;if(r!==t)throw i.rpcErrors.invalidParams(`Invalid transaction params: ${n} must be ${t} bytes. got: ${r} bytes`)}(e.address,20,"address");for(const t of["chainId","nonce","r","s"])e[t]&&g(e,t);const{yParity:t}=e;if(t&&!["0x0","0x1"].includes(t))throw i.rpcErrors.invalidParams(`Invalid transaction params: yParity must be '0x0' or '0x1'. got: ${t}`)}n.validateTransactionOrigin=async function({data:e,from:t,internalAccounts:n,origin:r,permittedAddresses:a,txParams:o,type:c}){if(!r||r===s.ORIGIN_METAMASK)return;const{authorizationList:u,to:d,type:h}=o;if(a&&!a.includes(t))throw i.providerErrors.unauthorized({data:{origin:r}});if(c===l.TransactionType.batch)return;if(u||h===l.TransactionEnvelopeType.setCode)throw i.rpcErrors.invalidParams("External EIP-7702 transactions are not supported");if(Boolean(e&&"0x"!==e)&&n?.some(e=>e.toLowerCase()===d?.toLowerCase()))throw i.rpcErrors.invalidParams("External transactions to internal accounts cannot include data")},n.validateTxParams=function(e,t=!0,n){!function(e){if(e&&!Object.values(l.TransactionEnvelopeType).includes(e))throw i.rpcErrors.invalidParams(`Invalid transaction envelope type: "${e}". Must be one of: ${Object.values(l.TransactionEnvelopeType).join(", ")}`)}(e.type),function(e,t){if((0,c.isEIP1559Transaction)(e)&&!t)throw i.rpcErrors.invalidParams("Invalid transaction params: params specify an EIP-1559 transaction but the current network does not support EIP-1559")}(e,t),function(e){if(!e||"string"!=typeof e)throw i.rpcErrors.invalidParams(`Invalid "from" address ${e}: not a string.`);if(!(0,s.isValidHexAddress)(e))throw i.rpcErrors.invalidParams('Invalid "from" address.')}(e.from),function(e){if("0x"===e.to||e.to===undefined){if(!e.data)throw i.rpcErrors.invalidParams('Invalid "to" address.');delete e.to}else if(e.to!==undefined&&!(0,s.isValidHexAddress)(e.to))throw i.rpcErrors.invalidParams('Invalid "to" address.')}(e),function(e){if(e!==undefined){if(e.includes("-"))throw i.rpcErrors.invalidParams(`Invalid transaction value "${e}": not a positive number.`);if(e.includes("."))throw i.rpcErrors.invalidParams(`Invalid transaction value "${e}": number must be in wei.`);const t=parseInt(e,10);if(!(Number.isFinite(t)&&!Number.isNaN(t)&&!isNaN(Number(e))&&Number.isSafeInteger(t)))throw i.rpcErrors.invalidParams(`Invalid transaction value ${e}: number must be a valid number.`)}}(e.value),function(e){if(e){const t=new r.Interface(a.abiERC20);try{t.parseTransaction({data:e})}catch(e){if(e.message.match(/BUFFER_OVERRUN/u))throw i.rpcErrors.invalidParams("Invalid transaction params: data out-of-bounds, BUFFER_OVERRUN.")}}}(e.data),function(e,t){if(e&&t&&e.toLowerCase?.()!==t.toLowerCase())throw i.rpcErrors.invalidParams(`Invalid transaction params: chainId must match the network client, got: ${e}, expected: ${t}`)}(e.chainId,n),function(e){e.gasPrice&&(h(e,"gasPrice"),m(e,"gasPrice","maxFeePerGas"),m(e,"gasPrice","maxPriorityFeePerGas"),g(e,"gasPrice"));e.maxFeePerGas&&(h(e,"maxFeePerGas"),m(e,"maxFeePerGas","gasPrice"),g(e,"maxFeePerGas"));e.maxPriorityFeePerGas&&(h(e,"maxPriorityFeePerGas"),m(e,"maxPriorityFeePerGas","gasPrice"),g(e,"maxPriorityFeePerGas"));e.gasLimit&&g(e,"gasLimit");e.gas&&g(e,"gas")}(e),function(e){const{authorizationList:t}=e;if(!t)return;if(h(e,"authorizationList"),!Array.isArray(t))throw i.rpcErrors.invalidParams("Invalid transaction params: authorizationList must be an array");for(const e of t)p(e)}(e)},n.validateParamTo=function(e){if(!e||"string"!=typeof e)throw i.rpcErrors.invalidParams('Invalid "to" address')},n.validateBatchRequest=function({internalAccounts:e,request:t,sizeLimit:n}){const{origin:r}=t,a=r&&r!==s.ORIGIN_METAMASK,o=e.map(e=>e.toLowerCase());if(a&&t.transactions.some(e=>{const t=e.params.to?.toLowerCase(),n=e.params.data,r=o.includes(t),s=Boolean(n&&"0x"!==n);return r&&s}))throw i.rpcErrors.invalidParams("External calls to internal accounts cannot include data");if(a&&t.transactions.length>n)throw new i.JsonRpcError(u.BundleTooLarge,`Batch size cannot exceed ${n}. got: ${t.transactions.length}`)}}}},{package:"@metamask/eip-5792-middleware>@metamask/transaction-controller",file:"node_modules/@metamask/eip-5792-middleware/node_modules/@metamask/transaction-controller/dist/utils/validation.cjs"}],[1828,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DELEGATION_INDICATOR_PREFIX=n.METHOD_NAMES=void 0,n.METHOD_NAMES={UPGRADE_ACCOUNT:"wallet_upgradeAccount",GET_ACCOUNT_UPGRADE_STATUS:"wallet_getAccountUpgradeStatus"},n.DELEGATION_INDICATOR_PREFIX="0xef0100"}}},{package:"@metamask/eip-7702-internal-rpc-middleware",file:"node_modules/@metamask/eip-7702-internal-rpc-middleware/dist/constants.cjs"}],[1829,{"./constants.cjs":1828,"./utils.cjs":1831,"./wallet_getAccountUpgradeStatus.cjs":1832,"./wallet_upgradeAccount.cjs":1833},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.METHOD_NAMES=n.validateAndNormalizeAddress=n.validateParams=n.walletGetAccountUpgradeStatus=n.walletUpgradeAccount=void 0;var r=e("./wallet_upgradeAccount.cjs");Object.defineProperty(n,"walletUpgradeAccount",{enumerable:!0,get:function(){return r.walletUpgradeAccount}});var s=e("./wallet_getAccountUpgradeStatus.cjs");Object.defineProperty(n,"walletGetAccountUpgradeStatus",{enumerable:!0,get:function(){return s.walletGetAccountUpgradeStatus}});var a=e("./utils.cjs");Object.defineProperty(n,"validateParams",{enumerable:!0,get:function(){return a.validateParams}}),Object.defineProperty(n,"validateAndNormalizeAddress",{enumerable:!0,get:function(){return a.validateAndNormalizeAddress}});var i=e("./constants.cjs");Object.defineProperty(n,"METHOD_NAMES",{enumerable:!0,get:function(){return i.METHOD_NAMES}})}}},{package:"@metamask/eip-7702-internal-rpc-middleware",file:"node_modules/@metamask/eip-7702-internal-rpc-middleware/dist/index.cjs"}],[183,{"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RatesControllerInit=void 0;var r=e("@metamask/assets-controllers");n.RatesControllerInit=({controllerMessenger:e,persistedState:t})=>({memStateKey:"MultichainRatesController",persistedStateKey:"MultichainRatesController",controller:new r.RatesController({state:t.MultichainRatesController,messenger:e,includeUsdRate:!0})})}}},{package:"$root$",file:"app/scripts/controller-init/rates-controller-init.ts"}],[1830,{"@metamask/superstruct":2931,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.GetAccountUpgradeStatusParamsStruct=n.UpgradeAccountParamsStruct=void 0;const r=e("@metamask/superstruct"),s=e("@metamask/utils");n.UpgradeAccountParamsStruct=(0,r.object)({account:s.HexChecksumAddressStruct,chainId:(0,r.optional)(s.StrictHexStruct)}),n.GetAccountUpgradeStatusParamsStruct=(0,r.object)({account:s.HexChecksumAddressStruct,chainId:(0,r.optional)(s.StrictHexStruct)})}}},{package:"@metamask/eip-7702-internal-rpc-middleware",file:"node_modules/@metamask/eip-7702-internal-rpc-middleware/dist/types.cjs"}],[1831,{"@metamask/rpc-errors":2594,"@metamask/superstruct":2931,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateParams=n.validateAndNormalizeAddress=void 0;const r=e("@metamask/rpc-errors"),s=e("@metamask/superstruct"),a=e("@metamask/utils");n.validateAndNormalizeAddress=async function(e,t,n){if("string"!=typeof e||0===e.length||!(0,a.isHexAddress)(e))throw r.rpcErrors.invalidParams({message:"Invalid parameters: must provide an EVM address."});if(!(await n(t)).map(e=>e.toLowerCase()).includes(e.toLowerCase()))throw r.providerErrors.unauthorized();return e},n.validateParams=function(e,t){const[n]=(0,s.validate)(e,t);if(n)throw r.rpcErrors.invalidParams(function(e,t){return`${t}\n\n${e.failures().map(e=>`${e.path.join(" > ")}${e.path.length?" - ":""}${e.message}`).join("\n")}`}(n,"Invalid parameters"))}}}},{package:"@metamask/eip-7702-internal-rpc-middleware",file:"node_modules/@metamask/eip-7702-internal-rpc-middleware/dist/utils.cjs"}],[1832,{"./constants.cjs":1828,"./types.cjs":1830,"./utils.cjs":1831,"@metamask/rpc-errors":2594,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.walletGetAccountUpgradeStatus=void 0;const r=e("@metamask/rpc-errors"),s=e("@metamask/utils"),a=e("./constants.cjs"),i=e("./types.cjs"),o=e("./utils.cjs");n.walletGetAccountUpgradeStatus=async function(e,t,n){const{params:c,origin:l}=e;(0,o.validateParams)(c,i.GetAccountUpgradeStatusParamsStruct);const{account:u,chainId:d}=c,h=await(0,o.validateAndNormalizeAddress)(u,l,n.getPermittedAccountsForOrigin);let m;if(d!==undefined)m=d;else{const e=n.getCurrentChainIdForDomain(l);if(!e)throw r.rpcErrors.invalidParams({message:`Could not determine current chain ID for origin: ${l}`});m=e}const{isSupported:g}=await n.isEip7702Supported({address:h,chainId:m});if(g)try{const e=m,s=n.getSelectedNetworkClientIdForChain(e);if(!s)throw r.rpcErrors.invalidParams({message:`Network client ID not found for chain ID ${m}`});const{isUpgraded:i,upgradedAddress:o}=await(async(e,t,n)=>{const r=await n(e,t);if(!r||"0x"===r||r.length<=2)return{isUpgraded:!1,upgradedAddress:null};if(!r.startsWith(a.DELEGATION_INDICATOR_PREFIX))return{isUpgraded:!1,upgradedAddress:null};const s=a.DELEGATION_INDICATOR_PREFIX.length+40;return r.length!==s?{isUpgraded:!1,upgradedAddress:null}:{isUpgraded:!0,upgradedAddress:`0x${r.slice(8,48)}`}})(h,s,n.getCode);t.result={isSupported:g,account:h,isUpgraded:i,upgradedAddress:o,chainId:m}}catch(e){if(e instanceof r.JsonRpcError)throw e;throw r.rpcErrors.internal({message:`Failed to get account upgrade status: ${(0,s.getErrorMessage)(e)}`})}else t.result={isSupported:g,account:h,isUpgraded:!1,upgradedAddress:null,chainId:m}}}}},{package:"@metamask/eip-7702-internal-rpc-middleware",file:"node_modules/@metamask/eip-7702-internal-rpc-middleware/dist/wallet_getAccountUpgradeStatus.cjs"}],[1833,{"./types.cjs":1830,"./utils.cjs":1831,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.walletUpgradeAccount=void 0;const r=e("@metamask/rpc-errors"),s=e("./types.cjs"),a=e("./utils.cjs");n.walletUpgradeAccount=async function(e,t,n){const{params:i,origin:o}=e;(0,a.validateParams)(i,s.UpgradeAccountParamsStruct);const{account:c,chainId:l}=i,u=await(0,a.validateAndNormalizeAddress)(c,o,n.getPermittedAccountsForOrigin);let d;if(l!==undefined)d=l;else{const e=n.getCurrentChainIdForDomain(o);if(!e)throw r.rpcErrors.invalidParams({message:`No network configuration found for origin: ${o}`});d=e}try{const e=d,{isSupported:s,upgradeContractAddress:a}=await n.isEip7702Supported({address:u,chainId:e});if(!s)throw r.rpcErrors.invalidParams({message:`Account upgrade not supported on chain ID ${d}`});if(!a)throw r.rpcErrors.invalidParams({message:`No upgrade contract address available for chain ID ${d}`});const i=await n.upgradeAccount(u,a,d);t.result={transactionHash:i.transactionHash,upgradedAccount:u,delegatedTo:i.delegatedTo}}catch(e){if(e instanceof r.JsonRpcError)throw e;throw r.rpcErrors.internal({message:`Failed to upgrade account: ${e instanceof Error?e.message:String(e)}`})}}}}},{package:"@metamask/eip-7702-internal-rpc-middleware",file:"node_modules/@metamask/eip-7702-internal-rpc-middleware/dist/wallet_upgradeAccount.cjs"}],[1834,{"@ethersproject/providers":766,"@metamask/base-controller":1311,"@metamask/controller-utils":1384,"@metamask/utils":3070,"punycode/punycode.js":5113},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.EnsController=n.DEFAULT_ENS_NETWORK_MAP=void 0;const u=e("@ethersproject/providers"),d=e("@metamask/base-controller"),h=e("@metamask/controller-utils"),m=e("@metamask/utils"),g=e("punycode/punycode.js"),p=(0,m.createProjectLogger)("ens-controller");n.DEFAULT_ENS_NETWORK_MAP={1:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",3:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",4:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",5:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",17e3:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",11155111:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"};const f={ensEntries:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},ensResolutionsByAddress:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}},b={ensEntries:{},ensResolutionsByAddress:{}};class w extends d.BaseController{constructor({registriesByChainId:e=n.DEFAULT_ENS_NETWORK_MAP,messenger:t,state:o={},onNetworkDidChange:l}){super({name:"EnsController",metadata:f,messenger:t,state:{...b,ensEntries:Object.fromEntries(Object.entries(e).map(([e,t])=>[(0,h.toHex)(e),{".":{address:t,chainId:(0,h.toHex)(e),ensName:"."}}])),...o}}),r.add(this),s.set(this,null),c(this,r,"m",a).call(this,e),l&&l(({selectedNetworkClientId:t})=>{this.resetState(),c(this,r,"m",i).call(this,t,e)})}resetState(){this.update(e=>{e.ensResolutionsByAddress={}})}clear(){this.update(e=>{e.ensEntries={}})}delete(e,t){const n=(0,h.normalizeEnsName)(t);return!!((0,h.isSafeDynamicKey)(e)&&n&&this.state.ensEntries[e]&&this.state.ensEntries[e][n])&&(this.update(t=>{delete t.ensEntries[e][n],0===Object.keys(t.ensEntries[e]).length&&delete t.ensEntries[e]}),!0)}get(e,t){const n=(0,h.normalizeEnsName)(t);return n&&this.state.ensEntries[e]&&this.state.ensEntries[e][n]||null}set(e,t,n){if(!Number.isInteger(Number.parseInt(e,10))||!t||"string"!=typeof t||n&&!(0,h.isValidHexAddress)(n))throw new Error(`Invalid ENS entry: { chainId:${e}, ensName:${t}, address:${n}}`);const r=(0,h.normalizeEnsName)(t);if(!r)throw new Error(`Invalid ENS name: ${t}`);const s=n?(0,h.toChecksumHexAddress)(n):null,a=this.state.ensEntries[e];return(!a?.[r]||a[r].address!==s)&&(this.update(t=>{t.ensEntries={...this.state.ensEntries,[e]:{...this.state.ensEntries[e],[r]:{address:s,chainId:e,ensName:r}}}}),!0)}async reverseResolveAddress(e){if(!c(this,s,"f"))return undefined;const t=(0,h.toChecksumHexAddress)(e);if(this.state.ensResolutionsByAddress[t])return this.state.ensResolutionsByAddress[t];let n,r;try{n=await c(this,s,"f").lookupAddress(t)}catch(e){return p(e),undefined}if(!n)return undefined;try{r=await c(this,s,"f").resolveName(n)}catch(e){return p(e),undefined}return r?"0x0000000000000000000000000000000000000000"===r||"0x"===r||(0,h.toChecksumHexAddress)(r)!==t?undefined:(this.update(e=>{e.ensResolutionsByAddress[t]=(0,g.toASCII)(n)}),n):undefined}}n.EnsController=w,s=new WeakMap,r=new WeakSet,a=function(e){const{selectedNetworkClientId:t}=this.messenger.call("NetworkController:getState");c(this,r,"m",i).call(this,t,e)},i=function(e,t){const{configuration:{chainId:n},provider:a}=this.messenger.call("NetworkController:getNetworkClientById",e);t&&t[parseInt(n,16)]&&c(this,r,"m",o).call(this,n)?l(this,s,new u.Web3Provider(a,{chainId:(0,h.convertHexToDecimal)(n),name:h.CHAIN_ID_TO_ETHERS_NETWORK_NAME_MAP[n],ensAddress:t[parseInt(n,16)]}),"f"):l(this,s,null,"f")},o=function(e){return Boolean(this.state.ensEntries[e])},n.default=w}}},{package:"@metamask/ens-controller",file:"node_modules/@metamask/ens-controller/dist/EnsController.cjs"}],[1835,{"./EnsController.cjs":1834},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./EnsController.cjs"),n)}}},{package:"@metamask/ens-controller",file:"node_modules/@metamask/ens-controller/dist/index.cjs"}],[1836,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorReportingService=void 0;n.ErrorReportingService=class{constructor({messenger:e,captureException:t}){this.name="ErrorReportingService",this.state=null,r.set(this,void 0),s.set(this,void 0),a(this,s,e,"f"),a(this,r,t,"f"),i(this,s,"f").registerActionHandler("ErrorReportingService:captureException",i(this,r,"f").bind(this))}captureException(e){i(this,r,"f").call(this,e)}},r=new WeakMap,s=new WeakMap}}},{package:"@metamask/error-reporting-service",file:"node_modules/@metamask/error-reporting-service/dist/error-reporting-service.cjs"}],[1837,{"./error-reporting-service.cjs":1836},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorReportingService=void 0;var r=e("./error-reporting-service.cjs");Object.defineProperty(n,"ErrorReportingService",{enumerable:!0,get:function(){return r.ErrorReportingService}})}}},{package:"@metamask/error-reporting-service",file:"node_modules/@metamask/error-reporting-service/dist/index.cjs"}],[184,{"../../../development/build/constants":593,"../lib/util":358,"@metamask/remote-feature-flag-controller":2587,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RemoteFeatureFlagControllerInit=void 0,n.getConfigForRemoteFeatureFlagRequest=l;var r=e("@metamask/utils"),s=e("@metamask/remote-feature-flag-controller"),a=e("../../../development/build/constants"),i=e("../lib/util");const o={flask:s.DistributionType.Flask,main:s.DistributionType.Main,beta:s.DistributionType.Beta,experimental:s.DistributionType.Main},c={[a.ENVIRONMENT.DEVELOPMENT]:s.EnvironmentType.Development,[a.ENVIRONMENT.RELEASE_CANDIDATE]:s.EnvironmentType.ReleaseCandidate,[a.ENVIRONMENT.PRODUCTION]:s.EnvironmentType.Production};function l(){(0,r.assert)("main","METAMASK_BUILD_TYPE is not defined"),(0,r.assert)("production","METAMASK_ENVIRONMENT is not defined");const e="main",t=o[e]||s.DistributionType.Main;let n=c.production||s.EnvironmentType.Development;return{distribution:t,environment:n}}n.RemoteFeatureFlagControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n})=>{const r=t.call("OnboardingController:getState"),a=t.call("PreferencesController:getState"),{distribution:o,environment:c}=l();let u=!0===a.useExternalServices,d=!0===r.completedOnboarding;const h=()=>!d||!u,m=new s.RemoteFeatureFlagController({state:n.RemoteFeatureFlagController,messenger:e,fetchInterval:9e5,disabled:h(),getMetaMetricsId:()=>t.call("MetaMetricsController:getMetaMetricsId"),clientConfigApiService:new s.ClientConfigApiService({fetch:globalThis.fetch.bind(globalThis),config:{client:s.ClientType.Extension,distribution:o,environment:c}})});function g(){h()?m.disable():(m.enable(),m.updateRemoteFeatureFlags().catch(e=>{console.error("Failed to update remote feature flags:",e)}))}return t.subscribe("PreferencesController:stateChange",(0,i.previousValueComparator)((e,t)=>{const{useExternalServices:n}=e,{useExternalServices:r}=t;return r!==n&&(u=!0===r,g()),!0},a)),t.subscribe("OnboardingController:stateChange",(0,i.previousValueComparator)((e,t)=>{const{completedOnboarding:n}=e,{completedOnboarding:r}=t;return r!==n&&(d=!0===r,g()),!0},r)),{controller:m}}}}},{package:"$root$",file:"app/scripts/controller-init/remote-feature-flag-controller-init.ts"}],[1843,{"./base-filter":1844},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const r=e("./base-filter");t.exports=class extends r{constructor(){super(),this.allResults=[]}async update(){throw new Error("BaseFilterWithHistory - no update method specified")}addResults(e){this.allResults=this.allResults.concat(e),super.addResults(e)}addInitialResults(e){this.allResults=this.allResults.concat(e),super.addInitialResults(e)}getAllResults(){return this.allResults}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/base-filter-history.js"}],[1844,{"@metamask/safe-event-emitter":2596},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const r=e("@metamask/safe-event-emitter").default;t.exports=class extends r{constructor(){super(),this.updates=[]}async initialize(){}async update(){throw new Error("BaseFilter - no update method specified")}addResults(e){this.updates=this.updates.concat(e),e.forEach(e=>this.emit("update",e))}addInitialResults(e){}getChangesAndClear(){const e=this.updates;return this.updates=[],e}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/base-filter.js"}],[1845,{"./base-filter":1844,"./getBlocksForRange":1846,"./hexUtils":1847},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const r=e("./base-filter"),s=e("./getBlocksForRange"),{incrementHexInt:a}=e("./hexUtils");t.exports=class extends r{constructor({provider:e,params:t}){super(),this.type="block",this.provider=e}async update({oldBlock:e,newBlock:t}){const n=t,r=a(e),i=(await s({provider:this.provider,fromBlock:r,toBlock:n})).map(e=>e.hash);this.addResults(i)}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/block-filter.js"}],[1846,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e){return e===undefined||null===e?e:Number.parseInt(e,16)}function s(e){if(e===undefined||null===e)return e;return"0x"+e.toString(16)}t.exports=async function({provider:e,fromBlock:t,toBlock:n}){t||(t=n);const a=r(t),i=r(n),o=Array(i-a+1).fill().map((e,t)=>a+t).map(s);let c=await Promise.all(o.map(t=>async function(e,t,n){for(let r=0;r<3;r++)try{return e.request({id:1,jsonrpc:"2.0",method:t,params:n})}catch(e){console.error(`provider.request failed: ${e.stack||e.message||e}`)}return null}(e,"eth_getBlockByNumber",[t,!1])));return c=c.filter(e=>null!==e),c}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/getBlocksForRange.js"}],[1847,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e){return e.sort((e,t)=>"latest"===e||"earliest"===t?1:"latest"===t||"earliest"===e?-1:s(e)-s(t))}function s(e){return e===undefined||null===e?e:Number.parseInt(e,16)}function a(e){if(e===undefined||null===e)return e;let t=e.toString(16);return t.length%2&&(t="0"+t),"0x"+t}function i(){return Math.floor(16*Math.random()).toString(16)}t.exports={minBlockRef:function(...e){return r(e)[0]},maxBlockRef:function(...e){const t=r(e);return t[t.length-1]},sortBlockRefs:r,bnToHex:function(e){return"0x"+e.toString(16)},blockRefIsNumber:function(e){return e&&!["earliest","latest","pending"].includes(e)},hexToInt:s,incrementHexInt:function(e){if(e===undefined||null===e)return e;return a(s(e)+1)},intToHex:a,unsafeRandomBytes:function(e){let t="0x";for(let n=0;n<e;n++)t+=i(),t+=i();return t}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/hexUtils.js"}],[1848,{"./block-filter.js":1845,"./hexUtils":1847,"./log-filter.js":1849,"./tx-filter.js":1851,"@metamask/json-rpc-engine":2089,"async-mutex":3860},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const r=e("async-mutex").Mutex,{createAsyncMiddleware:s,createScaffoldMiddleware:a}=e("@metamask/json-rpc-engine"),i=e("./log-filter.js"),o=e("./block-filter.js"),c=e("./tx-filter.js"),{intToHex:l,hexToInt:u}=e("./hexUtils");function d(e){return h(async(...t)=>{const n=await e(...t);return l(n.id)})}function h(e){return s(async(t,n)=>{const r=await e.apply(null,t.params);n.result=r})}function m(e,t){const n=[];for(let t in e)n.push(e[t]);return n}t.exports=function({blockTracker:e,provider:t}){let n=0,s={};const g=new r,p=function({mutex:e}){return t=>async(n,r,s,a)=>{(await e.acquire())(),t(n,r,s,a)}}({mutex:g}),f=a({eth_newFilter:p(d(w)),eth_newBlockFilter:p(d(C)),eth_newPendingTransactionFilter:p(d(k)),eth_uninstallFilter:p(h(v)),eth_getFilterChanges:p(h(y)),eth_getFilterLogs:p(h(T))}),b=async({oldBlock:e,newBlock:t})=>{if(0===s.length)return;const n=await g.acquire();try{await Promise.all(m(s).map(async n=>{try{await n.update({oldBlock:e,newBlock:t})}catch(e){console.error(e)}}))}catch(e){console.error(e)}n()};return f.newLogFilter=w,f.newBlockFilter=C,f.newPendingTransactionFilter=k,f.uninstallFilter=v,f.getFilterChanges=y,f.getFilterLogs=T,f.destroy=()=>{!async function(){const e=m(s).length;s={},P({prevFilterCount:e,newFilterCount:0})}()},f;async function w(e){const n=new i({provider:t,params:e});await S(n);return n}async function C(){const e=new o({provider:t});await S(e);return e}async function k(){const e=new c({provider:t});await S(e);return e}async function y(e){const t=u(e),n=s[t];if(!n)throw new Error(`No filter for index "${t}"`);return n.getChangesAndClear()}async function T(e){const t=u(e),n=s[t];if(!n)throw new Error(`No filter for index "${t}"`);let r=[];return"log"===n.type&&(r=n.getAllResults()),r}async function v(e){const t=u(e),n=s[t],r=Boolean(n);return r&&await async function(e){const t=m(s).length;delete s[e];const n=m(s).length;P({prevFilterCount:t,newFilterCount:n})}(t),r}async function S(t){const r=m(s).length,a=await e.getLatestBlock();await t.initialize({currentBlock:a}),n++,s[n]=t,t.id=n,t.idHex=l(n);return P({prevFilterCount:r,newFilterCount:m(s).length}),n}function P({prevFilterCount:t,newFilterCount:n}){0===t&&n>0?e.on("sync",b):t>0&&0===n&&e.removeListener("sync",b)}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/index.js"}],[1849,{"./base-filter-history":1843,"./hexUtils":1847,"@metamask/eth-query":1972,pify:5040},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const r=e("@metamask/eth-query"),s=e("pify"),a=e("./base-filter-history"),{bnToHex:i,hexToInt:o,incrementHexInt:c,minBlockRef:l,blockRefIsNumber:u}=e("./hexUtils");t.exports=class extends a{constructor({provider:e,params:t}){super(),this.type="log",this.ethQuery=new r(e),this.params=Object.assign({fromBlock:"latest",toBlock:"latest",address:undefined,topics:[]},t),this.params.address&&(Array.isArray(this.params.address)||(this.params.address=[this.params.address]),this.params.address=this.params.address.map(e=>e.toLowerCase()))}async initialize({currentBlock:e}){let t=this.params.fromBlock;["latest","pending"].includes(t)&&(t=e),"earliest"===t&&(t="0x0"),this.params.fromBlock=t;const n=l(this.params.toBlock,e),r=Object.assign({},this.params,{toBlock:n}),s=await this._fetchLogs(r);this.addInitialResults(s)}async update({oldBlock:e,newBlock:t}){const n=t;let r;r=e?c(e):t;const s=Object.assign({},this.params,{fromBlock:r,toBlock:n}),a=(await this._fetchLogs(s)).filter(e=>this.matchLog(e));this.addResults(a)}async _fetchLogs(e){return await s(t=>this.ethQuery.getLogs(e,t))()}matchLog(e){if(o(this.params.fromBlock)>=o(e.blockNumber))return!1;if(u(this.params.toBlock)&&o(this.params.toBlock)<=o(e.blockNumber))return!1;const t=e.address&&e.address.toLowerCase();if(this.params.address&&t&&!this.params.address.includes(t))return!1;return this.params.topics.every((t,n)=>{let r=e.topics[n];if(!r)return!1;r=r.toLowerCase();let s=Array.isArray(t)?t:[t];if(s.includes(null))return!0;s=s.map(e=>e.toLowerCase());return s.includes(r)})}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/log-filter.js"}],[185,{"../../../shared/lib/feature-flags/version-gating":5846,"../../../shared/lib/manifestFlags":5855,"../controllers/rewards/rewards-controller":238},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RewardsControllerInit=void 0;var r=e("../controllers/rewards/rewards-controller"),s=e("../../../shared/lib/manifestFlags"),a=e("../../../shared/lib/feature-flags/version-gating");n.RewardsControllerInit=e=>{const{controllerMessenger:t,persistedState:n,initMessenger:i}=e,o=n.RewardsController??r.defaultRewardsControllerState;return{controller:new r.RewardsController({messenger:t,state:o,isDisabled:()=>{var e;const{remoteFeatureFlags:t}=i.call("RemoteFeatureFlagController:getState"),n=null==t?void 0:t.rewardsEnabled,r=null===(e=(0,s.getManifestFlags)().remoteFeatureFlags)||void 0===e?void 0:e.rewardsEnabled,o=e=>"boolean"==typeof e?e:Boolean((0,a.validatedVersionGatedFeatureFlag)(e)),c=r===undefined?o(n):o(r),{useExternalServices:l}=i.call("PreferencesController:getState");return!c||!l}})}}}}},{package:"$root$",file:"app/scripts/controller-init/rewards-controller-init.ts"}],[1850,{"./getBlocksForRange.js":1846,"./hexUtils.js":1847,"./index.js":1848,"@metamask/json-rpc-engine":2089,"@metamask/safe-event-emitter":2596},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const r=e("@metamask/safe-event-emitter").default,{createAsyncMiddleware:s,createScaffoldMiddleware:a}=e("@metamask/json-rpc-engine"),i=e("./index.js"),{unsafeRandomBytes:o,incrementHexInt:c}=e("./hexUtils.js"),l=e("./getBlocksForRange.js");function u(e){return null===e||e===undefined?null:{hash:e.hash,parentHash:e.parentHash,sha3Uncles:e.sha3Uncles,miner:e.miner,stateRoot:e.stateRoot,transactionsRoot:e.transactionsRoot,receiptsRoot:e.receiptsRoot,logsBloom:e.logsBloom,difficulty:e.difficulty,number:e.number,gasLimit:e.gasLimit,gasUsed:e.gasUsed,nonce:e.nonce,mixHash:e.mixHash,timestamp:e.timestamp,extraData:e.extraData}}t.exports=function({blockTracker:e,provider:t}){const n={},d=i({blockTracker:e,provider:t});let h=!1;const m=new r,g=a({eth_subscribe:s(async function(r,s){if(h)throw new Error("SubscriptionManager - attempting to use after destroying");const a=r.params[0],i=o(16);let m;switch(a){case"newHeads":m=g({subId:i});break;case"logs":const e=r.params[1];m=f({subId:i,filter:await d.newLogFilter(e)});break;default:throw new Error(`SubscriptionManager - unsupported subscription type "${a}"`)}return n[i]=m,void(s.result=i);function g({subId:n}){const r={type:a,destroy:async()=>{e.removeListener("sync",r.update)},update:async({oldBlock:e,newBlock:r})=>{const s=r,a=c(e);(await l({provider:t,fromBlock:a,toBlock:s})).map(u).filter(e=>null!==e).forEach(e=>{p(n,e)})}};return e.on("sync",r.update),r}function f({subId:e,filter:t}){t.on("update",t=>p(e,t));return{type:a,destroy:async()=>await d.uninstallFilter(t.idHex)}}}),eth_unsubscribe:s(async function(e,t){if(h)throw new Error("SubscriptionManager - attempting to use after destroying");const r=e.params[0],s=n[r];if(!s)return void(t.result=!1);delete n[r],await s.destroy(),t.result=!0})});return g.destroy=function(){m.removeAllListeners();for(const e in n)n[e].destroy(),delete n[e];h=!0},{events:m,middleware:g};function p(e,t){m.emit("notification",{jsonrpc:"2.0",method:"eth_subscription",params:{subscription:e,result:t}})}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/subscriptionManager.js"}],[1851,{"./base-filter":1844,"./getBlocksForRange":1846,"./hexUtils":1847},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const r=e("./base-filter"),s=e("./getBlocksForRange"),{incrementHexInt:a}=e("./hexUtils");t.exports=class extends r{constructor({provider:e}){super(),this.type="tx",this.provider=e}async update({oldBlock:e}){const t=e,n=a(e),r=await s({provider:this.provider,fromBlock:n,toBlock:t}),i=[];for(const e of r)i.push(...e.transactions);this.addResults(i)}}}}},{package:"@metamask/eth-json-rpc-filters",file:"node_modules/@metamask/eth-json-rpc-filters/tx-filter.js"}],[186,{"../controllers/rewards/rewards-data-service":239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RewardsDataServiceInit=void 0;var r=e("../controllers/rewards/rewards-data-service");n.RewardsDataServiceInit=({controllerMessenger:e})=>({controller:new r.RewardsDataService({messenger:e,fetch:fetch.bind(globalThis)}),persistedStateKey:null})}}},{package:"$root$",file:"app/scripts/controller-init/rewards-data-service-init.ts"}],[187,{"./oauth-service-init":188,"./seedless-onboarding-controller-init":189},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"OAuthServiceInit",{enumerable:!0,get:function(){return r.OAuthServiceInit}}),Object.defineProperty(n,"SeedlessOnboardingControllerInit",{enumerable:!0,get:function(){return s.SeedlessOnboardingControllerInit}});var r=e("./oauth-service-init"),s=e("./seedless-onboarding-controller-init")}}},{package:"$root$",file:"app/scripts/controller-init/seedless-onboarding/index.ts"}],[188,{"../../services/oauth/oauth-service":585,"../../services/oauth/web-authenticator-factory":588},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OAuthServiceInit=void 0;var r,s=(r=e("../../services/oauth/oauth-service"))&&r.__esModule?r:{default:r},a=e("../../services/oauth/web-authenticator-factory");n.OAuthServiceInit=e=>{const{controllerMessenger:t,getController:n}=e,r=n("MetaMetricsController");return{controller:new s.default({messenger:t,env:{googleClientId:"795351133007-6d0s31utj13knv440fgjo2ur93241gb6.apps.googleusercontent.com",appleClientId:"io.metamask.appleloginclient.prod"},webAuthenticator:(0,a.webAuthenticatorFactory)(),bufferedTrace:r.bufferedTrace.bind(r),bufferedEndTrace:r.bufferedEndTrace.bind(r),trackEvent:r.trackEvent.bind(r),addEventBeforeMetricsOptIn:r.addEventBeforeMetricsOptIn.bind(r),getParticipateInMetaMetrics:()=>r.state.participateInMetaMetrics}),memStateKey:null,persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/seedless-onboarding/oauth-service-init.ts"}],[1883,{"./ledger-hw-app.cjs":1885,"./ledger-iframe-bridge.cjs":1886,"./ledger-keyring.cjs":1887,"./ledger-mobile-bridge.cjs":1888,"./ledger-transport-middleware.cjs":1889},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./ledger-keyring.cjs"),n),s(e("./ledger-iframe-bridge.cjs"),n),s(e("./ledger-mobile-bridge.cjs"),n),s(e("./ledger-transport-middleware.cjs"),n),s(e("./ledger-hw-app.cjs"),n)}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/index.cjs"}],[1884,{"./type.cjs":1890,"@ledgerhq/hw-transport":954},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.handleLedgerTransportError=function(e,t){if(e instanceof r.TransportStatusError){const t=e;throw new s.LedgerStatusError(t.statusCode,function(e){switch(e.statusCode){case 27013:return"Ledger: User rejected the transaction";case 27264:return"Ledger: Blind signing must be enabled";case 21781:return"Ledger: Device is locked. Unlock it to continue";case 25871:return"Ledger: Ethereum app closed. Open it to unlock";default:return e.message}}(t))}throw e instanceof Error?e:new Error(t)};const r=e("@ledgerhq/hw-transport"),s=e("./type.cjs")}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-error-handler.cjs"}],[1885,{"@ledgerhq/hw-app-eth":939,buffer:4038},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.MetaMaskLedgerHwAppEth=void 0;const s=r(e("@ledgerhq/hw-app-eth")),a=e("buffer");class i extends s.default{constructor(){super(...arguments),this.mainAppName="BOLOS",this.ethAppName="Ethereum",this.transportEncoding="ascii"}async openEthApp(){await this.transport.send(224,216,0,0,a.Buffer.from(this.ethAppName,this.transportEncoding))}async closeApps(){await this.transport.send(176,167,0,0)}async getAppNameAndVersion(){const e=await this.transport.send(176,1,0,0);if(1!==e[0])throw new Error("Incorrect format return from getAppNameAndVersion.");let t=1;const n=e[t]??0;t+=1;const r=e.slice(t,t+=n).toString(this.transportEncoding),s=e[t]??0;t+=1;return{appName:r,version:e.slice(t,t+=s).toString(this.transportEncoding)}}}n.MetaMaskLedgerHwAppEth=i}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-hw-app.cjs"}],[1886,{"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},m=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerIframeBridge=n.IFrameMessageAction=void 0;const g=e("@metamask/utils");var p;!function(e){e.LedgerIsIframeReady="ledger-is-iframe-ready",e.LedgerConnectionChange="ledger-connection-change",e.LedgerUnlock="ledger-unlock",e.LedgerMakeApp="ledger-make-app",e.LedgerUpdateTransport="ledger-update-transport",e.LedgerSignTransaction="ledger-sign-transaction",e.LedgerSignPersonalMessage="ledger-sign-personal-message",e.LedgerSignTypedData="ledger-sign-typed-data"}(p||(n.IFrameMessageAction=p={}));n.LedgerIframeBridge=class{constructor(e={bridgeUrl:"https://metamask.github.io/eth-ledger-bridge-keyring"}){r.add(this),this.iframeLoaded=!1,s.set(this,void 0),this.isDeviceConnected=!1,this.currentMessageId=0,a.set(this,new Map),h(this,r,"m",d).call(this,e),m(this,s,{bridgeUrl:e?.bridgeUrl},"f")}async init(){await h(this,r,"m",o).call(this,h(this,s,"f").bridgeUrl),this.eventListener=h(this,r,"m",l).bind(this,h(this,s,"f").bridgeUrl),window.addEventListener("message",this.eventListener)}async destroy(){this.eventListener&&window.removeEventListener("message",this.eventListener)}async getOptions(){return h(this,s,"f")}async setOptions(e){h(this,r,"m",d).call(this,e),h(this,s,"f")?.bridgeUrl!==e.bridgeUrl&&(h(this,s,"f").bridgeUrl=e.bridgeUrl,await this.destroy(),await this.init())}async attemptMakeApp(){const e=await h(this,r,"m",u).call(this,{action:p.LedgerMakeApp},{timeout:8e3});if("success"in e&&e.success)return!0;throw"error"in e?e.error:new Error("Unknown error occurred")}async updateTransportMethod(e){if(!this.iframeLoaded)throw new Error("The iframe is not loaded yet");const t=await h(this,r,"m",u).call(this,{action:p.LedgerUpdateTransport,params:{transportType:e}},{timeout:8e3});if("success"in t&&t.success)return!0;throw new Error("Ledger transport could not be updated")}async getPublicKey(e){return h(this,r,"m",i).call(this,p.LedgerUnlock,e)}async deviceSignTransaction(e){return h(this,r,"m",i).call(this,p.LedgerSignTransaction,e)}async deviceSignMessage(e){return h(this,r,"m",i).call(this,p.LedgerSignPersonalMessage,e)}async deviceSignTypedData(e){return h(this,r,"m",i).call(this,p.LedgerSignTypedData,e)}},s=new WeakMap,a=new WeakMap,r=new WeakSet,i=async function(...[e,t]){const n=await h(this,r,"m",u).call(this,{action:e,params:t});if("payload"in n&&n.payload){if("success"in n&&n.success)return n.payload;if("error"in n.payload)throw n.payload.error}throw new Error("Unknown error occurred")},o=async function(e){return new Promise(t=>{this.iframe=document.createElement("iframe"),this.iframe.src=e,this.iframe.allow="hid 'src'",this.iframe.onload=async()=>{this.iframeLoaded=!0,t()},document.head.appendChild(this.iframe)})},c=function(e){const t=e.split("/");return t.splice(-1,1),t.join("/")},l=function(e,t){const{origin:n,data:s}=t;if(n===h(this,r,"m",c).call(this,e)&&s){const e=h(this,a,"f").get(s.messageId);e?(e.resolve(s),h(this,a,"f").delete(s.messageId)):s.action===p.LedgerConnectionChange&&(this.isDeviceConnected=s.payload.connected)}},u=async function(e,{timeout:t}={}){this.currentMessageId+=1;const n={...e,messageId:this.currentMessageId,target:"LEDGER-IFRAME"},r=(0,g.createDeferredPromise)();if(h(this,a,"f").set(this.currentMessageId,r),!this.iframeLoaded||!this.iframe?.contentWindow)throw new Error("The iframe is not loaded yet");return t&&setTimeout(()=>{h(this,a,"f").has(n.messageId)&&(h(this,a,"f").delete(n.messageId),r.reject(new Error("Ledger iframe message timeout")))},t),this.iframe.contentWindow.postMessage(n,"*"),r.promise},d=function(e){if("string"!=typeof e.bridgeUrl||0===e.bridgeUrl.length)throw new Error("bridgeURL is not a valid URL")}}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-iframe-bridge.cjs"}],[1887,{"./ledger-error-handler.cjs":1884,"@ethereumjs/rlp":652,"@ethereumjs/tx":665,"@ethereumjs/util":679,"@metamask/eth-sig-util":1974,"@metamask/utils":3070,buffer:4038,hdkey:4552},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c,l,u,d,h,m,g,p,f,b=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},w=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerKeyring=void 0;const C=e("@ethereumjs/rlp"),k=e("@ethereumjs/tx"),y=e("@ethereumjs/util"),T=e("@metamask/eth-sig-util"),v=e("@metamask/utils"),S=e("buffer"),P=w(e("hdkey")),I=e("./ledger-error-handler.cjs"),M="m",E=`${M}/44'/60'/0'`,A="Ledger Hardware";var _;!function(e){e.Ropsten="https://api-ropsten.etherscan.io",e.Kovan="https://api-kovan.etherscan.io",e.Rinkeby="https://api-rinkeby.etherscan.io",e.Mainnet="https://api.etherscan.io"}(_||(_={}));class j{constructor({bridge:e}){if(r.add(this),this.deviceId="",this.type=A,this.page=0,this.perPage=5,this.unlockedAccount=0,this.accounts=[],this.accountDetails={},this.hdk=new P.default,this.hdPath=E,this.paths={},this.network=_.Mainnet,this.implementFullBIP44=!1,!e)throw new Error("Bridge is a required dependency for the keyring");this.bridge=e}async init(){return this.bridge.init()}async destroy(){return this.bridge.destroy()}async serialize(){return{hdPath:this.hdPath,accounts:this.accounts.slice(),deviceId:this.deviceId,accountDetails:this.accountDetails,implementFullBIP44:!1}}async deserialize(e){this.hdPath=e.hdPath??E,this.accounts=e.accounts??[],this.deviceId=e.deviceId??"",this.accountDetails=e.accountDetails??{},e.accountDetails||b(this,r,"m",s).call(this,e),this.implementFullBIP44=e.implementFullBIP44??!1;const t=new Set(Object.keys(this.accountDetails));return this.accounts=this.accounts.filter(e=>t.has(b(this,r,"m",f).call(this,e))),Promise.resolve()}setDeviceId(e){this.deviceId=e}getDeviceId(){return this.deviceId}isUnlocked(){return Boolean(this.hdk.publicKey)}isConnected(){return this.bridge.isDeviceConnected}setAccountToUnlock(e){this.unlockedAccount=e}setHdPath(e){this.hdPath!==e&&(this.hdk=new P.default),this.hdPath=e}async unlock(e,t=!0){if(this.isUnlocked()&&!e)return b(this,r,"m",f).call(this,(0,v.bytesToHex)((0,y.publicToAddress)(this.hdk.publicKey,!0)));const n=e?b(this,r,"m",m).call(this,e):this.hdPath;let s;try{s=await this.bridge.getPublicKey({hdPath:n})}catch(e){(0,I.handleLedgerTransportError)(e,"Ledger: Unknown error while unlocking account")}return t&&s.chainCode&&(this.hdk.publicKey=S.Buffer.from(s.publicKey,"hex"),this.hdk.chainCode=S.Buffer.from(s.chainCode,"hex")),(0,v.add0x)(s.address)}async addAccounts(e){return new Promise((t,n)=>{this.unlock().then(async n=>{const s=this.unlockedAccount,a=s+e,i=[];for(let e=s;e<a;e++){const t=b(this,r,"m",d).call(this,e);let n;n=b(this,r,"m",h).call(this)?await this.unlock(t):b(this,r,"m",l).call(this,M,e),this.accountDetails[b(this,r,"m",f).call(this,n)]={bip44:b(this,r,"m",h).call(this),hdPath:t},this.accounts.includes(n)||(this.accounts=[...this.accounts,n],i.push(n)),this.page=0}t(i)}).catch(n)})}getName(){return A}async getFirstPage(){return this.page=0,b(this,r,"m",i).call(this,1)}async getNextPage(){return b(this,r,"m",i).call(this,1)}async getPreviousPage(){return b(this,r,"m",i).call(this,-1)}async getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){const t=this.accounts.filter(t=>t.toLowerCase()!==e.toLowerCase());if(t.length===this.accounts.length)throw new Error(`Address ${e} not found in this keyring`);this.accounts=t,delete this.accountDetails[b(this,r,"m",f).call(this,e)]}async attemptMakeApp(){return this.bridge.attemptMakeApp()}async updateTransportMethod(e){return this.bridge.updateTransportMethod(e)}async signTransaction(e,t){let n;if(function(e){return"getChainId"in e&&"function"==typeof e.getChainId}(t))return t.v=t.getChainId(),t.r="0x00",t.s="0x00",n=t.serialize().toString("hex"),b(this,r,"m",a).call(this,e,n,e=>(t.v=S.Buffer.from(e.v,"hex"),t.r=S.Buffer.from(e.r,"hex"),t.s=S.Buffer.from(e.s,"hex"),t));const s=t.getMessageToSign();return n=Array.isArray(s)?S.Buffer.from(C.RLP.encode(s)).toString("hex"):(0,v.bytesToHex)(s),b(this,r,"m",a).call(this,e,n,e=>{const n=t.toJSON();return n.type=t.type,n.v=(0,v.add0x)(e.v),n.r=(0,v.add0x)(e.r),n.s=(0,v.add0x)(e.s),k.TransactionFactory.fromTxData(n,{common:t.common,freeze:Object.isFrozen(t)})})}async signMessage(e,t){return this.signPersonalMessage(e,t)}async signPersonalMessage(e,t){const n=await this.unlockAccountByAddress(e);if(!n)throw new Error("Ledger: Unknown error while signing message");let s;try{s=await this.bridge.deviceSignMessage({hdPath:n,message:(0,v.remove0x)(t)})}catch(e){(0,I.handleLedgerTransportError)(e,"Ledger: Unknown error while signing message")}let a=parseInt(String(s.v),10).toString(16);a.length<2&&(a=`0${a}`);const i=`0x${s.r}${s.s}${a}`,o=(0,T.recoverPersonalSignature)({data:t,signature:i});if(b(this,r,"m",f).call(this,o)!==b(this,r,"m",f).call(this,e))throw new Error("Ledger: The signature doesnt match the right address");return i}async unlockAccountByAddress(e){const t=b(this,r,"m",f).call(this,e),n=this.accountDetails[t];if(!n)throw new Error(`Ledger: Account for address '${t}' not found`);const{hdPath:s}=n;if((await this.unlock(s,!1)).toLowerCase()!==e.toLowerCase())throw new Error(`Ledger: Account ${e} does not belong to the connected device`);return s}async signTypedData(e,t,n){const{version:s}=n??{};if(!("V4"===s))throw new Error("Ledger: Only version 4 of typed data signing is supported");const{domain:a,types:i,primaryType:o,message:c}=T.TypedDataUtils.sanitizeData(t),l=await this.unlockAccountByAddress(e);if(!l)throw new Error("Ledger: Unknown error while signing message");let u;try{u=await this.bridge.deviceSignTypedData({hdPath:l,message:{domain:{name:a.name,chainId:a.chainId,version:a.version,verifyingContract:a.verifyingContract,salt:a.salt instanceof ArrayBuffer?S.Buffer.from(a.salt).toString("hex"):a.salt},types:i,primaryType:o.toString(),message:c}})}catch(e){(0,I.handleLedgerTransportError)(e,"Ledger: Unknown error while signing message")}let d=parseInt(String(u.v),10).toString(16);d.length<2&&(d=`0${d}`);const h=`0x${u.r}${u.s}${d}`,m=(0,T.recoverTypedSignature)({data:t,signature:h,version:T.SignTypedDataVersion.V4});if(b(this,r,"m",f).call(this,m)!==b(this,r,"m",f).call(this,e))throw new Error("Ledger: The signature doesnt match the right address");return h}forgetDevice(){this.deviceId="",this.accounts=[],this.page=0,this.unlockedAccount=0,this.paths={},this.accountDetails={},this.hdk=new P.default}}n.LedgerKeyring=j,r=new WeakSet,s=function(e){if(b(this,r,"m",h).call(this)&&e.accountIndexes)for(const[t,n]of Object.entries(e.accountIndexes))this.accountDetails[t]={bip44:!0,hdPath:b(this,r,"m",d).call(this,n)};const t=new Set(Object.keys(this.accountDetails));b(this,r,"m",h).call(this)||this.accounts.forEach(e=>{const n=b(this,r,"m",f).call(this,e);t.has(n)||(this.accountDetails[n]={bip44:!1,hdPath:b(this,r,"m",u).call(this,e)})})},a=async function(e,t,n){const r=await this.unlockAccountByAddress(e);if(!r)throw new Error("Ledger: hdPath is empty while signing transaction");let s;try{s=await this.bridge.deviceSignTransaction({tx:(0,v.remove0x)(t),hdPath:r})}catch(e){(0,I.handleLedgerTransportError)(e,"Ledger: Unknown error while signing transaction")}const a=n(s);if(a.verifySignature())return a;throw new Error("Ledger: The transaction signature is not valid")},i=async function(e){this.page+=e,this.page<=0&&(this.page=1);const t=(this.page-1)*this.perPage,n=t+this.perPage;let s;return await this.unlock(),s=b(this,r,"m",h).call(this)?await b(this,r,"m",o).call(this,t,n):b(this,r,"m",c).call(this,t,n),s},o=async function(e,t){const n=[];for(let s=e;s<t;s++){const e=b(this,r,"m",d).call(this,s),t=await this.unlock(e),a=!this.implementFullBIP44||await b(this,r,"m",g).call(this,t);if(n.push({address:t,balance:null,index:s}),!a)break}return n},c=function(e,t){const n=[];for(let s=e;s<t;s++){const e=b(this,r,"m",l).call(this,M,s);n.push({address:e,balance:null,index:s}),this.paths[b(this,r,"m",f).call(this,e)]=s}return n},l=function(e,t){const n=this.hdk.derive(`${e}/${t}`),s=(0,v.bytesToHex)((0,y.publicToAddress)(n.publicKey,!0));return b(this,r,"m",f).call(this,s)},u=function(e){const t=b(this,r,"m",f).call(this,e);let n=this.paths[t];if(void 0===n)for(let e=0;e<1e3;e++)if(t===b(this,r,"m",l).call(this,M,e)){n=e;break}if(void 0===n)throw new Error("Unknown address");return b(this,r,"m",d).call(this,n)},d=function(e){return b(this,r,"m",h).call(this)?`m/44'/60'/${e}'/0/0`:`${this.hdPath}/${e}`},h=function(){return"m/44'/60'/0'/0/0"===this.hdPath},m=function(e){return e.toString().replace("m/","")},g=async function(e){const t=b(this,r,"m",p).call(this),n=await window.fetch(`${t}/api?module=account&action=txlist&address=${e}&tag=latest&page=1&offset=1`),s=await n.json();return"0"!==s.status&&s.result.length>0},p=function(){return this.network},f=function(e){return(0,v.getChecksumAddress)((0,v.add0x)(e))},j.type=A}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-keyring.cjs"}],[1888,{"./ledger-hw-app.cjs":1885},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerMobileBridge=void 0;e("./ledger-hw-app.cjs");n.LedgerMobileBridge=class{constructor(e,t={}){r.add(this),s.set(this,void 0),a.set(this,void 0),this.isDeviceConnected=!1,c(this,a,t,"f"),c(this,s,e,"f")}async init(){return Promise.resolve()}async destroy(){try{await l(this,r,"m",i).call(this).dispose()}catch(e){console.error(e)}this.isDeviceConnected=!1}async deviceSignMessage({hdPath:e,message:t}){return l(this,r,"m",o).call(this).signPersonalMessage(e,t)}async deviceSignTypedData({hdPath:e,message:t}){return l(this,r,"m",o).call(this).signEIP712Message(e,t)}async deviceSignTransaction({tx:e,hdPath:t}){return l(this,r,"m",o).call(this).clearSignTransaction(t,e,{externalPlugins:!0,erc20:!0,nft:!0})}async getPublicKey({hdPath:e}){return await l(this,r,"m",o).call(this).getAddress(e,!1,!0)}async getOptions(){return l(this,a,"f")}async setOptions(e){c(this,a,e,"f")}async updateTransportMethod(e){if(!e.deviceModel)throw new Error("Property `deviceModel` is not defined in `transport`.");if(!e.deviceModel.id)throw new Error("Property `deviceModel.id` is not defined in `transport`.");return l(this,r,"m",i).call(this).setTransport(e),this.isDeviceConnected=!0,Promise.resolve(!0)}async attemptMakeApp(){throw new Error("Method not supported.")}async openEthApp(){await l(this,r,"m",o).call(this).openEthApp()}async closeApps(){await l(this,r,"m",o).call(this).closeApps()}async getAppNameAndVersion(){return l(this,r,"m",o).call(this).getAppNameAndVersion()}},s=new WeakMap,a=new WeakMap,r=new WeakSet,i=function(){if(l(this,s,"f"))return l(this,s,"f");throw new Error("Instance `transportMiddleware` is not initialized.")},o=function(){return l(this,r,"m",i).call(this).getEthApp()}}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-mobile-bridge.cjs"}],[1889,{"./ledger-hw-app.cjs":1885},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerTransportMiddleware=void 0;const i=e("./ledger-hw-app.cjs");n.LedgerTransportMiddleware=class{constructor(){this.mainAppName="BOLOS",this.ethAppName="Ethereum",this.transportEncoding="ascii",r.set(this,void 0)}async dispose(){const e=this.getTransport();await e.close()}setTransport(e){s(this,r,e,"f")}getTransport(){if(!a(this,r,"f"))throw new Error("Instance `transport` is not initialized.");return a(this,r,"f")}getEthApp(){return new i.MetaMaskLedgerHwAppEth(this.getTransport())}},r=new WeakMap}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/ledger-transport-middleware.cjs"}],[189,{"../../lib/encryptor-factory":275,"../../services/oauth/config":582,"@metamask/seedless-onboarding-controller":2614},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SeedlessOnboardingControllerInit=void 0;var r=e("@metamask/seedless-onboarding-controller"),s=e("../../lib/encryptor-factory"),a=e("../../services/oauth/config");n.SeedlessOnboardingControllerInit=e=>{const{initMessenger:t,controllerMessenger:n,persistedState:i}=e,o=(0,s.encryptorFactory)(6e5),c=(0,a.isDevOrTestBuild)()?r.Web3AuthNetwork.Devnet:r.Web3AuthNetwork.Mainnet;return{controller:new r.SeedlessOnboardingController({messenger:n,state:i.SeedlessOnboardingController,network:c,passwordOutdatedCacheTTL:15e3,refreshJWTToken:(...e)=>t.call("OAuthService:getNewRefreshToken",...e),revokeRefreshToken:(...e)=>t.call("OAuthService:revokeRefreshToken",...e),renewRefreshToken:(...e)=>t.call("OAuthService:renewRefreshToken",...e),encryptor:o})}}}}},{package:"$root$",file:"app/scripts/controller-init/seedless-onboarding/seedless-onboarding-controller-init.ts"}],[1890,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerStatusError=void 0;class r extends Error{constructor(e,t){super(t),this.statusCode=e}}n.LedgerStatusError=r}}},{package:"@metamask/eth-ledger-bridge-keyring",file:"node_modules/@metamask/eth-ledger-bridge-keyring/dist/type.cjs"}],[19,{"../controllers/alert-controller":217},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AlertControllerInit=void 0;var r=e("../controllers/alert-controller");n.AlertControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.AlertController({state:t.AlertController,messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/alert-controller-init.ts"}],[190,{"../lib/WeakRefObjectMap":255,"@metamask/selected-network-controller":2619},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SelectedNetworkControllerInit=void 0;var r=e("@metamask/selected-network-controller"),s=e("../lib/WeakRefObjectMap");n.SelectedNetworkControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.SelectedNetworkController({state:t.SelectedNetworkController,messenger:e,domainProxyMap:new s.WeakRefObjectMap})})}}},{package:"$root$",file:"app/scripts/controller-init/selected-network-controller-init.ts"}],[191,{"../../../../shared/modules/shield":5913,"../../lib/ppom/ppom-util":299,"@metamask/keyring-controller":2183,"@metamask/shield-controller":2623},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ShieldControllerInit=void 0;var r=e("@metamask/shield-controller"),s=e("@metamask/keyring-controller"),a=e("../../lib/ppom/ppom-util"),i=e("../../../../shared/modules/shield");const o=e=>{const t=(0,r.parseSignatureRequestMethod)(e),n=e.version===s.SignTypedDataVersion.V3||e.version===s.SignTypedDataVersion.V4,i=n?[e.messageParams.from,e.messageParams.data]:[e.messageParams.data,e.messageParams.from],o={id:e.id,jsonrpc:"2.0",method:t,params:i},c=(0,a.normalizeSignatureRequest)(o);if(null!=c&&c.params&&n){const t=c.params;e.messageParams.data=t[1]}return e},c=(0,i.loadShieldConfig)();n.ShieldControllerInit=e=>{const{controllerMessenger:t,initMessenger:n,persistedState:s}=e,a=c.ruleEngineUrl;return{controller:new r.ShieldController({messenger:t,state:s.ShieldController,normalizeSignatureRequest:o,backend:new r.ShieldRemoteBackend({getAccessToken:()=>n.call("AuthenticationController:getBearerToken"),fetch:(e,t)=>fetch(e,t),baseUrl:a})})}}}}},{package:"$root$",file:"app/scripts/controller-init/shield/shield-controller-init.ts"}],[192,{"../../../../shared/constants/smartTransactions":5783,"../../../../shared/modules/selectors":5906,"@metamask/smart-transactions-controller":2645},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SmartTransactionsControllerInit=void 0;var r=e("@metamask/smart-transactions-controller"),s=e("../../../../shared/constants/smartTransactions"),a=e("../../../../shared/modules/selectors");n.SmartTransactionsControllerInit=e=>{const{controllerMessenger:t,initMessenger:n,persistedState:i,getUIState:o,getAccountType:c,getDeviceModel:l,getHardwareTypeForMetric:u,trace:d}=e;return{controller:new r.SmartTransactionsController({supportedChainIds:(0,s.getAllowedSmartTransactionsChainIds)(),clientId:r.ClientId.Extension,trackMetaMetricsEvent:n.call.bind(n,"MetaMetricsController:trackEvent"),state:i.SmartTransactionsController,messenger:t,getFeatureFlags:()=>{const e={metamask:o()};return(0,a.getFeatureFlagsByChainId)(e)},getMetaMetricsProps:async()=>{var e;const t=o(),{internalAccounts:n}=t,r=null==n?void 0:n.selectedAccount,s=r?null==n||null===(e=n.accounts)||void 0===e?void 0:e[r]:null,a=(null==s?void 0:s.address)??"";if(!a)return{accountHardwareType:undefined,accountType:undefined,deviceModel:undefined};return{accountHardwareType:await u(a),accountType:await c(a),deviceModel:await l(a)}},trace:d})}}}}},{package:"$root$",file:"app/scripts/controller-init/smart-transactions/smart-transactions-controller-init.ts"}],[193,{"@metamask/snaps-controllers":2658},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CronjobControllerInit=void 0;var r=e("@metamask/snaps-controllers");n.CronjobControllerInit=({controllerMessenger:e,persistedState:t,getCronjobControllerStorageManager:n})=>({controller:new r.CronjobController({state:t.CronjobController,messenger:e,stateManager:n()}),persistedStateKey:null})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/cronjob-controller-init.ts"}],[194,{"../../../../shared/modules/mv3.utils":5899,"@metamask/permission-controller":2401,"@metamask/snaps-controllers":2658,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ExecutionServiceInit=void 0;var r=e("@metamask/snaps-controllers"),s=e("@metamask/utils"),a=e("@metamask/permission-controller"),i=e("../../../../shared/modules/mv3.utils");n.ExecutionServiceInit=({controllerMessenger:e,offscreenPromise:t,setupUntrustedCommunicationEip1193:n})=>{function o(e,t){n({connectionStream:t,sender:{snapId:e},subjectType:a.SubjectType.Snap})}if(i.isManifestV3&&"undefined"!=typeof chrome&&void 0!==chrome.offscreen)return{memStateKey:null,persistedStateKey:null,controller:new r.OffscreenExecutionService({messenger:e,setupSnapProvider:o,offscreenPromise:t})};const c="https://execution.metamask.io/iframe/10.2.3/index.html";return(0,s.assert)(c,"Missing iframe URL."),{memStateKey:null,persistedStateKey:null,controller:new r.IframeExecutionService({messenger:e,iframeUrl:new URL(c),setupSnapProvider:o})}}}}},{package:"$root$",file:"app/scripts/controller-init/snaps/execution-service-init.ts"}],[195,{"./cronjob-controller-init":193,"./execution-service-init":194,"./multichain-router-init":196,"./rate-limit-controller-init":197,"./snap-controller-init":198,"./snap-insights-controller-init":199,"./snap-interface-controller-init":200,"./snaps-name-provider-init":201,"./snaps-registry-init":202,"./websocket-service-init":203},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"CronjobControllerInit",{enumerable:!0,get:function(){return r.CronjobControllerInit}}),Object.defineProperty(n,"ExecutionServiceInit",{enumerable:!0,get:function(){return s.ExecutionServiceInit}}),Object.defineProperty(n,"MultichainRouterInit",{enumerable:!0,get:function(){return a.MultichainRouterInit}}),Object.defineProperty(n,"RateLimitControllerInit",{enumerable:!0,get:function(){return i.RateLimitControllerInit}}),Object.defineProperty(n,"SnapControllerInit",{enumerable:!0,get:function(){return o.SnapControllerInit}}),Object.defineProperty(n,"SnapInsightsControllerInit",{enumerable:!0,get:function(){return c.SnapInsightsControllerInit}}),Object.defineProperty(n,"SnapInterfaceControllerInit",{enumerable:!0,get:function(){return l.SnapInterfaceControllerInit}}),Object.defineProperty(n,"SnapsNameProviderInit",{enumerable:!0,get:function(){return u.SnapsNameProviderInit}}),Object.defineProperty(n,"SnapsRegistryInit",{enumerable:!0,get:function(){return d.SnapsRegistryInit}}),Object.defineProperty(n,"WebSocketServiceInit",{enumerable:!0,get:function(){return h.WebSocketServiceInit}});var r=e("./cronjob-controller-init"),s=e("./execution-service-init"),a=e("./multichain-router-init"),i=e("./rate-limit-controller-init"),o=e("./snap-controller-init"),c=e("./snap-insights-controller-init"),l=e("./snap-interface-controller-init"),u=e("./snaps-name-provider-init"),d=e("./snaps-registry-init"),h=e("./websocket-service-init")}}},{package:"$root$",file:"app/scripts/controller-init/snaps/index.ts"}],[196,{"../../../../shared/constants/keyring":5764,"@metamask/snaps-controllers":2658},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainRouterInit=void 0;var r=e("@metamask/snaps-controllers"),s=e("../../../../shared/constants/keyring");n.MultichainRouterInit=({controllerMessenger:e,getController:t})=>{const n=t("KeyringController");return{memStateKey:null,persistedStateKey:null,controller:new r.MultichainRouter({messenger:e,withSnapKeyring:async e=>e({keyring:await(async()=>{let[e]=n.getKeyringsByType(s.KeyringType.snap);return e||(await n.addNewKeyring(s.KeyringType.snap),[e]=n.getKeyringsByType(s.KeyringType.snap)),e})()})})}}}}},{package:"$root$",file:"app/scripts/controller-init/snaps/multichain-router-init.ts"}],[197,{"@metamask/notification-services-controller/notification-services":2320,"@metamask/rate-limit-controller":2584,loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RateLimitControllerInit=void 0;var r,s=e("@metamask/rate-limit-controller"),a=(r=e("loglevel"))&&r.__esModule?r:{default:r},i=e("@metamask/notification-services-controller/notification-services");n.RateLimitControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n,showNotification:r})=>({controller:new s.RateLimitController({state:n.RateLimitController,messenger:e,implementations:{showNativeNotification:{method:(e,n)=>{const s=t.call("SubjectMetadataController:getState").subjectMetadata[e];return r((null==s?void 0:s.name)??e,n).catch(e=>{a.default.error("Failed to create notification",e)}),null},rateLimitCount:2,rateLimitTimeout:3e5},showInAppNotification:{method:(e,n)=>{const{message:r,title:s,footerLink:a,interfaceId:o}=n,c={title:s,...a?{footerLink:a}:{},interfaceId:o},l={data:{message:r,origin:e,...o?{detailedView:c}:{}},type:i.TRIGGER_TYPES.SNAP,readDate:null};return t.call("NotificationServicesController:updateMetamaskNotificationsList",l),null},rateLimitCount:5,rateLimitTimeout:6e4}}}),memStateKey:null,persistedStateKey:null})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/rate-limit-controller-init.ts"}],[198,{"../../../../shared/constants/keyring":5764,"../../../../shared/constants/snaps/permissions":5784,"../../lib/encryptor-factory":275,"../../lib/util":358,"@metamask/snaps-controllers":2658,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SnapControllerInit=void 0;var r=e("@metamask/snaps-controllers"),s=e("@metamask/utils"),a=e("../../../../shared/constants/snaps/permissions"),i=e("../../lib/encryptor-factory"),o=e("../../../../shared/constants/keyring"),c=e("../../lib/util");n.SnapControllerInit=({initMessenger:e,controllerMessenger:t,persistedState:n,removeAllConnections:l,preinstalledSnaps:u})=>{const d=(0,c.getBooleanFlag)(!1),h=(0,c.getBooleanFlag)(!0),m=(0,c.getBooleanFlag)(!0),g=(0,c.getBooleanFlag)("true");const p=new r.SnapController({environmentEndowmentPermissions:Object.values(a.EndowmentPermissions),excludedPermissions:{...a.ExcludedSnapPermissions,...a.ExcludedSnapEndowments},closeAllConnections:l,state:n.SnapController,messenger:t,featureFlags:{allowLocalSnaps:d,requireAllowlist:h,rejectInvalidPlatformVersion:m,autoUpdatePreinstalledSnaps:g},encryptor:(0,i.encryptorFactory)(6e5),getMnemonicSeed:async function(){const t=e.call("KeyringController:getKeyringsByType",o.KeyringType.hdKeyTree);if(!(t[0]&&(0,s.hasProperty)(t[0],"seed")&&t[0].seed instanceof Uint8Array))throw new Error("Primary keyring mnemonic unavailable.");return t[0].seed},preinstalledSnaps:u,getFeatureFlags:function(){return{disableSnaps:!1===e.call("PreferencesController:getState").useExternalServices}},ensureOnboardingComplete:async function(){const{completedOnboarding:t}=e.call("OnboardingController:getState");if(t)return;const{promise:n,resolve:r}=(0,s.createDeferredPromise)(),a=t=>{t.completedOnboarding&&(r(),e.unsubscribe("OnboardingController:stateChange",a))};e.subscribe("OnboardingController:stateChange",a),await n},trackEvent:e.call.bind(e,"MetaMetricsController:trackEvent")});return e.subscribe("KeyringController:lock",()=>{e.call("SnapController:setClientActive",!1)}),e.subscribe("KeyringController:unlock",()=>{e.call("SnapController:setClientActive",!0)}),{controller:p}}}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snap-controller-init.ts"}],[199,{"@metamask/snaps-controllers":2658},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInsightsControllerInit=void 0;var r=e("@metamask/snaps-controllers");n.SnapInsightsControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.SnapInsightsController({state:t.SnapInsightsController,messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snap-insights-controller-init.ts"}],[20,{"../../../shared/notifications":5921,"@metamask/announcement-controller":1202},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AnnouncementControllerInit=void 0;var r=e("@metamask/announcement-controller"),s=e("../../../shared/notifications");n.AnnouncementControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.AnnouncementController({messenger:e,allAnnouncements:s.UI_NOTIFICATIONS,state:t.AnnouncementController})})}}},{package:"$root$",file:"app/scripts/controller-init/announcement-controller-init.ts"}],[200,{"@metamask/snaps-controllers":2658},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInterfaceControllerInit=void 0;var r=e("@metamask/snaps-controllers");n.SnapInterfaceControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.SnapInterfaceController({state:t.SnapInterfaceController,messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snap-interface-controller-init.ts"}],[201,{"../../lib/SnapsNameProvider":253},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsNameProviderInit=void 0;var r=e("../../lib/SnapsNameProvider");n.SnapsNameProviderInit=({controllerMessenger:e})=>({persistedStateKey:null,memStateKey:null,controller:new r.SnapsNameProvider({messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snaps-name-provider-init.ts"}],[202,{"../../lib/util":358,"@metamask/snaps-controllers":2658,semver:5561},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryInit=void 0;var r=e("@metamask/snaps-controllers"),s=e("semver"),a=e("../../lib/util");n.SnapsRegistryInit=({controllerMessenger:e,persistedState:t})=>{const n=(0,a.getBooleanFlag)(!0),i="13.13.2",o=(0,s.parse)(i),c=o?`${o.major}.${o.minor}.${o.patch}`:i;return{controller:new r.JsonSnapsRegistry({state:t.SnapsRegistry,messenger:e,refetchOnAllowlistMiss:n,clientConfig:{type:"extension",version:c}})}}}}},{package:"$root$",file:"app/scripts/controller-init/snaps/snaps-registry-init.ts"}],[203,{"@metamask/snaps-controllers":2658},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketServiceInit=void 0;var r=e("@metamask/snaps-controllers");n.WebSocketServiceInit=({controllerMessenger:e})=>({memStateKey:null,persistedStateKey:null,controller:new r.WebSocketService({messenger:e})})}}},{package:"$root$",file:"app/scripts/controller-init/snaps/websocket-service-init.ts"}],[2037,{"./onekey-keyring.cjs":2038,"./trezor-connect-bridge.cjs":2039,"./trezor-keyring.cjs":2040},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./trezor-keyring.cjs"),n),s(e("./onekey-keyring.cjs"),n),s(e("./trezor-connect-bridge.cjs"),n)}}},{package:"@metamask/eth-trezor-keyring",file:"node_modules/@metamask/eth-trezor-keyring/dist/index.cjs"}],[2038,{"./trezor-keyring.cjs":2040},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OneKeyKeyring=void 0;const r=e("./trezor-keyring.cjs"),s="OneKey Hardware";class a extends r.TrezorKeyring{constructor(){super(...arguments),this.type=s}}n.OneKeyKeyring=a,a.type=s}}},{package:"@metamask/eth-trezor-keyring",file:"node_modules/@metamask/eth-trezor-keyring/dist/onekey-keyring.cjs"}],[2039,{"@trezor/connect-web":3194},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return s(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.TrezorConnectBridge=void 0;const i=a(e("@trezor/connect-web"));n.TrezorConnectBridge=class{constructor(){this.trezorConnectInitiated=!1}async init(e){i.default.on(i.DEVICE_EVENT,e=>{var t;e.type===i.DEVICE.CONNECT&&(this.model=null===(t=e.payload.features)||void 0===t?void 0:t.model)}),this.trezorConnectInitiated||(await i.default.init(e),this.trezorConnectInitiated=!0)}async dispose(){return i.default.dispose(),Promise.resolve()}getPublicKey(e){return i.default.getPublicKey(e)}ethereumSignTransaction(e){return i.default.ethereumSignTransaction(e)}ethereumSignMessage(e){return i.default.ethereumSignMessage(e)}ethereumSignTypedData(e){return i.default.ethereumSignTypedData(e)}}}}},{package:"@metamask/eth-trezor-keyring",file:"node_modules/@metamask/eth-trezor-keyring/dist/trezor-connect-bridge.cjs"}],[204,{"@metamask/permission-controller":2401},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubjectMetadataControllerInit=void 0;var r=e("@metamask/permission-controller");n.SubjectMetadataControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.SubjectMetadataController({state:t.SubjectMetadataController,messenger:e,subjectCacheLimit:100})})}}},{package:"$root$",file:"app/scripts/controller-init/subject-metadata-controller-init.ts"}],[2040,{"@ethereumjs/tx":665,"@ethereumjs/util":679,"@metamask/eth-sig-util":1974,"@metamask/utils":3070,"@trezor/connect-plugin-ethereum":3185,buffer:4038,hdkey:4552},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r,s,a,i,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.TrezorKeyring=n.TREZOR_CONNECT_MANIFEST=void 0;const d=e("@ethereumjs/tx"),h=e("@ethereumjs/util"),m=e("@metamask/eth-sig-util"),g=e("@metamask/utils"),p=e("@trezor/connect-plugin-ethereum"),f=u(e("hdkey")),b="m/44'/60'/0'/0",w="m/44'/1'/0'/0",C="m/44'/60'/0'",k={[b]:!0,[C]:!0,[w]:!0},y="Trezor Hardware",T=1e3;async function v(e){return new Promise(t=>setTimeout(t,e))}function S(e){return"function"==typeof e.getChainId}n.TREZOR_CONNECT_MANIFEST={appName:"MetaMask",email:"support@metamask.io",appUrl:"https://metamask.io"};class P{constructor({bridge:e}){if(r.add(this),this.type=y,this.accounts=[],this.hdk=new f.default,this.hdPath=b,this.page=0,this.perPage=5,this.unlockedAccount=0,this.paths={},!e)throw new Error("Bridge is a required dependency for the keyring");this.bridge=e}getModel(){return this.bridge.model}async init(){return this.bridge.init({manifest:n.TREZOR_CONNECT_MANIFEST,lazyLoad:!0})}async destroy(){return this.bridge.dispose()}async serialize(){return Promise.resolve({hdPath:this.hdPath,accounts:this.accounts.slice(),page:this.page,paths:this.paths,perPage:this.perPage,unlockedAccount:this.unlockedAccount})}async deserialize(e){var t,n,r,s;return this.hdPath=null!==(t=e.hdPath)&&void 0!==t?t:b,this.accounts=null!==(n=e.accounts)&&void 0!==n?n:[],this.page=null!==(r=e.page)&&void 0!==r?r:0,this.perPage=null!==(s=e.perPage)&&void 0!==s?s:5,Promise.resolve()}isUnlocked(){var e;return Boolean(null===(e=this.hdk)||void 0===e?void 0:e.publicKey)}async unlock(){return this.isUnlocked()?Promise.resolve("already unlocked"):new Promise((e,n)=>{this.bridge.getPublicKey({path:this.hdPath,coin:"ETH"}).then(r=>{var s;r.success?(this.hdk.publicKey=t.from(r.payload.publicKey,"hex"),this.hdk.chainCode=t.from(r.payload.chainCode,"hex"),e("just unlocked")):n(new Error((null===(s=r.payload)||void 0===s?void 0:s.error)||"Unknown error"))}).catch(e=>{n(new Error((null==e?void 0:e.toString())||"Unknown error"))})})}setAccountToUnlock(e){this.unlockedAccount=parseInt(String(e),10)}async addAccounts(e){return new Promise((t,n)=>{this.unlock().then(n=>{const s=this.unlockedAccount,a=s+e,i=[];for(let e=s;e<a;e++){const t=l(this,r,"m",o).call(this,"m",e);this.accounts.includes(t)||(this.accounts=[...this.accounts,t],i.push(t)),this.page=0}t(i)}).catch(e=>{n(e)})})}async getFirstPage(){return this.page=0,l(this,r,"m",s).call(this,1)}async getNextPage(){return l(this,r,"m",s).call(this,1)}async getPreviousPage(){return l(this,r,"m",s).call(this,-1)}async getAccounts(){return Promise.resolve(this.accounts.slice())}removeAccount(e){if(!this.accounts.map(e=>e.toLowerCase()).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter(t=>t.toLowerCase()!==e.toLowerCase())}async signTransaction(e,n){return S(n)?l(this,r,"m",a).call(this,e,n.getChainId(),n,e=>(n.v=t.from(e.v,"hex"),n.r=t.from(e.r,"hex"),n.s=t.from(e.s,"hex"),n)):l(this,r,"m",a).call(this,e,Number(n.common.chainId()),n,e=>{const t=n.toJSON();return t.type=n.type,t.v=(0,g.add0x)(e.v),t.r=(0,g.add0x)(e.r),t.s=(0,g.add0x)(e.s),d.TransactionFactory.fromTxData(t,{common:n.common,freeze:Object.isFrozen(n)})})}async signMessage(e,t){return this.signPersonalMessage(e,t)}async signPersonalMessage(e,t){return new Promise((n,s)=>{this.unlock().then(a=>{setTimeout(()=>{this.bridge.ethereumSignMessage({path:l(this,r,"m",c).call(this,e),message:(0,g.remove0x)(t),hex:!0}).then(t=>{var r;if(t.success){t.payload.address!==(0,g.getChecksumAddress)(e)&&s(new Error("signature doesnt match the right address"));const r=`0x${t.payload.signature}`;n(r)}else s(new Error((null===(r=t.payload)||void 0===r?void 0:r.error)||"Unknown error"))}).catch(e=>{s(new Error((null==e?void 0:e.toString())||"Unknown error"))})},"just unlocked"===a?T:0)}).catch(e=>{s(new Error((null==e?void 0:e.toString())||"Unknown error"))})})}async signTypedData(e,t,n){var s,a;const{version:i}=null!=n?n:{version:m.SignTypedDataVersion.V4},o=(0,p.transformTypedData)(t,i===m.SignTypedDataVersion.V4),{types:u,message:d={},domain:h={},primaryType:f,domain_separator_hash:b,message_hash:w}=o,C=await this.unlock();await v("just unlocked"===C?T:0);const k=await this.bridge.ethereumSignTypedData({path:l(this,r,"m",c).call(this,e),data:{types:Object.assign(Object.assign({},u),{EIP712Domain:null!==(s=u.EIP712Domain)&&void 0!==s?s:[]}),message:d,domain:h,primaryType:f},metamask_v4_compat:!0,domain_separator_hash:b,message_hash:null!=w?w:""});if(k.success){if((0,g.getChecksumAddress)(e)!==k.payload.address)throw new Error("signature doesnt match the right address");return k.payload.signature}throw new Error((null===(a=k.payload)||void 0===a?void 0:a.error)||"Unknown error")}forgetDevice(){this.accounts=[],this.hdk=new f.default,this.page=0,this.unlockedAccount=0,this.paths={}}setHdPath(e){if(!k[e])throw new Error(`The setHdPath method does not support setting HD Path to ${e}`);this.hdPath!==e&&(this.hdk=new f.default,this.accounts=[],this.page=0,this.perPage=5,this.unlockedAccount=0,this.paths={}),this.hdPath=e}}n.TrezorKeyring=P,r=new WeakSet,s=async function(e){return this.page+=e,this.page<=0&&(this.page=1),new Promise((e,t)=>{this.unlock().then(t=>{const n=(this.page-1)*this.perPage,s=n+this.perPage,a=[];for(let e=n;e<s;e++){const t=l(this,r,"m",o).call(this,"m",e);a.push({address:t,balance:null,index:e}),this.paths[(0,g.getChecksumAddress)(t)]=e}e(a)}).catch(e=>{t(e)})})},a=async function(e,n,s,a){var o,u,d,h;let m;m=S(s)?{to:l(this,r,"m",i).call(this,s.to),value:l(this,r,"m",i).call(this,s.value),data:l(this,r,"m",i).call(this,s.data),chainId:n,nonce:l(this,r,"m",i).call(this,s.nonce),gasLimit:l(this,r,"m",i).call(this,s.gasLimit),gasPrice:l(this,r,"m",i).call(this,s.gasPrice)}:Object.assign(Object.assign({},s.toJSON()),{chainId:n,to:l(this,r,"m",i).call(this,t.from(null!==(u=null===(o=s.to)||void 0===o?void 0:o.bytes)&&void 0!==u?u:[]))});try{const t=await this.unlock();await v("just unlocked"===t?T:0);const n=await this.bridge.ethereumSignTransaction({path:l(this,r,"m",c).call(this,e),transaction:m});if(n.success){const t=a(n.payload),r=(0,g.getChecksumAddress)((0,g.add0x)(t.getSenderAddress().toString("hex")));if(r!==(0,g.getChecksumAddress)(e))throw new Error("signature doesn't match the right address");return t}throw new Error((null===(d=n.payload)||void 0===d?void 0:d.error)||"Unknown error")}catch(e){throw new Error(null!==(h=null==e?void 0:e.toString())&&void 0!==h?h:"Unknown error")}},i=function(e){return(0,g.bytesToHex)(e)},o=function(e,t){const n=this.hdk.derive(`${e}/${t}`),r=(0,g.bytesToHex)((0,h.publicToAddress)(n.publicKey,!0));return(0,h.toChecksumAddress)(r)},c=function(e){const t=(0,g.getChecksumAddress)(e);let n=this.paths[t];if(void 0===n)for(let e=0;e<1e3;e++)if(t===l(this,r,"m",o).call(this,"m",e)){n=e;break}if(void 0===n)throw new Error("Unknown address");return`${this.hdPath}/${n}`},P.type=y}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-trezor-keyring",file:"node_modules/@metamask/eth-trezor-keyring/dist/trezor-keyring.cjs"}],[205,{"./subscription-controller-init":206,"./subscription-service-init":207},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"SubscriptionControllerInit",{enumerable:!0,get:function(){return r.SubscriptionControllerInit}}),Object.defineProperty(n,"SubscriptionServiceInit",{enumerable:!0,get:function(){return s.SubscriptionServiceInit}});var r=e("./subscription-controller-init"),s=e("./subscription-service-init")}}},{package:"$root$",file:"app/scripts/controller-init/subscription/index.ts"}],[2057,{"./determineGasFeeCalculations.cjs":2058,"./gas-util.cjs":2059,"@metamask/controller-utils":1384,"@metamask/eth-query":1972,"@metamask/polling-controller":2064,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,s,a,i=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.GasFeeController=n.GAS_ESTIMATE_TYPES=n.LEGACY_GAS_PRICES_API_URL=void 0;const l=e("@metamask/controller-utils"),u=c(e("@metamask/eth-query")),d=e("@metamask/polling-controller"),h=e("uuid"),m=c(e("./determineGasFeeCalculations.cjs")),g=e("./gas-util.cjs");n.LEGACY_GAS_PRICES_API_URL="https://api.metaswap.codefi.network/gasPrices",n.GAS_ESTIMATE_TYPES={FEE_MARKET:"fee-market",LEGACY:"legacy",ETH_GASPRICE:"eth_gasPrice",NONE:"none"};const p={gasFeeEstimatesByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},gasFeeEstimates:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},estimatedGasFeeTimeBounds:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},gasEstimateType:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},nonRPCGasFeeApisDisabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}},f={gasFeeEstimatesByChainId:{},gasFeeEstimates:{},estimatedGasFeeTimeBounds:{},gasEstimateType:n.GAS_ESTIMATE_TYPES.NONE,nonRPCGasFeeApisDisabled:!1};class b extends((0,d.StaticIntervalPollingController)()){constructor({interval:e=15e3,messenger:t,state:c,getCurrentNetworkEIP1559Compatibility:l,getCurrentAccountEIP1559Compatibility:d,getChainId:h,getCurrentNetworkLegacyGasAPICompatibility:m,getProvider:g,onNetworkDidChange:b,legacyAPIEndpoint:w=n.LEGACY_GAS_PRICES_API_URL,EIP1559APIEndpoint:C,clientId:k}){if(super({name:"GasFeeController",metadata:p,messenger:t,state:{...f,...c}}),r.add(this),s.set(this,void 0),this.intervalDelay=e,this.setIntervalLength(e),this.pollTokens=new Set,this.getCurrentNetworkEIP1559Compatibility=l,this.getCurrentNetworkLegacyGasAPICompatibility=m,this.getCurrentAccountEIP1559Compatibility=d,i(this,s,g,"f"),this.EIP1559APIEndpoint=C,this.legacyAPIEndpoint=w,this.clientId=k,this.ethQuery=new u.default(o(this,s,"f").call(this)),b&&h)this.currentChainId=h(),b(async e=>{await o(this,r,"m",a).call(this,e)});else{const{selectedNetworkClientId:e}=this.messenger.call("NetworkController:getState");this.currentChainId=this.messenger.call("NetworkController:getNetworkClientById",e).configuration.chainId,this.messenger.subscribe("NetworkController:networkDidChange",async e=>{await o(this,r,"m",a).call(this,e)})}}async resetPolling(){if(0!==this.pollTokens.size){const e=Array.from(this.pollTokens);this.stopPolling(),await this.getGasFeeEstimatesAndStartPolling(e[0]),e.slice(1).forEach(e=>{this.pollTokens.add(e)})}}async fetchGasFeeEstimates(e){return await this._fetchGasFeeEstimateData(e)}async getGasFeeEstimatesAndStartPolling(e){const t=e||(0,h.v1)();return this.pollTokens.add(t),1===this.pollTokens.size&&(await this._fetchGasFeeEstimateData(),this._poll()),t}async _fetchGasFeeEstimateData(e={}){const{shouldUpdateState:t=!0,networkClientId:n}=e;let r,s,a,i;if(n!==undefined){const e=this.messenger.call("NetworkController:getNetworkClientById",n);a="0x38"===e.configuration.chainId,i=(0,l.convertHexToDecimal)(e.configuration.chainId);try{s=await this.messenger.call("NetworkController:getEIP1559Compatibility",n)||!1}catch{s=!1}r=new u.default(e.provider)}r??(r=this.ethQuery),a??(a=this.getCurrentNetworkLegacyGasAPICompatibility()),i??(i=(0,l.convertHexToDecimal)(this.currentChainId));try{s??(s=await this.getEIP1559Compatibility())}catch(e){console.error(e),s??(s=!1)}const o=await(0,m.default)({isEIP1559Compatible:s,isLegacyGasAPICompatible:a,fetchGasEstimates:g.fetchGasEstimates,fetchGasEstimatesUrl:this.EIP1559APIEndpoint.replace("<chain_id>",`${i}`),fetchLegacyGasPriceEstimates:g.fetchLegacyGasPriceEstimates,fetchLegacyGasPriceEstimatesUrl:this.legacyAPIEndpoint.replace("<chain_id>",`${i}`),fetchEthGasPriceEstimate:g.fetchEthGasPriceEstimate,calculateTimeEstimate:g.calculateTimeEstimate,clientId:this.clientId,ethQuery:r,nonRPCGasFeeApisDisabled:this.state.nonRPCGasFeeApisDisabled});if(t){const e=(0,l.toHex)(i);this.update(t=>{this.currentChainId===e&&(t.gasFeeEstimates=o.gasFeeEstimates,t.estimatedGasFeeTimeBounds=o.estimatedGasFeeTimeBounds,t.gasEstimateType=o.gasEstimateType),t.gasFeeEstimatesByChainId??(t.gasFeeEstimatesByChainId={}),t.gasFeeEstimatesByChainId[e]={gasFeeEstimates:o.gasFeeEstimates,estimatedGasFeeTimeBounds:o.estimatedGasFeeTimeBounds,gasEstimateType:o.gasEstimateType}})}return o}disconnectPoller(e){this.pollTokens.delete(e),0===this.pollTokens.size&&this.stopPolling()}stopPolling(){this.intervalId&&clearInterval(this.intervalId),this.pollTokens.clear(),this.resetState()}destroy(){super.destroy(),this.stopPolling()}_poll(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(async()=>{await(0,l.safelyExecute)(()=>this._fetchGasFeeEstimateData())},this.intervalDelay)}async _executePoll({networkClientId:e}){await this._fetchGasFeeEstimateData({networkClientId:e})}resetState(){this.update(()=>f)}async getEIP1559Compatibility(){const e=await this.getCurrentNetworkEIP1559Compatibility(),t=this.getCurrentAccountEIP1559Compatibility?.()??!0;return e&&t}getTimeEstimate(e,t){return this.state.gasFeeEstimates&&this.state.gasEstimateType===n.GAS_ESTIMATE_TYPES.FEE_MARKET?(0,g.calculateTimeEstimate)(e,t,this.state.gasFeeEstimates):{}}enableNonRPCGasFeeApis(){this.update(e=>{e.nonRPCGasFeeApisDisabled=!1})}disableNonRPCGasFeeApis(){this.update(e=>{e.nonRPCGasFeeApisDisabled=!0})}}n.GasFeeController=b,s=new WeakMap,r=new WeakSet,a=async function({selectedNetworkClientId:e}){const t=this.messenger.call("NetworkController:getNetworkClientById",e).configuration.chainId;t!==this.currentChainId&&(this.ethQuery=new u.default(o(this,s,"f").call(this)),await this.resetPolling(),this.currentChainId=t)},n.default=b}}},{package:"@metamask/gas-fee-controller",file:"node_modules/@metamask/gas-fee-controller/dist/GasFeeController.cjs"}],[2058,{"./GasFeeController.cjs":2057},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const r=e("./GasFeeController.cjs");n.default=async function(e){try{return await async function(e){const{isEIP1559Compatible:t,isLegacyGasAPICompatible:n,nonRPCGasFeeApisDisabled:s}=e;try{if(t&&!s)return await async function(e){const{fetchGasEstimates:t,fetchGasEstimatesUrl:n,clientId:s,calculateTimeEstimate:a}=e,i=await t(n,s),{suggestedMaxPriorityFeePerGas:o,suggestedMaxFeePerGas:c}=i.medium,l=a(o,c,i);return{gasFeeEstimates:i,estimatedGasFeeTimeBounds:l,gasEstimateType:r.GAS_ESTIMATE_TYPES.FEE_MARKET}}(e);if(n&&!s)return await async function(e){const{fetchLegacyGasPriceEstimates:t,fetchLegacyGasPriceEstimatesUrl:n,clientId:s}=e;return{gasFeeEstimates:await t(n,s),estimatedGasFeeTimeBounds:{},gasEstimateType:r.GAS_ESTIMATE_TYPES.LEGACY}}(e);throw new Error("Main gas fee/price estimation failed. Use fallback")}catch{return await async function(e){const{ethQuery:t,fetchEthGasPriceEstimate:n}=e;return{gasFeeEstimates:await n(t),estimatedGasFeeTimeBounds:{},gasEstimateType:r.GAS_ESTIMATE_TYPES.ETH_GASPRICE}}(e)}}(e)}catch(e){if(e instanceof Error)throw new Error(`Gas fee/price estimation failed. Message: ${e.message}`);throw e}}}}},{package:"@metamask/gas-fee-controller",file:"node_modules/@metamask/gas-fee-controller/dist/determineGasFeeCalculations.cjs"}],[2059,{"@metamask/controller-utils":1384,"bn.js":3977},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTimeEstimate=n.fetchEthGasPriceEstimate=n.fetchLegacyGasPriceEstimates=n.fetchGasEstimates=n.normalizeGWEIDecimalNumbers=void 0;const s=e("@metamask/controller-utils"),a=r(e("bn.js")),i=e=>({"X-Client-Id":e});function o(e){const t=(0,s.gweiDecToWEIBN)(e).toString(16);return(0,s.weiHexToGweiDec)(t)}n.normalizeGWEIDecimalNumbers=o,n.fetchGasEstimates=async function(e,t){const n=await(0,s.handleFetch)(e,t?{headers:i(t)}:undefined);return{low:{...n.low,suggestedMaxPriorityFeePerGas:o(n.low.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.low.suggestedMaxFeePerGas)},medium:{...n.medium,suggestedMaxPriorityFeePerGas:o(n.medium.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.medium.suggestedMaxFeePerGas)},high:{...n.high,suggestedMaxPriorityFeePerGas:o(n.high.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.high.suggestedMaxFeePerGas)},estimatedBaseFee:o(n.estimatedBaseFee),historicalBaseFeeRange:n.historicalBaseFeeRange,baseFeeTrend:n.baseFeeTrend,latestPriorityFeeRange:n.latestPriorityFeeRange,historicalPriorityFeeRange:n.historicalPriorityFeeRange,priorityFeeTrend:n.priorityFeeTrend,networkCongestion:n.networkCongestion}},n.fetchLegacyGasPriceEstimates=async function(e,t){const n=await(0,s.handleFetch)(e,{referrer:e,referrerPolicy:"no-referrer-when-downgrade",method:"GET",mode:"cors",headers:{"Content-Type":"application/json",...t&&i(t)}});return{low:n.SafeGasPrice,medium:n.ProposeGasPrice,high:n.FastGasPrice}},n.fetchEthGasPriceEstimate=async function(e){const t=await(0,s.query)(e,"gasPrice");return{gasPrice:(0,s.weiHexToGweiDec)(t).toString()}},n.calculateTimeEstimate=function(e,t,n){const{low:r,medium:i,high:o,estimatedBaseFee:c}=n,l=(0,s.gweiDecToWEIBN)(e),u=(0,s.gweiDecToWEIBN)(t),d=(0,s.gweiDecToWEIBN)(c),h=a.default.min(l,u.sub(d)),m=(0,s.gweiDecToWEIBN)(r.suggestedMaxPriorityFeePerGas),g=(0,s.gweiDecToWEIBN)(i.suggestedMaxPriorityFeePerGas),p=(0,s.gweiDecToWEIBN)(o.suggestedMaxPriorityFeePerGas);let f,b;return h.lt(m)?(f=null,b="unknown"):h.gte(m)&&h.lt(g)?(f=r.minWaitTimeEstimate,b=r.maxWaitTimeEstimate):h.gte(g)&&h.lt(p)?(f=i.minWaitTimeEstimate,b=i.maxWaitTimeEstimate):h.eq(p)?(f=o.minWaitTimeEstimate,b=o.maxWaitTimeEstimate):(f=0,b=o.maxWaitTimeEstimate),{lowerTimeBound:f,upperTimeBound:b}}}}},{package:"@metamask/gas-fee-controller",file:"node_modules/@metamask/gas-fee-controller/dist/gas-util.cjs"}],[206,{"../../../../shared/modules/shield":5913,"@metamask/subscription-controller":2927},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionControllerInit=void 0;var r=e("@metamask/subscription-controller");const s=(0,e("../../../../shared/modules/shield").loadShieldConfig)();n.SubscriptionControllerInit=e=>{const{initMessenger:t,controllerMessenger:n,persistedState:a}=e,i=new r.SubscriptionService({env:s.subscriptionEnv,auth:{getAccessToken:()=>t.call("AuthenticationController:getBearerToken")}});return{controller:new r.SubscriptionController({messenger:n,state:a.SubscriptionController,subscriptionService:i})}}}}},{package:"$root$",file:"app/scripts/controller-init/subscription/subscription-controller-init.ts"}],[2060,{"./GasFeeController.cjs":2057},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./GasFeeController.cjs"),n)}}},{package:"@metamask/gas-fee-controller",file:"node_modules/@metamask/gas-fee-controller/dist/index.cjs"}],[2061,{"fast-json-stable-stringify":4352,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AbstractPollingControllerBaseMixin=n.getKey=void 0;const a=s(e("fast-json-stable-stringify")),i=e("uuid");n.getKey=e=>(0,a.default)(e),n.AbstractPollingControllerBaseMixin=function(e){var t,s;return t=new WeakMap,s=new WeakMap,class extends e{constructor(){super(...arguments),t.set(this,new Map),s.set(this,new Map)}startPolling(e){const s=(0,i.v4)(),a=(0,n.getKey)(e),o=r(this,t,"f").get(a)??new Set;return o.add(s),r(this,t,"f").set(a,o),1===o.size&&this._startPolling(e),s}stopAllPolling(){r(this,t,"f").forEach((e,t)=>{e.forEach(e=>{this.stopPollingByPollingToken(e)})})}stopPollingByPollingToken(e){if(!e)throw new Error("pollingToken required");let n=null;for(const[s,a]of r(this,t,"f"))if(a.delete(e)){0===a.size&&(n=s);break}if(n){this._stopPollingByPollingTokenSetId(n),r(this,t,"f").delete(n);const e=r(this,s,"f").get(n);if(e){for(const t of e)t(JSON.parse(n));e.clear()}}}onPollingComplete(e,t){const a=(0,n.getKey)(e),i=r(this,s,"f").get(a)??new Set;i.add(t),r(this,s,"f").set(a,i)}}}}}},{package:"@metamask/gas-fee-controller>@metamask/polling-controller",file:"node_modules/@metamask/gas-fee-controller/node_modules/@metamask/polling-controller/dist/AbstractPollingController.cjs"}],[2062,{"./AbstractPollingController.cjs":2061,"@metamask/base-controller":1311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.BlockTrackerPollingController=n.BlockTrackerPollingControllerOnly=void 0;const s=e("@metamask/base-controller"),a=e("./AbstractPollingController.cjs");function i(e){var t;class n extends((0,a.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{})}_startPolling(e){const n=(0,a.getKey)(e);if(r(this,t,"f")[n])return;const s=this._getNetworkClientById(e.networkClientId);if(!s)throw new Error(`Unable to retrieve blockTracker for networkClientId ${e.networkClientId}`);{const a=this._executePoll.bind(this,e);s.blockTracker.addListener("latest",a),r(this,t,"f")[n]=a}}_stopPollingByPollingTokenSetId(e){const{networkClientId:n}=JSON.parse(e),s=this._getNetworkClientById(n);if(s&&r(this,t,"f")[e]){const n=r(this,t,"f")[e];n&&(s.blockTracker.removeListener("latest",n),delete r(this,t,"f")[e])}}}return t=new WeakMap,n}class o{}n.BlockTrackerPollingControllerOnly=()=>i(o);n.BlockTrackerPollingController=()=>i(s.BaseController)}}},{package:"@metamask/gas-fee-controller>@metamask/polling-controller",file:"node_modules/@metamask/gas-fee-controller/node_modules/@metamask/polling-controller/dist/BlockTrackerPollingController.cjs"}],[2063,{"./AbstractPollingController.cjs":2061,"@metamask/base-controller":1311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__classPrivateFieldSet||function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},s=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.StaticIntervalPollingController=n.StaticIntervalPollingControllerOnly=void 0;const a=e("@metamask/base-controller"),i=e("./AbstractPollingController.cjs");function o(e){var t,n;class a extends((0,i.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{}),n.set(this,1e3)}setIntervalLength(e){r(this,n,e,"f")}getIntervalLength(){return s(this,n,"f")}_startPolling(e){if(!s(this,n,"f"))throw new Error("intervalLength must be defined and greater than 0");const r=(0,i.getKey)(e),a=s(this,t,"f")[r];this._stopPollingByPollingTokenSetId(r);const o=s(this,t,"f")[r]=setTimeout(async()=>{try{await this._executePoll(e)}catch(e){console.error(e)}o===s(this,t,"f")[r]&&this._startPolling(e)},a?s(this,n,"f"):0)}_stopPollingByPollingTokenSetId(e){const n=s(this,t,"f")[e];n&&(clearTimeout(n),delete s(this,t,"f")[e])}}return t=new WeakMap,n=new WeakMap,a}class c{}n.StaticIntervalPollingControllerOnly=()=>o(c);n.StaticIntervalPollingController=()=>o(a.BaseController)}}},{package:"@metamask/gas-fee-controller>@metamask/polling-controller",file:"node_modules/@metamask/gas-fee-controller/node_modules/@metamask/polling-controller/dist/StaticIntervalPollingController.cjs"}],[2064,{"./BlockTrackerPollingController.cjs":2062,"./StaticIntervalPollingController.cjs":2063},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StaticIntervalPollingController=n.StaticIntervalPollingControllerOnly=n.BlockTrackerPollingController=n.BlockTrackerPollingControllerOnly=void 0;var r=e("./BlockTrackerPollingController.cjs");Object.defineProperty(n,"BlockTrackerPollingControllerOnly",{enumerable:!0,get:function(){return r.BlockTrackerPollingControllerOnly}}),Object.defineProperty(n,"BlockTrackerPollingController",{enumerable:!0,get:function(){return r.BlockTrackerPollingController}});var s=e("./StaticIntervalPollingController.cjs");Object.defineProperty(n,"StaticIntervalPollingControllerOnly",{enumerable:!0,get:function(){return s.StaticIntervalPollingControllerOnly}}),Object.defineProperty(n,"StaticIntervalPollingController",{enumerable:!0,get:function(){return s.StaticIntervalPollingController}})}}},{package:"@metamask/gas-fee-controller>@metamask/polling-controller",file:"node_modules/@metamask/gas-fee-controller/node_modules/@metamask/polling-controller/dist/index.cjs"}],[207,{"../../services/oauth/web-authenticator-factory":588,"../../services/subscription/subscription-service":589},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubscriptionServiceInit=void 0;var r=e("../../services/subscription/subscription-service"),s=e("../../services/oauth/web-authenticator-factory");n.SubscriptionServiceInit=e=>{const{controllerMessenger:t,platform:n}=e;return{controller:new r.SubscriptionService({messenger:t,platform:n,webAuthenticator:(0,s.webAuthenticatorFactory)()}),memStateKey:null,persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/subscription/subscription-service-init.ts"}],[208,{"../controllers/swaps":242},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SwapsControllerInit=void 0;var r,s=(r=e("../controllers/swaps"))&&r.__esModule?r:{default:r};n.SwapsControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n,getController:r})=>{const a=r("GasFeeController"),i=r("TransactionController");return{controller:new s.default({messenger:e,getBufferedGasLimit:async(e,n)=>{const r=t.call("NetworkController:getState"),{gas:s,simulationFails:a}=await i.estimateGasBuffered(e.txParams,n,r.selectedNetworkClientId);return{gasLimit:s,simulationFails:a}},getEIP1559GasFeeEstimates:(...e)=>a.fetchGasFeeEstimates(...e),getLayer1GasFee:(...e)=>i.getLayer1GasFee(...e),trackMetaMetricsEvent:t.call.bind(t,"MetaMetricsController:trackEvent")},n.SwapsController)}}}}},{package:"$root$",file:"app/scripts/controller-init/swaps-controller-init.ts"}],[209,{"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TokenBalancesControllerInit=void 0;var r=e("@metamask/assets-controllers");n.TokenBalancesControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n})=>{const{useMultiAccountBalanceChecker:s}=t.call("PreferencesController:getState");return{controller:new r.TokenBalancesController({messenger:e,state:n.TokenBalancesController,queryMultipleAccounts:s,interval:3e4,allowExternalServices:()=>t.call("PreferencesController:getState").useExternalServices,accountsApiChainIds:()=>{var e;const n=t.call("RemoteFeatureFlagController:getState"),r=null==n||null===(e=n.remoteFeatureFlags)||void 0===e?void 0:e.assetsAccountApiBalances;return Array.isArray(r)?r:[]},platform:"extension"})}}}}},{package:"$root$",file:"app/scripts/controller-init/token-balances-controller-init.ts"}],[21,{"../controllers/app-metadata":218},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AppMetadataControllerInit=void 0;var r,s=(r=e("../controllers/app-metadata"))&&r.__esModule?r:{default:r};n.AppMetadataControllerInit=({controllerMessenger:e,persistedState:t,currentMigrationVersion:n})=>({controller:new s.default({state:t.AppMetadataController,messenger:e,currentAppVersion:"13.13.2",currentMigrationVersion:n})})}}},{package:"$root$",file:"app/scripts/controller-init/app-metadata-controller-init.ts"}],[210,{"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TokenDetectionControllerInit=void 0;var r=e("@metamask/assets-controllers");n.TokenDetectionControllerInit=({controllerMessenger:e,initMessenger:t})=>({memStateKey:null,persistedStateKey:null,controller:new r.TokenDetectionController({messenger:e,getBalancesInSingleCall:(...e)=>t.call("AssetsContractController:getBalancesInSingleCall",...e),trackMetaMetricsEvent:(...e)=>t.call("MetaMetricsController:trackEvent",...e),useAccountsAPI:!0,platform:"extension",useTokenDetection:()=>t.call("PreferencesController:getState").useTokenDetection,useExternalServices:()=>t.call("PreferencesController:getState").useExternalServices})})}}},{package:"$root$",file:"app/scripts/controller-init/token-detection-controller-init.ts"}],[211,{"../lib/util":358,"./init-utils":58,"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TokenListControllerInit=void 0;var r=e("@metamask/assets-controllers"),s=e("../lib/util"),a=e("./init-utils");n.TokenListControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n})=>{const i=t.call("PreferencesController:getState"),o=e=>{const{useTokenDetection:t,useTransactionSimulations:n,preferences:r}=e??{},{petnamesEnabled:s}=r??{};return t||s||n},c=new r.TokenListController({messenger:e,state:n.TokenListController,preventPollingOnNetworkRestart:!o(i),chainId:(0,a.getGlobalChainId)(t)});return t.subscribe("PreferencesController:stateChange",(0,s.previousValueComparator)((e,t)=>(((e,t)=>{const n=o(t),r=o(e);n!==r&&c.updatePreventPollingOnNetworkRestart(!r)})(t,e),!0),i)),{controller:c}}}}},{package:"$root$",file:"app/scripts/controller-init/token-list-controller-init.ts"}],[212,{"./init-utils":58,"@metamask/assets-controllers":1240,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TokensControllerInit=void 0;var r=e("@metamask/assets-controllers"),s=e("@metamask/utils"),a=e("./init-utils");n.TokensControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n})=>{const{provider:i}=t.call("NetworkController:getSelectedNetworkClient")??{};(0,s.assert)(i,"Provider is required to initialize TokensController.");return{controller:new r.TokensController({messenger:e,state:n.TokensController,provider:i,chainId:(0,a.getGlobalChainId)(t)})}}}}},{package:"$root$",file:"app/scripts/controller-init/tokens-controller-init.ts"}],[213,{"@metamask/transaction-pay-controller":3023},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayControllerInit=void 0;var r=e("@metamask/transaction-pay-controller");function s(e){return r.TransactionPayStrategy.Relay}n.TransactionPayControllerInit=e=>{const{controllerMessenger:t,persistedState:n}=e;return{controller:new r.TransactionPayController({getDelegationTransaction:async()=>{throw new Error("Delegation transaction not supported")},getStrategy:s,messenger:t,state:n.TransactionPayController})}}}}},{package:"$root$",file:"app/scripts/controller-init/transaction-pay-controller-init.ts"}],[214,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){}}},{package:"$root$",file:"app/scripts/controller-init/types.ts"}],[215,{"./messengers":105,"./types":214,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.initControllers=function({baseControllerMessenger:e,existingControllers:t=[],initFunctions:n,initRequest:r}){a("Initializing controllers",Object.keys(n).length);const i=t.reduce((e,t)=>(e[t.name]=t,e),{}),o={},c={};let l={};const u=e=>function(e,t){const n=e[t];if(!n)throw new Error(`Controller requested before it was initialized: ${String(t)}`);return n}(i,e);for(const[t,d]of Object.entries(n)){const n=t,h=d,m=s.CONTROLLER_MESSENGERS[n],g=null==m?void 0:m.getMessenger,p=null==m?void 0:m.getInitMessenger,f={...r,controllerMessenger:null==g?void 0:g(e),getController:u,initMessenger:null==p?void 0:p(e)},b=h({...f,controllerMessenger:f.controllerMessenger}),{controller:w,persistedStateKey:C,memStateKey:k}=b,y=b.api??{},T=null===C?undefined:C??n,v=null===k?undefined:k??n;i[n]=w,l={...l,...y},T&&(o[T]=w),v&&(c[v]=w),a("Initialized controller",n,{api:Object.keys(y),persistedStateKey:T,memStateKey:v})}return{controllerApi:l,controllerMemState:c,controllerPersistedState:o,controllersByName:i}};var r=e("@metamask/utils"),s=(e("./types"),e("./messengers"));const a=(0,r.createProjectLogger)("controller-init")}}},{package:"$root$",file:"app/scripts/controller-init/utils.ts"}],[216,{"@metamask/base-controller":1311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AccountOrderController=void 0;var r=e("@metamask/base-controller");const s={pinnedAccountList:[],hiddenAccountList:[]},a={pinnedAccountList:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},hiddenAccountList:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0}};class i extends r.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:a,name:"AccountOrderController",state:{...s,...t}})}updateAccountsList(e){this.update(t=>(t.pinnedAccountList=e,t))}updateHiddenAccountsList(e){this.update(t=>(t.hiddenAccountList=e,t))}}n.AccountOrderController=i}}},{package:"$root$",file:"app/scripts/controllers/account-order.ts"}],[217,{"../../../shared/constants/alerts":5751,"@metamask/base-controller":1311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultAlertControllerState=n.AlertController=void 0;var r=e("@metamask/base-controller"),s=e("../../../shared/constants/alerts");function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const c=()=>({alertEnabledness:s.TOGGLEABLE_ALERT_TYPES.reduce((e,t)=>(e[t]=!0,e),{}),unconnectedAccountAlertShownOrigins:{},web3ShimUsageOrigins:{}});n.getDefaultAlertControllerState=c;const l={alertEnabledness:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},unconnectedAccountAlertShownOrigins:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},web3ShimUsageOrigins:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};var u=new WeakMap,d=new WeakSet;class h extends r.BaseController{constructor(e){var t,n;super({messenger:e.messenger,metadata:l,name:"AlertController",state:{...c(),...e.state}}),a(t=this,n=d),n.add(t),function(e,t,n){a(e,t),t.set(e,n)}(this,u,void 0),i(u,this,this.messenger.call("AccountsController:getSelectedAccount").address),this.messenger.subscribe("AccountsController:selectedAccountChange",e=>{this.state.unconnectedAccountAlertShownOrigins&&function(e,t){return e.get(o(e,t))}(u,this)!==e.address&&(i(u,this,e.address),this.update(e=>{e.unconnectedAccountAlertShownOrigins={}}))})}setAlertEnabledness(e,t){this.update(n=>{n.alertEnabledness[e]=t})}setUnconnectedAccountAlertShown(e){this.update(t=>{t.unconnectedAccountAlertShownOrigins[e]=!0})}getWeb3ShimUsageState(e){var t;return null===(t=this.state.web3ShimUsageOrigins)||void 0===t?void 0:t[e]}setWeb3ShimUsageRecorded(e){o(d,this,m).call(this,e,s.Web3ShimUsageAlertStates.recorded)}setWeb3ShimUsageAlertDismissed(e){o(d,this,m).call(this,e,s.Web3ShimUsageAlertStates.dismissed)}}function m(e,t){this.update(n=>{n.web3ShimUsageOrigins&&(n.web3ShimUsageOrigins[e]=t)})}n.AlertController=h}}},{package:"$root$",file:"app/scripts/controllers/alert-controller.ts"}],[218,{"@metamask/base-controller":1311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultAppMetadataControllerState=n.default=void 0;var r=e("@metamask/base-controller");function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const i=()=>({currentAppVersion:"",previousAppVersion:"",previousMigrationVersion:0,currentMigrationVersion:0});n.getDefaultAppMetadataControllerState=i;const o={currentAppVersion:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},previousAppVersion:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},previousMigrationVersion:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},currentMigrationVersion:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1}};var c=new WeakSet;class l extends r.BaseController{constructor({state:e={},messenger:t,currentAppVersion:n="",currentMigrationVersion:r=0}){super({name:"AppMetadataController",metadata:o,state:{currentAppVersion:"",previousAppVersion:"",previousMigrationVersion:0,currentMigrationVersion:0,...e},messenger:t}),s(this,c),a(c,this,u).call(this,n),a(c,this,d).call(this,r)}}function u(e){const t=this.state.currentAppVersion;e!==t&&this.update(n=>{n.currentAppVersion=e,n.previousAppVersion=t})}function d(e){const t=this.state.currentMigrationVersion;e!==t&&this.update(n=>{n.previousMigrationVersion=t,n.currentMigrationVersion=e})}n.default=l}}},{package:"$root$",file:"app/scripts/controllers/app-metadata.ts"}],[219,{"../../../shared/constants/alarms":5750,"../../../shared/constants/app":5753,"../../../shared/constants/preferences":5777,"../../../shared/constants/time":5790,"../../../shared/modules/mv3.utils":5899,"../../../ui/helpers/utils/build-types":7075,"@metamask/base-controller":1311,"@metamask/controller-utils":1384,"@metamask/utils":3070,loglevel:4802,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AppStateController=void 0;var r,s=e("uuid"),a=(r=e("loglevel"))&&r.__esModule?r:{default:r},i=e("@metamask/controller-utils"),o=e("@metamask/base-controller"),c=e("@metamask/utils"),l=e("../../../shared/constants/time"),u=e("../../../shared/constants/alarms"),d=e("../../../shared/modules/mv3.utils"),h=e("../../../ui/helpers/utils/build-types"),m=e("../../../shared/constants/app"),g=e("../../../shared/constants/preferences");function p(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t,n){b(e,t),t.set(e,n)}function b(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function w(e,t){return e.get(k(e,t))}function C(e,t,n){return e.set(k(e,t),n),n}function k(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const y={activeQrCodeScanRequest:{includeInStateLogs:!1,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},addressSecurityAlertResponses:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},appActiveTab:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},browserEnvironment:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},connectedStatusPopoverHasBeenShown:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},currentExtensionPopupId:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},currentPopupId:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},defaultHomeActiveTabName:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},enableEnforcedSimulations:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},enableEnforcedSimulationsForTransactions:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},enforcedSimulationsSlippage:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},enforcedSimulationsSlippageForTransactions:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},fullScreenGasPollTokens:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},hadAdvancedGasFeesSetPriorToMigration92_3:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},canTrackWalletFundsObtained:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},isRampCardClosed:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},isUpdateAvailable:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},lastInteractedConfirmationInfo:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},lastUpdatedAt:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},lastUpdatedFromVersion:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},lastViewedUserSurvey:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},networkConnectionBanner:{includeInStateLogs:!1,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},newPrivacyPolicyToastClickedOrClosed:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},newPrivacyPolicyToastShownDate:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},pna25Acknowledged:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},nftsDetectionNoticeDismissed:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},nftsDropdownState:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},notificationGasPollTokens:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},onboardingDate:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},outdatedBrowserWarningLastShown:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},popupGasPollTokens:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},sidePanelGasPollTokens:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},productTour:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},recoveryPhraseReminderHasBeenShown:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},recoveryPhraseReminderLastShown:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},showAccountBanner:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},showBetaHeader:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},showDownloadMobileAppSlide:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},showNetworkBanner:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},showPermissionsTour:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},showTestnetMessageInDropdown:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},signatureSecurityAlertResponses:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},slides:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},snapsInstallPrivacyWarningShown:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},surveyLinkLastClickedOrClosed:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},shieldEndingToastLastClickedOrClosed:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},shieldPausedToastLastClickedOrClosed:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},termsOfUseLastAgreed:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},throttledOrigins:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},timeoutMinutes:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},trezorModel:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},updateModalLastDismissedAt:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},hasShownMultichainAccountsIntroModal:{persist:!0,includeInDebugSnapshot:!0,usedInUi:!0,includeInStateLogs:!0},showShieldEntryModalOnce:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},pendingShieldCohort:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!0,usedInUi:!0},pendingShieldCohortTxType:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},isWalletResetInProgress:{persist:!0,includeInDebugSnapshot:!0,usedInUi:!0,includeInStateLogs:!0},defaultSubscriptionPaymentOptions:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},shieldSubscriptionMetricsProps:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},dappSwapComparisonData:{includeInStateLogs:!1,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}};var T=new WeakMap,v=new WeakMap,S=new WeakMap,P=new WeakMap,I=new WeakMap,M=new WeakSet;class E extends o.BaseController{constructor({state:e={},messenger:t,onInactiveTimeout:n,extension:r}){super({name:"AppStateController",metadata:y,state:{activeQrCodeScanRequest:null,appActiveTab:undefined,browserEnvironment:{},connectedStatusPopoverHasBeenShown:!0,defaultHomeActiveTabName:null,enableEnforcedSimulations:!0,enableEnforcedSimulationsForTransactions:{},enforcedSimulationsSlippage:10,enforcedSimulationsSlippageForTransactions:{},fullScreenGasPollTokens:[],hadAdvancedGasFeesSetPriorToMigration92_3:!1,canTrackWalletFundsObtained:!0,isRampCardClosed:!1,isUpdateAvailable:!1,lastUpdatedAt:null,lastUpdatedFromVersion:null,lastViewedUserSurvey:null,newPrivacyPolicyToastClickedOrClosed:null,newPrivacyPolicyToastShownDate:null,pna25Acknowledged:!1,nftsDetectionNoticeDismissed:!1,notificationGasPollTokens:[],onboardingDate:null,outdatedBrowserWarningLastShown:null,popupGasPollTokens:[],sidePanelGasPollTokens:[],productTour:"accountIcon",recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:(new Date).getTime(),showAccountBanner:!0,showBetaHeader:(0,h.isBeta)(),showDownloadMobileAppSlide:!0,showNetworkBanner:!0,showPermissionsTour:!0,showTestnetMessageInDropdown:!0,slides:[],surveyLinkLastClickedOrClosed:null,shieldEndingToastLastClickedOrClosed:null,shieldPausedToastLastClickedOrClosed:null,throttledOrigins:{},timeoutMinutes:g.DEFAULT_AUTO_LOCK_TIME_LIMIT,trezorModel:null,updateModalLastDismissedAt:null,hasShownMultichainAccountsIntroModal:!1,showShieldEntryModalOnce:null,pendingShieldCohort:null,pendingShieldCohortTxType:null,isWalletResetInProgress:!1,dappSwapComparisonData:{},addressSecurityAlertResponses:{},currentExtensionPopupId:0,nftsDropdownState:{},signatureSecurityAlertResponses:{},networkConnectionBanner:{status:"unknown"},...e,addressSecurityAlertResponses:{},currentExtensionPopupId:0,nftsDropdownState:{},signatureSecurityAlertResponses:{},networkConnectionBanner:{status:"unknown"}},messenger:t}),function(e,t){b(e,t),t.add(e)}(this,M),f(this,T,void 0),f(this,v,void 0),f(this,S,void 0),p(this,"waitingForUnlock",void 0),f(this,P,void 0),f(this,I,null),p(this,"getAddressSecurityAlertResponse",e=>{const t=this.state.addressSecurityAlertResponses[e];if(!t)return undefined;const n=Date.now(),r=15*l.MINUTE;if(n-t.timestamp>r)return this.update(t=>{delete t.addressSecurityAlertResponses[e]}),undefined;const{timestamp:s,...a}=t;return a}),p(this,"addAddressSecurityAlertResponse",(e,t)=>{this.update(n=>{n.addressSecurityAlertResponses[e]={...t,timestamp:Date.now()}})}),C(T,this,r),C(v,this,n||(()=>undefined)),C(S,this,null),this.waitingForUnlock=[],t.subscribe("KeyringController:unlock",k(M,this,_).bind(this)),t.subscribe("PreferencesController:stateChange",({preferences:e})=>{const t=this.state;"number"==typeof(null==e?void 0:e.autoLockTimeLimit)&&t.timeoutMinutes!==e.autoLockTimeLimit&&k(M,this,j).call(this,e.autoLockTimeLimit)});const{preferences:s}=t.call("PreferencesController:getState");"number"==typeof s.autoLockTimeLimit&&k(M,this,j).call(this,s.autoLockTimeLimit),this.messenger.registerActionHandler("AppStateController:getUnlockPromise",this.getUnlockPromise.bind(this)),this.messenger.registerActionHandler("AppStateController:requestQrCodeScan",k(M,this,R).bind(this)),this.messenger.registerActionHandler("AppStateController:setCanTrackWalletFundsObtained",this.setCanTrackWalletFundsObtained.bind(this)),this.messenger.registerActionHandler("AppStateController:setPendingShieldCohort",this.setPendingShieldCohort.bind(this)),C(P,this,null)}getUnlockPromise(e){return new Promise(t=>{const{isUnlocked:n}=this.messenger.call("KeyringController:getState");n?t():k(M,this,A).call(this,t,e)})}setDefaultHomeActiveTabName(e){this.update(t=>{t.defaultHomeActiveTabName=e})}setConnectedStatusPopoverHasBeenShown(){this.update(e=>{e.connectedStatusPopoverHasBeenShown=!0})}setRecoveryPhraseReminderHasBeenShown(){this.update(e=>{e.recoveryPhraseReminderHasBeenShown=!0})}setSurveyLinkLastClickedOrClosed(e){this.update(t=>{t.surveyLinkLastClickedOrClosed=e})}setOnboardingDate(){this.update(e=>{e.onboardingDate=Date.now()})}setLastViewedUserSurvey(e){this.update(t=>{t.lastViewedUserSurvey=e})}setRampCardClosed(){this.update(e=>{e.isRampCardClosed=!0})}setNewPrivacyPolicyToastClickedOrClosed(){this.update(e=>{e.newPrivacyPolicyToastClickedOrClosed=!0})}setNewPrivacyPolicyToastShownDate(e){this.update(t=>{t.newPrivacyPolicyToastShownDate=e})}setPna25Acknowledged(e){this.update(t=>{t.pna25Acknowledged=e})}setShieldPausedToastLastClickedOrClosed(e){this.update(t=>{t.shieldPausedToastLastClickedOrClosed=e})}setShieldEndingToastLastClickedOrClosed(e){this.update(t=>{t.shieldEndingToastLastClickedOrClosed=e})}updateSlides(e){this.update(t=>{const n=t.slides||[],r=e.map(e=>{const t=n.find(t=>t.id===e.id);return t?{...t,...e}:e});t.slides=[...r]})}removeSlide(e){this.update(t=>{const n=t.slides||[];t.slides=n.map(t=>t.id===e?{...t,dismissed:!0}:t),e===m.DOWNLOAD_MOBILE_APP_SLIDE_ID&&(t.showDownloadMobileAppSlide=!1)})}setRecoveryPhraseReminderLastShown(e){this.update(t=>{t.recoveryPhraseReminderLastShown=e})}setTermsOfUseLastAgreed(e){this.update(t=>{t.termsOfUseLastAgreed=e})}setSnapsInstallPrivacyWarningShownStatus(e){this.update(t=>{t.snapsInstallPrivacyWarningShown=e})}setOutdatedBrowserWarningLastShown(e){this.update(t=>{t.outdatedBrowserWarningLastShown=e})}setLastActiveTime(){k(M,this,F).call(this)}setIsUpdateAvailable(e){this.update(t=>{t.isUpdateAvailable=e})}setUpdateModalLastDismissedAt(e){this.update(t=>{t.updateModalLastDismissedAt=e})}setLastUpdatedAt(e){this.update(t=>{t.lastUpdatedAt=e})}setLastUpdatedFromVersion(e){this.update(t=>{t.lastUpdatedFromVersion=e})}setBrowserEnvironment(e,t){this.update(n=>{n.browserEnvironment={os:e,browser:t}})}addPollingToken(e,t){t.toString()!==m.POLLING_TOKEN_ENVIRONMENT_TYPES[m.ENVIRONMENT_TYPE_BACKGROUND]&&k(M,this,N).call(this,t)&&k(M,this,x).call(this,e,t)}removePollingToken(e,t){if(t.toString()!==m.POLLING_TOKEN_ENVIRONMENT_TYPES[m.ENVIRONMENT_TYPE_BACKGROUND]){const n=this.state[t];k(M,this,N).call(this,t)&&this.update(r=>{r[t]=n.filter(t=>t!==e)})}}clearPollingTokens(){this.update(e=>{e.popupGasPollTokens=[],e.notificationGasPollTokens=[],e.fullScreenGasPollTokens=[],e.sidePanelGasPollTokens=[]})}setShowTestnetMessageInDropdown(e){this.update(t=>{t.showTestnetMessageInDropdown=e})}setShowBetaHeader(e){this.update(t=>{t.showBetaHeader=e})}setShowPermissionsTour(e){this.update(t=>{t.showPermissionsTour=e})}setHasShownMultichainAccountsIntroModal(e){this.update(t=>{t.hasShownMultichainAccountsIntroModal=e})}setProductTour(e){this.update(t=>{t.productTour=e})}setShowNetworkBanner(e){this.update(t=>{t.showNetworkBanner=e})}updateNetworkConnectionBanner(e){this.update(t=>{t.networkConnectionBanner=e})}setShowAccountBanner(e){this.update(t=>{t.showAccountBanner=e})}setCurrentExtensionPopupId(e){this.update(t=>{t.currentExtensionPopupId=e})}setTrezorModel(e){this.update(t=>{t.trezorModel=e})}updateNftDropDownState(e){this.update(t=>{t.nftsDropdownState=e})}getSignatureSecurityAlertResponse(e){return this.state.signatureSecurityAlertResponses[e]}addSignatureSecurityAlertResponse(e){e.securityAlertId&&this.update(t=>{t.signatureSecurityAlertResponses[String(e.securityAlertId)]=e})}setCurrentPopupId(e){this.update(t=>{t.currentPopupId=e})}getLastInteractedConfirmationInfo(){return this.state.lastInteractedConfirmationInfo}setLastInteractedConfirmationInfo(e){this.update(t=>{t.lastInteractedConfirmationInfo=e})}getCurrentPopupId(){return this.state.currentPopupId}getThrottledOriginState(e){return this.state.throttledOrigins[e]}updateThrottledOriginState(e,t){this.update(n=>{n.throttledOrigins[e]=t})}completeQrCodeScan(e){if(!w(I,this))throw new Error("No QR code scan is in progress.");this.update(e=>{e.activeQrCodeScanRequest=null}),w(I,this).resolve(e),C(I,this,null)}cancelQrCodeScan(e){if(!w(I,this))throw new Error("No QR code scan is in progress.");this.update(e=>{e.activeQrCodeScanRequest=null}),w(I,this).reject(e||new Error("Scan cancelled")),C(I,this,null)}setEnableEnforcedSimulations(e){this.update(t=>{t.enableEnforcedSimulations=e})}setEnableEnforcedSimulationsForTransaction(e,t){this.update(n=>{n.enableEnforcedSimulationsForTransactions[e]=t})}setEnforcedSimulationsSlippage(e){this.update(t=>{t.enforcedSimulationsSlippage=e})}setEnforcedSimulationsSlippageForTransaction(e,t){this.update(n=>{n.enforcedSimulationsSlippageForTransactions[e]=t})}setAppActiveTab(e){this.update(t=>{t.appActiveTab=e})}setShowShieldEntryModalOnce(e){this.update(t=>{t.showShieldEntryModalOnce=e})}setPendingShieldCohort(e,t){this.update(n=>{n.pendingShieldCohort=e,t!==undefined&&(n.pendingShieldCohortTxType=t)})}setCanTrackWalletFundsObtained(e){this.update(t=>{t.canTrackWalletFundsObtained=e})}setIsWalletResetInProgress(e){this.update(t=>{t.isWalletResetInProgress=e})}getIsWalletResetInProgress(){return this.state.isWalletResetInProgress}setDefaultSubscriptionPaymentOptions(e){this.update(t=>{t.defaultSubscriptionPaymentOptions=e})}setShieldSubscriptionMetricsProps(e){this.update(t=>{t.shieldSubscriptionMetricsProps=e})}deleteDappSwapComparisonData(e){this.update(t=>{var n;null===(n=t.dappSwapComparisonData)||void 0===n||delete n[e],t.dappSwapComparisonData={...t.dappSwapComparisonData}})}setDappSwapComparisonData(e,t){this.update(n=>{var r;n.dappSwapComparisonData={...n.dappSwapComparisonData,[e]:{...(null===(r=n.dappSwapComparisonData)||void 0===r?void 0:r[e])??{},...t}}})}getDappSwapComparisonData(e){var t;return(null===(t=this.state.dappSwapComparisonData)||void 0===t?void 0:t[e])??undefined}}function A(e,t){this.waitingForUnlock.push({resolve:e}),this.messenger.publish("AppStateController:unlockChange"),t&&k(M,this,O).call(this)}function _(){if(this.waitingForUnlock.length>0){for(;this.waitingForUnlock.length>0;){var e;null===(e=this.waitingForUnlock.shift())||void 0===e||e.resolve()}this.messenger.publish("AppStateController:unlockChange")}k(M,this,D).call(this)}function j(e){this.update(t=>{t.timeoutMinutes=e}),k(M,this,F).call(this)}function F(){const{timeoutMinutes:e}=this.state;if(w(S,this)?clearTimeout(w(S,this)):d.isManifestV3&&w(T,this).alarms.clear(u.AUTO_LOCK_TIMEOUT_ALARM),!e)return;const t=Number(e);d.isManifestV3?(w(T,this).alarms.create(u.AUTO_LOCK_TIMEOUT_ALARM,{delayInMinutes:t,periodInMinutes:t}),w(T,this).alarms.onAlarm.addListener(e=>{e.name===u.AUTO_LOCK_TIMEOUT_ALARM&&(w(v,this).call(this),w(T,this).alarms.clear(u.AUTO_LOCK_TIMEOUT_ALARM))})):C(S,this,setTimeout(()=>w(v,this).call(this),t*l.MINUTE))}function x(e,t){this.update(n=>{n[t].push(e)})}function N(e){return["popupGasPollTokens","notificationGasPollTokens","fullScreenGasPollTokens","sidePanelGasPollTokens"].includes(e)}function O(){w(P,this)||(C(P,this,(0,s.v4)()),this.messenger.call("ApprovalController:addRequest",{id:w(P,this),origin:m.ORIGIN_METAMASK,type:i.ApprovalType.Unlock},!0).catch(()=>{C(P,this,null)}))}function D(){if(w(P,this)){try{this.messenger.call("ApprovalController:acceptRequest",w(P,this))}catch(e){a.default.error("Failed to unlock approval request",e)}C(P,this,null)}}function R(e){if(w(I,this))return w(I,this).promise;const t=(0,c.createDeferredPromise)();return C(I,this,t),this.update(t=>{t.activeQrCodeScanRequest=e}),t.promise}n.AppStateController=E}}},{package:"$root$",file:"app/scripts/controllers/app-state-controller.ts"}],[22,{"../controllers/app-state-controller":219},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AppStateControllerInit=void 0;var r=e("../controllers/app-state-controller");n.AppStateControllerInit=({controllerMessenger:e,persistedState:t,setLocked:n,extension:s})=>({controller:new r.AppStateController({messenger:e,state:t.AppStateController,onInactiveTimeout:()=>n(),extension:s})})}}},{package:"$root$",file:"app/scripts/controller-init/app-state-controller-init.ts"}]],[],{});