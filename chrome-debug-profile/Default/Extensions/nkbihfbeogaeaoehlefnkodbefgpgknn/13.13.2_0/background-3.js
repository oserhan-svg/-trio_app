LavaPack.loadBundle([[280,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t,n){a(e,t),t.set(e,n)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function s(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ExtensionLazyListener=void 0;var o=new WeakMap,c=new WeakMap,l=new WeakSet;function u(e){setTimeout(()=>{for(const[t,n]of s(c,this))for(const[r,{args:a}]of n){const n=`ExtensionLazyListener: Possible memory leak detected. The event "${t}.${r}" has been listened to, but no application code has added a listener after ${e}ms. There are currently ${a.length} buffered calls. If you are a developer of this extension, please ensure that you have added a listener for this event. If you are a user of this extension, please report this warning to the developers of the extension.`;console.warn(n)}},e)}function d(e,t){return s(o,this)[e][t]}n.ExtensionLazyListener=class{constructor(e,t={},n=2e4){var p,m;a(p=this,m=l),m.add(p),r(this,o,void 0),r(this,c,new Map),function(e,t,n){e.set(i(e,t),n)}(o,this,e);for(const[e,n]of Object.entries(t)){const t=new Map;for(const r of n){const n=[],a=(...e)=>{n.push(e)};i(l,this,d).call(this,e,r).addListener(a),t.set(r,{listener:a,args:n})}s(c,this).set(e,t)}i(l,this,u).call(this,n)}addListener(e,t,n){const r=i(l,this,d).call(this,e,t);r.addListener(n);const a=s(c,this).get(e);if(a){const i=a.get(t);if(i){r.removeListener(i.listener),a.delete(t),0===a.size&&s(c,this).delete(e);const{args:o}=i;for(let l=0,{length:u}=o;l<u;l++)try{if(n(...o[l]),!r.hasListener(n)){const n=l+1;n!==u&&(o.splice(0,n),a.set(t,i),s(c,this).set(e,a),r.addListener(i.listener));break}}catch(n){const d=l+1;throw d!==u&&(o.splice(0,d),a.set(t,i),s(c,this).set(e,a),r.addListener(i.listener)),n}}}}once(e,t){return new Promise(n=>{const r=i(l,this,d).call(this,e,t),a=s(c,this).get(e);if(a){const i=a.get(t),o=null==i?void 0:i.args.length;if(o)return n(i.args.shift()),r.removeListener(i.listener),void(1===o&&(a.delete(t),0===a.size&&s(c,this).delete(e)))}const o=(...e)=>{r.removeListener(o),n(e)};r.addListener(o)})}}}}},{package:"$root$",file:"app/scripts/lib/extension-lazy-listener/extension-lazy-listener.ts"}],[281,{"@metamask/snaps-sdk":2788,"@metamask/snaps-utils":2902},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.forwardRequestToSnap=async function(e,t,n,s){const{method:i,params:o}=n,{handleRequest:c,snapId:l}=e;if(!l)throw new a.InternalError(`No snapId configured for method ${i}`);const u=s.get("origin");if(!u)throw new a.InternalError(`No origin specified for method ${i}`);return await c({snapId:l,origin:u,handler:r.HandlerType.OnRpcRequest,request:{jsonrpc:"2.0",method:i,params:o}})};var r=e("@metamask/snaps-utils"),a=e("@metamask/snaps-sdk")}}},{package:"$root$",file:"app/scripts/lib/forwardRequestToSnap.ts"}],[282,{lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return a((0,r.cloneDeep)(e),e=>null===e?"null":typeof e)};var r=e("lodash");function a(e={},t){return Object.entries(e).forEach(([n,r])=>{e[n]="object"==typeof r&&null!==r?a(r,t):t(r)}),e}}}},{package:"$root$",file:"app/scripts/lib/getObjStructure.js"}],[283,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hardwareKeyringBuilderFactory=function(e,t){const n=()=>new e({bridge:new t});return n.type=e.type,n}}}},{package:"$root$",file:"app/scripts/lib/hardware-keyring-builder-factory.ts"}],[284,{"@metamask/messenger":2239},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRootMessenger=n.ROOT_MESSENGER_NAMESPACE=void 0;var r=e("@metamask/messenger");const a=n.ROOT_MESSENGER_NAMESPACE="Root";n.getRootMessenger=()=>new r.Messenger({namespace:a})}}},{package:"$root$",file:"app/scripts/lib/messenger.ts"}],[286,{"../util":358},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPendingNonceMiddleware=function({getPendingNonce:e}){return async({request:t,context:n,next:r})=>{const{method:a,params:s}=t;if("eth_getTransactionCount"!==a)return r();const[i,o]=s;return"pending"!==o?r():await e(i,n.get("networkClientId"))}},n.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return async({request:t,next:n})=>{const{method:a,params:s}=t;if("eth_getTransactionByHash"!==a)return n();const[i]=s,o=e(i);return o?(0,r.formatTxMetaForRpcResult)(o):n()}};var r=e("../util")}}},{package:"$root$",file:"app/scripts/lib/middleware/pending.ts"}],[287,{events:4338,loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=s(e("events")),a=s(e("loglevel"));function s(e){return e&&e.__esModule?e:{default:e}}class i extends r.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort((e,t)=>e.version-t.version);const n=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||n&&n.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter(function(t){return t.version>e.meta.version});for(const n of t)try{a.default.info(`Running migration ${n.version}...`);const t=await n.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==n.version)throw new Error("Migrator - Migration did not update version number correctly");e=t,a.default.info(`Migration ${n.version} complete`)}catch(t){const r=t.message;return t.message=`MetaMask Migration Error #${n.version}: ${r}`,this.emit("error",t),e}return e}generateInitialState(e){return{data:e,meta:{version:this.defaultVersion}}}}n.default=i}}},{package:"$root$",file:"app/scripts/lib/migrator/index.js"}],[289,{"../../../../shared/constants/metametrics":5768,"../../../../shared/lib/network-utils":5863,"../../../../shared/lib/only-keep-host":5864,"./utils":290,"@metamask/utils":3070,loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.onRpcEndpointDegraded=function({chainId:e,endpointUrl:t,error:n,infuraProjectId:r,metaMetricsId:a,trackEvent:s}){u(i.MetaMetricsEventName.RpcServiceDegraded,{chainId:e,endpointUrl:t,error:n,infuraProjectId:r,metaMetricsId:a,trackEvent:s})},n.onRpcEndpointUnavailable=function({chainId:e,endpointUrl:t,error:n,infuraProjectId:r,metaMetricsId:a,trackEvent:s}){u(i.MetaMetricsEventName.RpcServiceUnavailable,{chainId:e,endpointUrl:t,error:n,infuraProjectId:r,metaMetricsId:a,trackEvent:s})},n.trackRpcEndpointEvent=u;var r,a=(r=e("loglevel"))&&r.__esModule?r:{default:r},s=e("@metamask/utils"),i=e("../../../../shared/constants/metametrics"),o=e("../../../../shared/lib/only-keep-host"),c=e("../../../../shared/lib/network-utils"),l=e("./utils");function u(e,{chainId:t,endpointUrl:n,error:r,infuraProjectId:u,trackEvent:d,metaMetricsId:p}){if(!(0,l.shouldCreateRpcServiceEvents)({error:r,metaMetricsId:p}))return;const m=(0,c.isPublicEndpointUrl)(n,u)?(0,o.onlyKeepHost)(n):"custom",f={chain_id_caip:`eip155:${(0,s.hexToNumber)(t)}`,rpc_domain:m,rpc_endpoint_url:m,...(0,s.isObject)(r)&&"httpStatus"in r&&(0,s.isValidJson)(r.httpStatus)?{http_status:r.httpStatus}:{}};a.default.debug(`Creating Segment event "${e}" with ${JSON.stringify(f)}`),d({category:i.MetaMetricsEventCategory.Network,event:e,properties:f})}}}},{package:"$root$",file:"app/scripts/lib/network-controller/messenger-action-handlers.ts"}],[29,{"../../lib/util":358,"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TokenRatesControllerInit=void 0;var r=e("@metamask/assets-controllers"),a=e("../../lib/util");n.TokenRatesControllerInit=e=>{const{controllerMessenger:t,initMessenger:n,persistedState:s}=e,i=n.call("PreferencesController:getState"),o=new r.TokenRatesController({messenger:t,state:s.TokenRatesController,tokenPricesService:new r.CodefiTokenPricesServiceV2,disabled:!i.useCurrencyRateCheck});return n.subscribe("PreferencesController:stateChange",(0,a.previousValueComparator)((e,t)=>{const{useCurrencyRateCheck:n}=e,{useCurrencyRateCheck:r}=t;return r&&!n?o.enable():!r&&n&&o.disable(),!0},i)),{controller:o}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/token-rates-controller-init.ts"}],[290,{"../../../../development/build/constants":593,"@metamask/network-controller":2299,"@metamask/remote-feature-flag-controller":2587},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PRODUCTION_LIKE_ENVIRONMENTS=void 0,n.shouldCreateRpcServiceEvents=function({error:e,metaMetricsId:t}){return(!e||!(0,r.isConnectionError)(e))&&t!==undefined&&null!==t&&function(e){if("production"===undefined)return!1;if(o.includes("production"))return(0,a.generateDeterministicRandomNumber)(e)<i;return!0}(t)};var r=e("@metamask/network-controller"),a=e("@metamask/remote-feature-flag-controller"),s=e("../../../../development/build/constants");const i=.01,o=n.PRODUCTION_LIKE_ENVIRONMENTS=[s.ENVIRONMENT.PRODUCTION,s.ENVIRONMENT.RELEASE_CANDIDATE]}}},{package:"$root$",file:"app/scripts/lib/network-controller/utils.ts"}],[291,{"../../../shared/constants/notifications":5773,"../platforms/extension":578,"@metamask/safe-event-emitter":2596},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.NOTIFICATION_MANAGER_EVENTS=void 0;var r=i(e("@metamask/safe-event-emitter")),a=i(e("../platforms/extension")),s=e("../../../shared/constants/notifications");function i(e){return e&&e.__esModule?e:{default:e}}const o=n.NOTIFICATION_MANAGER_EVENTS={POPUP_CLOSED:"onPopupClosed"};class c extends r.default{constructor(){super(),this.platform=new a.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(e,t){this._popupId=t,this._setCurrentPopupId=e;const n=await this._getPopup(t);if(n)await this.platform.focusWindow(n.id);else{let e=0,t=0;try{const n=await this.platform.getLastFocusedWindow();t=n.top,e=Math.max(n.left+(n.width-s.NOTIFICATION_WIDTH),0)}catch(n){const{screenX:r,screenY:a,outerWidth:i}=window;t=Math.max(a,0),e=Math.max(r+(i-s.NOTIFICATION_WIDTH),0)}const n=await this.platform.openWindow({url:"notification.html",type:"popup",width:s.NOTIFICATION_WIDTH,height:s.NOTIFICATION_HEIGHT,left:e,top:t});n.left!==e&&"fullscreen"!==n.state&&await this.platform.updateWindowPosition(n.id,e,t),this._setCurrentPopupId(n.id),this._popupId=n.id}}_onWindowClosed(e){e===this._popupId&&(this._setCurrentPopupId(undefined),this._popupId=undefined,this.emit(o.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find(e=>e&&"popup"===e.type&&e.id===this._popupId):null}}n.default=c}}},{package:"$root$",file:"app/scripts/lib/notification-manager.js"}],[292,{"../../../../shared/constants/offscreen-communication":5774,"eth-lattice-keyring":4243},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LatticeKeyringOffscreen=void 0;var r,a=(r=e("eth-lattice-keyring"))&&r.__esModule?r:{default:r},s=e("../../../../shared/constants/offscreen-communication");class i extends a.default{constructor(e={}){super(e)}async _getCreds(){try{if(this._hasCreds())return undefined;const e=this.appName?this.appName:"Unknown",t=`${s.KnownOrigins.lattice}?keyring=${e}&forceLogin=true`,n=await new Promise((e,n)=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.latticeOffscreen,params:{url:t}},t=>{chrome.runtime.lastError?n(chrome.runtime.lastError):null!=t&&t.error?n(t.error):e(null==t?void 0:t.result)})});if(null==n||!n.deviceID||null==n||!n.password)throw new Error("Invalid credentials returned from Lattice.");return n}catch(e){throw new Error(e)}}}n.LatticeKeyringOffscreen=i,function(e,t,n){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(i,"type",void 0),i.type=a.default.type}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/lattice-offscreen-keyring.ts"}],[293,{"../../../../shared/constants/offscreen-communication":5774,"@ledgerhq/errors":935},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerOffscreenBridge=void 0;var r=e("@ledgerhq/errors"),a=e("../../../../shared/constants/offscreen-communication");function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var c=new WeakSet;async function l(e,{timeout:t}={}){return new Promise((n,s)=>{let i;t&&(i=setTimeout(()=>{s(new Error("Ledger iframe timeout"))},t)),chrome.runtime.sendMessage({...e,target:a.OffscreenCommunicationTarget.ledgerOffscreen},e=>{if(clearTimeout(i),null!=e&&e.success)n(e.payload||e.success);else{var t;const n=null==e||null===(t=e.payload)||void 0===t?void 0:t.error;if(n&&"number"==typeof n.statusCode&&n.statusCode>0){const e=new r.TransportStatusError(n.statusCode);s(e)}else if(null!=n&&n.message){const e=new Error(n.message,{cause:n});s(e)}else s(new Error("Unknown Ledger error occurred"))}})})}n.LedgerOffscreenBridge=class{constructor(){s(this,c),i(this,"isDeviceConnected",!1)}init(){return chrome.runtime.onMessage.addListener(e=>{e.target===a.OffscreenCommunicationTarget.extension&&e.event===a.OffscreenCommunicationEvents.ledgerDeviceConnect&&(this.isDeviceConnected=!0)}),Promise.resolve()}destroy(){return Promise.resolve()}getOptions(){return Promise.resolve({})}setOptions(){return Promise.resolve()}attemptMakeApp(){return o(c,this,l).call(this,{action:a.LedgerAction.makeApp},{timeout:4e3})}updateTransportMethod(e){return o(c,this,l).call(this,{action:a.LedgerAction.updateTransport,params:{transportType:e}},{timeout:4e3})}getPublicKey(e){return o(c,this,l).call(this,{action:a.LedgerAction.getPublicKey,params:e})}deviceSignTransaction(e){return o(c,this,l).call(this,{action:a.LedgerAction.signTransaction,params:e})}deviceSignMessage(e){return o(c,this,l).call(this,{action:a.LedgerAction.signPersonalMessage,params:e})}deviceSignTypedData(e){return o(c,this,l).call(this,{action:a.LedgerAction.signTypedData,params:e})}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/ledger-offscreen-bridge.ts"}],[294,{"../../../../shared/constants/offscreen-communication":5774},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TrezorOffscreenBridge=void 0;var r=e("../../../../shared/constants/offscreen-communication");function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.TrezorOffscreenBridge=class{constructor(){a(this,"model",void 0),a(this,"minorVersion",void 0)}init(e){return chrome.runtime.onMessage.addListener(e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.trezorDeviceConnect&&(this.model=e.payload.model,this.minorVersion=e.payload.minorVersion)}),new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.init,params:e},()=>{t()})})}dispose(){return new Promise(e=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.dispose},()=>{e()})})}getPublicKey(e){return new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.getPublicKey,params:e},e=>{t(e)})})}ethereumSignTransaction(e){return new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTransaction,params:e},e=>{t(e)})})}ethereumSignMessage(e){return new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signMessage,params:e},e=>{t(e)})})}ethereumSignTypedData(e){return new Promise(t=>{chrome.runtime.sendMessage({target:r.OffscreenCommunicationTarget.trezorOffscreen,action:r.TrezorAction.signTypedData,params:e},e=>{t(e)})})}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/trezor-offscreen-bridge.ts"}],[295,{"webextension-polyfill":5741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.openUpdateTabAndReload=async function(e){try{await a.default.tabs.create({url:"https://metamask.io/updating",active:!0})}catch(e){console.error(e)}await e()};var r,a=(r=e("webextension-polyfill"))&&r.__esModule?r:{default:r}}}},{package:"$root$",file:"app/scripts/lib/open-update-tab-and-reload.ts"}],[296,{"../../../shared/lib/promise-with-resolvers":5865,lodash:4794,loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OperationSafener=void 0;var r,a=e("lodash"),s=(r=e("loglevel"))&&r.__esModule?r:{default:r},i=e("../../../shared/lib/promise-with-resolvers");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function l(e,t){return e.get(d(e,t))}function u(e,t,n){return e.set(d(e,t),n),n}function d(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var p=new WeakMap,m=new WeakMap;n.OperationSafener=class{constructor({op:e,wait:t,options:n}){c(this,p,void 0),c(this,m,null),o(this,"evacuate",()=>{if(l(m,this))return s.default.warn("already evacuating"),l(m,this);const e=l(p,this).flush();if(e){const{promise:t,resolve:n}=(0,i.withResolvers)();e.finally(n),u(m,this,t)}else u(m,this,Promise.resolve());return l(m,this)}),o(this,"execute",(...e)=>l(m,this)?(s.default.warn("evacuating, ignoring call to `execute`"),!1):(l(p,this).call(this,...e),!0));const r={mode:"exclusive"};u(p,this,(0,a.debounce)((...t)=>navigator.locks.request("operation-safener-lock",r,()=>e(...t)),t,n))}}}}},{package:"$root$",file:"app/scripts/lib/operation-safener.ts"}],[297,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function r(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBPPOMStorage=void 0;const s=async(e,t,n)=>{const r=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(r)).map(e=>e.toString(16).padStart(2,"0")).join("")!==n)throw new Error(`Checksum mismatch for key ${e}`)};var i=new WeakSet;function o(e){return new Promise((t,n)=>{const r=indexedDB.open(this.storeName,this.dbVersion);r.onerror=e=>{var t;n(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},r.onsuccess=n=>{const r=n.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(r)}})}n.IndexedDBPPOMStorage=class{constructor(e,t){r(this,i),a(this,"storeName",void 0),a(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,n="readonly"){return new Promise((r,a)=>{(function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")})(i,this,o).call(this,n).then(n=>{const s=n[e](t);s.onsuccess=async e=>{r(e)},s.onerror=t=>{var n;a(new Error(`Error in indexDB operation ${e}: ${null===(n=t.target)||void 0===n?void 0:n.error}`))}}).catch(e=>{a(e)})})}async read(e,t){var n;const r=null===(n=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===n||null===(n=n.result)||void 0===n?void 0:n.data;return await s(e,r,t),r}async write(e,t,n){await s(e,t,n),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map(([e,t])=>({name:e,chainId:t}))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[298,{"../../../../shared/constants/app":5753,"../../../../shared/constants/security-provider":5781,"../../../../shared/constants/transaction":5792,"../../../../shared/lib/trace":5873,"./ppom-util":299,"@metamask/controller-utils":1384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPPOMMiddleware=function(e,t,n,u,d,p,m){return async(f,h,g)=>{try{const{securityAlertsEnabled:h}=t.state,{chainId:g}=n.getNetworkConfigurationByNetworkClientId(f.networkClientId)??{};if(!g)throw Error("ChainID not found for networkClientId");if(!h||!l.includes(f.method))return;const y=f.params[0];if("string"==typeof y){const{isSIWEMessage:e}=(0,r.detectSIWE)({data:y});if(e)return}else if(f.method===a.MESSAGE_TYPE.ETH_SEND_TRANSACTION){const{to:e}=y??{},t=d.listAccounts();if(t.some(({address:t})=>(null==t?void 0:t.toLowerCase())===(null==e?void 0:e.toLowerCase())))return}const w=(0,c.generateSecurityAlertId)();(0,i.trace)({name:i.TraceName.PPOMValidation,parentContext:f.traceContext},()=>(0,c.validateRequestWithPPOM)({ppomController:e,request:f,securityAlertId:w,chainId:g,updateSecurityAlertResponse:p,getSecurityAlertsConfig:m}));const v={...o.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:w};s.SIGNING_METHODS.includes(f.method)&&u.addSignatureSecurityAlertResponse(v),f.securityAlertResponse=v}catch(e){f.securityAlertResponse=(0,c.handlePPOMError)(e,"Error createPPOMMiddleware: ")}finally{g()}}};var r=e("@metamask/controller-utils"),a=e("../../../../shared/constants/app"),s=e("../../../../shared/constants/transaction"),i=e("../../../../shared/lib/trace"),o=e("../../../../shared/constants/security-provider"),c=e("./ppom-util");const l=Object.freeze(["eth_sendRawTransaction","eth_sendTransaction",...s.SIGNING_METHODS])}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-middleware.ts"}],[299,{"../../../../shared/constants/app":5753,"../../../../shared/constants/security-provider":5781,"../../../../shared/constants/transaction":5792,"../../../../shared/lib/snaps/snaps":5868,"../../../../shared/modules/transaction.utils":5919,"../../../../shared/modules/typed-signature":5920,"./security-alerts-api":301,"@metamask/snaps-utils":2902,"@metamask/transaction-controller":2989,"@metamask/utils":3070,lodash:4794,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateSecurityAlertId=function(){return(0,s.v4)()},n.handlePPOMError=w,n.normalizeSignatureRequest=v,n.updateSecurityAlertResponse=async function({appStateController:e,messenger:t,method:n,securityAlertId:r,securityAlertResponse:a,signatureController:s,transactionController:i}){if(u.SIGNING_METHODS.includes(n)){const n=await async function(e,t,n){const r=e=>Object.values(e.signatureRequests).find(e=>{var n;return(null===(n=e.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===t});return new Promise(a=>{const s=r(e.state);if(s)return void a(s);const i=e=>{const t=r(e);t&&(h("Found signature request",t),n.unsubscribe("SignatureController:stateChange",i),a(t))};h("Waiting for signature request",t),n.subscribe("SignatureController:stateChange",i)})}(s,r,t);return e.addSignatureSecurityAlertResponse({...a,securityAlertId:r}),n}const o=await async function(e,t,n){const r=e=>{var n;return(null===(n=e.securityAlertResponse)||void 0===n?void 0:n.securityAlertId)===t};return new Promise(a=>{const s=e.state.transactions.find(r);if(s)return void a(s);const i=e=>{r(e)&&(h("Found transaction metadata",e),n.unsubscribe("TransactionController:unapprovedTransactionAdded",i),a(e))};h("Waiting for transaction metadata",t),n.subscribe("TransactionController:unapprovedTransactionAdded",i)})}(i,r,t);return i.updateSecurityAlertResponse(o.id,{...a,securityAlertId:r}),o},n.validateRequestWithPPOM=async function({ppomController:e,request:t,securityAlertId:n,chainId:a,updateSecurityAlertResponse:s,getSecurityAlertsConfig:o}){try{const l=function(e,t){let n=(0,i.cloneDeep)(e);n=v(n,t),n=function(e,t){if(e.method!==m.MESSAGE_TYPE.ETH_SEND_TRANSACTION)return e;if(!Array.isArray(e.params)||!e.params[0])return e;const n=e.params[0];n.gas=t.txParams.gas,n.gasPrice=t.txParams.maxFeePerGas??t.txParams.gasPrice,delete n.gasLimit,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas,delete n.type;const a=(0,r.normalizeTransactionParams)(n);return h("Normalized transaction params",a),{...e,params:[a]}}(n,t);const{delegationMock:a,id:s,jsonrpc:o,method:c,origin:l,params:u}=n;return{delegationMock:a,id:s,jsonrpc:o,method:c,origin:l,params:u}}(t,await s(t.method,n,c.LOADING_SECURITY_ALERT_RESPONSE));h("Normalized request",l);const u=(0,f.isSecurityAlertsAPIEnabled)()?await async function(e,t,n,r){try{return{...await(0,f.validateWithSecurityAlertsAPI)(t,n,r),source:c.SecurityAlertSource.API}}catch(r){return w(r,"Error validating request with security alerts API"),await b(e,n,t)}}(e,a,l,o):await b(e,l,a);await s(t.method,n,u)}catch(e){h("Error",e),await s(t.method,n,w(e,"Error validating JSON RPC using PPOM: "))}};var r=e("@metamask/transaction-controller"),a=e("@metamask/utils"),s=e("uuid"),i=e("lodash"),o=e("@metamask/snaps-utils"),c=e("../../../../shared/constants/security-provider"),l=e("../../../../shared/lib/snaps/snaps"),u=e("../../../../shared/constants/transaction"),d=e("../../../../shared/modules/typed-signature"),p=e("../../../../shared/modules/transaction.utils"),m=e("../../../../shared/constants/app"),f=e("./security-alerts-api");const h=(0,a.createProjectLogger)("ppom-util"),{sentry:g}=global,y={result_type:c.BlockaidResultType.Errored,reason:c.BlockaidReason.errored};function w(e,t,n=c.SecurityAlertSource.API){const r=function(e){if("object"==typeof e||"string"==typeof e)return e;return JSON.stringify(e)}(e),a=function(e){if(e instanceof Error)return`${e.name}: ${e.message}`;return JSON.stringify(e)}(e);return n===c.SecurityAlertSource.Local&&(null==g||g.captureException(e)),console.error(t,r),{...y,description:a,source:n}}function v(e,t){var n;if(e.method!==m.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3&&e.method!==m.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4)return e;if(!Array.isArray(e.params)||!e.params[1])return e;const r=(0,p.parseTypedDataMessage)(e.params[1]),a=(0,d.sanitizeMessageRecursively)(r.message,r.types,r.primaryType);let s=e.origin;if(t&&"decodedPermission"in t&&null!==(n=t.decodedPermission)&&void 0!==n&&n.origin){const n=(0,o.isSnapId)(e.origin),r=n&&(0,l.isSnapPreinstalled)(e.origin);n&&r&&(s=t.decodedPermission.origin)}return{...e,origin:s,params:[e.params[0],JSON.stringify({...r,message:a})]}}async function b(e,t,n){try{return{...await e.usePPOM(e=>e.validateJsonRpc(t),n),source:c.SecurityAlertSource.Local}}catch(e){return w(e,"Error validating request with PPOM controller",c.SecurityAlertSource.Local)}}}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-util.ts"}],[30,{"../../../shared/constants/bridge":5755,"../../../shared/constants/time":5790,"../../../shared/lib/fetch-with-cache":5847,"../../../shared/lib/trace":5873,"../lib/util":358,"@metamask/bridge-controller":1318,"@metamask/controller-utils":1384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeControllerInit=void 0;var r,a=e("@metamask/bridge-controller"),s=e("@metamask/controller-utils"),i=e("../../../shared/constants/bridge"),o=e("../../../shared/lib/trace"),c=(r=e("../../../shared/lib/fetch-with-cache"))&&r.__esModule?r:{default:r},l=e("../../../shared/constants/time"),u=e("../lib/util");n.BridgeControllerInit=({controllerMessenger:e,initMessenger:t,getController:n})=>{const r=n("TransactionController");return{persistedStateKey:null,memStateKey:null,controller:new a.BridgeController({messenger:e,clientId:a.BridgeClientId.EXTENSION,clientVersion:"13.13.2",getLayer1GasFee:(...e)=>r.getLayer1GasFee(...e),fetchFn:async(e,t)=>{const n=e.toString();if(n.includes("getTokens"))return await(0,c.default)({url:n,fetchOptions:{method:"GET",...t},cacheOptions:{cacheRefreshTime:10*l.MINUTE},functionName:"fetchBridgeTokens"});if(n.includes("spot-prices"))return await(0,c.default)({url:n,fetchOptions:{method:"GET",...t},cacheOptions:{cacheRefreshTime:30*l.SECOND},functionName:"fetchAssetExchangeRates"});if(n.includes("getQuote?"))return await(0,s.handleFetch)(e,{method:"GET",...t});const r=await fetch(e,t);if(!r.ok)throw new s.HttpError(r.status,`Fetch failed with status '${r.status}' for request ${n}`);return r},trackMetaMetricsFn:(e,n)=>{const r=(Date.now()+Math.random()).toString();t.call("MetaMetricsController:trackEvent",{category:a.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY,event:e,properties:{...n??{},environmentType:(0,u.getEnvironmentType)(),actionId:r}})},traceFn:(...e)=>(0,o.trace)(...e),config:{customBridgeApiBaseUrl:i.BRIDGE_API_BASE_URL}})}}}}},{package:"$root$",file:"app/scripts/controller-init/bridge-controller-init.ts"}],[300,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){let r;Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.PPOM=void 0,n.initSync=function(e){if(r!==undefined)return r;const t=S();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const n=new WebAssembly.Instance(e,t);return A(n,e)},n.main=function(){r.main()};const a="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&a.decode();let s=null;function i(){return null!==s&&0!==s.byteLength||(s=new Uint8Array(r.memory.buffer)),s}function o(e,t){return e>>>=0,a.decode(i().subarray(e,e+t))}const c=new Array(128).fill(undefined);c.push(undefined,null,!0,!1);let l=c.length;function u(e){l===c.length&&c.push(c.length+1);const t=l;return l=c[t],c[t]=e,t}function d(e){return c[e]}function p(e){const t=d(e);return function(e){e<132||(c[e]=l,l=e)}(e),t}let m=0;const f="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},h="function"==typeof f.encodeInto?function(e,t){return f.encodeInto(e,t)}:function(e,t){const n=f.encode(e);return t.set(n),{read:e.length,written:n.length}};function g(e,t,n){if(n===undefined){const n=f.encode(e),r=t(n.length,1)>>>0;return i().subarray(r,r+n.length).set(n),m=n.length,r}let r=e.length,a=t(r,1)>>>0;const s=i();let o=0;for(;o<r;o++){const t=e.charCodeAt(o);if(t>127)break;s[a+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),a=n(a,r,r=o+3*e.length,1)>>>0;const t=i().subarray(a+o,a+r);o+=h(e,t).written}return m=o,a}let y=null;function w(){return null!==y&&0!==y.byteLength||(y=new Int32Array(r.memory.buffer)),y}function v(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=v(e[0]));for(let r=1;r<t;r++)n+=", "+v(e[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(!(n.length>1))return toString.call(e);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:r}function b(e,t,n){r.wasm_bindgen__convert__closures__invoke1_mut(e,t,u(n))}function T(e,t){r._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__destroy(e,t)}let k=null;function _(e,t){const n=t(4*e.length,4)>>>0,a=(null!==k&&0!==k.byteLength||(k=new Uint32Array(r.memory.buffer)),k);for(let t=0;t<e.length;t++)a[n/4+t]=u(e[t]);return m=e.length,n}function E(e,t){try{return e.apply(this,t)}catch(e){r.__wbindgen_exn_store(u(e))}}class P{static __wrap(e){e>>>=0;const t=Object.create(P.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_ppom_free(e)}static new(e,t){const n=_(t,r.__wbindgen_malloc),a=m;return p(r.ppom_new(u(e),n,a))}validateJsonRpc(e){return p(r.ppom_validateJsonRpc(this.__wbg_ptr,u(e)))}static version(){return p(r.ppom_version())}}function S(){const e={wbg:{}};return e.wbg.__wbg_buffer_085ec1f694018c4f=function(e){return u(d(e).buffer)},e.wbg.__wbg_call_01734de55d61e11d=function(){return E(function(e,t,n){return u(d(e).call(d(t),d(n)))},arguments)},e.wbg.__wbg_call_4c92f6aec1e1d6e6=function(){return E(function(e,t,n,r){return u(d(e).call(d(t),d(n),d(r)))},arguments)},e.wbg.__wbg_from_d7c216d4616bb368=function(e){return u(Array.from(d(e)))},e.wbg.__wbg_get_44be0491f933a435=function(e,t){return u(d(e)[t>>>0])},e.wbg.__wbg_length_72e2208bbc0efc61=function(e){return d(e).length},e.wbg.__wbg_length_d813e535247d427e=function(e){return d(e).length},e.wbg.__wbg_length_fff51ee6522a1a18=function(e){return d(e).length},e.wbg.__wbg_new_43f1b47c28813cbd=function(e,t){try{var n={a:e,b:t};const a=new Promise((e,t)=>{const a=n.a;n.a=0;try{return function(e,t,n,a){r.wasm_bindgen__convert__closures__invoke2_mut(e,t,u(n),u(a))}(a,n.b,e,t)}finally{n.a=a}});return u(a)}finally{n.a=n.b=0}},e.wbg.__wbg_new_8125e318e6245eed=function(e){return u(new Uint8Array(d(e)))},e.wbg.__wbg_parse_670c19d4e984792e=function(){return E(function(e,t){return u(JSON.parse(o(e,t)))},arguments)},e.wbg.__wbg_ppom_new=function(e){return u(P.__wrap(e))},e.wbg.__wbg_resolve_53698b95aaf7fcf8=function(e){return u(Promise.resolve(d(e)))},e.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){d(e).set(d(t),n>>>0)},e.wbg.__wbg_stringify_e25465938f3f611f=function(){return E(function(e){return u(JSON.stringify(d(e)))},arguments)},e.wbg.__wbg_then_b2267541e2a73865=function(e,t,n){return u(d(e).then(d(t),d(n)))},e.wbg.__wbg_then_f7e06ee3c11698eb=function(e,t){return u(d(e).then(d(t)))},e.wbg.__wbindgen_cb_drop=function(e){const t=p(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},e.wbg.__wbindgen_closure_wrapper_wasm_bindgen__closure__Closure_T___wrap__breaks_if_inlined=function(e,t,n){const r=function(e,t,n,r){const a={a:e,b:t,cnt:1},s=(...e)=>{a.cnt++;const t=a.a;a.a=0;try{return r(t,a.b,...e)}finally{0===--a.cnt?n(t,a.b):a.a=t}};return s.original=a,s}(e,t,T,b);return u(r)},e.wbg.__wbindgen_debug_string=function(e,t){const n=g(v(d(t)),r.__wbindgen_malloc,r.__wbindgen_realloc),a=m;w()[e/4+1]=a,w()[e/4+0]=n},e.wbg.__wbindgen_error_new=function(e,t){return u(new Error(o(e,t)))},e.wbg.__wbindgen_is_undefined=function(e){return d(e)===undefined},e.wbg.__wbindgen_memory=function(){return u(r.memory)},e.wbg.__wbindgen_object_drop_ref=function(e){p(e)},e.wbg.__wbindgen_string_get=function(e,t){const n=d(t),a="string"==typeof n?n:undefined;var s,i=(s=a)===undefined||null===s?0:g(a,r.__wbindgen_malloc,r.__wbindgen_realloc),o=m;w()[e/4+1]=o,w()[e/4+0]=i},e.wbg.__wbindgen_string_new=function(e,t){return u(o(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(o(e,t))},e}function A(e,t){return r=e.exports,C.__wbindgen_wasm_module=t,y=null,k=null,s=null,r.__wbindgen_start(),r}async function C(e){if(r!==undefined)return r;const t=S();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:a}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return A(n,a)}n.PPOM=P;n.default=C}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom.js"}],[3018,{"./actions/update-payment-token.cjs":3019,"./constants.cjs":3020,"./helpers/QuoteRefresher.cjs":3021,"./utils/quotes.cjs":3035,"./utils/source-amounts.cjs":3037,"./utils/transaction.cjs":3041,"@metamask/base-controller":1311,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayController=void 0;const d=e("@metamask/base-controller"),p=e("lodash"),m=e("./actions/update-payment-token.cjs"),f=e("./constants.cjs"),h=e("./helpers/QuoteRefresher.cjs"),g=e("./utils/quotes.cjs"),y=e("./utils/source-amounts.cjs"),w=e("./utils/transaction.cjs"),v={transactionData:{includeInDebugSnapshot:!1,includeInStateLogs:!0,persist:!1,usedInUi:!0}};class b extends d.BaseController{constructor({getDelegationTransaction:e,getStrategy:t,messenger:n,state:d}){super({name:f.CONTROLLER_NAME,metadata:v,messenger:n,state:{transactionData:{},...d}}),r.add(this),a.set(this,void 0),s.set(this,void 0),l(this,a,e,"f"),l(this,s,t,"f"),u(this,r,"m",c).call(this),(0,w.pollTransactionChanges)(n,u(this,r,"m",o).bind(this),u(this,r,"m",i).bind(this)),new h.QuoteRefresher({messenger:n,updateTransactionData:u(this,r,"m",o).bind(this)})}updatePaymentToken(e){(0,m.updatePaymentToken)(e,{messenger:this.messenger,updateTransactionData:u(this,r,"m",o).bind(this)})}}n.TransactionPayController=b,a=new WeakMap,s=new WeakMap,r=new WeakSet,i=function(e){this.update(t=>{delete t.transactionData[e]})},o=function e(t,n){let a=!1;this.update(e=>{const{transactionData:r}=e;let s=r[t];const i=s?.paymentToken,o=s?.tokens;s||(r[t]={isLoading:!1,tokens:[]},s=r[t]),n(s);const c=s.paymentToken!==i,l=s.tokens!==o;(c||l)&&((0,y.updateSourceAmounts)(t,s,this.messenger),a=!0)}),a&&(0,g.updateQuotes)({messenger:this.messenger,transactionData:this.state.transactionData[t],transactionId:t,updateTransactionData:u(this,r,"m",e).bind(this)}).catch(p.noop)},c=function(){this.messenger.registerActionHandler("TransactionPayController:getDelegationTransaction",u(this,a,"f").bind(this)),this.messenger.registerActionHandler("TransactionPayController:getStrategy",u(this,s,"f")??(()=>f.TransactionPayStrategy.Relay)),this.messenger.registerActionHandler("TransactionPayController:updatePaymentToken",this.updatePaymentToken.bind(this))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/TransactionPayController.cjs"}],[3019,{"../logger.cjs":3024,"../utils/token.cjs":3039,"../utils/transaction.cjs":3041,"@metamask/utils":3070,"bignumber.js":3042},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updatePaymentToken=void 0;const r=e("@metamask/utils"),a=e("bignumber.js"),s=e("../logger.cjs"),i=e("../utils/token.cjs"),o=e("../utils/transaction.cjs"),c=(0,r.createModuleLogger)(s.projectLogger,"update-payment-token");n.updatePaymentToken=function(e,t){const{transactionId:n,tokenAddress:r,chainId:s}=e,{messenger:l,updateTransactionData:u}=t,d=(0,o.getTransaction)(n,l);if(!d)throw new Error("Transaction not found");const p=function({chainId:e,from:t,messenger:n,tokenAddress:r}){const{decimals:s,symbol:o}=(0,i.getTokenInfo)(n,r,e)??{};if(s===undefined||!o)return undefined;const c=(0,i.getTokenFiatRate)(n,r,e);if(c===undefined)return undefined;const l=(0,i.getTokenBalance)(n,t,e,r),u=new a.BigNumber(l),d=new a.BigNumber(l).shiftedBy(-s),p=u.toFixed(0),m=d.toString(10),f=d.multipliedBy(c.fiatRate).toString(10),h=d.multipliedBy(c.usdRate).toString(10);return{address:r,balanceFiat:f,balanceHuman:m,balanceRaw:p,balanceUsd:h,chainId:e,decimals:s,symbol:o}}({chainId:s,from:d?.txParams.from,messenger:l,tokenAddress:r});if(!p)throw new Error("Payment token not found");c("Updated payment token",{transactionId:n,paymentToken:p}),u(n,e=>{e.paymentToken=p})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/actions/update-payment-token.cjs"}],[302,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.qrKeyringBuilderFactory=function(e,t,n){const r=()=>new e({bridge:new t(n)});return r.type=e.type,r}}}},{package:"$root$",file:"app/scripts/lib/qr-keyring-builder-factory.ts"}],[3020,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayStrategy=n.POLYGON_USDCE_ADDRESS=n.ARBITRUM_USDC_ADDRESS=n.NATIVE_TOKEN_ADDRESS=n.CHAIN_ID_POLYGON=n.CHAIN_ID_ARBITRUM=n.CONTROLLER_NAME=void 0,n.CONTROLLER_NAME="TransactionPayController",n.CHAIN_ID_ARBITRUM="0xa4b1",n.CHAIN_ID_POLYGON="0x89",n.NATIVE_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000",n.ARBITRUM_USDC_ADDRESS="0xaf88d065e77c8cC2239327C5EDb3A432268e5831",n.POLYGON_USDCE_ADDRESS="0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",function(e){e.Bridge="bridge",e.Relay="relay",e.Test="test"}(r||(n.TransactionPayStrategy=r={}))}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/constants.cjs"}],[3021,{"../logger.cjs":3024,"../utils/quotes.cjs":3035,"@metamask/utils":3070,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,p,m,f=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.QuoteRefresher=void 0;const g=e("@metamask/utils"),y=e("lodash"),w=e("../logger.cjs"),v=e("../utils/quotes.cjs"),b=(0,g.createModuleLogger)(w.projectLogger,"quote-refresh");n.QuoteRefresher=class{constructor({messenger:e,updateTransactionData:t}){r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),f(this,i,e,"f"),f(this,a,!1,"f"),f(this,s,!1,"f"),f(this,c,t,"f"),e.subscribe("TransactionPayController:stateChange",h(this,r,"m",m).bind(this))}},a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,r=new WeakSet,l=function(){f(this,a,!0,"f"),b("Started"),h(this,s,"f")||h(this,r,"m",p).call(this)},u=function(){h(this,o,"f")&&clearTimeout(h(this,o,"f")),f(this,a,!1,"f"),b("Stopped")},d=async function(){f(this,s,!0,"f");try{await(0,v.refreshQuotes)(h(this,i,"f"),h(this,c,"f"))}catch(e){b("Error refreshing quotes",e)}finally{f(this,s,!1,"f"),h(this,r,"m",p).call(this)}},p=function(){h(this,a,"f")&&(h(this,o,"f")&&clearTimeout(h(this,o,"f")),f(this,o,setTimeout(()=>{h(this,r,"m",d).call(this).catch(y.noop)},1e3),"f"))},m=function(e){const t=Object.values(e.transactionData).some(e=>Boolean(e.quotes?.length));t&&!h(this,a,"f")?h(this,r,"m",l).call(this):!t&&h(this,a,"f")&&h(this,r,"m",u).call(this)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/QuoteRefresher.cjs"}],[3022,{"../logger.cjs":3024,"../utils/strategy.cjs":3038,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=void 0;const u=e("@metamask/utils"),d=e("../logger.cjs"),p=e("../utils/strategy.cjs"),m=(0,u.createModuleLogger)(d.projectLogger,"pay-publish-hook"),f={transactionHash:undefined};n.TransactionPayPublishHook=class{constructor({isSmartTransaction:e,messenger:t}){r.add(this),a.set(this,void 0),s.set(this,void 0),c(this,a,e,"f"),c(this,s,t,"f")}getHook(){return l(this,r,"m",i).bind(this)}},a=new WeakMap,s=new WeakMap,r=new WeakSet,i=async function(e,t){try{return await l(this,r,"m",o).call(this,e,t)}catch(e){throw m("Error",e),e}},o=async function(e,t){const{id:n}=e,r=l(this,s,"f").call("TransactionPayController:getState"),i=r.transactionData?.[n]?.quotes??[];if(!i?.length)return m("Skipping as no quotes found"),f;const o=(0,p.getStrategy)(l(this,s,"f"),e);return await o.execute({isSmartTransaction:l(this,a,"f"),quotes:i,messenger:l(this,s,"f"),transaction:e})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/TransactionPayPublishHook.cjs"}],[3023,{"./TransactionPayController.cjs":3018,"./constants.cjs":3020,"./helpers/TransactionPayPublishHook.cjs":3022},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=n.TransactionPayController=n.TransactionPayStrategy=void 0;var r=e("./constants.cjs");Object.defineProperty(n,"TransactionPayStrategy",{enumerable:!0,get:function(){return r.TransactionPayStrategy}});var a=e("./TransactionPayController.cjs");Object.defineProperty(n,"TransactionPayController",{enumerable:!0,get:function(){return a.TransactionPayController}});var s=e("./helpers/TransactionPayPublishHook.cjs");Object.defineProperty(n,"TransactionPayPublishHook",{enumerable:!0,get:function(){return s.TransactionPayPublishHook}})}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/index.cjs"}],[3024,{"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),n.projectLogger=(0,r.createProjectLogger)("transaction-pay-controller")}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/logger.cjs"}],[3025,{"./bridge-quotes.cjs":3026,"./bridge-submit.cjs":3027},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeStrategy=void 0;const r=e("./bridge-quotes.cjs"),a=e("./bridge-submit.cjs");n.BridgeStrategy=class{async getQuotes(e){return(0,r.getBridgeQuotes)(e)}async getBatchTransactions(e){return(0,r.getBridgeBatchTransactions)(e)}async getRefreshInterval(e){return(0,r.getBridgeRefreshInterval)(e)}async execute(e){const{isSmartTransaction:t,quotes:n,messenger:r,transaction:s}=e,i=s.txParams.from;return await(0,a.submitBridgeQuotes)({from:i,isSmartTransaction:t,messenger:r,quotes:n,transaction:s}),{transactionHash:undefined}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/BridgeStrategy.cjs"}],[3026,{"../../index.cjs":3023,"../../logger.cjs":3024,"../../utils/gas.cjs":3034,"../../utils/token.cjs":3039,"@metamask/bridge-controller":1318,"@metamask/controller-utils":1384,"@metamask/transaction-controller":2989,"@metamask/utils":3070,"bignumber.js":3042,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuote=n.getBridgeRefreshInterval=n.getBridgeBatchTransactions=n.getBridgeQuotes=void 0;const r=e("@metamask/bridge-controller"),a=e("@metamask/controller-utils"),s=e("@metamask/transaction-controller"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("lodash"),l=e("../../index.cjs"),u=e("../../logger.cjs"),d=e("../../utils/gas.cjs"),p=e("../../utils/token.cjs"),m="All quotes under minimum",f=new Map([[s.TransactionType.perpsDeposit,r.FeatureId.PERPS]]),h=(0,i.createModuleLogger)(u.projectLogger,"bridge-strategy");function g(e){return{data:e.data,gas:e.gasLimit?(0,a.toHex)(e.gasLimit):undefined,isAfter:!1,to:e.to,value:e.value}}async function y(e,t,n){const{from:r,slippage:s,sourceChainId:i,sourceTokenAddress:l,sourceTokenAmount:u,targetChainId:d,targetTokenAddress:p}=e,{type:g}=n,y=f.get(g),w={destChainId:d,destTokenAddress:(0,a.toChecksumHexAddress)(p),destWalletAddress:r,gasIncluded:!1,gasIncluded7702:!1,insufficientBal:!1,slippage:100*s,srcChainId:i,srcTokenAddress:(0,a.toChecksumHexAddress)(l),srcTokenAmount:u,walletAddress:r},v=await t.call("BridgeController:fetchQuotes",w,undefined,y);if(!v.length)throw new Error("No quotes found");const b=function(e,t){const n=(0,c.orderBy)(e,e=>e.estimatedProcessingTimeInSeconds,"asc").slice(0,3),r=n.filter(e=>new o.BigNumber(e.quote.minDestTokenAmount).isGreaterThanOrEqualTo(t.targetAmountMinimum));if(h("Finding best quote",{allQuotes:e,fastestQuotes:n,quotesOverMinimumTarget:r}),!r.length)throw new Error(m);return(0,c.orderBy)(r,e=>(0,o.BigNumber)(e.quote.minDestTokenAmount).toNumber(),"desc")[0]}(v,e);return{...b,request:e}}function w(e,t,n,r){const a=new o.BigNumber(e).shiftedBy(-t),s=a.toString(10),i=a.multipliedBy(r).toString(10);return{fiat:a.multipliedBy(n).toString(10),human:s,raw:e,usd:i}}function v(e,t,{isMax:n=!1}={}){const{approval:r,trade:a}=e,s=r?b(r,t,{isMax:n}):{fiat:"0",human:"0",raw:"0",usd:"0"},i=b(a,t,{isMax:n});return{fiat:new o.BigNumber(s.fiat).plus(i.fiat).toString(10),human:new o.BigNumber(s.human).plus(i.human).toString(10),raw:new o.BigNumber(s.raw).plus(i.raw).toString(10),usd:new o.BigNumber(s.usd).plus(i.usd).toString(10)}}function b(e,t,{isMax:n}){const{effectiveGas:r,gasLimit:a}=e,s=n?undefined:r;return(0,d.calculateGasCost)({...e,gas:s||a||"0x0",messenger:t,isMax:n})}n.getBridgeQuotes=async function(e){h("Fetching quotes",e);const{requests:t,messenger:n,transaction:r}=e;try{const a=function(e,t){const n=function(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay;return{attemptsMax:t?.attemptsMax??5,bufferInitial:t?.bufferInitial??.04,bufferStep:t?.bufferStep??.04,bufferSubsequent:t?.bufferSubsequent??.05,slippage:t?.slippage??.005}}(t);return e.map(e=>({...e,...n})).map((t,n)=>{const r=0===n,a=r?t.attemptsMax:1,s=e.reduce((e,a,s)=>{const i=a.sourceTokenAddress.toLowerCase()===t.sourceTokenAddress.toLowerCase()&&a.sourceChainId===t.sourceChainId;return r&&s>n&&i?e.minus(a.sourceTokenAmount):e},new o.BigNumber(t.sourceBalanceRaw)).toFixed(0);return{...t,attemptsMax:a,sourceBalanceRaw:s}})}(t,n),s=await Promise.all(a.map((t,n)=>async function(e,t,n){const{attemptsMax:r,bufferInitial:a,bufferStep:s,bufferSubsequent:i,sourceBalanceRaw:c,sourceTokenAmount:l,targetAmountMinimum:u,targetTokenAddress:d}=e,p=new o.BigNumber(l),f=0===t?a:i,g=p.div(1+f),w=Date.now();let v=l;for(let t=0;t<r;t++){const i={...e,sourceTokenAmount:v};try{h("Attempt",{attempt:t+1,attemptsMax:r,bufferInitial:a,bufferStep:s,currentSourceAmount:v,target:d});const e=await y(i,n.messenger,n.transaction),c=new o.BigNumber(e.quote.minDestTokenAmount).minus(u).toString(10);return h("Found valid quote",{attempt:t+1,target:d,targetAmount:e.quote.minDestTokenAmount,goalAmount:u,dust:c,quote:e}),{...e,metrics:{attempts:t+1,buffer:f+s*t,latency:Date.now()-w}}}catch(e){if(e.message!==m)throw e}if(new o.BigNumber(v).isGreaterThanOrEqualTo(c)){h("Reached balance limit",{targetTokenAddress:d,sourceBalanceRaw:c,currentSourceAmount:v,attempt:t+1});break}const l=g.multipliedBy(1+f+s*(t+1));v=l.isLessThan(c)?l.toFixed(0):c}throw h("All attempts failed",d),new Error(m)}(t,n,e)));return s.map((e,t)=>function(e,t,n,r){const a=(0,p.getTokenFiatRate)(n,t.sourceTokenAddress,t.sourceChainId);if(a===undefined)throw new Error(`Fiat rate not found for source token - Chain ID: ${t.sourceChainId}, Address: ${t.sourceTokenAddress}`);const s=(0,p.getTokenFiatRate)(n,t.targetTokenAddress,t.targetChainId);if(s===undefined)throw new Error(`Fiat rate not found for target token - Chain ID: ${t.targetChainId}, Address: ${t.targetTokenAddress}`);const i=w(e.quote.minDestTokenAmount,e.quote.destAsset.decimals,s.fiatRate,s.usdRate),c=w(e.quote.srcTokenAmount,e.quote.srcAsset.decimals,a.fiatRate,a.usdRate),u=w(t.targetAmountMinimum,e.quote.destAsset.decimals,s.fiatRate,s.usdRate),m=(0,d.calculateTransactionGasCost)(r,n),f={estimate:v(e,n),max:v(e,n,{isMax:!0})};return{estimatedDuration:e.estimatedProcessingTimeInSeconds,dust:{fiat:new o.BigNumber(i.fiat).minus(u.fiat).toString(10),usd:new o.BigNumber(i.usd).minus(u.usd).toString(10)},fees:{provider:{fiat:new o.BigNumber(c.fiat).minus(i.fiat).toString(10),usd:new o.BigNumber(c.usd).minus(i.usd).toString(10)},sourceNetwork:f,targetNetwork:m},original:e,request:t,sourceAmount:c,strategy:l.TransactionPayStrategy.Bridge}}(e,a[t],n,r))}catch(e){throw h("Error fetching quotes",{error:e}),new Error(`Failed to fetch bridge quotes: ${String(e)}`)}},n.getBridgeBatchTransactions=async function(e){const{quotes:t}=e,n=t[0]?.original?.quote;return n?.srcChainId!==n?.destChainId?(h("No batch transactions needed for bridge quotes"),[]):t.map(e=>e.original).flatMap(e=>{const t=[];return e.approval&&t.push({...g(e.approval),type:s.TransactionType.swapApproval}),t.push({...g(e.trade),type:s.TransactionType.swap}),t})},n.getBridgeRefreshInterval=function(e){const{chainId:t,messenger:n}=e,r=n.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.bridgeConfigV2,a=r?.chains?.[parseInt(t,16)]?.refreshRate,s=r?.refreshRate;return a??s},n.refreshQuote=async function(e,t,n){const r=await y({...e.original.request,attemptsMax:1},t,n);return h("Refreshed quote",{old:e,new:r}),r}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-quotes.cjs"}],[3027,{"../../logger.cjs":3024,"../../utils/transaction.cjs":3041,"./bridge-quotes.cjs":3026,"@metamask/bridge-controller":1318,"@metamask/controller-utils":1384,"@metamask/utils":3070,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitBridgeQuotes=void 0;const r=e("@metamask/bridge-controller"),a=e("@metamask/controller-utils"),s=e("@metamask/utils"),i=e("lodash"),o=e("./bridge-quotes.cjs"),c=e("../../logger.cjs"),l=e("../../utils/transaction.cjs"),u=(0,s.createModuleLogger)(c.projectLogger,"bridge-strategy");async function d(e,t){const{isSmartTransaction:n,messenger:s,from:o,transaction:c}=e,d=(0,i.cloneDeep)(t),p=(0,a.toHex)(d.quote.srcChainId),m=n(p),f=[],h=(0,l.collectTransactionIds)(p,o,s,e=>(0,l.updateTransaction)({transactionId:c.id,messenger:s,note:"Add required transaction ID"},t=>{t.requiredTransactionIds||(t.requiredTransactionIds=[]),t?.requiredTransactionIds.push(e),f.push(e)})),g={amount:"0",valueInCurrency:null,usd:null},y={gasFee:{effective:g,max:g,total:g},totalNetworkFee:g,totalMaxNetworkFee:g,toTokenAmount:g,minToTokenAmount:g,adjustedReturn:g,sentAmount:g,swapRate:"0",cost:g},w=await s.call("BridgeStatusController:submitTx",o,{...d,...y},m);h.end(),u("Bridge transaction submitted",{requiredTransactionIds:f,result:w}),await Promise.all(f.map(e=>(0,l.waitForTransactionConfirmed)(e,s))),u("All required transactions confirmed",f);const{id:v}=w;u("Waiting for bridge completion",v),await async function(e,t){return new Promise((n,a)=>{const s=(e,t)=>{const s=e?.status?.status;return u("Checking bridge status",s??"missing"),s===r.StatusTypes.COMPLETE?(t?.(),n(),!0):s===r.StatusTypes.FAILED&&(t?.(),a(new Error("Bridge failed")),!0)},i=t.call("BridgeStatusController:getState").txHistory[e];if(s(i))return;const o=e=>{s(e,()=>t.unsubscribe("BridgeStatusController:stateChange",o))};t.subscribe("BridgeStatusController:stateChange",o,t=>t.txHistory[e])})}(v,s)}n.submitBridgeQuotes=async function(e){const{quotes:t,messenger:n,transaction:r}=e;if(!t?.length)return void u("No quotes found");if(t[0].original.quote.srcChainId===t[0].original.quote.destChainId)return void u("Ignoring quotes as source is same chain",t[0].original.quote.srcChainId);let a=0;for(const s of t){u("Submitting bridge",a,s);let t=s.original;if(a>0)try{t=await(0,o.refreshQuote)(s,n,r)}catch(e){u("Failed to refresh subsequent quote before submit",e)}await d(e,t),a+=1}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-submit.cjs"}],[3028,{"./relay-quotes.cjs":3030,"./relay-submit.cjs":3031},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RelayStrategy=void 0;const r=e("./relay-quotes.cjs"),a=e("./relay-submit.cjs");n.RelayStrategy=class{async getQuotes(e){return(0,r.getRelayQuotes)(e)}async execute(e){return await(0,a.submitRelayQuotes)(e)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/RelayStrategy.cjs"}],[3029,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RELAY_POLLING_INTERVAL=n.RELAY_URL_BASE=n.CHAIN_ID_HYPERCORE=void 0,n.CHAIN_ID_HYPERCORE="0x539",n.RELAY_URL_BASE="https://api.relay.link",n.RELAY_POLLING_INTERVAL=1e3}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/constants.cjs"}],[303,{"./handlers":309,"./handlers/wallet-getPermissions":314,"./handlers/wallet-requestPermissions":315,"./handlers/wallet-revokePermissions":316,"@metamask/rpc-errors":2594,"@metamask/snaps-rpc-methods":2732,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createMultichainMethodMiddleware=n.createEthAccountsMethodMiddleware=n.createEip1193MethodMiddleware=void 0,n.makeMethodMiddlewareMaker=u;var r=e("@metamask/rpc-errors"),a=e("@metamask/snaps-rpc-methods"),s=e("@metamask/utils"),i=e("./handlers"),o=e("./handlers/wallet-getPermissions"),c=e("./handlers/wallet-requestPermissions"),l=e("./handlers/wallet-revokePermissions");n.createEip1193MethodMiddleware=u([...i.handlers,...i.eip1193OnlyHandlers,o.getPermissionsHandler,c.requestPermissionsHandler,l.revokePermissionsHandler]),n.createEthAccountsMethodMiddleware=u([i.ethAccountsHandler]),n.createMultichainMethodMiddleware=u(i.handlers);function u(e){const t=e.reduce((e,t)=>{for(const n of t.methodNames)e[n]=t;return e},{}),n=new Set(e.flatMap(({hookNames:e})=>Object.getOwnPropertyNames(e)));return e=>{!function(e,t){const n=[];if(t.forEach(t=>{(0,s.hasProperty)(e,t)||n.push(t)}),n.length>0)throw new Error(`Missing expected hooks:\n\n${n.join("\n")}\n`);const r=Object.getOwnPropertyNames(e).filter(e=>!t.has(e));if(r.length>0)throw new Error(`Received unexpected hooks:\n\n${r.join("\n")}\n`)}(e,n);return async(n,s,i,o)=>{const c=t[n.method];if(c){const{implementation:t,hookNames:l}=c;try{return await t(n,s,i,o,(0,a.selectHooks)(e,l))}catch(e){return o(e instanceof Error?e:r.rpcErrors.internal({data:e}))}}return i()}}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createMethodMiddleware.js"}],[3030,{"../../constants.cjs":3020,"../../index.cjs":3023,"../../logger.cjs":3024,"../../utils/feature-flags.cjs":3033,"../../utils/gas.cjs":3034,"../../utils/token.cjs":3039,"./constants.cjs":3029,"@ethersproject/abi":705,"@metamask/controller-utils":1384,"@metamask/utils":3070,"bignumber.js":3042},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRelayQuotes=void 0;const r=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),s=e("@metamask/utils"),i=e("bignumber.js"),o=e("./constants.cjs"),c=e("../../index.cjs"),l=e("../../constants.cjs"),u=e("../../logger.cjs"),d=e("../../utils/feature-flags.cjs"),p=e("../../utils/gas.cjs"),m=e("../../utils/token.cjs"),f=(0,s.createModuleLogger)(u.projectLogger,"relay-strategy");function h(e,t){const n=e.multipliedBy(t);return{usd:e.toString(10),fiat:n.toString(10)}}function g(e,t,{isMax:n}){if(e.every(e=>e.gas!==undefined))return e.reduce((e,t)=>e+new i.BigNumber(t.gas).toNumber(),0);const r=(0,d.getFeatureFlags)(t).relayFallbackGas;return e.reduce((e,t)=>{const a=n?r.max:r.estimate,s=t.gas??a;return e+new i.BigNumber(s).toNumber()},0)}n.getRelayQuotes=async function(e){const{requests:t}=e;f("Fetching quotes",t);try{const n=t.filter(e=>"0"!==e.targetAmountMinimum).map(e=>function(e){const t=e.targetChainId===l.CHAIN_ID_ARBITRUM&&e.targetTokenAddress.toLowerCase()===l.ARBITRUM_USDC_ADDRESS.toLowerCase(),n=e.sourceChainId===l.CHAIN_ID_POLYGON&&e.sourceTokenAddress===(0,m.getNativeToken)(e.sourceChainId),r={...e,sourceTokenAddress:n?l.NATIVE_TOKEN_ADDRESS:e.sourceTokenAddress,targetChainId:t?o.CHAIN_ID_HYPERCORE:e.targetChainId,targetTokenAddress:t?"0x00000000000000000000000000000000":e.targetTokenAddress,targetAmountMinimum:t?new i.BigNumber(e.targetAmountMinimum).shiftedBy(2).toString(10):e.targetAmountMinimum};t&&f("Converting Arbitrum Hyperliquid deposit to direct deposit",{originalRequest:e,normalizedRequest:r});return r}(e));return f("Normalized requests",n),await Promise.all(n.map(t=>async function(e,t){const{messenger:n,transaction:s}=t;try{const u={amount:e.targetAmountMinimum,destinationChainId:Number(e.targetChainId),destinationCurrency:e.targetTokenAddress,originChainId:Number(e.sourceChainId),originCurrency:e.sourceTokenAddress,recipient:e.from,tradeType:"EXPECTED_OUTPUT",user:e.from};await async function(e,t,n,a){const{data:s,value:i}=e.txParams,c=!((s&&"0x"!==s||i&&"0x0"!==i)&&t.targetChainId!==o.CHAIN_ID_HYPERCORE);if(c)return void f("Skipping delegation as no transaction data");const l=await a.call("TransactionPayController:getDelegationTransaction",{transaction:e}),u=l.authorizationList?.map(e=>({...e,chainId:Number(e.chainId),nonce:Number(e.nonce),yParity:Number(e.yParity)})),d=new r.Interface(["function transfer(address to, uint256 amount)"]).encodeFunctionData("transfer",[t.from,t.targetAmountMinimum]);n.authorizationList=u,n.tradeType="EXACT_OUTPUT",n.txs=[{to:t.targetTokenAddress,data:d,value:"0x0"},{to:l.to,data:l.data,value:l.value}]}(s,e,u,n);const y=(0,d.getFeatureFlags)(n).relayQuoteUrl;f("Request body",{body:u,url:y});const w=await(0,a.successfulFetch)(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),v=await w.json();return f("Fetched relay quote",v),async function(e,t,n){const{messenger:r}=n,{details:s}=e,{currencyIn:o}=s,{usdToFiatRate:u}=function(e,t){const{sourceChainId:n,sourceTokenAddress:r}=t,a=n===l.CHAIN_ID_POLYGON&&r===l.NATIVE_TOKEN_ADDRESS?(0,m.getNativeToken)(n):r,s=(0,m.getTokenFiatRate)(e,a,n);if(!s)throw new Error("Source token fiat rate not found");const o=new i.BigNumber(s.fiatRate).dividedBy(s.usdRate);return{sourceFiatRate:s,usdToFiatRate:o}}(r,t),y=h(function(e,t){const{currencyOut:n}=e.details,{amountUsd:r,amountFormatted:a,minimumAmount:s}=n,{decimals:o}=n.currency,c=new i.BigNumber(r).dividedBy(a),l=new i.BigNumber(s).minus(t.targetAmountMinimum);return l.shiftedBy(-o).multipliedBy(c)}(e,t),u),w=h(function(e){const t=new i.BigNumber(e.fees.relayer.amountUsd),n=new i.BigNumber(e.details.currencyIn.amountUsd).minus(e.details.currencyOut.amountUsd);return t.gt(n)?t:n}(e),u),{isGasFeeToken:v,...b}=await async function(e,t,n){const{from:r,sourceChainId:s,sourceTokenAddress:o}=n,c=e.steps.flatMap(e=>e.items).map(e=>e.data),{relayDisabledGasStationChains:l}=(0,d.getFeatureFlags)(t),{chainId:u,data:h,maxFeePerGas:y,maxPriorityFeePerGas:w,to:v,value:b}=c[0],T=g(c,t,{isMax:!1}),k=g(c,t,{isMax:!0}),_=(0,p.calculateGasCost)({chainId:u,gas:T,maxFeePerGas:y,maxPriorityFeePerGas:w,messenger:t}),E=(0,p.calculateGasCost)({chainId:u,gas:k,maxFeePerGas:y,maxPriorityFeePerGas:w,messenger:t,isMax:!0}),P=(0,m.getTokenBalance)(t,r,s,(0,m.getNativeToken)(s));if(new i.BigNumber(P).isGreaterThanOrEqualTo(E.raw))return{estimate:_,max:E};if(l.includes(s))return f("Skipping gas station as disabled chain",{sourceChainId:s,disabledChainIds:l}),{estimate:_,max:E};f("Checking gas fee tokens as insufficient native balance",{nativeBalance:P,max:E.raw});const S=await t.call("TransactionController:getGasFeeTokens",{chainId:s,data:h,from:r,to:v,value:(0,a.toHex)(b??"0")});f("Source gas fee tokens",{gasFeeTokens:S});const A=S.find(e=>e.tokenAddress.toLowerCase()===o.toLowerCase());if(!A)return f("No matching gas fee token found",{sourceTokenAddress:o,gasFeeTokens:S}),{estimate:_,max:E};let C=A.amount;if(c.length>1){const e=new i.BigNumber(A.amount,16).dividedBy(A.gas,16),t=e.multipliedBy(T);C=(0,a.toHex)(t.toFixed(0)),f("Estimated gas fee token amount for batch",{finalAmount:t.toString(10),gasRate:e.toString(10),totalGasLimitEstimate:T})}const I={...A,amount:C},M=(0,p.calculateGasFeeTokenCost)({chainId:s,gasFeeToken:I,messenger:t});if(!M)return{estimate:_,max:E};return f("Using gas fee token for source network",{gasFeeTokenCost:M}),{isGasFeeToken:!0,estimate:M,max:M}}(e,r,t),T={usd:"0",fiat:"0"},k={human:o.amountFormatted,raw:o.amount,...h(new i.BigNumber(o.amountUsd),u)};return{dust:y,estimatedDuration:s.timeEstimate,fees:{isSourceGasFeeToken:v,provider:w,sourceNetwork:b,targetNetwork:T},original:e,request:t,sourceAmount:k,strategy:c.TransactionPayStrategy.Relay}}(v,e,t)}catch(e){throw f("Error fetching relay quote",e),e}}(t,e)))}catch(e){throw f("Error fetching quotes",{error:e}),new Error(`Failed to fetch Relay quotes: ${String(e)}`)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-quotes.cjs"}],[3031,{"../../logger.cjs":3024,"../../utils/feature-flags.cjs":3033,"../../utils/transaction.cjs":3041,"./constants.cjs":3029,"@metamask/controller-utils":1384,"@metamask/transaction-controller":2989,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitRelayQuotes=void 0;const r=e("@metamask/controller-utils"),a=e("@metamask/transaction-controller"),s=e("@metamask/utils"),i=e("./constants.cjs"),o=e("../../logger.cjs"),c=e("../../utils/feature-flags.cjs"),l=e("../../utils/transaction.cjs"),u="0x0",d=(0,s.createModuleLogger)(o.projectLogger,"relay-strategy");async function p(e,t,n){d("Executing single quote",e),(0,l.updateTransaction)({transactionId:n.id,messenger:t,note:"Remove nonce from skipped transaction"},e=>{e.txParams.nonce=undefined}),await async function(e,t,n){const{steps:s}=e.original,i=s.flatMap(e=>e.items).map(e=>e.data),o=s.find(e=>"transaction"!==e.kind)?.kind;if(o)throw new Error(`Unsupported step kind: ${o}`);const u=i.map(e=>function(e,t){const n=(0,c.getFeatureFlags)(t);return{data:e.data,from:e.from,gas:(0,r.toHex)(e.gas??n.relayFallbackGas.max),maxFeePerGas:(0,r.toHex)(e.maxFeePerGas),maxPriorityFeePerGas:(0,r.toHex)(e.maxPriorityFeePerGas),to:e.to,value:(0,r.toHex)(e.value??"0")}}(e,n)),p=[],{from:m,sourceChainId:f,sourceTokenAddress:h}=e.request,g=n.call("NetworkController:findNetworkClientIdByChainId",f);d("Adding transactions",{normalizedParams:u,sourceChainId:f,from:m,networkClientId:g});const{end:y}=(0,l.collectTransactionIds)(f,m,n,e=>{p.push(e),(0,l.updateTransaction)({transactionId:t,messenger:n,note:"Add required transaction ID from Relay submission"},t=>{t.requiredTransactionIds||(t.requiredTransactionIds=[]),t.requiredTransactionIds.push(e)})});let w;const v=e.fees.isSourceGasFeeToken?h:undefined;1===i.length?w=await n.call("TransactionController:addTransaction",u[0],{gasFeeToken:v,networkClientId:g,origin:r.ORIGIN_METAMASK,requireApproval:!1}):await n.call("TransactionController:addTransactionBatch",{from:m,gasFeeToken:v,networkClientId:g,origin:r.ORIGIN_METAMASK,requireApproval:!1,transactions:u.map((e,t)=>({params:{data:e.data,gas:e.gas,to:e.to,value:e.value},type:0===t?a.TransactionType.tokenMethodApprove:undefined}))});if(y(),d("Added transactions",p),w){const e=await w.result;d("Submitted transaction",e)}await Promise.all(p.map(e=>(0,l.waitForTransactionConfirmed)(e,n))),d("All transactions confirmed",p);const b=(0,l.getTransaction)(p.slice(-1)[0],n)?.hash;return b}(e,n.id,t);const s=await async function(e){if(e.details.currencyIn.currency.chainId===e.details.currencyOut.currency.chainId)return d("Skipping polling as same chain"),u;const{endpoint:t,method:n}=e.steps.slice(-1)[0].items.slice(-1)[0].check,a=`${i.RELAY_URL_BASE}${t}`;for(;;){const e=await(0,r.successfulFetch)(a,{method:n}),t=await e.json();if(d("Polled status",t.status,t),"success"===t.status){const e=t.txHashes?.slice(-1)[0];return e??u}if(["failure","refund","fallback"].includes(t.status))throw new Error(`Relay request failed with status: ${t.status}`);await new Promise(e=>setTimeout(e,i.RELAY_POLLING_INTERVAL))}}(e.original);return d("Relay request completed",s),(0,l.updateTransaction)({transactionId:n.id,messenger:t,note:"Intent complete after Relay completion"},e=>{e.isIntentComplete=!0}),{transactionHash:s}}n.submitRelayQuotes=async function(e){d("Executing quotes",e);const{quotes:t,messenger:n,transaction:r}=e;let a;for(const e of t)({transactionHash:a}=await p(e,n,r));return{transactionHash:a}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-submit.cjs"}],[3032,{"../../index.cjs":3023,"../../logger.cjs":3024,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TestStrategy=void 0;const i=e("@metamask/utils"),o=e("../../index.cjs"),c=e("../../logger.cjs"),l=(0,i.createModuleLogger)(c.projectLogger,"test-strategy");n.TestStrategy=class{constructor(){r.add(this)}async getQuotes(e){const{requests:t}=e;return l("Getting quotes",t),await s(this,r,"m",a).call(this,5e3),[{dust:{fiat:"0.12",usd:"0.34"},estimatedDuration:5,fees:{provider:{fiat:"1.23",usd:"1.23"},sourceNetwork:{estimate:{human:"2.34",fiat:"2.34",usd:"2.34",raw:"234000"},max:{human:"2.35",fiat:"2.35",usd:"2.35",raw:"235000"}},targetNetwork:{fiat:"3.45",usd:"3.45"}},original:undefined,request:t[0],sourceAmount:{human:"4.56",fiat:"4.56",raw:"456000",usd:"4.56"},strategy:o.TransactionPayStrategy.Test}]}async execute(e){const{quotes:t}=e;return l("Executing",t),await s(this,r,"m",a).call(this,5e3),{transactionHash:undefined}}},r=new WeakSet,a=function(e){return new Promise(t=>setTimeout(t,e))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/test/TestStrategy.cjs"}],[3033,{"../logger.cjs":3024,"../strategy/relay/constants.cjs":3029,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getFeatureFlags=n.DEFAULT_RELAY_QUOTE_URL=n.DEFAULT_RELAY_FALLBACK_GAS_MAX=n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=void 0;const r=e("@metamask/utils"),a=e("../logger.cjs"),s=e("../strategy/relay/constants.cjs"),i=(0,r.createModuleLogger)(a.projectLogger,"feature-flags");n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=9e5,n.DEFAULT_RELAY_FALLBACK_GAS_MAX=15e5,n.DEFAULT_RELAY_QUOTE_URL=`${s.RELAY_URL_BASE}/quote`,n.getFeatureFlags=function(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay??{},r=t.relayFallbackGas?.estimate??n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE,a=t.relayFallbackGas?.max??n.DEFAULT_RELAY_FALLBACK_GAS_MAX,s=t.relayQuoteUrl??n.DEFAULT_RELAY_QUOTE_URL,o={relayDisabledGasStationChains:t.relayDisabledGasStationChains??[],relayFallbackGas:{estimate:r,max:a},relayQuoteUrl:s};return i("Feature flags:",{raw:t,result:o}),o}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/feature-flags.cjs"}],[3034,{"../logger.cjs":3024,"./token.cjs":3039,"@metamask/controller-utils":1384,"bignumber.js":3042},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateGasFeeTokenCost=n.calculateGasCost=n.calculateTransactionGasCost=void 0;const r=e("@metamask/controller-utils"),a=e("bignumber.js"),s=e("./token.cjs"),i=e("../logger.cjs"),o=(0,i.createModuleLogger)(i.projectLogger,"gas");function c(e){const{chainId:t,gas:n,isMax:i,maxFeePerGas:o,maxPriorityFeePerGas:c,messenger:l}=e,u=(0,r.toHex)(t),{estimatedBaseFee:d,maxFeePerGas:p,maxPriorityFeePerGas:m}=function(e,t){const n=t.call("GasFeeController:getState"),r=n?.gasFeeEstimatesByChainId?.[e],{estimatedBaseFee:s,medium:i}=r?.gasFeeEstimates??{},o=i?.suggestedMaxFeePerGas,c=i?.suggestedMaxPriorityFeePerGas,l=s?new a.BigNumber(s).shiftedBy(9).toString(10):undefined,u=o?new a.BigNumber(o).shiftedBy(9).toString(10):undefined,d=c?new a.BigNumber(c).shiftedBy(9).toString(10):undefined;return{estimatedBaseFee:l,maxFeePerGas:u,maxPriorityFeePerGas:d}}(u,l),f=o||p,h=c||m,g=d&&h&&!i?new a.BigNumber(d).plus(h):new a.BigNumber(f||"0x0"),y=new a.BigNumber(n).multipliedBy(g),w=y.toString(10),v=y.shiftedBy(-18),b=v.toString(10),T=(0,s.getTokenFiatRate)(l,(0,s.getNativeToken)(u),u);if(!T)throw new Error("Could not fetch fiat rate for native token");const k=v.multipliedBy(T.usdRate).toString(10);return{fiat:v.multipliedBy(T.fiatRate).toString(10),human:b,raw:w,usd:k}}function l({chainId:e,gasFeeToken:t,messenger:n}){const{amount:r,decimals:i,tokenAddress:c}=t,l=(0,s.getTokenFiatRate)(n,c,e);if(!l)return o("Cannot get gas fee token info"),undefined;const u=new a.BigNumber(r),d=u.toString(10),p=u.shiftedBy(-i),m=p.toString(10);return{isGasFeeToken:!0,fiat:p.multipliedBy(l.fiatRate).toString(10),human:m,raw:d,usd:p.multipliedBy(l.usdRate).toString(10)}}n.calculateTransactionGasCost=function(e,t,{isMax:n}={}){const{chainId:r,gasUsed:i,gasLimitNoBuffer:u,txParams:d}=e,{from:p,gas:m,maxFeePerGas:f,maxPriorityFeePerGas:h}=d,g=(n?undefined:i)||u||m||"0x0",y=c({chainId:r,gas:g,isMax:n,maxFeePerGas:f,maxPriorityFeePerGas:h,messenger:t}),w=c({chainId:r,gas:g,isMax:!0,messenger:t}),v=(0,s.getTokenBalance)(t,p,r,(0,s.getNativeToken)(r)),b=function({hasBalance:e,messenger:t,transaction:n}){const{chainId:r,gasFeeTokens:a,isGasFeeTokenIgnoredIfBalance:s,selectedGasFeeToken:i}=n;if(!a||!i||s&&e)return undefined;o("Calculating gas fee token cost",{selectedGasFeeToken:i,chainId:r});const c=a?.find(e=>e.tokenAddress.toLowerCase()===i.toLowerCase());if(!c)return o("Gas fee token not found",{gasFeeTokens:a,selectedGasFeeToken:i}),undefined;return l({chainId:r,gasFeeToken:c,messenger:t})}({hasBalance:new a.BigNumber(v).gte(w.raw),messenger:t,transaction:e});return b||y},n.calculateGasCost=c,n.calculateGasFeeTokenCost=l}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/gas.cjs"}],[3035,{"../logger.cjs":3024,"./strategy.cjs":3038,"./totals.cjs":3040,"./transaction.cjs":3041,"@metamask/transaction-controller":2989,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuotes=n.updateQuotes=void 0;const r=e("@metamask/transaction-controller"),a=e("@metamask/utils"),s=e("./strategy.cjs"),i=e("./totals.cjs"),o=e("./transaction.cjs"),c=e("../logger.cjs"),l=(0,a.createModuleLogger)(c.projectLogger,"quotes");async function u(e){const{messenger:t,transactionData:n,transactionId:a,updateTransactionData:c}=e,u=(0,o.getTransaction)(a,t);if(!u||!n)throw new Error("Transaction not found");if(u?.status!==r.TransactionStatus.unapproved)return!1;l("Updating quotes",{transactionId:a});const{paymentToken:d,sourceAmounts:p,tokens:m}=n,f=function({from:e,paymentToken:t,sourceAmounts:n,tokens:r,transactionId:a}){if(!t)return[];const s=(n??[]).map(n=>{const a=r.find(e=>e.address===n.targetTokenAddress);return{from:e,sourceBalanceRaw:t.balanceRaw,sourceTokenAmount:n.sourceAmountRaw,sourceChainId:t.chainId,sourceTokenAddress:t.address,targetAmountMinimum:a.allowUnderMinimum?"0":a.amountRaw,targetChainId:a.chainId,targetTokenAddress:a.address}});s.length||l("No quote requests",{transactionId:a});return s}({from:u.txParams.from,paymentToken:d,sourceAmounts:p,tokens:m,transactionId:a});c(a,e=>{e.isLoading=!0});try{const{batchTransactions:e,quotes:n}=await async function(e,t,n){const{id:r}=e,a=(0,s.getStrategy)(n,e);let i=[];try{i=t?.length?await a.getQuotes({messenger:n,requests:t,transaction:e}):[]}catch(e){l("Error fetching quotes",{error:e,transactionId:r})}l("Updated",{transactionId:r,quotes:i});const o=i?.length&&a.getBatchTransactions?await a.getBatchTransactions({messenger:n,quotes:i}):[];return l("Batch transactions",{transactionId:r,batchTransactions:o}),{batchTransactions:o,quotes:i}}(u,f,t),r=(0,i.calculateTotals)({quotes:n,messenger:t,tokens:m,transaction:u});l("Calculated totals",{transactionId:a,totals:r}),function({batchTransactions:e,messenger:t,paymentToken:n,totals:r,transactionId:a}){if(!n)return;(0,o.updateTransaction)({transactionId:a,messenger:t,note:"Update transaction pay data"},t=>{t.batchTransactions=e,t.batchTransactionsOptions={},t.metamaskPay={bridgeFeeFiat:r.fees.provider.usd,chainId:n.chainId,networkFeeFiat:r.fees.sourceNetwork.estimate.usd,tokenAddress:n.address,totalFiat:r.total.usd}})}({batchTransactions:e,messenger:t,paymentToken:d,totals:r,transactionId:a}),c(a,e=>{e.quotes=n,e.quotesLastUpdated=Date.now(),e.totals=r})}finally{c(a,e=>{e.isLoading=!1})}return!0}n.updateQuotes=u,n.refreshQuotes=async function(e,t){const n=e.call("TransactionPayController:getState"),r=Object.keys(n.transactionData);for(const a of r){const r=n.transactionData[a],{isLoading:i,quotes:o,quotesLastUpdated:c}=r;if(i||!o?.length)continue;const d=o[0].strategy,p=(0,s.getStrategyByName)(d),m=await(p.getRefreshInterval?.({chainId:o[0].request.sourceChainId,messenger:e}))??3e4;if(!(Date.now()-(c??0)>m))continue;await u({messenger:e,transactionData:r,transactionId:a,updateTransactionData:t})&&l("Refreshed quotes",{transactionId:a,strategy:d})}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/quotes.cjs"}],[3036,{"./token.cjs":3039,"@ethersproject/abi":705,"@metamask/controller-utils":1384,"@metamask/metamask-eth-abis":2244,"@metamask/utils":3070,"bignumber.js":3042},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseRequiredTokens=void 0;const r=e("@ethersproject/abi"),a=e("@metamask/controller-utils"),s=e("@metamask/metamask-eth-abis"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("./token.cjs"),l="0xa9059cbb";function u(e,t){const{data:n,to:i}=function(e){const{nestedTransactions:t,txParams:n}=e,{data:r}=n,a=n?.to;if(r?.startsWith(l)&&a)return{data:r,to:a,index:undefined};const s=t?.findIndex(e=>e.data?.startsWith(l)),i=s!==undefined?t?.[s]:undefined;if(i?.data&&i.to)return{data:i.data,to:i.to,index:s};return undefined}(e)??{};if(!i||!n)return undefined;let o;try{const e=new r.Interface(s.abiERC20).decodeFunctionData("transfer",n);o=(0,a.toHex)(e._value)}catch{}return o===undefined?undefined:p(e,i,o,t)}function d(e,t){const{chainId:n,txParams:r}=e,{gas:a,maxFeePerGas:s}=r,l=(0,c.getNativeToken)(n),u=p(e,l,(0,i.add0x)(new o.BigNumber(a??"0x0").multipliedBy(new o.BigNumber(s??"0x0")).toString(16)),t);if(!u)return undefined;const d=new o.BigNumber(u.amountUsd);if(new o.BigNumber(u.balanceRaw).isGreaterThanOrEqualTo(u.amountRaw)||d.isGreaterThanOrEqualTo(1))return{...u,allowUnderMinimum:!0,skipIfBalance:!0};const m=(0,c.getTokenFiatRate)(t,l,n),f=p(e,l,(0,i.add0x)(new o.BigNumber(1).dividedBy(m.usdRate).shiftedBy(18).toString(16)),t);return f?{...f,allowUnderMinimum:!0,skipIfBalance:!0}:undefined}function p(e,t,n,r){const{chainId:a,txParams:s}=e,i=s.from,{decimals:o,symbol:l}=(0,c.getTokenInfo)(r,t,a)??{},u=(0,c.getTokenFiatRate)(r,t,a),d=(0,c.getTokenBalance)(r,i,a,t);if(o===undefined||!l||u===undefined)return undefined;const{amountHuman:p,amountRaw:f,amountFiat:h,amountUsd:g}=m(d,o,u),{amountHuman:y,amountRaw:w,amountFiat:v,amountUsd:b}=m(n,o,u);return{address:t,allowUnderMinimum:!1,amountFiat:v,amountHuman:y,amountRaw:w,amountUsd:b,balanceFiat:h,balanceHuman:p,balanceRaw:f,balanceUsd:g,chainId:a,decimals:o,skipIfBalance:!1,symbol:l}}function m(e,t,n){const r=new o.BigNumber(e),a=r.shiftedBy(-t),s=a.multipliedBy(n.fiatRate).toString(10),i=a.multipliedBy(n.usdRate).toString(10),c=r.toFixed(0);return{amountFiat:s,amountHuman:a.toString(10),amountRaw:c,amountUsd:i}}n.parseRequiredTokens=function(e,t){return[u(e,t),d(e,t)].filter(Boolean)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/required-tokens.cjs"}],[3037,{"../constants.cjs":3020,"../index.cjs":3023,"../logger.cjs":3024,"./token.cjs":3039,"./transaction.cjs":3041,"@metamask/utils":3070,"bignumber.js":3042},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateSourceAmounts=void 0;const r=e("@metamask/utils"),a=e("bignumber.js"),s=e("./token.cjs"),i=e("./transaction.cjs"),o=e("../index.cjs"),c=e("../constants.cjs"),l=e("../logger.cjs"),u=(0,r.createModuleLogger)(l.projectLogger,"source-amounts");n.updateSourceAmounts=function(e,t,n){if(!t)return;const{paymentToken:r,tokens:l}=t;if(!l.length||!r)return;const d=l.map(t=>function(e,t,n,r){const l=(0,s.getTokenFiatRate)(n,e.address,e.chainId);if(!l)return undefined;const d=new a.BigNumber(t.balanceRaw).gte(t.amountRaw);if(t.skipIfBalance&&d)return u("Skipping token as sufficient balance",{tokenAddress:t.address}),undefined;const p=function(e,t){const n=(0,i.getTransaction)(e,t);return t.call("TransactionPayController:getStrategy",n)}(r,n),m=t.address.toLowerCase()===e.address.toLowerCase()&&t.chainId===e.chainId,f=function(e,t){const n=e.chainId===c.CHAIN_ID_ARBITRUM&&e.address.toLowerCase()===c.ARBITRUM_USDC_ADDRESS.toLowerCase();return t===o.TransactionPayStrategy.Relay&&n}(t,p);if(m&&!f)return u("Skipping token as same as payment token"),undefined;const h=new a.BigNumber(t.amountUsd).div(l.usdRate),g=h.toString(10),y=h.shiftedBy(e.decimals).toFixed(0);if("0"===t.amountRaw)return u("Skipping token as zero amount",{tokenAddress:t.address}),undefined;return{sourceAmountHuman:g,sourceAmountRaw:y,targetTokenAddress:t.address}}(r,t,n,e)).filter(Boolean);u("Updated source amounts",{transactionId:e,sourceAmounts:d}),t.sourceAmounts=d}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/source-amounts.cjs"}],[3038,{"../constants.cjs":3020,"../strategy/bridge/BridgeStrategy.cjs":3025,"../strategy/relay/RelayStrategy.cjs":3028,"../strategy/test/TestStrategy.cjs":3032},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getStrategyByName=n.getStrategy=void 0;const r=e("../constants.cjs"),a=e("../strategy/bridge/BridgeStrategy.cjs"),s=e("../strategy/relay/RelayStrategy.cjs"),i=e("../strategy/test/TestStrategy.cjs");function o(e){switch(e){case r.TransactionPayStrategy.Bridge:return new a.BridgeStrategy;case r.TransactionPayStrategy.Relay:return new s.RelayStrategy;case r.TransactionPayStrategy.Test:return new i.TestStrategy;default:throw new Error(`Unknown strategy: ${e}`)}}n.getStrategy=function(e,t){return o(e.call("TransactionPayController:getStrategy",t))},n.getStrategyByName=o}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/strategy.cjs"}],[3039,{"../constants.cjs":3020,"@metamask/controller-utils":1384,"bignumber.js":3042,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNativeToken=n.getTokenFiatRate=n.getTokenInfo=n.getAllTokenBalances=n.getTokenBalance=void 0;const r=e("@metamask/controller-utils"),a=e("bignumber.js"),s=e("lodash"),i=e("../constants.cjs"),o={[i.CHAIN_ID_ARBITRUM]:[i.ARBITRUM_USDC_ADDRESS.toLowerCase()],[i.CHAIN_ID_POLYGON]:[i.POLYGON_USDCE_ADDRESS.toLowerCase()]};function c(e,t,n,s){const i=e.call("TokenBalancesController:getState"),o=t.toLowerCase(),c=(0,r.toChecksumHexAddress)(s),u=c===l(n),d=i.tokenBalances?.[o]?.[n]?.[c];if(!u&&d===undefined)return"0";if(!u&&d)return new a.BigNumber(d,16).toString(10);const p=e.call("AccountTrackerController:getState"),m=p.accountsByChainId?.[n],f=(0,r.toChecksumHexAddress)(o),h=m?.[f]?.balance;return new a.BigNumber(h??"0x0",16).toString(10)}function l(e){return"0x89"===e?"0x0000000000000000000000000000000000001010":i.NATIVE_TOKEN_ADDRESS}function u(e,t){try{const n=t.call("NetworkController:findNetworkClientIdByChainId",e);return t.call("NetworkController:getNetworkClientById",n).configuration.ticker}catch{return undefined}}n.getTokenBalance=c,n.getAllTokenBalances=function(e,t){const n=e.call("TokenBalancesController:getState"),r=e.call("AccountTrackerController:getState"),a=Object.keys(r.accountsByChainId),i=t.toLowerCase(),o=n.tokenBalances?.[i],u=Object.keys(o);return(0,s.uniq)([...u,...a]).flatMap(n=>[...Object.keys(o[n]??{}),l(n)].map(r=>({chainId:n,tokenAddress:r,balance:c(e,t,n,r)})))},n.getTokenInfo=function(e,t,n){const r=e.call("TokensController:getState"),a=t.toLowerCase(),s=a===l(n).toLowerCase(),i=Object.values(r.allTokens?.[n]??{}).flat().find(e=>e.address.toLowerCase()===a);if(!i&&!s)return undefined;if(i&&!s)return{decimals:Number(i.decimals),symbol:i.symbol};const o=u(n,e);return o?{decimals:18,symbol:o}:undefined},n.getTokenFiatRate=function(e,t,n){const s=u(n,e);if(!s)return undefined;const i=e.call("TokenRatesController:getState"),c=e.call("CurrencyRateController:getState"),d=(0,r.toChecksumHexAddress)(t),p=d===l(n),m=i.marketData?.[n]?.[d]?.price;if(m===undefined&&!p)return undefined;const{conversionRate:f,usdConversionRate:h}=c.currencyRates?.[s]??{conversionRate:null,usdConversionRate:null};if(null===f||null===h)return undefined;const g=o[n]?.includes(t.toLowerCase());return{usdRate:g?"1":new a.BigNumber(m??1).multipliedBy(h).toString(10),fiatRate:new a.BigNumber(m??1).multipliedBy(f).toString(10)}},n.getNativeToken=l}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/token.cjs"}],[304,{"../../../../shared/constants/network":5772,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createUnsupportedMethodMiddleware=function(e=a.UNSUPPORTED_RPC_METHODS){return async function(t,n,a,s){return e.has(t.method)?s(r.rpcErrors.methodNotSupported()):a()}};var r=e("@metamask/rpc-errors"),a=e("../../../../shared/constants/network")}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createUnsupportedMethodMiddleware.ts"}],[3040,{"./gas.cjs":3034,"bignumber.js":3042},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTotals=void 0;const r=e("bignumber.js"),a=e("./gas.cjs");function s(e){return{...i(e),human:o(e,e=>e.human),raw:o(e,e=>e.raw)}}function i(e){return{fiat:o(e,e=>e.fiat),usd:o(e,e=>e.usd)}}function o(e,t){return e.map(t).reduce((e,t)=>e.plus(t),new r.BigNumber(0)).toString(10)}n.calculateTotals=function({quotes:e,messenger:t,tokens:n,transaction:c}){const l=i(e.map(e=>e.fees.provider)),u=s(e.map(e=>e.fees.sourceNetwork.max)),d=s(e.map(e=>e.fees.sourceNetwork.estimate)),p=(0,a.calculateTransactionGasCost)(c,t),m=e?.length?{...i(e.map(e=>e.fees.targetNetwork)),isGasFeeToken:!1}:p,f=s(e.map(e=>e.sourceAmount)),h=n.filter(e=>!e.skipIfBalance),g=o(h,e=>e.amountFiat),y=o(h,e=>e.amountUsd),w=new r.BigNumber(l.fiat).plus(d.fiat).plus(m.fiat).plus(g).toString(10),v=new r.BigNumber(l.usd).plus(d.usd).plus(m.usd).plus(y).toString(10);return{estimatedDuration:Number(o(e,e=>e.estimatedDuration)),fees:{isSourceGasFeeToken:e.some(e=>e.fees.isSourceGasFeeToken),isTargetGasFeeToken:m.isGasFeeToken||e.some(e=>e.fees.isTargetGasFeeToken),provider:l,sourceNetwork:{estimate:d,max:u},targetNetwork:m},sourceAmount:f,total:{fiat:w,usd:v}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/totals.cjs"}],[3041,{"../logger.cjs":3024,"./required-tokens.cjs":3036,"@metamask/transaction-controller":2989,"@metamask/utils":3070,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.collectTransactionIds=n.updateTransaction=n.waitForTransactionConfirmed=n.pollTransactionChanges=n.getTransaction=n.FINALIZED_STATUSES=void 0;const r=e("@metamask/transaction-controller"),a=e("@metamask/utils"),s=e("lodash"),i=e("./required-tokens.cjs"),o=e("../logger.cjs"),c=(0,a.createModuleLogger)(o.projectLogger,"transaction");function l(e,t){return t.call("TransactionController:getState").transactions.find(t=>t.id===e)}n.FINALIZED_STATUSES=[r.TransactionStatus.confirmed,r.TransactionStatus.dropped,r.TransactionStatus.failed],n.getTransaction=l,n.pollTransactionChanges=function(e,t,r){e.subscribe("TransactionController:stateChange",(a,s)=>{const o=a.filter(e=>!s?.find(t=>t.id===e.id)),l=a.filter(e=>{const t=s?.find(t=>t.id===e.id);return t&&t?.txParams.data!==e.txParams.data});[...a.filter(e=>{const t=s?.find(t=>t.id===e.id);return t&&!n.FINALIZED_STATUSES.includes(t.status)&&n.FINALIZED_STATUSES.includes(e.status)}),...(s??[]).filter(e=>!a.find(t=>t.id===e.id))].forEach(e=>function(e,t){c("Transaction finalized",{transaction:e}),t(e.id)}(e,r)),[...o,...l].forEach(n=>function(e,t,n){const r=(0,i.parseRequiredTokens)(e,t);c("Transaction changed",{transaction:e,tokens:r}),n(e.id,e=>{e.tokens=r})}(n,e,t))},e=>e.transactions)},n.waitForTransactionConfirmed=function(e,t){return new Promise((n,a)=>{const s=(e,t)=>(c("Checking transaction status",e?.status,e?.type),e?.status===r.TransactionStatus.confirmed?(t?.(),n(),!0):!![r.TransactionStatus.dropped,r.TransactionStatus.failed].includes(e?.status)&&(t?.(),a(new Error(`Transaction failed - ${e?.type} - ${e?.error?.message}`)),!0)),i=t.call("TransactionController:getState").transactions.find(t=>t.id===e);if(s(i))return;const o=e=>{s(e,()=>t.unsubscribe("TransactionController:stateChange",o))};t.subscribe("TransactionController:stateChange",o,t=>t.transactions.find(t=>t.id===e))})},n.updateTransaction=function({transactionId:e,messenger:t,note:n},r){const a=l(e,t);if(!a)throw new Error(`Transaction not found: ${e}`);const i=(0,s.cloneDeep)(a);r(i),t.call("TransactionController:updateTransaction",i,n)},n.collectTransactionIds=function(e,t,n,r){const a=n=>{n.chainId===e&&n.txParams.from.toLowerCase()===t.toLowerCase()&&r(n.id)};return n.subscribe("TransactionController:unapprovedTransactionAdded",a),{end:()=>{n.unsubscribe("TransactionController:unapprovedTransactionAdded",a)}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/transaction.cjs"}],[3042,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,r=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,s=Math.floor,i="[BigNumber Error] ",o=i+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,u=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],p=1e7,m=1e9;function f(e){var t=0|e;return e>0||e===t?t:t-1}function h(e){for(var t,n,r=1,a=e.length,s=e[0]+"";r<a;){for(t=e[r++]+"",n=l-t.length;n--;t="0"+t);s+=t}for(a=s.length;48===s.charCodeAt(--a););return s.slice(0,a+1||1)}function g(e,t){var n,r,a=e.c,s=t.c,i=e.s,o=t.s,c=e.e,l=t.e;if(!i||!o)return null;if(n=a&&!a[0],r=s&&!s[0],n||r)return n?r?0:-o:i;if(i!=o)return i;if(n=i<0,r=c==l,!a||!s)return r?0:!a^n?1:-1;if(!r)return c>l^n?1:-1;for(o=(c=a.length)<(l=s.length)?c:l,i=0;i<o;i++)if(a[i]!=s[i])return a[i]>s[i]^n?1:-1;return c==l?0:c>l^n?1:-1}function y(e,t,n,r){if(e<t||e>n||e!==s(e))throw Error(i+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function w(e){var t=e.c.length-1;return f(e.e/l)==t&&e.c[t]%2!=0}function v(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function b(e,t,n){var r,a;if(t<0){for(a=n+".";++t;a+=n);e=a+e}else if(++t>(r=e.length)){for(a=n,t-=r;--t;a+=n);e+=a}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,T,k,_,E,P,S,A,C,I,M=H.prototype={constructor:H,toString:null,valueOf:null},j=new H(1),O=20,R=4,x=-7,N=21,D=-1e7,F=1e7,B=!1,U=1,L=0,G={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},q="0123456789abcdefghijklmnopqrstuvwxyz",$=!0;function H(e,t){var n,a,i,c,d,p,m,f,h=this;if(!(h instanceof H))return new H(e,t);if(null==t){if(e&&!0===e._isBigNumber)return h.s=e.s,void(!e.c||e.e>F?h.c=h.e=null:e.e<D?h.c=[h.e=0]:(h.e=e.e,h.c=e.c.slice()));if((p="number"==typeof e)&&0*e==0){if(h.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>F?h.c=h.e=null:(h.e=c,h.c=[e]))}f=String(e)}else{if(!r.test(f=String(e)))return k(h,f,p);h.s=45==f.charCodeAt(0)?(f=f.slice(1),-1):1}(c=f.indexOf("."))>-1&&(f=f.replace(".","")),(d=f.search(/e/i))>0?(c<0&&(c=d),c+=+f.slice(d+1),f=f.substring(0,d)):c<0&&(c=f.length)}else{if(y(t,2,q.length,"Base"),10==t&&$)return z(h=new H(e),O+h.e+1,R);if(f=String(e),p="number"==typeof e){if(0*e!=0)return k(h,f,p,t);if(h.s=1/e<0?(f=f.slice(1),-1):1,H.DEBUG&&f.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else h.s=45===f.charCodeAt(0)?(f=f.slice(1),-1):1;for(n=q.slice(0,t),c=d=0,m=f.length;d<m;d++)if(n.indexOf(a=f.charAt(d))<0){if("."==a){if(d>c){c=m;continue}}else if(!i&&(f==f.toUpperCase()&&(f=f.toLowerCase())||f==f.toLowerCase()&&(f=f.toUpperCase()))){i=!0,d=-1,c=0;continue}return k(h,String(e),p,t)}p=!1,(c=(f=T(f,t,10,h.s)).indexOf("."))>-1?f=f.replace(".",""):c=f.length}for(d=0;48===f.charCodeAt(d);d++);for(m=f.length;48===f.charCodeAt(--m););if(f=f.slice(d,++m)){if(m-=d,p&&H.DEBUG&&m>15&&(e>u||e!==s(e)))throw Error(o+h.s*e);if((c=c-d-1)>F)h.c=h.e=null;else if(c<D)h.c=[h.e=0];else{if(h.e=c,h.c=[],d=(c+1)%l,c<0&&(d+=l),d<m){for(d&&h.c.push(+f.slice(0,d)),m-=l;d<m;)h.c.push(+f.slice(d,d+=l));d=l-(f=f.slice(d)).length}else d-=m;for(;d--;f+="0");h.c.push(+f)}}else h.c=[h.e=0]}function Y(e,t,n,r){var a,s,i,o,c;if(null==n?n=R:y(n,0,8),!e.c)return e.toString();if(a=e.c[0],i=e.e,null==t)c=h(e.c),c=1==r||2==r&&(i<=x||i>=N)?v(c,i):b(c,i,"0");else if(s=(e=z(new H(e),t,n)).e,o=(c=h(e.c)).length,1==r||2==r&&(t<=s||s<=x)){for(;o<t;c+="0",o++);c=v(c,s)}else if(t-=i,c=b(c,s,"0"),s+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-o)>0)for(s+1==o&&(c+=".");t--;c+="0");return e.s<0&&a?"-"+c:c}function W(e,t){for(var n,r,a=1,s=new H(e[0]);a<e.length;a++)(!(r=new H(e[a])).s||(n=g(s,r))===t||0===n&&s.s===t)&&(s=r);return s}function V(e,t,n){for(var r=1,a=t.length;!t[--a];t.pop());for(a=t[0];a>=10;a/=10,r++);return(n=r+n*l-1)>F?e.c=e.e=null:n<D?e.c=[e.e=0]:(e.e=n,e.c=t),e}function z(e,t,n,r){var i,o,u,p,m,f,h,g=e.c,y=d;if(g){e:{for(i=1,p=g[0];p>=10;p/=10,i++);if((o=t-i)<0)o+=l,u=t,m=g[f=0],h=s(m/y[i-u-1]%10);else if((f=a((o+1)/l))>=g.length){if(!r)break e;for(;g.length<=f;g.push(0));m=h=0,i=1,u=(o%=l)-l+1}else{for(m=p=g[f],i=1;p>=10;p/=10,i++);h=(u=(o%=l)-l+i)<0?0:s(m/y[i-u-1]%10)}if(r=r||t<0||null!=g[f+1]||(u<0?m:m%y[i-u-1]),r=n<4?(h||r)&&(0==n||n==(e.s<0?3:2)):h>5||5==h&&(4==n||r||6==n&&(o>0?u>0?m/y[i-u]:0:g[f-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,r?(t-=e.e+1,g[0]=y[(l-t%l)%l],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=f,p=1,f--):(g.length=f+1,p=y[l-o],g[f]=u>0?s(m/y[i-u]%y[u])*p:0),r)for(;;){if(0==f){for(o=1,u=g[0];u>=10;u/=10,o++);for(u=g[0]+=p,p=1;u>=10;u/=10,p++);o!=p&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[f]+=p,g[f]!=c)break;g[f--]=0,p=1}for(o=g.length;0===g[--o];g.pop());}e.e>F?e.c=e.e=null:e.e<D&&(e.c=[e.e=0])}return e}function K(e){var t,n=e.e;return null===n?e.toString():(t=h(e.c),t=n<=x||n>=N?v(t,n):b(t,n,"0"),e.s<0?"-"+t:t)}return H.clone=e,H.ROUND_UP=0,H.ROUND_DOWN=1,H.ROUND_CEIL=2,H.ROUND_FLOOR=3,H.ROUND_HALF_UP=4,H.ROUND_HALF_DOWN=5,H.ROUND_HALF_EVEN=6,H.ROUND_HALF_CEIL=7,H.ROUND_HALF_FLOOR=8,H.EUCLID=9,H.config=H.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(i+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(y(n=e[t],0,m,t),O=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(y(n=e[t],0,8,t),R=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(y(n[0],-m,0,t),y(n[1],0,m,t),x=n[0],N=n[1]):(y(n,-m,m,t),x=-(N=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)y(n[0],-m,-1,t),y(n[1],1,m,t),D=n[0],F=n[1];else{if(y(n,-m,m,t),!n)throw Error(i+t+" cannot be zero: "+n);D=-(F=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(i+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw B=!n,Error(i+"crypto unavailable");B=n}else B=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(y(n=e[t],0,9,t),U=n),e.hasOwnProperty(t="POW_PRECISION")&&(y(n=e[t],0,m,t),L=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(i+t+" not an object: "+n);G=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(i+t+" invalid: "+n);$="0123456789"==n.slice(0,10),q=n}}return{DECIMAL_PLACES:O,ROUNDING_MODE:R,EXPONENTIAL_AT:[x,N],RANGE:[D,F],CRYPTO:B,MODULO_MODE:U,POW_PRECISION:L,FORMAT:G,ALPHABET:q}},H.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!H.DEBUG)return!0;var t,n,r=e.c,a=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(r)){if((1===o||-1===o)&&a>=-m&&a<=m&&a===s(a)){if(0===r[0]){if(0===a&&1===r.length)return!0;break e}if((t=(a+1)%l)<1&&(t+=l),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=c||n!==s(n))break e;if(0!==n)return!0}}}else if(null===r&&null===a&&(null===o||1===o||-1===o))return!0;throw Error(i+"Invalid BigNumber: "+e)},H.maximum=H.max=function(){return W(arguments,-1)},H.minimum=H.min=function(){return W(arguments,1)},H.random=(_=9007199254740992,E=Math.random()*_&2097151?function(){return s(Math.random()*_)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,r,o,c,u=0,p=[],f=new H(j);if(null==e?e=O:y(e,0,m),o=a(e/l),B)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(c=131072*t[u]+(t[u+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[u]=n[0],t[u+1]=n[1]):(p.push(c%1e14),u+=2);u=o/2}else{if(!crypto.randomBytes)throw B=!1,Error(i+"crypto unavailable");for(t=crypto.randomBytes(o*=7);u<o;)(c=281474976710656*(31&t[u])+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(p.push(c%1e14),u+=7);u=o/7}if(!B)for(;u<o;)(c=E())<9e15&&(p[u++]=c%1e14);for(o=p[--u],e%=l,o&&e&&(c=d[l-e],p[u]=s(o/c)*c);0===p[u];p.pop(),u--);if(u<0)p=[r=0];else{for(r=-1;0===p[0];p.splice(0,1),r-=l);for(u=1,c=p[0];c>=10;c/=10,u++);u<l&&(r-=l-u)}return f.e=r,f.c=p,f}),H.sum=function(){for(var e=1,t=arguments,n=new H(t[0]);e<t.length;)n=n.plus(t[e++]);return n},T=function(){var e="0123456789";function t(e,t,n,r){for(var a,s,i=[0],o=0,c=e.length;o<c;){for(s=i.length;s--;i[s]*=t);for(i[0]+=r.indexOf(e.charAt(o++)),a=0;a<i.length;a++)i[a]>n-1&&(null==i[a+1]&&(i[a+1]=0),i[a+1]+=i[a]/n|0,i[a]%=n)}return i.reverse()}return function(r,a,s,i,o){var c,l,u,d,p,m,f,g,y=r.indexOf("."),w=O,v=R;for(y>=0&&(d=L,L=0,r=r.replace(".",""),m=(g=new H(a)).pow(r.length-y),L=d,g.c=t(b(h(m.c),m.e,"0"),10,s,e),g.e=g.c.length),u=d=(f=t(r,a,s,o?(c=q,e):(c=e,q))).length;0==f[--d];f.pop());if(!f[0])return c.charAt(0);if(y<0?--u:(m.c=f,m.e=u,m.s=i,f=(m=n(m,g,w,v,s)).c,p=m.r,u=m.e),y=f[l=u+w+1],d=s/2,p=p||l<0||null!=f[l+1],p=v<4?(null!=y||p)&&(0==v||v==(m.s<0?3:2)):y>d||y==d&&(4==v||p||6==v&&1&f[l-1]||v==(m.s<0?8:7)),l<1||!f[0])r=p?b(c.charAt(1),-w,c.charAt(0)):c.charAt(0);else{if(f.length=l,p)for(--s;++f[--l]>s;)f[l]=0,l||(++u,f=[1].concat(f));for(d=f.length;!f[--d];);for(y=0,r="";y<=d;r+=c.charAt(f[y++]));r=b(r,u,c.charAt(0))}return r}}(),n=function(){function e(e,t,n){var r,a,s,i,o=0,c=e.length,l=t%p,u=t/p|0;for(e=e.slice();c--;)o=((a=l*(s=e[c]%p)+(r=u*s+(i=e[c]/p|0)*l)%p*p+o)/n|0)+(r/p|0)+u*i,e[c]=a%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,r){var a,s;if(n!=r)s=n>r?1:-1;else for(a=s=0;a<n;a++)if(e[a]!=t[a]){s=e[a]>t[a]?1:-1;break}return s}function n(e,t,n,r){for(var a=0;n--;)e[n]-=a,a=e[n]<t[n]?1:0,e[n]=a*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,a,i,o,u){var d,p,m,h,g,y,w,v,b,T,k,_,E,P,S,A,C,I=r.s==a.s?1:-1,M=r.c,j=a.c;if(!(M&&M[0]&&j&&j[0]))return new H(r.s&&a.s&&(M?!j||M[0]!=j[0]:j)?M&&0==M[0]||!j?0*I:I/0:NaN);for(b=(v=new H(I)).c=[],I=i+(p=r.e-a.e)+1,u||(u=c,p=f(r.e/l)-f(a.e/l),I=I/l|0),m=0;j[m]==(M[m]||0);m++);if(j[m]>(M[m]||0)&&p--,I<0)b.push(1),h=!0;else{for(P=M.length,A=j.length,m=0,I+=2,(g=s(u/(j[0]+1)))>1&&(j=e(j,g,u),M=e(M,g,u),A=j.length,P=M.length),E=A,k=(T=M.slice(0,A)).length;k<A;T[k++]=0);C=j.slice(),C=[0].concat(C),S=j[0],j[1]>=u/2&&S++;do{if(g=0,(d=t(j,T,A,k))<0){if(_=T[0],A!=k&&(_=_*u+(T[1]||0)),(g=s(_/S))>1)for(g>=u&&(g=u-1),w=(y=e(j,g,u)).length,k=T.length;1==t(y,T,w,k);)g--,n(y,A<w?C:j,w,u),w=y.length,d=1;else 0==g&&(d=g=1),w=(y=j.slice()).length;if(w<k&&(y=[0].concat(y)),n(T,y,k,u),k=T.length,-1==d)for(;t(j,T,A,k)<1;)g++,n(T,A<k?C:j,k,u),k=T.length}else 0===d&&(g++,T=[0]);b[m++]=g,T[0]?T[k++]=M[E]||0:(T=[M[E]],k=1)}while((E++<P||null!=T[0])&&I--);h=null!=T[0],b[0]||b.splice(0,1)}if(u==c){for(m=1,I=b[0];I>=10;I/=10,m++);z(v,i+(v.e=m+p*l-1)+1,o,h)}else v.e=p,v.r=+h;return v}}(),P=/^(-?)0([xbo])(?=\w[\w.]*$)/i,S=/^([^.]+)\.$/,A=/^\.([^.]+)$/,C=/^-?(Infinity|NaN)$/,I=/^\s*\+(?=[\w.])|^\s+|\s+$/g,k=function(e,t,n,r){var a,s=n?t:t.replace(I,"");if(C.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!n&&(s=s.replace(P,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,r&&r!=a?e:t}),r&&(a=r,s=s.replace(S,"$1").replace(A,"0.$1")),t!=s))return new H(s,a);if(H.DEBUG)throw Error(i+"Not a"+(r?" base "+r:"")+" number: "+t);e.s=null}e.c=e.e=null},M.absoluteValue=M.abs=function(){var e=new H(this);return e.s<0&&(e.s=1),e},M.comparedTo=function(e,t){return g(this,new H(e,t))},M.decimalPlaces=M.dp=function(e,t){var n,r,a,s=this;if(null!=e)return y(e,0,m),null==t?t=R:y(t,0,8),z(new H(s),e+s.e+1,t);if(!(n=s.c))return null;if(r=((a=n.length-1)-f(this.e/l))*l,a=n[a])for(;a%10==0;a/=10,r--);return r<0&&(r=0),r},M.dividedBy=M.div=function(e,t){return n(this,new H(e,t),O,R)},M.dividedToIntegerBy=M.idiv=function(e,t){return n(this,new H(e,t),0,1)},M.exponentiatedBy=M.pow=function(e,t){var n,r,o,c,u,d,p,m,f=this;if((e=new H(e)).c&&!e.isInteger())throw Error(i+"Exponent not an integer: "+K(e));if(null!=t&&(t=new H(t)),u=e.e>14,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return m=new H(Math.pow(+K(f),u?e.s*(2-w(e)):+K(e))),t?m.mod(t):m;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new H(NaN);(r=!d&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(e.e>9&&(f.e>0||f.e<-1||(0==f.e?f.c[0]>1||u&&f.c[1]>=24e7:f.c[0]<8e13||u&&f.c[0]<=9999975e7)))return c=f.s<0&&w(e)?-0:0,f.e>-1&&(c=1/c),new H(d?1/c:c);L&&(c=a(L/l+2))}for(u?(n=new H(.5),d&&(e.s=1),p=w(e)):p=(o=Math.abs(+K(e)))%2,m=new H(j);;){if(p){if(!(m=m.times(f)).c)break;c?m.c.length>c&&(m.c.length=c):r&&(m=m.mod(t))}if(o){if(0===(o=s(o/2)))break;p=o%2}else if(z(e=e.times(n),e.e+1,1),e.e>14)p=w(e);else{if(0===(o=+K(e)))break;p=o%2}f=f.times(f),c?f.c&&f.c.length>c&&(f.c.length=c):r&&(f=f.mod(t))}return r?m:(d&&(m=j.div(m)),t?m.mod(t):c?z(m,L,R,undefined):m)},M.integerValue=function(e){var t=new H(this);return null==e?e=R:y(e,0,8),z(t,t.e+1,e)},M.isEqualTo=M.eq=function(e,t){return 0===g(this,new H(e,t))},M.isFinite=function(){return!!this.c},M.isGreaterThan=M.gt=function(e,t){return g(this,new H(e,t))>0},M.isGreaterThanOrEqualTo=M.gte=function(e,t){return 1===(t=g(this,new H(e,t)))||0===t},M.isInteger=function(){return!!this.c&&f(this.e/l)>this.c.length-2},M.isLessThan=M.lt=function(e,t){return g(this,new H(e,t))<0},M.isLessThanOrEqualTo=M.lte=function(e,t){return-1===(t=g(this,new H(e,t)))||0===t},M.isNaN=function(){return!this.s},M.isNegative=function(){return this.s<0},M.isPositive=function(){return this.s>0},M.isZero=function(){return!!this.c&&0==this.c[0]},M.minus=function(e,t){var n,r,a,s,i=this,o=i.s;if(t=(e=new H(e,t)).s,!o||!t)return new H(NaN);if(o!=t)return e.s=-t,i.plus(e);var u=i.e/l,d=e.e/l,p=i.c,m=e.c;if(!u||!d){if(!p||!m)return p?(e.s=-t,e):new H(m?i:NaN);if(!p[0]||!m[0])return m[0]?(e.s=-t,e):new H(p[0]?i:3==R?-0:0)}if(u=f(u),d=f(d),p=p.slice(),o=u-d){for((s=o<0)?(o=-o,a=p):(d=u,a=m),a.reverse(),t=o;t--;a.push(0));a.reverse()}else for(r=(s=(o=p.length)<(t=m.length))?o:t,o=t=0;t<r;t++)if(p[t]!=m[t]){s=p[t]<m[t];break}if(s&&(a=p,p=m,m=a,e.s=-e.s),(t=(r=m.length)-(n=p.length))>0)for(;t--;p[n++]=0);for(t=c-1;r>o;){if(p[--r]<m[r]){for(n=r;n&&!p[--n];p[n]=t);--p[n],p[r]+=c}p[r]-=m[r]}for(;0==p[0];p.splice(0,1),--d);return p[0]?V(e,p,d):(e.s=3==R?-1:1,e.c=[e.e=0],e)},M.modulo=M.mod=function(e,t){var r,a,s=this;return e=new H(e,t),!s.c||!e.s||e.c&&!e.c[0]?new H(NaN):!e.c||s.c&&!s.c[0]?new H(s):(9==U?(a=e.s,e.s=1,r=n(s,e,0,3),e.s=a,r.s*=a):r=n(s,e,0,U),(e=s.minus(r.times(e))).c[0]||1!=U||(e.s=s.s),e)},M.multipliedBy=M.times=function(e,t){var n,r,a,s,i,o,u,d,m,h,g,y,w,v,b,T=this,k=T.c,_=(e=new H(e,t)).c;if(!(k&&_&&k[0]&&_[0]))return!T.s||!e.s||k&&!k[0]&&!_||_&&!_[0]&&!k?e.c=e.e=e.s=null:(e.s*=T.s,k&&_?(e.c=[0],e.e=0):e.c=e.e=null),e;for(r=f(T.e/l)+f(e.e/l),e.s*=T.s,(u=k.length)<(h=_.length)&&(w=k,k=_,_=w,a=u,u=h,h=a),a=u+h,w=[];a--;w.push(0));for(v=c,b=p,a=h;--a>=0;){for(n=0,g=_[a]%b,y=_[a]/b|0,s=a+(i=u);s>a;)n=((d=g*(d=k[--i]%b)+(o=y*d+(m=k[i]/b|0)*g)%b*b+w[s]+n)/v|0)+(o/b|0)+y*m,w[s--]=d%v;w[s]=n}return n?++r:w.splice(0,1),V(e,w,r)},M.negated=function(){var e=new H(this);return e.s=-e.s||null,e},M.plus=function(e,t){var n,r=this,a=r.s;if(t=(e=new H(e,t)).s,!a||!t)return new H(NaN);if(a!=t)return e.s=-t,r.minus(e);var s=r.e/l,i=e.e/l,o=r.c,u=e.c;if(!s||!i){if(!o||!u)return new H(a/0);if(!o[0]||!u[0])return u[0]?e:new H(o[0]?r:0*a)}if(s=f(s),i=f(i),o=o.slice(),a=s-i){for(a>0?(i=s,n=u):(a=-a,n=o),n.reverse();a--;n.push(0));n.reverse()}for((a=o.length)-(t=u.length)<0&&(n=u,u=o,o=n,t=a),a=0;t;)a=(o[--t]=o[t]+u[t]+a)/c|0,o[t]=c===o[t]?0:o[t]%c;return a&&(o=[a].concat(o),++i),V(e,o,i)},M.precision=M.sd=function(e,t){var n,r,a,s=this;if(null!=e&&e!==!!e)return y(e,1,m),null==t?t=R:y(t,0,8),z(new H(s),e,t);if(!(n=s.c))return null;if(r=(a=n.length-1)*l+1,a=n[a]){for(;a%10==0;a/=10,r--);for(a=n[0];a>=10;a/=10,r++);}return e&&s.e+1>r&&(r=s.e+1),r},M.shiftedBy=function(e){return y(e,-9007199254740991,u),this.times("1e"+e)},M.squareRoot=M.sqrt=function(){var e,t,r,a,s,i=this,o=i.c,c=i.s,l=i.e,u=O+4,d=new H("0.5");if(1!==c||!o||!o[0])return new H(!c||c<0&&(!o||o[0])?NaN:o?i:1/0);if(0==(c=Math.sqrt(+K(i)))||c==1/0?(((t=h(o)).length+l)%2==0&&(t+="0"),c=Math.sqrt(+t),l=f((l+1)/2)-(l<0||l%2),r=new H(t=c==1/0?"5e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):r=new H(c+""),r.c[0])for((c=(l=r.e)+u)<3&&(c=0);;)if(s=r,r=d.times(s.plus(n(i,s,u,1))),h(s.c).slice(0,c)===(t=h(r.c)).slice(0,c)){if(r.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(a||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(z(r,r.e+O+2,1),e=!r.times(r).eq(i));break}if(!a&&(z(s,s.e+O+2,0),s.times(s).eq(i))){r=s;break}u+=4,c+=4,a=1}return z(r,r.e+O+1,R,e)},M.toExponential=function(e,t){return null!=e&&(y(e,0,m),e++),Y(this,e,t,1)},M.toFixed=function(e,t){return null!=e&&(y(e,0,m),e=e+this.e+1),Y(this,e,t)},M.toFormat=function(e,t,n){var r,a=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=G;else if("object"!=typeof n)throw Error(i+"Argument not an object: "+n);if(r=a.toFixed(e,t),a.c){var s,o=r.split("."),c=+n.groupSize,l=+n.secondaryGroupSize,u=n.groupSeparator||"",d=o[0],p=o[1],m=a.s<0,f=m?d.slice(1):d,h=f.length;if(l&&(s=c,c=l,l=s,h-=s),c>0&&h>0){for(s=h%c||c,d=f.substr(0,s);s<h;s+=c)d+=u+f.substr(s,c);l>0&&(d+=u+f.slice(s)),m&&(d="-"+d)}r=p?d+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?p.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):p):d}return(n.prefix||"")+r+(n.suffix||"")},M.toFraction=function(e){var t,r,a,s,o,c,u,p,m,f,g,y,w=this,v=w.c;if(null!=e&&(!(u=new H(e)).isInteger()&&(u.c||1!==u.s)||u.lt(j)))throw Error(i+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+K(u));if(!v)return new H(w);for(t=new H(j),m=r=new H(j),a=p=new H(j),y=h(v),o=t.e=y.length-w.e-1,t.c[0]=d[(c=o%l)<0?l+c:c],e=!e||u.comparedTo(t)>0?o>0?t:m:u,c=F,F=1/0,u=new H(y),p.c[0]=0;f=n(u,t,0,1),1!=(s=r.plus(f.times(a))).comparedTo(e);)r=a,a=s,m=p.plus(f.times(s=m)),p=s,t=u.minus(f.times(s=t)),u=s;return s=n(e.minus(r),a,0,1),p=p.plus(s.times(m)),r=r.plus(s.times(a)),p.s=m.s=w.s,g=n(m,a,o*=2,R).minus(w).abs().comparedTo(n(p,r,o,R).minus(w).abs())<1?[m,a]:[p,r],F=c,g},M.toNumber=function(){return+K(this)},M.toPrecision=function(e,t){return null!=e&&y(e,1,m),Y(this,e,t,2)},M.toString=function(e){var t,n=this,r=n.s,a=n.e;return null===a?r?(t="Infinity",r<0&&(t="-"+t)):t="NaN":(null==e?t=a<=x||a>=N?v(h(n.c),a):b(h(n.c),a,"0"):10===e&&$?t=b(h((n=z(new H(n),O+a+1,R)).c),n.e,"0"):(y(e,2,q.length,"Base"),t=T(b(h(n.c),a,"0"),10,e,r,!0)),r<0&&n.c[0]&&(t="-"+t)),t},M.valueOf=M.toJSON=function(){return K(this)},M._isBigNumber=!0,null!=t&&H.set(t),H}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/transaction-pay-controller>bignumber.js",file:"node_modules/@metamask/transaction-pay-controller/node_modules/bignumber.js/bignumber.js"}],[3043,{"./constants.cjs":3044,"./helpers/Bundler.cjs":3045,"./helpers/PendingUserOperationTracker.cjs":3046,"./helpers/SnapSmartContractAccount.cjs":3047,"./logger.cjs":3049,"./types.cjs":3050,"./utils/gas-fees.cjs":3052,"./utils/gas.cjs":3053,"./utils/transaction.cjs":3054,"./utils/validation.cjs":3055,"@metamask/base-controller":1311,"@metamask/controller-utils":1384,"@metamask/eth-query":1972,"@metamask/rpc-errors":2594,"@metamask/transaction-controller":2989,"@metamask/utils":3070,events:4338,lodash:4794,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,p,m,f,h,g,y,w,v,b,T,k,_,E,P,S,A=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},C=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},I=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.UserOperationController=void 0;const M=e("@metamask/base-controller"),j=e("@metamask/controller-utils"),O=I(e("@metamask/eth-query")),R=e("@metamask/rpc-errors"),x=e("@metamask/transaction-controller"),N=e("@metamask/utils"),D=I(e("events")),F=e("lodash"),B=e("uuid"),U=e("./constants.cjs"),L=e("./helpers/Bundler.cjs"),G=e("./helpers/PendingUserOperationTracker.cjs"),q=e("./helpers/SnapSmartContractAccount.cjs"),$=e("./logger.cjs"),H=e("./types.cjs"),Y=e("./utils/gas.cjs"),W=e("./utils/gas-fees.cjs"),V=e("./utils/transaction.cjs"),z=e("./utils/validation.cjs"),K={userOperations:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};class Q extends M.BaseController{constructor({entrypoint:e,getGasFeeEstimates:t,messenger:n,state:o}){super({name:"UserOperationController",metadata:K,messenger:n,state:{userOperations:{},...o}}),r.add(this),a.set(this,void 0),s.set(this,void 0),i.set(this,void 0),this.hub=new D.default,A(this,a,e,"f"),A(this,s,t,"f"),A(this,i,new G.PendingUserOperationTracker({getUserOperations:()=>(0,F.cloneDeep)(Object.values(this.state.userOperations)),messenger:n}),"f"),C(this,r,"m",T).call(this)}async addUserOperation(e,t){return(0,z.validateAddUserOperationRequest)(e),(0,z.validateAddUserOperationOptions)(t),await C(this,r,"m",o).call(this,e,t)}async addUserOperationFromTransaction(e,t){(0,z.validateAddUserOperationOptions)(t);const{data:n,from:a,maxFeePerGas:s,maxPriorityFeePerGas:i,to:c,value:l}=e,u={data:""===n?undefined:n,from:a,maxFeePerGas:s,maxPriorityFeePerGas:i,to:c,value:l};return(0,z.validateAddUserOperationRequest)(u),await C(this,r,"m",o).call(this,u,{...t,transaction:e})}startPollingByNetworkClientId(e){return C(this,i,"f").startPolling({networkClientId:e})}}n.UserOperationController=Q,a=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakSet,o=async function(e,t){(0,$.projectLogger)("Adding user operation",{request:e,options:t});const{networkClientId:n,origin:a,smartContractAccount:s,swaps:i,transaction:o}=t,{chainId:d,provider:p}=await C(this,r,"m",E).call(this,n),m=await C(this,r,"m",u).call(this,d,a,o,i),f=s??new q.SnapSmartContractAccount(this.messenger),h={chainId:d,metadata:m,options:{...t,smartContractAccount:f},provider:p,request:e,transaction:o},{id:y}=m;let w=!1;const v=(async()=>{try{return await C(this,r,"m",c).call(this,h)}catch(e){if(C(this,r,"m",g).call(this,m,e),w)throw e;return undefined}})(),b=async()=>(w=!0,await v);return{id:y,hash:b,transactionHash:async()=>{await b();const{transactionHash:e}=await C(this,r,"m",l).call(this,m);return e}}},c=async function(e){const{metadata:t,options:n}=e,{requireApproval:a,smartContractAccount:s}=n;let i;try{return await C(this,r,"m",d).call(this,e),await C(this,r,"m",p).call(this,t,s),this.hub.emit("user-operation-added",t),!1!==a&&(i=await C(this,r,"m",m).call(this,e)),await C(this,r,"m",f).call(this,t,s),await C(this,r,"m",h).call(this,t),i?.success(),t.hash}catch(e){throw i?.error(e),e}},l=async function(e){const{id:t,hash:n}=e;return(0,$.projectLogger)("Waiting for confirmation",t,n),new Promise((e,n)=>{this.hub.once(`${t}:confirmed`,t=>{e(t)}),this.hub.once(`${t}:failed`,(e,t)=>{n(t)})})},u=async function(e,t,n,a){const s={actualGasCost:null,actualGasUsed:null,baseFeePerGas:null,bundlerUrl:null,chainId:e,error:null,hash:null,id:(0,B.v1)(),origin:t,status:H.UserOperationStatus.Unapproved,swapsMetadata:a?{approvalTxId:a.approvalTxId??null,destinationTokenAddress:a.destinationTokenAddress??null,destinationTokenAmount:a.destinationTokenAmount??null,destinationTokenDecimals:a.destinationTokenDecimals??null,destinationTokenSymbol:a.destinationTokenSymbol??null,estimatedBaseFee:a.estimatedBaseFee??null,sourceTokenAddress:a.sourceTokenAddress??null,sourceTokenAmount:a.sourceTokenAmount??null,sourceTokenDecimals:a.sourceTokenDecimals??null,sourceTokenSymbol:a.sourceTokenSymbol??null,swapAndSendRecipient:a.swapAndSendRecipient??null,swapMetaData:a.swapMetaData??null,swapTokenValue:a.swapTokenValue??null}:null,time:Date.now(),transactionHash:null,transactionParams:n??null,transactionType:null,userFeeLevel:null,userOperation:C(this,r,"m",y).call(this,n)};return C(this,r,"m",w).call(this,s),(0,$.projectLogger)("Added user operation",s.id),s},d=async function(e){const{chainId:t,metadata:n,options:i,provider:o,request:c,transaction:l}=e,{data:u,from:d,to:p,value:m}=c,{id:f,transactionParams:h,userOperation:g}=n,{smartContractAccount:y}=i;(0,$.projectLogger)("Preparing user operation",{id:f});const v=await C(this,r,"m",_).call(this,l,o,i);n.transactionType=v??null,(0,$.projectLogger)("Determined transaction type",v),await(0,W.updateGasFees)({getGasFeeEstimates:C(this,s,"f"),metadata:n,originalRequest:c,provider:o,transaction:h??undefined});const b=await y.prepareUserOperation({chainId:t,data:u,from:d,to:p,value:m});(0,z.validatePrepareUserOperationResponse)(b);const{bundler:T,callData:k,dummyPaymasterAndData:E,dummySignature:P,initCode:S,nonce:A,sender:I}=b;g.callData=k,g.initCode=S??U.EMPTY_BYTES,g.nonce=A,g.paymasterAndData=E??U.EMPTY_BYTES,g.sender=I,g.signature=P??U.EMPTY_BYTES,n.bundlerUrl=T,await(0,Y.updateGas)(n,b,C(this,a,"f")),C(this,r,"m",w).call(this,n)},p=async function(e,t){const{id:n,userOperation:a,chainId:s}=e;(0,$.projectLogger)("Requesting paymaster data",{id:n});const i=await t.updateUserOperation({userOperation:a,chainId:s});(0,z.validateUpdateUserOperationResponse)(i),a.paymasterAndData=i.paymasterAndData??U.EMPTY_BYTES,i.callGasLimit&&(a.callGasLimit=i.callGasLimit),i.preVerificationGas&&(a.preVerificationGas=i.preVerificationGas),i.verificationGasLimit&&(a.verificationGasLimit=i.verificationGasLimit),C(this,r,"m",w).call(this,e)},m=async function(e){(0,$.projectLogger)("Requesting approval");const{metadata:t}=e,{resultCallbacks:n,value:a}=await C(this,r,"m",k).call(this,t),s=a?.txMeta;return s&&await C(this,r,"m",P).call(this,e,s),t.status=H.UserOperationStatus.Approved,C(this,r,"m",w).call(this,t),n},f=async function(e,t){const{id:n,chainId:a,userOperation:s}=e;(0,$.projectLogger)("Signing user operation",n,s);const i=await t.signUserOperation({userOperation:s,chainId:a});(0,z.validateSignUserOperationResponse)(i);const{signature:o}=i;s.signature=o,(0,$.projectLogger)("Signed user operation",o),e.status=H.UserOperationStatus.Signed,C(this,r,"m",w).call(this,e)},h=async function(e){const{userOperation:t}=e;(0,$.projectLogger)("Submitting user operation",t);const n=new L.Bundler(e.bundlerUrl),s=await n.sendUserOperation(t,C(this,a,"f"));e.hash=s,e.status=H.UserOperationStatus.Submitted,C(this,r,"m",w).call(this,e)},g=function(e,t){const{id:n}=e,a=t;(0,$.projectLogger)("User operation failed",n,t),e.error={name:a.name,message:a.message,stack:a.stack,code:a.code,rpc:a.value},e.status=H.UserOperationStatus.Failed,C(this,r,"m",w).call(this,e),String(a.code)===String(R.errorCodes.provider.userRejectedRequest)&&C(this,r,"m",v).call(this,n)},y=function(e){return{callData:U.EMPTY_BYTES,callGasLimit:U.EMPTY_BYTES,initCode:U.EMPTY_BYTES,maxFeePerGas:e?.maxFeePerGas??U.EMPTY_BYTES,maxPriorityFeePerGas:e?.maxPriorityFeePerGas??U.EMPTY_BYTES,nonce:U.EMPTY_BYTES,paymasterAndData:U.EMPTY_BYTES,preVerificationGas:U.EMPTY_BYTES,sender:U.ADDRESS_ZERO,signature:U.EMPTY_BYTES,verificationGasLimit:U.EMPTY_BYTES}},w=function(e){const{id:t}=e;this.update(n=>{n.userOperations[t]=(0,F.cloneDeep)(e)}),C(this,r,"m",b).call(this,e)},v=function(e){this.update(t=>{delete t.userOperations[e]})},b=function(e){if(!e.transactionParams)return;const t=(0,V.getTransactionMetadata)(e);this.hub.emit("transaction-updated",t)},T=function(){C(this,i,"f").hub.on("user-operation-confirmed",e=>{(0,$.projectLogger)("In listener..."),this.hub.emit("user-operation-confirmed",e),this.hub.emit(`${e.id}:confirmed`,e)}),C(this,i,"f").hub.on("user-operation-failed",(e,t)=>{this.hub.emit("user-operation-failed",e,t),this.hub.emit(`${e.id}:failed`,e,t)}),C(this,i,"f").hub.on("user-operation-updated",e=>{C(this,r,"m",w).call(this,e)})},k=async function(e){const{id:t,origin:n}=e,r=j.ApprovalType.Transaction,a={txId:t};return await this.messenger.call("ApprovalController:addRequest",{id:t,origin:n,type:r,requestData:a,expectsResult:!0},!0)},_=async function(e,t,n){if(!e)return undefined;if(n.type)return n.type;const r=new O.default(t),a=(0,x.determineTransactionType)(e,r);return(await a).type},E=async function(e){const{provider:t,configuration:n}=this.messenger.call("NetworkController:getNetworkClientById",e),{chainId:r}=n;return{provider:t,chainId:r}},P=async function(e,t){(0,$.projectLogger)("Found updated transaction in approval",{updatedTransaction:t});const{metadata:n,request:a}=e,{userOperation:s}=n,i=s.paymasterAndData!==U.EMPTY_BYTES,o=(0,N.add0x)(t.txParams.maxFeePerGas),c=(0,N.add0x)(t.txParams.maxPriorityFeePerGas);let l=!1;const u=s.maxFeePerGas,d=s.maxPriorityFeePerGas,p=u!==o||d!==c,m=i&&o===U.VALUE_ZERO&&c===U.VALUE_ZERO;p&&!m&&((0,$.projectLogger)("Gas fees updated during approval",{previousMaxFeePerGas:u,previousMaxPriorityFeePerGas:d,updatedMaxFeePerGas:o,updatedMaxPriorityFeePerGas:c}),s.maxFeePerGas=o,s.maxPriorityFeePerGas=c,l=i);const f=a.data??U.EMPTY_BYTES,h=t.txParams.data??U.EMPTY_BYTES;f!==h&&((0,$.projectLogger)("Data updated during approval",{previousData:f,updatedData:h}),l=!0);const g=a.value??U.VALUE_ZERO,y=t.txParams.value??U.VALUE_ZERO;if(g!==y&&((0,$.projectLogger)("Value updated during approval",{previousValue:g,updatedValue:y}),l=!0),l){const t={...a,data:h,maxFeePerGas:o,maxPriorityFeePerGas:c,value:y};await C(this,r,"m",S).call(this,{...e,request:t})}},S=async function(e){(0,$.projectLogger)("Regenerating user operation as parameters were updated during approval");const{options:{smartContractAccount:t},metadata:n}=e;await C(this,r,"m",d).call(this,e),await C(this,r,"m",p).call(this,n,t),(0,$.projectLogger)("Regenerated user operation",n.userOperation)}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/UserOperationController.cjs"}],[3044,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.VALUE_ZERO=n.ADDRESS_ZERO=n.EMPTY_BYTES=void 0,n.EMPTY_BYTES="0x",n.ADDRESS_ZERO="0x0000000000000000000000000000000000000000",n.VALUE_ZERO="0x0"}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/constants.cjs"}],[3045,{"../logger.cjs":3049},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.Bundler=void 0;const c=e("../logger.cjs"),l=(0,c.createModuleLogger)(c.projectLogger,"bundler");n.Bundler=class{constructor(e){r.add(this),a.set(this,void 0),i(this,a,e,"f")}async estimateUserOperationGas(e,t){l("Estimating gas",{url:o(this,a,"f"),userOperation:e,entrypoint:t});const n=await o(this,r,"m",s).call(this,"eth_estimateUserOperationGas",[e,t]);return l("Estimated gas",{response:n}),n}async getUserOperationReceipt(e){return l("Getting user operation receipt",{url:o(this,a,"f"),hash:e}),await o(this,r,"m",s).call(this,"eth_getUserOperationReceipt",[e])}async sendUserOperation(e,t){l("Sending user operation",{url:o(this,a,"f"),userOperation:e,entrypoint:t});const n=await o(this,r,"m",s).call(this,"eth_sendUserOperation",[e,t]);return l("Sent user operation",n),n}},a=new WeakMap,r=new WeakSet,s=async function(e,t){const n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:e,params:t})},r=await fetch(o(this,a,"f"),n),s=await r.json();if(s.error){const e=new Error(s.error.message||s.error);throw e.code=s.error.code,e}return s.result}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/Bundler.cjs"}],[3046,{"../logger.cjs":3049,"../types.cjs":3050,"./Bundler.cjs":3045,"@metamask/controller-utils":1384,"@metamask/eth-query":1972,"@metamask/polling-controller":3059,"@metamask/utils":3070,events:4338},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a,s,i,o,c,l,u,d,p,m,f=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PendingUserOperationTracker=void 0;const y=e("@metamask/controller-utils"),w=g(e("@metamask/eth-query")),v=e("@metamask/polling-controller"),b=e("@metamask/utils"),T=g(e("events")),k=e("../logger.cjs"),_=e("../types.cjs"),E=e("./Bundler.cjs"),P=(0,b.createModuleLogger)(k.projectLogger,"pending-user-operations");class S extends((0,v.BlockTrackerPollingControllerOnly)()){constructor({getUserOperations:e,messenger:t}){super(),r.add(this),a.set(this,void 0),s.set(this,void 0),this.hub=new T.default,f(this,a,e,"f"),f(this,s,t,"f")}async _executePoll({networkClientId:e}){try{const{blockTracker:t,configuration:n,provider:a}=this._getNetworkClientById(e);P("Polling",{blockNumber:t.getCurrentBlock(),chainId:n.chainId}),await h(this,r,"m",i).call(this,n.chainId,a)}catch(e){P("Failed to check user operations",e)}}_getNetworkClientById(e){return h(this,s,"f").call("NetworkController:getNetworkClientById",e)}}n.PendingUserOperationTracker=S,a=new WeakMap,s=new WeakMap,r=new WeakSet,i=async function(e,t){const n=h(this,r,"m",u).call(this).filter(t=>t.chainId===e);n.length?(P("Found pending user operations to check",{count:n.length,ids:n.map(e=>e.id)}),await Promise.all(n.map(e=>h(this,r,"m",o).call(this,e,t)))):P("No pending user operations to check")},o=async function(e,t){const{bundlerUrl:n,hash:a,id:s}=e;if(a&&n)try{const i=await h(this,r,"m",p).call(this,a,n),o=i?.success;if(i&&!o)return void h(this,r,"m",l).call(this,e,i);if(o)return void await h(this,r,"m",c).call(this,e,i,t);P("No receipt found for user operation",{id:s,hash:a})}catch(e){P("Failed to check user operation",s,e)}else P("Skipping user operation as missing hash or bundler",s)},c=async function(e,t,n){const{id:a}=e,{actualGasCost:s,actualGasUsed:i,receipt:{blockHash:o,transactionHash:c}}=t;P("User operation confirmed",a,c);const{baseFeePerGas:l}=await(0,y.query)(new w.default(n),"getBlockByHash",[o,!1]);e.actualGasCost=h(this,r,"m",m).call(this,s),e.actualGasUsed=h(this,r,"m",m).call(this,i),e.baseFeePerGas=l,e.status=_.UserOperationStatus.Confirmed,e.transactionHash=c,h(this,r,"m",d).call(this,e),this.hub.emit("user-operation-confirmed",e)},l=function(e,t){const{id:n}=e;P("User operation failed",n),e.status=_.UserOperationStatus.Failed,h(this,r,"m",d).call(this,e),this.hub.emit("user-operation-failed",e,new Error("User operation receipt has failed status"))},u=function(){return h(this,a,"f").call(this).filter(e=>e.status===_.UserOperationStatus.Submitted)},d=function(e){this.hub.emit("user-operation-updated",e)},p=async function(e,t){return new E.Bundler(t).getUserOperationReceipt(e)},m=function(e){return"number"==typeof e?(0,y.toHex)(e):e}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/PendingUserOperationTracker.cjs"}],[3047,{"../constants.cjs":3044,"../utils/chain-id.cjs":3051},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r,a=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},s=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapSmartContractAccount=void 0;const i=e("../constants.cjs"),o=e("../utils/chain-id.cjs");n.SnapSmartContractAccount=class{constructor(e){r.set(this,void 0),a(this,r,e,"f")}async prepareUserOperation(e){const{chainId:t,data:n,from:a,to:c,value:l}=e,u=n??i.EMPTY_BYTES,d=c??i.ADDRESS_ZERO,p=l??i.VALUE_ZERO,m=await s(this,r,"f").call("KeyringController:prepareUserOperation",a,[{data:u,to:d,value:p}],{chainId:(0,o.toEip155ChainId)(t)}),{bundlerUrl:f,callData:h,dummyPaymasterAndData:g,dummySignature:y,gasLimits:w,initCode:v,nonce:b}=m;return{bundler:f,callData:h,dummyPaymasterAndData:g,dummySignature:y,gas:w,initCode:v,nonce:b,sender:a}}async updateUserOperation(e){const{userOperation:t,chainId:n}=e,{sender:a}=t,{paymasterAndData:c,verificationGasLimit:l,preVerificationGas:u,callGasLimit:d}=await s(this,r,"f").call("KeyringController:patchUserOperation",a,t,{chainId:(0,o.toEip155ChainId)(n)});return{paymasterAndData:c===i.EMPTY_BYTES?undefined:c,verificationGasLimit:l,preVerificationGas:u,callGasLimit:d}}async signUserOperation(e){const{userOperation:t,chainId:n}=e,{sender:a}=t;return{signature:await s(this,r,"f").call("KeyringController:signUserOperation",a,t,{chainId:(0,o.toEip155ChainId)(n)})}}},r=new WeakMap}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/helpers/SnapSmartContractAccount.cjs"}],[3048,{"./UserOperationController.cjs":3043,"./types.cjs":3050},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./UserOperationController.cjs"),n),a(e("./types.cjs"),n)}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/index.cjs"}],[3049,{"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const r=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return r.createModuleLogger}}),n.projectLogger=(0,r.createProjectLogger)("user-operation-controller")}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/logger.cjs"}],[305,{"../../../../../shared/constants/app":5753,"../../../../../shared/constants/network":5772,"./ethereum-chain-utils":307,"@metamask/controller-utils":1384,"@metamask/network-controller":2299,"@metamask/rpc-errors":2594,lodash:4794,"uri-js":5683},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&{}.hasOwnProperty.call(e,s)){var i=a?Object.getOwnPropertyDescriptor(e,s):null;i&&(i.get||i.set)?Object.defineProperty(r,s,i):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(e("uri-js")),a=e("@metamask/controller-utils"),s=e("@metamask/network-controller"),i=e("@metamask/rpc-errors"),o=e("lodash"),c=e("../../../../../shared/constants/app"),l=e("../../../../../shared/constants/network"),u=e("./ethereum-chain-utils");function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}const p={methodNames:[c.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,n,c,{addNetwork:d,updateNetwork:p,getNetworkConfigurationByChainId:m,setActiveNetwork:f,requestUserApproval:h,getCurrentChainIdForDomain:g,getCaveat:y,requestPermittedChainsPermissionIncrementalForOrigin:w,rejectApprovalRequestsForOrigin:v,setTokenNetworkFilter:b,setEnabledNetworks:T,getEnabledNetworks:k}){var _,E;let P;try{P=(0,u.validateAddEthereumChainParams)(e.params[0])}catch(e){return c(e)}const{chainId:S,chainName:A,firstValidBlockExplorerUrl:C,firstValidRPCUrl:I,ticker:M}=P,{origin:j}=e,O=g(j),R=m(S);if(R&&R.chainId===S&&R.nativeCurrency!==M)return c(i.rpcErrors.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${M}`}));let x=R,N=null==R?void 0:R.rpcEndpoints.findIndex(({url:e})=>r.equal(e,I)),D=C?null==R?void 0:R.blockExplorerUrls.findIndex(e=>r.equal(e,C)):undefined;const F=!R||N!==R.defaultRpcEndpointIndex||C&&D!==R.defaultBlockExplorerUrlIndex;if(F)try{if(await h({origin:j,type:a.ApprovalType.AddEthereumChain,requestData:{chainId:S,rpcPrefs:{blockExplorerUrl:C},chainName:A,rpcUrl:I,ticker:M}}),R){const e=(0,o.cloneDeep)(R);-1===N&&(e.rpcEndpoints=[...e.rpcEndpoints,{url:I,type:s.RpcEndpointType.Custom,name:A}],N=e.rpcEndpoints.length-1),C&&(-1===D&&(e.blockExplorerUrls=[...e.blockExplorerUrls,C],D=e.blockExplorerUrls.length-1),e.defaultBlockExplorerUrlIndex=D),x=await p(e.chainId,e,O===S?{replacementSelectedRpcEndpointIndex:e.defaultRpcEndpointIndex}:undefined)}else{const e=l.FEATURED_RPCS.find(e=>e.chainId===S),t=e?e.rpcEndpoints[e.defaultRpcEndpointIndex]:undefined;x=await d({blockExplorerUrls:C?[C]:[],defaultBlockExplorerUrlIndex:C?0:undefined,chainId:S,defaultRpcEndpointIndex:0,name:A,nativeCurrency:M,rpcEndpoints:[...t&&!r.equal(I,t.url)?[t]:[],{url:I,name:A,type:s.RpcEndpointType.Custom}]})}}catch(e){return c(e)}const B=null==R||null===(_=R.rpcEndpoints)||void 0===_||null===(_=_[R.defaultRpcEndpointIndex])||void 0===_?void 0:_.networkClientId,U=null===(E=x)||void 0===E||null===(E=E.rpcEndpoints)||void 0===E||null===(E=E[x.defaultRpcEndpointIndex])||void 0===E?void 0:E.networkClientId,L=B??U;return(0,u.switchChain)(t,c,S,L,{isAddFlow:!0,autoApprove:F,setActiveNetwork:f,getCaveat:y,requestPermittedChainsPermissionIncrementalForOrigin:w,rejectApprovalRequestsForOrigin:v,setTokenNetworkFilter:b,setEnabledNetworks:T,getEnabledNetworks:k})},hookNames:{addNetwork:!0,updateNetwork:!0,getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCurrentChainIdForDomain:!0,getCaveat:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0}};n.default=p}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/add-ethereum-chain.js"}],[3050,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.UserOperationStatus=void 0,function(e){e.Unapproved="unapproved",e.Approved="approved",e.Signed="signed",e.Submitted="submitted",e.Failed="failed",e.Confirmed="confirmed"}(r||(n.UserOperationStatus=r={}))}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/types.cjs"}],[3051,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toEip155ChainId=void 0,n.toEip155ChainId=function(e){const t=Number(e);return Number.isInteger(t)?t.toString():e}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/chain-id.cjs"}],[3052,{"../constants.cjs":3044,"../logger.cjs":3049,"@metamask/controller-utils":1384,"@metamask/eth-query":1972,"@metamask/gas-fee-controller":2060,"@metamask/transaction-controller":2989,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateGasFees=void 0;const a=e("@metamask/controller-utils"),s=r(e("@metamask/eth-query")),i=e("@metamask/gas-fee-controller"),o=e("@metamask/transaction-controller"),c=e("@metamask/utils"),l=e("../constants.cjs"),u=e("../logger.cjs"),d=(0,u.createModuleLogger)(u.projectLogger,"gas-fees");function p(e){return(0,a.toHex)((0,a.gweiDecToWEIBN)(e))}function m(e){return!e||e===l.EMPTY_BYTES}n.updateGasFees=async function(e){const{metadata:t,originalRequest:n,transaction:r}=e,{userOperation:l}=t;let u;const f=async()=>(u||(u=await async function(e){const{getGasFeeEstimates:t,provider:n}=e;try{const{gasFeeEstimates:e,gasEstimateType:n}=await t();if(n===i.GAS_ESTIMATE_TYPES.FEE_MARKET){const{medium:{suggestedMaxPriorityFeePerGas:t,suggestedMaxFeePerGas:n}={}}=e;if(t&&n){const e={maxFeePerGas:p(n),maxPriorityFeePerGas:p(t)};return d("Using medium values from fee market estimate",e),e}}if(n===i.GAS_ESTIMATE_TYPES.LEGACY){const t=p(e.medium);return d("Using medium value from legacy estimate",t),{maxFeePerGas:t}}if(n===i.GAS_ESTIMATE_TYPES.ETH_GASPRICE){const t=p(e.gasPrice);return d("Using gasPrice from estimate",t),{maxFeePerGas:t}}}catch(e){d("Failed to get estimate",e)}const r=await(0,a.query)(new s.default(n),"gasPrice");if(!r)return{};const o=(0,c.add0x)(r.toString(16));return d("Using gasPrice from network as fallback",o),{maxFeePerGas:o}}(e)),u);l.maxFeePerGas=await async function(e,t,n){const{maxFeePerGas:r,maxPriorityFeePerGas:a}=e,{gasPrice:s}=n??{};if(!m(r))return d("Using maxFeePerGas from request",r),r;if(m(a)&&s)return d("Setting maxFeePerGas to transaction gasPrice",s),s;const{maxFeePerGas:i}=await t();if(!i)throw new Error("Failed to get gas fee estimate for maxFeePerGas");return d("Using maxFeePerGas from estimate",i),i}(n,f,r),l.maxPriorityFeePerGas=await async function(e,t,n,r){const{maxFeePerGas:a,maxPriorityFeePerGas:s}=e,{gasPrice:i}=r??{},{maxFeePerGas:o}=n;if(!m(s))return d("Using maxPriorityFeePerGas from request",s),s;if(m(a)&&i)return d("Setting maxPriorityFeePerGas to transaction gasPrice",i),i;const{maxPriorityFeePerGas:c}=await t();if(c)return d("Using maxPriorityFeePerGas from estimate",c),c;return d("Setting maxPriorityFeePerGas to maxFeePerGas",o),o}(n,f,l,r),t.userFeeLevel=function(e,t,n,r){const{origin:s}=e,{maxFeePerGas:i,maxPriorityFeePerGas:c}=t,{maxFeePerGas:l,maxPriorityFeePerGas:u}=n||{};if(m(i)&&m(c)&&r?.gasPrice)return s===a.ORIGIN_METAMASK?o.UserFeeLevel.CUSTOM:o.UserFeeLevel.DAPP_SUGGESTED;if(m(i)&&m(c)&&l&&u)return o.UserFeeLevel.MEDIUM;if(s===a.ORIGIN_METAMASK)return o.UserFeeLevel.CUSTOM;return o.UserFeeLevel.DAPP_SUGGESTED}(t,n,u,r)}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/gas-fees.cjs"}],[3053,{"../constants.cjs":3044,"../helpers/Bundler.cjs":3045,"../logger.cjs":3049,"@metamask/controller-utils":1384,"@metamask/utils":3070,"bn.js":3977},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.updateGas=void 0;const a=e("@metamask/controller-utils"),s=e("@metamask/utils"),i=r(e("bn.js")),o=e("../constants.cjs"),c=e("../helpers/Bundler.cjs"),l=e("../logger.cjs"),u=(0,l.createModuleLogger)(l.projectLogger,"gas");function d(e){const t=("string"==typeof e?(0,a.hexToBN)(e):new i.default(e)).muln(1.5);return(0,s.add0x)(t.toString(16))}n.updateGas=async function(e,t,n){const{userOperation:r}=e;if(t.gas)return r.callGasLimit=t.gas.callGasLimit,r.preVerificationGas=t.gas.preVerificationGas,r.verificationGasLimit=t.gas.verificationGasLimit,void u("Using gas values from smart contract account",{callGasLimit:r.callGasLimit,preVerificationGas:r.preVerificationGas,verificationGasLimit:r.verificationGasLimit});const a={...r,maxFeePerGas:o.VALUE_ZERO,maxPriorityFeePerGas:o.VALUE_ZERO,callGasLimit:o.VALUE_ZERO,preVerificationGas:o.VALUE_ZERO,verificationGasLimit:"0xF4240"},s=new c.Bundler(e.bundlerUrl),i=await s.estimateUserOperationGas(a,n);r.callGasLimit=d(i.callGasLimit),r.preVerificationGas=d(i.preVerificationGas),r.verificationGasLimit=d(i.verificationGasLimit??i.verificationGas),u("Using buffered gas values from bundler estimate",{callGasLimit:r.callGasLimit,preVerificationGas:r.preVerificationGas,verificationGasLimit:r.verificationGasLimit,multiplier:1.5,estimate:i})}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/gas.cjs"}],[3054,{"../constants.cjs":3044,"../types.cjs":3050,"@metamask/transaction-controller":2989,"@metamask/utils":3070,"bn.js":3977},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getTransactionMetadata=void 0;const a=e("@metamask/transaction-controller"),s=e("@metamask/utils"),i=r(e("bn.js")),o=e("../constants.cjs"),c=e("../types.cjs");n.getTransactionMetadata=function(e){const{actualGasCost:t,actualGasUsed:n,baseFeePerGas:r,chainId:l,error:u,origin:d,transactionHash:p,id:m,swapsMetadata:f,time:h,transactionParams:g,transactionType:y,userFeeLevel:w,userOperation:v}=e;if(!g)return undefined;const b=t&&n?(0,s.add0x)(new i.default((0,s.remove0x)(t),16).div(new i.default((0,s.remove0x)(n),16)).toString(16)):undefined,T=u?{name:u.name,message:u.message,stack:u.stack,code:u.code,rpc:u.rpc}:undefined,k={[c.UserOperationStatus.Unapproved]:a.TransactionStatus.unapproved,[c.UserOperationStatus.Approved]:a.TransactionStatus.approved,[c.UserOperationStatus.Signed]:a.TransactionStatus.signed,[c.UserOperationStatus.Submitted]:a.TransactionStatus.submitted,[c.UserOperationStatus.Confirmed]:a.TransactionStatus.confirmed,[c.UserOperationStatus.Failed]:a.TransactionStatus.failed}[e.status],_=function(...e){const t=new i.default(0);for(const n of e)n&&t.iadd(new i.default((0,s.remove0x)(n),16));return(0,s.add0x)(t.toString(16))}(v.preVerificationGas,v.verificationGasLimit,v.callGasLimit),E=v.paymasterAndData!==o.EMPTY_BYTES,P=E?o.VALUE_ZERO:v.maxFeePerGas,S=E?o.VALUE_ZERO:v.maxPriorityFeePerGas,A=v.nonce===o.EMPTY_BYTES?undefined:v.nonce,C={...g,from:v.sender,gas:_,nonce:A,maxFeePerGas:P,maxPriorityFeePerGas:S};delete C.gasPrice;const I={approvalTxId:f?.approvalTxId??undefined,destinationTokenAddress:f?.destinationTokenAddress??undefined,destinationTokenAmount:f?.destinationTokenAmount??undefined,destinationTokenDecimals:f?.destinationTokenDecimals??undefined,destinationTokenSymbol:f?.destinationTokenSymbol??undefined,estimatedBaseFee:f?.estimatedBaseFee??undefined,sourceTokenAddress:f?.sourceTokenAddress??undefined,sourceTokenAmount:f?.sourceTokenAmount??undefined,sourceTokenDecimals:f?.sourceTokenDecimals??undefined,sourceTokenSymbol:f?.sourceTokenSymbol??undefined,swapAndSendRecipient:f?.swapAndSendRecipient??undefined,swapMetaData:f?.swapMetaData??undefined,swapTokenValue:f?.swapTokenValue??undefined},M=E?a.UserFeeLevel.CUSTOM:w;return{baseFeePerGas:r??undefined,chainId:l,error:T,hash:p??undefined,id:m,isUserOperation:!0,networkClientId:"user-operation",origin:d,status:k,time:h,txParams:C,txReceipt:{effectiveGasPrice:b??undefined,gasUsed:n??undefined},type:y??undefined,userFeeLevel:M,...I}}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/transaction.cjs"}],[3055,{"../constants.cjs":3044,"@metamask/superstruct":2931,"@metamask/transaction-controller":2989,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateSignUserOperationResponse=n.validateUpdateUserOperationResponse=n.validatePrepareUserOperationResponse=n.validateAddUserOperationOptions=n.validateAddUserOperationRequest=void 0;const r=e("@metamask/superstruct"),a=e("@metamask/transaction-controller"),s=e("@metamask/utils"),i=e("../constants.cjs");function o(e,t,n){try{(0,r.assert)(e,t,n)}catch(e){const t=e.failures().map(e=>e.path.length?`${e.path.join(".")} - ${e.message}`:e.message).join("\n");throw new Error(`${n}\n${t}`)}}function c(){return(0,r.define)("Hexadecimal String",e=>(0,s.isStrictHexString)(e))}function l(){return(0,r.define)("Hexadecimal String or 0x",e=>(0,s.isStrictHexString)(e)||e===i.EMPTY_BYTES)}n.validateAddUserOperationRequest=function(e){const t=c(),n=l();o(e,(0,r.object)({data:(0,r.optional)(n),from:t,maxFeePerGas:(0,r.optional)(t),maxPriorityFeePerGas:(0,r.optional)(t),to:(0,r.optional)(t),value:(0,r.optional)(t)}),"Invalid request to add user operation")},n.validateAddUserOperationOptions=function(e){o(e,(0,r.object)({networkClientId:(0,r.string)(),origin:(0,r.string)(),requireApproval:(0,r.optional)((0,r.boolean)()),smartContractAccount:(0,r.optional)((0,r.object)({prepareUserOperation:(0,r.func)(),updateUserOperation:(0,r.func)(),signUserOperation:(0,r.func)()})),swaps:(0,r.optional)((0,r.object)({approvalTxId:(0,r.optional)((0,r.string)()),destinationTokenAddress:(0,r.optional)((0,r.string)()),destinationTokenDecimals:(0,r.optional)((0,r.number)()),destinationTokenSymbol:(0,r.optional)((0,r.string)()),estimatedBaseFee:(0,r.optional)((0,r.string)()),sourceTokenSymbol:(0,r.optional)((0,r.string)()),swapMetaData:(0,r.optional)((0,r.object)()),swapTokenValue:(0,r.optional)((0,r.string)()),destinationTokenAmount:(0,r.optional)((0,r.string)()),sourceTokenAddress:(0,r.optional)((0,r.string)()),sourceTokenAmount:(0,r.optional)((0,r.string)()),sourceTokenDecimals:(0,r.optional)((0,r.number)()),swapAndSendRecipient:(0,r.optional)((0,r.string)())})),type:(0,r.optional)((0,r.enums)(Object.values(a.TransactionType)))}),"Invalid options to add user operation")},n.validatePrepareUserOperationResponse=function(e){const t=c(),n=l();o(e,(0,r.refine)((0,r.object)({bundler:(0,r.string)(),callData:t,dummyPaymasterAndData:(0,r.optional)(n),dummySignature:(0,r.optional)(n),gas:(0,r.optional)((0,r.object)({callGasLimit:t,preVerificationGas:t,verificationGasLimit:t})),initCode:(0,r.optional)(n),nonce:t,sender:t}),"ValidPrepareUserOperationResponse",({gas:e,dummySignature:t})=>!!(e||t&&t!==i.EMPTY_BYTES)||"Must specify dummySignature if not specifying gas"),"Invalid response when preparing user operation")},n.validateUpdateUserOperationResponse=function(e){o(e,(0,r.optional)((0,r.object)({paymasterAndData:(0,r.optional)(l()),callGasLimit:(0,r.optional)(l()),preVerificationGas:(0,r.optional)(l()),verificationGasLimit:(0,r.optional)(l())})),"Invalid response when updating user operation")},n.validateSignUserOperationResponse=function(e){const t=c();o(e,(0,r.object)({signature:t}),"Invalid response when signing user operation")}}}},{package:"@metamask/user-operation-controller",file:"node_modules/@metamask/user-operation-controller/dist/utils/validation.cjs"}],[3056,{"fast-json-stable-stringify":4352,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AbstractPollingControllerBaseMixin=n.getKey=void 0;const s=a(e("fast-json-stable-stringify")),i=e("uuid");n.getKey=e=>(0,s.default)(e),n.AbstractPollingControllerBaseMixin=function(e){var t,a;return t=new WeakMap,a=new WeakMap,class extends e{constructor(){super(...arguments),t.set(this,new Map),a.set(this,new Map)}startPolling(e){const a=(0,i.v4)(),s=(0,n.getKey)(e),o=r(this,t,"f").get(s)??new Set;return o.add(a),r(this,t,"f").set(s,o),1===o.size&&this._startPolling(e),a}stopAllPolling(){r(this,t,"f").forEach((e,t)=>{e.forEach(e=>{this.stopPollingByPollingToken(e)})})}stopPollingByPollingToken(e){if(!e)throw new Error("pollingToken required");let n=null;for(const[a,s]of r(this,t,"f"))if(s.delete(e)){0===s.size&&(n=a);break}if(n){this._stopPollingByPollingTokenSetId(n),r(this,t,"f").delete(n);const e=r(this,a,"f").get(n);if(e){for(const t of e)t(JSON.parse(n));e.clear()}}}onPollingComplete(e,t){const s=(0,n.getKey)(e),i=r(this,a,"f").get(s)??new Set;i.add(t),r(this,a,"f").set(s,i)}}}}}},{package:"@metamask/user-operation-controller>@metamask/polling-controller",file:"node_modules/@metamask/user-operation-controller/node_modules/@metamask/polling-controller/dist/AbstractPollingController.cjs"}],[3057,{"./AbstractPollingController.cjs":3056,"@metamask/base-controller":1311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.BlockTrackerPollingController=n.BlockTrackerPollingControllerOnly=void 0;const a=e("@metamask/base-controller"),s=e("./AbstractPollingController.cjs");function i(e){var t;class n extends((0,s.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{})}_startPolling(e){const n=(0,s.getKey)(e);if(r(this,t,"f")[n])return;const a=this._getNetworkClientById(e.networkClientId);if(!a)throw new Error(`Unable to retrieve blockTracker for networkClientId ${e.networkClientId}`);{const s=this._executePoll.bind(this,e);a.blockTracker.addListener("latest",s),r(this,t,"f")[n]=s}}_stopPollingByPollingTokenSetId(e){const{networkClientId:n}=JSON.parse(e),a=this._getNetworkClientById(n);if(a&&r(this,t,"f")[e]){const n=r(this,t,"f")[e];n&&(a.blockTracker.removeListener("latest",n),delete r(this,t,"f")[e])}}}return t=new WeakMap,n}class o{}n.BlockTrackerPollingControllerOnly=()=>i(o);n.BlockTrackerPollingController=()=>i(a.BaseController)}}},{package:"@metamask/user-operation-controller>@metamask/polling-controller",file:"node_modules/@metamask/user-operation-controller/node_modules/@metamask/polling-controller/dist/BlockTrackerPollingController.cjs"}],[3058,{"./AbstractPollingController.cjs":3056,"@metamask/base-controller":1311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.StaticIntervalPollingController=n.StaticIntervalPollingControllerOnly=void 0;const s=e("@metamask/base-controller"),i=e("./AbstractPollingController.cjs");function o(e){var t,n;class s extends((0,i.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{}),n.set(this,1e3)}setIntervalLength(e){r(this,n,e,"f")}getIntervalLength(){return a(this,n,"f")}_startPolling(e){if(!a(this,n,"f"))throw new Error("intervalLength must be defined and greater than 0");const r=(0,i.getKey)(e),s=a(this,t,"f")[r];this._stopPollingByPollingTokenSetId(r);const o=a(this,t,"f")[r]=setTimeout(async()=>{try{await this._executePoll(e)}catch(e){console.error(e)}o===a(this,t,"f")[r]&&this._startPolling(e)},s?a(this,n,"f"):0)}_stopPollingByPollingTokenSetId(e){const n=a(this,t,"f")[e];n&&(clearTimeout(n),delete a(this,t,"f")[e])}}return t=new WeakMap,n=new WeakMap,s}class c{}n.StaticIntervalPollingControllerOnly=()=>o(c);n.StaticIntervalPollingController=()=>o(s.BaseController)}}},{package:"@metamask/user-operation-controller>@metamask/polling-controller",file:"node_modules/@metamask/user-operation-controller/node_modules/@metamask/polling-controller/dist/StaticIntervalPollingController.cjs"}],[3059,{"./BlockTrackerPollingController.cjs":3057,"./StaticIntervalPollingController.cjs":3058},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StaticIntervalPollingController=n.StaticIntervalPollingControllerOnly=n.BlockTrackerPollingController=n.BlockTrackerPollingControllerOnly=void 0;var r=e("./BlockTrackerPollingController.cjs");Object.defineProperty(n,"BlockTrackerPollingControllerOnly",{enumerable:!0,get:function(){return r.BlockTrackerPollingControllerOnly}}),Object.defineProperty(n,"BlockTrackerPollingController",{enumerable:!0,get:function(){return r.BlockTrackerPollingController}});var a=e("./StaticIntervalPollingController.cjs");Object.defineProperty(n,"StaticIntervalPollingControllerOnly",{enumerable:!0,get:function(){return a.StaticIntervalPollingControllerOnly}}),Object.defineProperty(n,"StaticIntervalPollingController",{enumerable:!0,get:function(){return a.StaticIntervalPollingController}})}}},{package:"@metamask/user-operation-controller>@metamask/polling-controller",file:"node_modules/@metamask/user-operation-controller/node_modules/@metamask/polling-controller/dist/index.cjs"}],[306,{"../../../../../shared/constants/app":5753},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,n,r,{getAccounts:a}){return t.result=a(),r()},hookNames:{getAccounts:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/eth-accounts.ts"}],[307,{"../../../../../shared/constants/app":5753,"../../../../../shared/modules/network.utils":5900,"../../util":358,"@metamask/chain-agnostic-permission":1360,"@metamask/controller-utils":1384,"@metamask/rpc-errors":2594,"@metamask/snaps-utils":2902,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.switchChain=async function(e,t,n,a,{origin:l,isAddFlow:u,isSwitchFlow:d,autoApprove:p,setActiveNetwork:m,getCaveat:f,requestPermittedChainsPermissionIncrementalForOrigin:h,setTokenNetworkFilter:g,setEnabledNetworks:y,getEnabledNetworks:w,rejectApprovalRequestsForOrigin:v,requestUserApproval:b,hasApprovalRequestsForOrigin:T,toNetworkConfiguration:k,fromNetworkConfiguration:_}){try{const E=f({target:s.Caip25EndowmentPermissionName,caveatType:s.Caip25CaveatType});if(E){if((0,s.getPermittedEthChainIds)(E.value).includes(n))null==T||!T()||u||p||await b({origin:l,type:r.ApprovalType.SwitchEthereumChain,requestData:{toNetworkConfiguration:k,fromNetworkConfiguration:_}});else{let e;d&&(e={isSwitchEthereumChain:!0}),await h({chainId:n,autoApprove:p,metadata:e})}}else await h({chainId:n,autoApprove:p});if((0,o.isSnapId)(l)||null==v||v(),await m(a),!(0,o.isSnapId)(l))if(g(n),(0,c.isPrefixedFormattedHexString)(n)){const e=w(i.KnownCaipNamespace.Eip155);Object.keys(e).includes(n)||y(n)}else{const{namespace:e}=(0,i.parseCaipChainId)(n),t=w(e);Object.keys(t).includes(n)||y(n)}return e.result=null,t()}catch(e){return t(e)}},n.validateAddEthereumChainParams=function(e){if(!e||"object"!=typeof e)throw a.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e)}`});const{chainId:t,chainName:n,blockExplorerUrls:r,nativeCurrency:s,rpcUrls:i,...o}=e,c=Object.keys(o).filter(e=>!["iconUrls"].includes(e));if(c.length>0)throw a.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${c}`});const p=d(t);if(!i||!Array.isArray(i)||0===i.length)throw a.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${i}`});const m=e=>{const t=(0,u.getValidUrl)(e);return null!==t&&("localhost"===t.hostname||"127.0.0.1"===t.hostname||"https:"===t.protocol)},f=i.find(e=>m(e)),h=Array.isArray(r)?r.find(e=>m(e)):null;if(!f)throw a.rpcErrors.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${i}`});if("string"!=typeof n||!n)throw a.rpcErrors.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${n}`});const g=n.length>100?n.substring(0,100):n;if(null!==s){if("object"!=typeof s||Array.isArray(s))throw a.rpcErrors.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${s}`});if(18!==s.decimals)throw a.rpcErrors.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${s.decimals}`});if(!s.symbol||"string"!=typeof s.symbol)throw a.rpcErrors.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${s.symbol}`})}const y=(null==s?void 0:s.symbol)||l.UNKNOWN_TICKER_SYMBOL;if(y!==l.UNKNOWN_TICKER_SYMBOL&&("string"!=typeof y||y.length<1||y.length>6))throw a.rpcErrors.invalidParams({message:`Expected 1-6 character string 'nativeCurrency.symbol'. Received:\n${y}`});return{chainId:p,chainName:g,firstValidBlockExplorerUrl:h,firstValidRPCUrl:f,ticker:y}},n.validateChainId=d,n.validateSwitchEthereumChainParams=function(e){var t;if(null===(t=e.params)||void 0===t||!t[0]||"object"!=typeof e.params[0])throw a.rpcErrors.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`});const{chainId:n,...r}=e.params[0];if(Object.keys(r).length>0)throw a.rpcErrors.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${Object.keys(r)}`});return d(n)};var r=e("@metamask/controller-utils"),a=e("@metamask/rpc-errors"),s=e("@metamask/chain-agnostic-permission"),i=e("@metamask/utils"),o=e("@metamask/snaps-utils"),c=e("../../../../../shared/modules/network.utils"),l=e("../../../../../shared/constants/app"),u=e("../../util");function d(e){const t="string"==typeof e?e.toLowerCase():null;if(!(0,c.isPrefixedFormattedHexString)(t))throw a.rpcErrors.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${e}`});if(!(0,c.isSafeChainId)(parseInt(e,16)))throw a.rpcErrors.invalidParams({message:`Invalid chain ID "${t}": numerical value greater than max safe value. Received:\n${e}`});return t}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/ethereum-chain-utils.js"}],[308,{"../../../../../shared/constants/app":5753},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,n,r,{getProviderState:a}){var s;const i=null===(s=e.params)||void 0===s?void 0:s.isInitializingStreamProvider;return t.result={...await a(e.origin,{isInitializingStreamProvider:i})},r()},hookNames:{getProviderState:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/get-provider-state.ts"}],[3083,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var r=0;r<e.length;r++){var a=e.charAt(r),s=a.charCodeAt(0);if(255!==t[s])throw new TypeError(a+" is ambiguous");t[s]=r}var i=e.length,o=e.charAt(0),c=Math.log(i)/Math.log(256),l=Math.log(256)/Math.log(i);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var n=0;if(" "!==e[n]){for(var r=0,a=0;e[n]===o;)r++,n++;for(var s=(e.length-n)*c+1>>>0,l=new Uint8Array(s);e[n];){var u=t[e.charCodeAt(n)];if(255===u)return;for(var d=0,p=s-1;(0!==u||d<a)&&-1!==p;p--,d++)u+=i*l[p]>>>0,l[p]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");a=d,n++}if(" "!==e[n]){for(var m=s-a;m!==s&&0===l[m];)m++;for(var f=new Uint8Array(r+(s-m)),h=r;m!==s;)f[h++]=l[m++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,a=0,s=t.length;a!==s&&0===t[a];)a++,n++;for(var c=(s-a)*l+1>>>0,u=new Uint8Array(c);a!==s;){for(var d=t[a],p=0,m=c-1;(0!==d||p<r)&&-1!==m;m--,p++)d+=256*u[m]>>>0,u[m]=d%i>>>0,d=d/i>>>0;if(0!==d)throw new Error("Non-zero carry");r=p,a++}for(var f=c-r;f!==c&&0===u[f];)f++;for(var h=o.repeat(n);f<c;++f)h+=e.charAt(u[f]);return h},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+i+" character")}}}}}},{package:"@ensdomains/content-hash>cids>multibase>@multiformats/base-x",file:"node_modules/@multiformats/base-x/src/index.js"}],[309,{"./add-ethereum-chain":305,"./eth-accounts":306,"./get-provider-state":308,"./log-web3-shim-usage":310,"./request-accounts":311,"./send-metadata":312,"./switch-ethereum-chain":313,"./watch-asset":317},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.handlers=n.ethAccountsHandler=n.eip1193OnlyHandlers=void 0;var r=d(e("./add-ethereum-chain")),a=d(e("./eth-accounts")),s=d(e("./get-provider-state")),i=d(e("./log-web3-shim-usage")),o=d(e("./request-accounts")),c=d(e("./send-metadata")),l=d(e("./switch-ethereum-chain")),u=d(e("./watch-asset"));function d(e){return e&&e.__esModule?e:{default:e}}n.handlers=[r.default,s.default,i.default,c.default,u.default],n.eip1193OnlyHandlers=[l.default,a.default,o.default],n.ethAccountsHandler=a.default}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/index.ts"}],[31,{"../../../shared/constants/bridge":5755,"../../../shared/lib/trace":5873,"@metamask/bridge-status-controller":1347,"@metamask/controller-utils":1384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeStatusControllerInit=void 0;var r=e("@metamask/bridge-status-controller"),a=e("@metamask/controller-utils"),s=e("../../../shared/lib/trace"),i=e("../../../shared/constants/bridge");n.BridgeStatusControllerInit=({controllerMessenger:e,persistedState:t,getController:n})=>{const o=n("TransactionController");return{controller:new r.BridgeStatusController({messenger:e,state:t.BridgeStatusController,fetchFn:async(e,t)=>await(0,a.handleFetch)(e,{method:"GET",...t}),addTransactionFn:(...e)=>o.addTransaction(...e),addTransactionBatchFn:(...e)=>o.addTransactionBatch(...e),estimateGasFeeFn:(...e)=>o.estimateGasFee(...e),updateTransactionFn:(...e)=>o.updateTransaction(...e),config:{customBridgeApiBaseUrl:i.BRIDGE_API_BASE_URL},traceFn:(...e)=>(0,s.trace)(...e)})}}}}},{package:"$root$",file:"app/scripts/controller-init/bridge-status-controller-init.ts"}],[310,{"../../../../../shared/constants/app":5753},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;const r={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE],implementation:function(e,t,n,r,{getWeb3ShimUsageState:a,setWeb3ShimUsageRecorded:s}){const{origin:i}=e;a(i)===undefined&&s(i);return t.result=!0,r()},hookNames:{getWeb3ShimUsageState:!0,setWeb3ShimUsageRecorded:!0}};n.default=r}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/log-web3-shim-usage.ts"}],[311,{"../../../../../shared/constants/app":5753,"../../../../../shared/constants/metametrics":5768,"../../util":358,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),a=e("../../../../../shared/constants/app"),s=e("../../../../../shared/constants/metametrics"),i=e("../../util");const o={methodNames:[a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS],implementation:async function(e,t,n,o,{getAccounts:l,sendMetrics:u,metamaskState:d,getCaip25PermissionFromLegacyPermissionsForOrigin:p,requestPermissionsForOrigin:m}){const{origin:f}=e??{};if(c.has(f))return t.error=r.rpcErrors.resourceUnavailable(`Already processing ${a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS}. Please wait.`),o();let h=l(f);if(h.length>0){try{c.add(f),t.result=h,o()}catch(e){o(e)}finally{c.delete(f)}return undefined}try{const e=p();await m(e)}catch(e){return o(e)}if(h=l(f),(0,i.shouldEmitDappViewedEvent)(d.metaMetricsId)){const e=!Object.keys(d.permissionHistory).includes(f);u({event:s.MetaMetricsEventName.DappViewed,category:s.MetaMetricsEventCategory.InpageProvider,referrer:{url:f},properties:{is_first_visit:e,number_of_accounts:new Set(Object.values(d.accountsByChainId).flatMap(e=>Object.keys(e))).size,number_of_accounts_connected:h.length}},{excludeMetaMetricsId:!0})}return t.result=h,o()},hookNames:{getAccounts:!0,sendMetrics:!0,metamaskState:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0,requestPermissionsForOrigin:!0}};n.default=o;const c=new Set}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/request-accounts.ts"}],[312,{"../../../../../shared/constants/app":5753,"@metamask/rpc-errors":2594,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),a=e("@metamask/utils");const s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.SEND_METADATA],implementation:function(e,t,n,s,{addSubjectMetadata:i,subjectType:o}){const{origin:c,params:l}=e;if(!(0,a.isObject)(l))return s(r.rpcErrors.invalidParams({data:l}));{const{icon:e=null,name:t=null,...n}=l;i({...n,iconUrl:e,name:t,subjectType:o,origin:c})}return t.result=!0,s()},hookNames:{addSubjectMetadata:!0,subjectType:!0}};n.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/send-metadata.ts"}],[3127,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.openrpcDocument=void 0,n.openrpcDocument={$schema:"https://meta.json-schema.tools/",$id:"https://meta.open-rpc.org/",title:"openrpcDocument",type:"object",required:["info","methods","openrpc"],additionalProperties:!1,patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}},properties:{openrpc:{title:"openrpc",type:"string",enum:["1.3.2","1.3.1","1.3.0","1.2.6","1.2.5","1.2.4","1.2.3","1.2.2","1.2.1","1.2.0","1.1.12","1.1.11","1.1.10","1.1.9","1.1.8","1.1.7","1.1.6","1.1.5","1.1.4","1.1.3","1.1.2","1.1.1","1.1.0","1.0.0","1.0.0-rc1","1.0.0-rc0"]},info:{$ref:"#/definitions/infoObject"},externalDocs:{$ref:"#/definitions/externalDocumentationObject"},servers:{title:"servers",type:"array",additionalItems:!1,items:{$ref:"#/definitions/serverObject"}},methods:{title:"methods",type:"array",additionalItems:!1,items:{title:"methodOrReference",oneOf:[{$ref:"#/definitions/methodObject"},{$ref:"#/definitions/referenceObject"}]}},components:{title:"components",type:"object",properties:{schemas:{title:"schemaComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/JSONSchema"}}},links:{title:"linkComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/linkObject"}}},errors:{title:"errorComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/errorObject"}}},examples:{title:"exampleComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/exampleObject"}}},examplePairings:{title:"examplePairingComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/examplePairingObject"}}},contentDescriptors:{title:"contentDescriptorComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/contentDescriptorObject"}}},tags:{title:"tagComponents",type:"object",patternProperties:{"[0-z]+":{$ref:"#/definitions/tagObject"}}}}},$schema:{title:"metaSchema",description:"JSON Schema URI (used by some editors)",type:"string",default:"https://meta.open-rpc.org/"}},definitions:{specificationExtension:{title:"specificationExtension"},JSONSchema:{$ref:"https://meta.json-schema.tools"},referenceObject:{title:"referenceObject",type:"object",additionalProperties:!1,required:["$ref"],properties:{$ref:{$ref:"https://meta.json-schema.tools/#/definitions/JSONSchemaObject/properties/$ref"}}},errorObject:{title:"errorObject",type:"object",description:"Defines an application level error.",additionalProperties:!1,required:["code","message"],properties:{code:{title:"errorObjectCode",description:"A Number that indicates the error type that occurred. This MUST be an integer. The error codes from and including -32768 to -32000 are reserved for pre-defined errors. These pre-defined errors SHOULD be assumed to be returned from any JSON-RPC api.",type:"integer"},message:{title:"errorObjectMessage",description:"A String providing a short description of the error. The message SHOULD be limited to a concise single sentence.",type:"string"},data:{title:"errorObjectData",description:"A Primitive or Structured value that contains additional information about the error. This may be omitted. The value of this member is defined by the Server (e.g. detailed error information, nested errors etc.)."}}},licenseObject:{title:"licenseObject",type:"object",additionalProperties:!1,properties:{name:{title:"licenseObjectName",type:"string"},url:{title:"licenseObjectUrl",type:"string"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},contactObject:{title:"contactObject",type:"object",additionalProperties:!1,properties:{name:{title:"contactObjectName",type:"string"},email:{title:"contactObjectEmail",type:"string"},url:{title:"contactObjectUrl",type:"string"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},infoObject:{title:"infoObject",type:"object",additionalProperties:!1,required:["title","version"],properties:{title:{title:"infoObjectProperties",type:"string"},description:{title:"infoObjectDescription",type:"string"},termsOfService:{title:"infoObjectTermsOfService",type:"string",format:"uri"},version:{title:"infoObjectVersion",type:"string"},contact:{$ref:"#/definitions/contactObject"},license:{$ref:"#/definitions/licenseObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},serverObject:{title:"serverObject",type:"object",required:["url"],additionalProperties:!1,properties:{url:{title:"serverObjectUrl",type:"string",format:"uri"},name:{title:"serverObjectName",type:"string"},description:{title:"serverObjectDescription",type:"string"},summary:{title:"serverObjectSummary",type:"string"},variables:{title:"serverObjectVariables",type:"object",patternProperties:{"[0-z]+":{title:"serverObjectVariable",type:"object",required:["default"],properties:{default:{title:"serverObjectVariableDefault",type:"string"},description:{title:"serverObjectVariableDescription",type:"string"},enum:{title:"serverObjectVariableEnum",type:"array",items:{title:"serverObjectVariableEnumItem",type:"string"}}}}}}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},linkObject:{title:"linkObject",type:"object",additionalProperties:!1,properties:{name:{title:"linkObjectName",type:"string",minLength:1},summary:{title:"linkObjectSummary",type:"string"},method:{title:"linkObjectMethod",type:"string"},description:{title:"linkObjectDescription",type:"string"},params:{title:"linkObjectParams"},server:{title:"linkObjectServer",$ref:"#/definitions/serverObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},externalDocumentationObject:{title:"externalDocumentationObject",type:"object",additionalProperties:!1,description:"information about external documentation",required:["url"],properties:{description:{title:"externalDocumentationObjectDescription",type:"string"},url:{title:"externalDocumentationObjectUrl",type:"string",format:"uri"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},methodObject:{title:"methodObject",type:"object",required:["name","params"],additionalProperties:!1,properties:{name:{title:"methodObjectName",description:"The cannonical name for the method. The name MUST be unique within the methods array.",type:"string",minLength:1},description:{title:"methodObjectDescription",description:"A verbose explanation of the method behavior. GitHub Flavored Markdown syntax MAY be used for rich text representation.",type:"string"},summary:{title:"methodObjectSummary",description:"A short summary of what the method does.",type:"string"},servers:{title:"servers",type:"array",additionalItems:!1,items:{$ref:"#/definitions/serverObject"}},tags:{title:"methodObjectTags",type:"array",items:{title:"tagOrReference",oneOf:[{$ref:"#/definitions/tagObject"},{$ref:"#/definitions/referenceObject"}]}},paramStructure:{title:"methodObjectParamStructure",type:"string",description:"Format the server expects the params. Defaults to 'either'.",enum:["by-position","by-name","either"],default:"either"},params:{title:"methodObjectParams",type:"array",items:{title:"contentDescriptorOrReference",oneOf:[{$ref:"#/definitions/contentDescriptorObject"},{$ref:"#/definitions/referenceObject"}]}},result:{title:"methodObjectResult",oneOf:[{$ref:"#/definitions/contentDescriptorObject"},{$ref:"#/definitions/referenceObject"}]},errors:{title:"methodObjectErrors",description:"Defines an application level error.",type:"array",items:{title:"errorOrReference",oneOf:[{$ref:"#/definitions/errorObject"},{$ref:"#/definitions/referenceObject"}]}},links:{title:"methodObjectLinks",type:"array",items:{title:"linkOrReference",oneOf:[{$ref:"#/definitions/linkObject"},{$ref:"#/definitions/referenceObject"}]}},examples:{title:"methodObjectExamples",type:"array",items:{title:"examplePairingOrReference",oneOf:[{$ref:"#/definitions/examplePairingObject"},{$ref:"#/definitions/referenceObject"}]}},deprecated:{title:"methodObjectDeprecated",type:"boolean",default:!1},externalDocs:{$ref:"#/definitions/externalDocumentationObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},tagObject:{title:"tagObject",type:"object",additionalProperties:!1,required:["name"],properties:{name:{title:"tagObjectName",type:"string",minLength:1},description:{title:"tagObjectDescription",type:"string"},externalDocs:{$ref:"#/definitions/externalDocumentationObject"}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},exampleObject:{title:"exampleObject",type:"object",required:["name","value"],properties:{summary:{title:"exampleObjectSummary",type:"string"},value:{title:"exampleObjectValue"},description:{title:"exampleObjectDescription",type:"string"},name:{title:"exampleObjectName",type:"string",minLength:1}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}},examplePairingObject:{title:"examplePairingObject",type:"object",required:["name","params"],properties:{name:{title:"examplePairingObjectName",type:"string",minLength:1},description:{title:"examplePairingObjectDescription",type:"string"},params:{title:"examplePairingObjectParams",type:"array",items:{title:"exampleOrReference",oneOf:[{$ref:"#/definitions/exampleObject"},{$ref:"#/definitions/referenceObject"}]}},result:{title:"examplePairingObjectResult",oneOf:[{$ref:"#/definitions/exampleObject"},{$ref:"#/definitions/referenceObject"}]}}},contentDescriptorObject:{title:"contentDescriptorObject",type:"object",additionalProperties:!1,required:["name","schema"],properties:{name:{title:"contentDescriptorObjectName",type:"string",minLength:1},description:{title:"contentDescriptorObjectDescription",type:"string"},summary:{title:"contentDescriptorObjectSummary",type:"string"},schema:{$ref:"#/definitions/JSONSchema"},required:{title:"contentDescriptorObjectRequired",type:"boolean",default:!1},deprecated:{title:"contentDescriptorObjectDeprecated",type:"boolean",default:!1}},patternProperties:{"^x-":{$ref:"#/definitions/specificationExtension"}}}}},n.default=n.openrpcDocument}}},{package:"@open-rpc/meta-schema",file:"node_modules/@open-rpc/meta-schema/index.js"}],[3128,{"@json-schema-tools/dereferencer":827,"@json-schema-tools/reference-resolver":831,"fast-safe-stringify":4353},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},r.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenRPCDocumentDereferencingError=void 0;var o=i(e("@json-schema-tools/dereferencer")),c=i(e("@json-schema-tools/reference-resolver")),l=i(e("fast-safe-stringify")),u=function(e){this.name="OpenRPCDocumentDereferencingError",this.message="The json schema provided cannot be dereferenced. Received Error: \n ".concat(e)};n.OpenRPCDocumentDereferencingError=u;var d=function(e,t,n){return a(void 0,void 0,void 0,function(){var r,a;return s(this,function(s){switch(s.label){case 0:if((r=e.$ref)===undefined)return[2,e];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n.resolve(r,t)];case 2:return[2,s.sent()];case 3:throw a=s.sent(),new u(["unable to eval pointer against OpenRPC Document.","error type: ".concat(a.name),"instance: ".concat(a.instance),"token: ".concat(a.token),"pointer: ".concat(r),"reference object: ".concat((0,l.default)(e))].join("\n"));case 4:return[2]}})})},p=function(e,t,n){return a(void 0,void 0,void 0,function(){var r,a,i,o,c,l;return s(this,function(s){switch(s.label){case 0:r=[],a=0,i=e,s.label=1;case 1:return a<i.length?(o=i[a],l=(c=r).push,[4,d(o,t,n)]):[3,4];case 2:l.apply(c,[s.sent()]),s.label=3;case 3:return a++,[3,1];case 4:return[2,r]}})})},m=function(e,t){return a(void 0,void 0,void 0,function(){var n,r,a;return s(this,function(s){switch(s.label){case 0:if(!0===e||!1===e)return[2,Promise.resolve(e)];t!==undefined&&(e.components={schemas:t}),n=new o.default(e),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n.resolve()];case 2:return!0!==(r=s.sent())&&!1!==r&&(delete r.components,delete e.components),[2,r];case 3:throw a=s.sent(),new u(["Unable to parse reference inside of JSONSchema",e.title?"Schema Title: ".concat(e.title):"","error message: ".concat(a.message),"schema in question: ".concat((0,l.default)(e))].join("\n"));case 4:return[2]}})})},f=function(e){return a(void 0,void 0,void 0,function(){var t,n,r,a,i,o,c;return s(this,function(s){switch(s.label){case 0:if(e.components===undefined)return[2,Promise.resolve(e)];if(e.components.contentDescriptors===undefined)return[2,Promise.resolve(e)];t=e.components.contentDescriptors,n=Object.keys(t),r={},e.components.schemas&&(r=e.components.schemas),a=0,i=n,s.label=1;case 1:return a<i.length?(o=i[a],c=t[o],[4,m(t[o].schema,r)]):[3,4];case 2:c.schema=s.sent(),s.label=3;case 3:return a++,[3,1];case 4:return[2,e]}})})},h=function(e,t,n){return a(void 0,void 0,void 0,function(){var r,a,i,o,c,l,u,f,h,g,y,w,v,b,T,k,_,E,P,S;return s(this,function(s){switch(s.label){case 0:return r=e,e.$ref===undefined?[3,2]:[4,d({$ref:e.$ref},t,n)];case 1:r=s.sent(),s.label=2;case 2:return r.tags===undefined?[3,4]:(a=r,[4,p(r.tags,t,n)]);case 3:a.tags=s.sent(),s.label=4;case 4:return r.errors===undefined?[3,6]:(i=r,[4,p(r.errors,t,n)]);case 5:i.errors=s.sent(),s.label=6;case 6:return r.links===undefined?[3,8]:(o=r,[4,p(r.links,t,n)]);case 7:o.links=s.sent(),s.label=8;case 8:return r.examples===undefined?[3,14]:(c=r,[4,p(r.examples,t,n)]);case 9:c.examples=s.sent(),l=0,u=r.examples,s.label=10;case 10:return l<u.length?(f=u[l],h=f,[4,p(f.params,t,n)]):[3,14];case 11:return h.params=s.sent(),f.result===undefined?[3,13]:(g=f,[4,d(f.result,t,n)]);case 12:g.result=s.sent(),s.label=13;case 13:return l++,[3,10];case 14:return y=r,[4,p(r.params,t,n)];case 15:return y.params=s.sent(),r.result===undefined?[3,17]:(w=r,[4,d(r.result,t,n)]);case 16:w.result=s.sent(),s.label=17;case 17:v={},t.components&&t.components.schemas&&(v=t.components.schemas),b=r.params,T=0,k=b,s.label=18;case 18:return T<k.length?(_=k[T],E=_,[4,m(_.schema,v)]):[3,21];case 19:E.schema=s.sent(),s.label=20;case 20:return T++,[3,18];case 21:return r.result===undefined?[3,23]:(P=r.result,S=P,[4,m(P.schema,v)]);case 22:S.schema=s.sent(),s.label=23;case 23:return[2,r]}})})};n.default=function(e,t){return void 0===t&&(t=c.default),a(this,void 0,void 0,function(){var n,i,o,c,l,u,d;return s(this,function(p){switch(p.label){case 0:return n=r({},e),[4,(g=n,a(void 0,void 0,void 0,function(){var e,t,n,r,a,i,o;return s(this,function(s){switch(s.label){case 0:if(g.components===undefined)return[2,Promise.resolve(g)];if(g.components.schemas===undefined)return[2,Promise.resolve(g)];e=g.components.schemas,t=Object.keys(e),n=0,r=t,s.label=1;case 1:return n<r.length?(a=r[n],i=e,o=a,[4,m(e[a],e)]):[3,4];case 2:i[o]=s.sent(),s.label=3;case 3:return n++,[3,1];case 4:return[2,g]}})}))];case 1:return n=p.sent(),[4,f(n)];case 2:n=p.sent(),i=[],o=0,c=n.methods,p.label=3;case 3:return o<c.length?(l=c[o],d=(u=i).push,[4,h(l,n,t)]):[3,6];case 4:d.apply(u,[p.sent()]),p.label=5;case 5:return o++,[3,3];case 6:return n.methods=i,[2,n]}var g})})}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/dereference-document.js"}],[3129,{"./dereference-document":3128,"./validate-open-rpc-document":3130,"@json-schema-tools/reference-resolver":831,"@json-schema-tools/reference-resolver/build/reference-resolver":832,"is-url":4598},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},r.apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return s(t,e),t},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}c((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.makeCustomResolver=void 0;var u=l(e("./dereference-document")),d=i(e("./validate-open-rpc-document")),p=l(e("@json-schema-tools/reference-resolver")),m=e("is-url"),f=l(e("@json-schema-tools/reference-resolver/build/reference-resolver")),h={dereference:!0,validate:!0};n.makeCustomResolver=function(e){return new f.default(e)},n.default=function(e,t){return function(n,a){return void 0===n&&(n="./openrpc.json"),void 0===a&&(a=h),o(this,void 0,void 0,function(){var s,i,o,l;return c(this,function(c){switch(c.label){case 0:return i=r(r({},h),a),"string"==typeof n?[3,1]:(s=n,[3,6]);case 1:return function(e){try{return JSON.parse(e),!0}catch(e){return!1}}(n)?(s=JSON.parse(n),[3,6]):[3,2];case 2:return m(n)?[4,e(n)]:[3,4];case 3:return s=c.sent(),[3,6];case 4:return[4,t(n)];case 5:s=c.sent(),c.label=6;case 6:if(i.validate&&(l=(0,d.default)(s))instanceof d.OpenRPCDocumentValidationError)throw l;return o=s,i.dereference?i.resolver===undefined?[3,8]:[4,(0,u.default)(s,i.resolver)]:[3,10];case 7:return o=c.sent(),[3,10];case 8:return[4,(0,u.default)(s,p.default)];case 9:o=c.sent(),c.label=10;case 10:if(i.validate&&(l=(0,d.default)(o))instanceof d.OpenRPCDocumentValidationError)throw l;return[2,o]}})})}}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/parse-open-rpc-document.js"}],[313,{"../../../../../shared/constants/app":5753,"./ethereum-chain-utils":307,"@metamask/rpc-errors":2594,"@metamask/snaps-utils":2902},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),a=e("@metamask/snaps-utils"),s=e("../../../../../shared/constants/app"),i=e("./ethereum-chain-utils");const o={methodNames:[s.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN],implementation:async function(e,t,n,o,{getNetworkConfigurationByChainId:c,setActiveNetwork:l,requestUserApproval:u,getCaveat:d,getCurrentChainIdForDomain:p,requestPermittedChainsPermissionIncrementalForOrigin:m,rejectApprovalRequestsForOrigin:f,setTokenNetworkFilter:h,setEnabledNetworks:g,getEnabledNetworks:y,hasApprovalRequestsForOrigin:w}){let v;try{v=(0,i.validateSwitchEthereumChainParams)(e)}catch(e){return o(e)}const{origin:b}=e,T=p(b);if(T===v)return t.result=null,o();const k=c(v),_=null==k?void 0:k.rpcEndpoints[k.defaultRpcEndpointIndex].networkClientId;if(!_)return o(r.providerErrors.custom({code:4902,message:`Unrecognized chain ID "${v}". Try adding the chain using ${s.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN} first.`}));const E=c(T),P=c(v);return(0,i.switchChain)(t,o,v,_,{origin:b,isSwitchFlow:!0,autoApprove:(0,a.isSnapId)(b),setActiveNetwork:l,getCaveat:d,requestPermittedChainsPermissionIncrementalForOrigin:m,rejectApprovalRequestsForOrigin:f,setTokenNetworkFilter:h,setEnabledNetworks:g,getEnabledNetworks:y,requestUserApproval:u,hasApprovalRequestsForOrigin:w,toNetworkConfiguration:P,fromNetworkConfiguration:E})},hookNames:{getNetworkConfigurationByChainId:!0,setActiveNetwork:!0,requestUserApproval:!0,getCaveat:!0,getCurrentChainIdForDomain:!0,requestPermittedChainsPermissionIncrementalForOrigin:!0,rejectApprovalRequestsForOrigin:!0,setTokenNetworkFilter:!0,setEnabledNetworks:!0,getEnabledNetworks:!0,hasApprovalRequestsForOrigin:!0}};n.default=o}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/switch-ethereum-chain.js"}],[3130,{"@json-schema-tools/meta-schema":828,"@open-rpc/meta-schema":3127,ajv:3772},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},r.apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenRPCDocumentValidationError=void 0;var s=a(e("@open-rpc/meta-schema")),i=a(e("ajv")),o=a(e("@json-schema-tools/meta-schema")),c=function(e){this.name="OpenRPCDocumentDereferencingError",this.message=["Error validating OpenRPC Document against @open-rpc/meta-schema.","The errors found are as follows:",JSON.stringify(e,undefined,"  ")].join("\n")};n.OpenRPCDocumentValidationError=c,n.default=function(e){var t=new i.default;t.addSchema(o.default,"https://meta.json-schema.tools");var n=r({},s.default);delete n.definitions.JSONSchema.$id,delete n.definitions.JSONSchema.$schema,delete n.$schema,delete n.$id;try{t.validate(n,e)}catch(e){throw new Error(["schema-utils-js: Internal Error","-----",e,"-----","If you see this report it: https://github.com/open-rpc/schema-utils-js/issues"].join("\n"))}return!t.errors||new c(t.errors)}}}},{package:"@open-rpc/schema-utils-js",file:"node_modules/@open-rpc/schema-utils-js/build/validate-open-rpc-document.js"}],[314,{"../../../../../shared/constants/permissions":5776,"../../../controllers/permissions":230,"@metamask/chain-agnostic-permission":1360,"@metamask/permission-controller":2401},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPermissionsHandler=void 0;var r=e("@metamask/permission-controller"),a=e("@metamask/chain-agnostic-permission"),s=e("../../../controllers/permissions"),i=e("../../../../../shared/constants/permissions");n.getPermissionsHandler={methodNames:[r.MethodNames.GetPermissions],implementation:async function(e,t,n,r,{getPermissionsForOrigin:o,getAccounts:c}){var l;const u={...o()},d=u[a.Caip25EndowmentPermissionName],p=null==d||null===(l=d.caveats)||void 0===l||null===(l=l.find(({type:e})=>e===a.Caip25CaveatType))||void 0===l?void 0:l.value;if(delete u[a.Caip25EndowmentPermissionName],p){const e=c();e.length>0&&(u[i.RestrictedMethods.eth_accounts]={...d,parentCapability:i.RestrictedMethods.eth_accounts,caveats:[{type:i.CaveatTypes.restrictReturnedAccounts,value:e}]});const t=(0,a.getPermittedEthChainIds)(p);t.length>0&&(u[s.PermissionNames.permittedChains]={...d,parentCapability:s.PermissionNames.permittedChains,caveats:[{type:i.CaveatTypes.restrictNetworkSwitching,value:t}]})}return t.result=Object.values(u),r()},hookNames:{getPermissionsForOrigin:!0,getAccounts:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-getPermissions.ts"}],[315,{"../../../../../shared/constants/permissions":5776,"../../../controllers/permissions":230,"@metamask/chain-agnostic-permission":1360,"@metamask/controller-utils":1384,"@metamask/permission-controller":2401,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.requestPermissionsHandler=void 0;var r=e("lodash"),a=e("@metamask/controller-utils"),s=e("@metamask/permission-controller"),i=e("@metamask/chain-agnostic-permission"),o=e("../../../../../shared/constants/permissions"),c=e("../../../controllers/permissions");n.requestPermissionsHandler={methodNames:[s.MethodNames.RequestPermissions],implementation:async function(e,t,n,l,{getAccounts:u,requestPermissionsForOrigin:d,getCaip25PermissionFromLegacyPermissionsForOrigin:p}){const{params:m}=e;if(!Array.isArray(m)||!(0,a.isPlainObject)(m[0]))return l((0,s.invalidParams)({data:{request:e}}));let[f]=m;delete f[i.Caip25EndowmentPermissionName];const h=(0,r.pick)(f,[o.RestrictedMethods.eth_accounts,c.PermissionNames.permittedChains]);delete f[o.RestrictedMethods.eth_accounts],delete f[c.PermissionNames.permittedChains];const g=Object.keys(h).length>0;if(g){const e=p(h);f={...f,...e}}let y={};const[w]=await d(f);if(y={...w},g){var v;const e=y[i.Caip25EndowmentPermissionName];if(!e)throw new Error(`could not find ${i.Caip25EndowmentPermissionName} permission.`);const t=null===(v=e.caveats)||void 0===v||null===(v=v.find(({type:e})=>e===i.Caip25CaveatType))||void 0===v?void 0:v.value;if(!t)throw new Error(`could not find ${i.Caip25CaveatType} in granted ${i.Caip25EndowmentPermissionName} permission.`);delete y[i.Caip25EndowmentPermissionName];const n=u(origin);y[o.RestrictedMethods.eth_accounts]={...e,parentCapability:o.RestrictedMethods.eth_accounts,caveats:[{type:o.CaveatTypes.restrictReturnedAccounts,value:n}]};const r=(0,i.getPermittedEthChainIds)(t);r.length>0&&(y[c.PermissionNames.permittedChains]={...e,parentCapability:c.PermissionNames.permittedChains,caveats:[{type:o.CaveatTypes.restrictNetworkSwitching,value:r}]})}return t.result=Object.values(y).filter(e=>e!==undefined),l()},hookNames:{getAccounts:!0,requestPermissionsForOrigin:!0,getCaip25PermissionFromLegacyPermissionsForOrigin:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-requestPermissions.ts"}],[3150,{assert:4034,buffer:4038,"component-type":4105,"join-component":4606},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("component-type"),a=e("join-component"),s=e("assert");t.exports=function(e,t){switch(o(e),t=t||e.type,s(t,"You must pass an event type."),t){case"track":return function(e){s(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),s(e.event,'You must pass an "event".')}(e);case"group":return function(e){s(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),s(e.groupId,'You must pass a "groupId".')}(e);case"identify":case"page":case"screen":return function(e){s(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".')}(e);case"alias":return function(e){s(e.userId,'You must pass a "userId".'),s(e.previousId,'You must pass a "previousId".')}(e);default:s(0,'Invalid event type: "'+t+'"')}};var i={anonymousId:["string","number"],category:"string",context:"object",event:"string",groupId:["string","number"],integrations:"object",name:"string",previousId:["string","number"],timestamp:"date",userId:["string","number"],type:"string"};function o(e){s("object"===r(e),"You must pass a message object.");var t=JSON.stringify(e);for(var o in s(n.byteLength(t,"utf8")<32768,"Your message must be < 32kb."),i){var c=e[o];if(c){var l=i[o];"array"!==r(l)&&(l=[l]);var u="object"===l[0]?"an":"a";s(l.some(function(e){return r(c)===e}),'"'+o+'" must be '+u+" "+a(l,"or")+".")}}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@segment/loosely-validate-event",file:"node_modules/@segment/loosely-validate-event/index.js"}],[316,{"../../../../../shared/constants/permissions":5776,"../../../controllers/permissions":230,"@metamask/chain-agnostic-permission":1360,"@metamask/permission-controller":2401,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.revokePermissionsHandler=void 0;var r=e("@metamask/permission-controller"),a=e("@metamask/utils"),s=e("@metamask/chain-agnostic-permission"),i=e("../../../../../shared/constants/permissions"),o=e("../../../controllers/permissions");n.revokePermissionsHandler={methodNames:[r.MethodNames.RevokePermissions],implementation:function(e,t,n,c,{revokePermissionsForOrigin:l,rejectApprovalRequestsForOrigin:u}){const{params:d}=e,p=null==d?void 0:d[0];if(!p)return c((0,r.invalidParams)({data:{request:e}}));const m=Object.keys(p).filter(e=>e!==s.Caip25EndowmentPermissionName);if(!(0,a.isNonEmptyArray)(m))return c((0,r.invalidParams)({data:{request:e}}));const f=[i.RestrictedMethods.eth_accounts,o.PermissionNames.permittedChains],h=m.filter(e=>!f.includes(e));h.length!==m.length&&h.push(s.Caip25EndowmentPermissionName);return l(h),u(),t.result=null,c()},hookNames:{revokePermissionsForOrigin:!0,rejectApprovalRequestsForOrigin:!0,updateCaveat:!0}}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/wallet-revokePermissions.ts"}],[317,{"../../../../../shared/constants/app":5753,"@metamask/controller-utils":1384,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("@metamask/rpc-errors"),a=e("@metamask/controller-utils"),s=e("../../../../../shared/constants/app");const i={methodNames:[s.MESSAGE_TYPE.WATCH_ASSET,s.MESSAGE_TYPE.WATCH_ASSET_LEGACY],implementation:async function(e,t,n,s,{handleWatchAssetRequest:i}){try{const{params:{options:n,type:o},origin:c,networkClientId:l}=e,{tokenId:u}=n;return[a.ERC721,a.ERC1155].includes(o)&&u!==undefined&&"string"!=typeof u?s(r.rpcErrors.invalidParams({message:`Expected parameter 'tokenId' to be type 'string'. Received type '${typeof u}'`})):(await i({asset:n,type:o,origin:c??"",networkClientId:l??""}),t.result=!0,s())}catch(e){return s(e)}},hookNames:{handleWatchAssetRequest:!0}};n.default=i}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/watch-asset.ts"}],[318,{"./createMethodMiddleware":303,"./createUnsupportedMethodMiddleware":304},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=e("./createMethodMiddleware");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===r[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}}))});var a=e("./createUnsupportedMethodMiddleware");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&(e in n&&n[e]===a[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}}))})}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/index.js"}],[3185,{"@metamask/eth-sig-util":1974,tslib:5664},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.transformTypedData=void 0;const r=e("tslib").__importStar(e("@metamask/eth-sig-util"));function a(e){switch(Object.prototype.toString.call(e)){case"[object Object]":{const t=Object.keys(e).map(t=>[t,a(e[t])]);return Object.fromEntries(t)}case"[object Array]":return e.map(e=>a(e));case"[object BigInt]":return e.toString();default:return e}}n.transformTypedData=(e,t)=>{if(!t)throw new Error("Trezor: Only version 4 of typed data signing is supported");const n=r.SignTypedDataVersion.V4,{types:s,primaryType:i,domain:o,message:c}=r.TypedDataUtils.sanitizeData(e),l=r.TypedDataUtils.hashStruct("EIP712Domain",a(o),s,n).toString("hex");let u=null;return"EIP712Domain"!==i&&(u=r.TypedDataUtils.hashStruct(i,a(c),s,n).toString("hex")),Object.assign({domain_separator_hash:l,message_hash:u},e)},n.default=n.transformTypedData}}},{package:"@metamask/eth-trezor-keyring>@trezor/connect-plugin-ethereum",file:"node_modules/@trezor/connect-plugin-ethereum/lib/index.js"}],[319,{"./operation-safener":296,loglevel:4802,"webextension-polyfill":5741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRequestSafeReload=function(e){const t=new s.OperationSafener({op:async t=>{try{await e.set(t)}catch(e){a.default.error("MetaMask - Persistence failed",e),null==o||o.captureException(e)}},wait:1e3});return{update:async(...e)=>t.execute(...e),requestSafeReload:async()=>{await t.evacuate(),r.default.runtime.reload()}}};var r=i(e("webextension-polyfill")),a=i(e("loglevel")),s=e("./operation-safener");function i(e){return e&&e.__esModule?e:{default:e}}const{sentry:o}=global}}},{package:"$root$",file:"app/scripts/lib/safe-reload.ts"}],[32,{"@metamask/claims-controller":1379},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ClaimsControllerInit=void 0;var r=e("@metamask/claims-controller");n.ClaimsControllerInit=e=>{const{controllerMessenger:t,persistedState:n}=e;return{controller:new r.ClaimsController({messenger:t,state:n.ClaimsController})}}}}},{package:"$root$",file:"app/scripts/controller-init/claims/claims-controller-init.ts"}],[320,{"../util":358,"@segment/loosely-validate-event":3150,buffer:4038,"is-retry-allowed":4591,lodash:4794,"remove-trailing-slash":5280,timers:4040},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t,r){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=l(e("remove-trailing-slash")),s=l(e("@segment/loosely-validate-event")),i=e("lodash"),o=l(e("is-retry-allowed")),c=e("../util");function l(e){return e&&e.__esModule?e:{default:e}}const u=()=>({});n.default=class{constructor(e,t={}){this.writeKey=e,this.host=(0,a.default)(t.host||"https://api.segment.io"),this.flushInterval=t.flushInterval||1e4,this.flushAt=t.flushAt||Math.max(t.flushAt,1)||20,this.queue=[],this.path="/v1/batch",this.maxQueueSize=460800,this.flushed=!1,this.retryCount=3,Object.defineProperty(this,"enable",{configurable:!1,writable:!1,enumerable:!0,value:!0})}_validate(e,t){(0,s.default)(e,t)}_message(e,t,n){return this._validate(t,e),this.enqueue(e,t,n),this}identify(e,t){return this._message("identify",e,t)}track(e,t){return this._message("track",e,t)}page(e,t){return this._message("page",e,t)}enqueue(e,t,n=u){if(!this.enable)return void r(n);const a={...t,type:e};if(a.context={...a.context,library:{name:"analytics-node"}},a.timestamp||(a.timestamp=new Date),a.messageId||(a.messageId=(0,c.generateRandomId)()),a.anonymousId&&!(0,i.isString)(a.anonymousId)&&(a.anonymousId=JSON.stringify(a.anonymousId)),a.userId&&!(0,i.isString)(a.userId)&&(a.userId=JSON.stringify(a.userId)),this.queue.push({message:a,callback:n}),!this.flushed)return this.flushed=!0,void this.flush();const s=this.queue.length>=this.flushAt,o=this.queue.reduce((e,t)=>e+JSON.stringify(t).length,0)>=this.maxQueueSize;(s||o)&&this.flush(),this.flushInterval&&!this.timer&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))}flush(e=u){if(!this.enable)return r(e),Promise.resolve();if(this.timer&&(clearTimeout(this.timer),this.timer=null),!this.queue.length)return r(e),Promise.resolve();const n=this.queue.splice(0,this.flushAt),a=n.map(e=>e.callback),s={batch:n.map(e=>e.message),timestamp:new Date,sentAt:new Date},i={Authorization:`Basic ${t.from(this.writeKey,"utf8").toString("base64")}`};return this._sendRequest(`${this.host}${this.path}`,{method:"POST",body:JSON.stringify(s),headers:i},t=>{r(()=>{a.forEach(e=>e(t,s)),e(t,s)})},0)}_retryRequest(e,t,n,r){const a=100*Math.pow(2,r);setTimeout(()=>{this._sendRequest(e,t,n,r+1)},a)}async _sendRequest(e,t,n,r){return fetch(e,t).then(async a=>{if(a.ok)n();else if(this._isErrorRetryable({response:a})&&r<=this.retryCount)this._retryRequest(e,t,n,r);else{const e=new Error(a.statusText);n(e)}}).catch(a=>{this._isErrorRetryable(a)&&r<=this.retryCount?this._retryRequest(e,t,n,r):n(a)})}_isErrorRetryable(e){return!!function(e){return!e.response&&Boolean(e.code)&&"ECONNABORTED"!==e.code&&(0,o.default)(e)}(e)||!!e.response&&(e.response.status>=500&&e.response.status<=599||429===e.response.status)}}}).call(this)}).call(this,e("buffer").Buffer,e("timers").setImmediate)}}},{package:"$root$",file:"app/scripts/lib/segment/analytics.js"}],[321,{"../../../../shared/constants/time":5790,"./analytics":320},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.segment=n.createSegmentMock=void 0;var r,a=e("../../../../shared/constants/time"),s=(r=e("./analytics"))&&r.__esModule?r:{default:r};const i="XdGJ17zKf3NjBPCDQ2UDjJjkx6FYBMGP",o=undefined,c=5*a.SECOND,l=(e=o)=>{const t={queue:[],flush(){t.queue.forEach(([e,t])=>{t()}),t.queue=[]},track(n,r=()=>undefined){t.queue.push([n,r]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};n.createSegmentMock=l;n.segment=i?new s.default(i,{host:null,flushAt:o,flushInterval:c}):l(o)}}},{package:"$root$",file:"app/scripts/lib/segment/index.js"}],[323,{"../../../../shared/lib/trace":5873},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.addPersonalMessage=async function({signatureParams:e,signatureController:t}){return a(e,t,"newUnsignedPersonalMessage")},n.addTypedMessage=async function({signatureParams:e,signatureController:t}){return a(e,t,"newUnsignedTypedMessage")};var r=e("../../../../shared/lib/trace");async function a(e,t,n){const[a,s,i,o]=e,{id:c,method:l,params:u}=s,d={id:c,method:l,params:u,origin:i.get("origin"),networkClientId:i.get("networkClientId"),securityAlertResponse:i.get("securityAlertResponse")},p=null==c?void 0:c.toString();(0,r.endTrace)({name:r.TraceName.Middleware,id:p});const m=await t[n](a,d,o);return(0,r.endTrace)({name:r.TraceName.Signature,id:p}),m}}}},{package:"$root$",file:"app/scripts/lib/signature/util.ts"}],[324,{"../../../../shared/constants/app":5753,"../../../../shared/constants/smartTransactions":5783,"../../../../shared/modules/conversion.utils":5887,"../../../../shared/modules/selectors":5906,"../../../../shared/modules/transaction.utils":5919,"@metamask/smart-transactions-controller":2645,"@metamask/transaction-controller":2989,loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSmartTransactionCommonParams=function(e,t){const n=function(e){return{metamask:e}}(e),r=(0,u.getIsSmartTransaction)(n,t),a=(0,u.getFeatureFlagsByChainId)(n,t),s=(0,u.isHardwareWallet)(n);return{isSmartTransaction:r,featureFlags:a,isHardwareWalletAccount:s}},n.submitSmartTransactionHook=n.submitBatchSmartTransactionHook=void 0;var r,a=e("@metamask/smart-transactions-controller"),s=e("@metamask/transaction-controller"),i=(r=e("loglevel"))&&r.__esModule?r:{default:r},o=e("../../../../shared/constants/app"),c=e("../../../../shared/constants/smartTransactions"),l=e("../../../../shared/modules/conversion.utils"),u=e("../../../../shared/modules/selectors"),d=e("../../../../shared/modules/transaction.utils");function p(e,t,n){m(e,t),t.set(e,n)}function m(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(e,t){return e.get(g(e,t))}function h(e,t,n){return e.set(g(e,t),n),n}function g(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var y=new WeakMap,w=new WeakMap,v=new WeakMap,b=new WeakMap,T=new WeakMap,k=new WeakMap,_=new WeakMap,E=new WeakMap,P=new WeakMap,S=new WeakMap,A=new WeakMap,C=new WeakMap,I=new WeakMap,M=new WeakMap,j=new WeakSet;class O{constructor(e){var t;!function(e,t){m(e,t),t.add(e)}(this,j),p(this,y,void 0),p(this,w,void 0),p(this,v,void 0),p(this,b,void 0),p(this,T,void 0),p(this,k,void 0),p(this,_,void 0),p(this,E,void 0),p(this,P,void 0),p(this,S,void 0),p(this,A,void 0),p(this,C,void 0),p(this,I,void 0),p(this,M,void 0);const{transactionMeta:n,signedTransactionInHex:r,smartTransactionsController:a,transactionController:c,isSmartTransaction:l,controllerMessenger:u,featureFlags:d,transactions:g}=e;h(w,this,""),h(y,this,!1),h(S,this,n),h(A,this,r),h(E,this,a),h(P,this,c),h(_,this,l),h(b,this,u),h(T,this,d),h(k,this,n.origin!==o.ORIGIN_METAMASK),h(v,this,n.chainId),h(I,this,n.txParams),h(C,this,g);const O=null==d||null===(t=d.smartTransactions)||void 0===t?void 0:t.extensionSkipSmartTransactionStatusPage;h(M,this,!O&&Boolean(n.type!==s.TransactionType.bridge&&n.type!==s.TransactionType.shieldSubscriptionApprove||f(C,this)&&f(C,this).length>0)),i.default.info("[SmartTransaction] shouldShowStatusPage:",f(M,this))}async submit(){const e=!!f(S,this).type&&[s.TransactionType.swapAndSend,s.TransactionType.swapApproval,s.TransactionType.bridgeApproval].includes(f(S,this).type),t={transactionHash:undefined};if(!f(_,this)||e||(0,d.isLegacyTransaction)(f(S,this)))return t;let n;if(f(M,this)&&await g(j,this,N).call(this),!f(A,this)||!f(S,this).isGasFeeSponsored)try{n=await f(E,this).getFees({...f(I,this),chainId:f(v,this)},undefined,{networkClientId:f(S,this).networkClientId})}catch(e){return i.default.error("Error in smart transaction publish hook, falling back to regular transaction submission",e),g(j,this,F).call(this),t}try{var r;const e=await g(j,this,q).call(this,{getFeesResponse:n}),t=null==e?void 0:e.uuid;if(!t)throw new Error("No smart transaction UUID");await g(j,this,D).call(this,t);let a;if(a=(null===(r=f(T,this))||void 0===r||null===(r=r.smartTransactions)||void 0===r?void 0:r.extensionReturnTxHashAsap)&&null!=e&&e.txHash?e.txHash:await g(j,this,G).call(this,{uuid:t}),null===a)throw new Error("Transaction does not have a transaction hash, there was a problem");return{transactionHash:a}}catch(e){throw i.default.error("Error in smart transaction publish hook",e),g(j,this,F).call(this),e}}async submitBatch(){if(!f(_,this))throw new Error("submitBatch: Smart Transaction is required for batch submissions");f(M,this)&&await g(j,this,N).call(this);try{var e,t;const n=await g(j,this,q).call(this),r=null==n?void 0:n.uuid;if(!r)throw new Error("submitBatch: No smart transaction UUID");let a;await g(j,this,D).call(this,r),a=null!=n&&n.txHashes?{results:n.txHashes.map(e=>({transactionHash:e}))}:{results:[]};if((null===(e=f(T,this))||void 0===e||null===(e=e.smartTransactions)||void 0===e?void 0:e.extensionReturnTxHashAsapBatch)&&(null===(t=a)||void 0===t||null===(t=t.results)||void 0===t?void 0:t.length)>0)return a;if(null===await g(j,this,G).call(this,{uuid:r}))throw new Error("submitBatch: Transaction does not have a transaction hash, there was a problem");return a}catch(e){throw i.default.error("submitBatch: Error in smart transaction publish batch hook",e),g(j,this,F).call(this),e}}}async function R(e){try{await f(b,this).call("ApprovalController:endFlow",{id:e})}catch(e){}}async function x(e){try{await g(j,this,R).call(this,e),await f(b,this).call("ApprovalController:acceptRequest",e),Y._=""}catch(e){i.default.error("Error ending existing approval flow",e)}}async function N(){Y._&&await g(j,this,x).call(this,Y._);const{id:e}=await f(b,this).call("ApprovalController:startFlow");h(w,this,e),Y._=e}async function D(e){f(M,this)&&(g(j,this,B).call(this,{uuid:e}),g(j,this,L).call(this,{uuid:e}))}function F(){f(M,this)&&!f(y,this)&&(h(y,this,!0),g(j,this,R).call(this,f(w,this)),Y._===f(w,this)&&(Y._=""))}function B({uuid:e}){const t=()=>{g(j,this,F).call(this)};f(b,this).call("ApprovalController:addRequest",{id:f(w,this),origin:origin,type:o.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage,requestState:{smartTransaction:{status:a.SmartTransactionStatuses.PENDING,creationTime:Date.now(),uuid:e,chainId:f(v,this)},isDapp:f(k,this),txId:f(S,this).id}},!0).then(t,t)}async function U({smartTransaction:e}){return await f(b,this).call("ApprovalController:updateRequestState",{id:f(w,this),requestState:{smartTransaction:e,isDapp:f(k,this),txId:f(S,this).id}})}async function L({uuid:e}){f(b,this).subscribe("SmartTransactionsController:smartTransaction",async t=>{if(t.uuid===e){const{status:e}=t;if(!e||e===a.SmartTransactionStatuses.PENDING)return;f(y,this)||await g(j,this,U).call(this,{smartTransaction:t})}})}function G({uuid:e}){return new Promise(t=>{f(b,this).subscribe("SmartTransactionsController:smartTransaction",async n=>{if(n.uuid===e){const{status:e,statusMetadata:r}=n;if(!e||e===a.SmartTransactionStatuses.PENDING)return;i.default.debug("Smart Transaction: ",n),null!=r&&r.minedHash?(i.default.debug("Smart Transaction - Received tx hash: ",null==r?void 0:r.minedHash),t(r.minedHash)):t(null)}})})}async function q({getFeesResponse:e}={}){let t=[];if(f(C,this)&&Array.isArray(f(C,this))&&f(C,this).length>0)t=f(C,this).filter(e=>null==e?void 0:e.signedTx).map(e=>e.signedTx);else if(f(A,this))t=[f(A,this)];else if(e){var n;t=await g(j,this,H).call(this,(null===(n=e.tradeTxFees)||void 0===n?void 0:n.fees)??[],!1)}return await f(E,this).submitSignedTransactions({signedTransactions:t,signedCanceledTransactions:[],txParams:f(I,this),transactionMeta:f(S,this),networkClientId:f(S,this).networkClientId})}function $(e,t){if(!f(I,this))throw new Error("Transaction params are required");const n={...f(I,this),maxFeePerGas:`0x${(0,l.decimalToHex)(e.maxFeePerGas)}`,maxPriorityFeePerGas:`0x${(0,l.decimalToHex)(e.maxPriorityFeePerGas)}`,gas:t?`0x${(0,l.decimalToHex)(c.CANCEL_GAS_LIMIT_DEC)}`:f(I,this).gas};return t&&(n.to=n.from,n.data="0x"),n}async function H(e,t){if(!f(I,this)||!f(v,this))throw new Error("Transaction params and chainId are required");const n=e.map(e=>g(j,this,$).call(this,e,t)).map(e=>({...e,chainId:e.chainId||f(v,this)}));return await f(P,this).approveTransactionsWithSameNonce(n,{hasNonce:!0})}var Y={_:""};n.submitSmartTransactionHook=e=>new O(e).submit();n.submitBatchSmartTransactionHook=e=>new O(e).submitBatch()}}},{package:"$root$",file:"app/scripts/lib/smart-transaction/smart-transactions.ts"}],[325,{"./snap-keyring":328,"./utils":329},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getAccountsBySnapId",{enumerable:!0,get:function(){return a.getAccountsBySnapId}}),Object.defineProperty(n,"snapKeyringBuilder",{enumerable:!0,get:function(){return r.snapKeyringBuilder}});var r=e("./snap-keyring"),a=e("./utils")}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/index.ts"}],[326,{"@metamask/keyring-api":2173,"@metamask/permission-controller":2401},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isProtocolAllowed=u,n.keyringSnapPermissionsBuilder=function(e,t){return()=>{if("metamask"===t)return i;if(s.includes(t))return c;const n=e.getSubjectMetadata(t);return(null==n?void 0:n.subjectType)===a.SubjectType.Website&&u(t)?o:[]}};var r=e("@metamask/keyring-api"),a=e("@metamask/permission-controller");const s=["https://app.metamask.io"],i=[r.KeyringRpcMethod.ListAccounts,r.KeyringRpcMethod.GetAccount,r.KeyringRpcMethod.FilterAccountChains,r.KeyringRpcMethod.DeleteAccount,r.KeyringRpcMethod.ListRequests,r.KeyringRpcMethod.GetRequest,r.KeyringRpcMethod.SubmitRequest,r.KeyringRpcMethod.RejectRequest],o=[r.KeyringRpcMethod.ListAccounts,r.KeyringRpcMethod.GetAccount,r.KeyringRpcMethod.CreateAccount,r.KeyringRpcMethod.FilterAccountChains,r.KeyringRpcMethod.UpdateAccount,r.KeyringRpcMethod.DeleteAccount,r.KeyringRpcMethod.ExportAccount,r.KeyringRpcMethod.ListRequests,r.KeyringRpcMethod.GetRequest,r.KeyringRpcMethod.ApproveRequest,r.KeyringRpcMethod.RejectRequest],c=[r.KeyringRpcMethod.ListAccounts,r.KeyringRpcMethod.GetAccount,r.KeyringRpcMethod.GetAccountBalances,r.KeyringRpcMethod.SubmitRequest],l=["https:"];function u(e){try{const t=new URL(e);return l.includes(t.protocol)}catch(e){return!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/keyring-snaps-permissions.ts"}],[327,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapAndHardwareInfoForMetrics=async function(e,t,n,r){var a,s,i;if(!r)return{};const o=r.call("AccountsController:getSelectedAccount"),c=o.address;let l;var u;null!==(a=o.metadata.snap)&&void 0!==a&&a.id&&(l=r.call("SnapController:get",null===(u=o.metadata.snap)||void 0===u?void 0:u.id));let d={};const{isUnlocked:p}=r.call("KeyringController:getState");if(p){d={account_type:await e(c),device_model:await t(c)};const r=await n(c);r&&(d={...d,account_hardware_type:r})}return{...d,account_snap_type:null===(s=l)||void 0===s?void 0:s.id,account_snap_version:null===(i=l)||void 0===i?void 0:i.version}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/metrics.ts"}],[328,{"../../../../shared/constants/app":5753,"../../../../shared/constants/metametrics":5768,"../../../../shared/lib/accounts":5797,"../../../../shared/lib/accounts/snaps":5799,"../../../../shared/lib/multichain-accounts/remote-feature-flag":5857,"../../../../shared/lib/snaps/snaps":5868,"../../../../shared/lib/translate":5878,"../../../../ui/components/component-library/icon":6485,"./utils/isBlockedUrl":330,"./utils/showResult":331,"@metamask/eth-snap-keyring":2005,"@metamask/snaps-utils":2902,"webextension-polyfill":5741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.showAccountCreationDialog=k,n.showAccountNameSuggestionDialog=_,n.snapKeyringBuilder=function(e,t){const n=()=>new a.SnapKeyring({messenger:e,callbacks:new I(e,t)});return n.state=null,n.type=a.SnapKeyring.type,n};var r,a=e("@metamask/eth-snap-keyring"),s=(r=e("webextension-polyfill"))&&r.__esModule?r:{default:r},i=e("@metamask/snaps-utils"),o=e("../../../../shared/constants/metametrics"),c=e("../../../../shared/constants/app"),l=e("../../../../shared/lib/translate"),u=e("../../../../ui/components/component-library/icon"),d=e("../../../../shared/lib/accounts"),p=e("../../../../shared/lib/snaps/snaps"),m=e("../../../../shared/lib/accounts/snaps"),f=e("../../../../shared/lib/multichain-accounts/remote-feature-flag"),h=e("./utils/isBlockedUrl"),g=e("./utils/showResult");function y(e,t,n){w(e,t),t.set(e,n)}function w(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function v(e,t){return e.get(T(e,t))}function b(e,t,n){return e.set(T(e,t),n),n}function T(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}async function k(e,t){try{return Boolean(await t.call("ApprovalController:addRequest",{origin:e,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation},!0))}catch(e){throw new Error(`Error occurred while showing account creation dialog.\n${e}`)}}async function _(e,t,n){try{return await t.call("ApprovalController:addRequest",{origin:e,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showNameSnapAccount,requestData:{snapSuggestedAccountName:n}},!0)}catch(e){throw new Error(`Error occurred while showing name account dialog.\n${e}`)}}var E=new WeakMap,P=new WeakMap,S=new WeakMap,A=new WeakMap,C=new WeakSet;class I{constructor(e,{trackEvent:t,persistKeyringHelper:n,removeAccountHelper:r}){!function(e,t){w(e,t),t.add(e)}(this,C),y(this,E,void 0),y(this,P,void 0),y(this,S,void 0),y(this,A,void 0),b(E,this,e),b(P,this,t),b(S,this,n),b(A,this,r)}async addressExists(e){return(await v(E,this).call("KeyringController:getAccounts")).includes(e.toLowerCase())}async redirectUser(e,t,n){if(t.length>0||n.length>0){const r=await(0,h.isBlockedUrl)(t,async()=>await v(E,this).call("PhishingController:maybeUpdateState"),e=>v(E,this).call("PhishingController:testOrigin",e)),a=await v(E,this).call("ApprovalController:addRequest",{origin:e,requestData:{url:t,message:n,isBlockedUrl:r},type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect},!0);Boolean(a)&&t.length>0?s.default.tabs.create({url:t}):console.log("User refused snap account redirection to:",t)}else console.log("Error occurred when redirecting snap account. url or message must be defined")}async saveState(){await v(S,this).call(this)}async addAccount(e,t,n,r,s="",{displayConfirmation:o,displayAccountNameSuggestion:c,setSelectedAccount:l}=(0,a.getDefaultInternalOptions)()){(0,i.assertIsValidSnapId)(t);const u=(0,p.isSnapPreinstalled)(t);let d=u&&(0,m.isMultichainWalletSnap)(t);const f=d||u&&!o,h=d||u&&!c,g=d||u&&!l,y=f&&h,{accountName:w}=await T(C,this,R).call(this,{snapId:t,skipConfirmationDialog:f,skipAccountNameSuggestionDialog:h,skipApprovalFlow:y,accountNameSuggestion:d?"":s,handleUserInput:n});T(C,this,N).call(this,{address:e,snapId:t,skipConfirmationDialog:f,skipSetSelectedAccountStep:g,skipApprovalFlow:y,accountName:w,onceSaved:r,defaultAccountNameChosen:Boolean(s)&&w===s})}async removeAccount(e,t,n){(0,i.assertIsValidSnapId)(t);const r=(0,m.getSnapName)(t,v(E,this)),{id:a}=v(E,this).call("ApprovalController:startFlow"),s="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-remove-an-account-from-your-metamask-wallet/",d=e=>{v(P,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:r}})};let p=!1;try{if(p=Boolean(await v(E,this).call("ApprovalController:addRequest",{origin:t,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval,requestData:{publicAddress:e}},!0)),!p)throw await n(p),new Error("User denied account removal");try{await v(A,this).call(this,e),await n(p),await v(S,this).call(this),d(o.MetaMetricsEventName.RemoveSnapAccountSuccessViewed),await(0,g.showError)(v(E,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemoved")},{message:(0,l.t)("snapAccountRemovedDescription"),learnMoreLink:s}),d(o.MetaMetricsEventName.RemoveSnapAccountSuccessClicked)}catch(e){const n=e.message;throw await(0,g.showError)(v(E,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemovalFailed")},{message:(0,l.t)("snapAccountRemovalFailedDescription",r),learnMoreLink:s,error:n}),d(o.MetaMetricsEventName.AccountRemoveFailed),new Error(`Error occurred while removing snap account: ${n}`)}}finally{p&&d(o.MetaMetricsEventName.AccountRemoved),v(E,this).call("ApprovalController:endFlow",{id:a})}}}async function M(e){const{id:t}=v(E,this).call("ApprovalController:startFlow");try{return await e(t)}finally{v(E,this).call("ApprovalController:endFlow",{id:t})}}async function j(e,t){const{success:n,name:r}=await _(e,v(E,this),t);return{success:n,accountName:r}}async function O(e){const t=await v(E,this).call("AccountsController:listMultichainAccounts");return{success:!0,accountName:(0,d.getUniqueAccountName)(t,e)}}async function R({snapId:e,skipConfirmationDialog:t,skipAccountNameSuggestionDialog:n,skipApprovalFlow:r,handleUserInput:a,accountNameSuggestion:s}){if(r){const{success:e,accountName:t}=await T(C,this,O).call(this,s);if(await a(e),!e)throw new Error("User denied account creation");return{accountName:t}}return await T(C,this,M).call(this,async r=>{{const n=t||await k(e,v(E,this));if(!n)throw await a(n),new Error("User denied account creation")}{const{success:t,accountName:r}=n?await T(C,this,O).call(this,s):await T(C,this,j).call(this,e,s);if(await a(t),!t)throw new Error("User denied account creation");return{accountName:r}}})}function x(){var e;const t=v(E,this).call("RemoteFeatureFlagController:getState"),n=null==t||null===(e=t.remoteFeatureFlags)||void 0===e?void 0:e.enableMultichainAccountsState2;return(0,f.isMultichainAccountsFeatureEnabled)(n,f.FEATURE_VERSION_2)}async function N({address:e,snapId:t,skipConfirmationDialog:n,skipSetSelectedAccountStep:r,skipApprovalFlow:a,onceSaved:s,accountName:i,defaultAccountNameChosen:c}){const d="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-add-accounts-in-your-wallet/",p=(0,m.getSnapName)(t,v(E,this)),f=e=>{v(P,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:p,...e===o.MetaMetricsEventName.AccountAdded&&{is_suggested_name:c}}})},h=async()=>{try{const a=await s;r||v(E,this).call("AccountsController:setSelectedAccount",a),T(C,this,x).call(this)||i&&v(E,this).call("AccountsController:setAccountName",a,i),n||(f(o.MetaMetricsEventName.AddSnapAccountSuccessViewed),await(0,g.showSuccess)(v(E,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreated")},{message:(0,l.t)("snapAccountCreatedDescription"),address:e,learnMoreLink:d}),f(o.MetaMetricsEventName.AddSnapAccountSuccessClicked)),f(o.MetaMetricsEventName.AccountAdded)}catch(e){const n=e.message;await(0,g.showError)(v(E,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreationFailed")},{message:(0,l.t)("snapAccountCreationFailedDescription",p),learnMoreLink:d,error:n}),console.error("Error occurred while creating snap account:",n)}};a?await h():await T(C,this,M).call(this,h)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/snap-keyring.ts"}],[329,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAccountsBySnapId=void 0;n.getAccountsBySnapId=async(e,t)=>{const n=await e();return await n.getAccountsBySnapId(t)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils.ts"}],[33,{"../../../../shared/modules/shield/config":5911,"@metamask/claims-controller":1379},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ClaimsServiceInit=void 0;var r=e("@metamask/claims-controller"),a=e("../../../../shared/modules/shield/config");n.ClaimsServiceInit=e=>{const{controllerMessenger:t}=e,{claimsEnv:n}=(0,a.loadShieldConfig)();return{controller:new r.ClaimsService({messenger:t,env:n,fetchFunction:fetch.bind(globalThis)}),memStateKey:null,persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/claims/claims-service-init.ts"}],[330,{"../keyring-snaps-permissions":326},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isBlockedUrl=void 0;var r=e("../keyring-snaps-permissions");n.isBlockedUrl=async(e,t,n)=>{try{return!(0,r.isProtocolAllowed)(e)||(await t(),n(e).result)}catch(e){return console.error("Invalid URL passed into snap-keyring:",e),!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/isBlockedUrl.ts"}],[331,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.showSuccess=n.showError=void 0;const r=e=>({name:"SnapAuthorshipHeader",key:"snapHeader",properties:{snapId:e}});n.showError=(e,t,n,a)=>e.call("ApprovalController:showError",{header:[r(t)],title:n.title,icon:n.icon,error:{key:"snapAccountErrorMessage",name:"SnapAccountErrorMessage",properties:a}});n.showSuccess=(e,t,n,a)=>e.call("ApprovalController:showSuccess",{header:[r(t)],title:n.title,icon:n.icon,message:{key:"snapAccountSuccessMessage",name:"SnapAccountSuccessMessage",properties:a}})}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/showResult.ts"}],[332,{loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.tryPostMessage=function(e,t,n){const r={data:{method:t,params:n}};try{return e.postMessage(r),!0}catch(e){return a.default.error("MetaMask - Failed to message to port",e,r),!1}};var r,a=(r=e("loglevel"))&&r.__esModule?r:{default:r}}}},{package:"$root$",file:"app/scripts/lib/start-up-errors/start-up-errors.ts"}],[333,{"../../../../shared/constants/start-up-errors":5785,"../../../../shared/constants/state-corruption":5786,"../start-up-errors/start-up-errors":332,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CorruptionHandler=void 0,n.hasVault=c;var r=e("@metamask/utils"),a=e("../../../../shared/constants/state-corruption"),s=e("../start-up-errors/start-up-errors"),i=e("../../../../shared/constants/start-up-errors");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){if((0,r.isObject)(e)&&(0,r.hasProperty)(e,"KeyringController")){const t=e.KeyringController;if((0,r.isObject)(t)&&(0,r.hasProperty)(t,"vault"))return Boolean(t.vault)}return!1}n.CorruptionHandler=class{constructor(){o(this,"connectedPorts",new Set)}async handleStateCorruptionError({port:e,error:t,database:n,repairCallback:o}){const{connectedPorts:l}=this,u=await async function(e,t){let n=(0,r.isObject)(e)&&(0,r.hasProperty)(e,"backup")&&null!==e.backup?e.backup:null;if(!n)try{n=await t.getBackup()??null}catch{n=null}return n}(t,n),d=function(e){if((0,r.isObject)(e)&&(0,r.hasProperty)(e,"PreferencesController")){const t=e.PreferencesController;if((0,r.isObject)(t)&&(0,r.hasProperty)(t,"currentLocale")&&"string"==typeof t.currentLocale)return t.currentLocale}return null}(u),p=Boolean(c(u));return(0,s.tryPostMessage)(e,a.METHOD_DISPLAY_STATE_CORRUPTION_ERROR,{error:{message:t.message,name:t.name,stack:t.stack},currentLocale:d,hasBackup:p})?new Promise((t,n)=>{l.add(e),e.onDisconnect.addListener(function(){l.delete(e),t()}),e.onMessage.addListener(async function e(r){var c;if((null==r||null===(c=r.data)||void 0===c?void 0:c.method)===a.METHOD_REPAIR_DATABASE){l.forEach(t=>t.onMessage.removeListener(e));try{await async function(e){return await navigator.locks.request("repairDatabase",{ifAvailable:!0},async function(t){return null!==t&&(await e(),!0)})}(async function(){try{await o(u)}finally{l.forEach(e=>{(0,s.tryPostMessage)(e,i.RELOAD_WINDOW)})}}),t()}catch(e){n(e)}}})}):Promise.resolve()}}}}},{package:"$root$",file:"app/scripts/lib/state-corruption/state-corruption-recovery.ts"}],[334,{lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sanitizePatches=function(e){return e.filter(e=>{if(a.includes(e.path[0]))return!1;for(const t of s)if(i(e,t))return!1;return!0})},n.sanitizeUIState=function(e){const t={...e};for(const e of a)delete t[e];return function(e){const t=e.snaps;if(!t)return;e.snaps=Object.values(t).reduce((e,t)=>(e[t.id]=function(e){const t={...e};return delete t.sourceCode,delete t.auxiliaryFiles,t}(t),e),{})}(t),function(e){const t=e.srpSessionData;if(!t)return;e.srpSessionData=Object.entries(t).reduce((e,[t,n])=>{const r={...n.token};return delete r.accessToken,e[t]={...n,token:r},e},{})}(t),function(e){const t=e.nodeAuthTokens;t&&(e.nodeAuthTokens=t.map(e=>{const t={...e};return delete t.authToken,t}));const n=e.socialBackupsMetadata;n&&(e.socialBackupsMetadata=n.map(e=>{const t={...e};return delete t.hash,t}))}(t),t};var r=e("lodash");const a=["encryptionKey","encryptionSalt","vault","c2DomainBlocklistLastFetched","hotlistLastFetched","phishingLists","stalelistLastFetched","whitelist","whitelistPaths","accessToken","encryptedKeyringEncryptionKey","encryptedSeedlessEncryptionKey","metadataAccessToken","refreshToken","revokeToken","vaultEncryptionKey","vaultEncryptionSalt","snapStates","unencryptedSnapStates"],s=[["nodeAuthTokens",!0,"authToken"],["snaps",!0,"auxiliaryFiles"],["snaps",!0,"sourceCode"],["socialBackupsMetadata",!0,"hash"],["srpSessionData",!0,"token","accessToken"]];function i(e,t){for(let n=0;n<t.length;n++){const a=t[n],s=n===t.length-1,i=n===e.path.length-1;if(!(e.path[n]===a||!0===a&&e.path[n]!==undefined))return!1;if(s)return!0;if(i&&!c(e.value))return!1;if(i){const a=t.slice(n+1);return e.value=(0,r.cloneDeep)(e.value),o(e.value,a),!1}}return!1}function o(e,t,n=0){const r=t[n],a=n===t.length-1;if(a&&!0!==r&&r in e&&!Array.isArray(e))return void delete e[r];if(a)return;let s=[];!0===r?s=Object.values(e):Array.isArray(e)||(s=[e[r]]);const i=s.filter(c);for(const e of i)o(e,t,n+1)}function c(e){return"object"==typeof e&&null!==e&&e!==undefined}}}},{package:"$root$",file:"app/scripts/lib/state-utils.ts"}],[34,{"./claims-controller-init":32,"./claims-service-init":33},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ClaimsControllerInit",{enumerable:!0,get:function(){return r.ClaimsControllerInit}}),Object.defineProperty(n,"ClaimsServiceInit",{enumerable:!0,get:function(){return a.ClaimsServiceInit}});var r=e("./claims-controller-init"),a=e("./claims-service-init")}}},{package:"$root$",file:"app/scripts/controller-init/claims/index.ts"}],[340,{"../../../../../shared/lib/delegation":5841,"../../../../../shared/lib/delegation/delegation":5838,"@metamask/transaction-controller":2989,"@metamask/utils":3070,"bignumber.js":3926},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.enforceSimulations=async function({messenger:e,transactionMeta:t,useRealSignature:n=!1}){c("Enforcing simulations",{transactionMeta:t,useRealSignature:n});const{chainId:s,simulationData:d={tokenBalanceChanges:[]},txParams:p}=t,m=p.from,f=(0,a.hexToNumber)(s),h=(0,i.getDeleGatorEnvironment)(f),g=h.DelegationManager,y=function(e,t){const n=e.call("AppStateController:getState"),r=n.enforcedSimulationsSlippage;return n.enforcedSimulationsSlippageForTransactions[t]??r}(e,t.id),w=function({accountAddress:e,environment:t,simulationData:n,slippage:a}){const s=function(e,t,n,a){const s=(0,i.createCaveatBuilder)(t),{nativeBalanceChange:o,tokenBalanceChanges:l=[]}=n;if(o){const{difference:t,isDecrease:n}=o,r=u(t,a,n);c("Caveat - Native Balance Change",{enforceDecrease:n,recipient:e,delta:BigInt(t),slippage:a,deltaWithSlippage:r}),s.addCaveat("nativeBalanceChange",n,e,r)}for(const t of l){const{difference:n,isDecrease:i,address:o,standard:l,id:d}=t,p=BigInt(n),m=u(n,a,i),f=d?BigInt(d):0n;switch(c("Caveat - Token Balance Change",{enforceDecrease:i,token:o,recipient:e,delta:p,slippage:a,deltaWithSlippage:m}),l){case r.SimulationTokenStandard.erc20:s.addCaveat("erc20BalanceChange",i,o,e,m);break;case r.SimulationTokenStandard.erc721:s.addCaveat("erc721BalanceChange",i,o,e,p);break;case r.SimulationTokenStandard.erc1155:s.addCaveat("erc1155BalanceChange",i,o,e,f,p);break;default:c("Unsupported token standard",l)}}return s.build()}(e,t,n,a);c("Caveats",s);const o=(0,i.createDelegation)({from:e,to:e,caveats:s});return o}({accountAddress:m,environment:h,simulationData:d,slippage:y});c("Delegation",w);let v=l;n&&(c("Signing delegation"),v=await e.call("DelegationController:signDelegation",{chainId:s,delegation:w}));c("Delegation signature",v);const b=function({transaction:e,delegation:t}){const n=[[t]],r=[i.SINGLE_DEFAULT_MODE],a=[[{target:e.to,callData:e.data??"0x",value:e.value?BigInt(e.value):0n}]];return(0,o.encodeRedeemDelegations)({delegations:n,modes:r,executions:a})}({transaction:p,delegation:{...w,signature:v}});return c("Data",b),{updateTransaction:e=>{e.txParams.data=b,e.txParams.to=g,e.txParams.value="0x0"}}};var r=e("@metamask/transaction-controller"),a=e("@metamask/utils"),s=e("bignumber.js"),i=e("../../../../../shared/lib/delegation"),o=e("../../../../../shared/lib/delegation/delegation");const c=(0,a.createProjectLogger)("enforced-simulations"),l="0x2261a7810ed3e9cde160895909e138e2f68adb2da86fcf98ea0840701df107721fb369ab9b52550ea98832c09f8185284aca4c94bd345e867a4f4461868dd7751b";function u(e,t,n){const r=new s.BigNumber(e),a=(100+(n?t:-t))/100;return BigInt(r.mul(a).toFixed(0))}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/enforced-simulations.ts"}],[341,{"./enforced-simulations":340,"@metamask/transaction-controller":2989,"@metamask/utils":3070,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.applyTransactionContainers=c,n.applyTransactionContainersExisting=async function({containerTypes:e,transactionId:t,messenger:n,updateEditableParams:r}){const s=(await n.call("TransactionController:getState")).transactions.find(e=>e.id===t);if(!s)throw new Error(`Transaction with ID ${t} not found.`);const{updateTransaction:i}=await c({isApproved:!1,messenger:n,transactionMeta:s,types:e}),o=(0,a.cloneDeep)(s);i(o),r(t,{containerTypes:e,data:o.txParams.data,gas:o.txParams.gas,to:o.txParams.to,value:o.txParams.value})};var r=e("@metamask/transaction-controller"),a=e("lodash"),s=e("@metamask/utils"),i=e("./enforced-simulations");const o=(0,s.createProjectLogger)("transaction-containers");async function c({isApproved:e,messenger:t,transactionMeta:n,types:s}){const{txParamsOriginal:c}=n,l=(0,a.cloneDeep)(n);if(c&&(l.txParams=(0,a.cloneDeep)(c)),s.includes(r.TransactionContainerType.EnforcedSimulations)){const{updateTransaction:n}=await(0,i.enforceSimulations)({messenger:t,transactionMeta:l,useRealSignature:e});n(l)}let u;if(!e){const{gas:e}=await t.call("TransactionController:estimateGas",l.txParams,l.networkClientId,{ignoreDelegationSignatures:!0});o("Estimated gas",e),u=e}return{updateTransaction:e=>{e.containerTypes=s,e.txParams=(0,a.cloneDeep)(l.txParams),u&&(e.txParams.gas=u)}}}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/util.ts"}],[342,{"../../../../../shared/lib/four-byte":5848,"@ethersproject/abi":705,"@metamask/utils":3070,"ethereumjs-util":4296},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionDataWithFourByte=async function(e){const t=e.slice(0,10),n=await(0,i.getMethodFrom4Byte)(t);if(!n)return undefined;const s=n.split("(")[0],d=function(e){let t=e.slice(e.indexOf("(")+1,-1);const n=[];for(;t.includes("(");){const e=u(t);if(!e)break;n.push(e.value),t=`${t.slice(0,e.start)}${n.length-1}#${t.slice(e.end+1)}`}return l(t,n)}(n);o("Generated inputs",d);const p=(0,r.addHexPrefix)(e.slice(10)),m=a.Interface.getAbiCoder().decode(d,p),f=d.map((e,t)=>c(e,t,m));return{name:s,params:f}};var r=e("ethereumjs-util"),a=e("@ethersproject/abi"),s=e("@metamask/utils"),i=e("../../../../../shared/lib/four-byte");const o=(0,s.createProjectLogger)("four-byte");function c(e,t,n){var r;const a=n[t],{type:s,name:i}=e;let o=null===(r=e.components)||void 0===r?void 0:r.map((e,t)=>c(e,t,a));if(s.endsWith("[]")){const t=s.slice(0,-2);o=a.map((n,r)=>{const s=`Item ${r+1}`;return c({...e,name:s,type:t},r,a)})}return{name:i,type:s,value:a,children:o}}function l(e,t){return e.split(",").map(e=>{const n=e.split("#"),r=n.length>1?parseInt(n[0],10):undefined;return{type:r===undefined?e:`tuple${n[1]??""}`,components:r===undefined?undefined:l(t[r],t)}})}function u(e){let t=-1;for(let n=0;n<e.length;n++)if("("===e[n])t=n;else if(")"===e[n]&&-1!==t)return{start:t,end:n,value:e.slice(t+1,n)};return undefined}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/four-byte.ts"}],[343,{"ethereumjs-util":4296},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getContractProxyAddress=async function(e,t){const n=(await Promise.all(a.map(n=>t.request({method:"eth_getStorageAt",params:[e,n,"latest"]})))).find(e=>(0,r.stripHexPrefix)(e)!==s);return n&&(0,r.addHexPrefix)(n.slice(26))};var r=e("ethereumjs-util");const a=["0x7050c9e0f4ca769c69bd3a8ef740bc37934f8e2c036e5a723fd8ee048ed3f8c3","0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc"],s="0".padEnd(64,"0")}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/proxy.ts"}],[344,{"@ethersproject/abi":705,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionDataWithSourcify=async function(e,t,n){var o,c;const l=await async function(e,t){var n;const r=await async function(e,t){const n=parseInt(t,16),r=await fetch(`https://sourcify.dev/server/files/any/${n}/${e}`);if(!r.ok)throw new Error("Failed to fetch Sourcify files");return r.json()}(e,t),a=null===(n=r.files)||void 0===n?void 0:n.find(e=>e.name.includes("metadata.json"));if(!a)throw new Error("Metadata not found");return JSON.parse(a.content)}(t,n);a("Retrieved Sourcify metadata",{contractAddress:t,chainId:n,metadata:l});const{abi:u}=l.output,d=new r.Interface(u),p=e.slice(0,10);let m;try{m=d.getFunction(p)}catch(e){}if(!m)return a("Failed to find function in ABI",p,u),undefined;const{name:f,inputs:h}=m,g=i(f,h),y=null===(o=l.output.userdoc)||void 0===o?void 0:o.methods[g],w=null===(c=l.output.devdoc)||void 0===c?void 0:c.methods[g],v=(null==y?void 0:y.notice)??(null==w?void 0:w.details);a("Extracted NatSpec",{signature:g,userDoc:y,devDoc:w});const b=d.decodeFunctionData(p,e),T=h.map((e,t)=>s(e,t,b,y,w));return{name:f,description:v,params:T}};var r=e("@ethersproject/abi");const a=(0,e("@metamask/utils").createProjectLogger)("sourcify");function s(e,t,n,r,a){var i,o;const{name:c,type:l,components:u}=e,d=(null==r||null===(i=r.params)||void 0===i?void 0:i[c])??(null==a||null===(o=a.params)||void 0===o?void 0:o[c]),p=n[t];let m=null==u?void 0:u.map((e,t)=>s(e,t,p,{},{}));if(l.endsWith("[]")){const t=l.slice(0,-2);m=p.map((n,r)=>{const a=`Item ${r+1}`;return s({...e,name:a,type:t},r,p,{},{})})}return{name:c,description:d,type:l,value:p,children:m}}function i(e,t){return`${e??""}(${t.map(e=>{var t;return null!==(t=e.components)&&void 0!==t&&t.length?`${i(undefined,e.components)}${e.type.endsWith("[]")?"[]":""}`:e.type}).join(",")})`}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/sourcify.ts"}],[345,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.UNISWAP_ROUTER_COMMANDS=void 0;n.UNISWAP_ROUTER_COMMANDS={0:{name:"V3_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},1:{name:"V3_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},2:{name:"PERMIT2_TRANSFER_FROM",params:[{type:"address",description:"The token to fetch from Permit2",name:"token"},{type:"address",description:"The recipient of the tokens fetched",name:"recipient"},{type:"uint256",description:"The amount of token to fetch",name:"amount"}]},3:{name:"PERMIT2_PERMIT_BATCH",params:[{type:"bytes",description:"A PermitBatch struct outlining all of the Permit2 permits to execute.",name:"batch"},{type:"bytes",description:"The signature to provide to Permit2",name:"data"}]},4:{name:"SWEEP",params:[{type:"address",description:"The ERC20 token to sweep (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amountMin"}]},5:{name:"TRANSFER",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The amount to transfer",name:"value"}]},6:{name:"PAY_PORTION",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"In basis points, the percentage of the contracts balance to transfer",name:"bips"}]},8:{name:"V2_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},9:{name:"V2_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},10:{name:"PERMIT2_PERMIT",params:[{type:"bytes",description:"A PermitSingle struct outlining the Permit2 permit to execute",name:"permitSingle"},{type:"bytes",description:"The signature to provide to Permit2",name:"signature"}]},11:{name:"WRAP_ETH",params:[{type:"address",description:"The recipient of the WETH",name:"recipient"},{type:"uint256",description:"The amount of ETH to wrap",name:"amountMin"}]},12:{name:"UNWRAP_WETH",params:[{type:"address",description:"The recipient of the ETH",name:"recipient"},{type:"uint256",description:"The minimum required ETH to receive from the unwrapping",name:"amountMin"}]},13:{name:"PERMIT2_TRANSFER_FROM_BATCH",params:[{type:"bytes",description:"An array of AllowanceTransferDetails structs that each describe a Permit2 transfer to perform",name:"batchDetails"}]},16:{name:"SEAPORT",params:[{type:"uint256",description:"The ETH value to forward to the Seaport contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Seaport contract",name:"data"}]},17:{name:"LOOKS_RARE_721",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},18:{name:"NFTX",params:[{type:"uint256",description:"The ETH value to forward to the NFTX contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFTX contract",name:"data"}]},19:{name:"CRYPTOPUNKS",params:[{type:"uint256",description:"The PunkID to purchase",name:"punkId"},{type:"address",description:"The recipient for the cryptopunk",name:"recipient"},{type:"uint256",description:"The ETH value to forward to the Cryptopunks contract",name:"value"}]},20:{name:"LOOKS_RARE_1155",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},21:{name:"OWNER_CHECK_721",params:[{type:"address",description:"The required owner of the ERC721",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},22:{name:"OWNER_CHECK_1155",params:[{type:"address",description:"The required owner of the ERC1155",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The minimum required amount of the ERC1155",name:"minBalance"}]},23:{name:"SWEEP_ERC721",params:[{type:"address",description:"The ERC721 token address to transfer",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The token ID to transfer",name:"id"}]},24:{name:"X2Y2_721",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},25:{name:"SUDOSWAP",params:[{type:"uint256",description:"The ETH value to forward to the Sudoswap contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Sudoswap contract",name:"data"}]},26:{name:"NFT20",params:[{type:"uint256",description:"The ETH value to forward to the NFT20 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFT20 contract",name:"data"}]},27:{name:"X2Y2_1155",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},28:{name:"FOUNDATION",params:[{type:"uint256",description:"The ETH value to forward to the Foundation contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Foundation contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},29:{name:"SWEEP_ERC1155",params:[{type:"address",description:"The ERC1155 token address to sweep",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The token ID to sweep",name:"id"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amount"}]}}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap-commands.ts"}],[346,{"../../../../../shared/constants/network":5772,"../../../../../shared/modules/decoding":5890,"./uniswap-commands":345,"@ethersproject/abi":705},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES=void 0,n.decodeUniswapRouterTransactionData=function({transactionData:e,contractAddress:t,chainId:n}){const s=o[n];if(null==s||!s.map(e=>e.toLowerCase()).includes(t.toLowerCase()))return undefined;const l=new r.Interface(c);let u;try{u=l.parseTransaction({data:e})}catch(e){return undefined}const d=u.args.commands,p=u.args.inputs;return d.slice(2).match(/.{1,2}/gu).map((e,t)=>function(e,t){const n=parseInt(e,16),s=31&n,o=i.UNISWAP_ROUTER_COMMANDS[String(s)];if(!o)return undefined;const c=o.params.map(e=>e.type),l=r.Interface.getAbiCoder().decode(c,t),{name:u}=o,d=o.params.map((e,t)=>{const{name:n,type:r,description:s}=e,i=l[t];return{name:n,type:r,value:"path"===n?(0,a.decodeCommandV3Path)(i):i,description:s}});return{name:u,params:d}}(e,p[t])).filter(e=>e!==undefined)};var r=e("@ethersproject/abi"),a=e("../../../../../shared/modules/decoding"),s=e("../../../../../shared/constants/network"),i=e("./uniswap-commands");const o=n.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES={[s.CHAIN_IDS.ARBITRUM]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x5E325eDA8064b456f4781070C0738d849c824258"],[s.CHAIN_IDS.AVALANCHE]:["0x82635AF6146972cD6601161c4472ffe97237D292","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[s.CHAIN_IDS.BASE]:["0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[s.CHAIN_IDS.BSC]:["0x5Dc88340E1c5c6366864Ee415d6034cadd1A9897","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[s.CHAIN_IDS.MAINNET]:["0xEf1c6E67703c7BD7107eed8303Fbe6EC2554BF6B","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[s.CHAIN_IDS.OPTIMISM]:["0xb555edF5dcF85f42cEeF1f3630a52A108E55A654","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8"],[s.CHAIN_IDS.POLYGON]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0x643770E279d5D0733F21d6DC03A8efbABf3255B4","0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2"],[s.CHAIN_IDS.SEPOLIA]:["0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"]},c=[{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"},{name:"deadline",type:"uint256"}],name:"execute",type:"function"},{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"}],name:"execute",type:"function"}]}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap.ts"}],[347,{"../../../../../shared/types/transaction-decode":5923,"./four-byte":342,"./proxy":343,"./sourcify":344,"./uniswap":346,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionData=async function({transactionData:e,contractAddress:t,chainId:n,provider:r}){l("Decoding transaction data",{transactionData:e,contractAddress:t,chainId:n});const d=(0,s.decodeUniswapRouterTransactionData)({transactionData:e,contractAddress:t,chainId:n});if(d)return l("Decoded with Uniswap commands",d),{data:u(d),source:a.DecodedTransactionDataSource.Uniswap};const p=await(0,o.getContractProxyAddress)(t,r);p&&l("Retrieved proxy implementation address",p);const m=p??t,f=(0,i.decodeTransactionDataWithSourcify)(e,m,n),h=(0,c.decodeTransactionDataWithFourByte)(e),[g,y]=await Promise.allSettled([f,h]);if("fulfilled"===g.status&&g.value)return l("Decoded data with Sourcify",g.value),{data:u([g.value]),source:a.DecodedTransactionDataSource.Sourcify};if(l("Failed to decode data with Sourcify",g),"fulfilled"===y.status&&y.value)return l("Decoded data with 4Byte",y.value),{data:u([y.value]),source:a.DecodedTransactionDataSource.FourByte};return l("Failed to decode data with 4Byte",y),undefined};var r=e("@metamask/utils"),a=e("../../../../../shared/types/transaction-decode"),s=e("./uniswap"),i=e("./sourcify"),o=e("./proxy"),c=e("./four-byte");const l=(0,r.createProjectLogger)("transaction-decode");function u(e){return e.map(e=>function(e){return{...e,params:e.params.map(e=>d(e))}}(e))}function d(e){var t;return{...e,value:p(e.value),children:null===(t=e.children)||void 0===t?void 0:t.map(e=>d(e))}}function p(e){const t=e._hex;return t?BigInt(t).toString():e}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/util.ts"}],[348,{"../../../../../shared/lib/delegation":5841,"../../../../../shared/lib/delegation/caveatBuilder/exactExecutionBuilder":5832,"../../../../../shared/lib/delegation/caveatBuilder/limitedCallsBuilder":5834,"../../../../../shared/lib/delegation/caveatBuilder/specificActionERC20TransferBatchBuilder":5837,"../../../../../shared/lib/delegation/delegation":5838,"../../../../../shared/lib/eip7702-support-utils":5843,"../transaction-relay":352,"../util":353,"@ethersproject/abi":705,"@metamask/controller-utils":1384,"@metamask/metamask-eth-abis":2244,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Delegation7702PublishHook=void 0;var r=e("@ethersproject/abi"),a=e("@metamask/metamask-eth-abis"),s=e("@metamask/utils"),i=e("@metamask/controller-utils"),o=e("../../../../../shared/lib/delegation"),c=e("../../../../../shared/lib/eip7702-support-utils"),l=e("../../../../../shared/lib/delegation/caveatBuilder/exactExecutionBuilder"),u=e("../../../../../shared/lib/delegation/caveatBuilder/limitedCallsBuilder"),d=e("../../../../../shared/lib/delegation/caveatBuilder/specificActionERC20TransferBatchBuilder"),p=e("../../../../../shared/lib/delegation/delegation"),m=e("../transaction-relay"),f=e("../util");function h(e,t,n){g(e,t),t.set(e,n)}function g(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function y(e,t){return e.get(v(e,t))}function w(e,t,n){return e.set(v(e,t),n),n}function v(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const b={transactionHash:undefined},T=(0,s.createProjectLogger)("delegation-7702-publish-hook");var k=new WeakMap,_=new WeakMap,E=new WeakMap,P=new WeakSet;async function S(e,t){try{return await v(P,this,A).call(this,e,t)}catch(e){throw T("Error",e),e}}async function A(e,t){const{chainId:n,gasFeeTokens:r,selectedGasFeeToken:a,txParams:s}=e,{from:i}=s,l=await y(k,this).call(this,{address:i,chainIds:[n]}),u=(0,c.findAtomicBatchSupportForChain)(l,n),{isSupported:d,delegationAddress:f,upgradeContractAddress:h}=(0,c.checkEip7702Support)(u);if(!d)return T("Skipping as EIP-7702 is not supported",{from:i,chainId:n}),b;const g=e.isGasFeeIncluded,w=Boolean(e.isGasFeeSponsored);if(!(a&&null!=r&&r.length||g||w))return T("Skipping as no selected gas fee token"),b;const _=g||w?undefined:null==r?void 0:r.find(e=>e.tokenAddress.toLowerCase()===(null==a?void 0:a.toLowerCase()));if(!_&&!g&&!w)throw new Error("Selected gas fee token not found");const E=(0,o.getDeleGatorEnvironment)(parseInt(e.chainId,16)),S=E.DelegationManager,A=!g&&!e.isGasFeeSponsored;if(A&&(!_||_===undefined))throw new Error("Gas fee token not found");const M=await v(P,this,C).call(this,E,e,_,A),j=[A?o.BATCH_DEFAULT_MODE:o.SINGLE_DEFAULT_MODE],R=v(P,this,I).call(this,e,_,A),x={chainId:n,data:(0,p.encodeRedeemDelegations)({delegations:M,modes:j,executions:R}),to:S};f||(x.authorizationList=await v(P,this,O).call(this,e,h??undefined)),T("Relay request",x);const{uuid:N}=await(0,m.submitRelayTransaction)(x),{transactionHash:D,status:F}=await(0,m.waitForRelayResult)({chainId:n,uuid:N,interval:1e3});if(F!==m.RelayStatus.Success)throw new Error(`Transaction relay error - ${F}`);return{transactionHash:D}}async function C(e,t,n,r){const a=v(P,this,M).call(this,e,t,n,r);T("Signing delegation");const s=await y(_,this).call("DelegationController:signDelegation",{chainId:t.chainId,delegation:a});T("Delegation signature",s);return[[{...a,signature:s}]]}function I(e,t,n){const{txParams:r}=e,{data:a,to:s,value:i}=r,o=v(P,this,N).call(this,a),c={target:s,value:BigInt(i??"0x0"),callData:o};if(!n)return[[c]];if(!t)throw new Error("Selected gas fee token not found");return[[c,{target:t.tokenAddress,value:BigInt("0x0"),callData:v(P,this,R).call(this,t.recipient,t.amount)}]]}function M(e,t,n,r){const a=v(P,this,j).call(this,e,t,n,r);T("Caveats",a);const s=(0,o.createDelegation)({from:t.txParams.from,to:p.ANY_BENEFICIARY,caveats:a});return T("Delegation",s),s}function j(e,t,n,r){const a=(0,o.createCaveatBuilder)(e),{txParams:s}=t,{to:i,value:c,data:p}=s,m=v(P,this,N).call(this,p);if(r&&n!==undefined){const{tokenAddress:e,recipient:t,amount:r}=n;i!==undefined&&a.addCaveat(d.specificActionERC20TransferBatch,e,t,r,i,c??"0x0",m)}else i!==undefined&&a.addCaveat(l.exactExecution,i,c??"0x0",m);return a.addCaveat(u.limitedCalls,1),a.build()}async function O(e,t){const{chainId:n,txParams:r,networkClientId:a}=e,{from:s,nonce:i}=r,o=await y(E,this).call(this,s,a),c=i??o;if(T("Including authorization as not upgraded"),!t)throw new Error("Upgrade contract address not found");const l=await y(_,this).call("KeyringController:signEip7702Authorization",{chainId:parseInt(n,16),contractAddress:t,from:s,nonce:parseInt(c,16)}),{r:u,s:d,yParity:p}=v(P,this,x).call(this,l);return T("Authorization signature",{authorizationSignature:l,r:u,s:d,yParity:p}),[{address:t,chainId:n,nonce:c,r:u,s:d,yParity:p}]}function R(e,t){return new r.Interface(a.abiERC20).encodeFunctionData("transfer",[e,t])}function x(e){const t=(0,f.stripSingleLeadingZero)(e.slice(0,66)),n=(0,f.stripSingleLeadingZero)((0,s.add0x)(e.slice(66,130))),r=parseInt(e.slice(130,132),16);return{r:t,s:n,yParity:(0,i.toHex)(r-27==0?0:1)}}function N(e){if("string"!=typeof e||0===e.length)return"0x";const t="0x"===e.slice(0,2).toLowerCase(),n=e.toLowerCase(),r=t?`0x${n.slice(2)}`:`0x${n}`,a=r.slice(2);return 0===a.length?"0x":a.length%2!=0?v(P,this,N).call(this,`0x0${a}`):r}n.Delegation7702PublishHook=class{constructor({isAtomicBatchSupported:e,messenger:t,getNextNonce:n}){var r,a;g(r=this,a=P),a.add(r),h(this,k,void 0),h(this,_,void 0),h(this,E,void 0),w(k,this,e),w(_,this,t),w(E,this,n)}getHook(){return v(P,this,S).bind(this)}}}}},{package:"$root$",file:"app/scripts/lib/transaction/hooks/delegation-7702-publish.ts"}],[349,{"../containers/util":341,"@metamask/controller-utils":1384,"@metamask/transaction-controller":2989,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.EnforceSimulationHook=void 0;e("@metamask/transaction-controller");var r=e("@metamask/utils");e("@metamask/controller-utils"),e("../containers/util");function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function s(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const o=(0,r.createProjectLogger)("enforce-simulation-hook");var c=new WeakMap,l=new WeakSet;async function u(e,t){const{transactionMeta:n}=t,{isFinal:r}=e,{containerTypes:a,delegationAddress:i,id:l,origin:u,simulationData:d,txParamsOriginal:p}=n,m=s(c,this).call("AppStateController:getState");(null==m?void 0:m.enableEnforcedSimulationsForTransactions[l])??(null==m||m.enableEnforcedSimulations);return o("Skipping as enforced simulations are disabled"),{skipSimulation:!1}}n.EnforceSimulationHook=class{constructor({messenger:e}){var t,n;a(t=this,n=l),n.add(t),function(e,t,n){a(e,t),t.set(e,n)}(this,c,void 0),function(e,t,n){e.set(i(e,t),n)}(c,this,e)}getAfterSimulateHook(){return i(l,this,u).bind(this,{})}getBeforeSignHook(){return i(l,this,u).bind(this,{isFinal:!0})}}}}},{package:"$root$",file:"app/scripts/lib/transaction/hooks/enforce-simulation-hook.ts"}],[35,{"@metamask/address-book-controller":1200},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AddressBookControllerInit=void 0;var r=e("@metamask/address-book-controller");n.AddressBookControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new r.AddressBookController({messenger:e,state:t.AddressBookController})})}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/address-book-controller-init.ts"}],[350,{"../../../../shared/constants/app":5753,"../../../../shared/constants/gas":5761,"../../../../shared/constants/metametrics":5768,"../../../../shared/constants/transaction":5792,"../../../../shared/lib/confirmation.utils":5805,"../../../../shared/lib/transactions-controller-utils":5875,"../../../../shared/modules/Numeric":5882,"../../../../shared/modules/conversion.utils":5887,"../../../../shared/modules/gas.utils":5895,"../../../../shared/modules/metametrics":5898,"../../../../shared/modules/transaction.utils":5919,"../../../../ui/helpers/utils/metrics":7088,"../snap-keyring/metrics":327,"../util":358,"@metamask/transaction-controller":2989,"@metamask/utils":3070,"bignumber.js":3926,"ethereumjs-util":4296},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.handleTransactionSubmitted=n.handleTransactionRejected=n.handleTransactionFailed=n.handleTransactionDropped=n.handleTransactionConfirmed=n.handleTransactionApproved=n.handleTransactionAdded=n.handlePostTransactionBalanceUpdate=n.createTransactionEventFragmentWithTxId=n.METRICS_STATUS_FAILED=void 0;var r=e("bignumber.js"),a=e("ethereumjs-util"),s=e("@metamask/transaction-controller"),i=e("@metamask/utils"),o=e("../../../../shared/constants/app"),c=e("../../../../shared/constants/gas"),l=e("../../../../shared/constants/metametrics"),u=e("../../../../shared/constants/transaction"),d=e("../../../../shared/lib/transactions-controller-utils"),p=e("../../../../shared/modules/conversion.utils"),m=e("../../../../shared/modules/metametrics"),f=e("../../../../shared/modules/transaction.utils"),h=e("../../../../ui/helpers/utils/metrics"),g=e("../snap-keyring/metrics"),y=e("../../../../shared/lib/confirmation.utils"),w=e("../../../../shared/modules/gas.utils"),v=e("../../../../shared/modules/Numeric"),b=e("../util");const T=(0,i.createProjectLogger)("transaction-metrics"),k=n.METRICS_STATUS_FAILED="failed on-chain",_=[s.TransactionType.bridge,s.TransactionType.bridgeApproval,s.TransactionType.contractInteraction,s.TransactionType.tokenMethodApprove,s.TransactionType.tokenMethodIncreaseAllowance,s.TransactionType.tokenMethodSafeTransferFrom,s.TransactionType.tokenMethodSetApprovalForAll,s.TransactionType.tokenMethodTransfer,s.TransactionType.tokenMethodTransferFrom,s.TransactionType.swap,s.TransactionType.swapAndSend,s.TransactionType.swapApproval];var E=function(e){return e.swap="mm_swap",e.bridge="mm_bridge",e}(E||{});n.handleTransactionAdded=async(e,t)=>{if(!t.transactionMeta)return;const{properties:n,sensitiveProperties:r}=await C({transactionEventPayload:t,transactionMetricsRequest:e});P({eventName:u.TransactionMetaMetricsEvent.added,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:n,sensitiveProperties:r}})};n.handleTransactionApproved=async(e,t)=>{t.transactionMeta&&await S({eventName:u.TransactionMetaMetricsEvent.approved,transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionFailed=async(e,t)=>{if(!t.transactionMeta)return;const n={};t.error&&(n.error=t.error),await S({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:n,transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionConfirmed=async(e,t)=>{if(0===Object.keys(t).length)return;const n={},r={...t},{txReceipt:a}=r;n.gas_used=null==a?void 0:a.gasUsed,n.block_number=(null==a?void 0:a.blockNumber)&&(0,p.hexToDecimal)(a.blockNumber);const{submittedTime:s,blockTimestamp:i}=r;s&&(n.completion_time=function(e){return Math.round((Date.now()-e)/1e3).toString()}(s)),s&&i&&(n.completion_time_onchain=function(e,t){const n=2,r=Number((0,p.hexToDecimal)(t))-e/1e3;return(Math.round(r*10**n)/10**n).toString()}(s,i)),"0x0"===(null==a?void 0:a.status)&&(n.status=k),await S({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:n,transactionEventPayload:{actionId:r.actionId,transactionMeta:r},transactionMetricsRequest:e})};n.handleTransactionDropped=async(e,t)=>{if(!t.transactionMeta)return;await S({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:{dropped:!0},transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionRejected=async(e,t)=>{t.transactionMeta&&await S({eventName:u.TransactionMetaMetricsEvent.rejected,transactionEventPayload:t,transactionMetricsRequest:e})};n.handleTransactionSubmitted=async(e,t)=>{if(!t.transactionMeta)return;const{properties:n,sensitiveProperties:r}=await C({transactionEventPayload:t,transactionMetricsRequest:e});P({eventName:u.TransactionMetaMetricsEvent.submitted,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:n,sensitiveProperties:r}})};n.createTransactionEventFragmentWithTxId=async(e,{transactionId:t,actionId:n})=>{const r={...e.getTransaction(t),actionId:n},{properties:a,sensitiveProperties:s}=await C({transactionEventPayload:{transactionMeta:r},transactionMetricsRequest:e});P({eventName:u.TransactionMetaMetricsEvent.approved,transactionEventPayload:{actionId:r.actionId,transactionMeta:r},transactionMetricsRequest:e,payload:{properties:a,sensitiveProperties:s}})};function P({eventName:e,transactionEventPayload:{transactionMeta:t,actionId:n},transactionMetricsRequest:r,payload:a}){if(function(e,t,n){const r=A(t,n.id);return void 0!==e(r)}(r.getEventFragmentById,e,t)&&e!==u.TransactionMetaMetricsEvent.submitted)return;const s=A(e,t.id);switch(e){case u.TransactionMetaMetricsEvent.added:r.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,initialEvent:u.TransactionMetaMetricsEvent.added,successEvent:u.TransactionMetaMetricsEvent.approved,failureEvent:u.TransactionMetaMetricsEvent.rejected,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:s,persist:!0});break;case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.rejected:r.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,successEvent:u.TransactionMetaMetricsEvent.approved,failureEvent:u.TransactionMetaMetricsEvent.rejected,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:s,persist:!0});break;case u.TransactionMetaMetricsEvent.submitted:r.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,initialEvent:u.TransactionMetaMetricsEvent.submitted,successEvent:u.TransactionMetaMetricsEvent.finalized,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:s,persist:!0});break;case u.TransactionMetaMetricsEvent.finalized:r.createEventFragment({category:l.MetaMetricsEventCategory.Transactions,successEvent:u.TransactionMetaMetricsEvent.finalized,properties:a.properties,sensitiveProperties:a.sensitiveProperties,actionId:n,uniqueIdentifier:s,persist:!0})}}async function S({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n,extraParams:r={}}){const{properties:a,sensitiveProperties:s}=await C({transactionEventPayload:t,transactionMetricsRequest:n,extraParams:r});P({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n,payload:{properties:a,sensitiveProperties:s}}),function({eventName:e,transactionEventPayload:{transactionMeta:t},transactionMetricsRequest:n,payload:r}){const a=A(e,t.id);switch(e){case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.rejected:case u.TransactionMetaMetricsEvent.finalized:n.updateEventFragment(a,{properties:r.properties,sensitiveProperties:r.sensitiveProperties})}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n,payload:{properties:a,sensitiveProperties:s}}),function({eventName:e,transactionMetricsRequest:t,transactionEventPayload:{transactionMeta:n}}){const r=A(e,n.id);switch(e){case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.finalized:t.finalizeEventFragment(r);break;case u.TransactionMetaMetricsEvent.rejected:t.finalizeEventFragment(r,{abandoned:!0})}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:n})}function A(e,t){return`transaction-${e===u.TransactionMetaMetricsEvent.finalized||e===u.TransactionMetaMetricsEvent.submitted?"submitted":"added"}-${t}`}async function C({transactionEventPayload:{transactionMeta:e},transactionMetricsRequest:t,extraParams:n={}}){var k;const{type:E,time:P,status:S,chainId:A,origin:C,txParams:{gasPrice:M,gas:j,maxFeePerGas:O,maxPriorityFeePerGas:R,estimateSuggested:x,estimateUsed:N},defaultGasEstimates:D,originalType:F,replacedById:B,customTokenAmount:U,dappProposedTokenAmount:L,currentTokenBalance:G,originalApprovalAmount:q,finalApprovalAmount:$,securityProviderResponse:H,simulationFails:Y,id:W,userFeeLevel:V}=e,z=C===o.ORIGIN_METAMASK?"user":"dapp",K="dappSuggested"===V?"dapp_proposed":V,{assetType:Q,tokenStandard:J}=await(0,f.determineTransactionAssetType)(e,t.provider,t.getTokenStandardAndDetails);let Z;if(e.txParams.data){const n=await t.getMethodData(e.txParams.data);Z=null==n?void 0:n.name}const X={};if((0,f.isEIP1559Transaction)(e)?(X.max_fee_per_gas=O,X.max_priority_fee_per_gas=R):(X.gas_price=M,X.default_estimate=l.MetaMetricsEventTransactionEstimateType.DefaultEstimate),D){var ee,te;const{estimateType:n}=D;if(n){var ne,re;X.default_estimate=n===c.PriorityLevels.dAppSuggested?l.MetaMetricsEventTransactionEstimateType.DappProposed:n;let r=null===(ne=e.defaultGasEstimates)||void 0===ne?void 0:ne.maxFeePerGas,a=null===(re=e.defaultGasEstimates)||void 0===re?void 0:re.maxPriorityFeePerGas;if([c.GasRecommendations.low,c.GasRecommendations.medium,c.GasRecommendations.high].includes(n)){var ae,se;const{gasFeeEstimates:e}=await t.getEIP1559GasFeeEstimates();var ie,oe;if(null!=e&&null!==(ae=e[n])&&void 0!==ae&&ae.suggestedMaxFeePerGas)r=null===(ie=e[n])||void 0===ie?void 0:ie.suggestedMaxFeePerGas,X.default_max_fee_per_gas=r;if(null!=e&&null!==(se=e[n])&&void 0!==se&&se.suggestedMaxPriorityFeePerGas)a=null===(oe=e[n])||void 0===oe?void 0:oe.suggestedMaxPriorityFeePerGas,X.default_max_priority_fee_per_gas=a}}null!==(ee=e.defaultGasEstimates)&&void 0!==ee&&ee.gas&&(X.default_gas=e.defaultGasEstimates.gas),null!==(te=e.defaultGasEstimates)&&void 0!==te&&te.gasPrice&&(X.default_gas_price=e.defaultGasEstimates.gasPrice)}x&&(X.estimate_suggested=x),N&&(X.estimate_used=N),null!=n&&n.gas_used&&(X.gas_used=n.gas_used);const ce=function(e){const t={};for(const n in e)(0,a.isHexString)(e[n])?t[n]=(0,p.hexWEIToDecGWEI)(e[n]):t[n]=e[n];return t}(X);let le="0";e.txParams.maxFeePerGas&&(le="2");const ue="Approve";let de,pe,me,fe,he,ge;const{transactionType:ye,isContractInteraction:we}=function(e,t){const n=e&&_.includes(e);if([s.TransactionType.swapAndSend,s.TransactionType.cancel,s.TransactionType.deployContract,s.TransactionType.gasPayment,s.TransactionType.batch,s.TransactionType.shieldSubscriptionApprove].includes(e))return{transactionType:e,isContractInteraction:n};if(e===s.TransactionType.retry&&t)return{transactionType:t,isContractInteraction:n};if(n){const t=I(e);return t?{transactionType:t,isContractInteraction:!0}:{transactionType:s.TransactionType.contractInteraction,isContractInteraction:!0}}return{transactionType:s.TransactionType.simpleSend,isContractInteraction:!1}}(E,F);var ve,be;we&&(pe=Z,he=null===(ve=e.txParams)||void 0===ve?void 0:ve.to,ge=null===(be=e.txParams)||void 0===be||null===(be=be.data)||void 0===be?void 0:be.slice(0,10),pe===ue&&J===u.TokenStandard.ERC20&&("0"===L||"0"===U?de=u.TransactionApprovalAmountType.revoke:U&&U!==L?de=u.TransactionApprovalAmountType.custom:L&&(de=u.TransactionApprovalAmountType.dappProposed),me=function(e,t,n){if(e===u.TransactionApprovalAmountType.custom&&t&&n)return`${new r.BigNumber(t,10).div(n,10).times(100).round(2)}`;return null}(de,q,$),fe=function(e,t,n){if((e===u.TransactionApprovalAmountType.custom||e===u.TransactionApprovalAmountType.dappProposed)&&t&&n)return`${new r.BigNumber(t,16).div(n,10).times(100).round(2)}`;return null}(de,L,G)));const Te=t.getTransaction(B),ke={RETRY:s.TransactionType.retry,CANCEL:s.TransactionType.cancel,SAME_NONCE:"other"};let _e;null!=n&&n.dropped&&(_e=ke.SAME_NONCE,(null==Te?void 0:Te.type)===s.TransactionType.cancel?_e=ke.CANCEL:(null==Te?void 0:Te.type)===s.TransactionType.retry&&(_e=ke.RETRY));const Ee=[];let Pe=null;1===(null==H?void 0:H.flagAsDangerous)?Ee.push(l.MetaMetricsEventUiCustomization.FlaggedAsMalicious):2===(null==H?void 0:H.flagAsDangerous)&&Ee.push(l.MetaMetricsEventUiCustomization.FlaggedAsSafetyUnknown);const Se=(0,h.getBlockaidMetricsProps)(e);(null==Se||null===(k=Se.ui_customizations)||void 0===k?void 0:k.length)>0&&Ee.push(...Se.ui_customizations),Y&&Ee.push(l.MetaMetricsEventUiCustomization.GasEstimationFailed);(0,y.shouldUseRedesignForTransactions)({transactionMetadataType:e.type})&&(Ee.push(l.MetaMetricsEventUiCustomization.RedesignedConfirmation),Pe=t.getIsConfirmationAdvancedDetailsOpen());const Ae=(0,m.getSmartTransactionMetricsProperties)(t,e),Ce=(0,h.getSwapAndSendMetricsProps)(e),Ie={hd_entropy_index:t.getHDEntropyIndex()};let Me;try{Me=await t.getAccountType(t.getSelectedAddress())}catch(e){Me="error",T("Error getting account type for transaction metrics:",e)}let je={chain_id:A,referrer:C,source:z,status:S,network:`${parseInt(A,16)}`,eip_1559_version:le,gas_edit_type:"none",gas_edit_attempted:"none",gas_estimation_failed:Boolean(Y),account_type:Me,device_model:await t.getDeviceModel(t.getSelectedAddress()),asset_type:Q,token_standard:J,transaction_type:ye,transaction_speed_up:E===s.TransactionType.retry,transaction_internal_id:W,gas_fee_selected:K,...Se,ui_customizations:Ee.length>0?Ee:null,transaction_advanced_view:Pe,transaction_contract_method:pe?[pe]:[],...Ae,...Ce,...Ie};const Oe=await(0,g.getSnapAndHardwareInfoForMetrics)(t.getAccountType,t.getDeviceModel,t.getHardwareTypeForMetric,t.snapAndHardwareMessenger);var Re,xe;(Object.assign(je,Oe),pe===ue||I(E))&&(je={...je,simulation_receiving_assets_total_value:je.simulation_receiving_assets_total_value??(null==e||null===(Re=e.assetsFiatValues)||void 0===Re?void 0:Re.receiving),simulation_sending_assets_total_value:je.simulation_sending_assets_total_value??(null==e||null===(xe=e.assetsFiatValues)||void 0===xe?void 0:xe.sending),transaction_approval_amount_type:de});let Ne={transaction_envelope_type:(0,f.isEIP1559Transaction)(e)?d.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:d.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:P,gas_limit:j,transaction_replaced:_e,transaction_contract_address:he?[he]:[],transaction_contract_method_4byte:ge,...n,...ce};if(pe===ue&&(Ne={...Ne,transaction_approval_amount_vs_balance_ratio:fe,transaction_approval_amount_vs_proposed_ratio:me}),await async function(e,t,n,r){const a=origin&&origin!==o.ORIGIN_METAMASK,{delegationAddress:i,nestedTransactions:c,txParams:l}=e,{authorizationList:d}=l,p=Boolean(null==c?void 0:c.length),m=Boolean(null==d?void 0:d.length);a&&(n.api_method=p?o.MESSAGE_TYPE.WALLET_SEND_CALLS:o.MESSAGE_TYPE.ETH_SEND_TRANSACTION);p&&(n.batch_transaction_count=null==c?void 0:c.length,n.batch_transaction_method="eip7702",n.transaction_contract_method=await async function(e,t){const n=e.filter(e=>_.includes(e.type)&&e.data).map(e=>e.data),r=await Promise.all(n.map(e=>t(e)));return r.map(e=>null==e?void 0:e.name).filter(e=>null==e?void 0:e.length)}(c??[],t),r.transaction_contract_address=null==c?void 0:c.filter(e=>{var t;return _.includes(e.type)&&(null===(t=e.to)||void 0===t?void 0:t.length)}).map(e=>e.to));if(e.status===s.TransactionStatus.rejected){const{error:t}=e;n.eip7702_upgrade_rejection=m&&t.code===u.EIP5792ErrorCode.RejectedUpgrade}n.eip7702_upgrade_transaction=m,r.account_eip7702_upgraded=i}(e,t.getMethodData,je,Ne),function(e,t,n,r){var a;const{gasFeeTokens:s,selectedGasFeeToken:o}=e;t.gas_payment_tokens_available=null==s?void 0:s.map(e=>e.symbol),t.gas_paid_with=null==s||null===(a=s.find(e=>e.tokenAddress.toLowerCase()===(null==o?void 0:o.toLowerCase())))||void 0===a?void 0:a.symbol,(null==o?void 0:o.toLowerCase())===u.NATIVE_TOKEN_ADDRESS&&(t.gas_paid_with="pre-funded_ETH");t.gas_insufficient_native_asset=function(e,t){const{chainId:n,txParams:r}=e,{from:a,gas:s,gasPrice:o,maxFeePerGas:c,value:l}=r,u=t(a,n),d=(0,w.getMaximumGasTotalInHexWei)({gasLimit:s,gasPrice:o,maxFeePerGas:c}),m=(0,i.add0x)((0,p.addHexes)(d,l??"0x0"));return new v.Numeric(m,16).greaterThan(new v.Numeric(u,16))}(e,r)}(e,je,0,t.getAccountBalance),function(e,t,n){var r;const a=null===(r=n.getFeatureFlags())||void 0===r?void 0:r.extensionUxPna25,i=n.getPna25Acknowledged(),o=n.getParticipateInMetrics(),c=[s.TransactionStatus.confirmed,s.TransactionStatus.dropped,s.TransactionStatus.failed].includes(e.status);a&&i&&o&&c&&(t.transaction_hash=e.hash)}(e,je,t),S===s.TransactionStatus.submitted||S===s.TransactionStatus.confirmed){const n=t.getNetworkRpcUrl(e.chainId),r=(0,b.extractRpcDomain)(n);je.rpc_domain=r}return{properties:je,sensitiveProperties:Ne}}function I(e){return e===s.TransactionType.swap?E.swap:e===s.TransactionType.bridge?E.bridge:null}n.handlePostTransactionBalanceUpdate=async({getParticipateInMetrics:e,trackEvent:t,getHDEntropyIndex:n},{transactionMeta:a,approvalTransactionMeta:s})=>{var i;if(e()&&a.swapMetaData)if("0x0"===(null===(i=a.txReceipt)||void 0===i?void 0:i.status))t({event:l.MetaMetricsEventName.SwapFailed,category:l.MetaMetricsEventCategory.Swaps,sensitiveProperties:{...a.swapMetaData},properties:{hd_entropy_index:n()}});else{var o;const e=(0,d.getSwapsTokensReceivedFromTxMeta)(a.destinationTokenSymbol,a,a.destinationTokenAddress,a.txParams.from,a.destinationTokenDecimals,s,a.chainId),i=e?`${new r.BigNumber(e,10).div(a.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,c=null!==(o=a.txReceipt)&&void 0!==o&&o.gasUsed&&a.swapMetaData.estimated_gas?`${new r.BigNumber(a.txReceipt.gasUsed,16).div(a.swapMetaData.estimated_gas,10).times(100).round(2)}%`:null,u=function(e,t){var n,a;let s="0x0";null!=t&&t.txReceipt&&(s=(0,d.calcGasTotal)(t.txReceipt.gasUsed,t.txReceipt.effectiveGasPrice));const i=(0,d.calcGasTotal)(null===(n=e.txReceipt)||void 0===n?void 0:n.gasUsed,null===(a=e.txReceipt)||void 0===a?void 0:a.effectiveGasPrice),o=new r.BigNumber(i,16).plus(s,16).toString(16);return{approvalGasCostInEth:Number((0,p.hexWEIToDecETH)(s)),tradeGasCostInEth:Number((0,p.hexWEIToDecETH)(i)),tradeAndApprovalGasCostInEth:Number((0,p.hexWEIToDecETH)(o))}}(a,s);t({event:l.MetaMetricsEventName.SwapCompleted,category:l.MetaMetricsEventCategory.Swaps,sensitiveProperties:{...a.swapMetaData,token_to_amount_received:e,quote_vs_executionRatio:i,estimated_vs_used_gasRatio:c,approval_gas_cost_in_eth:u.approvalGasCostInEth,trade_gas_cost_in_eth:u.tradeGasCostInEth,trade_and_approval_gas_cost_in_eth:u.tradeAndApprovalGasCostInEth,token_to_amount:a.swapMetaData.token_to_amount.toString(10)},properties:{hd_entropy_index:n()}})}}}}},{package:"$root$",file:"app/scripts/lib/transaction/metrics.ts"}],[351,{"../../../../shared/modules/conversion.utils":5887,"../../../../shared/modules/fetch-with-timeout":5894},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.buildUrl=u,n.getSendBundleSupportedChains=async function(e){const t=await c();return e.reduce((e,n)=>{const r=(0,a.hexToDecimal)(n),s=t[r];return e[n]=(null==s?void 0:s.sendBundle)??!1,e},{})},n.getSentinelNetworkFlags=l,n.isSendBundleSupported=async function(e){const t=await l(e);if(null==t||!t.sendBundle)return!1;return!0};var r,a=e("../../../../shared/modules/conversion.utils"),s=(r=e("../../../../shared/modules/fetch-with-timeout"))&&r.__esModule?r:{default:r};const i="https://tx-sentinel-{0}.api.cx.metamask.io/",o="networks";async function c(){const e=`${u("ethereum-mainnet")}${o}`;return(await(0,s.default)()(e)).json()}async function l(e){const t=(0,a.hexToDecimal)(e);return(await c())[t]}function u(e){return i.replace("{0}",e)}}}},{package:"$root$",file:"app/scripts/lib/transaction/sentinel-api.ts"}],[352,{"../../../../shared/modules/fetch-with-timeout":5894,"../../../../shared/modules/rpc.utils":5903,"./sentinel-api":351,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RelayStatus=n.RELAY_RPC_METHOD=void 0,n.isRelaySupported=async function(e){return Boolean(await d(e))},n.submitRelayTransaction=async function(e){const{chainId:t}=e,n=await d(t);if(!n)throw new Error(`Chain not supported by transaction relay - ${t}`);c("Request",n,e);const r=await(0,s.jsonRpcRequest)(n,u,[e]);return c("Response",r),r},n.waitForRelayResult=async function(e){const{chainId:t,interval:n,uuid:r}=e,a=await d(t);if(!a)throw new Error(`Chain not supported by transaction relay - ${t}`);const s=`${a}smart-transactions/${r}`;return new Promise((e,t)=>{const r=setInterval(async()=>{try{const t=await async function(e){c("Polling request",e);const t=await(0,i.default)()(e);if(c("Polling response",t),!t.ok){const e=await t.text();throw new Error(`Failed to fetch relay transaction status: ${t.status} - ${e}`)}const n=await t.json(),r=null==n?void 0:n.transactions[0],{hash:a,status:s}=r||{};return{status:s,transactionHash:a}}(s);t.status!==l.Pending&&(clearInterval(r),e(t))}catch(e){clearInterval(r),t(e)}},n)})};var r,a=e("@metamask/utils"),s=e("../../../../shared/modules/rpc.utils"),i=(r=e("../../../../shared/modules/fetch-with-timeout"))&&r.__esModule?r:{default:r},o=e("./sentinel-api");const c=(0,a.createProjectLogger)("transaction-relay");let l=n.RelayStatus=function(e){return e.Pending="PENDING",e.Success="VALIDATED",e}({});const u=n.RELAY_RPC_METHOD="eth_sendRelayTransaction";async function d(e){const t=await(0,o.getSentinelNetworkFlags)(e);return null!=t&&t.relayTransactions?(0,o.buildUrl)(t.network):(c("Chain is not supported",e),undefined)}}}},{package:"$root$",file:"app/scripts/lib/transaction/transaction-relay.ts"}],[353,{"../../../../shared/constants/app":5753,"../../../../shared/constants/security-provider":5781,"../../../../shared/lib/trace":5873,"../../../../shared/lib/trust-signals":5879,"../ppom/ppom-util":299,"../trust-signals/security-alerts-api":354,"@metamask/keyring-api":2173,"ethereumjs-util":4296},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.addDappTransaction=async function(e){const{dappRequest:t,requestContext:n}=e,{id:r,method:a}=t,s=String(r),i=n.assertGet("origin"),c=n.get("securityAlertResponse"),l=n.get("traceContext"),u={actionId:s,method:a,origin:i,requireApproval:!0,securityAlertResponse:c};(0,o.endTrace)({name:o.TraceName.Middleware,id:s});const{waitForHash:p}=await d({...e,transactionOptions:{...u,traceContext:l}}),m=await p();return(0,o.endTrace)({name:o.TraceName.Transaction,id:s}),m},n.addTransaction=async function(e){await async function(e){const{chainId:t,ppomController:n,securityAlertsEnabled:r,transactionOptions:a,transactionParams:o,updateSecurityAlertResponse:d,internalAccounts:p,getSecurityAlertsConfig:m}=e;!function(e){const{getSecurityAlertResponse:t,addSecurityAlertResponse:n,securityAlertsEnabled:r,transactionOptions:a,transactionParams:s,chainId:i}=e,{origin:o}=a;if(o!==c.ORIGIN_METAMASK||!r)return;const{to:d}=s;if("string"!=typeof d)return;const p=(0,u.mapChainIdToSupportedEVMChain)(i);if(!p)return;const m=e=>t(e),f=(e,t)=>n(e,t);(0,l.scanAddressAndAddToCache)(d,m,f,p).catch(e=>{console.error("[scanAddressForTrustSignals] error scanning address for trust signals:",e)})}(e);const{type:f}=a,h=i.SECURITY_PROVIDER_EXCLUDED_TRANSACTION_TYPES.includes(f);if(!r||h)return;if(p.some(({address:e})=>{var t;return e.toLowerCase()===(null===(t=o.to)||void 0===t?void 0:t.toLowerCase())}))return;try{const{from:r,to:c,value:l,data:u}=o,{actionId:p,origin:f}=a,h={method:"eth_sendTransaction",id:p??"",origin:f??"",params:[{from:r,to:c??"",value:l??"",data:u??""}],jsonrpc:"2.0"},g=(0,s.generateSecurityAlertId)();(0,s.validateRequestWithPPOM)({ppomController:n,request:h,securityAlertId:g,chainId:t,updateSecurityAlertResponse:d,getSecurityAlertsConfig:m});const y={...i.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:g};e.transactionOptions.securityAlertResponse=y}catch(e){(0,s.handlePPOMError)(e,"Error validating JSON RPC using PPOM: ")}}(e);const{transactionMeta:t,waitForHash:n}=await d(e);if(!e.waitForSubmit)return n().catch(()=>{}),t;const r=await n();return function(e,t){return t.state.transactions.find(t=>t.hash===e)}(r,e.transactionController)},n.getTransactionById=p,n.stripSingleLeadingZero=function(e){if(!e.startsWith("0x0")||e.length<=3)return e;return`0x${e.slice(3)}`};var r=e("@metamask/keyring-api"),a=e("ethereumjs-util"),s=e("../ppom/ppom-util"),i=e("../../../../shared/constants/security-provider"),o=e("../../../../shared/lib/trace"),c=e("../../../../shared/constants/app"),l=e("../trust-signals/security-alerts-api"),u=e("../../../../shared/lib/trust-signals");async function d(e){const{selectedAccount:t}=e;return t.type===r.EthAccountType.Erc4337?async function(e){var t;const{networkClientId:n,transactionController:r,transactionOptions:s,transactionParams:i,userOperationController:o}=e,{maxFeePerGas:c,maxPriorityFeePerGas:l}=i,{origin:u,requireApproval:d,type:m}=s,f={...i,maxFeePerGas:(0,a.addHexPrefix)(c),maxPriorityFeePerGas:(0,a.addHexPrefix)(l)},h=null==s||null===(t=s.swaps)||void 0===t?void 0:t.meta;null!=h&&h.type&&delete h.type;const g={networkClientId:n,origin:u,requireApproval:d,swaps:h,type:m},y=await o.addUserOperationFromTransaction(f,g);o.startPollingByNetworkClientId(n);return{transactionMeta:p(y.id,r),waitForHash:y.transactionHash}}(e):async function(e){const{transactionController:t,transactionOptions:n,transactionParams:r,networkClientId:a}=e,{result:s,transactionMeta:i}=await t.addTransaction(r,{...n,networkClientId:a});return{transactionMeta:i,waitForHash:()=>s}}(e)}function p(e,t){return t.state.transactions.find(t=>t.id===e)}}}},{package:"$root$",file:"app/scripts/lib/transaction/util.ts"}],[354,{"../../../../shared/constants/time":5790,"../../../../shared/lib/trust-signals":5879,"../../../../shared/modules/fetch-with-timeout":5894},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.scanAddress=l,n.scanAddressAndAddToCache=async function(e,t,n,r){const a=(0,i.createCacheKey)(r,e),s=t(a);if(s)return s;const o={result_type:i.ResultType.Loading,label:""};n(a,o);try{const t=await l(r,e);return n(a,t),t}catch(e){throw n(a,{result_type:i.ResultType.ErrorResult,label:""}),e}};var r,a=e("../../../../shared/constants/time"),s=(r=e("../../../../shared/modules/fetch-with-timeout"))&&r.__esModule?r:{default:r},i=e("../../../../shared/lib/trust-signals");const o=5*a.SECOND,c="address/evm/scan";async function l(e,t){const n="https://security-alerts.api.cx.metamask.io";const r=`${n}/${c}`,a={chain:e,address:t},i=await(0,s.default)(o)(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await i.json()}}}},{package:"$root$",file:"app/scripts/lib/trust-signals/security-alerts-api.ts"}],[3543,{"./types.js":3544},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=e("./types.js");const a={type:"xstate.init"},s="xstate.assign";function i(e){return e===undefined?[]:[].concat(e)}function o(e,t){return"string"==typeof(e="string"==typeof e&&t&&t[e]?t[e]:e)?{type:e}:"function"==typeof e?{type:e.name,exec:e}:e}function c(e){return t=>e===t}function l(e){return"string"==typeof e?{type:e}:e}function u(e,t){return{value:e,context:t,actions:[],changed:!1,matches:c(e)}}function d(e,t,n){let r=t,a=!1;return[e.filter(e=>{if(e.type===s){a=!0;let t=Object.assign({},r);return"function"==typeof e.assignment?t=e.assignment(r,n):Object.keys(e.assignment).forEach(a=>{t[a]="function"==typeof e.assignment[a]?e.assignment[a](r,n):e.assignment[a]}),r=t,!1}return!0}),r,a]}const p=(e,t)=>e.actions.forEach(({exec:n})=>n&&n(e.context,t));Object.defineProperty(n,"InterpreterStatus",{enumerable:!0,get:function(){return r.InterpreterStatus}}),n.assign=function(e){return{type:s,assignment:e}},n.createMachine=function(e,t={}){const[n,r]=d(i(e.states[e.initial].entry).map(e=>o(e,t.actions)),e.context,a),s={config:e,_options:t,initialState:{value:e.initial,actions:n,context:r,matches:c(e.initial)},transition:(t,n)=>{const{value:r,context:a}="string"==typeof t?{value:t,context:e.context}:t,p=l(n),m=e.states[r];if(m.on){const t=i(m.on[p.type]);for(const n of t){if(n===undefined)return u(r,a);const{target:t,actions:l=[],cond:f=()=>!0}="string"==typeof n?{target:n}:n,h=t===undefined,g=null!=t?t:r,y=e.states[g];if(f(a,p)){const e=(h?i(l):[].concat(m.exit,l,y.entry).filter(e=>e)).map(e=>o(e,s._options.actions)),[n,u,f]=d(e,a,p),g=null!=t?t:r;return{value:g,context:u,actions:n,changed:t!==r||n.length>0||f,matches:c(g)}}}}return u(r,a)}};return s},n.interpret=function(e){let t=e.initialState,n=r.InterpreterStatus.NotStarted;const s=new Set,i={_machine:e,send:a=>{n===r.InterpreterStatus.Running&&(t=e.transition(t,a),p(t,l(a)),s.forEach(e=>e(t)))},subscribe:e=>(s.add(e),e(t),{unsubscribe:()=>s.delete(e)}),start:s=>{if(s){const n="object"==typeof s?s:{context:e.config.context,value:s};t={value:n.value,actions:[],context:n.context,matches:c(n.value)}}else t=e.initialState;return n=r.InterpreterStatus.Running,p(t,a),i},stop:()=>(n=r.InterpreterStatus.Stopped,s.clear(),i),get state(){return t},get status(){return n}};return i}}}},{package:"@metamask/snaps-controllers>@xstate/fsm",file:"node_modules/@xstate/fsm/lib/index.js"}],[3544,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var r;Object.defineProperty(n,"__esModule",{value:!0}),n.InterpreterStatus=void 0,(r=n.InterpreterStatus||(n.InterpreterStatus={}))[r.NotStarted=0]="NotStarted",r[r.Running=1]="Running",r[r.Stopped=2]="Stopped"}}},{package:"@metamask/snaps-controllers>@xstate/fsm",file:"node_modules/@xstate/fsm/lib/types.js"}],[355,{"../../../../shared/constants/signatures":5782,"../../../../shared/lib/trust-signals":5879,"../../../../shared/modules/transaction.utils":5919,"../ppom/security-alerts-api":301,"./security-alerts-api":354,"./trust-signals-util":356},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createTrustSignalsMiddleware=function(e,t,n,u,d){return async(p,m,f)=>{try{if(!(0,c.isSecurityAlertsEnabledByUser)(u)||!(0,s.isSecurityAlertsAPIEnabled)())return;(0,c.isEthSendTransaction)(p)?(!function(e,t,n){if(!(0,c.hasValidTransactionParams)(e))return;const{to:a,data:s}=e.params[0],{chainId:l}=n.getNetworkConfigurationByNetworkClientId(e.networkClientId)??{};if(!l)return void console.error("ChainID not found for networkClientId");const u=(0,i.mapChainIdToSupportedEVMChain)(l);if(!u)return void console.error("Unsupported chainId:",l);if((0,o.scanAddressAndAddToCache)(a,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,u).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning address for transaction:",e)}),s&&"string"==typeof s){const e=(0,r.parseApprovalTransactionData)(s),n=null==e?void 0:e.spender;n&&(0,o.scanAddressAndAddToCache)(n,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,u).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning spender address for approval:",e)})}}(p,t,e),l(p,n)):(0,c.isEthSignTypedData)(p)?(!function(e,t,n){var s;if(!(0,c.hasValidTypedDataParams)(e))return;const l=(0,r.parseTypedDataMessage)("string"==typeof e.params[1]?e.params[1]:JSON.stringify(e.params[1])),u=null===(s=l.domain)||void 0===s?void 0:s.verifyingContract;if(!u)return;const{chainId:d}=n.getNetworkConfigurationByNetworkClientId(e.networkClientId)??{};if(!d)return void console.error("ChainID not found for networkClientId");const p=(0,i.mapChainIdToSupportedEVMChain)(d);if(!p)return void console.error("Unsupported chainId:",d);(0,o.scanAddressAndAddToCache)(u,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,p).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning address for signature:",e)});const{primaryType:m}=l;if(!m)return;if(a.PRIMARY_TYPES_PERMIT.includes(m)){var f;const e=null===(f=l.message)||void 0===f?void 0:f.spender;e&&(0,o.scanAddressAndAddToCache)(e,t.getAddressSecurityAlertResponse,t.addAddressSecurityAlertResponse,p).catch(e=>{console.error("[createTrustSignalsMiddleware] error scanning spender address for permit:",e)})}}(p,t,e),l(p,n)):((0,c.isConnected)(p,d)||(0,c.connectScreenHasBeenPrompted)(p))&&l(p,n)}catch(e){console.error("[createTrustSignalsMiddleware] error: ",e)}finally{f()}}};var r=e("../../../../shared/modules/transaction.utils"),a=e("../../../../shared/constants/signatures"),s=e("../ppom/security-alerts-api"),i=e("../../../../shared/lib/trust-signals"),o=e("./security-alerts-api"),c=e("./trust-signals-util");function l(e,t){e.origin&&t.scanUrl(e.origin).catch(e=>{console.error("[createTrustSignalsMiddleware] error:",e)})}}}},{package:"$root$",file:"app/scripts/lib/trust-signals/trust-signals-middleware.ts"}],[356,{"../../../../shared/constants/app":5753,"../../../../shared/lib/trust-signals":5879,"../../../../shared/modules/selectors/networks":5908},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.connectScreenHasBeenPrompted=function(e){return e.method===a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS||e.method===a.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS},n.getChainId=function(e){var t;const n=null===(t=(0,r.getProviderConfig)({metamask:e.state}))||void 0===t?void 0:t.chainId;if(!n)throw new Error("Chain ID not found");return(0,s.mapChainIdToSupportedEVMChain)(n)},n.hasValidTransactionParams=function(e){if(!("params"in e)||!e.params)return!1;if(!Array.isArray(e.params)||0===e.params.length)return!1;const t=e.params[0];return"object"==typeof t&&null!==t&&"to"in t},n.hasValidTypedDataParams=function(e){if(!("params"in e)||!e.params)return!1;if(!Array.isArray(e.params)||e.params.length<2)return!1;return e.params[1]!==undefined&&null!==e.params[1]},n.isConnected=function(e,t){if(!e.origin||e.method!==a.MESSAGE_TYPE.ETH_ACCOUNTS)return!1;const n=t(e.origin);return Array.isArray(n)&&n.length>0},n.isEthSendTransaction=function(e){return e.method===a.MESSAGE_TYPE.ETH_SEND_TRANSACTION},n.isEthSignTypedData=function(e){return e.method===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA||e.method===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1||e.method===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3||e.method===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4},n.isSecurityAlertsEnabledByUser=function(e){const{securityAlertsEnabled:t}=e.state;return t};var r=e("../../../../shared/modules/selectors/networks"),a=e("../../../../shared/constants/app"),s=e("../../../../shared/lib/trust-signals")}}},{package:"$root$",file:"app/scripts/lib/trust-signals/trust-signals-util.ts"}],[357,{loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateRemoteFeatureFlags=async function(e){try{const t=e.remoteFeatureFlagController;await t.updateRemoteFeatureFlags()}catch(e){a.default.error("Error initializing remote feature flags:",e)}};var r,a=(r=e("loglevel"))&&r.__esModule?r:{default:r}}}},{package:"$root$",file:"app/scripts/lib/update-remote-feature-flags.ts"}]],[],{});