LavaPack.loadBundle([[25,{"../../../../shared/constants/network":5772,"@metamask/keyring-api":2173,"@metamask/network-enablement-controller":2306,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkEnablementControllerInit=void 0;var s=e("@metamask/network-enablement-controller"),r=e("@metamask/keyring-api"),i=e("@metamask/utils"),a=e("../../../../shared/constants/network");const o=(e,t)=>{const n={[i.KnownCaipNamespace.Eip155]:{}};return Object.keys(e).forEach(e=>{n[i.KnownCaipNamespace.Eip155][e]=t.includes(e)}),n},l=(e,t=[])=>{const n={};return Object.keys(e).forEach(e=>{const s=t.includes(e),{namespace:r}=(0,i.parseCaipChainId)(e);(n[r]??(n[r]={}))[e]=s}),n},c=(e,t)=>{const{networkConfigurationsByChainId:n}=e,{multichainNetworkConfigurationsByChainId:s}=t;const i=[r.SolScope.Mainnet];return i.push(r.BtcScope.Mainnet),i.push(r.TrxScope.Mainnet),{enabledNetworkMap:{...o(n,a.FEATURED_NETWORK_CHAIN_IDS),...l(s,i)}}};n.NetworkEnablementControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n,getController:a})=>{const o=a("MultichainNetworkController").state,l=a("NetworkController").state,u=new s.NetworkEnablementController({messenger:e,state:{...c(l,o),...n.NetworkEnablementController}});return t.subscribe("AccountsController:selectedAccountChange",e=>{e.type===r.SolAccountType.DataAccount&&u.enableNetworkInNamespace(r.SolScope.Mainnet,i.KnownCaipNamespace.Solana)}),t.subscribe("AccountTreeController:selectedAccountGroupChange",()=>{const e=t.call("AccountTreeController:getAccountsFromSelectedAccountGroup",{scopes:[r.SolScope.Mainnet]}),n=t.call("AccountTreeController:getAccountsFromSelectedAccountGroup",{scopes:[r.BtcScope.Mainnet]}),s=t.call("AccountTreeController:getAccountsFromSelectedAccountGroup",{scopes:[r.TrxScope.Mainnet]}),i={};for(const e of Object.values(u.state.enabledNetworkMap))Object.assign(i,e);if(1===Object.keys(i).length){const t=Object.keys(i)[0];let a=!1;t===r.SolScope.Mainnet&&0===e.length&&(a=!0),t===r.BtcScope.Mainnet&&0===n.length&&(a=!0),t===r.TrxScope.Mainnet&&0===s.length&&(a=!0),a&&u.enableNetwork("0x1")}}),{controller:u}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/network-enablement-controller-init.ts"}],[250,{"@metamask/base-controller":1311,"@metamask/obs-store":2379},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/obs-store"),r=e("@metamask/base-controller");function i(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function l(e,t){return(0,r.deriveStateFromMetadata)(e,t,"persist")}var c=new WeakSet;class u extends s.ObservableStore{constructor({config:e,controllerMessenger:t,state:n,persist:s}){super(n),i(this,c),a(this,"config",{}),this.persist=s,this.controllerMessenger=t,e&&this.updateStructure(e)}updateStructure(e){this.config=e,this.removeAllListeners();const t={};for(const s of Object.keys(e)){var n;if(!e[s])throw new Error(`Undefined '${s}'`);const r=e[s];r.subscribe?e[s].subscribe(e=>{o(c,this,d).call(this,s,e)}):this.persist?this.controllerMessenger.subscribe(`${r.name}:stateChange`,(t,n)=>{o(c,this,h).call(this,e[s].metadata,n)&&o(c,this,d).call(this,s,l(t,e[s].metadata),n)}):this.controllerMessenger.subscribe(`${r.name}:stateChange`,(e,t)=>o(c,this,d).call(this,s,e,t));const i=r.state??(null===(n=r.getState)||void 0===n?void 0:n.call(r));t[s]=this.persist&&e[s].metadata?l(i,e[s].metadata):i}this.updateState(t)}getFlatState(){if(!this.config)return{};const e={};for(const t of Object.keys(this.config)){const n=this.config[t],s=n.getState?n.getState():n.state;Object.assign(e,s)}return e}}function d(e,t,n){const s=this.getState()[e];this.updateState({[e]:t}),this.emit("stateChange",{controllerKey:e,newState:t,oldState:s,patches:n})}function h(e,t){return t.some(t=>{if(0===t.path.length)return!0;const n=t.path[0];return!e[n]||e[n].persist})}n.default=u}}},{package:"$root$",file:"app/scripts/lib/ComposableObservableStore.js"}],[251,{"webextension-polyfill":5741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CronjobControllerStorageManager=n.CronjobControllerStorageKey=void 0;var s,r=(s=e("webextension-polyfill"))&&s.__esModule?s:{default:s};function i(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function a(e,t){return e.get(l(e,t))}function o(e,t,n){return e.set(l(e,t),n),n}function l(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const c=n.CronjobControllerStorageKey="temp-cronjob-storage";var u=new WeakMap,d=new WeakMap;n.CronjobControllerStorageManager=class{constructor(){i(this,u,null),i(this,d,!1)}async init(){o(u,this,(await r.default.storage.local.get(c))[c]),o(d,this,!0)}getInitialState(){if(!a(d,this))throw new Error("CronjobControllerStorageManager not yet initialized");return a(u,this)}set(e){if(!a(d,this))throw new Error("CronjobControllerStorageManager not yet initialized");r.default.storage.local.set({[c]:e}).catch(console.error)}}}}},{package:"$root$",file:"app/scripts/lib/CronjobControllerStorageManager.ts"}],[252,{"./state-utils":334,"@metamask/utils":3070,lodash:4794,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PatchStore=void 0;var s=e("@metamask/utils"),r=e("uuid"),i=e("lodash"),a=e("./state-utils");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const l=(0,s.createProjectLogger)("patch-store");n.PatchStore=class{constructor(e){o(this,"id",void 0),o(this,"observableStore",void 0),o(this,"pendingPatches",[]),o(this,"listener",void 0),this.id=(0,r.v4)(),this.observableStore=e,this.listener=this._onStateChange.bind(this),this.observableStore.on("stateChange",this.listener),l("Created",this.id)}flushPendingPatches(){const e=this.pendingPatches;this.pendingPatches=[];for(const t of e)l("Flushed",t.path.join("."),this.id,t);return e}destroy(){this.observableStore.removeListener("stateChange",this.listener),l("Destroyed",this.id)}_onStateChange({newState:e,oldState:t,patches:n}){let s=[];if(n){const e=this._normalizeEventPatches(n,t);s=(0,a.sanitizePatches)(e??[])}else{const n=(0,a.sanitizeUIState)(e);s=this._generatePatches(t,n)}const r=Boolean(e.vault);if(r&&s.push({op:"replace",path:["isInitialized"],value:r}),s.length)for(const e of s){const t=e.path.join(".");this.pendingPatches.push(e),l("Added",t,this.id,e)}}_generatePatches(e,t){return Object.keys(t).map(n=>{const s=e[n],r=t[n];return s===r?null:{op:"replace",path:[n],value:r}}).filter(Boolean)}_normalizeEventPatches(e,t){return null==e?void 0:e.flatMap(e=>{if(e.path.length>0)return[e];return(0,i.uniq)([...Object.keys(t),...Object.keys(e.value)]).map(t=>({op:t in e.value?"replace":"remove",path:[t],...t in e.value?{value:e.value[t]}:{}}))})}}}}},{package:"$root$",file:"app/scripts/lib/PatchStore.ts"}],[253,{"@metamask/name-controller":2287,"@metamask/snaps-rpc-methods":2732,"@metamask/snaps-utils":2902,loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsNameProvider=void 0;var s,r=e("@metamask/name-controller"),i=e("@metamask/snaps-utils"),a=(s=e("loglevel"))&&s.__esModule?s:{default:s},o=e("@metamask/snaps-rpc-methods");function l(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){return e.get(d(e,t))}function d(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var h=new WeakMap,p=new WeakSet;function m(e){const t=u(h,this).call("PermissionController:getState").subjects;return u(h,this).call("SnapController:getAll").filter(({id:n})=>{var s;const r=null===(s=t[n])||void 0===s?void 0:s.permissions["endowment:name-lookup"];if(!r)return!1;const i=(0,o.getChainIdsCaveat)(r);return!(e&&i&&!i.includes(e))})}async function f(e,t,n){const s=e,r={chainId:t,address:n};let o,l;try{const t=await u(h,this).call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:i.HandlerType.OnNameLookup,request:{jsonrpc:"2.0",method:" ",params:r}}),n=null==t?void 0:t.resolvedDomains;o=n?[...new Set(n.map(e=>e.resolvedDomain))]:[]}catch(t){a.default.error("Snap name provider request failed",{snapId:e,request:r,error:t}),l=t}return{sourceId:s,result:{proposedNames:o,error:l}}}n.SnapsNameProvider=class{constructor({messenger:e}){var t,n,s;!function(e,t){l(e,t),t.add(e)}(this,p),c(this,"name","SnapsNameProvider"),c(this,"state",null),function(e,t,n){l(e,t),t.set(e,n)}(this,h,void 0),n=this,s=e,(t=h).set(d(t,n),s)}getMetadata(){const e=d(p,this,m).call(this);return{sourceIds:{[r.NameType.ETHEREUM_ADDRESS]:e.map(e=>e.id)},sourceLabels:e.reduce((e,t)=>{const n=u(h,this).call("SnapController:get",t.id),s=null==n?void 0:n.manifest.proposedName;return{...e,[t.id]:s||t.id}},{})}}async getProposedNames(e){const{variation:t,value:n}=e,s=`eip155:${parseInt(t,16)}`,r=d(p,this,m).call(this,s);return{results:(await Promise.all(r.map(e=>d(p,this,f).call(this,e.id,s,n)))).reduce((e,t)=>{const{sourceId:n,result:s}=t;return{...e,[n]:s}},{})}}}}}},{package:"$root$",file:"app/scripts/lib/SnapsNameProvider.ts"}],[254,{"../../../shared/constants/onboarding":5775,"../../../shared/lib/wallet-funds-obtained-metric":5881,"@metamask/notification-services-controller/notification-services":2320,loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WalletFundsObtainedMonitor=void 0;var s,r=e("@metamask/notification-services-controller/notification-services"),i=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("../../../shared/lib/wallet-funds-obtained-metric"),o=e("../../../shared/constants/onboarding");function l(e,t,n){c(e,t),t.set(e,n)}function c(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function u(e,t){return e.get(h(e,t))}function d(e,t,n){return e.set(h(e,t),n),n}function h(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var p=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakSet;function y(){try{const e=u(p,this).call("TokenBalancesController:getState"),t=u(p,this).call("MultichainBalancesController:getState");return(0,a.hasNonZeroTokenBalance)(e.tokenBalances)||(0,a.hasNonZeroMultichainBalance)(t.balances)}catch(e){return i.default.error("Error checking for existing funds: ",e),!1}}function b(){return e=>{const t=e.filter(e=>e.type===r.TRIGGER_TYPES.ERC20_RECEIVED||e.type===r.TRIGGER_TYPES.ETH_RECEIVED);if(t.length<1)return;const n=t.at(-1);if(!n)return;const{payload:{chain_id:s}}=n,i=n.type===r.TRIGGER_TYPES.ERC20_RECEIVED?n.payload.data.token.usd:n.payload.data.amount.usd;s&&i&&(u(p,this).call("MetaMetricsController:trackEvent",(0,a.getWalletFundsObtainedEventProperties)({chainId:s,amountUsd:i})),u(p,this).call("AppStateController:setCanTrackWalletFundsObtained",!1),u(f,this)&&(u(p,this).unsubscribe("NotificationServicesController:notificationsListUpdated",u(f,this)),d(f,this,null)))}}n.WalletFundsObtainedMonitor=class{constructor({messenger:e}){!function(e,t){c(e,t),t.add(e)}(this,g),l(this,p,void 0),l(this,m,!1),l(this,f,null),d(p,this,e)}setupMonitoring(){if(u(m,this))return;const e=u(p,this).call("OnboardingController:getState"),{firstTimeFlowType:t}=e;if(t!==o.FirstTimeFlowType.create&&t!==o.FirstTimeFlowType.socialCreate)return void u(p,this).call("AppStateController:setCanTrackWalletFundsObtained",!1);u(p,this).call("NotificationServicesController:getState").isNotificationServicesEnabled?h(g,this,y).call(this)?u(p,this).call("AppStateController:setCanTrackWalletFundsObtained",!1):(d(f,this,h(g,this,b).call(this)),u(p,this).subscribe("NotificationServicesController:notificationsListUpdated",u(f,this)),d(m,this,!0)):u(p,this).call("AppStateController:setCanTrackWalletFundsObtained",!1)}}}}},{package:"$root$",file:"app/scripts/lib/WalletFundsObtainedMonitor.ts"}],[255,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.WeakRefObjectMap=void 0;class r{constructor(){s(this,"map",void 0),this.map=new Map}set(e,t){const n={};for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const s=t[e];if("object"!=typeof s||null===s)throw new Error(`Property ${String(e)} is not an object and cannot be weakly referenced.`);n[e]=new WeakRef(s)}return this.map.set(e,n),this}get(e){const t=this.map.get(e);if(!t)return undefined;const n={};for(const s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;const r=t[s].deref();if(r===undefined)return this.map.delete(e),undefined;n[s]=r}return n}has(e){return this.get(e)!==undefined}delete(e){return this.get(e)!==undefined&&this.map.delete(e)}clear(){this.map.clear()}get size(){return this.map.size}entries(){const e=[];return this.map.forEach((t,n)=>{const s=this.get(n);s!==undefined&&e.push([n,s])}),e.values()}keys(){return this.map.keys()}values(){const e=[];return this.map.forEach((t,n)=>{const s=this.get(n);s!==undefined&&e.push(s)}),e.values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"WeakRefObjectMap"}forEach(e,t){this.map.forEach((n,s)=>{const r=this.get(s);r!==undefined&&(t?e.call(t,r,s,this):e(r,s,this))})}}n.WeakRefObjectMap=r}}},{package:"$root$",file:"app/scripts/lib/WeakRefObjectMap.ts"}],[256,{"../../../../shared/constants/app":5753,"@metamask/controller-utils":1384,"@metamask/rpc-errors":2594,"@metamask/snaps-rpc-methods":2732,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.rejectAllApprovals=function({approvalController:e,deleteInterface:t}){const n=e.state.pendingApprovals,s=Object.values(n);for(const n of s)c({approvalController:e,approvalRequest:n,deleteInterface:t})},n.rejectOriginApprovals=function({approvalController:e,deleteInterface:t,origin:n}){const s=e.state.pendingApprovals,r=Object.values(s).filter(e=>e.origin===n);for(const n of r)c({approvalController:e,approvalRequest:n,deleteInterface:t})};var s=e("@metamask/controller-utils"),r=e("@metamask/snaps-rpc-methods"),i=e("@metamask/rpc-errors"),a=e("@metamask/utils"),o=e("../../../../shared/constants/app");const l=(0,a.createProjectLogger)("approval-utils");function c({approvalController:e,approvalRequest:t,deleteInterface:n}){var a;const{id:c,type:u,origin:d}=t,h=null===(a=t.requestData)||void 0===a?void 0:a.id;switch(u){case s.ApprovalType.SnapDialogAlert:case s.ApprovalType.SnapDialogPrompt:case r.DIALOG_APPROVAL_TYPES.default:l("Rejecting snap dialog",{id:c,interfaceId:h,origin:d,type:u}),e.accept(c,null),null==n||n(h);break;case s.ApprovalType.SnapDialogConfirmation:l("Rejecting snap confirmation",{id:c,interfaceId:h,origin:d,type:u}),e.accept(c,!1),null==n||n(h);break;case o.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case o.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case o.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:l("Rejecting snap account confirmation",{id:c,origin:d,type:u}),e.accept(c,!1);break;default:l("Rejecting pending approval",{id:c,origin:d,type:u}),e.reject(c,i.providerErrors.userRejectedRequest({data:{cause:"rejectAllApprovals"}}))}}}}},{package:"$root$",file:"app/scripts/lib/approval/utils.ts"}],[257,{"../../../shared/modules/string-utils":5917},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("../../../shared/modules/string-utils");n.default=class{constructor(e={}){const{preferencesController:t,addressBookController:n,accountsController:s,networkController:r,trackMetaMetricsEvent:i}=e;this.preferencesController=t,this.accountsController=s,this.addressBookController=n,this.networkController=r,this._trackMetaMetricsEvent=i}async restoreUserData(e){const t=this.preferencesController.state,{preferences:n,addressBook:s,network:r,internalAccounts:i}=JSON.parse(e);n&&(n.identities=t.identities,n.lostIdentities=t.lostIdentities,n.selectedAddress=t.selectedAddress,this.preferencesController.update(n)),s&&this.addressBookController.update(s,!0),r&&this.networkController.loadBackup(r),i&&this.accountsController.loadBackup(i),(n||s||r||i)&&this._trackMetaMetricsEvent({event:"User Data Imported",category:"Backup"})}async backupUserData(){const e={preferences:{...this.preferencesController.state},internalAccounts:{internalAccounts:this.accountsController.state.internalAccounts},addressBook:{...this.addressBookController.state},network:{networkConfigurationsByChainId:this.networkController.state.networkConfigurationsByChainId}};delete e.preferences.identities,delete e.preferences.lostIdentities,delete e.preferences.selectedAddress;const t=JSON.stringify(e),n=new Date,r=e=>(0,s.prependZero)(e,2);return{fileName:`MetaMaskUserData.${n.getFullYear()}_${r(n.getMonth()+1)}_${r(n.getDay())}_${r(n.getHours())}_${r(n.getMinutes())}_${r(n.getDay())}.json`,data:t}}}}}},{package:"$root$",file:"app/scripts/lib/backup.js"}],[258,{"../../../shared/constants/time":5790,loglevel:4802,"readable-stream":5249},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.THREE_MINUTES=void 0,n.default=function(){const e=l();return new r.Transform({transform(t,n,s){const r=t.id===undefined,a=e.add(t.id);r||a?s(null,t):(i.default.debug(`RPC request with id "${t.id}" already seen.`),s())},objectMode:!0})};var s,r=e("readable-stream"),i=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("../../../shared/constants/time");const o=n.THREE_MINUTES=3*a.MINUTE,l=()=>{const e=new Map;return setInterval(()=>{const t=Date.now()-o;for(const[n,s]of e.entries()){if(!(s<=t))break;e.delete(n)}},o),{add:t=>!e.has(t)&&(e.set(t,Date.now()),!0)}}}}},{package:"$root$",file:"app/scripts/lib/createDupeReqFilterStream.ts"}],[2583,{"@metamask/base-controller":1311,"@metamask/rpc-errors":2594,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RateLimitController=void 0;const s=e("@metamask/base-controller"),r=e("@metamask/rpc-errors"),i=e("@metamask/utils"),a="RateLimitController",o={requests:{includeInStateLogs:!1,persist:!1,includeInDebugSnapshot:!1,usedInUi:!1}};class l extends s.BaseController{constructor({rateLimitTimeout:e=5e3,rateLimitCount:t=1,messenger:n,state:s,implementations:r}){const l={requests:(0,i.getKnownPropertyNames)(r).reduce((e,t)=>({...e,[t]:{}}),{})};super({name:a,metadata:o,messenger:n,state:{...l,...s}}),this.implementations=r,this.rateLimitTimeout=e,this.rateLimitCount=t,this.messenger.registerActionHandler(`${a}:call`,(e,t,...n)=>this.call(e,t,...n))}async call(e,t,...n){if(this.isRateLimited(t,e))throw r.rpcErrors.limitExceeded({message:`"${t.toString()}" is currently rate-limited. Please try again later.`});this.recordRequest(t,e);const s=this.implementations[t].method;if(!s)throw new Error("Invalid api type");return s(...n)}isRateLimited(e,t){const n=this.implementations[e].rateLimitCount??this.rateLimitCount;return this.state.requests[e][t]>=n}recordRequest(e,t){const n=this.implementations[e].rateLimitTimeout??this.rateLimitTimeout,s=this.state.requests[e][t]??0;this.update(r=>{0===s&&setTimeout(()=>this.resetRequestCount(e,t),n),Object.assign(r,{requests:{...r.requests,[e]:{[t]:s+1}}})})}resetRequestCount(e,t){this.update(n=>{Object.assign(n,{requests:{...n.requests,[e]:{[t]:0}}})})}}n.RateLimitController=l}}},{package:"@metamask/rate-limit-controller",file:"node_modules/@metamask/rate-limit-controller/dist/RateLimitController.cjs"}],[2584,{"./RateLimitController.cjs":2583},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RateLimitController=void 0;var s=e("./RateLimitController.cjs");Object.defineProperty(n,"RateLimitController",{enumerable:!0,get:function(){return s.RateLimitController}})}}},{package:"@metamask/rate-limit-controller",file:"node_modules/@metamask/rate-limit-controller/dist/index.cjs"}],[2585,{"../constants.cjs":2586,"@metamask/controller-utils":1384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,l=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ClientConfigApiService=void 0;const u=e("@metamask/controller-utils"),d=e("../constants.cjs");n.ClientConfigApiService=class{constructor({fetch:e,retries:t=u.DEFAULT_MAX_RETRIES,maximumConsecutiveFailures:n=u.DEFAULT_MAX_CONSECUTIVE_FAILURES,circuitBreakDuration:d=u.DEFAULT_CIRCUIT_BREAK_DURATION,onBreak:h,onDegraded:p,config:m}){s.set(this,void 0),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),l(this,s,e,"f"),l(this,i,m.client,"f"),l(this,a,m.distribution,"f"),l(this,o,m.environment,"f"),l(this,r,(0,u.createServicePolicy)({maxRetries:t,maxConsecutiveFailures:n,circuitBreakDuration:d}),"f"),h&&c(this,r,"f").onBreak(h),p&&c(this,r,"f").onDegraded(p)}onBreak(...e){return c(this,r,"f").onBreak(...e)}onDegraded(...e){return c(this,r,"f").onDegraded(...e)}async fetchRemoteFeatureFlags(){const e=`${d.BASE_URL}/flags?client=${c(this,i,"f")}&distribution=${c(this,a,"f")}&environment=${c(this,o,"f")}`,t=await c(this,r,"f").execute(()=>c(this,s,"f").call(this,e,{cache:"no-cache"}));if(!t.ok)throw new Error("Failed to fetch remote feature flags");const n=await t.json();if(!Array.isArray(n))throw new Error("Feature flags api did not return an array");return{remoteFeatureFlags:this.flattenFeatureFlags(n),cacheTimestamp:Date.now()}}flattenFeatureFlags(e){return e.reduce((e,t)=>({...e,...t}),{})}},s=new WeakMap,r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/client-config-api-service/client-config-api-service.cjs"}],[2586,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BASE_URL=void 0,n.BASE_URL="https://client-config.api.cx.metamask.io/v1"}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/constants.cjs"}],[2587,{"./client-config-api-service/client-config-api-service.cjs":2585,"./remote-feature-flag-controller-types.cjs":2588,"./remote-feature-flag-controller.cjs":2589,"./utils/user-segmentation-utils.cjs":2590},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateDeterministicRandomNumber=n.ClientConfigApiService=n.EnvironmentType=n.DistributionType=n.ClientType=n.RemoteFeatureFlagController=void 0;var s=e("./remote-feature-flag-controller.cjs");Object.defineProperty(n,"RemoteFeatureFlagController",{enumerable:!0,get:function(){return s.RemoteFeatureFlagController}});var r=e("./remote-feature-flag-controller-types.cjs");Object.defineProperty(n,"ClientType",{enumerable:!0,get:function(){return r.ClientType}}),Object.defineProperty(n,"DistributionType",{enumerable:!0,get:function(){return r.DistributionType}}),Object.defineProperty(n,"EnvironmentType",{enumerable:!0,get:function(){return r.EnvironmentType}});var i=e("./client-config-api-service/client-config-api-service.cjs");Object.defineProperty(n,"ClientConfigApiService",{enumerable:!0,get:function(){return i.ClientConfigApiService}});var a=e("./utils/user-segmentation-utils.cjs");Object.defineProperty(n,"generateDeterministicRandomNumber",{enumerable:!0,get:function(){return a.generateDeterministicRandomNumber}})}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/index.cjs"}],[2588,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i;Object.defineProperty(n,"__esModule",{value:!0}),n.EnvironmentType=n.DistributionType=n.ClientType=void 0,function(e){e.Extension="extension",e.Mobile="mobile"}(s||(n.ClientType=s={})),function(e){e.Main="main",e.Flask="flask",e.Beta="beta"}(r||(n.DistributionType=r={})),function(e){e.Production="prod",e.ReleaseCandidate="rc",e.Development="dev",e.Beta="beta",e.Test="test",e.Exp="exp"}(i||(n.EnvironmentType=i={}))}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/remote-feature-flag-controller-types.cjs"}],[2589,{"./utils/user-segmentation-utils.cjs":2590,"@metamask/base-controller":1311},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,l,c,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.RemoteFeatureFlagController=n.getDefaultRemoteFeatureFlagControllerState=n.DEFAULT_CACHE_DURATION=void 0;const m=e("@metamask/base-controller"),f=e("./utils/user-segmentation-utils.cjs");n.DEFAULT_CACHE_DURATION=864e5;const g={remoteFeatureFlags:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},cacheTimestamp:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1}};function y(){return{remoteFeatureFlags:{},cacheTimestamp:0}}n.getDefaultRemoteFeatureFlagControllerState=y;class b extends m.BaseController{constructor({messenger:e,state:t,clientConfigApiService:c,fetchInterval:u=n.DEFAULT_CACHE_DURATION,disabled:d=!1,getMetaMetricsId:p}){super({name:"RemoteFeatureFlagController",metadata:g,messenger:e,state:{remoteFeatureFlags:{},cacheTimestamp:0,...t}}),s.add(this),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),l.set(this,void 0),h(this,r,u,"f"),h(this,i,d,"f"),h(this,a,c,"f"),h(this,l,p,"f")}async updateRemoteFeatureFlags(){if(p(this,i,"f")||!p(this,s,"m",c).call(this))return;let e;if(p(this,o,"f"))await p(this,o,"f");else{try{h(this,o,p(this,a,"f").fetchRemoteFeatureFlags(),"f"),e=await p(this,o,"f")}finally{h(this,o,undefined,"f")}await p(this,s,"m",u).call(this,e.remoteFeatureFlags)}}enable(){h(this,i,!1,"f")}disable(){h(this,i,!0,"f")}}n.RemoteFeatureFlagController=b,r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakMap,s=new WeakSet,c=function(){return Date.now()-this.state.cacheTimestamp>p(this,r,"f")},u=async function(e){const t=await p(this,s,"m",d).call(this,e);this.update(()=>({remoteFeatureFlags:t,cacheTimestamp:Date.now()}))},d=async function(e){const t={},n=p(this,l,"f").call(this),s=(0,f.generateDeterministicRandomNumber)(n);for(const[n,r]of Object.entries(e)){let e=r;if(Array.isArray(r)&&s){const t=r.find(e=>!!(0,f.isFeatureFlagWithScopeValue)(e)&&s<=e.scope.value);t&&(e={name:t.name,value:t.value})}t[n]=e}return t}}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/remote-feature-flag-controller.cjs"}],[259,{"../../../shared/constants/permissions":5776,"../controllers/permissions":230,"@metamask/keyring-api":2173},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({messenger:e}){return function(t,n,r,i){const o=e.call("AccountsController:getSelectedAccount");if((0,s.isEvmAccountType)(o.type))return r();if(a.includes(t.method))return i(new Error(`Non-EVM account cannot request this method: ${t.method}`));if("wallet_requestPermissions"===t.method&&null!=t&&t.params&&Array.isArray(t.params)&&t.params.length>0&&t.params[0]){const e=Object.keys(t.params[0]);if(a.some(t=>e.includes(t)))return i(new Error(`Non-EVM account cannot request this method: ${e.toString()}`))}return r()}};var s=e("@metamask/keyring-api"),r=e("../../../shared/constants/permissions"),i=e("../controllers/permissions");const a=[...Object.values(r.RestrictedEthMethods),...i.unrestrictedEthSigningMethods]}}},{package:"$root$",file:"app/scripts/lib/createEvmMethodsToNonEvmAccountReqFilterMiddleware.ts"}],[2590,{uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isFeatureFlagWithScopeValue=n.generateDeterministicRandomNumber=void 0;const s=e("uuid");function r(e){return BigInt(`0x${e.replace(/-/gu,"")}`)}const i=r("00000000-0000-4000-8000-000000000000"),a=r("ffffffff-ffff-4fff-bfff-ffffffffffff")-i;n.generateDeterministicRandomNumber=function(e){if(!e)throw new Error("MetaMetrics ID cannot be empty");let t,n;if((0,s.validate)(e)){if(4!==(0,s.version)(e))throw new Error(`Invalid UUID version. Expected v4, got v${(0,s.version)(e)}`);t=r(e)-i,n=a}else{if(!e.startsWith("0x"))throw new Error("Hex ID must start with 0x prefix");const s=e.slice(2),r=64;if(s.length!==r)throw new Error(`Invalid hex ID length. Expected ${r} characters, got ${s.length}`);if(!/^[0-9a-f]+$/iu.test(s))throw new Error("Hex ID contains invalid characters");t=BigInt(`0x${s}`),n=BigInt(`0x${"f".repeat(s.length)}`)}return Number(t*BigInt(1e6)/n)/1e6};n.isFeatureFlagWithScopeValue=e=>"object"==typeof e&&null!==e&&"scope"in e}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/utils/user-segmentation-utils.cjs"}],[26,{"../../controllers/network-order":225},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkOrderControllerInit=void 0;var s=e("../../controllers/network-order");n.NetworkOrderControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new s.NetworkOrderController({messenger:e,state:{orderedNetworkList:[],...t.NetworkOrderController}})})}}},{package:"$root$",file:"app/scripts/controller-init/assets/network-order-controller-init.ts"}],[260,{"../../../shared/constants/referrals":5779,"@metamask/json-rpc-engine":2089,loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.HyperliquidPermissionTriggerType=void 0,n.createHyperliquidReferralMiddleware=function(e){return(0,r.createAsyncMiddleware)(async(t,n,s)=>{if(await s(),!function(e){return Boolean(e.origin)&&Boolean(e.tabId)}(t))return;const r="wallet_requestPermissions"===t.method&&t.origin===a.HYPERLIQUID_ORIGIN,l=Array.isArray(n.result)&&n.result.some(e=>"eth_accounts"===(null==e?void 0:e.parentCapability));r&&l&&e(t.tabId,o.NewConnection).catch(e=>{i.default.error("Failed to handle Hyperliquid referral after wallet_requestPermissions grant: ",e)})})};var s,r=e("@metamask/json-rpc-engine"),i=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("../../../shared/constants/referrals");let o=n.HyperliquidPermissionTriggerType=function(e){return e.NewConnection="new_connection",e.OnNavigateConnectedTab="on_navigate_connected_tab",e}({})}}},{package:"$root$",file:"app/scripts/lib/createHyperliquidReferralMiddleware.ts"}],[261,{loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,s){s(s=>{n.error&&r.default.debug("Error in RPC response:\n",n),t.isMetamaskInternal||(r.default.info(`RPC (${e.origin}): ${t.method} -> ${n.error?"error":"success"}`),s())})}};var s,r=(s=e("loglevel"))&&s.__esModule?s:{default:s}}}},{package:"$root$",file:"app/scripts/lib/createLoggerMiddleware.js"}],[2617,{"@metamask/base-controller":1311,"@metamask/swappable-obj-proxy":2940},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,l,c=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SelectedNetworkController=n.SelectedNetworkControllerEventTypes=n.SelectedNetworkControllerActionTypes=n.METAMASK_DOMAIN=void 0;const d=e("@metamask/base-controller"),h=e("@metamask/swappable-obj-proxy"),p="SelectedNetworkController",m={domains:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};n.METAMASK_DOMAIN="metamask",n.SelectedNetworkControllerActionTypes={getState:`${p}:getState`,getNetworkClientIdForDomain:`${p}:getNetworkClientIdForDomain`,setNetworkClientIdForDomain:`${p}:setNetworkClientIdForDomain`},n.SelectedNetworkControllerEventTypes={stateChange:`${p}:stateChange`};class f extends d.BaseController{constructor({messenger:e,state:t={domains:{}},domainProxyMap:n}){super({name:p,metadata:m,messenger:e,state:t}),s.add(this),r.set(this,void 0),c(this,r,n,"f"),u(this,s,"m",i).call(this),this.messenger.call("PermissionController:getSubjectNames").filter(e=>this.state.domains[e]===undefined).forEach(e=>this.setNetworkClientIdForDomain(e,this.messenger.call("NetworkController:getState").selectedNetworkClientId)),this.messenger.subscribe("PermissionController:stateChange",(e,t)=>{t.forEach(({op:e,path:t})=>{if("subjects"===t[0]&&t[1]!==undefined&&"string"==typeof t[1]){const n=t[1];"add"===e&&this.state.domains[n]===undefined?this.setNetworkClientIdForDomain(n,this.messenger.call("NetworkController:getState").selectedNetworkClientId):"remove"===e&&this.state.domains[n]!==undefined&&u(this,s,"m",o).call(this,n)}})}),this.messenger.subscribe("NetworkController:stateChange",({selectedNetworkClientId:e,networkConfigurationsByChainId:t},n)=>{const s=n.find(({op:e,path:t})=>("replace"===e||"remove"===e)&&"networkConfigurationsByChainId"===t[0]);if(s){const n=Object.values(t).reduce((e,t)=>(t.rpcEndpoints.forEach(({networkClientId:n})=>e[n]=t.chainId),e),{});Object.entries(this.state.domains).forEach(([r,i])=>{const a=n[i];if("remove"!==s.op||a){if("replace"===s.op){const e=s.path[1];if(!a||a===e){const n=t[e],{networkClientId:s}=n.rpcEndpoints[n.defaultRpcEndpointIndex];i!==s&&this.setNetworkClientIdForDomain(r,s)}}}else this.setNetworkClientIdForDomain(r,e)})}})}setNetworkClientIdForDomain(e,t){if(e===n.METAMASK_DOMAIN)throw new Error(`NetworkClientId for domain "${n.METAMASK_DOMAIN}" cannot be set on the SelectedNetworkController`);if(!u(this,s,"m",l).call(this,e))throw new Error("NetworkClientId for domain cannot be called with a domain that has not yet been granted permissions");u(this,s,"m",a).call(this,e,t)}getNetworkClientIdForDomain(e){const{selectedNetworkClientId:t}=this.messenger.call("NetworkController:getState");return this.state.domains[e]??t}getProviderAndBlockTracker(e){if(e===n.METAMASK_DOMAIN){const e=this.messenger.call("NetworkController:getSelectedNetworkClient");if(e===undefined)throw new Error("Selected network not initialized");return e}let t=u(this,r,"f").get(e);if(t===undefined){let n;if(u(this,s,"m",l).call(this,e)){const t=this.getNetworkClientIdForDomain(e);n=this.messenger.call("NetworkController:getNetworkClientById",t)}else if(n=this.messenger.call("NetworkController:getSelectedNetworkClient"),n===undefined)throw new Error("Selected network not initialized");t={provider:(0,h.createEventEmitterProxy)(n.provider),blockTracker:(0,h.createEventEmitterProxy)(n.blockTracker,{eventFilter:"skipInternal"})},u(this,r,"f").set(e,t)}return t}}n.SelectedNetworkController=f,r=new WeakMap,s=new WeakSet,i=function(){this.messenger.registerActionHandler(n.SelectedNetworkControllerActionTypes.getNetworkClientIdForDomain,this.getNetworkClientIdForDomain.bind(this)),this.messenger.registerActionHandler(n.SelectedNetworkControllerActionTypes.setNetworkClientIdForDomain,this.setNetworkClientIdForDomain.bind(this))},a=function(e,t){const n=this.messenger.call("NetworkController:getNetworkClientById",t);this.update(n=>{n.domains[e]=t});const s=this.getProviderAndBlockTracker(e);s.provider.setTarget(n.provider),s.blockTracker.setTarget(n.blockTracker)},o=function(e){const t=this.messenger.call("NetworkController:getSelectedNetworkClient"),n=u(this,r,"f").get(e);n&&t?(n.provider.setTarget(t.provider),n.blockTracker.setTarget(t.blockTracker)):n&&u(this,r,"f").delete(e),this.update(t=>{delete t.domains[e]})},l=function(e){return this.messenger.call("PermissionController:hasPermissions",e)}}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/SelectedNetworkController.cjs"}],[2618,{"./SelectedNetworkController.cjs":2617},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSelectedNetworkMiddleware=void 0;const s=e("./SelectedNetworkController.cjs");n.createSelectedNetworkMiddleware=e=>(t,n,r)=>{if(!t.origin)throw new Error("Request object is lacking an 'origin'");var i;return t.networkClientId=(i=t.origin,e.call(s.SelectedNetworkControllerActionTypes.getNetworkClientIdForDomain,i)),r()}}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/SelectedNetworkMiddleware.cjs"}],[2619,{"./SelectedNetworkController.cjs":2617,"./SelectedNetworkMiddleware.cjs":2618},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSelectedNetworkMiddleware=n.METAMASK_DOMAIN=n.SelectedNetworkController=n.SelectedNetworkControllerEventTypes=n.SelectedNetworkControllerActionTypes=void 0;var s=e("./SelectedNetworkController.cjs");Object.defineProperty(n,"SelectedNetworkControllerActionTypes",{enumerable:!0,get:function(){return s.SelectedNetworkControllerActionTypes}}),Object.defineProperty(n,"SelectedNetworkControllerEventTypes",{enumerable:!0,get:function(){return s.SelectedNetworkControllerEventTypes}}),Object.defineProperty(n,"SelectedNetworkController",{enumerable:!0,get:function(){return s.SelectedNetworkController}}),Object.defineProperty(n,"METAMASK_DOMAIN",{enumerable:!0,get:function(){return s.METAMASK_DOMAIN}});var r=e("./SelectedNetworkMiddleware.cjs");Object.defineProperty(n,"createSelectedNetworkMiddleware",{enumerable:!0,get:function(){return r.createSelectedNetworkMiddleware}})}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/index.cjs"}],[262,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({mainFrameOrigin:e}){return function(t,n,s){t.mainFrameOrigin=e,s()}}}}},{package:"$root$",file:"app/scripts/lib/createMainFrameOriginMiddleware.ts"}],[2620,{"./constants.cjs":2622,"./logger.cjs":2624,"@metamask/base-controller":1311,"@metamask/signature-controller":2627,"@metamask/transaction-controller":2989,lodash:4794},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,l,c,u,d,h,p,m,f,g,y,b=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},S=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ShieldController=n.getDefaultShieldControllerState=void 0;const v=e("@metamask/base-controller"),w=e("@metamask/signature-controller"),E=e("@metamask/transaction-controller"),_=e("lodash"),T=e("./constants.cjs"),k=e("./logger.cjs"),P=(0,k.createModuleLogger)(k.projectLogger,"ShieldController");function M(){return{coverageResults:{},orderedTransactionHistory:[]}}n.getDefaultShieldControllerState=M;const R={coverageResults:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},orderedTransactionHistory:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}};class A extends v.BaseController{constructor(e){const{messenger:t,state:n,backend:p,transactionHistoryLimit:m=100,coverageHistoryLimit:f=10,normalizeSignatureRequest:g}=e;super({name:T.controllerName,metadata:R,messenger:t,state:{coverageResults:{},orderedTransactionHistory:[],...n}}),s.add(this),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),l.set(this,void 0),c.set(this,void 0),u.set(this,void 0),b(this,r,p,"f"),b(this,i,f,"f"),b(this,a,m,"f"),b(this,l,S(this,s,"m",h).bind(this),"f"),b(this,c,S(this,s,"m",d).bind(this),"f"),b(this,u,!1,"f"),b(this,o,g,"f")}start(){S(this,u,"f")||(b(this,u,!0,"f"),this.messenger.subscribe("TransactionController:stateChange",S(this,l,"f"),e=>e.transactions),this.messenger.subscribe("SignatureController:stateChange",S(this,c,"f"),e=>e.signatureRequests))}stop(){S(this,u,"f")&&(b(this,u,!1,"f"),this.messenger.unsubscribe("TransactionController:stateChange",S(this,l,"f")),this.messenger.unsubscribe("SignatureController:stateChange",S(this,c,"f")))}async checkCoverage(e){const t=S(this,s,"m",y).call(this,e.id),n=await S(this,r,"f").checkCoverage({txMeta:e,coverageId:t});return this.messenger.publish(`${T.controllerName}:coverageResultReceived`,n),S(this,s,"m",p).call(this,e.id,n),n}async checkSignatureCoverage(e){const t=S(this,s,"m",y).call(this,e.id),n=(0,_.cloneDeep)(e),i=S(this,o,"f")?.call(this,n)??n,a=await S(this,r,"f").checkSignatureCoverage({signatureRequest:i,coverageId:t});return this.messenger.publish(`${T.controllerName}:coverageResultReceived`,a),S(this,s,"m",p).call(this,e.id,a),a}}n.ShieldController=A,r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,s=new WeakSet,d=function(e,t){const n=Object.values(e),r=Object.values(t??{}),i=new Map(r.map(e=>[e.id,e]));for(const e of n){const t=i.get(e.id);t||this.checkSignatureCoverage(e).catch(e=>P("Error checking coverage:",e)),e.status===w.SignatureRequestStatus.Signed&&e.status!==t?.status&&S(this,s,"m",m).call(this,e).catch(e=>P("Error logging signature:",e))}},h=function(e,t){const n=new Map(t?.map(e=>[e.id,e])??[]);for(const t of e){const e=n.get(t.id);if(t.status!==E.TransactionStatus.submitted&&t.status!==E.TransactionStatus.confirmed){const n=e?.simulationData&&!(0,_.isEqual)(t.simulationData,e.simulationData);e&&!n||this.checkCoverage(t).catch(e=>P("Error checking coverage:",e))}t.status===E.TransactionStatus.submitted&&t.status!==e?.status&&S(this,s,"m",f).call(this,t).catch(e=>P("Error logging transaction:",e))}},p=function(e,t){const n=S(this,s,"m",y).call(this,e);if(n&&t.coverageId!==n)throw new Error("Coverage ID has changed");this.update(n=>{let s=!1,r=n.coverageResults[e];r||(s=!0,r={results:[]},n.coverageResults[e]=r),r.results.length>=S(this,i,"f")&&r.results.pop(),r.results.unshift(t);const{orderedTransactionHistory:o}=n;let l;s&&(o.length>=S(this,a,"f")&&(l=o.pop(),l&&delete n.coverageResults[l]),o.unshift(e))})},m=async function(e){const t=e.rawSig;if(!t)throw new Error("Signature not found");const{status:n}=S(this,s,"m",g).call(this,e.id);await S(this,r,"f").logSignature({signatureRequest:e,signature:t,status:n})},f=async function(e){const t=e.hash;if(!t)throw new Error("Transaction hash not found");const n=e.rawTx;if(!n)throw new Error("Raw transaction hex not found");const{status:i}=S(this,s,"m",g).call(this,e.id);await S(this,r,"f").logTransaction({txMeta:e,transactionHash:t,rawTransactionHex:n,status:i})},g=function(e){let t="shown";return S(this,s,"m",y).call(this,e)||(P("Coverage ID not found for",e),t="not_shown"),{status:t}},y=function(e){return this.state.coverageResults[e]?.results[0]?.coverageId}}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/ShieldController.cjs"}],[2621,{"./constants.cjs":2622,"./polling-with-policy.cjs":2625,"@metamask/controller-utils":1384,"@metamask/signature-controller":2627},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,l,c,u,d=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.parseSignatureRequestMethod=n.makeInitCoverageCheckBody=n.ShieldRemoteBackend=void 0;const p=e("@metamask/controller-utils"),m=e("@metamask/signature-controller"),f=e("./constants.cjs"),g=e("./polling-with-policy.cjs");function y(e){return{txParams:[{authorizationList:e.txParams.authorizationList,from:e.txParams.from,to:e.txParams.to,value:e.txParams.value,data:e.txParams.data,nonce:e.txParams.nonce}],chainId:e.chainId,origin:e.origin}}function b(e){const t=S(e);return{chainId:e.chainId,data:e.messageParams.data,from:e.messageParams.from,method:t,origin:e.messageParams.origin}}function S(e){if(e.type===m.SignatureRequestType.TypedSign)switch(e.version){case f.SignTypedDataVersion.V3:return m.EthMethod.SignTypedDataV3;case f.SignTypedDataVersion.V4:return m.EthMethod.SignTypedDataV4;case f.SignTypedDataVersion.V1:default:return m.SignatureRequestType.TypedSign}return e.type}n.ShieldRemoteBackend=class{constructor({getAccessToken:e,getCoverageResultTimeout:t=5e3,getCoverageResultPollInterval:n=1e3,baseUrl:l,fetch:c}){s.add(this),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),d(this,r,e,"f"),d(this,i,l,"f"),d(this,a,c,"f");const{backoff:u,maxRetries:h}=function(e,t){const n=new p.ConstantBackoff(t),s=Math.floor(e/t)+1,r=isNaN(s)||!isFinite(s)?p.DEFAULT_MAX_RETRIES:s;return{backoff:n,maxRetries:r}}(t,n);d(this,o,new g.PollingWithCockatielPolicy({backoff:u,maxRetries:h}),"f")}async checkCoverage(e){let{coverageId:t}=e;if(!t){const n=y(e.txMeta);({coverageId:t}=await h(this,s,"m",l).call(this,"v1/transaction/coverage/init",n))}const n=`${h(this,i,"f")}/v1/transaction/coverage/result`,r=await h(this,s,"m",c).call(this,e.txMeta.id,t,n);return{coverageId:t,message:r.message,reasonCode:r.reasonCode,status:r.status,metrics:r.metrics}}async checkSignatureCoverage(e){let{coverageId:t}=e;if(!t){const n=b(e.signatureRequest);({coverageId:t}=await h(this,s,"m",l).call(this,"v1/signature/coverage/init",n))}const n=`${h(this,i,"f")}/v1/signature/coverage/result`,r=await h(this,s,"m",c).call(this,e.signatureRequest.id,t,n);return{coverageId:t,message:r.message,reasonCode:r.reasonCode,status:r.status,metrics:r.metrics}}async logSignature(e){const t=b(e.signatureRequest),n={signature:e.signature,status:e.status,...t};h(this,o,"f").abortPendingRequest(e.signatureRequest.id);const r=await h(this,a,"f").call(this,`${h(this,i,"f")}/v1/signature/coverage/log`,{method:"POST",headers:await h(this,s,"m",u).call(this),body:JSON.stringify(n)});if(200!==r.status)throw new Error(`Failed to log signature: ${r.status}`)}async logTransaction(e){const t=y(e.txMeta),n={transactionHash:e.transactionHash,rawTransactionHex:e.rawTransactionHex,status:e.status,...t};h(this,o,"f").abortPendingRequest(e.txMeta.id);const r=await h(this,a,"f").call(this,`${h(this,i,"f")}/v1/transaction/coverage/log`,{method:"POST",headers:await h(this,s,"m",u).call(this),body:JSON.stringify(n)});if(200!==r.status)throw new Error(`Failed to log transaction: ${r.status}`)}},r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,s=new WeakSet,l=async function(e,t){const n=await h(this,a,"f").call(this,`${h(this,i,"f")}/${e}`,{method:"POST",headers:await h(this,s,"m",u).call(this),body:JSON.stringify(t)});if(200!==n.status)throw new Error(`Failed to init coverage check: ${n.status}`);return await n.json()},c=async function(e,t,n){const r={coverageId:t},i=await h(this,s,"m",u).call(this),l=Date.now();return{...await h(this,o,"f").start(e,async e=>{const t=await h(this,a,"f").call(this,n,{method:"POST",headers:i,body:JSON.stringify(r),signal:e});if(200===t.status)return await t.json();let s="Timeout waiting for coverage result";try{const e=await t.json();s=`Failed to get coverage result: ${e.message||e.status}`}catch{s=`Failed to get coverage result: ${t.status}`}throw new p.HttpError(t.status,s)}),metrics:{latency:Date.now()-l}}},u=async function(){return{"Content-Type":"application/json",Authorization:`Bearer ${await h(this,r,"f").call(this)}`}},n.makeInitCoverageCheckBody=y,n.parseSignatureRequestMethod=S}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/backend.cjs"}],[2622,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.SignTypedDataVersion=n.controllerName=void 0,n.controllerName="ShieldController",function(e){e.V1="V1",e.V3="V3",e.V4="V4"}(s||(n.SignTypedDataVersion=s={}))}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/constants.cjs"}],[2623,{"./ShieldController.cjs":2620,"./backend.cjs":2621},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseSignatureRequestMethod=n.ShieldRemoteBackend=n.getDefaultShieldControllerState=n.ShieldController=void 0;var s=e("./ShieldController.cjs");Object.defineProperty(n,"ShieldController",{enumerable:!0,get:function(){return s.ShieldController}}),Object.defineProperty(n,"getDefaultShieldControllerState",{enumerable:!0,get:function(){return s.getDefaultShieldControllerState}});var r=e("./backend.cjs");Object.defineProperty(n,"ShieldRemoteBackend",{enumerable:!0,get:function(){return r.ShieldRemoteBackend}}),Object.defineProperty(n,"parseSignatureRequestMethod",{enumerable:!0,get:function(){return r.parseSignatureRequestMethod}})}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/index.cjs"}],[2624,{"./constants.cjs":2622,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const s=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return s.createModuleLogger}});const r=e("./constants.cjs");n.projectLogger=(0,s.createProjectLogger)(r.controllerName)}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/logger.cjs"}],[2625,{"@metamask/controller-utils":1384,cockatiel:4098},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,l,c=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},u=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.PollingWithCockatielPolicy=void 0;const d=e("@metamask/controller-utils"),h=e("cockatiel");n.PollingWithCockatielPolicy=class{constructor(e={}){s.add(this),r.set(this,void 0),i.set(this,new Map);const t=(0,h.handleWhen)(c(this,s,"m",l));u(this,r,(0,d.createServicePolicy)({...e,retryFilterPolicy:t}),"f")}async start(e,t){const n=c(this,s,"m",a).call(this,e);try{return await c(this,r,"f").execute(async({signal:e})=>t(e),n.signal)}catch(e){if(n.signal.aborted)throw new Error("Request cancelled");throw e}finally{n===c(this,i,"f").get(e)&&c(this,s,"m",o).call(this,e)}}abortPendingRequest(e){const t=c(this,i,"f").get(e);t?.abort(),c(this,s,"m",o).call(this,e)}},r=new WeakMap,i=new WeakMap,s=new WeakSet,a=function(e){this.abortPendingRequest(e);const t=new AbortController;return c(this,i,"f").set(e,t),t},o=function(e){c(this,i,"f").delete(e)},l=function(e){return e instanceof d.HttpError&&(e.httpStatus>400&&e.httpStatus<500)}}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/polling-with-policy.cjs"}],[2626,{"./logger.cjs":2628,"./types.cjs":2629,"./utils/decoding-api.cjs":2630,"./utils/delegations.cjs":2631,"./utils/normalize.cjs":2632,"./utils/validation.cjs":2633,"@metamask/base-controller":1311,"@metamask/controller-utils":1384,"@metamask/keyring-controller":2183,"@metamask/logging-controller":2225,events:4338,uuid:5709},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,l,c,u,d,h,p,m,f,g,y,b,S,v,w,E,_,T,k,P=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},M=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},R=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.SignatureController=void 0;const A=e("@metamask/base-controller"),I=e("@metamask/controller-utils"),j=e("@metamask/keyring-controller"),C=e("@metamask/logging-controller"),O=R(e("events")),N=e("uuid"),D=e("./logger.cjs"),x=e("./types.cjs"),L=e("./utils/decoding-api.cjs"),$=e("./utils/delegations.cjs"),q=e("./utils/normalize.cjs"),U=e("./utils/validation.cjs"),F={signatureRequests:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},unapprovedPersonalMsgs:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},unapprovedTypedMessages:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},unapprovedPersonalMsgCount:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},unapprovedTypedMessagesCount:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}},H=[x.SignatureRequestStatus.Signed,x.SignatureRequestStatus.Rejected,x.SignatureRequestStatus.Errored];class W extends A.BaseController{constructor({decodingApiUrl:e,isDecodeSignatureRequestEnabled:t,messenger:n,state:o,trace:l}){super({name:"SignatureController",metadata:F,messenger:n,state:{signatureRequests:{},unapprovedPersonalMsgs:{},unapprovedTypedMessages:{},unapprovedPersonalMsgCount:0,unapprovedTypedMessagesCount:0,...o}}),s.add(this),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),this.hub=new O.default,P(this,a,l??((e,t)=>t?.()),"f"),P(this,r,e,"f"),P(this,i,t,"f")}get unapprovedPersonalMessagesCount(){return this.state.unapprovedPersonalMsgCount}get unapprovedTypedMessagesCount(){return this.state.unapprovedTypedMessagesCount}get messages(){return this.state.signatureRequests}resetState(){M(this,s,"m",S).call(this,e=>{Object.assign(e,{signatureRequests:{},unapprovedPersonalMsgs:{},unapprovedTypedMessages:{},unapprovedPersonalMsgCount:0,unapprovedTypedMessagesCount:0})})}rejectUnapproved(e){const t=Object.values(this.state.signatureRequests).filter(e=>e.status===x.SignatureRequestStatus.Unapproved);for(const n of t)M(this,s,"m",f).call(this,n.id,e)}clearUnapproved(){M(this,s,"m",S).call(this,e=>{Object.values(e.signatureRequests).filter(e=>e.status===x.SignatureRequestStatus.Unapproved).forEach(t=>delete e.signatureRequests[t.id])})}async newUnsignedPersonalMessage(e,t,n={}){(0,U.validatePersonalSignatureRequest)(e);const r=(0,q.normalizePersonalMessageParams)(e);return r.siwe=(0,I.detectSIWE)(e),M(this,s,"m",c).call(this,{messageParams:r,request:t,type:x.SignatureRequestType.PersonalSign,approvalType:I.ApprovalType.PersonalSign,traceContext:n.traceContext})}async newUnsignedTypedMessage(e,t,n,r,i={}){const a=M(this,s,"m",_).call(this,t),l=M(this,s,"m",k).call(this),u=n,d=M(this,s,"m",o).call(this,{messageParams:e,version:u,request:t});(0,U.validateTypedSignatureRequest)({currentChainId:a,internalAccounts:l,messageData:e,request:t,version:u,decodedPermission:d});const h=(0,q.normalizeTypedMessageParams)(e,u);return M(this,s,"m",c).call(this,{approvalType:I.ApprovalType.EthSignTypedData,messageParams:h,request:t,signingOptions:r,traceContext:i.traceContext,type:x.SignatureRequestType.TypedSign,version:u,decodedPermission:d})}setDeferredSignSuccess(e,t){M(this,s,"m",b).call(this,e,e=>{e.rawSig=t,e.status=x.SignatureRequestStatus.Signed})}setMessageMetadata(e,t){M(this,s,"m",b).call(this,e,e=>{e.metadata=t})}setDeferredSignError(e){M(this,s,"m",b).call(this,e,e=>{e.status=x.SignatureRequestStatus.Rejected})}setTypedMessageInProgress(e){M(this,s,"m",b).call(this,e,e=>{e.status=x.SignatureRequestStatus.InProgress})}setPersonalMessageInProgress(e){this.setTypedMessageInProgress(e)}}n.SignatureController=W,r=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakSet,o=function({messageParams:e,version:t,request:n}){let r;try{r=M(this,s,"m",l).call(this,e,t).data}catch(e){return(0,D.projectLogger)("Failed to parse typed data",e),undefined}if(!(0,$.isDelegationRequest)(r)||!n.origin||t!==j.SignTypedDataVersion.V4)return undefined;let i;try{(0,$.validateExecutionPermissionMetadata)(r),i=(0,$.decodePermissionFromRequest)({origin:n.origin,data:r,messenger:this.messenger})}catch(e){(0,D.projectLogger)("Failed to decode permission",e.message)}return i},l=function(e,t){return[j.SignTypedDataVersion.V3,j.SignTypedDataVersion.V4].includes(t)&&"string"==typeof e.data?{...e,data:JSON.parse(e.data)}:e},c=async function({chainId:e,messageParams:t,request:n,type:r,approvalType:i,version:a,signingOptions:o,traceContext:l,decodedPermission:c}){(0,D.projectLogger)("Processing signature request",{messageParams:t,request:n,type:r,version:a});const p=e??M(this,s,"m",_).call(this,n);M(this,s,"m",w).call(this,r,a,C.SigningStage.Proposed,t);const m=M(this,s,"m",u).call(this,{chainId:p,messageParams:t,request:n,signingOptions:o,type:r,version:a,decodedPermission:c});let f,y;const b=M(this,s,"m",g).call(this,m.id);M(this,s,"m",T).call(this,m.id,n,p);try{f=await M(this,s,"m",d).call(this,{approvalType:i,metadata:m,request:n,traceContext:l}),await M(this,s,"m",h).call(this,m,l)}catch(v){(0,D.projectLogger)("Signature request failed",v.message),y=v}const S=await b,{error:v,id:E,messageParams:k,rawSig:P}=S;switch(S.status){case x.SignatureRequestStatus.Signed:return(0,D.projectLogger)("Signature request finished",{id:E,signature:P}),M(this,s,"m",w).call(this,r,a,C.SigningStage.Signed,k),f?.success(P),S.rawSig;case x.SignatureRequestStatus.Rejected:const e=y??new Error(`MetaMask ${r} Signature: User denied message signature.`);throw f?.error(e),e;case x.SignatureRequestStatus.Errored:const t=y??new Error(`MetaMask ${r} Signature: ${v}`);throw f?.error(t),t;default:throw new Error(`MetaMask ${r} Signature: Unknown problem: ${JSON.stringify(k)}`)}},u=function({chainId:e,messageParams:t,request:n,signingOptions:r,type:i,version:a,decodedPermission:o}){const l=(0,N.v1)(),c=n?.origin??t.origin,u=n?.id,d=n?.securityAlertResponse,h=n?.networkClientId,p={chainId:e,id:l,messageParams:{...t,metamaskId:l,origin:c,requestId:u,version:a},networkClientId:h,securityAlertResponse:d,signingOptions:r,status:x.SignatureRequestStatus.Unapproved,time:Date.now(),type:i,version:a,decodedPermission:o};return M(this,s,"m",S).call(this,e=>{e.signatureRequests[p.id]=p}),(0,D.projectLogger)("Added signature request",p),this.hub.emit("unapprovedMessage",{messageParams:t,metamaskId:p.id}),p},d=async function({approvalType:e,metadata:t,request:n,traceContext:r}){const{id:i,messageParams:o,type:l,version:c}=t;try{return(await M(this,a,"f").call(this,{name:"Await Approval",parentContext:r},r=>M(this,s,"m",y).call(this,t,e,{traceContext:r,actionId:n?.id?.toString()}))).resultCallbacks}catch(e){throw(0,D.projectLogger)("User rejected request",{id:i,error:e}),M(this,s,"m",w).call(this,l,c,C.SigningStage.Rejected,o),M(this,s,"m",f).call(this,i),e}},h=async function(e,t){const{id:n}=e;M(this,s,"m",b).call(this,n,e=>{e.status=x.SignatureRequestStatus.Approved}),await M(this,a,"f").call(this,{name:"Sign",parentContext:t},()=>M(this,s,"m",p).call(this,e))},p=async function(e){const{id:t,messageParams:n,signingOptions:r,type:i}=e;try{let a;switch(i){case x.SignatureRequestType.PersonalSign:a=await this.messenger.call("KeyringController:signPersonalMessage",n);break;case x.SignatureRequestType.TypedSign:const t=r?.parseJsonData?M(this,s,"m",l).call(this,n,e.version):n;a=await this.messenger.call("KeyringController:signTypedMessage",t,e.version);break;default:throw new Error(`Unknown signature request type: ${i}`)}if(this.hub.emit(`${i}:signed`,{signature:a,messageId:t}),n.deferSetAsSigned)return;M(this,s,"m",b).call(this,t,e=>{e.rawSig=a,e.status=x.SignatureRequestStatus.Signed})}catch(e){throw i===x.SignatureRequestType.TypedSign?M(this,s,"m",m).call(this,t,e.message):M(this,s,"m",f).call(this,t),this.hub.emit(`${t}:signError`,{error:e}),e}},m=function(e,t){M(this,s,"m",b).call(this,e,e=>{e.status=x.SignatureRequestStatus.Errored,e.error=t})},f=function(e,t){if(t){const n=this.state.signatureRequests[e];this.hub.emit("cancelWithReason",{metadata:n,reason:t})}M(this,s,"m",b).call(this,e,e=>{e.status=x.SignatureRequestStatus.Rejected})},g=async function(e){return new Promise(t=>{this.hub.once(`${e}:finished`,e=>{t(e)})})},y=async function(e,t,{traceContext:n,actionId:s}){const{id:r,messageParams:i}=e,o=i.origin||I.ORIGIN_METAMASK;return await M(this,a,"f").call(this,{name:"Notification Display",id:s,parentContext:n}),await this.messenger.call("ApprovalController:addRequest",{id:r,origin:o,type:t,requestData:{...i},expectsResult:!0},!0)},b=function(e,t){let n=!1;const{nextState:r}=M(this,s,"m",S).call(this,s=>{const r=s.signatureRequests[e];if(!r)throw new Error(`Signature request with id ${e} not found`);const i=r.status;t(r),n=r.status!==i}),i=r.signatureRequests[e];return n&&H.includes(i.status)&&this.hub.emit(`${e}:finished`,i),i},S=function(e){return this.update(t=>{e(t);const n=Object.values(t.signatureRequests).filter(e=>e.status===x.SignatureRequestStatus.Unapproved),r=M(this,s,"m",v).call(this,n,x.SignatureRequestType.PersonalSign),i=M(this,s,"m",v).call(this,n,x.SignatureRequestType.TypedSign);t.unapprovedPersonalMsgs=r,t.unapprovedTypedMessages=i,t.unapprovedPersonalMsgCount=Object.values(r).length,t.unapprovedTypedMessagesCount=Object.values(i).length})},v=function(e,t){return e.filter(e=>e.type===t).reduce((e,t)=>({...e,[t.id]:{...t,msgParams:t.messageParams}}),{})},w=function(e,t,n,r){const i=M(this,s,"m",E).call(this,e,t);this.messenger.call("LoggingController:add",{type:C.LogType.EthSignLog,data:{signingMethod:i,stage:n,signingData:r}})},E=function(e,t){return e===x.SignatureRequestType.PersonalSign?C.SigningMethod.PersonalSign:e===x.SignatureRequestType.TypedSign&&t===j.SignTypedDataVersion.V3?C.SigningMethod.EthSignTypedDataV3:e===x.SignatureRequestType.TypedSign&&t===j.SignTypedDataVersion.V4?C.SigningMethod.EthSignTypedDataV4:C.SigningMethod.EthSignTypedData},_=function(e){const{networkClientId:t}=e;if(!t)throw new Error("Network client ID not found in request");return this.messenger.call("NetworkController:getNetworkClientById",t).configuration.chainId},T=function(e,t,n){M(this,i,"f")?.call(this)&&M(this,r,"f")&&(M(this,s,"m",b).call(this,e,e=>{e.decodingLoading=!0}),(0,L.decodeSignature)(t,n,M(this,r,"f")).then(t=>M(this,s,"m",b).call(this,e,e=>{e.decodingData=t,e.decodingLoading=!1})).catch(t=>M(this,s,"m",b).call(this,e,e=>{e.decodingData={stateChanges:null,error:{message:t.message,type:L.DECODING_API_ERRORS.DECODING_FAILED_WITH_ERROR}},e.decodingLoading=!1})))},k=function(){const e=this.messenger.call("AccountsController:getState");return Object.values(e.internalAccounts?.accounts??{}).filter(e=>"eip155:eoa"===e.type).map(e=>e.address)}}}},{package:"@metamask/shield-controller>@metamask/signature-controller",file:"node_modules/@metamask/shield-controller/node_modules/@metamask/signature-controller/dist/SignatureController.cjs"}],[2627,{"./SignatureController.cjs":2626,"./types.cjs":2629},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./SignatureController.cjs"),n),r(e("./types.cjs"),n)}}},{package:"@metamask/shield-controller>@metamask/signature-controller",file:"node_modules/@metamask/shield-controller/node_modules/@metamask/signature-controller/dist/index.cjs"}],[2628,{"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const s=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return s.createModuleLogger}}),n.projectLogger=(0,s.createProjectLogger)("signature-controller")}}},{package:"@metamask/shield-controller>@metamask/signature-controller",file:"node_modules/@metamask/shield-controller/node_modules/@metamask/signature-controller/dist/logger.cjs"}],[2629,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a;Object.defineProperty(n,"__esModule",{value:!0}),n.SignatureRequestType=n.SignatureRequestStatus=n.DecodingDataChangeType=n.EthMethod=void 0,function(e){e.PersonalSign="personal_sign",e.SignTransaction="eth_signTransaction",e.SignTypedDataV1="eth_signTypedData_v1",e.SignTypedDataV3="eth_signTypedData_v3",e.SignTypedDataV4="eth_signTypedData_v4"}(s||(n.EthMethod=s={})),function(e){e.Receive="RECEIVE",e.Transfer="TRANSFER",e.Approve="APPROVE",e.Revoke="REVOKE_APPROVE",e.Bidding="BIDDING",e.Listing="LISTING"}(r||(n.DecodingDataChangeType=r={})),function(e){e.Unapproved="unapproved",e.Approved="approved",e.Rejected="rejected",e.InProgress="inProgress",e.Signed="signed",e.Errored="errored"}(i||(n.SignatureRequestStatus=i={})),function(e){e.PersonalSign="personal_sign",e.TypedSign="eth_signTypedData"}(a||(n.SignatureRequestType=a={}))}}},{package:"@metamask/shield-controller>@metamask/signature-controller",file:"node_modules/@metamask/shield-controller/node_modules/@metamask/signature-controller/dist/types.cjs"}],[263,{"./stream-utils":339,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/rpc-errors"),r=e("./stream-utils");n.default=(e,t)=>async n=>{if(!(0,r.isStreamWritable)(t))return;if(!e[n.method])return void t.write({jsonrpc:"2.0",error:s.rpcErrors.methodNotFound({message:`${n.method} not found`}),id:n.id});let i,a;try{i=await e[n.method](...n.params)}catch(e){a=e}(0,r.isStreamWritable)(t)?a?t.write({jsonrpc:"2.0",error:(0,s.serializeError)(a,{shouldIncludeStack:!0}),id:n.id}):t.write({jsonrpc:"2.0",result:i,id:n.id}):a&&console.error(a)}}}},{package:"$root$",file:"app/scripts/lib/createMetaRPCHandler.js"}],[2630,{"../types.cjs":2629,"./normalize.cjs":2632},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeSignature=n.DECODING_API_ERRORS=void 0;const s=e("./normalize.cjs"),r=e("../types.cjs");n.DECODING_API_ERRORS={UNSUPPORTED_SIGNATURE:"UNSUPPORTED_SIGNATURE",DECODING_FAILED_WITH_ERROR:"DECODING_FAILED_WITH_ERROR"},n.decodeSignature=async function(e,t,i){try{const{method:a,origin:o,params:l}=e;if(e.method===r.EthMethod.SignTypedDataV3||e.method===r.EthMethod.SignTypedDataV4){const e=await fetch(`${i}/signature?chainId=${t}`,{method:"POST",body:JSON.stringify({method:a,origin:o,params:[l[0],(0,s.normalizeParam)(l[1])]}),headers:{"Content-Type":"application/json"}});return await e.json()}return{error:{message:"Unsupported signature.",type:n.DECODING_API_ERRORS.UNSUPPORTED_SIGNATURE}}}catch(e){return{error:{message:e.message,type:n.DECODING_API_ERRORS.DECODING_FAILED_WITH_ERROR}}}}}}},{package:"@metamask/shield-controller>@metamask/signature-controller",file:"node_modules/@metamask/shield-controller/node_modules/@metamask/signature-controller/dist/utils/decoding-api.cjs"}],[2631,{"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateExecutionPermissionMetadata=n.decodePermissionFromRequest=n.isDelegationRequest=void 0;const s=e("@metamask/utils");n.isDelegationRequest=function(e){const{primaryType:t}=e;return"Delegation"===t},n.decodePermissionFromRequest=function({origin:e,data:t,messenger:n}){const{metadata:{origin:r,justification:i}}=t;if("number"!=typeof t.domain.chainId)throw new Error("Invalid chainId");const{chainId:a}=t.domain,{delegate:o,delegator:l,authority:c,caveats:u}=t.message;return(0,s.isHexAddress)(o?.toLowerCase())&&(0,s.isHexAddress)(l?.toLowerCase())&&(0,s.isStrictHexString)(c)&&u?n.call("GatorPermissionsController:decodePermissionFromPermissionContextForOrigin",{origin:e,chainId:a,delegation:{delegate:o,delegator:l,caveats:u,authority:c},metadata:{justification:i,origin:r}}):undefined},n.validateExecutionPermissionMetadata=function(e){if(!("metadata"in e))throw new Error("Invalid metadata");const{metadata:t}=e;if(!t||"string"!=typeof t.origin||"string"!=typeof t.justification)throw new Error("Invalid metadata")}}}},{package:"@metamask/shield-controller>@metamask/signature-controller",file:"node_modules/@metamask/shield-controller/node_modules/@metamask/signature-controller/dist/utils/delegations.cjs"}],[2632,{"@metamask/keyring-controller":2183,"@metamask/utils":3070,buffer:4038},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.normalizeParam=n.normalizeTypedMessageParams=n.normalizePersonalMessageParams=void 0;const s=e("@metamask/keyring-controller"),r=e("@metamask/utils");function i(e){try{const t=(0,r.remove0x)(e);if(t.match(/^[0-9A-Fa-f]+$/gu))return(0,r.add0x)(t)}catch(e){}return(0,r.bytesToHex)(t.from(e,"utf8"))}function a(e){if(Array.isArray(e))return e.map(e=>a(e));if("object"==typeof e&&null!==e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=a(e[t]));return e}return e?.toString()??""}n.normalizePersonalMessageParams=function(e){return{...e,data:i(e.data)}},n.normalizeTypedMessageParams=function(e,t){const n={...e};return"string"==typeof e.data||t!==s.SignTypedDataVersion.V3&&t!==s.SignTypedDataVersion.V4||(n.data=JSON.stringify(e.data)),n},n.normalizeParam=function(e){return e?a("string"==typeof e?JSON.parse(e):e):{}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/shield-controller>@metamask/signature-controller",file:"node_modules/@metamask/shield-controller/node_modules/@metamask/signature-controller/dist/utils/normalize.cjs"}],[2633,{"./delegations.cjs":2631,"@metamask/approval-controller":1205,"@metamask/controller-utils":1384,"@metamask/eth-sig-util":1974,"@metamask/keyring-controller":2183,jsonschema:4614},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateTypedSignatureRequest=n.validatePersonalSignatureRequest=n.DELEGATOR_FIELD=n.PRIMARY_TYPE_DELEGATION=void 0;const s=e("@metamask/approval-controller"),r=e("@metamask/controller-utils"),i=e("@metamask/eth-sig-util"),a=e("@metamask/keyring-controller"),o=e("jsonschema"),l=e("./delegations.cjs");function c(e,t){if(!e||"string"!=typeof e||!(0,r.isValidHexAddress)(e))throw new Error(`Invalid "${t}" address: ${e} must be a valid string.`)}n.PRIMARY_TYPE_DELEGATION="Delegation",n.DELEGATOR_FIELD="delegator",n.validatePersonalSignatureRequest=function(e){const{from:t,data:n}=e;if(c(t,"from"),!n||"string"!=typeof n)throw new Error(`Invalid message "data": ${n} must be a valid string.`)},n.validateTypedSignatureRequest=function({currentChainId:e,internalAccounts:t,messageData:r,request:u,version:d,decodedPermission:h}){c(r.from,"from"),d===a.SignTypedDataVersion.V1?function(e){if(!e.data||!Array.isArray(e.data))throw new Error(`Invalid message "data": ${e.data} must be a valid array.`);try{(0,i.typedSignatureHash)(e.data)}catch(e){throw new Error("Expected EIP712 typed data.")}}(r):function({currentChainId:e,internalAccounts:t,messageData:r,request:a,decodedPermission:c}){if(!r.data||Array.isArray(r.data)||"object"!=typeof r.data&&"string"!=typeof r.data)throw new Error('Invalid message "data": Must be a valid string or object.');let u;if("object"==typeof r.data)u=r.data;else try{u=JSON.parse(r.data)}catch(e){throw new Error("Data must be passed as a valid JSON string.")}if((0,o.validate)(u,i.TYPED_MESSAGE_SCHEMA).errors.length>0)throw new Error("Data must conform to EIP-712 schema. See https://git.io/fNtcx.");if(!e)throw new Error("Current chainId cannot be null or undefined.");let{chainId:d}=u.domain;if(d){"string"==typeof d&&(d=parseInt(d,d.startsWith("0x")?16:10));const t=parseInt(e,16);if(Number.isNaN(t))throw new Error(`Cannot sign messages for chainId "${d}", because MetaMask is switching networks.`);if(d!==t)throw new Error(`Provided chainId "${d}" must match the active chainId "${t}"`)}const h=a?.origin??r?.origin;(function({data:e,internalAccounts:t,origin:n}){const r=e?.domain?.verifyingContract,i=n&&n!==s.ORIGIN_METAMASK;if(r&&"string"==typeof r&&i&&t.some(e=>e.toLowerCase()===r.toLowerCase()))throw new Error("External signature requests cannot use internal accounts as the verifying contract.")})({data:u,internalAccounts:t,origin:h}),function({data:e,internalAccounts:t,origin:r,decodedPermission:i}){if(!(0,l.isDelegationRequest)(e))return;const a=i!==undefined;if(!a){const i=r&&r!==s.ORIGIN_METAMASK,a=e.message?.[n.DELEGATOR_FIELD]?.toLowerCase(),o=t.some(e=>e.toLowerCase()===a);if(i&&o)throw new Error("External signature requests cannot sign delegations for internal accounts.")}}({data:u,internalAccounts:t,origin:h,decodedPermission:c})}({currentChainId:e,internalAccounts:t,messageData:r,request:u,decodedPermission:h})}}}},{package:"@metamask/shield-controller>@metamask/signature-controller",file:"node_modules/@metamask/shield-controller/node_modules/@metamask/signature-controller/dist/utils/validation.cjs"}],[264,{"./middleware/pending":286,"@metamask/eth-json-rpc-middleware":1866,"@metamask/json-rpc-engine/v2":2099},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({version:e,getAccounts:t,processTransaction:n,processTypedMessage:a,processTypedMessageV3:o,processTypedMessageV4:l,processPersonalMessage:c,processDecryptMessage:u,processEncryptionPublicKey:d,getPendingNonce:h,getPendingTransactionByHash:p,processRequestExecutionPermissions:m}){const f=r.JsonRpcEngineV2.create({middleware:[(0,r.createScaffoldMiddleware)({eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`}),(0,s.createWalletMiddleware)({getAccounts:t,processTransaction:n,processTypedMessage:a,processTypedMessageV3:o,processTypedMessageV4:l,processPersonalMessage:c,processDecryptMessage:u,processEncryptionPublicKey:d,processRequestExecutionPermissions:m}),(0,i.createPendingNonceMiddleware)({getPendingNonce:h}),(0,i.createPendingTxMiddleware)({getPendingTransactionByHash:p})]});return(0,r.asLegacyMiddleware)(f)};var s=e("@metamask/eth-json-rpc-middleware"),r=e("@metamask/json-rpc-engine/v2"),i=e("./middleware/pending")}}},{package:"$root$",file:"app/scripts/lib/createMetamaskMiddleware.ts"}],[265,{loglevel:4802,"webextension-polyfill":5741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({location:e,registerOnboarding:t}){return async function(n,i,a,o){try{if("wallet_registerOnboarding"!==n.method)return void a();n.tabId&&n.tabId!==r.default.tabs.TAB_ID_NONE?await t(e,n.tabId):s.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),i.result=!0,o()}catch(e){o(e)}}};var s=i(e("loglevel")),r=i(e("webextension-polyfill"));function i(e){return e&&e.__esModule?e:{default:e}}}}},{package:"$root$",file:"app/scripts/lib/createOnboardingMiddleware.js"}],[2654,{"../snaps/Timer.cjs":2676,"../snaps/constants.cjs":2677,"./utils.cjs":2656,"@metamask/base-controller":1311,"@metamask/snaps-rpc-methods":2732,"@metamask/snaps-utils":2902,"@metamask/utils":3070,immer:4572,luxon:4805,nanoid:4993},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function a(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.CronjobController=n.DAILY_TIMEOUT=void 0;const l=e("@metamask/base-controller"),c=e("@metamask/snaps-rpc-methods"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),h=e("immer"),p=e("luxon"),m=e("nanoid"),f=e("./utils.cjs"),g=e("../snaps/constants.cjs"),y=e("../snaps/Timer.cjs");n.DAILY_TIMEOUT=(0,d.inMilliseconds)(24,d.Duration.Hour);const b="CronjobController";var S=new WeakMap,v=new WeakMap,w=new WeakMap,E=new WeakSet,_=new WeakMap,T=new WeakMap,k=new WeakMap,P=new WeakMap,M=new WeakMap;class R extends l.BaseController{constructor({messenger:e,state:t,stateManager:l}){var c,u;super({messenger:e,metadata:{events:{includeInStateLogs:!1,persist:!1,includeInDebugSnapshot:!1,usedInUi:!1}},name:b,state:{events:{},...t,...l.getInitialState()}}),r(c=this,u=E),u.add(c),s(this,S,void 0),s(this,v,void 0),s(this,w,new y.Timer(n.DAILY_TIMEOUT)),s(this,_,e=>{this.unregister(e.id),this.register(e.id)}),s(this,T,e=>{const t=this.get(e.id);o(E,this,x).call(this,t),this.register(e.id)}),s(this,k,e=>{this.unregister(e.id)}),s(this,P,e=>{this.unregister(e.id)}),s(this,M,e=>{this.unregister(e.id),this.register(e.id)}),a(S,this,new Map),a(v,this,l),this.messenger.subscribe("SnapController:snapInstalled",i(_,this)),this.messenger.subscribe("SnapController:snapUninstalled",i(k,this)),this.messenger.subscribe("SnapController:snapEnabled",i(T,this)),this.messenger.subscribe("SnapController:snapDisabled",i(P,this)),this.messenger.subscribe("SnapController:snapUpdated",i(M,this)),this.messenger.registerActionHandler(`${b}:init`,(...e)=>this.init(...e)),this.messenger.registerActionHandler(`${b}:schedule`,(...e)=>this.schedule(...e)),this.messenger.registerActionHandler(`${b}:cancel`,(...e)=>this.cancel(...e)),this.messenger.registerActionHandler(`${b}:get`,(...e)=>this.get(...e))}init(){o(E,this,A).call(this),o(E,this,L).call(this),o(E,this,x).call(this)}schedule(e){return o(E,this,I).call(this,{...e,recurring:!1})}cancel(e,t){(0,d.assert)(this.state.events[t],`A background event with the id of "${t}" does not exist.`),(0,d.assert)(this.state.events[t].snapId===e,"Only the origin that scheduled this event can cancel it."),o(E,this,N).call(this,t)}get(e){return Object.values(this.state.events).filter(t=>t.snapId===e&&!t.recurring).map(e=>({...e,date:(0,u.toCensoredISO8601String)(e.date),scheduledAt:(0,u.toCensoredISO8601String)(e.scheduledAt)}))}register(e){const t=o(E,this,D).call(this,e);null==t||t.forEach(e=>o(E,this,I).call(this,e))}unregister(e){for(const[t,n]of Object.entries(this.state.events))n.snapId===e&&o(E,this,N).call(this,t)}destroy(){super.destroy(),this.messenger.unsubscribe("SnapController:snapInstalled",i(_,this)),this.messenger.unsubscribe("SnapController:snapUninstalled",i(k,this)),this.messenger.unsubscribe("SnapController:snapEnabled",i(T,this)),this.messenger.unsubscribe("SnapController:snapDisabled",i(P,this)),this.messenger.unsubscribe("SnapController:snapUpdated",i(M,this)),i(S,this).forEach(e=>e.cancel()),i(S,this).clear(),"running"===i(w,this).status&&i(w,this).cancel()}}function A(){a(w,this,new y.Timer(n.DAILY_TIMEOUT)),i(w,this).start(()=>{o(E,this,x).call(this),o(E,this,A).call(this)})}function I(e){const t=e.id??(0,m.nanoid)(),n={...e,id:t,date:(0,f.getExecutionDate)(e.schedule),scheduledAt:(new Date).toISOString()},{nextState:s}=this.update(e=>{e.events[n.id]=(0,h.castDraft)(n)});return i(v,this).set(s),o(E,this,j).call(this,n),t}function j(e,t=!0){if(!t)return void o(E,this,C).call(this,e);const n=(0,f.getExecutionDate)(e.schedule),{nextState:s}=this.update(t=>{t.events[e.id].date=n});i(v,this).set(s),o(E,this,C).call(this,{...e,date:n})}function C(e){const t=p.DateTime.fromISO(e.date,{setZone:!0}).toMillis()-Date.now();if(t>n.DAILY_TIMEOUT)return;if(t<=0)return void o(E,this,O).call(this,e);const s=new y.Timer(t);s.start(()=>{o(E,this,O).call(this,e)}),i(S,this).set(e.id,s)}function O(e){if(this.messenger.call("SnapController:handleRequest",{snapId:e.snapId,origin:g.METAMASK_ORIGIN,handler:u.HandlerType.OnCronjob,request:e.request}).catch(t=>{(0,u.logError)(`An error occurred while executing an event for Snap "${e.snapId}":`,t)}),i(S,this).delete(e.id),!e.recurring){const{nextState:t}=this.update(t=>{delete t.events[e.id]});return void i(v,this).set(t)}o(E,this,j).call(this,e)}function N(e){const t=i(S,this).get(e);null==t||t.cancel(),i(S,this).delete(e);const{nextState:n}=this.update(t=>{delete t.events[e]});i(v,this).set(n)}function D(e){const t=this.messenger.call("PermissionController:getPermissions",e),n=null==t?void 0:t[c.SnapEndowments.Cronjob],s=(0,c.getCronjobCaveatJobs)(n);return s?s.map((t,n)=>({snapId:e,id:`cronjob-${e}-${n}`,request:t.request,schedule:(0,f.getCronjobSpecificationSchedule)(t),recurring:!0})):[]}function x(e=Object.values(this.state.events)){const t=Date.now();for(const n of e){if(i(S,this).has(n.id))continue;const e=p.DateTime.fromISO(n.date,{setZone:!0}).toUTC().toMillis();n.recurring&&e<=t?o(E,this,O).call(this,n):o(E,this,j).call(this,n,!1)}}function L(){const e=Date.now();for(const t of Object.values(this.state.events)){const n=p.DateTime.fromISO(t.date,{setZone:!0}).toUTC().toMillis();!t.recurring&&n<e&&o(E,this,N).call(this,t.id)}}n.CronjobController=R}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/CronjobController.cjs"}],[2655,{"./CronjobController.cjs":2654},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./CronjobController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/index.cjs"}],[2656,{"@metamask/utils":3070,"cron-parser":4143,luxon:4805},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getExecutionDate=n.getCronjobSpecificationSchedule=void 0;const s=e("@metamask/utils"),r=e("cron-parser"),i=e("luxon");n.getCronjobSpecificationSchedule=function(e){return(0,s.hasProperty)(e,"duration")?e.duration:e.expression},n.getExecutionDate=function(e){const t=i.DateTime.fromISO(e,{setZone:!0});if(t.isValid){const e=Date.now(),n=t.toUTC().startOf("second");if(n.toMillis()<e)throw new Error("Cannot schedule an event in the past.");return n.toISO({suppressMilliseconds:!0})}const n=i.Duration.fromISO(e);if(n.isValid){const e=function(e){return e.as("seconds")<1?i.Duration.fromObject({seconds:1}):e}(n);return i.DateTime.now().toUTC().plus(e).toISO()}try{const t=(0,r.parseExpression)(e,{utc:!0}).next(),n=i.DateTime.fromJSDate(t.toDate());return(0,s.assert)(n.isValid),n.toUTC().toISO()}catch{throw new Error(`Unable to parse "${e}" as ISO 8601 date, ISO 8601 duration, or cron expression.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/utils.cjs"}],[2657,{"@metamask/utils":3070,"@xstate/fsm":3543},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.forceStrict=n.validateMachine=void 0;const s=e("@metamask/utils"),r=e("@xstate/fsm");n.validateMachine=function(e){(0,s.assert)("_options"in e,"The machine is not an @xstate/fsm machine");const t=e,n=new Set,r=e=>{return(t=e,Array.isArray(t)?t:t===undefined||null===t?[]:[t]).flatMap(e=>"string"==typeof e?[e]:((0,s.assert)("function"==typeof e),[])).forEach(n.add.bind(n));var t};for(const e of Object.values(t.config.states)){r(e.entry),r(e.exit);for(const t of Object.values(e.on??{}))r(t.actions)}n.forEach(e=>(0,s.assert)(t._options.actions!==undefined&&e in t._options.actions,`Action "${e}" doesn't have an implementation`))},n.forceStrict=function(e){let t=!1;e.subscribe(e=>{(0,s.assert)(!t||e.changed,"Invalid state transition"),t=!0});const n=e.send.bind(e);e.send=(...t)=>((0,s.assert)(e.status===r.InterpreterStatus.Running,"Interpreter is stopped"),n(...t))}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/fsm.cjs"}],[2658,{"./cronjob/index.cjs":2655,"./insights/index.cjs":2660,"./interface/index.cjs":2662,"./multichain/index.cjs":2666,"./services/index.cjs":2671,"./snaps/index.cjs":2678,"./utils.cjs":2688,"./websocket/index.cjs":2690},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./services/index.cjs"),n),r(e("./snaps/index.cjs"),n),r(e("./utils.cjs"),n),r(e("./cronjob/index.cjs"),n),r(e("./interface/index.cjs"),n),r(e("./insights/index.cjs"),n),r(e("./multichain/index.cjs"),n),r(e("./websocket/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/index.cjs"}],[2659,{"../snaps/index.cjs":2678,"@metamask/base-controller":1311,"@metamask/snaps-rpc-methods":2732,"@metamask/snaps-utils":2902,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInsightsController=void 0;const i=e("@metamask/base-controller"),a=e("@metamask/snaps-rpc-methods"),o=e("@metamask/snaps-utils"),l=e("@metamask/utils"),c=e("../snaps/index.cjs");var u=new WeakSet;class d extends i.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{insights:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}},name:"SnapInsightsController",state:{insights:{},...t}}),s(this,u),this.messenger.subscribe("TransactionController:unapprovedTransactionAdded",r(u,this,m).bind(this)),this.messenger.subscribe("TransactionController:transactionStatusUpdated",r(u,this,y).bind(this)),this.messenger.subscribe("SignatureController:stateChange",r(u,this,f).bind(this))}}function h(e){return(0,l.hasProperty)(this.state.insights,e)}function p(e){const t=this.messenger.call("SnapController:getAll");return(0,c.getRunnableSnaps)(t).reduce((t,n)=>{const s=this.messenger.call("PermissionController:getPermissions",n.id);return s&&(0,l.hasProperty)(s,e)&&t.push({snapId:n.id,permission:s[e]}),t},[])}function m(e){const{id:t,txParams:n,chainId:s,origin:i}=e,c=`eip155:${(0,l.hexToBigInt)(s).toString(10)}`;r(u,this,p).call(this,a.SnapEndowments.TransactionInsight).forEach(({snapId:e,permission:s})=>{const l=(0,a.getTransactionOriginCaveat)(s)&&i?i:null;this.update(n=>{var s;(s=n.insights)[t]??(s[t]={}),n.insights[t][e]={snapId:e,loading:!0}}),r(u,this,S).call(this,{snapId:e,handler:o.HandlerType.OnTransaction,params:{transaction:n,chainId:c,transactionOrigin:l}}).then(n=>r(u,this,v).call(this,{id:t,snapId:e,response:n})).catch(n=>r(u,this,v).call(this,{id:t,snapId:e,error:n}))})}function f(e){for(const t of Object.keys(this.state.insights))(0,l.hasProperty)(e.unapprovedTypedMessages,t)||(0,l.hasProperty)(e.unapprovedPersonalMsgs,t)||r(u,this,b).call(this,t);if(e.unapprovedPersonalMsgCount>0||e.unapprovedTypedMessagesCount>0){const t=r(u,this,p).call(this,a.SnapEndowments.SignatureInsight);for(const n of Object.values(e.unapprovedPersonalMsgs))r(u,this,g).call(this,t,n);for(const n of Object.values(e.unapprovedTypedMessages))r(u,this,g).call(this,t,n)}}function g(e,t){const{id:n,msgParams:s}=t;if(r(u,this,h).call(this,n))return;const{from:i,data:l,signatureMethod:c,origin:d}=s,p={from:i,data:"eth_signTypedData_v3"===c||"eth_signTypedData_v4"===c?JSON.parse(l):l,signatureMethod:c};e.forEach(({snapId:e,permission:t})=>{const s=(0,a.getSignatureOriginCaveat)(t),i=d&&s?d:null;this.update(t=>{var s;(s=t.insights)[n]??(s[n]={}),t.insights[n][e]={snapId:e,loading:!0}}),r(u,this,S).call(this,{snapId:e,handler:o.HandlerType.OnSignature,params:{signature:p,signatureOrigin:i}}).then(t=>r(u,this,v).call(this,{id:n,snapId:e,response:t})).catch(t=>r(u,this,v).call(this,{id:n,snapId:e,error:t}))})}function y({transactionMeta:e}){"unapproved"!==e.status&&r(u,this,b).call(this,e.id)}function b(e){r(u,this,h).call(this,e)&&(Object.values(this.state.insights[e]).filter(e=>e.interfaceId).forEach(e=>{this.messenger.call("SnapInterfaceController:deleteInterface",e.interfaceId)}),this.update(t=>{delete t.insights[e]}))}async function S({snapId:e,handler:t,params:n}){return this.messenger.call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:t,request:{method:"",params:n}})}function v({id:e,snapId:t,response:n,error:s}){r(u,this,h).call(this,e)&&this.update(r=>{r.insights[e][t].loading=!1,r.insights[e][t].interfaceId=null==n?void 0:n.id,r.insights[e][t].severity=null==n?void 0:n.severity,r.insights[e][t].error=null==s?void 0:s.message})}n.SnapInsightsController=d}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/SnapInsightsController.cjs"}],[266,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,s){t.origin=e.origin,s()}}}}},{package:"$root$",file:"app/scripts/lib/createOriginMiddleware.js"}],[2660,{"./SnapInsightsController.cjs":2659},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./SnapInsightsController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/index.cjs"}],[2661,{"./utils.cjs":2663,"@metamask/base-controller":1311,"@metamask/snaps-sdk":2788,"@metamask/snaps-utils":2902,"@metamask/utils":3070,immer:4572,nanoid:4993},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInterfaceController=void 0;const i=e("@metamask/base-controller"),a=e("@metamask/snaps-sdk"),o=e("@metamask/snaps-utils"),l=e("@metamask/utils"),c=e("immer"),u=e("nanoid"),d=e("./utils.cjs"),h=1e7,p="SnapInterfaceController";var m=new WeakSet;class f extends i.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{interfaces:{includeInStateLogs:!0,persist:e=>Object.entries(e).reduce((e,[t,n])=>n.contentType===a.ContentType.Notification?(e[t]=n,e):e,{}),includeInDebugSnapshot:!1,usedInUi:!0}},name:p,state:{interfaces:{},...t}}),s(this,m),this.messenger.subscribe("NotificationServicesController:notificationsListUpdated",r(m,this,R).bind(this)),r(m,this,g).call(this)}createInterface(e,t,n,s){const i=(0,d.getJsxInterface)(t);r(m,this,M).call(this,i),(0,d.validateInterfaceContext)(n);const a=(0,u.nanoid)(),l=(0,d.constructState)({},i,{getAssetsState:r(m,this,k).bind(this),getAccountByAddress:r(m,this,T).bind(this),getSelectedAccount:r(m,this,E).bind(this),listAccounts:r(m,this,_).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});return this.update(t=>{t.interfaces[a]={snapId:e,content:(0,c.castDraft)(i),state:l,context:n??null,contentType:s??null}}),a}getInterface(e,t){return r(m,this,y).call(this,e,t),this.state.interfaces[t]}updateInterface(e,t,n,s){r(m,this,y).call(this,e,t);const i=(0,d.getJsxInterface)(n);r(m,this,M).call(this,i),(0,d.validateInterfaceContext)(s);const a=this.state.interfaces[t].state,l=(0,d.constructState)(a,i,{getAssetsState:r(m,this,k).bind(this),getAccountByAddress:r(m,this,T).bind(this),getSelectedAccount:r(m,this,E).bind(this),listAccounts:r(m,this,_).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});this.update(e=>{e.interfaces[t].state=l,e.interfaces[t].content=(0,c.castDraft)(i),s&&(e.interfaces[t].context=s)})}deleteInterface(e){this.update(t=>{delete t.interfaces[e]})}updateInterfaceState(e,t){this.update(n=>{n.interfaces[e].state=t})}async resolveInterface(e,t,n){r(m,this,y).call(this,e,t),r(m,this,b).call(this,t),await r(m,this,w).call(this,t,n),this.deleteInterface(t)}}function g(){this.messenger.registerActionHandler(`${p}:createInterface`,this.createInterface.bind(this)),this.messenger.registerActionHandler(`${p}:getInterface`,this.getInterface.bind(this)),this.messenger.registerActionHandler(`${p}:updateInterface`,this.updateInterface.bind(this)),this.messenger.registerActionHandler(`${p}:deleteInterface`,this.deleteInterface.bind(this)),this.messenger.registerActionHandler(`${p}:updateInterfaceState`,this.updateInterfaceState.bind(this)),this.messenger.registerActionHandler(`${p}:resolveInterface`,this.resolveInterface.bind(this))}function y(e,t){const n=this.state.interfaces[t];(0,l.assert)(n!==undefined,`Interface with id '${t}' not found.`),(0,l.assert)(n.snapId===e,`Interface not created by ${e}.`)}function b(e){(0,l.assert)(r(m,this,v).call(this,e),`Approval request with id '${e}' not found.`)}function S(e){return this.messenger.call("PhishingController:testOrigin",e).result}function v(e){return this.messenger.call("ApprovalController:hasRequest",{id:e})}async function w(e,t){await this.messenger.call("ApprovalController:acceptRequest",e,t)}function E(){return this.messenger.call("AccountsController:getSelectedMultichainAccount")}function _(e){const t=this.messenger.call("AccountsController:listMultichainAccounts");return e&&0!==e.length?t.filter(t=>t.scopes.some(t=>(0,d.isMatchingChainId)(t,e))):t}function T(e){const{address:t}=(0,l.parseCaipAccountId)(e);return this.messenger.call("AccountsController:getAccountByAddress",t)}function k(){return this.messenger.call("MultichainAssetsController:getState")}function P(e){return this.messenger.call("SnapController:get",e)}function M(e){const t=(0,o.getJsonSizeUnsafe)(e);(0,l.assert)(t<=h,"A Snap UI may not be larger than 10 MB."),(0,o.validateJsxElements)(e,{isOnPhishingList:r(m,this,S).bind(this),getSnap:r(m,this,P).bind(this),getAccountByAddress:r(m,this,T).bind(this)})}function R(e){const t=e.filter(e=>"snap"===e.type&&(0,l.hasProperty)(e.data,"detailedView")),n=new Set(t.map(e=>e.data.detailedView.interfaceId));this.update(e=>{Object.entries(e.interfaces).forEach(([t,s])=>{s.contentType!==a.ContentType.Notification||n.has(t)||delete e.interfaces[t]})})}n.SnapInterfaceController=f}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/SnapInterfaceController.cjs"}],[2662,{"./SnapInterfaceController.cjs":2661},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./SnapInterfaceController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/index.cjs"}],[2663,{"@metamask/snaps-sdk":2788,"@metamask/snaps-sdk/jsx":2872,"@metamask/snaps-utils":2902,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateInterfaceContext=n.constructState=n.getAccountSelectorStateValue=n.getAssetSelectorStateValue=n.getAccountSelectorDefaultStateValue=n.getDefaultAsset=n.formatAccountSelectorStateValue=n.isMatchingChainId=n.assertNameIsUnique=n.getJsxInterface=n.isStatefulComponent=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/snaps-sdk/jsx"),i=e("@metamask/snaps-utils"),a=e("@metamask/utils"),o=["Input","Dropdown","RadioGroup","FileInput","Checkbox","Selector","AssetSelector","AddressInput","AccountSelector"];function l(e){return o.includes(e.type)}function c(e,t){(0,s.assert)(e[t]===undefined,`Duplicate component names are not allowed, found multiple instances of: "${t}".`)}function u(e,t){return"eip155:0"===e?t.some(e=>{const{namespace:t}=(0,a.parseCaipChainId)(e);return t===a.KnownCaipNamespace.Eip155}):t.includes(e)}function d(e,t){const{id:n,address:s,scopes:r}=e,a=(0,i.createChainIdList)(r,t);return{accountId:n,addresses:(0,i.createAccountList)(s,a)}}function h(e,t,{getAccountByAddress:n,getAssetsState:r}){var i;const{assetsMetadata:o,accountsAssets:l}=r(),c=e.map(e=>(0,a.parseCaipAccountId)(e)).map(({chainId:e})=>e),u=t&&t.length>0?c.filter(e=>t.includes(e)):c,d=null===(i=n(e[0]))||void 0===i?void 0:i.id;(0,s.assert)(d,`Account not found for address: ${e[0]}.`);const h=l[d];if(0===h.length)return null;const p=h.find(e=>{const{chainId:t,assetNamespace:n}=(0,a.parseCaipAssetType)(e);return u.includes(t)&&"slip44"===n});return p?{asset:p,name:o[p].name,symbol:o[p].symbol}:{asset:h[0],name:o[h[0]].name,symbol:o[h[0]].symbol}}function p(e,{getSelectedAccount:t,listAccounts:n,snapOwnsAccount:s}){const{chainIds:r,hideExternalAccounts:i}=e.props,a=t();if((!r||0===r.length||a.scopes.some(e=>u(e,r)))&&(!i||i&&s(a)))return d(a,r);const o=n(r),l=i?o.filter(e=>s(e)):o;return 0===l.length?null:d(l[0],r)}function m(e,t){if(!e)return null;const{assetsMetadata:n}=t(),s=n[e];return s?{asset:e,name:s.name??s.symbol??"Unknown",symbol:s.symbol??"Unknown"}:null}function f(e,{getAccountByAddress:t,snapOwnsAccount:n}){const{value:s,hideExternalAccounts:r}=e.props;if(!s)return null;const i=t(s);return i?r&&!n(i)?null:d(i,e.props.chainIds):null}function g(e,t,n,s){const r=s?e[s]:e,o=null==r?void 0:r[t.props.name];return"FileInput"===t.type?o??null:function(e,t){switch(e.type){case"Checkbox":return e.props.checked;case"AssetSelector":return m(e.props.value,t.getAssetsState);case"AddressInput":{if(!e.props.value)return null;const{namespace:t,reference:n}=(0,a.parseCaipChainId)(e.props.chainId);return(0,a.toCaipAccountId)(t,n,e.props.value)}case"AccountSelector":return f(e,t);default:return e.props.value}}(t,n)??o??function(e,t){switch(e.type){case"Dropdown":var n;return null===(n=(0,i.getJsxChildren)(e)[0])||void 0===n?void 0:n.props.value;case"RadioGroup":var s;return null===(s=(0,i.getJsxChildren)(e)[0])||void 0===s?void 0:s.props.value;case"Selector":var r;return null===(r=(0,i.getJsxChildren)(e)[0])||void 0===r?void 0:r.props.value;case"AccountSelector":return p(e,t);case"Checkbox":return!1;case"AssetSelector":return h(e.props.addresses,e.props.chainIds,t);default:return null}}(t,n)??null}n.isStatefulComponent=l,n.getJsxInterface=function(e){return(0,r.isJSXElementUnsafe)(e)?e:(0,i.getJsxElementFromComponent)(e)},n.assertNameIsUnique=c,n.isMatchingChainId=u,n.formatAccountSelectorStateValue=d,n.getDefaultAsset=h,n.getAccountSelectorDefaultStateValue=p,n.getAssetSelectorStateValue=m,n.getAccountSelectorStateValue=f,n.constructState=function(e,t,n){const s={},r=[];return(0,i.walkJsx)(t,(t,i)=>{let a=r[r.length-1];if(a&&i<=a.depth&&(r.pop(),a=r[r.length-1]),"Form"===t.type)return c(s,t.props.name),r.push({name:t.props.name,depth:i}),void(s[t.props.name]={});if(a&&l(t)){const r=s[a.name];return c(r,t.props.name),void(r[t.props.name]=g(e,t,n,a.name))}l(t)&&(c(s,t.props.name),s[t.props.name]=g(e,t,n))}),s};const y=5e6;n.validateInterfaceContext=function(e){if(!e)return;const t=(0,i.getJsonSizeUnsafe)(e);(0,s.assert)(t<=y,"A Snap interface context may not be larger than 5 MB.")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/utils.cjs"}],[2664,{"@metamask/snaps-utils":2902,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.log=void 0;const s=e("@metamask/snaps-utils"),r=e("@metamask/utils");n.log=(0,r.createModuleLogger)(s.snapsLogger,"snaps-controllers")}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/logging.cjs"}],[2665,{"../snaps/index.cjs":2678,"@metamask/rpc-errors":2594,"@metamask/snaps-rpc-methods":2732,"@metamask/snaps-utils":2902,"@metamask/utils":3070,nanoid:4993},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(l(e,t))}function o(e,t,n){return e.set(l(e,t),n),n}function l(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainRouter=void 0;const c=e("@metamask/rpc-errors"),u=e("@metamask/snaps-rpc-methods"),d=e("@metamask/snaps-utils"),h=e("@metamask/utils"),p=e("nanoid"),m=e("../snaps/index.cjs"),f="MultichainRouter";var g=new WeakMap,y=new WeakMap,b=new WeakSet;async function S(e,t,n){try{const s=await a(y,this).call(this,async({keyring:s})=>s.resolveAccountAddress(e,t,n)),r=null==s?void 0:s.address;return r?(0,h.parseCaipAccountId)(r).address:null}catch{throw c.rpcErrors.internal()}}async function v(e,t,n){const s=a(g,this).call("AccountsController:listMultichainAccounts",t).filter(e=>{var t;return Boolean(null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled)&&e.methods.includes(n.method)});if(0===s.length)return null;const r=s[0].metadata.snap.id,i=await l(b,this,S).call(this,r,t,n),o=e.map(e=>(0,h.parseCaipAccountId)(e).address),u=s.find(e=>o.includes(e.address)&&(!i||e.address===i));if(!u)throw c.rpcErrors.invalidParams({message:"No available account found for request."});return u.id}function w(e){const t=a(g,this).call("SnapController:getAll");return(0,m.getRunnableSnaps)(t).reduce((t,n)=>{const s=a(g,this).call("PermissionController:getPermissions",n.id);if(s&&(0,h.hasProperty)(s,u.SnapEndowments.Protocol)){const r=s[u.SnapEndowments.Protocol],i=(0,u.getProtocolCaveatScopes)(r);i&&(0,h.hasProperty)(i,e)&&t.push({snapId:n.id,methods:i[e].methods})}return t},[])}function E(e){return a(g,this).call("AccountsController:listMultichainAccounts",e).filter(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})}n.MultichainRouter=class{constructor({messenger:e,withSnapKeyring:t}){var n,l;r(n=this,l=b),l.add(n),i(this,"name",f),i(this,"state",null),s(this,g,void 0),s(this,y,void 0),o(g,this,e),o(y,this,t),a(g,this).registerActionHandler(`${f}:handleRequest`,async(...e)=>this.handleRequest(...e)),a(g,this).registerActionHandler(`${f}:getSupportedMethods`,(...e)=>this.getSupportedMethods(...e)),a(g,this).registerActionHandler(`${f}:getSupportedAccounts`,(...e)=>this.getSupportedAccounts(...e)),a(g,this).registerActionHandler(`${f}:isSupportedScope`,(...e)=>this.isSupportedScope(...e))}async handleRequest({connectedAddresses:e,origin:t,scope:n,request:s}){(0,h.assert)(!n.startsWith(h.KnownCaipNamespace.Eip155)&&!n.startsWith("wallet:eip155"));const r={jsonrpc:"2.0",id:s.id??(0,p.nanoid)(),method:s.method,...s.params?{params:s.params}:{}},{method:i,params:o}=r,u=await l(b,this,v).call(this,e,n,r);if(u)return a(y,this).call(this,async({keyring:e})=>e.submitRequest({origin:t,account:u,scope:n,method:i,params:o}));const m=l(b,this,w).call(this,n).find(e=>e.methods.includes(i));if(m)return a(g,this).call("SnapController:handleRequest",{snapId:m.snapId,origin:t,request:{method:"",params:{request:r,scope:n}},handler:d.HandlerType.OnProtocolRequest});throw c.rpcErrors.methodNotFound()}getSupportedMethods(e){const t=l(b,this,E).call(this,e).flatMap(e=>e.methods),n=l(b,this,w).call(this,e).flatMap(e=>e.methods);return Array.from(new Set([...t,...n]))}getSupportedAccounts(e){return l(b,this,E).call(this,e).map(t=>`${e}:${t.address}`)}isSupportedScope(e){return a(g,this).call("AccountsController:listMultichainAccounts",e).some(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})||l(b,this,w).call(this,e).length>0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/MultichainRouter.cjs"}],[2666,{"./MultichainRouter.cjs":2665},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./MultichainRouter.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/index.cjs"}],[2667,{"../logging.cjs":2664,"../snaps/Timer.cjs":2676,"../utils.cjs":2688,"@metamask/json-rpc-engine":2089,"@metamask/json-rpc-middleware-stream":2102,"@metamask/object-multiplex":2359,"@metamask/rpc-errors":2594,"@metamask/snaps-utils":2902,"@metamask/utils":3070,nanoid:4993,"readable-stream":2706},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(l(e,t))}function o(e,t,n){return e.set(l(e,t),n),n}function l(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var c=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.setupMultiplex=n.AbstractExecutionService=void 0;const u=e("@metamask/json-rpc-engine"),d=e("@metamask/json-rpc-middleware-stream"),h=c(e("@metamask/object-multiplex")),p=e("@metamask/rpc-errors"),m=e("@metamask/snaps-utils"),f=e("@metamask/utils"),g=e("nanoid"),y=e("readable-stream"),b=e("../logging.cjs"),S=e("../snaps/Timer.cjs"),v=e("../utils.cjs"),w="ExecutionService";var E=new WeakMap,_=new WeakMap,T=new WeakMap,k=new WeakMap,P=new WeakMap,M=new WeakMap,R=new WeakMap,A=new WeakMap,I=new WeakSet;function j(){a(k,this).registerActionHandler(`${w}:handleRpcRequest`,async(e,t)=>this.handleRpcRequest(e,t)),a(k,this).registerActionHandler(`${w}:executeSnap`,async e=>this.executeSnap(e)),a(k,this).registerActionHandler(`${w}:terminateSnap`,async e=>this.terminateSnap(e)),a(k,this).registerActionHandler(`${w}:terminateAllSnaps`,async()=>this.terminateAllSnaps())}async function C(e,t){const{streams:n,worker:s}=await l(I,this,O).call(this,e,t),r=new u.JsonRpcEngine,i=(0,d.createStreamMiddleware)();(0,y.pipeline)(i.stream,n.command,i.stream,e=>{var t;!e||null!==(t=e.message)&&void 0!==t&&t.match("Premature close")||(0,m.logError)("Command stream failure.",e)}),r.push(i.middleware);const o={id:e,streams:n,rpcEngine:r,worker:s};return a(E,this).set(e,o),o}async function O(e,t){const n=await(0,v.withTimeout)(this.initEnvStream(e),t);if(n===v.hasTimedOut){this.terminateJob({id:e});if("created"===a(_,this).get(e))throw new Error(`The executor for "${e}" couldn't start initialization. The offscreen document may not exist.`);throw new Error(`The executor for "${e}" failed to initialize. The iframe/webview/worker failed to load.`)}const{worker:s,stream:r}=n,i=D(r,`Snap: "${e}"`),o=i.createStream(m.SNAP_STREAM_NAMES.COMMAND),l=t=>{(0,f.hasProperty)(t,"id")||("OutboundRequest"===t.method?a(k,this).publish("ExecutionService:outboundRequest",e):"OutboundResponse"===t.method?a(k,this).publish("ExecutionService:outboundResponse",e):"UnhandledError"===t.method?(a(k,this).publish("ExecutionService:unhandledError",e,t.params.error),o.removeListener("data",l)):(0,m.logError)(new Error(`Received unexpected command stream notification "${t.method}".`)))};o.on("data",l);const c=i.createStream(m.SNAP_STREAM_NAMES.JSON_RPC);c.on("data",t=>{null!=t&&t.data&&(0,f.hasProperty)(null==t?void 0:t.data,"id")&&a(k,this).publish("ExecutionService:outboundRequest",e)});const u=c.write.bind(c);return c.write=(t,n,s)=>{var r;return"metamask_chainChanged"===(null==t||null===(r=t.data)||void 0===r?void 0:r.method)||(null!=t&&t.data&&(0,f.hasProperty)(null==t?void 0:t.data,"id")&&a(k,this).publish("ExecutionService:outboundResponse",e),u(t,n,s))},{streams:{command:o,rpc:c,_connection:r},worker:s}}async function N(e,t){const n=a(E,this).get(e);if(!n)throw new Error(`"${e}" is not currently running.`);(0,b.log)("Parent: Sending Command",t);const s=await n.rpcEngine.handle(t);if((0,f.hasProperty)(s,"error")){const e=s.error;throw new p.JsonRpcError(e.code,e.message,e.data)}return s.result}function D(e,t){const n=new h.default;return(0,y.pipeline)(e,n,e,e=>{var n;!e||null!==(n=e.message)&&void 0!==n&&n.match("Premature close")||(0,m.logError)(`"${t}" stream failure.`,e)}),n}n.AbstractExecutionService=class{constructor({setupSnapProvider:e,messenger:t,initTimeout:n=(0,f.inMilliseconds)(60,f.Duration.Second),pingTimeout:a=(0,f.inMilliseconds)(2,f.Duration.Second),terminationTimeout:c=(0,f.inMilliseconds)(1,f.Duration.Second),usePing:u=!0}){var d,h;r(d=this,h=I),h.add(d),i(this,"name",w),i(this,"state",null),s(this,E,void 0),s(this,_,void 0),s(this,T,void 0),s(this,k,void 0),s(this,P,void 0),s(this,M,void 0),s(this,R,void 0),s(this,A,void 0),o(E,this,new Map),o(_,this,new Map),o(T,this,e),o(k,this,t),o(P,this,n),o(M,this,a),o(R,this,c),o(A,this,u),l(I,this,j).call(this)}async terminateSnap(e){const t=a(E,this).get(e);if(t){try{const t=await(0,v.withTimeout)(l(I,this,N).call(this,e,{jsonrpc:"2.0",method:"terminate",params:[],id:(0,g.nanoid)()}),a(R,this));t!==v.hasTimedOut&&"OK"===t||(0,m.logWarning)(`Snap "${e}" failed to terminate gracefully.`)}catch{}Object.values(t.streams).forEach(e=>{try{e.destroyed||e.destroy()}catch(e){(0,m.logError)("Error while destroying stream",e)}}),this.terminateJob(t),a(E,this).delete(e),a(_,this).delete(e),(0,b.log)(`Snap "${e}" terminated.`)}}setSnapStatus(e,t){a(_,this).set(e,t)}async terminateAllSnaps(){await Promise.all([...a(E,this).keys()].map(async e=>this.terminateSnap(e)))}async executeSnap({snapId:e,sourceCode:t,endowments:n}){if(a(E,this).has(e))throw new Error(`"${e}" is already running.`);this.setSnapStatus(e,"created");const s=new S.Timer(a(P,this)),r=await l(I,this,C).call(this,e,s);if(a(A,this)){if(await(0,v.withTimeout)(l(I,this,N).call(this,r.id,{jsonrpc:"2.0",method:"ping",id:(0,g.nanoid)()}),a(M,this))===v.hasTimedOut)throw new Error(`The executor for "${e}" was unreachable. The executor did not respond in time.`)}const i=r.streams.rpc;a(T,this).call(this,e,i);const o=Math.max(s.remaining,a(P,this)/2);this.setSnapStatus(e,"initialized");const c={jsonrpc:"2.0",method:"executeSnap",params:{snapId:e,sourceCode:t,endowments:n},id:(0,g.nanoid)()};(0,f.assertIsJsonRpcRequest)(c),this.setSnapStatus(e,"executing");const u=await(0,v.withTimeout)(l(I,this,N).call(this,r.id,c),o);if(u===v.hasTimedOut)throw new Error(`${e} failed to start.`);return"OK"===u&&this.setSnapStatus(e,"running"),u}async handleRpcRequest(e,t){const{handler:n,request:s,origin:r}=t;return await l(I,this,N).call(this,e,{id:(0,g.nanoid)(),jsonrpc:"2.0",method:"snapRpc",params:{origin:r,handler:n,request:s,target:e}})}},n.setupMultiplex=D}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/AbstractExecutionService.cjs"}],[2668,{"@metamask/post-message-stream":2423},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function a(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyPostMessageStream=void 0;const l=e("@metamask/post-message-stream");var c=new WeakMap,u=new WeakMap,d=new WeakSet;class h extends l.BasePostMessageStream{constructor({stream:e,jobId:t}){var n,l;super(),r(n=this,l=d),l.add(n),s(this,c,void 0),s(this,u,void 0),a(c,this,e),a(u,this,t),i(c,this).on("data",o(d,this,p).bind(this))}_postMessage(e){i(c,this).write({jobId:i(u,this),data:e})}}function p(e){e.jobId===i(u,this)&&this.push(e.data)}n.ProxyPostMessageStream=h}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/ProxyPostMessageStream.cjs"}],[2669,{"../AbstractExecutionService.cjs":2667,"@metamask/post-message-stream":2423,"@metamask/snaps-utils":2902},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IframeExecutionService=void 0;const r=e("@metamask/post-message-stream"),i=e("@metamask/snaps-utils"),a=e("../AbstractExecutionService.cjs");class o extends a.AbstractExecutionService{constructor({iframeUrl:e,messenger:t,setupSnapProvider:n,...r}){super({...r,messenger:t,setupSnapProvider:n}),s(this,"iframeUrl",void 0),this.iframeUrl=e}terminateJob(e){var t;null===(t=document.getElementById(e.id))||void 0===t||t.remove()}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=await(0,i.createWindow)({uri:this.iframeUrl.toString(),id:e});return{worker:t,stream:new r.WindowPostMessageStream({name:"parent",target:"child",targetWindow:t,targetOrigin:"*"})}}}n.IframeExecutionService=o}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/IframeExecutionService.cjs"}],[267,{"../../../shared/constants/app":5753,"@metamask/rpc-errors":2594},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SPAM_FILTER_ACTIVATED_ERROR=n.REJECTION_THRESHOLD_IN_MS=n.NUMBER_OF_REJECTIONS_THRESHOLD=n.BLOCKING_THRESHOLD_IN_MS=n.BLOCKABLE_METHODS=void 0,n.default=function({getThrottledOriginState:e,updateThrottledOriginState:t}){return function(n,s,r,h){const{method:p,origin:m}=n;if(!l.has(p)||c.includes(m))return void r();!function(e){if(!e)return!1;const t=Date.now(),{rejections:n,lastRejection:s}=e,r=t-s<=o;return n>=i&&r}(e(m))?r(n=>{if("error"in s&&s.error&&d(s.error)){var r;const i=null===(r=s.error)||void 0===r?void 0:r.data;if("rejectAllApprovals"===(null==i?void 0:i.cause))return void n();const o=e(m)||{rejections:0,lastRejection:0},l=Date.now(),c=l-o.lastRejection<a?o.rejections+1:1;t(m,{rejections:c,lastRejection:l})}else{const n=e(m);Boolean(n)&&t(m,{rejections:0,lastRejection:0})}n()}):h(u)}};var s=e("@metamask/rpc-errors"),r=e("../../../shared/constants/app");const i=n.NUMBER_OF_REJECTIONS_THRESHOLD=3,a=n.REJECTION_THRESHOLD_IN_MS=3e4,o=n.BLOCKING_THRESHOLD_IN_MS=6e4,l=n.BLOCKABLE_METHODS=new Set([r.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN,r.MESSAGE_TYPE.ETH_SEND_TRANSACTION,r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA,r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1,r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3,r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4,r.MESSAGE_TYPE.PERSONAL_SIGN,r.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,r.MESSAGE_TYPE.WALLET_SEND_CALLS,r.MESSAGE_TYPE.WATCH_ASSET]),c=["http://127.0.0.1:8080","http://127.0.0.1:8081","http://127.0.0.1:8082","http://localhost:8080","http://localhost:8081","http://localhost:8082"],u=n.SPAM_FILTER_ACTIVATED_ERROR=s.providerErrors.unauthorized("Request blocked due to spam filter."),d=e=>e.code===s.errorCodes.provider.userRejectedRequest}}},{package:"$root$",file:"app/scripts/lib/createOriginThrottlingMiddleware.ts"}],[2670,{"./IframeExecutionService.cjs":2669},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./IframeExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/index.cjs"}],[2671,{"./AbstractExecutionService.cjs":2667,"./ProxyPostMessageStream.cjs":2668,"./iframe/index.cjs":2670,"./offscreen/index.cjs":2673},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./AbstractExecutionService.cjs"),n),r(e("./ProxyPostMessageStream.cjs"),n),r(e("./iframe/index.cjs"),n),r(e("./offscreen/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/index.cjs"}],[2672,{"../proxy/ProxyExecutionService.cjs":2674,"@metamask/post-message-stream":2423},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.OffscreenExecutionService=void 0;const i=e("@metamask/post-message-stream"),a=e("../proxy/ProxyExecutionService.cjs");var o=new WeakMap;class l extends a.ProxyExecutionService{constructor({messenger:e,setupSnapProvider:t,offscreenPromise:n,...a}){var l,c,u;super({...a,messenger:e,setupSnapProvider:t,stream:new i.BrowserRuntimePostMessageStream({name:"parent",target:"child"})}),s(this,o,void 0),c=this,u=n,(l=o).set(r(l,c),u)}async initEnvStream(e){var t,n;return await(t=o,n=this,t.get(r(t,n))),await super.initEnvStream(e)}}n.OffscreenExecutionService=l}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/OffscreenExecutionService.cjs"}],[2673,{"./OffscreenExecutionService.cjs":2672},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./OffscreenExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/index.cjs"}],[2674,{"../AbstractExecutionService.cjs":2667,"../ProxyPostMessageStream.cjs":2668,nanoid:4993},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyExecutionService=void 0;const a=e("nanoid"),o=e("../AbstractExecutionService.cjs"),l=e("../ProxyPostMessageStream.cjs");var c=new WeakMap;class u extends o.AbstractExecutionService{constructor({stream:e,messenger:t,setupSnapProvider:n,...r}){var a,o,l;super({...r,messenger:t,setupSnapProvider:n,usePing:!1}),s(this,c,void 0),o=this,l=e,(a=c).set(i(a,o),l)}async terminateJob(e){r(c,this).write({jobId:e.id,data:{jsonrpc:"2.0",method:"terminateJob",id:(0,a.nanoid)()}})}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=new l.ProxyPostMessageStream({stream:r(c,this),jobId:e});return await new Promise(e=>{t.once("data",e),t.write({name:"command",data:{jsonrpc:"2.0",method:"ping",id:(0,a.nanoid)()}})}),{worker:e,stream:t}}}n.ProxyExecutionService=u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/proxy/ProxyExecutionService.cjs"}],[2675,{"../fsm.cjs":2657,"../logging.cjs":2664,"../utils.cjs":2688,"./Timer.cjs":2676,"./constants.cjs":2677,"./location/index.cjs":2680,"./registry/index.cjs":2684,"./selectors.cjs":2687,"@metamask/approval-controller":1205,"@metamask/base-controller":1311,"@metamask/permission-controller":2401,"@metamask/rpc-errors":2594,"@metamask/snaps-rpc-methods":2732,"@metamask/snaps-sdk":2788,"@metamask/snaps-utils":2902,"@metamask/utils":3070,"@xstate/fsm":3543,"async-mutex":3860,nanoid:4993,semver:5561},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(l(e,t))}function o(e,t,n){return e.set(l(e,t),n),n}function l(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapController=n.SNAP_APPROVAL_RESULT=n.SNAP_APPROVAL_UPDATE=n.SNAP_APPROVAL_INSTALL=n.controllerName=void 0;const c=e("@metamask/approval-controller"),u=e("@metamask/base-controller"),d=e("@metamask/permission-controller"),h=e("@metamask/rpc-errors"),p=e("@metamask/snaps-rpc-methods"),m=e("@metamask/snaps-sdk"),f=e("@metamask/snaps-utils"),g=e("@metamask/utils"),y=e("@xstate/fsm"),b=e("async-mutex"),S=e("nanoid"),v=e("semver"),w=e("./constants.cjs"),E=e("./location/index.cjs"),_=e("./registry/index.cjs"),T=e("./selectors.cjs"),k=e("./Timer.cjs"),P=e("../fsm.cjs"),M=e("../logging.cjs"),R=e("../utils.cjs");n.controllerName="SnapController",n.SNAP_APPROVAL_INSTALL="wallet_installSnap",n.SNAP_APPROVAL_UPDATE="wallet_updateSnap",n.SNAP_APPROVAL_RESULT="wallet_installSnapResult";const A=new Set(["initialPermissions","id","version","enabled","blocked"]),I={snaps:{},snapStates:{},unencryptedSnapStates:{}};function j(e){return Object.keys(e).reduce((t,n)=>(A.has(n)&&(t[n]=e[n]),t),{})}var C=new WeakMap,O=new WeakMap,N=new WeakMap,D=new WeakMap,x=new WeakMap,L=new WeakMap,$=new WeakMap,q=new WeakMap,U=new WeakMap,F=new WeakMap,H=new WeakMap,W=new WeakMap,B=new WeakMap,V=new WeakMap,G=new WeakMap,Y=new WeakMap,K=new WeakMap,z=new WeakMap,J=new WeakMap,Q=new WeakMap,Z=new WeakMap,X=new WeakSet,ee=new WeakMap;class te extends u.BaseController{constructor({closeAllConnections:e,messenger:t,state:c,dynamicPermissions:u=["endowment:caip25","wallet_snap"],environmentEndowmentPermissions:d=[],excludedPermissions:h={},idleTimeCheckInterval:p=(0,g.inMilliseconds)(5,g.Duration.Second),maxIdleTime:y=(0,g.inMilliseconds)(30,g.Duration.Second),maxRequestTime:b=(0,g.inMilliseconds)(60,g.Duration.Second),fetchFunction:S=globalThis.fetch.bind(undefined),featureFlags:v={},detectSnapLocation:_=E.detectSnapLocation,preinstalledSnaps:T=null,encryptor:k,getMnemonicSeed:P,getFeatureFlags:M=()=>({}),clientCryptography:A,trackEvent:j,ensureOnboardingComplete:te}){var ae,oe,le;super({messenger:t,metadata:{snapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},unencryptedSnapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},snaps:{includeInStateLogs:e=>Object.values(e).reduce((e,t)=>{const n={...t};return delete n.sourceCode,delete n.auxiliaryFiles,e[t.id]=n,e},{}),persist:e=>Object.values(e).filter(e=>e.status!==f.SnapStatus.Installing).map(e=>({...e,status:f.SnapStatus.Stopped})).reduce((e,t)=>(e[t.id]=t,e),{}),includeInDebugSnapshot:!1,usedInUi:!0}},name:n.controllerName,state:{...I,...c}}),i(oe=this,le=X),le.add(oe),r(this,C,void 0),r(this,O,void 0),r(this,N,void 0),r(this,D,void 0),r(this,x,void 0),r(this,L,void 0),r(this,$,void 0),r(this,q,void 0),s(this,"maxRequestTime",void 0),r(this,U,void 0),r(this,F,void 0),r(this,H,void 0),r(this,W,void 0),r(this,B,void 0),r(this,V,void 0),r(this,G,void 0),r(this,Y,void 0),r(this,K,void 0),r(this,z,void 0),r(this,J,void 0),r(this,Q,void 0),r(this,Z,void 0),r(this,ee,(0,R.debouncePersistState)((e,t,n)=>{l(X,this,Qe).call(this,e).stateMutex.runExclusive(async()=>{const s=await l(X,this,be).call(this,e,t,n);return n?this.update(t=>{t.snapStates[e]=s}):this.update(t=>{t.unencryptedSnapStates[e]=s})}).catch(f.logError)},w.STATE_DEBOUNCE_TIMEOUT)),o(C,this,e),o(O,this,u),o(N,this,d),o(D,this,h),o(x,this,v),o(L,this,S),o($,this,p),o(q,this,y),this.maxRequestTime=b,o(B,this,_),o(U,this,k),o(F,this,P),o(H,this,M),o(W,this,A),o(z,this,T),this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onOutboundRequest=this._onOutboundRequest.bind(this),this._onOutboundResponse=this._onOutboundResponse.bind(this),o(G,this,new Map),o(V,this,new Map),o(J,this,j),o(Z,this,te),l(X,this,ie).call(this),this.messenger.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.subscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.subscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.subscribe("SnapController:snapInstalled",({id:e},t)=>{l(X,this,at).call(this,t,e,f.HandlerType.OnInstall).catch(t=>{(0,f.logError)(`Error when calling \`onInstall\` lifecycle hook for snap "${e}": ${(0,m.getErrorMessage)(t)}`)})}),this.messenger.subscribe("SnapController:snapUpdated",({id:e},t,n)=>{l(X,this,at).call(this,n,e,f.HandlerType.OnUpdate).catch(t=>{(0,f.logError)(`Error when calling \`onUpdate\` lifecycle hook for snap "${e}": ${(0,m.getErrorMessage)(t)}`)})}),this.messenger.subscribe("KeyringController:lock",l(X,this,ot).bind(this)),l(X,this,ne).call(this),l(X,this,se).call(this),Object.values((null===(ae=this.state)||void 0===ae?void 0:ae.snaps)??{}).forEach(e=>l(X,this,Ze).call(this,e.id)),a(z,this)&&l(X,this,re).call(this,a(z,this)),o(Q,this,(0,R.throttleTracking)((e,t,n,s)=>{const r=this.messenger.call("SnapsRegistry:getMetadata",e);a(J,this).call(this,{event:"Snap Export Used",category:"Snaps",properties:{snap_id:e,export:t,snap_category:null==r?void 0:r.category,success:n,origin:s}})}))}init(){l(X,this,it).call(this,w.METAMASK_ORIGIN,f.HandlerType.OnStart)}async updateRegistry(){await l(X,this,ue).call(this),await this.messenger.call("SnapsRegistry:update");const e=await this.messenger.call("SnapsRegistry:get",Object.values(this.state.snaps).reduce((e,t)=>(e[t.id]={version:t.version,checksum:t.manifest.source.shasum},e),{}));if(await Promise.all(Object.entries(e).map(async([e,{status:t,reason:n}])=>t===_.SnapsRegistryStatus.Blocked?l(X,this,ae).call(this,e,n):l(X,this,oe).call(this,e))),!a(x,this).autoUpdatePreinstalledSnaps)return;await Promise.allSettled(Object.values(this.state.snaps).filter(e=>e.preinstalled).map(async e=>{const t=await l(X,this,Me).call(this,e.id,"*");if("*"!==t&&(0,g.gtVersion)(t,e.version)){const n=a(B,this).call(this,e.id,{versionRange:t,fetch:a(L,this),allowLocal:!1,useNpmProxy:!0});await l(X,this,Pe).call(this,{origin:c.ORIGIN_METAMASK,snapId:e.id,location:n,versionRange:t,automaticUpdate:!0})}}))}_onUnhandledSnapError(e,t){(0,f.logError)(`Unhandled error from "${e}":`,t),this.stopSnap(e,f.SnapStatusEvents.Crash).catch(e=>{(0,f.logError)(e)})}_onOutboundRequest(e){const t=l(X,this,Qe).call(this,e);t.pendingInboundRequests.filter(e=>"running"===e.timer.status).forEach(e=>e.timer.pause()),t.pendingOutboundRequests+=1}_onOutboundResponse(e){const t=l(X,this,Qe).call(this,e);t.pendingOutboundRequests-=1,0===t.pendingOutboundRequests&&t.pendingInboundRequests.filter(e=>"paused"===e.timer.status).forEach(e=>e.timer.resume())}async startSnap(e){await l(X,this,ue).call(this);const t=this.state.snaps[e];if(!t.enabled)throw new Error(`Snap "${e}" is disabled.`);await l(X,this,Ae).call(this,{snapId:e,sourceCode:t.sourceCode})}enableSnap(e){if(this.getExpect(e),this.state.snaps[e].blocked)throw new Error(`Snap "${e}" is blocked and cannot be enabled.`);this.update(t=>{t.snaps[e].enabled=!0}),this.messenger.publish("SnapController:snapEnabled",this.getTruncatedExpect(e))}async disableSnap(e){if(!this.has(e))throw new Error(`Snap "${e}" not found.`);this.update(t=>{t.snaps[e].enabled=!1}),this.isRunning(e)&&await this.stopSnap(e,f.SnapStatusEvents.Stop),this.messenger.publish("SnapController:snapDisabled",this.getTruncatedExpect(e))}async stopSnap(e,t=f.SnapStatusEvents.Stop){const n=l(X,this,Je).call(this,e);if(!n)throw new Error(`The snap "${e}" is not running.`);if(n.stopPromise)return void await n.stopPromise;const{promise:s,resolve:r}=(0,g.createDeferredPromise)();n.stopPromise=s;try{var i;if(this.isRunning(e))null===(i=a(C,this))||void 0===i||i.call(this,e),await l(X,this,pe).call(this,e)}finally{n.lastRequest=null,n.pendingInboundRequests=[],n.pendingOutboundRequests=0,n.stopPromise=null,this.isRunning(e)&&l(X,this,he).call(this,e,t),r()}}async stopAllSnaps(e=f.SnapStatusEvents.Stop){const t=Object.values(this.state.snaps).filter(e=>this.isRunning(e.id)).map(async t=>this.stopSnap(t.id,e));await Promise.allSettled(t)}isRunning(e){return"running"===this.getExpect(e).status}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getExpect(e){const t=this.get(e);return(0,g.assert)(t!==undefined,`Snap "${e}" not found.`),t}getTruncated(e){const t=this.get(e);return t?j(t):null}getTruncatedExpect(e){return j(this.getExpect(e))}async updateSnapState(e,t,n){const s=l(X,this,Qe).call(this,e);n?s.state=t:s.unencryptedState=t,a(ee,this).call(this,e,t,n)}clearSnapState(e,t){const n=l(X,this,Qe).call(this,e);t?n.state=null:n.unencryptedState=null,a(ee,this).call(this,e,null,t)}async getSnapState(e,t){const n=l(X,this,Qe).call(this,e);return await n.getStateMutex.runExclusive(async()=>{const s=t?n.state:n.unencryptedState;if(s!==undefined)return s;const r=t?this.state.snapStates[e]:this.state.unencryptedSnapStates[e];if(null===r||r===undefined)return null;if(!t){const e=JSON.parse(r);return n.unencryptedState=e,e}const i=await l(X,this,ge).call(this,e,r);return n.state=i,i})}async getSnapFile(e,t,n=m.AuxiliaryFileEncoding.Base64){var s;const r=this.getExpect(e),i=(0,f.normalizeRelative)(t),a=null===(s=r.auxiliaryFiles)||void 0===s||null===(s=s.find(e=>e.path===i))||void 0===s?void 0:s.value;if(!a)return null;const o=await(0,f.encodeAuxiliaryFile)(a,n);return(0,g.assert)(o.length<f.MAX_FILE_SIZE,`Failed to encode static file to "${n}": Static files must be less than 64 MB when encoded.`),o}isMinimumPlatformVersion(e,t){const n=this.getExpect(e),{platformVersion:s}=n.manifest;return!!s&&(0,v.gte)(s,t)}async clearState(){const e=Object.keys(this.state.snaps);await this.stopAllSnaps(),e.forEach(e=>l(X,this,Ee).call(this,e)),this.update(e=>{e.snaps={},e.snapStates={},e.unencryptedSnapStates={}}),a(V,this).clear(),a(G,this).clear(),a(z,this)&&l(X,this,re).call(this,a(z,this))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");e.forEach(e=>{const t=this.getExpect(e);(0,g.assert)(!1!==t.removable,`${e} is not removable.`)}),await Promise.all(e.map(async e=>{const t=this.getExpect(e),n=this.getTruncatedExpect(e);await this.disableSnap(e),l(X,this,Ee).call(this,e),l(X,this,we).call(this,e),a(V,this).delete(e),this.update(t=>{delete t.snaps[e],delete t.snapStates[e],delete t.unencryptedSnapStates[e]}),t.status!==f.SnapStatus.Installing&&this.messenger.publish("SnapController:snapUninstalled",n)}))}removeSnapFromSubject(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",e),i=null==r||null===(n=r[p.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===f.SnapCaveatType.SnapIds);if(!i)return;if(Boolean(null===(s=i.value)||void 0===s?void 0:s[t])){const n={...i.value};delete n[t],Object.keys(n).length>0?this.messenger.call("PermissionController:updateCaveat",e,p.WALLET_SNAP_PERMISSION_KEY,f.SnapCaveatType.SnapIds,n):this.messenger.call("PermissionController:revokePermissions",{[e]:[p.WALLET_SNAP_PERMISSION_KEY]})}}revokeDynamicSnapPermissions(e,t){(0,g.assert)(t.every(e=>a(O,this).includes(e)),"Non-dynamic permissions cannot be revoked"),this.messenger.call("PermissionController:revokePermissions",{[e]:t})}incrementActiveReferences(e){l(X,this,Qe).call(this,e).activeReferences+=1}decrementActiveReferences(e){const t=l(X,this,Qe).call(this,e);(0,g.assert)(t.activeReferences>0,"SnapController reference management is in an invalid state."),t.activeReferences-=1}getAllSnaps(){return Object.values(this.state.snaps).map(j)}getRunnableSnaps(){return(0,T.getRunnableSnaps)(this.getAllSnaps())}getPermittedSnaps(e){var t;const n=(null===(t=(this.messenger.call("PermissionController:getPermissions",e)??{})[p.WALLET_SNAP_PERMISSION_KEY])||void 0===t||null===(t=t.caveats)||void 0===t||null===(t=t.find(e=>e.type===f.SnapCaveatType.SnapIds))||void 0===t?void 0:t.value)??{};return Object.keys(n).reduce((e,t)=>{const n=this.get(t),s=this.getTruncated(t);return s&&(null==n?void 0:n.status)!==f.SnapStatus.Installing&&(e[t]=s),e},{})}async installSnaps(e,t){await l(X,this,ue).call(this);const n={},s=Object.keys(t),r=[],i=[];try{for(const[s,{version:o}]of Object.entries(t)){(0,f.assertIsValidSnapId)(s);const[t,c]=(0,f.resolveVersionRange)(o);if(t)throw h.rpcErrors.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${o}".`);const u=a(B,this).call(this,s,{versionRange:c,fetch:a(L,this),allowLocal:a(x,this).allowLocalSnaps,resolveVersion:async e=>a(x,this).requireAllowlist?await l(X,this,Me).call(this,s,e):e}),d=this.has(s)&&!u.shouldAlwaysReload;if(d&&l(X,this,rt).call(this,s,c)){const e=this.getExpect(s);r.push({snapId:s,oldVersion:e.version});let t=l(X,this,Ge).call(this,s);if(t!==undefined)throw new Error("This snap is already being updated.");t=l(X,this,Ye).call(this,s),t.newVersion=c}else d||i.push(s);n[s]=await l(X,this,_e).call(this,e,s,u,c)}i.forEach(t=>this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(t),e,!1)),r.forEach(({snapId:t,oldVersion:n})=>this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(t),n,e,!1)),s.forEach(e=>a(G,this).delete(e))}catch(e){const t=i.filter(e=>this.has(e));await this.removeSnaps(t);const n=[...a(G,this).keys()],s=r.map(({snapId:e})=>e).filter(e=>n.includes(e));throw await l(X,this,ze).call(this,s),e}return n}destroy(){super.destroy(),a(Y,this)&&clearTimeout(a(Y,this)),this.messenger.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.unsubscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.unsubscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.clearEventSubscriptions("SnapController:snapInstalled"),this.messenger.clearEventSubscriptions("SnapController:snapUpdated")}async handleRequest({snapId:e,origin:t,handler:n,request:s}){await l(X,this,ue).call(this);const r=this.get(e);(0,g.assert)(r,`The Snap "${e}" is not installed. Please install it before invoking it.`),(0,g.assert)(t===w.METAMASK_ORIGIN||(0,f.isValidUrl)(t),"'origin' must be a valid URL or 'metamask'.");const i={jsonrpc:"2.0",id:(0,S.nanoid)(),...s};(0,g.assertIsJsonRpcRequest)(i);const a=p.handlerEndowments[n];(0,g.assert)("string"==typeof a||null===a,"'permissionName' must be either a string or null.");const o=this.messenger.call("PermissionController:getPermissions",e);if(!(null===a||o&&(0,g.hasProperty)(o,a)))throw new Error(`Snap "${e}" is not permitted to use "${a}".`);const c=a?o[a]:undefined;if(a===p.SnapEndowments.Rpc||a===p.SnapEndowments.Keyring){(0,g.assert)(c);const n=this.messenger.call("SubjectMetadataController:getSubjectMetadata",t),s=a===p.SnapEndowments.Rpc?(0,p.getRpcCaveatOrigins)(c):(0,p.getKeyringCaveatOrigins)(c);if((0,g.assert)(s),!(0,f.isOriginAllowed)(s,(null==n?void 0:n.subjectType)??d.SubjectType.Website,t))throw new Error(`Snap "${e}" is not permitted to handle requests from "${t}".`)}if(t!==w.METAMASK_ORIGIN&&w.CLIENT_ONLY_HANDLERS.includes(n))throw new Error(`"${n}" can only be invoked by MetaMask.`);if(!r.enabled)throw new Error(`Snap "${e}" is disabled.`);if(r.status===f.SnapStatus.Installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);const u=l(X,this,De).call(this,c),h=l(X,this,Qe).call(this,e);if(h.stopPromise&&await h.stopPromise,!this.isRunning(e)){h.startPromise||(h.startPromise=this.startSnap(e));try{await h.startPromise}finally{h.startPromise=null}}const m=l(X,this,He).call(this,e,n,i),y=new k.Timer(u);l(X,this,Be).call(this,e,m.id,y);const b=this.messenger.call("ExecutionService:handleRpcRequest",e,{origin:t,handler:n,request:m});try{const s=await(0,R.withTimeout)(b,y);if(s===R.hasTimedOut){const t=null!==h.stopPromise||!this.isRunning(e);throw new Error(t?`${e} was stopped and the request was cancelled. This is likely because the Snap crashed.`:`${e} failed to respond to the request in time.`)}await l(X,this,We).call(this,e,n,s);const r=await l(X,this,$e).call(this,e,n,m,s);return l(X,this,Ve).call(this,e,m.id,n,t,!0),r}catch(s){l(X,this,Ve).call(this,e,m.id,n,t,!1);const[r,i]=(0,f.unwrapError)(s),a=null!==h.stopPromise||!this.isRunning(e);throw i||(a||(0,f.logError)(`"${e}" crashed due to an unhandled error:`,r),await this.stopSnap(e,f.SnapStatusEvents.Crash)),r}}setClientActive(e){e?l(X,this,it).call(this,w.METAMASK_ORIGIN,f.HandlerType.OnActive):l(X,this,it).call(this,w.METAMASK_ORIGIN,f.HandlerType.OnInactive)}}function ne(){const e=({snapId:e})=>this.getExpect(e).enabled,t={initial:f.SnapStatus.Installing,states:{[f.SnapStatus.Installing]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e}}},[f.SnapStatus.Updating]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e},[f.SnapStatusEvents.Stop]:f.SnapStatus.Stopped}},[f.SnapStatus.Running]:{on:{[f.SnapStatusEvents.Stop]:f.SnapStatus.Stopped,[f.SnapStatusEvents.Crash]:f.SnapStatus.Crashed}},[f.SnapStatus.Stopped]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e},[f.SnapStatusEvents.Update]:f.SnapStatus.Updating}},[f.SnapStatus.Crashed]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e},[f.SnapStatusEvents.Update]:f.SnapStatus.Updating}}}};o(K,this,(0,y.createMachine)(t)),(0,P.validateMachine)(a(K,this))}function se(){this.messenger.registerActionHandler(`${n.controllerName}:init`,(...e)=>this.init(...e)),this.messenger.registerActionHandler(`${n.controllerName}:clearSnapState`,(...e)=>this.clearSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:get`,(...e)=>this.get(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getSnapState`,async(...e)=>this.getSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:handleRequest`,async(...e)=>this.handleRequest(...e)),this.messenger.registerActionHandler(`${n.controllerName}:has`,(...e)=>this.has(...e)),this.messenger.registerActionHandler(`${n.controllerName}:updateRegistry`,async()=>this.updateRegistry()),this.messenger.registerActionHandler(`${n.controllerName}:updateSnapState`,async(...e)=>this.updateSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:enable`,(...e)=>this.enableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disable`,async(...e)=>this.disableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:remove`,async(...e)=>this.removeSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getPermitted`,(...e)=>this.getPermittedSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:install`,async(...e)=>this.installSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getAll`,(...e)=>this.getAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getRunnableSnaps`,(...e)=>this.getRunnableSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:incrementActiveReferences`,(...e)=>this.incrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:decrementActiveReferences`,(...e)=>this.decrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disconnectOrigin`,(...e)=>this.removeSnapFromSubject(...e)),this.messenger.registerActionHandler(`${n.controllerName}:revokeDynamicPermissions`,(...e)=>this.revokeDynamicSnapPermissions(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getFile`,async(...e)=>this.getSnapFile(...e)),this.messenger.registerActionHandler(`${n.controllerName}:stopAllSnaps`,async(...e)=>this.stopAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:isMinimumPlatformVersion`,(...e)=>this.isMinimumPlatformVersion(...e)),this.messenger.registerActionHandler(`${n.controllerName}:setClientActive`,(...e)=>this.setClientActive(...e))}function re(e){for(const{snapId:n,manifest:s,files:r,removable:i,hidden:a,hideSnapBranding:o}of e){var t;const e=this.get(n),c=e!==undefined,u=c&&(0,g.gtVersion)(s.version,e.version);if(c&&(!u||!0!==e.preinstalled))continue;const d=new f.VirtualFile({path:f.NpmSnapFileNames.Manifest,value:JSON.stringify(s),result:s}),h=r.map(({path:e,value:t})=>new f.VirtualFile({value:t,path:e})),{filePath:m,iconPath:y}=s.source.location.npm,b=h.find(e=>e.path===m),S=y?h.find(e=>e.path===y):undefined;(0,g.assert)(b,"Source code not provided for preinstalled snap."),(0,g.assert)(!y||y&&S,"Icon not provided for preinstalled snap."),(0,g.assert)(s.source.files===undefined,"Auxiliary files are not currently supported for preinstalled snaps.");const v=(null===(t=s.source.locales)||void 0===t?void 0:t.map(e=>h.find(t=>t.path===e)))??[],E=(0,f.getValidatedLocalizationFiles)(v.filter(Boolean));(0,g.assert)(v.length===E.length,"Missing localization files for preinstalled snap.");const _={manifest:d,sourceCode:b,svgIcon:S,auxiliaryFiles:[],localizationFiles:E};l(X,this,je).call(this,{id:n,origin:w.METAMASK_ORIGIN,files:_,removable:i,hidden:a,hideSnapBranding:o,preinstalled:!0});const T=(0,p.processSnapPermissions)(s.initialPermissions);l(X,this,Ce).call(this,T);const{newPermissions:k,unusedPermissions:P}=l(X,this,et).call(this,n,T);l(X,this,st).call(this,{snapId:n,newPermissions:k,unusedPermissions:P}),s.initialConnections&&l(X,this,Se).call(this,n,(null==e?void 0:e.initialConnections)??null,s.initialConnections),this.update(e=>{e.snaps[n].status=f.SnapStatus.Stopped}),l(X,this,Ze).call(this,n),u?this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(n),e.version,w.METAMASK_ORIGIN,!0):this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(n),w.METAMASK_ORIGIN,!0)}}function ie(){o(Y,this,setTimeout(()=>{l(X,this,de).call(this).catch(e=>{(0,f.logError)(e)}),l(X,this,ie).call(this)},a($,this)))}async function ae(e,t){if(this.has(e)){try{this.update(n=>{n.snaps[e].blocked=!0,n.snaps[e].blockInformation=t}),await this.disableSnap(e)}catch(t){(0,f.logError)(`Encountered error when stopping blocked snap "${e}".`,t)}this.messenger.publish(`${n.controllerName}:snapBlocked`,e,t)}}function oe(e){this.has(e)&&this.state.snaps[e].blocked&&(this.update(t=>{t.snaps[e].blocked=!1,delete t.snaps[e].blockInformation}),this.messenger.publish(`${n.controllerName}:snapUnblocked`,e))}async function le(e,{platformVersion:t,...n}){const s=(await this.messenger.call("SnapsRegistry:get",{[e]:n}))[e];var r;if(s.status===_.SnapsRegistryStatus.Blocked)throw new Error(`Cannot install version "${n.version}" of snap "${e}": The version is blocked. ${(null===(r=s.reason)||void 0===r?void 0:r.explanation)??""}`);const i=Object.keys(n.permissions).some(e=>!w.ALLOWED_PERMISSIONS.includes(e));if(a(x,this).requireAllowlist&&i&&s.status!==_.SnapsRegistryStatus.Verified)throw new Error(`Cannot install version "${n.version}" of snap "${e}": ${s.status===_.SnapsRegistryStatus.Unavailable?"The registry is temporarily unavailable.":"The snap is not on the allowlist."}`);l(X,this,Oe).call(this,e,t)}function ce(){(0,g.assert)(!0!==a(x,this).disableSnapInstallation,"Installing Snaps is currently disabled in this version of MetaMask.")}async function ue(){await a(Z,this).call(this);const e=a(H,this).call(this);(0,g.assert)(!0!==e.disableSnaps,"The Snaps platform requires basic functionality to be used. Enable basic functionality in the settings to use the Snaps platform.")}async function de(){const e=[...a(V,this).entries()];return Promise.all(e.filter(([e,t])=>0===t.activeReferences&&0===t.pendingInboundRequests.length&&t.lastRequest&&a(q,this)&&(0,g.timeSince)(t.lastRequest)>a(q,this)).map(async([e])=>this.stopSnap(e,f.SnapStatusEvents.Stop)))}function he(e,t){const{interpreter:n}=l(X,this,Qe).call(this,e);n.send(t),this.update(t=>{t.snaps[e].status=n.state.value})}async function pe(e){await this.messenger.call("ExecutionService:terminateSnap",e),await new Promise(e=>setTimeout(e,1));l(X,this,Qe).call(this,e).pendingInboundRequests.filter(e=>"finished"!==e.timer.status).forEach(e=>e.timer.finish()),await new Promise(e=>setTimeout(e,1)),this.messenger.publish("SnapController:snapTerminated",this.getTruncatedExpect(e))}function me(e,t=l(X,this,Qe).call(this,e)){return null!==t.encryptionKey&&null!==t.encryptionSalt}async function fe({snapId:e,salt:t,useCache:n,keyMetadata:s}){const r=l(X,this,Qe).call(this,e);if(l(X,this,me).call(this,e,r)&&n)return{key:await a(U,this).importKey(r.encryptionKey),salt:r.encryptionSalt};const i=t??a(U,this).generateSalt(),o=await a(F,this).call(this),c=await(0,p.getEncryptionEntropy)({snapId:e,seed:o,cryptographicFunctions:a(W,this)}),u=await a(U,this).keyFromPassword(c,i,!0,s),d=await a(U,this).exportKey(u);return n&&(r.encryptionKey=d,r.encryptionSalt=i),{key:u,salt:i}}async function ge(e,t){try{const n=JSON.parse(t),{salt:s,keyMetadata:r}=n,i=l(X,this,me).call(this,e)||a(U,this).isVaultUpdated(t),{key:o}=await l(X,this,fe).call(this,{snapId:e,salt:s,useCache:i,keyMetadata:r??w.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS});return await a(U,this).decryptWithKey(o,n)}catch{throw h.rpcErrors.internal({message:"Failed to decrypt snap state, the state must be corrupted."})}}async function ye(e,t){const{key:n,salt:s}=await l(X,this,fe).call(this,{snapId:e,useCache:!0}),r=await a(U,this).encryptWithKey(n,t);return r.salt=s,JSON.stringify(r)}async function be(e,t,n){return null===t?null:n?await l(X,this,ye).call(this,e,t):JSON.stringify(t)}function Se(e,t,n){if(t){const s=(0,R.setDiff)(t,n);for(const t of Object.keys(s))this.removeSnapFromSubject(t,e)}for(const t of Object.keys(n))l(X,this,ve).call(this,t,e)}function ve(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",e),i=null==r||null===(n=r[p.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===f.SnapCaveatType.SnapIds);if(Boolean(null==i||null===(s=i.value)||void 0===s?void 0:s[t]))return;if(i)return void this.messenger.call("PermissionController:updateCaveat",e,p.WALLET_SNAP_PERMISSION_KEY,f.SnapCaveatType.SnapIds,{...i.value,[t]:{}});const a={[p.WALLET_SNAP_PERMISSION_KEY]:{caveats:[{type:f.SnapCaveatType.SnapIds,value:{[t]:{}}}]}};this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:a,subject:{origin:e}})}function we(e){const t=this.messenger.call("PermissionController:getSubjectNames");for(const n of t)this.removeSnapFromSubject(n,e)}function Ee(e){this.messenger.call("PermissionController:hasPermissions",e)&&this.messenger.call("PermissionController:revokeAllPermissions",e)}async function _e(e,t,s,r){const i=this.getTruncated(t);if(i&&!s.shouldAlwaysReload)return(0,g.satisfiesVersionRange)(i.version,r)?i:await l(X,this,Pe).call(this,{origin:e,snapId:t,location:s,versionRange:r});l(X,this,ce).call(this);let a=l(X,this,Te).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_INSTALL});this.messenger.publish("SnapController:snapInstallStarted",t,e,!1),i&&this.isRunning(t)&&await this.stopSnap(t,f.SnapStatusEvents.Stop),i&&s.shouldAlwaysReload&&l(X,this,Ee).call(this,t);try{const{sourceCode:i}=await l(X,this,Re).call(this,{origin:e,id:t,location:s,versionRange:r});await l(X,this,Ne).call(this,t,a),a=l(X,this,Te).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT}),await l(X,this,Ae).call(this,{snapId:t,sourceCode:i});const o=this.getTruncatedExpect(t);return l(X,this,ke).call(this,a.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL}),o}catch(s){(0,f.logError)(`Error when adding ${t}.`,s);const r=s instanceof Error?s.message:s.toString();throw l(X,this,ke).call(this,a.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL,error:r}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!1,r),s}}function Te({origin:e,snapId:t,type:n}){const s=(0,S.nanoid)();return{id:s,promise:this.messenger.call("ApprovalController:addRequest",{origin:e,id:s,type:n,requestData:{metadata:{id:s,origin:t,dappOrigin:e},snapId:t},requestState:{loading:!0}},!0)}}function ke(e,t){try{this.messenger.call("ApprovalController:updateRequestState",{id:e,requestState:t})}catch{}}async function Pe({origin:e,snapId:t,location:s,versionRange:r,automaticUpdate:i=!1}){i||l(X,this,ce).call(this),await l(X,this,ue).call(this);const a=this.getExpect(t),{preinstalled:o,removable:c,hidden:u,hideSnapBranding:d}=a;if(o&&!i)throw new Error("Preinstalled Snaps cannot be manually updated.");let m=i?null:l(X,this,Te).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_UPDATE});try{this.messenger.publish("SnapController:snapInstallStarted",t,e,!0);const y=a.manifest,b=await(0,R.fetchSnap)(t,s),{sourceCode:S,manifest:v}=b,w=v.result,E=w.version;if(!(0,g.gtVersion)(E,a.version))throw h.rpcErrors.invalidParams(`Snap "${t}@${a.version}" is already installed. Couldn't update to a version inside requested "${r}" range.`);if(!(0,g.satisfiesVersionRange)(E,r))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${E}" which doesn't satisfy requested version range "${r}".`);await l(X,this,le).call(this,t,{version:E,checksum:w.source.shasum,permissions:w.initialPermissions,platformVersion:w.platformVersion});const _=(0,p.processSnapPermissions)(w.initialPermissions);l(X,this,Ce).call(this,_);const{newPermissions:T,unusedPermissions:k,approvedPermissions:P}=l(X,this,et).call(this,t,_),{newConnections:M,unusedConnections:A,approvedConnections:I}=l(X,this,nt).call(this,t,y.initialConnections??{},w.initialConnections??{});let j,C;if(m){l(X,this,ke).call(this,m.id,{permissions:T,newVersion:w.version,newPermissions:T,approvedPermissions:P,unusedPermissions:k,newConnections:M,unusedConnections:A,approvedConnections:I,loading:!1});const{permissions:s,...r}=await m.promise;j=s,C=r,m=l(X,this,Te).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT})}else(0,g.assert)(i),j=T;this.isRunning(t)&&await this.stopSnap(t,f.SnapStatusEvents.Stop),l(X,this,he).call(this,t,f.SnapStatusEvents.Update),l(X,this,je).call(this,{origin:e,id:t,files:b,removable:c,preinstalled:o,hidden:u,hideSnapBranding:d,isUpdate:!0}),l(X,this,st).call(this,{snapId:t,unusedPermissions:k,newPermissions:j,requestData:C});const O=y.initialConnections??null,N=w.initialConnections??{};l(X,this,Se).call(this,t,O,N);const D=l(X,this,Ge).call(this,t);D!==undefined&&(D.permissions.revoked=k,D.permissions.granted=j,D.permissions.requestData=C,D.previousInitialConnections=O,D.newInitialConnections=N);const x=S.toString();(0,g.assert)("string"==typeof x&&x.length>0,`Invalid source code for snap "${t}".`);try{await l(X,this,Ae).call(this,{snapId:t,sourceCode:x})}catch{throw new Error(`Snap ${t} crashed with updated source code.`)}const L=this.getTruncatedExpect(t);return m&&l(X,this,ke).call(this,m.id,{loading:!1,type:n.SNAP_APPROVAL_UPDATE}),L}catch(s){(0,f.logError)(`Error when updating ${t},`,s);const r=s instanceof Error?s.message:s.toString();throw m&&l(X,this,ke).call(this,m.id,{loading:!1,error:r,type:n.SNAP_APPROVAL_UPDATE}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!0,r),s}}async function Me(e,t){return await this.messenger.call("SnapsRegistry:resolveVersion",e,t)}async function Re(e){const{id:t,location:n,versionRange:s}=e;l(X,this,Ze).call(this,t);const r=l(X,this,Qe).call(this,t);r.installPromise||((0,M.log)(`Adding snap: ${t}`),r.installPromise=(async()=>{const r=await(0,R.fetchSnap)(t,n),i=r.manifest.result;if(!(0,g.satisfiesVersionRange)(i.version,s))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${i.version}" which doesn't satisfy requested version range "${s}".`);await l(X,this,le).call(this,t,{version:i.version,checksum:i.source.shasum,permissions:i.initialPermissions,platformVersion:i.platformVersion});const o=a(x,this).forcePreinstalledSnaps&&(0,R.isLocalSnapId)(t)?{preinstalled:!0,hideSnapBranding:!0,hidden:!1}:{};return l(X,this,je).call(this,{...e,files:r,id:t,...o})})());try{return await r.installPromise}catch(e){throw r.installPromise=null,e}}async function Ae(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const n=l(X,this,Qe).call(this,t),s=await this.messenger.call("ExecutionService:executeSnap",{...e,endowments:await l(X,this,Ie).call(this,t)});return l(X,this,he).call(this,t,f.SnapStatusEvents.Start),n.lastRequest=Date.now(),s}catch(e){throw await l(X,this,pe).call(this,t),e}}async function Ie(e){let t=[];for(const n of a(N,this))if(this.messenger.call("PermissionController:hasPermission",e,n)){const s=await this.messenger.call("PermissionController:getEndowments",e,n);if(s){if(!Array.isArray(s)||s.some(e=>"string"!=typeof e))throw new Error("Expected an array of string endowment names.");t=t.concat(s)}}const n=[...new Set([...f.DEFAULT_ENDOWMENTS,...t])];return n.length<f.DEFAULT_ENDOWMENTS.length+t.length&&(0,f.logError)(`Duplicate endowments found for ${e}. Default endowments should not be requested.`,t),n}function je(e){const{id:t,origin:n,files:s,isUpdate:r=!1,removable:i,preinstalled:o,hidden:c,hideSnapBranding:u}=e,{manifest:h,sourceCode:p,svgIcon:m,auxiliaryFiles:y,localizationFiles:b}=s;(0,f.assertIsSnapManifest)(h.result);const{version:S}=h.result,v=p.toString();(0,g.assert)("string"==typeof v&&v.length>0,`Invalid source code for snap "${t}".`);const w=y.map(e=>((0,g.assert)("string"==typeof e.data.base64),{path:e.path,value:e.data.base64})),E=this.state.snaps[t],_=[...(null==E?void 0:E.versionHistory)??[],{version:S,date:Date.now(),origin:n}],T=b.map(e=>e.result),k={...E,blocked:!1,enabled:!0,removable:i,preinstalled:o,hidden:c,hideSnapBranding:u,id:t,initialConnections:h.result.initialConnections,initialPermissions:h.result.initialPermissions,manifest:h.result,status:a(K,this).config.initial,sourceCode:v,version:S,versionHistory:_,auxiliaryFiles:w,localizationFiles:T};delete k.blockInformation;const{inversePatches:P}=this.update(e=>{e.snaps[t]=k});if(r){const e=l(X,this,Ge).call(this,t);e!==undefined&&(e.statePatches=P)}const{proposedName:M}=(0,f.getLocalizedSnapManifest)(h.result,"en",T);return this.messenger.call("SubjectMetadataController:addSubjectMetadata",{subjectType:d.SubjectType.Snap,name:M,origin:k.id,version:S,svgIcon:(null==m?void 0:m.toString())??null}),{...k,sourceCode:v}}function Ce(e){const t=Object.keys(e),n=Array.from(new Set(Object.values(p.handlerEndowments)));(0,g.assert)(t.some(e=>n.includes(e)),`A snap must request at least one of the following permissions: ${n.filter(e=>null!==e).join(", ")}.`);const s=t.reduce((e,t)=>((0,g.hasProperty)(a(D,this),t)&&e.push(a(D,this)[t]),e),[]);(0,g.assert)(0===s.length,`One or more permissions are not allowed:\n${s.join("\n")}`)}function Oe(e,t){if(t!==undefined&&(0,v.gt)(t,(0,f.getPlatformVersion)())){const n=`The Snap "${e}" requires platform version "${t}" which is greater than the current platform version "${(0,f.getPlatformVersion)()}".`;if(a(x,this).rejectInvalidPlatformVersion)throw new Error(n);(0,f.logWarning)(n)}}async function Ne(e,t){(0,M.log)(`Authorizing snap: ${e}`);const n=this.state.snaps[e],{initialPermissions:s,initialConnections:r}=n;try{const i=(0,p.processSnapPermissions)(s);l(X,this,Ce).call(this,i),l(X,this,ke).call(this,t.id,{loading:!1,connections:r??{},permissions:i});const{permissions:a,...o}=await t.promise;l(X,this,st).call(this,{snapId:e,newPermissions:a,requestData:o}),n.manifest.initialConnections&&l(X,this,Se).call(this,e,null,n.manifest.initialConnections)}finally{l(X,this,Qe).call(this,e).installPromise=null}}function De(e){return(0,p.getMaxRequestTimeCaveat)(e)??this.maxRequestTime}async function xe(e,t,n){return this.messenger.call("SnapInterfaceController:createInterface",e,t,undefined,n)}function Le(e,t){(0,g.assert)(this.messenger.call("SnapInterfaceController:getInterface",e,t))}async function $e(e,t,n,s){switch(t){case f.HandlerType.OnTransaction:case f.HandlerType.OnSignature:case f.HandlerType.OnHomePage:case f.HandlerType.OnSettingsPage:{const t=s;if(t&&(0,g.hasProperty)(t,"content")){const{content:n,...s}=t;return{...s,id:await l(X,this,xe).call(this,e,n)}}return s}case f.HandlerType.OnAssetsLookup:return l(X,this,qe).call(this,e,n,s);case f.HandlerType.OnAssetsConversion:return l(X,this,Ue).call(this,n,s);case f.HandlerType.OnAssetsMarketData:return l(X,this,Fe).call(this,n,s);default:return s}}function qe(e,{params:t},{assets:n}){const s=this.messenger.call("PermissionController:getPermissions",e);(0,g.assert)(s);const r=s[p.SnapEndowments.Assets],i=(0,p.getChainIdsCaveat)(r);(0,g.assert)(i);const{assets:a}=t;return{assets:Object.keys(n).reduce((e,t)=>{const s=t;return i.some(e=>s.startsWith(e))&&a.includes(s)&&(e[s]=n[s]),e},{})}}function Ue({params:e},{conversionRates:t}){const{conversions:n}=e;return{conversionRates:n.reduce((e,n)=>{var s;const r=null===(s=t[n.from])||void 0===s?void 0:s[n.to];var i;r&&(e[i=n.from]??(e[i]={}),e[n.from][n.to]=r);return e},{})}}function Fe({params:e},{marketData:t}){const{assets:n}=e;return{marketData:n.reduce((e,n)=>{var s;const r=null===(s=t[n.asset])||void 0===s?void 0:s[n.unit];var i;r&&(e[i=n.asset]??(e[i]={}),e[n.asset][n.unit]=r);return e},{})}}function He(e,t,n){if(t===f.HandlerType.OnUserInput){(0,g.assert)(n.params&&(0,g.hasProperty)(n.params,"id"));const t=n.params.id,{context:s}=this.messenger.call("SnapInterfaceController:getInterface",e,t);return{...n,params:{...n.params,context:s}}}return n}async function We(e,t,n){switch(t){case f.HandlerType.OnTransaction:(0,g.assertStruct)(n,f.OnTransactionResponseStruct),n&&(0,g.hasProperty)(n,"id")&&l(X,this,Le).call(this,e,n.id);break;case f.HandlerType.OnSignature:(0,g.assertStruct)(n,f.OnSignatureResponseStruct),n&&(0,g.hasProperty)(n,"id")&&l(X,this,Le).call(this,e,n.id);break;case f.HandlerType.OnHomePage:(0,g.assertStruct)(n,f.OnHomePageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&l(X,this,Le).call(this,e,n.id);break;case f.HandlerType.OnSettingsPage:(0,g.assertStruct)(n,f.OnSettingsPageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&l(X,this,Le).call(this,e,n.id);break;case f.HandlerType.OnNameLookup:(0,g.assertStruct)(n,f.OnNameLookupResponseStruct);break;case f.HandlerType.OnAssetsLookup:(0,g.assertStruct)(n,m.OnAssetsLookupResponseStruct);break;case f.HandlerType.OnAssetsConversion:(0,g.assertStruct)(n,f.OnAssetsConversionResponseStruct);break;case f.HandlerType.OnAssetHistoricalPrice:(0,g.assertStruct)(n,f.OnAssetHistoricalPriceResponseStruct);break;case f.HandlerType.OnAssetsMarketData:(0,g.assertStruct)(n,f.OnAssetsMarketDataResponseStruct)}}function Be(e,t,n){const s=l(X,this,Qe).call(this,e);s.pendingInboundRequests.push({requestId:t,timer:n}),s.lastRequest=null}function Ve(e,t,n,s,r){const i=l(X,this,Qe).call(this,e);i.pendingInboundRequests=i.pendingInboundRequests.filter(e=>e.requestId!==t),0===i.pendingInboundRequests.length&&(i.lastRequest=Date.now());const o=this.get(e);if((0,R.isTrackableHandler)(n)&&(null==o||!o.preinstalled))try{a(Q,this).call(this,e,n,r,s)}catch(e){(0,f.logError)(`Error when calling MetaMetrics hook for snap "${null==o?void 0:o.id}": ${(0,m.getErrorMessage)(e)}`)}}function Ge(e){return a(G,this).get(e)}function Ye(e){(0,g.assert)(a(G,this).get(e)===undefined,`Snap "${e}" rollback snapshot already exists.`),a(G,this).set(e,{statePatches:[],permissions:{},newVersion:""});const t=a(G,this).get(e);return(0,g.assert)(t!==undefined,`Snapshot creation failed for ${e}.`),t}async function Ke(e){var t,n;const s=l(X,this,Ge).call(this,e);if(!s)throw new Error("A snapshot does not exist for this snap.");await this.stopSnap(e,f.SnapStatusEvents.Stop),(null===(t=this.get(e))||void 0===t?void 0:t.status)!==f.SnapStatus.Stopped&&l(X,this,he).call(this,e,f.SnapStatusEvents.Stop);const{statePatches:r,permissions:i,previousInitialConnections:o,newInitialConnections:c}=s;null!=r&&r.length&&this.applyPatches(r),(null===(n=this.get(e))||void 0===n?void 0:n.status)!==f.SnapStatus.Stopped&&this.update(t=>{t.snaps[e].status=f.SnapStatus.Stopped}),l(X,this,st).call(this,{snapId:e,unusedPermissions:i.granted,newPermissions:i.revoked,requestData:i.requestData}),l(X,this,Se).call(this,e,c??null,o??{});const u=this.getTruncatedExpect(e);this.messenger.publish("SnapController:snapRolledback",u,s.newVersion),a(G,this).delete(e)}async function ze(e){for(const t of e)await l(X,this,Ke).call(this,t)}function Je(e){return a(V,this).get(e)}function Qe(e){const t=l(X,this,Je).call(this,e);return(0,g.assert)(t!==undefined,`Snap "${e}" runtime data not found`),t}function Ze(e){if(a(V,this).has(e))return;const t=this.get(e),n=(0,y.interpret)(a(K,this));n.start({context:{snapId:e},value:(null==t?void 0:t.status)??a(K,this).config.initial}),(0,P.forceStrict)(n),a(V,this).set(e,{lastRequest:null,startPromise:null,stopPromise:null,installPromise:null,encryptionKey:null,encryptionSalt:null,activeReferences:0,pendingInboundRequests:[],pendingOutboundRequests:0,interpreter:n,stateMutex:new b.Mutex,getStateMutex:new b.Mutex})}function Xe(e,t){return Object.keys(e).reduce((n,s)=>{if(a(O,this).includes(s)){var r;const i=(0,g.hasProperty)(w.DYNAMIC_PERMISSION_DEPENDENCIES,s),a=null===(r=w.DYNAMIC_PERMISSION_DEPENDENCIES[s])||void 0===r?void 0:r.some(e=>(0,g.hasProperty)(t,e));i&&!a||(n[s]=e[s])}return n},t)}function et(e,t){const n=this.messenger.call("PermissionController:getPermissions",e)??{},s=l(X,this,Xe).call(this,n,t),r=(0,R.permissionsDiff)(s,n),i=(0,R.permissionsDiff)(n,s);return{newPermissions:r,unusedPermissions:i,approvedPermissions:(0,R.permissionsDiff)(n,i)}}function tt(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",t),i=null==r||null===(n=r[p.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===f.SnapCaveatType.SnapIds);return Boolean(null==i||null===(s=i.value)||void 0===s?void 0:s[e])}function nt(e,t,n){const s=Object.keys(t).filter(t=>l(X,this,tt).call(this,e,t)).reduce((e,n)=>(e[n]=t[n],e),{}),r=(0,R.setDiff)(n,s),i=(0,R.setDiff)(s,n);return{newConnections:r,unusedConnections:i,approvedConnections:(0,R.setDiff)(s,i)}}function st({snapId:e,unusedPermissions:t={},newPermissions:n={},requestData:s}){const r=Object.keys(t);(0,g.isNonEmptyArray)(r)&&this.messenger.call("PermissionController:revokePermissions",{[e]:r}),(0,g.isNonEmptyArray)(Object.keys(n))&&this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:n,subject:{origin:e},requestData:s})}function rt(e,t){const n=this.getExpect(e);return!(0,g.satisfiesVersionRange)(n.version,t)&&!(0,g.gtRange)(n.version,t)}function it(e,t){const n=this.getRunnableSnaps();for(const{id:s}of n){this.messenger.call("PermissionController:hasPermission",s,p.SnapEndowments.LifecycleHooks)&&l(X,this,at).call(this,e,s,t).catch(e=>{(0,f.logError)(`Error calling lifecycle hook "${t}" for Snap "${s}": ${(0,m.getErrorMessage)(e)}`)})}}async function at(e,t,n){const s=p.handlerEndowments[n];(0,g.assert)(s,"Lifecycle hook must have an endowment.");this.messenger.call("PermissionController:hasPermission",t,s)&&await this.handleRequest({snapId:t,handler:n,origin:e,request:{jsonrpc:"2.0",method:n}})}function ot(){for(const e of a(V,this).values())e.encryptionKey=null,e.encryptionSalt=null,e.state=undefined}n.SnapController=te}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/SnapController.cjs"}],[2676,{"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.Timer=void 0;const r=e("@metamask/utils");n.Timer=class{constructor(e){s(this,"state",void 0),(0,r.assert)(!Number.isNaN(e),new TypeError("Can't start a timer with NaN time")),(0,r.assert)(e>=0,new TypeError("Can't start a timer with negative time")),this.state={value:"stopped",remaining:e}}get status(){return this.state.value}get remaining(){return this.state.remaining}cancel(){(0,r.assert)("paused"===this.status||"running"===this.status,"Tried to cancel a not running Timer"),this.onFinish(!1)}finish(){(0,r.assert)("finished"!==this.status,"Tried to finish a finished Timer."),this.onFinish(!0)}pause(){(0,r.assert)("running"===this.state.value,"Tried to pause a not running Timer");const{callback:e,start:t,timeout:n,remaining:s}=this.state;n!==undefined&&clearTimeout(n),this.state={value:"paused",callback:e,remaining:s-(Date.now()-t)}}start(e){(0,r.assert)("stopped"===this.state.value,"Tried to start an already running Timer");const{remaining:t}=this.state;this.state={value:"paused",remaining:t,callback:e},this.resume()}resume(){(0,r.assert)("paused"===this.state.value,"Tried to resume not paused Timer");const{remaining:e,callback:t}=this.state,n=Date.now();let s;e!==Number.POSITIVE_INFINITY&&(s=setTimeout(()=>this.onFinish(!0),e)),this.state={value:"running",callback:t,remaining:e,start:n,timeout:s}}onFinish(e){(0,r.assert)("running"===this.state.value||"paused"===this.state.value),"running"===this.state.value&&this.state.timeout!==undefined&&clearTimeout(this.state.timeout);const{callback:t,remaining:n}=this.state;this.state={value:"finished",remaining:"running"===this.state.value?n-(Date.now()-this.state.start):n},e&&t()}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/Timer.cjs"}],[2677,{"@metamask/snaps-rpc-methods":2732,"@metamask/snaps-utils":2902},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DYNAMIC_PERMISSION_DEPENDENCIES=n.CLIENT_ONLY_HANDLERS=n.METAMASK_ORIGIN=n.STATE_DEBOUNCE_TIMEOUT=n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS=n.ALLOWED_PERMISSIONS=void 0;const s=e("@metamask/snaps-rpc-methods"),r=e("@metamask/snaps-utils");n.ALLOWED_PERMISSIONS=Object.freeze(["snap_dialog","snap_manageState","snap_notify","snap_getLocale",s.SnapEndowments.Cronjob,s.SnapEndowments.HomePage,s.SnapEndowments.LifecycleHooks,s.SnapEndowments.EthereumProvider,s.SnapEndowments.TransactionInsight,s.SnapEndowments.SignatureInsight]),n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS={algorithm:"PBKDF2",params:{iterations:1e4}},n.STATE_DEBOUNCE_TIMEOUT=500,n.METAMASK_ORIGIN="metamask",n.CLIENT_ONLY_HANDLERS=Object.freeze([r.HandlerType.OnClientRequest,r.HandlerType.OnSignature,r.HandlerType.OnTransaction,r.HandlerType.OnCronjob,r.HandlerType.OnNameLookup,r.HandlerType.OnHomePage,r.HandlerType.OnSettingsPage,r.HandlerType.OnUserInput,r.HandlerType.OnAssetsLookup,r.HandlerType.OnAssetsConversion,r.HandlerType.OnAssetHistoricalPrice,r.HandlerType.OnAssetsMarketData,r.HandlerType.OnWebSocketEvent]),n.DYNAMIC_PERMISSION_DEPENDENCIES=Object.freeze({"endowment:caip25":["endowment:ethereum-provider"]})}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/constants.cjs"}],[2678,{"./SnapController.cjs":2675,"./constants.cjs":2677,"./location/index.cjs":2680,"./registry/index.cjs":2684,"./selectors.cjs":2687},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./constants.cjs"),n),r(e("./location/index.cjs"),n),r(e("./SnapController.cjs"),n),r(e("./selectors.cjs"),n),r(e("./registry/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/index.cjs"}],[2679,{"@metamask/snaps-utils":2902,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.HttpLocation=void 0;const r=e("@metamask/snaps-utils"),i=e("@metamask/utils");n.HttpLocation=class{constructor(e,t={}){s(this,"cache",new Map),s(this,"validatedManifest",void 0),s(this,"url",void 0),s(this,"fetchFn",void 0),s(this,"fetchOptions",void 0),(0,i.assertStruct)(e.toString(),r.HttpSnapIdStruct,"Invalid Snap Id: "),this.fetchFn=t.fetch??globalThis.fetch.bind(undefined),this.fetchOptions=t.fetchOptions,this.url=e}async manifest(){if(this.validatedManifest)return this.validatedManifest.clone();const e=new URL(r.NpmSnapFileNames.Manifest,this.url).toString(),t=await this.fetchFn(e,this.fetchOptions);if(!t.ok)throw new Error(`Failed to fetch "${e}". Status code: ${t.status}.`);const n=await t.text(),s=(0,r.parseJson)(n),i=new r.VirtualFile({value:n,result:(0,r.createSnapManifest)(s),path:r.NpmSnapFileNames.Manifest,data:{canonicalPath:e}});return this.validatedManifest=i,this.manifest()}async fetch(e){const t=(0,r.normalizeRelative)(e),n=this.cache.get(t);if(n!==undefined)return n.clone();const s=this.toCanonical(t).toString(),a=await this.fetchFn(s,this.fetchOptions);if(!a.ok)throw new Error(`Failed to fetch "${s}". Status code: ${a.status}.`);const o=await a.arrayBuffer(),l=new r.VirtualFile({value:new Uint8Array(o),path:t,data:{canonicalPath:s}});return(0,i.assert)(!this.cache.has(t),"Corrupted cache, multiple files with same path."),this.cache.set(t,l),this.fetch(t)}get root(){return new URL(this.url)}toCanonical(e){return(0,i.assert)(!e.startsWith("/"),"Tried to parse absolute path."),new URL(e,this.url)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/http.cjs"}],[268,{"../../../shared/constants/app":5753,"../../../shared/constants/metametrics":5768,"../../../shared/constants/security-provider":5781,"../../../shared/constants/signatures":5782,"../../../shared/constants/transaction":5792,"../../../shared/lib/confirmation.utils":5805,"../../../shared/lib/snaps/snaps":5868,"../../../shared/modules/error":5892,"../../../shared/modules/transaction.utils":5919,"../../../ui/helpers/utils/metrics":7088,"./snap-keyring/metrics":327,"@metamask/controller-utils":1384,"@metamask/rpc-errors":2594,"ethereumjs-util":4296},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({rateLimitTimeout:e=3e5,rateLimitSamplePercent:t=.001,globalRateLimitTimeout:n=3e5,globalRateLimitMaxAmount:P=10,getAccountType:M,getDeviceModel:R,getHardwareTypeForMetric:A,snapAndHardwareMessenger:I,appStateController:j,metaMetricsController:C,getHDEntropyIndex:O}){return async function(N,D,x){const{origin:L,method:$,params:q}=N,U=function(e){return[a.MESSAGE_TYPE.WALLET_CREATE_SESSION,a.MESSAGE_TYPE.WALLET_INVOKE_METHOD].includes(e)}($),F=U?o.MetaMetricsRequestedThrough.MultichainApi:o.MetaMetricsRequestedThrough.EthereumProvider,H=U?o.MetaMetricsEventCategory.MultichainApi:o.MetaMetricsEventCategory.InpageProvider;let W,B=$;var V;$===a.MESSAGE_TYPE.WALLET_INVOKE_METHOD&&(B=null==q||null===(V=q.request)||void 0===V?void 0:V.method,W=null==q?void 0:q.scope);const G=S[B];let Y;switch(G){case y.TIMEOUT:Y=void 0!==T[B];break;case y.NON_RATE_LIMITED:Y=!1;break;case y.BLOCKED:Y=!0;break;default:case y.RANDOM_SAMPLE:Y=Math.random()>=t}const K=P>0&&k>=P,z=!0===C.state.participateInMetaMetrics,J=w[B],Q={api_source:F};let Z;W&&(Q.chain_id_caip=W);const X=(0,f.isSnapPreinstalled)(L),ee=L!==a.ORIGIN_METAMASK&&!X&&!Y&&!K&&!0===z;if(ee){var te;const t=J?J.REQUESTED:o.MetaMetricsEventName.ProviderMethodCalled;if(t===o.MetaMetricsEventName.SignatureRequested){var ne,se,re,ie,ae;let e;var oe,le;if(Q.signature_type=B,Q.hd_entropy_index=O(),(0,i.isValidAddress)(null==N||null===(ne=N.params)||void 0===ne?void 0:ne[1]))e=null==N||null===(oe=N.params)||void 0===oe?void 0:oe[0];else e=null==N||null===(le=N.params)||void 0===le?void 0:le[1];null!==(se=N.securityAlertResponse)&&void 0!==se&&se.providerRequestsCount&&Object.keys(N.securityAlertResponse.providerRequestsCount).forEach(e=>{Q[`ppom_${e}_count`]=N.securityAlertResponse.providerRequestsCount[e]}),Q.security_alert_response=(null===(re=N.securityAlertResponse)||void 0===re?void 0:re.result_type)??c.BlockaidResultType.NotApplicable,Q.security_alert_reason=(null===(ie=N.securityAlertResponse)||void 0===ie?void 0:ie.reason)??c.BlockaidReason.notApplicable,null!==(ae=N.securityAlertResponse)&&void 0!==ae&&ae.description&&(Q.security_alert_description=N.securityAlertResponse.description),(0,m.shouldUseRedesignForSignatures)({approvalType:v[B]})&&(Q.ui_customizations=[...Q.ui_customizations||[],o.MetaMetricsEventUiCustomization.RedesignedConfirmation]);const t=await(0,g.getSnapAndHardwareInfoForMetrics)(M,R,A,I);Object.assign(Q,t);try{if(B===a.MESSAGE_TYPE.PERSONAL_SIGN){const{isSIWEMessage:t}=(0,s.detectSIWE)({data:e});t&&(Q.ui_customizations=[...Q.ui_customizations||[],o.MetaMetricsEventUiCustomization.Siwe])}else if(B===a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4){const t=(0,l.parseTypedDataMessage)(e);Z={},Q.eip712_primary_type=t.primaryType,Z.eip712_verifyingContract=t.domain.verifyingContract,Z.eip712_domain_version=t.domain.version,Z.eip712_domain_name=t.domain.name,u.PRIMARY_TYPES_PERMIT.includes(t.primaryType)?Q.ui_customizations=[...Q.ui_customizations||[],o.MetaMetricsEventUiCustomization.Permit]:u.PRIMARY_TYPES_ORDER.includes(t.primaryType)&&(Q.ui_customizations=[...Q.ui_customizations||[],o.MetaMetricsEventUiCustomization.Order])}}catch(e){console.warn(`createRPCMethodTrackingMiddleware: Errored - ${e}`)}}else Q.method=B;const r=E[B];if(r&&(Q.params=r(q)),null===(te=_[B])||void 0===te||te.call(_,N,undefined,b.REQUESTED,Q),t===o.MetaMetricsEventName.SignatureRequested){!function(e,t,n,s){e.createEventFragment({category:s,initialEvent:o.MetaMetricsEventName.SignatureRequested,successEvent:o.MetaMetricsEventName.SignatureApproved,failureEvent:o.MetaMetricsEventName.SignatureRejected,uniqueIdentifier:(0,p.generateSignatureUniqueId)(t.id),persist:!0,referrer:{url:t.origin},...n})}(C,N,{properties:Q,sensitiveProperties:Z},H)}else C.trackEvent({event:t,category:H,referrer:{url:L},properties:Q});G===y.TIMEOUT&&(T[B]=setTimeout(()=>{delete T[B]},e)),k+=1,setTimeout(()=>{k-=1},n)}x(async e=>{var t,n,s,i;if(!1===ee||void 0===J)return e();const a=null===(t=D.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.location;let l,c;const u=(0,h.getErrorMessage)(D.error);if((null===(n=D.error)||void 0===n?void 0:n.code)===r.errorCodes.provider.userRejectedRequest?(l=J.REJECTED,c=b.REJECTED):(null===(s=D.error)||void 0===s?void 0:s.code)===r.errorCodes.rpc.internal&&[u,D.error.message].includes("Request rejected by user or snap.")?(l=J.REJECTED,c=b.REJECTED,Q.status=u):(l=J.APPROVED,c=b.APPROVED),!l)return e();if(null===(i=_[B])||void 0===i||i.call(_,N,D,c,Q),J.REQUESTED===o.MetaMetricsEventName.SignatureRequested){const e=await(0,g.getSnapAndHardwareInfoForMetrics)(M,R,A,I);Object.assign(Q,e)}let m={};if(d.SIGNING_METHODS.includes(B)){var f;const e=j.getSignatureSecurityAlertResponse(null===(f=N.securityAlertResponse)||void 0===f?void 0:f.securityAlertId);m=(0,p.getBlockaidMetricsProps)({securityAlertResponse:e})}const y={...Q,...m,location:a};if(l===o.MetaMetricsEventName.SignatureRejected||l===o.MetaMetricsEventName.SignatureApproved){const e={abandoned:l===J.REJECTED},t={properties:{...y,hd_entropy_index:O()},sensitiveProperties:Z};!function(e,t,n,s){const r=(0,p.generateSignatureUniqueId)(t.id);e.updateEventFragment(r,s),e.finalizeEventFragment(r,n)}(C,N,e,t)}else C.trackEvent({event:l,category:H,referrer:{url:L},properties:y});return e()})}};var s=e("@metamask/controller-utils"),r=e("@metamask/rpc-errors"),i=e("ethereumjs-util"),a=e("../../../shared/constants/app"),o=e("../../../shared/constants/metametrics"),l=e("../../../shared/modules/transaction.utils"),c=e("../../../shared/constants/security-provider"),u=e("../../../shared/constants/signatures"),d=e("../../../shared/constants/transaction"),h=e("../../../shared/modules/error"),p=e("../../../ui/helpers/utils/metrics"),m=e("../../../shared/lib/confirmation.utils"),f=e("../../../shared/lib/snaps/snaps"),g=e("./snap-keyring/metrics");const y={TIMEOUT:"timeout",BLOCKED:"blocked",NON_RATE_LIMITED:"non_rate_limited",RANDOM_SAMPLE:"random_sample"},b={REQUESTED:"REQUESTED",APPROVED:"APPROVED",REJECTED:"REJECTED"},S={[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.PERSONAL_SIGN]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_DECRYPT]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:y.TIMEOUT,[a.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:y.TIMEOUT,[a.MESSAGE_TYPE.WALLET_CREATE_SESSION]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.SEND_METADATA]:y.BLOCKED,[a.MESSAGE_TYPE.ETH_CHAIN_ID]:y.BLOCKED,[a.MESSAGE_TYPE.ETH_ACCOUNTS]:y.BLOCKED,[a.MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE]:y.BLOCKED,[a.MESSAGE_TYPE.GET_PROVIDER_STATE]:y.BLOCKED,[a.MESSAGE_TYPE.WALLET_GET_CALLS_STATUS]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.WALLET_GET_CAPABILITIES]:y.NON_RATE_LIMITED,[a.MESSAGE_TYPE.WALLET_SEND_CALLS]:y.NON_RATE_LIMITED},v={[a.MESSAGE_TYPE.PERSONAL_SIGN]:s.ApprovalType.PersonalSign,[a.MESSAGE_TYPE.SIGN]:s.ApprovalType.SignTransaction,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:s.ApprovalType.EthSignTypedData,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:s.ApprovalType.EthSignTypedData,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:s.ApprovalType.EthSignTypedData,[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:s.ApprovalType.EthSignTypedData},w={[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.PERSONAL_SIGN]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[a.MESSAGE_TYPE.ETH_DECRYPT]:{APPROVED:o.MetaMetricsEventName.DecryptionApproved,REJECTED:o.MetaMetricsEventName.DecryptionRejected,REQUESTED:o.MetaMetricsEventName.DecryptionRequested},[a.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:{APPROVED:o.MetaMetricsEventName.EncryptionPublicKeyApproved,REJECTED:o.MetaMetricsEventName.EncryptionPublicKeyRejected,REQUESTED:o.MetaMetricsEventName.EncryptionPublicKeyRequested},[a.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[a.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[a.MESSAGE_TYPE.WALLET_CREATE_SESSION]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[a.MESSAGE_TYPE.WALLET_GET_CALLS_STATUS]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called},[a.MESSAGE_TYPE.WALLET_GET_CAPABILITIES]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called},[a.MESSAGE_TYPE.WALLET_SEND_CALLS]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called}},E={[a.MESSAGE_TYPE.WATCH_ASSET]:({type:e})=>({type:e}),[a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e}),[a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e})},_={[a.MESSAGE_TYPE.WALLET_SEND_CALLS]:function(e,t,n,s){var r;if(n!==b.REQUESTED)return;const{params:i}=e,a=null==i||null===(r=i[0])||void 0===r||null===(r=r.calls)||void 0===r?void 0:r.length;a&&(s.batch_transaction_count=a)},[a.MESSAGE_TYPE.WALLET_CREATE_SESSION]:function(e,t,n,s){if(n===b.REQUESTED){const{params:t}=e,n=(null==t?void 0:t.requiredScopes)||{},r=(null==t?void 0:t.optionalScopes)||{},i=new Set;for(const e of Object.keys(n))i.add(e);for(const e of Object.keys(r))i.add(e);s.chain_id_list=Array.from(i)}else if(n===b.APPROVED){const{result:e}=t,n=Object.keys((null==e?void 0:e.sessionScopes)||{});s.chain_id_list=n}}},T={};let k=0}}},{package:"$root$",file:"app/scripts/lib/createRPCMethodTrackingMiddleware.js"}],[2680,{"./http.cjs":2679,"./local.cjs":2681,"./location.cjs":2682,"./npm.cjs":2683},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./location.cjs"),n),r(e("./npm.cjs"),n),r(e("./local.cjs"),n),r(e("./http.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/index.cjs"}],[2681,{"./http.cjs":2679,"@metamask/snaps-utils":2902,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.LocalLocation=void 0;const a=e("@metamask/snaps-utils"),o=e("@metamask/utils"),l=e("./http.cjs");var c=new WeakMap;function u(e){return(0,o.assert)(e.data.canonicalPath!==undefined),e.data.canonicalPath=`local:${e.data.canonicalPath}`,e}n.LocalLocation=class{constructor(e,t={}){var n,r,u;s(this,c,void 0),(0,o.assertStruct)(e.toString(),a.LocalSnapIdStruct,"Invalid Snap Id"),(0,o.assert)(t.fetchOptions===undefined,"Currently adding fetch options to local: is unsupported."),n=c,r=this,u=new l.HttpLocation(new URL(e.toString().slice(a.SnapIdPrefixes.local.length)),{...t,fetchOptions:{cache:"no-cache"}}),n.set(i(n,r),u)}async manifest(){return u(await r(c,this).manifest())}async fetch(e){return u(await r(c,this).fetch(e))}get shouldAlwaysReload(){return!0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/local.cjs"}],[2682,{"./http.cjs":2679,"./local.cjs":2681,"./npm.cjs":2683,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.detectSnapLocation=void 0;const s=e("@metamask/utils"),r=e("./http.cjs"),i=e("./local.cjs"),a=e("./npm.cjs");n.detectSnapLocation=function(e,t){const n=(null==t?void 0:t.allowHttp)??!1,o=(null==t?void 0:t.allowLocal)??!1,l=new URL(e);switch(l.protocol){case"npm:":return new a.NpmLocation(l,t);case"local:":return(0,s.assert)(o,new TypeError("Fetching local snaps is disabled.")),new i.LocalLocation(l,t);case"http:":case"https:":return(0,s.assert)(n,new TypeError("Fetching snaps through http/https is disabled.")),new r.HttpLocation(l,t);default:throw new TypeError(`Unrecognized "${l.protocol}" snap location protocol.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/location.cjs"}],[2683,{"@metamask/snaps-utils":2902,"@metamask/utils":3070,"concat-stream":2691,"get-npm-tarball-url":4399,"readable-stream":2706,"readable-web-to-node-stream":5256,"tar-stream":5648},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t,n){return e.set(l(e,t),n),n}function o(e,t){return e.get(l(e,t))}function l(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var c=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getNpmCanonicalBasePath=n.fetchNpmMetadata=n.NpmLocation=n.TARBALL_SIZE_SAFETY_LIMIT=n.BaseNpmLocation=n.NPM_REGISTRY_PROXY=n.DEFAULT_NPM_REGISTRY=void 0;const u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),h=c(e("concat-stream")),p=c(e("get-npm-tarball-url")),m=e("readable-stream"),f=e("readable-web-to-node-stream"),g=e("tar-stream");n.DEFAULT_NPM_REGISTRY=new URL("https://registry.npmjs.org"),n.NPM_REGISTRY_PROXY=new URL("https://npm-ota.api.cx.metamask.io");var y=new WeakMap,b=new WeakMap,S=new WeakSet;class v{constructor(e,t={}){var a,o;r(a=this,o=S),o.add(a),i(this,"meta",void 0),s(this,y,void 0),s(this,b,void 0);const l=t.allowCustomRegistries??!1,c=t.fetch??globalThis.fetch.bind(undefined),h=t.versionRange??u.DEFAULT_REQUESTED_SNAP_VERSION,p=t.resolveVersion??(async e=>e);let m;(0,d.assertStruct)(e.toString(),u.NpmSnapIdStruct,"Invalid Snap Id: "),""===e.host&&""===e.port&&""===e.username&&""===e.password?m=t.useNpmProxy?n.NPM_REGISTRY_PROXY:n.DEFAULT_NPM_REGISTRY:(m="https://",e.username&&(m+=e.username,e.password&&(m+=`:${e.password}`),m+="@"),m+=e.host,m=new URL(m),(0,d.assert)(l,new TypeError(`Custom NPM registries are disabled, tried to use "${m.toString()}".`))),(0,d.assert)("/"===m.pathname&&""===m.search&&""===m.hash),(0,d.assert)(""!==e.pathname&&"/"!==e.pathname,new TypeError("The package name in NPM location is empty."));let f=e.pathname;f.startsWith("/")&&(f=f.slice(1)),this.meta={requestedRange:h,registry:m,packageName:f,fetch:c,resolveVersion:p}}async manifest(){if(o(y,this))return o(y,this).clone();const e=await this.fetch("snap.manifest.json"),t=(0,u.parseJson)(e.toString());return e.result=(0,u.createSnapManifest)(t),a(y,this,e),this.manifest()}async fetch(e){const t=(0,u.normalizeRelative)(e);o(b,this)||(await l(S,this,w).call(this),(0,d.assert)(o(b,this)!==undefined));const n=o(b,this).get(t);return(0,d.assert)(n!==undefined,new TypeError(`File "${e}" not found in package.`)),n.clone()}get packageName(){return this.meta.packageName}get version(){return(0,d.assert)(this.meta.version!==undefined,"Tried to access version without first fetching NPM package."),this.meta.version}get registry(){return this.meta.registry}get versionRange(){return this.meta.requestedRange}}async function w(){(0,d.assert)(o(b,this)===undefined);const e=await this.meta.resolveVersion(this.meta.requestedRange),{tarballURL:t,targetVersion:n}=await async function(e,t,n,s){var r;if(T(n)&&(0,d.isValidSemVerVersion)(t))return{tarballURL:(0,p.default)(e,t),targetVersion:t};const i=await E(e,n,s),a=Object.keys((null==i?void 0:i.versions)??{}).map(e=>((0,d.assertIsSemVerVersion)(e),e)),o=(0,u.getTargetVersion)(a,t);if(null===o)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}".`);const l=null==i||null===(r=i.versions)||void 0===r||null===(r=r[o])||void 0===r||null===(r=r.dist)||void 0===r?void 0:r.tarball;return{tarballURL:l,targetVersion:o}}(this.meta.packageName,e,this.meta.registry,this.meta.fetch);if(!(0,u.isValidUrl)(t)||!t.toString().endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in NPM metadata for package "${this.meta.packageName}".`);const s=new URL(t);s.hostname=this.meta.registry.hostname,s.protocol=this.meta.registry.protocol;const r=await this.fetchNpmTarball(s);a(b,this,r),this.meta.version=n}n.BaseNpmLocation=v,n.TARBALL_SIZE_SAFETY_LIMIT=262144e3;async function E(e,t,n){const s=await n(new URL(e,t).toString(),{headers:{accept:T(t)?"application/vnd.npm.install-v1+json; q=1.0, application/json; q=0.8, */*":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch NPM registry entry. Status code: ${s.status}.`);const r=await s.json();if(!(0,d.isObject)(r))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);return r}function _(e,t){let n="npm://";return""!==e.username&&(n+=e.username,""!==e.password&&(n+=`:${e.password}`),n+="@"),`${n}${e.host}/${t}/`}function T(e){const t=e.toString();return t===n.DEFAULT_NPM_REGISTRY.toString()||t===n.NPM_REGISTRY_PROXY.toString()}n.NpmLocation=class extends v{async fetchNpmTarball(e){const t=await this.meta.fetch(e.toString());(0,d.assert)(404!==t.status,`"${this.meta.packageName}" was not found in the NPM registry`),(0,d.assert)(t.ok&&t.body,`Failed to fetch tarball for package "${this.meta.packageName}"`);const s=t.headers.get("content-length");(0,d.assert)(s,"Snap tarball has invalid content-length");const r=parseInt(s,10);return(0,d.assert)(r<=n.TARBALL_SIZE_SAFETY_LIMIT,"Snap tarball exceeds size limit"),new Promise((e,s)=>{const r=new Map,i=function(e,t){(0,d.assert)(e.endsWith("/"),"Base needs to end with '/' for relative paths to be added as children instead of siblings."),(0,d.assert)(e.startsWith("npm:"),'Protocol mismatch, expected "npm:".');const s=(0,g.extract)();let r=0;return s.on("entry",(i,a,o)=>{const{name:l,type:c}=i;if("file"===c){const i=l.replace(k,"");return a.pipe((0,h.default)({encoding:"uint8array"},a=>{try{r+=a.byteLength,(0,d.assert)(r<n.TARBALL_SIZE_SAFETY_LIMIT,`Snap tarball exceeds limit of ${n.TARBALL_SIZE_SAFETY_LIMIT} bytes.`);const s=new u.VirtualFile({value:a,path:i,data:{canonicalPath:new URL(i,e).toString()}});return(0,d.assert)(!t.has(i),"Malformed tarball, multiple files with the same path."),t.set(i,s),o()}catch(e){return s.destroy(e)}}))}return a.on("end",()=>o()),a.resume()}),s}(_(this.meta.registry,this.meta.packageName),r),a=t.body,o=new DecompressionStream("gzip"),l=a.pipeThrough(o);(0,m.pipeline)(function(e){if("function"!=typeof e.getReader)return e;return new f.ReadableWebToNodeStream(e)}(l),i,t=>{t?s(t):e(r)})})}},n.fetchNpmMetadata=E,n.getNpmCanonicalBasePath=_;const k=/^package\//u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/npm.cjs"}],[2684,{"./json.cjs":2685,"./registry.cjs":2686},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./registry.cjs"),n),r(e("./json.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/index.cjs"}],[2685,{"./registry.cjs":2686,"@metamask/base-controller":1311,"@metamask/snaps-registry":2711,"@metamask/snaps-utils":2902,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function a(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.JsonSnapsRegistry=void 0;const l=e("@metamask/base-controller"),c=e("@metamask/snaps-registry"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),h=e("./registry.cjs"),p={database:null,lastUpdated:null,databaseUnavailable:!1};var m=new WeakMap,f=new WeakMap,g=new WeakMap,y=new WeakMap,b=new WeakMap,S=new WeakMap,v=new WeakMap,w=new WeakSet;class E extends l.BaseController{constructor({messenger:e,state:t,url:n={registry:"https://acl.execution.metamask.io/latest/registry.json",signature:"https://acl.execution.metamask.io/latest/signature.json"},publicKey:i="0x025b65308f0f0fb8bc7f7ff87bfc296e0330eee5d3c1d1ee4a048b2fd6a86fa0a6",clientConfig:l,fetchFunction:c=globalThis.fetch.bind(undefined),recentFetchThreshold:u=(0,d.inMilliseconds)(5,d.Duration.Minute),refetchOnAllowlistMiss:h=!0}){var E,_;super({messenger:e,metadata:{database:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},lastUpdated:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},databaseUnavailable:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1}},name:"SnapsRegistry",state:{...p,...t}}),r(E=this,_=w),_.add(E),s(this,m,void 0),s(this,f,void 0),s(this,g,void 0),s(this,y,void 0),s(this,b,void 0),s(this,S,void 0),s(this,v,void 0),a(m,this,n),a(f,this,i),a(g,this,l),a(y,this,c),a(b,this,u),a(S,this,h),a(v,this,null),this.messenger.registerActionHandler("SnapsRegistry:get",async(...e)=>o(w,this,R).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:getMetadata",(...e)=>o(w,this,I).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:resolveVersion",async(...e)=>o(w,this,A).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:update",async()=>o(w,this,T).call(this))}}function _(){return this.state.lastUpdated&&Date.now()-this.state.lastUpdated<i(b,this)}async function T(){i(v,this)?await i(v,this):(null===i(v,this)&&a(v,this,o(w,this,k).call(this)),await i(v,this),a(v,this,null))}async function k(){if(!o(w,this,_).call(this))try{const[e,t]=await Promise.all([o(w,this,C).call(this,i(m,this).registry),o(w,this,C).call(this,i(m,this).signature)]);o(w,this,j).call(this,e,t),this.update(t=>{t.database=JSON.parse(e),t.lastUpdated=Date.now(),t.databaseUnavailable=!1})}catch{this.update(e=>{e.databaseUnavailable=!0})}}async function P(){return null===this.state.database&&await o(w,this,T).call(this),this.state.database}async function M(e,t,n=!1){var s,r;const a=await o(w,this,P).call(this),l=null==a?void 0:a.blockedSnaps.find(n=>"id"in n?n.id===e&&(0,d.satisfiesVersionRange)(t.version,n.versionRange):n.checksum===t.checksum);if(l)return{status:h.SnapsRegistryStatus.Blocked,reason:l.reason};const c=null==a?void 0:a.verifiedSnaps[e],u=null==c||null===(s=c.versions)||void 0===s?void 0:s[t.version],p=null==u||null===(r=u.clientVersions)||void 0===r?void 0:r[i(g,this).type],m=!p||(0,d.satisfiesVersionRange)(i(g,this).version,p);return u&&u.checksum===t.checksum&&m?{status:h.SnapsRegistryStatus.Verified}:i(S,this)&&!n?(await o(w,this,T).call(this),o(w,this,M).call(this,e,t,!0)):{status:this.state.databaseUnavailable?h.SnapsRegistryStatus.Unavailable:h.SnapsRegistryStatus.Unverified}}async function R(e){return Object.entries(e).reduce(async(e,[t,n])=>{const s=await o(w,this,M).call(this,t,n),r=await e;return r[t]=s,r},Promise.resolve({}))}async function A(e,t,n=!1){var s;const r=await o(w,this,P).call(this),a=(null==r||null===(s=r.verifiedSnaps[e])||void 0===s?void 0:s.versions)??null;if(!a&&i(S,this)&&!n)return await o(w,this,T).call(this),o(w,this,A).call(this,e,t,!0);if(!a)return t;const l=Object.entries(a).reduce((e,[t,n])=>{var s;const r=null===(s=n.clientVersions)||void 0===s?void 0:s[i(g,this).type];return r&&!(0,d.satisfiesVersionRange)(i(g,this).version,r)||e.push(t),e},[]),c=(0,u.getTargetVersion)(l,t);return c||!i(S,this)||n?c?((0,d.assertIsSemVerRange)(c),c):t:(await o(w,this,T).call(this),o(w,this,A).call(this,e,t,!0))}function I(e){var t;return(null===(t=this.state)||void 0===t||null===(t=t.database)||void 0===t||null===(t=t.verifiedSnaps[e])||void 0===t?void 0:t.metadata)??null}function j(e,t){(0,d.assert)(i(f,this),"No public key provided.");const n=(0,c.verify)({registry:e,signature:JSON.parse(t),publicKey:i(f,this)});(0,d.assert)(n,"Invalid registry signature.")}async function C(e){const t=await i(y,this).call(this,e);if(!t.ok)throw new Error(`Failed to fetch ${e}.`);return await t.text()}n.JsonSnapsRegistry=E}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/json.cjs"}],[2686,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryStatus=void 0,function(e){e[e.Unverified=0]="Unverified",e[e.Blocked=1]="Blocked",e[e.Verified=2]="Verified",e[e.Unavailable=3]="Unavailable"}(s||(n.SnapsRegistryStatus=s={}))}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/registry.cjs"}],[2687,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRunnableSnaps=void 0;n.getRunnableSnaps=e=>e.filter(e=>e.enabled&&!e.blocked)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/selectors.cjs"}],[2688,{"./snaps/Timer.cjs":2676,"@metamask/snaps-sdk":2788,"@metamask/snaps-utils":2902,"fast-deep-equal":4345},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.isLocalSnapId=n.isTrackableHandler=n.throttleTracking=n.TRACKABLE_HANDLERS=n.debouncePersistState=n.fetchSnap=n.getSnapFiles=n.withTimeout=n.hasTimedOut=n.delayWithTimer=n.delay=n.permissionsDiff=n.setDiff=void 0;const r=e("@metamask/snaps-sdk"),i=e("@metamask/snaps-utils"),a=s(e("fast-deep-equal")),o=e("./snaps/Timer.cjs");function l(e,t){let n;const s=new Promise((s,r)=>{e.start(()=>{t===undefined?s():s(t)}),n=r});return s.cancel=()=>{"finished"!==e.status&&(e.cancel(),n(new Error("The delay has been canceled.")))},s}async function c(e,t){return t&&0!==t.length?await Promise.all(t.map(async t=>e.fetch(t))):[]}n.setDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>(n in t||(e[n]=s),e),{})},n.permissionsDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>{const r=n in t;return(!r||r&&!(0,a.default)(s.caveats??[],t[n].caveats??[]))&&(e[n]=s),e},{})},n.delay=function(e,t){return l(new o.Timer(e),t)},n.delayWithTimer=l,n.hasTimedOut=Symbol("Used to check if the requested promise has timeout (see withTimeout)"),n.withTimeout=async function(e,t){const s=l("number"==typeof t?new o.Timer(t):t,n.hasTimedOut);try{return await Promise.race([e,s])}finally{s.cancel()}},n.getSnapFiles=c,n.fetchSnap=async function(e,t){try{const e=await t.manifest(),n=await t.fetch(e.result.source.location.npm.filePath);(0,r.assert)(n.size<i.MAX_FILE_SIZE,"Snap source code must be smaller than 64 MB.");const{iconPath:s}=e.result.source.location.npm,a=s?await t.fetch(s):undefined,o=await c(t,e.result.source.files);(0,i.validateAuxiliaryFiles)(o),await Promise.all(o.map(async e=>{e.data.base64=await(0,i.encodeBase64)(e)}));const l=await c(t,e.result.source.locales),u={manifest:e,sourceCode:n,svgIcon:a,auxiliaryFiles:o,localizationFiles:(0,i.getValidatedLocalizationFiles)(l)};return await(0,i.validateFetchedSnap)(u),u}catch(t){throw new Error(`Failed to fetch snap "${e}": ${(0,r.getErrorMessage)(t)}.`)}},n.debouncePersistState=function(e,t=1e3){const n=new Map;return(s,r,i)=>{const a=`${s}-${i}`;n.has(a)&&clearTimeout(n.get(a)),n.set(a,setTimeout(()=>{e(s,r,i),n.delete(a)},t))}},n.TRACKABLE_HANDLERS=Object.freeze([i.HandlerType.OnHomePage,i.HandlerType.OnInstall,i.HandlerType.OnNameLookup,i.HandlerType.OnRpcRequest,i.HandlerType.OnSignature,i.HandlerType.OnTransaction,i.HandlerType.OnUpdate]),n.throttleTracking=function(e,t=6e4){const n=new Map,s=new Map;return(r,i,a,o)=>{const l=`${r}${i}${a}${o}`,c=Date.now(),u=n.get(l)??0,d=[r,i,a,o];if(c-u>=t)return n.set(l,c),void e(...d);const h=s.get(l);null!=h&&h.timer&&clearTimeout(h.timer),n.set(l,c),s.set(l,{args:d,timer:setTimeout(()=>{e(...d),s.delete(l)},t)})}},n.isTrackableHandler=function(e){return n.TRACKABLE_HANDLERS.includes(e)},n.isLocalSnapId=function(e){return e.startsWith("local:")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/utils.cjs"}],[2689,{"../snaps/index.cjs":2678,"@metamask/rpc-errors":2594,"@metamask/snaps-utils":2902,"@metamask/utils":3070,nanoid:4993},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(l(e,t))}function o(e,t,n){return e.set(l(e,t),n),n}function l(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketService=void 0;const c=e("@metamask/rpc-errors"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),h=e("nanoid"),p=e("../snaps/index.cjs"),m="WebSocketService";var f=new WeakMap,g=new WeakMap,y=new WeakSet;function b(e,t){const n=a(g,this).get(t);return(0,d.assert)(n&&n.snapId===e,`Socket with ID "${t}" not found.`),n}function S(e,t,n){return l(y,this,k).call(this,e).some(e=>e.url===t&&(0,u.isEqual)(e.protocols,n))}function v(e,t){a(f,this).call("SnapController:handleRequest",{origin:p.METAMASK_ORIGIN,snapId:e,handler:u.HandlerType.OnWebSocketEvent,request:{method:"",params:{event:t}}}).catch(t=>{(0,u.logError)(`An error occurred while handling a WebSocket message for Snap "${e}":`,t)})}async function w(e,t,n=[]){(0,d.assert)(!l(y,this,S).call(this,e,t,n),`An open WebSocket connection to ${t} already exists.`);const s=new URL(t),{origin:r}=s,i=(0,h.nanoid)(),o=new WebSocket(t,n);o.binaryType="arraybuffer";const{promise:u,resolve:p,reject:m}=(0,d.createDeferredPromise)();o.addEventListener("open",()=>{p(),l(y,this,v).call(this,e,{type:"open",id:i,origin:r})}),o.addEventListener("close",t=>{a(g,this).delete(i),l(y,this,v).call(this,e,{type:"close",id:i,origin:r,code:t.code,reason:t.reason,wasClean:t.wasClean??null})});const f=()=>{m(c.rpcErrors.resourceUnavailable("An error occurred while opening the WebSocket."))};return o.addEventListener("error",f),o.addEventListener("message",t=>{const n="string"==typeof t.data?{type:"text",message:t.data}:{type:"binary",message:Array.from(new Uint8Array(t.data))};l(y,this,v).call(this,e,{type:"message",id:i,origin:r,data:n})}),a(g,this).set(i,{id:i,snapId:e,url:t,protocols:n,socket:o,openPromise:u}),await u,o.removeEventListener("error",f),i}function E(e,t){const{socket:n}=l(y,this,b).call(this,e,t);n.close()}function _(e){for(const t of l(y,this,k).call(this,e))l(y,this,E).call(this,e,t.id)}async function T(e,t,n){const{socket:s,openPromise:r}=l(y,this,b).call(this,e,t);await r;const i=Array.isArray(n)?new Uint8Array(n):n;s.send(i)}function k(e){return[...a(g,this).values()].filter(t=>t.snapId===e).map(e=>({id:e.id,url:e.url,protocols:e.protocols}))}n.WebSocketService=class{constructor({messenger:e}){var t,n;r(t=this,n=y),n.add(t),i(this,"name",m),i(this,"state",null),s(this,f,void 0),s(this,g,void 0),o(f,this,e),o(g,this,new Map),a(f,this).registerActionHandler(`${m}:open`,async(...e)=>l(y,this,w).call(this,...e)),a(f,this).registerActionHandler(`${m}:close`,(...e)=>l(y,this,E).call(this,...e)),a(f,this).registerActionHandler(`${m}:sendMessage`,async(...e)=>l(y,this,T).call(this,...e)),a(f,this).registerActionHandler(`${m}:getAll`,(...e)=>l(y,this,k).call(this,...e)),a(f,this).subscribe("SnapController:snapUpdated",e=>{l(y,this,_).call(this,e.id)}),a(f,this).subscribe("SnapController:snapUninstalled",e=>{l(y,this,_).call(this,e.id)}),a(f,this).subscribe("SnapController:snapInstalled",e=>{l(y,this,_).call(this,e.id)})}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/WebSocketService.cjs"}],[269,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,s){t.tabId=e.tabId,s()}}}}},{package:"$root$",file:"app/scripts/lib/createTabIdMiddleware.js"}],[2690,{"./WebSocketService.cjs":2689},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./WebSocketService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/index.cjs"}],[2691,{buffer:4038,"buffer-from":4044,inherits:4573,"readable-stream":2706,typedarray:5667},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=e("readable-stream").Writable,r=e("inherits"),i=e("buffer-from");if("undefined"==typeof Uint8Array)var a=e("typedarray").Uint8Array;else a=Uint8Array;function o(e,t){if(!(this instanceof o))return new o(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var n=e.encoding,r=!1;n?"u8"!==(n=String(n).toLowerCase())&&"uint8"!==n||(n="uint8array"):r=!0,s.call(this,{objectMode:!0}),this.encoding=n,this.shouldInferEncoding=r,t&&this.on("finish",function(){t(this.getBody())}),this.body=[]}t.exports=o,r(o,s),o.prototype._write=function(e,t,n){this.body.push(e),n()},o.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return n.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},o.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++)t.push.apply(t,e[n]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];"string"==typeof r||n.isBuffer(r)?t.push(r):l(r)?t.push(i(r)):t.push(i(String(r)))}t=n.isBuffer(e[0])?(t=n.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];n.isBuffer(r)?t.push(r):l(r)?t.push(i(r)):t.push(i(String(r)))}return n.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]=i(e[n])),t+=e[n].length;for(var s=new a(t),r=(n=0,0);n<e.length;n++)for(var o=e[n],l=0;l<o.length;l++)s[r++]=o[l];return s}(this.body):this.body):[]};Array.isArray;function l(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snaps-controllers>concat-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/concat-stream/index.js"}],[2692,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s={};function r(e,t,n){n||(n=Error);var r=function(e){var n,s;function r(n,s,r){return e.call(this,function(e,n,s){return"string"==typeof t?t:t(e,n,s)}(n,s,r))||this}return s=e,(n=r).prototype=Object.create(s.prototype),n.prototype.constructor=n,n.__proto__=s,r}(n);r.prototype.name=n.name,r.prototype.code=e,s[e]=r}function i(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map(function(e){return String(e)}),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,n){var s,r,a,o;if("string"==typeof t&&(r="not ",t.substr(!a||a<0?0:+a,r.length)===r)?(s="must not be",t=t.replace(/^not /,"")):s="must be",function(e,t,n){return(n===undefined||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))o="The ".concat(e," ").concat(s," ").concat(i(t,"type"));else{var l=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(l," ").concat(s," ").concat(i(t,"type"))}return o+=". Received type ".concat(typeof n)},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=s}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/errors-browser.js"}],[2693,{"./_stream_readable":2695,"./_stream_writable":2697,_process:5047,inherits:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=c;var r=e("./_stream_readable"),i=e("./_stream_writable");e("inherits")(c,r);for(var a=s(i.prototype),o=0;o<a.length;o++){var l=a[o];c.prototype[l]||(c.prototype[l]=i.prototype[l])}function c(e){if(!(this instanceof c))return new c(e);r.call(this,e),i.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_duplex.js"}],[2694,{"./_stream_transform":2696,inherits:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=r;var s=e("./_stream_transform");function r(e){if(!(this instanceof r))return new r(e);s.call(this,e)}e("inherits")(r,s),r.prototype._transform=function(e,t,n){n(null,e)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_passthrough.js"}],[2695,{"../errors":2692,"./_stream_duplex":2693,"./internal/streams/async_iterator":2698,"./internal/streams/buffer_list":2699,"./internal/streams/destroy":2700,"./internal/streams/from":2702,"./internal/streams/state":2704,"./internal/streams/stream":2705,_process:5047,buffer:4038,events:4338,inherits:4573,"string_decoder/":5640,util:3990},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;t.exports=T,T.ReadableState=_;e("events").EventEmitter;var r=function(e,t){return e.listeners(t).length},i=e("./internal/streams/stream"),a=e("buffer").Buffer,o=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var l,c=e("util");l=c&&c.debuglog?c.debuglog("stream"):function(){};var u,d,h,p=e("./internal/streams/buffer_list"),m=e("./internal/streams/destroy"),f=e("./internal/streams/state").getHighWaterMark,g=e("../errors").codes,y=g.ERR_INVALID_ARG_TYPE,b=g.ERR_STREAM_PUSH_AFTER_EOF,S=g.ERR_METHOD_NOT_IMPLEMENTED,v=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(T,i);var w=m.errorOrDestroy,E=["error","close","destroy","pause","resume"];function _(t,n,r){s=s||e("./_stream_duplex"),t=t||{},"boolean"!=typeof r&&(r=n instanceof s),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=f(this,t,"readableHighWaterMark",r),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(u||(u=e("string_decoder/").StringDecoder),this.decoder=new u(t.encoding),this.encoding=t.encoding)}function T(t){if(s=s||e("./_stream_duplex"),!(this instanceof T))return new T(t);var n=this instanceof s;this._readableState=new _(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),i.call(this)}function k(e,t,n,s,r){l("readableAddChunk",t);var i,c=e._readableState;if(null===t)c.reading=!1,function(e,t){if(l("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?A(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,I(e)))}(e,c);else if(r||(i=function(e,t){var n;s=t,a.isBuffer(s)||s instanceof o||"string"==typeof t||t===undefined||e.objectMode||(n=new y("chunk",["string","Buffer","Uint8Array"],t));var s;return n}(c,t)),i)w(e,i);else if(c.objectMode||t&&t.length>0)if("string"==typeof t||c.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),s)c.endEmitted?w(e,new v):P(e,c,t,!0);else if(c.ended)w(e,new b);else{if(c.destroyed)return!1;c.reading=!1,c.decoder&&!n?(t=c.decoder.write(t),c.objectMode||0!==t.length?P(e,c,t,!1):j(e,c)):P(e,c,t,!1)}else s||(c.reading=!1,j(e,c));return!c.ended&&(c.length<c.highWaterMark||0===c.length)}function P(e,t,n,s){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,s?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&A(e)),j(e,t)}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=m.destroy,T.prototype._undestroy=m.undestroy,T.prototype._destroy=function(e,t){t(e)},T.prototype.push=function(e,t){var n,s=this._readableState;return s.objectMode?n=!0:"string"==typeof e&&((t=t||s.defaultEncoding)!==s.encoding&&(e=a.from(e,t),t=""),n=!0),k(this,e,t,!1,n)},T.prototype.unshift=function(e){return k(this,e,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(t){u||(u=e("string_decoder/").StringDecoder);var n=new u(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var s=this._readableState.buffer.head,r="";null!==s;)r+=n.write(s.data),s=s.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var M=1073741824;function R(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=M?e=M:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function A(e){var t=e._readableState;l("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(l("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(I,e))}function I(e){var t=e._readableState;l("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,x(e)}function j(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(C,e,t))}function C(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(l("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function O(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function N(e){l("readable nexttick read 0"),e.read(0)}function D(e,t){l("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),x(e),t.flowing&&!t.reading&&e.read(0)}function x(e){var t=e._readableState;for(l("flow",t.flowing);t.flowing&&null!==e.read(););}function L(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function $(e){var t=e._readableState;l("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(q,t,e))}function q(e,t){if(l("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function U(e,t){for(var n=0,s=e.length;n<s;n++)if(e[n]===t)return n;return-1}T.prototype.read=function(e){l("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return l("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?$(this):A(this),null;if(0===(e=R(e,t))&&t.ended)return 0===t.length&&$(this),null;var s,r=t.needReadable;return l("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&l("length less than watermark",r=!0),t.ended||t.reading?l("reading or ended",r=!1):r&&(l("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=R(n,t))),null===(s=e>0?L(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&$(this)),null!==s&&this.emit("data",s),s},T.prototype._read=function(e){w(this,new S("_read()"))},T.prototype.pipe=function(e,t){var s=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,l("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?c:g;function o(t,n){l("onunpipe"),t===s&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,l("cleanup"),e.removeListener("close",m),e.removeListener("finish",f),e.removeListener("drain",u),e.removeListener("error",p),e.removeListener("unpipe",o),s.removeListener("end",c),s.removeListener("end",g),s.removeListener("data",h),d=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function c(){l("onend"),e.end()}i.endEmitted?n.nextTick(a):s.once("end",a),e.on("unpipe",o);var u=function(e){return function(){var t=e._readableState;l("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&r(e,"data")&&(t.flowing=!0,x(e))}}(s);e.on("drain",u);var d=!1;function h(t){l("ondata");var n=e.write(t);l("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==U(i.pipes,e))&&!d&&(l("false write response, pause",i.awaitDrain),i.awaitDrain++),s.pause())}function p(t){l("onerror",t),g(),e.removeListener("error",p),0===r(e,"error")&&w(e,t)}function m(){e.removeListener("finish",f),g()}function f(){l("onfinish"),e.removeListener("close",m),g()}function g(){l("unpipe"),s.unpipe(e)}return s.on("data",h),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",p),e.once("close",m),e.once("finish",f),e.emit("pipe",s),i.flowing||(l("pipe resume"),s.resume()),e},T.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var s=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)s[i].emit("unpipe",this,{hasUnpiped:!1});return this}var a=U(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},T.prototype.on=function(e,t){var s=i.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,l("on readable",r.length,r.reading),r.length?A(this):r.reading||n.nextTick(N,this))),s},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(e,t){var s=i.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(O,this),s},T.prototype.removeAllListeners=function(e){var t=i.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||n.nextTick(O,this),t},T.prototype.resume=function(){var e=this._readableState;return e.flowing||(l("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(D,e,t))}(this,e)),e.paused=!1,this},T.prototype.pause=function(){return l("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(l("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(e){var t=this,n=this._readableState,s=!1;for(var r in e.on("end",function(){if(l("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(r){(l("wrapped data"),n.decoder&&(r=n.decoder.write(r)),!n.objectMode||null!==r&&r!==undefined)&&((n.objectMode||r&&r.length)&&(t.push(r)||(s=!0,e.pause())))}),e)this[r]===undefined&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var i=0;i<E.length;i++)e.on(E[i],this.emit.bind(this,E[i]));return this._read=function(t){l("wrapped _read",t),s&&(s=!1,e.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return d===undefined&&(d=e("./internal/streams/async_iterator")),d(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),T._fromList=L,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(t,n){return h===undefined&&(h=e("./internal/streams/from")),h(T,t,n)})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_readable.js"}],[2696,{"../errors":2692,"./_stream_duplex":2693,inherits:4573},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=u;var s=e("../errors").codes,r=s.ERR_METHOD_NOT_IMPLEMENTED,i=s.ERR_MULTIPLE_CALLBACK,a=s.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=s.ERR_TRANSFORM_WITH_LENGTH_0,l=e("./_stream_duplex");function c(e,t){var n=this._transformState;n.transforming=!1;var s=n.writecb;if(null===s)return this.emit("error",new i);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),s(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush(function(t,n){h(e,t,n)})}function h(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new o;if(e._transformState.transforming)throw new a;return e.push(null)}e("inherits")(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new r("_transform()"))},u.prototype._write=function(e,t,n){var s=this._transformState;if(s.writecb=n,s.writechunk=e,s.writeencoding=t,!s.transforming){var r=this._readableState;(s.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,function(e){t(e)})}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_transform.js"}],[2697,{"../errors":2692,"./_stream_duplex":2693,"./internal/streams/destroy":2700,"./internal/streams/state":2704,"./internal/streams/stream":2705,_process:5047,buffer:4038,inherits:4573,"util-deprecate":5705},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var s=e.entry;e.entry=null;for(;s;){var r=s.callback;t.pendingcb--,r(n),s=s.next}t.corkedRequestsFree.next=e}(t,e)}}var r;t.exports=T,T.WritableState=_;var i={deprecate:e("util-deprecate")},a=e("./internal/streams/stream"),o=e("buffer").Buffer,l=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var c,u=e("./internal/streams/destroy"),d=e("./internal/streams/state").getHighWaterMark,h=e("../errors").codes,p=h.ERR_INVALID_ARG_TYPE,m=h.ERR_METHOD_NOT_IMPLEMENTED,f=h.ERR_MULTIPLE_CALLBACK,g=h.ERR_STREAM_CANNOT_PIPE,y=h.ERR_STREAM_DESTROYED,b=h.ERR_STREAM_NULL_VALUES,S=h.ERR_STREAM_WRITE_AFTER_END,v=h.ERR_UNKNOWN_ENCODING,w=u.errorOrDestroy;function E(){}function _(t,i,a){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof a&&(a=i instanceof r),this.objectMode=!!t.objectMode,a&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var s=e._writableState,r=s.sync,i=s.writecb;if("function"!=typeof i)throw new f;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(s),t)!function(e,t,s,r,i){--t.pendingcb,s?(n.nextTick(i,r),n.nextTick(I,e,t),e._writableState.errorEmitted=!0,w(e,r)):(i(r),e._writableState.errorEmitted=!0,w(e,r),I(e,t))}(e,s,r,t,i);else{var a=R(s)||e.destroyed;a||s.corked||s.bufferProcessing||!s.bufferedRequest||M(e,s),r?n.nextTick(P,e,s,a,i):P(e,s,a,i)}}(i,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function T(t){var n=this instanceof(r=r||e("./_stream_duplex"));if(!n&&!c.call(T,this))return new T(t);this._writableState=new _(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),a.call(this)}function k(e,t,n,s,r,i,a){t.writelen=s,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):n?e._writev(r,t.onwrite):e._write(r,i,t.onwrite),t.sync=!1}function P(e,t,n,s){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,s(),I(e,t)}function M(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),a=t.corkedRequestsFree;a.entry=n;for(var o=0,l=!0;n;)i[o]=n,n.isBuf||(l=!1),n=n.next,o+=1;i.allBuffers=l,k(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,d=n.callback;if(k(e,t,!1,t.objectMode?1:c.length,c,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function A(e,t){e._final(function(n){t.pendingcb--,n&&w(e,n),t.prefinished=!0,e.emit("prefinish"),I(e,t)})}function I(e,t){var s=R(t);if(s&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(A,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return s}e("inherits")(T,a),_.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(_.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(T,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===T&&(e&&e._writableState instanceof _)}})):c=function(e){return e instanceof this},T.prototype.pipe=function(){w(this,new g)},T.prototype.write=function(e,t,s){var r,i=this._writableState,a=!1,c=!i.objectMode&&(r=e,o.isBuffer(r)||r instanceof l);return c&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(s=t,t=null),c?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof s&&(s=E),i.ending?function(e,t){var s=new S;w(e,s),n.nextTick(t,s)}(this,s):(c||function(e,t,s,r){var i;return null===s?i=new b:"string"==typeof s||t.objectMode||(i=new p("chunk",["string","Buffer"],s)),!i||(w(e,i),n.nextTick(r,i),!1)}(this,i,e,s))&&(i.pendingcb++,a=function(e,t,n,s,r,i){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,n));return t}(t,s,r);s!==a&&(n=!0,r="buffer",s=a)}var l=t.objectMode?1:s.length;t.length+=l;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:s,encoding:r,isBuf:n,callback:i,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else k(e,t,!1,l,s,r,i);return c}(this,i,c,e,t,s)),a},T.prototype.cork=function(){this._writableState.corked++},T.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||M(this,e))},T.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new v(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),T.prototype._write=function(e,t,n){n(new m("_write()"))},T.prototype._writev=null,T.prototype.end=function(e,t,s){var r=this._writableState;return"function"==typeof e?(s=e,e=null,t=null):"function"==typeof t&&(s=t,t=null),null!==e&&e!==undefined&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,s){t.ending=!0,I(e,t),s&&(t.finished?n.nextTick(s):e.once("finish",s));t.ended=!0,e.writable=!1}(this,r,s),this},Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),T.prototype.destroy=u.destroy,T.prototype._undestroy=u.undestroy,T.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_writable.js"}],[2698,{"./end-of-stream":2701,_process:5047},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=e("./end-of-stream"),a=Symbol("lastResolve"),o=Symbol("lastReject"),l=Symbol("error"),c=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function p(e,t){return{value:e,done:t}}function m(e){var t=e[a];if(null!==t){var n=e[h].read();null!==n&&(e[u]=null,e[a]=null,e[o]=null,t(p(n,!1)))}}function f(e){n.nextTick(m,e)}var g=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((r(s={get stream(){return this[h]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(p(undefined,!0));if(this[h].destroyed)return new Promise(function(t,s){n.nextTick(function(){e[l]?s(e[l]):t(p(undefined,!0))})});var s,r=this[u];if(r)s=new Promise(function(e,t){return function(n,s){e.then(function(){t[c]?n(p(undefined,!0)):t[d](n,s)},s)}}(r,this));else{var i=this[h].read();if(null!==i)return Promise.resolve(p(i,!1));s=new Promise(this[d])}return this[u]=s,s}},Symbol.asyncIterator,function(){return this}),r(s,"return",function(){var e=this;return new Promise(function(t,n){e[h].destroy(null,function(e){e?n(e):t(p(undefined,!0))})})}),s),g);t.exports=function(e){var t,n=Object.create(y,(r(t={},h,{value:e,writable:!0}),r(t,a,{value:null,writable:!0}),r(t,o,{value:null,writable:!0}),r(t,l,{value:null,writable:!0}),r(t,c,{value:e._readableState.endEmitted,writable:!0}),r(t,d,{value:function(e,t){var s=n[h].read();s?(n[u]=null,n[a]=null,n[o]=null,e(p(s,!1))):(n[a]=e,n[o]=t)},writable:!0}),t));return n[u]=null,i(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[o];return null!==t&&(n[u]=null,n[a]=null,n[o]=null,t(e)),void(n[l]=e)}var s=n[a];null!==s&&(n[u]=null,n[a]=null,n[o]=null,s(p(undefined,!0))),n[c]=!0}),e.on("readable",f.bind(null,n)),n}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/async_iterator.js"}],[2699,{buffer:4038,util:3990},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function i(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,o(s.key),s)}}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var l=e("buffer").Buffer,c=e("util").inspect,u=c&&c.custom||"inspect";function d(e,t,n){l.prototype.copy.call(e,t,n)}t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,s;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return l.alloc(0);for(var t=l.allocUnsafe(e>>>0),n=this.head,s=0;n;)d(n.data,t,s),s+=n.data.length,n=n.next;return t}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,s=t.data;for(e-=s.length;t=t.next;){var r=t.data,i=e>r.length?r.length:e;if(i===r.length?s+=r:s+=r.slice(0,e),0===(e-=i)){i===r.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(i));break}++n}return this.length-=n,s}},{key:"_getBuffer",value:function(e){var t=l.allocUnsafe(e),n=this.head,s=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var r=n.data,i=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,i),0===(e-=i)){i===r.length?(++s,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=r.slice(i));break}++s}return this.length-=s,t}},{key:u,value:function(e,t){return c(this,r(r({},t),{},{depth:0,customInspect:!1}))}}])&&a(t.prototype,n),s&&a(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/buffer_list.js"}],[27,{"../../../../shared/constants/metametrics":5768,"@metamask/assets-controllers":1240,"@metamask/bridge-controller":1318},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NftControllerInit=void 0;var s=e("@metamask/assets-controllers"),r=e("@metamask/bridge-controller"),i=e("../../../../shared/constants/metametrics");n.NftControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n})=>({controller:new s.NftController({state:n.NftController,messenger:e,onNftAdded:({address:e,symbol:n,tokenId:s,standard:a,source:o})=>t.call("MetaMetricsController:trackEvent",{event:i.MetaMetricsEventName.NftAdded,category:i.MetaMetricsEventCategory.Wallet,sensitiveProperties:{token_contract_address:e,token_symbol:n??null,token_id:s,token_standard:a,asset_type:r.AssetType.NFT,source:o}})})})}}},{package:"$root$",file:"app/scripts/controller-init/assets/nft-controller-init.ts"}],[270,{"../../../shared/constants/app":5753,"../../../shared/lib/trace":5873},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){return async function(e,t,n){const{id:s,method:o}=e,l=i[o];l&&(e.traceContext=await(0,r.trace)({name:l,id:s,tags:a[o]}),await(0,r.trace)({name:r.TraceName.Middleware,id:s,parentContext:e.traceContext})),n()}};var s=e("../../../shared/constants/app"),r=e("../../../shared/lib/trace");const i={[s.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:r.TraceName.Transaction,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:r.TraceName.Signature,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:r.TraceName.Signature,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:r.TraceName.Signature,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:r.TraceName.Signature,[s.MESSAGE_TYPE.PERSONAL_SIGN]:r.TraceName.Signature},a={[s.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:{source:"dapp"}}}}},{package:"$root$",file:"app/scripts/lib/createTracingMiddleware.ts"}],[2700,{_process:5047},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(e){(function(){function n(e,t){r(e,t),s(e)}function s(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function r(e,t){e.emit("error",t)}t.exports={destroy:function(t,i){var a=this,o=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return o||l?(i?i(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(r,this,t)):e.nextTick(r,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!i&&t?a._writableState?a._writableState.errorEmitted?e.nextTick(s,a):(a._writableState.errorEmitted=!0,e.nextTick(n,a,t)):e.nextTick(n,a,t):i?(e.nextTick(s,a),i(t)):e.nextTick(s,a)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,s=e._writableState;n&&n.autoDestroy||s&&s.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/destroy.js"}],[2701,{"../../../errors":2692},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function r(){}t.exports=function e(t,n,i){if("function"==typeof n)return e(t,null,n);n||(n={}),i=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];e.apply(this,s)}}}(i||r);var a=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,l=function(){t.writable||u()},c=t._writableState&&t._writableState.finished,u=function(){o=!1,c=!0,a||i.call(t)},d=t._readableState&&t._readableState.endEmitted,h=function(){a=!1,d=!0,o||i.call(t)},p=function(e){i.call(t,e)},m=function(){var e;return a&&!d?(t._readableState&&t._readableState.ended||(e=new s),i.call(t,e)):o&&!c?(t._writableState&&t._writableState.ended||(e=new s),i.call(t,e)):void 0},f=function(){t.req.on("finish",u)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",l),t.on("close",l)):(t.on("complete",u),t.on("abort",m),t.req?f():t.on("request",f)),t.on("end",h),t.on("finish",u),!1!==n.error&&t.on("error",p),t.on("close",m),function(){t.removeListener("complete",u),t.removeListener("abort",m),t.removeListener("request",f),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("end",h),t.removeListener("error",p),t.removeListener("close",m)}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"}],[2702,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/from-browser.js"}],[2703,{"../../../errors":2692,"./end-of-stream":2701},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;var r=e("../../../errors").codes,i=r.ERR_MISSING_ARGS,a=r.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function l(e){e()}function c(e,t){return e.pipe(t)}t.exports=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var u,d=function(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}(n);if(Array.isArray(n[0])&&(n=n[0]),n.length<2)throw new i("streams");var h=n.map(function(t,r){var i=r<n.length-1;return function(t,n,r,i){i=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(i);var o=!1;t.on("close",function(){o=!0}),s===undefined&&(s=e("./end-of-stream")),s(t,{readable:n,writable:r},function(e){if(e)return i(e);o=!0,i()});var l=!1;return function(e){if(!o&&!l)return l=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void i(e||new a("pipe"))}}(t,i,r>0,function(e){u||(u=e),e&&h.forEach(l),i||(h.forEach(l),d(u))})});return n.reduce(c)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/pipeline.js"}],[2704,{"../../../errors":2692},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,r){var i=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new s(r?n:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/state.js"}],[2705,{events:4338},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=e("events").EventEmitter}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/stream-browser.js"}],[2706,{"./lib/_stream_duplex.js":2693,"./lib/_stream_passthrough.js":2694,"./lib/_stream_readable.js":2695,"./lib/_stream_transform.js":2696,"./lib/_stream_writable.js":2697,"./lib/internal/streams/end-of-stream.js":2701,"./lib/internal/streams/pipeline.js":2703},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/readable-browser.js"}],[271,{"./dapp-swap-util":272},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createDappSwapMiddleware=function({fetchQuotes:e,setDappSwapComparisonData:t,getNetworkConfigurationByNetworkClientId:n,dappSwapMetricsFlag:r}){return async(i,a,o)=>{const{securityAlertResponse:l}=i,{securityAlertId:c}=l??{};c&&"eth_sendTransaction"===i.method&&(0,s.getQuotesForConfirmation)({req:i,fetchQuotes:e,setDappSwapComparisonData:t,getNetworkConfigurationByNetworkClientId:n,dappSwapMetricsFlag:r,securityAlertId:c}),o()}};var s=e("./dapp-swap-util")}}},{package:"$root$",file:"app/scripts/lib/dapp-swap/dapp-swap-middleware.ts"}],[2711,{"./verify":2712,"@metamask/superstruct":2931,"@metamask/utils":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryDatabaseStruct=n.BlockedSnapStruct=n.BlockReasonStruct=n.VerifiedSnapStruct=n.ImagePathStruct=n.AdditionalSourceCodeStruct=n.SupportStruct=n.AuditStruct=n.AuthorStruct=void 0;const i=e("@metamask/superstruct"),a=e("@metamask/utils"),o=(0,i.refine)((0,i.string)(),"Npm ID",e=>e.startsWith("npm:")),l=(0,i.object)({checksum:a.ChecksumStruct,clientVersions:(0,i.optional)((0,i.object)({extension:(0,i.optional)(a.VersionRangeStruct),mobile:(0,i.optional)(a.VersionRangeStruct)}))});n.AuthorStruct=(0,i.object)({name:(0,i.string)(),website:(0,i.string)()}),n.AuditStruct=(0,i.object)({auditor:(0,i.string)(),report:(0,i.string)()}),n.SupportStruct=(0,i.object)({knowledgeBase:(0,i.optional)((0,i.string)()),faq:(0,i.optional)((0,i.string)()),contact:(0,i.optional)((0,i.string)()),keyRecovery:(0,i.optional)((0,i.string)())}),n.AdditionalSourceCodeStruct=(0,i.object)({name:(0,i.string)(),url:(0,i.string)()}),n.ImagePathStruct=(0,i.pattern)((0,i.string)(),/\.\/images\/.*\/\d+\.(?:png|jpe?g)$/u),n.VerifiedSnapStruct=(0,i.object)({id:o,metadata:(0,i.object)({name:(0,i.string)(),type:(0,i.optional)((0,i.enums)(["account"])),author:(0,i.optional)(n.AuthorStruct),website:(0,i.optional)((0,i.string)()),onboard:(0,i.optional)((0,i.boolean)()),summary:(0,i.optional)((0,i.string)()),description:(0,i.optional)((0,i.string)()),audits:(0,i.optional)((0,i.array)(n.AuditStruct)),category:(0,i.optional)((0,i.enums)(["interoperability","notifications","transaction insights","account management","name resolution"])),tags:(0,i.optional)((0,i.array)((0,i.string)())),support:(0,i.optional)(n.SupportStruct),sourceCode:(0,i.optional)((0,i.string)()),hidden:(0,i.optional)((0,i.boolean)()),privateCode:(0,i.optional)((0,i.boolean)()),privacyPolicy:(0,i.optional)((0,i.string)()),termsOfUse:(0,i.optional)((0,i.string)()),additionalSourceCode:(0,i.optional)((0,i.array)(n.AdditionalSourceCodeStruct)),screenshots:(0,i.optional)((0,i.size)((0,i.array)(n.ImagePathStruct),3,3))}),versions:(0,i.record)(a.VersionStruct,l)}),n.BlockReasonStruct=(0,i.object)({explanation:(0,i.optional)((0,i.string)()),url:(0,i.optional)((0,i.string)())}),n.BlockedSnapStruct=(0,i.union)([(0,i.object)({id:o,versionRange:a.VersionRangeStruct,reason:(0,i.optional)(n.BlockReasonStruct)}),(0,i.object)({checksum:a.ChecksumStruct,reason:(0,i.optional)(n.BlockReasonStruct)})]),n.SnapsRegistryDatabaseStruct=(0,i.object)({verifiedSnaps:(0,i.record)(o,n.VerifiedSnapStruct),blockedSnaps:(0,i.array)(n.BlockedSnapStruct)}),r(e("./verify"),n)}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/index.js"}],[2712,{"@metamask/superstruct":2931,"@metamask/utils":3070,"@noble/curves/secp256k1":3111,"@noble/hashes/sha256":3123},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.verify=n.SignatureStruct=void 0;const s=e("@metamask/superstruct"),r=e("@metamask/utils"),i=e("@noble/curves/secp256k1"),a=e("@noble/hashes/sha256");n.SignatureStruct=(0,s.object)({signature:r.StrictHexStruct,curve:(0,s.literal)("secp256k1"),format:(0,s.literal)("DER")}),n.verify=function({registry:e,signature:t,publicKey:s}){(0,r.assertStruct)(t,n.SignatureStruct,"Invalid signature object");const o=(0,r.hexToBytes)(s);return i.secp256k1.verify((0,r.remove0x)(t.signature),(0,a.sha256)((0,r.stringToBytes)(e)),o)}}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/verify.js"}],[272,{"../../../../shared/lib/sentry":5866,"../../../../shared/modules/dapp-swap-comparison/dapp-swap-comparison-utils":5889,loglevel:4802},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getQuotesForConfirmation=function({req:e,fetchQuotes:t,setDappSwapComparisonData:n,getNetworkConfigurationByNetworkClientId:s,dappSwapMetricsFlag:l,securityAlertId:c}){let u="";try{const{enabled:d,bridge_quote_fees:h,origins:p}=l;if(!d||!c)return;const{params:m,origin:f}=e;if(f&&p.includes(f)){const{chainId:l}=s(e.networkClientId)??{},{data:d,from:p}=o(m);if(d&&c&&l){const e=(0,a.parseTransactionData)(d);u=e.commands;const{quotesInput:s,amountMin:o}=(0,a.getDataFromSwap)(l,e.commandBytes,e.inputs);if(s){(0,a.checkValidSingleOrBatchTransaction)(m[0].calls,null==s?void 0:s.srcTokenAddress),n(c,{commands:u,swapInfo:{srcTokenAddress:null==s?void 0:s.srcTokenAddress,destTokenAddress:null==s?void 0:s.destTokenAddress,srcTokenAmount:null==s?void 0:s.srcTokenAmount,destTokenAmountMin:o}});const e=(new Date).getTime();t({...s,walletAddress:p,fee:h}).then(t=>{const s=(new Date).getTime();t&&n(c,{quotes:t,latency:s-e})}).catch(e=>{n(c,{error:`Error fetching bridge quotes: ${e.message}`,commands:u}),r.default.error("Error fetching dapp swap quotes",e),(0,i.captureException)(e)})}}}}catch(e){c&&n(c,{error:`Error fetching bridge quotes: ${e.message}`,commands:u})}};var s,r=(s=e("loglevel"))&&s.__esModule?s:{default:s},i=e("../../../../shared/lib/sentry"),a=e("../../../../shared/modules/dapp-swap-comparison/dapp-swap-comparison-utils");const o=e=>{if(null==e||!e.length)return{data:undefined,from:undefined,chainId:undefined};const{calls:t,chainId:n,data:s,from:r}=e[0];let i=s;if(null!=t&&t.length){const e=null==t?void 0:t.find(({data:e})=>null==e?void 0:e.startsWith("0x3593564c"));e&&(i=null==e?void 0:e.data)}return{chainId:n,data:i,from:r}}}}},{package:"$root$",file:"app/scripts/lib/dapp-swap/dapp-swap-util.ts"}],[273,{"../../../../shared/lib/deep-links/constants":5807,"../../../../shared/lib/deep-links/parse":5809,"../../../../shared/lib/deep-links/routes/route":5819,"../../../../shared/lib/deep-links/verify":5823,"../../../../shared/modules/mv3.utils":5899,events:4338,loglevel:4802,"webextension-polyfill":5741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DeepLinkRouter=void 0;var s=d(e("events")),r=d(e("webextension-polyfill")),i=d(e("loglevel")),a=e("../../../../shared/modules/mv3.utils"),o=e("../../../../shared/lib/deep-links/parse"),l=e("../../../../shared/lib/deep-links/constants"),c=e("../../../../shared/lib/deep-links/routes/route"),u=e("../../../../shared/lib/deep-links/verify");function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const p=c.DEEP_LINK_ROUTE.replace(/^\//u,"");class m extends s.default{constructor({getExtensionURL:e,getState:t}){super(),h(this,"getExtensionURL",void 0),h(this,"getState",void 0),h(this,"handleBeforeRequest",({tabId:e,url:t})=>e===r.default.tabs.TAB_ID_NONE?{}:this.tryNavigateTo(e,t)),this.getExtensionURL=e,this.getState=t}formatUrlForInterstitialPage(e){return e.pathname+e.search}get404ErrorURL(e){const t=new URLSearchParams({errorCode:"404"});return e&&t.set("u",this.formatUrlForInterstitialPage(e)),this.getExtensionURL(p,t.toString())}async redirectTab(e,t){try{await r.default.tabs.update(e,{url:t})}catch(e){i.default.error("Error redirecting tab:",e),this.emit("error",e)}}install(){r.default.webRequest.onBeforeRequest.addListener(this.handleBeforeRequest,{urls:[`*://*.${l.DEEP_LINK_HOST}/*`],types:["main_frame"]},a.isManifestV3?[]:["blocking"])}uninstall(){r.default.webRequest.onBeforeRequest.removeListener(this.handleBeforeRequest)}async tryNavigateTo(e,t){if(t.length>l.DEEP_LINK_MAX_LENGTH)return i.default.debug("Url is too long, skipping deep link handling"),{};let n;try{const e=new URL(t),s=await(0,o.parse)(e);if(s)if(this.emit("navigate",{url:e,parsed:s}),"redirectTo"in s.destination)n=s.destination.redirectTo.toString();else if(this.canSkipInterstitial(s.signature))n=this.getExtensionURL(s.destination.path,s.destination.query.toString());else{const t=new URLSearchParams({u:this.formatUrlForInterstitialPage(e)});n=this.getExtensionURL(p,t.toString())}else n=this.get404ErrorURL(e)}catch(e){i.default.error("Invalid URL:",t,e),this.emit("error",e),n=this.get404ErrorURL()}return this.redirectTab(e,n),a.isManifestV3?{}:{cancel:!0}}canSkipInterstitial(e){var t;return e===u.VALID&&Boolean(null===(t=this.getState().preferences)||void 0===t?void 0:t.skipDeepLinkInterstitial)}}n.DeepLinkRouter=m}}},{package:"$root$",file:"app/scripts/lib/deep-links/deep-link-router.ts"}],[274,{"../../../../shared/constants/metametrics":5768},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createEvent=function({signature:e,url:t}){const n={route:t.pathname,signature:e},i={};for(const[e,s]of t.searchParams.entries())"sig"!==e&&("attributionId"===e?n.attribution_id=s:r.has(e)?n[e]=s:i[e]=s);return{category:s.MetaMetricsEventCategory.DeepLink,event:s.MetaMetricsEventName.DeepLinkUsed,properties:n,sensitiveProperties:i}};var s=e("../../../../shared/constants/metametrics");const r=new Set(["utm_campaign","utm_content","utm_medium","utm_source","utm_term"])}}},{package:"$root$",file:"app/scripts/lib/deep-links/metrics.ts"}],[275,{"@metamask/browser-passworder":1357},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.encryptorFactory=void 0;var s=e("@metamask/browser-passworder");const r=e=>async(t,n,r,i)=>(0,s.encrypt)(t,n,r,i,{algorithm:"PBKDF2",params:{iterations:e}}),i=e=>async(t,n,r)=>(0,s.encryptWithDetail)(t,n,r,{algorithm:"PBKDF2",params:{iterations:e}}),a=e=>async(t,n,r,i)=>(0,s.keyFromPassword)(t,n,r,i??{algorithm:"PBKDF2",params:{iterations:e}}),o=e=>t=>(0,s.isVaultUpdated)(t,{algorithm:"PBKDF2",params:{iterations:e}});n.encryptorFactory=e=>({encrypt:r(e),encryptWithKey:s.encryptWithKey,encryptWithDetail:i(e),decrypt:s.decrypt,decryptWithKey:s.decryptWithKey,decryptWithDetail:s.decryptWithDetail,keyFromPassword:a(e),isVaultUpdated:o(e),importKey:s.importKey,exportKey:s.exportKey,generateSalt:s.generateSalt})}}},{package:"$root$",file:"app/scripts/lib/encryptor-factory.ts"}],[276,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"resolver",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"}],name:"setSubnodeOwner",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"ttl",type:"uint64"}],name:"setTTL",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"ttl",outputs:[{name:"",type:"uint64"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],name:"setResolver",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"owner",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"label",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"ttl",type:"uint64"}],name:"NewTTL",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/registry.js"}],[277,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes32"}],name:"setContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"},{name:"value",type:"string"}],name:"setText",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],name:"setPubkey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes"}],name:"setContenthash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"}],name:"text",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],name:"setABI",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"contenthash",outputs:[{name:"",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"pubkey",outputs:[{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"addr",type:"address"}],name:"setAddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"ensAddr",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"contentType",type:"uint256"}],name:"ABIChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"x",type:"bytes32"},{indexed:!1,name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"indexedKey",type:"string"},{indexed:!1,name:"key",type:"string"}],name:"TextChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/resolver.js"}],[278,{"./contracts/registry":276,"./contracts/resolver":277,"@ensdomains/content-hash":640,"@ethersproject/contracts":728,"@ethersproject/providers":766,"eth-ens-namehash":4242},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=async function({provider:e,name:t}){const n=s.default.hash(t),c=Number.parseInt(await e.request({method:"net_version"}),10),d=function(e){switch(e){case 1:case 3:case 4:case 5:case 6:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(c);if(!d)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${c}"`);const h=new i.Web3Provider(e),p=new a.Contract(d,o.default,h),m=await p.resolver(n);if(u(m))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const f=new a.Contract(m,l.default,h),g=await f.supportsInterface("0xbc1c58d1"),y=await f.supportsInterface("0xd8389dc5");if(g){const e=await f.contenthash(n);let t=r.default.decode(e);const s=r.default.getCodec(e);return"ipfs-ns"!==s&&"ipns-ns"!==s||(t=r.default.helpers.cidV0ToV1Base32(t)),{type:s,hash:t}}if(y){const e=await f.content(n);if(u(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var s=c(e("eth-ens-namehash")),r=c(e("@ensdomains/content-hash")),i=e("@ethersproject/providers"),a=e("@ethersproject/contracts"),o=c(e("./contracts/registry")),l=c(e("./contracts/resolver"));function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/resolver.js"}],[279,{"../../../../shared/modules/fetch-with-timeout":5894,"./resolver":278,"base32-encode":3923,"base64-js":3924,"webextension-polyfill":5741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:n,getUseAddressBarEnsResolution:a}){const l=u.map(e=>`*://*.${e}/*`);return i.default.webRequest.onErrorOccurred.addListener(d,{urls:l,types:["main_frame"]}),{remove(){i.default.webRequest.onErrorOccurred.removeListener(d)}};async function d(l){const{tabId:d,url:h}=l;if(-1===d||"0x1"!==t())return;const{hostname:p,pathname:m,search:f,hash:g}=new URL(h),y=p.split("."),b=y[y.length-1];u.includes(b)&&async function({tabId:t,name:l,pathname:u,search:d,fragment:h}){const p=n(),m=a(),f=`https://app.ens.domains/name/${l}`;m&&p&&await i.default.tabs.update(t,{url:"loading.html"});let g=f;0;try{const{type:t,hash:n}=await(0,o.default)({provider:e,name:l});if("ipfs-ns"===t||"ipns-ns"===t){if(""===p)return void(g=null);const e=`https://${n}.${t.slice(0,4)}.${p}${u}${d||""}${h||""}`;try{200===(await c(e,{method:"HEAD"})).status&&(g=e)}catch(e){console.warn(e)}}else if("swarm-ns"===t)g=`https://swarm-gateways.net/bzz:/${n}${u}${d||""}${h||""}`;else if("onion"===t||"onion3"===t)g=`http://${n}.onion${u}${d||""}${h||""}`;else if("zeronet"===t)g=`http://127.0.0.1:43110/${n}${u}${d||""}${h||""}`;else if("skynet-ns"===t){const e=n.padEnd(n.length+4-n.length%4,"="),t=r.default.toByteArray(e),i={padding:!1};g=`https://${(0,s.default)(t,"RFC4648-HEX",i).toLowerCase()}.siasky.net${u}${d||""}${h||""}`}}catch(e){console.warn(e)}finally{g&&(m||!m&&g!==f)&&await i.default.tabs.update(t,{url:g})}}({tabId:d,name:p,pathname:m,search:f,fragment:g})}};var s=l(e("base32-encode")),r=l(e("base64-js")),i=l(e("webextension-polyfill")),a=l(e("../../../../shared/modules/fetch-with-timeout")),o=l(e("./resolver"));function l(e){return e&&e.__esModule?e:{default:e}}const c=(0,a.default)(),u=["eth"]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/setup.js"}],[28,{"@metamask/assets-controllers":1240},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NftDetectionControllerInit=void 0;var s=e("@metamask/assets-controllers");n.NftDetectionControllerInit=e=>{const{controllerMessenger:t,getController:n}=e,r=()=>n("NftController");return{controller:new s.NftDetectionController({messenger:t,addNft:(...e)=>r().addNft(...e),getNftState:()=>r().state,disabled:!n("PreferencesController").state.useNftDetection}),persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/nft-detection-controller-init.ts"}]],[],{});